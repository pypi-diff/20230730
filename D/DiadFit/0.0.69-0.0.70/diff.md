# Comparing `tmp/DiadFit-0.0.69.tar.gz` & `tmp/DiadFit-0.0.70.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "DiadFit-0.0.69.tar", last modified: Mon Jul 17 20:54:33 2023, max compression
+gzip compressed data, was "DiadFit-0.0.70.tar", last modified: Sat Jul 29 22:21:44 2023, max compression
```

## Comparing `DiadFit-0.0.69.tar` & `DiadFit-0.0.70.tar`

### file list

```diff
@@ -1,31 +1,31 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 20:54:33.294978 DiadFit-0.0.69/
--rw-r--r--   0 runner    (1001) docker     (123)     1040 2023-07-17 20:54:33.294978 DiadFit-0.0.69/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)      600 2023-07-17 20:54:11.000000 DiadFit-0.0.69/README.md
--rw-r--r--   0 runner    (1001) docker     (123)       38 2023-07-17 20:54:33.298978 DiadFit-0.0.69/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     1207 2023-07-17 20:54:17.000000 DiadFit-0.0.69/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 20:54:33.294978 DiadFit-0.0.69/src/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 20:54:33.294978 DiadFit-0.0.69/src/DiadFit/
--rw-r--r--   0 runner    (1001) docker     (123)    26927 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/CO2_EOS.py
--rw-r--r--   0 runner    (1001) docker     (123)    11055 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/CO2_in_bubble_error.py
--rw-r--r--   0 runner    (1001) docker     (123)    43406 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/H2O_fitting.py
--rw-r--r--   0 runner    (1001) docker     (123)     1213 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/Highrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/Lowrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (123)     1301 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/Mediumrho_polyfit_data.pkl
--rw-r--r--   0 runner    (1001) docker     (123)    10435 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/Psensor.py
--rw-r--r--   0 runner    (1001) docker     (123)     1070 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      296 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/_version.py
--rw-r--r--   0 runner    (1001) docker     (123)     7675 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/argon_lines.py
--rw-r--r--   0 runner    (1001) docker     (123)    23438 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/cosmicray_filter.py
--rw-r--r--   0 runner    (1001) docker     (123)     5010 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/densimeter_fitting.py
--rw-r--r--   0 runner    (1001) docker     (123)    23763 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/densimeters.py
--rw-r--r--   0 runner    (1001) docker     (123)    16883 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/density_depth_crustal_profiles.py
--rw-r--r--   0 runner    (1001) docker     (123)   165479 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/diads.py
--rw-r--r--   0 runner    (1001) docker     (123)    32657 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/error_propagation.py
--rw-r--r--   0 runner    (1001) docker     (123)    37148 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/importing_data_files.py
--rw-r--r--   0 runner    (1001) docker     (123)    65097 2023-07-17 20:54:17.000000 DiadFit-0.0.69/src/DiadFit/ne_lines.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-17 20:54:33.294978 DiadFit-0.0.69/src/DiadFit.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1040 2023-07-17 20:54:33.000000 DiadFit-0.0.69/src/DiadFit.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)      740 2023-07-17 20:54:33.000000 DiadFit-0.0.69/src/DiadFit.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-17 20:54:33.000000 DiadFit-0.0.69/src/DiadFit.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       66 2023-07-17 20:54:33.000000 DiadFit-0.0.69/src/DiadFit.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        8 2023-07-17 20:54:33.000000 DiadFit-0.0.69/src/DiadFit.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-29 22:21:44.772149 DiadFit-0.0.70/
+-rw-r--r--   0 runner    (1001) docker     (123)     1040 2023-07-29 22:21:44.772149 DiadFit-0.0.70/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)      600 2023-07-29 22:21:25.000000 DiadFit-0.0.70/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)       38 2023-07-29 22:21:44.772149 DiadFit-0.0.70/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     1207 2023-07-29 22:21:30.000000 DiadFit-0.0.70/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-29 22:21:44.760149 DiadFit-0.0.70/src/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-29 22:21:44.768149 DiadFit-0.0.70/src/DiadFit/
+-rw-r--r--   0 runner    (1001) docker     (123)    27009 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/CO2_EOS.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11055 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/CO2_in_bubble_error.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43875 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/H2O_fitting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1213 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/Highrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (123)      751 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/Lowrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (123)     1301 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/Mediumrho_polyfit_data.pkl
+-rw-r--r--   0 runner    (1001) docker     (123)    10435 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/Psensor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1070 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      296 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/_version.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7675 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/argon_lines.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23438 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/cosmicray_filter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5010 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/densimeter_fitting.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25649 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/densimeters.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16883 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/density_depth_crustal_profiles.py
+-rw-r--r--   0 runner    (1001) docker     (123)   165629 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/diads.py
+-rw-r--r--   0 runner    (1001) docker     (123)    32657 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/error_propagation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    37148 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/importing_data_files.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65228 2023-07-29 22:21:30.000000 DiadFit-0.0.70/src/DiadFit/ne_lines.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-29 22:21:44.772149 DiadFit-0.0.70/src/DiadFit.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1040 2023-07-29 22:21:44.000000 DiadFit-0.0.70/src/DiadFit.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)      740 2023-07-29 22:21:44.000000 DiadFit-0.0.70/src/DiadFit.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-29 22:21:44.000000 DiadFit-0.0.70/src/DiadFit.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       66 2023-07-29 22:21:44.000000 DiadFit-0.0.70/src/DiadFit.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        8 2023-07-29 22:21:44.000000 DiadFit-0.0.70/src/DiadFit.egg-info/top_level.txt
```

### Comparing `DiadFit-0.0.69/PKG-INFO` & `DiadFit-0.0.70/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: DiadFit
-Version: 0.0.69
+Version: 0.0.70
 Summary: DiadFit
 Home-page: https://github.com/PennyWieser/DiadFit
 Author: Penny Wieser
 Author-email: penny.wieser@gmail.com
 License: UNKNOWN
 Description: [![PyPI](https://badgen.net/pypi/v/DiadFit)](https://pypi.org/project/DiadFit/)
         [![Build Status](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml/badge.svg?branch=main)](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml)
```

### Comparing `DiadFit-0.0.69/README.md` & `DiadFit-0.0.70/README.md`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/setup.py` & `DiadFit-0.0.70/setup.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/CO2_EOS.py` & `DiadFit-0.0.70/src/DiadFit/CO2_EOS.py`

 * *Files 1% similar despite different names*

```diff
@@ -426,14 +426,17 @@
         df=calculate_P_for_rho_T_SP94(CO2_dens_gcm3=CO2_dens_gcm3, T_K=T_K)
     else:
         raise TypeError('Please choose either SP94 or SW96 as an EOS')
 
     if Sample_ID is not None:
         df['Sample_ID']=Sample_ID
 
+    # Replace infinities with nan
+    df = df.replace([np.inf, -np.inf], np.nan)
+
     return df
 
 # Calculating P for a given density and Temperature using Coolprop
 
 def calculate_P_for_rho_T_SW96(CO2_dens_gcm3, T_K):
     """ This function calculates P in kbar for a specified CO2 density in g/cm3 and a known T (in K) for the Span and Wanger (1996) EOS
```

### Comparing `DiadFit-0.0.69/src/DiadFit/CO2_in_bubble_error.py` & `DiadFit-0.0.70/src/DiadFit/CO2_in_bubble_error.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/H2O_fitting.py` & `DiadFit-0.0.70/src/DiadFit/H2O_fitting.py`

 * *Files 5% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 from dataclasses import dataclass
 from typing import Tuple, Optional
 from DiadFit.importing_data_files import *
 from numpy import trapz
 from scipy.integrate import simps
 ##
 def extract_xstal_MI_name(*, files, char_xstal, pos_xstal, char_MI, pos_MI,
-                         prefix=True, str_prefix=" ", file_type='.txt'):
+                         prefix=True, str_prefix=" ", file_ext='.txt'):
 
     """ Extracts the names of the crystal and MI samples from a list of filenames
 
     Parameters
     ------------
     files (list): A list of filenames.
 
@@ -40,16 +40,16 @@
     Returns:
         df_out (pandas DataFrame): A dataframe with columns "filename", "crystal_name", and "MI_name", containing the input filenames, the extracted crystal sample names, and the extracted MI sample names, respectively.
 
     """
 
     file_simple=pf.extracting_filenames_generic(names=files,
     prefix=prefix, str_prefix=str_prefix,
-   file_type=file_type)
-    
+   file_ext=file_ext)
+
 
 
     xstal=np.empty(len(file_simple), dtype=object)
     MI=np.empty(len(file_simple), dtype=object)
 
     for i in range(0, len(file_simple)):
         name=file_simple[i]
@@ -58,176 +58,176 @@
     df_out=pd.DataFrame(data={'filename': files,
                          'crystal_name': xstal,
                          'MI_name': MI})
     return df_out
 
 
 
-def find_olivine_peak_trough_pos(smoothed_ol_y, x_new, height=1):
+def find_host_peak_trough_pos(smoothed_host_y, x_new, height=1):
 
-    """" This function identifies the peaks and troughs in the Olivine spectra
+    """" This function identifies the peaks and troughs in the host mineral spectra
 
     Parameters
     -----------
 
-    path: smoothed_ol_y
-        Olivine spectra y values after applying a cubic spline, and trimming to the spectra region around the peaks
-        (from function smooth_and_trim_around_olivine)
+    path: smoothed_host_y
+        Host spectra y values after applying a cubic spline, and trimming to the spectra region around the peaks
+        (from function smooth_and_trim_around_host)
     x_new: X values corresponding to y values in smoothed_ol_y
 
     height: int
         Height used for scipy find peaks function. May need tweaking
 
     Returns:
     -----------
     Peak positions (x), peak heights (y), trough x position, trough y position
 
 
 
     """
     # Find peaks with Scipy
-    peaks_Ol = find_peaks(smoothed_ol_y, height)
-    peak_height_Ol_unsort=peaks_Ol[1]['peak_heights']
-    peak_pos_Ol_unsort = x_new[peaks_Ol[0]]
+    peaks_Host= find_peaks(smoothed_host_y, height)
+    peak_height_Host_unsort=peaks_Host[1]['peak_heights']
+    peak_pos_Host_unsort = x_new[peaks_Host[0]]
 
-    df_peaks=pd.DataFrame(data={'pos': peak_pos_Ol_unsort,
-                            'height': peak_height_Ol_unsort})
+    df_peaks=pd.DataFrame(data={'pos': peak_pos_Host_unsort,
+                            'height': peak_height_Host_unsort})
     df_peaks_sort=df_peaks.sort_values('height', axis=0, ascending=False)
     df_peak_sort_short1=df_peaks_sort[0:2]
     df_peak_sort_short=df_peak_sort_short1.sort_values('pos', axis=0, ascending=True)
-    peak_pos_Ol=df_peak_sort_short['pos'].values
-    peak_height_Ol=df_peak_sort_short['height'].values
+    peak_pos_Host=df_peak_sort_short['pos'].values
+    peak_height_Host=df_peak_sort_short['height'].values
 
 
     # Find troughs - e..g find minimum point +3 from the 1st peak, -3 units from the 2nd peak
-    trim_y_cub_Ol=smoothed_ol_y[(x_new>(peak_pos_Ol[0]+3)) & (x_new<(peak_pos_Ol[1]-3))]
-    trim_x=x_new[(x_new>(peak_pos_Ol[0]+3)) & (x_new<(peak_pos_Ol[1]-3))]
+    trim_y_cub_Host=smoothed_host_y[(x_new>(peak_pos_Host[0]+3)) & (x_new<(peak_pos_Host[1]-3))]
+    trim_x=x_new[(x_new>(peak_pos_Host[0]+3)) & (x_new<(peak_pos_Host[1]-3))]
 
 
-    trough_y=np.min(trim_y_cub_Ol)
-    trough_x=trim_x[trim_y_cub_Ol==trough_y]
+    trough_y=np.min(trim_y_cub_Host)
+    trough_x=trim_x[trim_y_cub_Host==trough_y]
 
 
-    return peak_pos_Ol, peak_height_Ol, trough_y, trough_x
+    return peak_pos_Host, peak_height_Host, trough_y, trough_x
 
-def smooth_and_trim_around_olivine(filename=None, x_range=[800,900], x_max=900, Ol_spectra=None,
+def smooth_and_trim_around_host(filename=None, x_range=[800,900], x_max=900, Host_spectra=None,
                                    MI_spectra=None, plot_figure=True):
     """
-    Takes melt inclusion and olivine spectra, and trims into the region around the olivine peaks,
+    Takes melt inclusion and host spectra, and trims into the region around the host peaks,
     and fits a cubic spline (used for unmixing spectra)
 
     Parameters
     -----------
     x_range: list
         range of x coordinates to smooth between (e.g. [800, 900] by default
 
-    Ol_spectra: nd.array
-        numpy array of olivine spectra (x is wavenumber, y is intensity)
+    Host_spectra: nd.array
+        numpy array of host spectra (x is wavenumber, y is intensity)
 
     MI_spectra: nd.array
         numpy array of melt inclusion spectra (x is wavenumber, y is intensity)
 
     filename:str
         name of file for saving figure
 
 
 
     Returns:
     -----------
     x_new: x coordinates of smoothed curves
     y_cub_MI: smoothed y coordinates using a cubic spline for MI
-    y_cub_Ol: smoothed y coordinates using a cubic spline for Ol
+    y_cub_Host: smoothed y coordinates using a cubic spline for Ol
 
-    peak_pos_Ol: x coordinates of 2 olivine peaks
-    peak_height_Ol: y coordinates of 2 olivine peaks
+    peak_pos_Host: x coordinates of 2 host peaks
+    peak_height_Host: y coordinates of 2 host peaks
     trough_x: x coordinate of minimum point between peaks
     trough_y: y coordinate of minimum point between peaks
     """
     x_min=x_range[0]
     x_max=x_range[1]
     # Trim to region of interest
-    Filt_Ol=Ol_spectra[~(
-        (Ol_spectra[:, 0]<x_min) |
-        (Ol_spectra[:, 0]>x_max)
+    Filt_Host=Host_spectra[~(
+        (Host_spectra[:, 0]<x_min) |
+        (Host_spectra[:, 0]>x_max)
     )]
     Filt_MI=MI_spectra[~(
         (MI_spectra[:, 0]<x_min) |
         (MI_spectra[:, 0]>x_max)
     )]
 
     # Fit spline to data
 
     x_MI=Filt_MI[:, 0]
-    x_Ol=Filt_Ol[:, 0]
+    x_Host=Filt_Host[:, 0]
 
     y_MI=Filt_MI[:, 1]
-    y_Ol=Filt_Ol[:, 1]
+    y_Host=Filt_Host[:, 1]
 
 
     # Fit a  cubic spline
     f2_MI = interp1d(x_MI, y_MI, kind='cubic')
-    f2_Ol = interp1d(x_Ol, y_Ol, kind='cubic')
+    f2_Host = interp1d(x_Host, y_Host, kind='cubic')
 
-    x_new=np.linspace(min(x_Ol),max(x_Ol), 100000)
+    x_new=np.linspace(min(x_Host),max(x_Host), 100000)
 
     y_cub_MI=f2_MI(x_new)
-    y_cub_Ol=f2_Ol(x_new)
+    y_cub_Host=f2_Host(x_new)
 
     # Plot peaks and troughs on this to check they are right
-    peak_pos_Ol, peak_height_Ol, trough_y, trough_x=find_olivine_peak_trough_pos(
-        smoothed_ol_y=y_cub_Ol, x_new=x_new, height=1)
+    peak_pos_Host, peak_height_Host, trough_y, trough_x=find_host_peak_trough_pos(
+        smoothed_host_y=y_cub_Host, x_new=x_new, height=1)
 
 
     if plot_figure is True:
         fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(8,3.5))
         if filename is not None:
             fig.suptitle('file='+filename)
-        ax1.plot(Ol_spectra[:, 0], Ol_spectra[:, 1], '-g', label='Ol Spectra')
+        ax1.plot(Host_spectra[:, 0], Host_spectra[:, 1], '-g', label='Host Spectra')
         ax1.plot(MI_spectra[:, 0], MI_spectra[:, 1], '-',
                 color='salmon', label='MI Spectra')
 
         ax2.plot(Filt_MI[:, 0], Filt_MI[:, 1], '+', color='salmon')
-        ax2.plot(Filt_Ol[:, 0], Filt_Ol[:, 1], '+g')
-        ax2.plot(x_new, y_cub_MI, '-', color='salmon', label='MI Spectra')
-        ax2.plot(x_new, y_cub_Ol, '-g', label='Ol Spectra')
-        ax2.plot(peak_pos_Ol, peak_height_Ol, '*k',mfc='yellow', ms=10, label='Peaks')
+        ax2.plot(Filt_Host[:, 0], Filt_Host[:, 1], '+g')
+        ax2.plot(x_new, y_cub_MI, '-', color='salmon')
+        ax2.plot(x_new, y_cub_Host, '-g')
+        ax2.plot(peak_pos_Host, peak_height_Host, '*k',mfc='yellow', ms=10, label='Peaks')
         ax2.plot(trough_x, trough_y, 'dk', mfc='cyan', ms=10, label='Trough')
 
         ax1.set_xlabel('Wavenumber (cm$^{-1}$)')
         ax2.set_xlabel('Wavenumber (cm$^{-1}$)')
         ax1.set_ylabel('Intensity')
-        ax2.legend(bbox_to_anchor=(0., 1.02, 1., .102), loc='lower left',
-                        ncol=2, mode="expand", borderaxespad=0.)
+        ax1.legend(fontsize=8)
+        ax2.legend(fontsize=8)
 
-        return x_new, y_cub_MI, y_cub_Ol, peak_pos_Ol, peak_height_Ol, trough_x, trough_y, fig
+        return x_new, y_cub_MI, y_cub_Host, peak_pos_Host, peak_height_Host, trough_x, trough_y, fig
     else:
-        return x_new, y_cub_MI, y_cub_Ol, peak_pos_Ol, peak_height_Ol, trough_x, trough_y
+        return x_new, y_cub_MI, y_cub_Host, peak_pos_Host, peak_height_Host, trough_x, trough_y
 
 
 
-## Unmix the olivine
+## Unmix the host
 def trough_or_peak_higher(spectra_x, spectra_y, peak_pos_x,
                           trough_pos_x, trough_pos_y, av_width=1, plot=False,
                          print_result=False):
     """
     This function assesses whether the line between the 2 peaks is above or below the trough position
-    Called by a loop to select the optimum unmixing ratio for olivine and melt
+    Called by a loop to select the optimum unmixing ratio for host and melt
 
 
     Parameters
     -----------
     spectra_x: x coordinates of spectra to test
 
     spectra_y: y coordinates of spectra to test
 
-    peak_pos_x: x positions of 2 olivine peaks (from find_olivne_peak_trough_pos)
+    peak_pos_x: x positions of 2 host peaks (from find_host_peak_trough_pos)
 
-    trough_pos_x: x position of trough (from find_olivne_peak_trough_pos)
+    trough_pos_x: x position of trough (from find_host_peak_trough_pos)
 
-    trough_pos_y: y position of trough (from find_olivne_peak_trough_pos)
+    trough_pos_y: y position of trough (from find_host_peak_trough_pos)
 
     av_width: averages +- 1 width either side of the peak and troughs when doing assesment and regression
 
     plot: bool
 
     print_result: bool (default False)
         prints whether it found the trough above or below the peak
@@ -297,44 +297,44 @@
         plt.plot(trough_pos_x, Pred_trough, '*k', ms=10)
         plt.plot(spectra_x, spectra_y, '-k')
     return Dist
 
 
 
 # Now lets mix up spectra
-def make_evaluate_mixed_spectra(*, path, filename, smoothed_Ol_y, smoothed_MI_y,
-                                Ol_spectra, MI_spectra, x_new, peak_pos_Ol,
+def make_evaluate_mixed_spectra(*, path, filename, smoothed_host_y, smoothed_MI_y,
+                                Host_spectra, MI_spectra, x_new, peak_pos_Host,
                       trough_x, trough_y, N_steps=20, av_width=2,
                                X_min=0, X_max=1, plot_figure=True, dpi=200):
 
     """
-    This function unmixes glass and olivine spectra, and fits the best fit proportion where the olivine peak and trough disapears. Specifically, it calculates the mixed spectra by taking the measured MI spectra and subtracting X*Ol spectra, where X is the mixing proportions
+    This function unmixes glass and host spectra, and fits the best fit proportion where the host peak and trough disapears. Specifically, it calculates the mixed spectra by taking the measured MI spectra and subtracting X*Ol spectra, where X is the mixing proportions
 
     Parameters
     -----------
-    smoothed_Ol_y: np.array
-        y coordinates of olivine around peak region (from the function smooth_and_trim_around_olivine)
+    smoothed_host_y: np.array
+        y coordinates of host around peak region (from the function smooth_and_trim_around_host)
 
     smoothed_MI_y: np.array
-        y coordinates of melt inclusion around peak region (from the function smooth_and_trim_around_olivine)
+        y coordinates of melt inclusion around peak region (from the function smooth_and_trim_around_host)
 
     x_new: np.array
-        x coordinates from smoothed Ol and MI curves (from the function smooth_and_trim_around_olivine)
+        x coordinates from smoothed Ol and MI curves (from the function smooth_and_trim_around_host)
 
-    Ol_Spectra: np.array
-        Full olivine spectra, not trimmed or smoothed (from the function get_data)
+    Host_Spectra: np.array
+        Full host spectra, not trimmed or smoothed (from the function get_data)
 
     MI_Spectra: np.array
         Full MI spectra, not trimmed or smoothed  (from the function get_data)
 
-    peak_pos_Ol: list
-        Peak positions (x) of Olivine peaks (from the function smooth_and_trim_around_olivine)
+    peak_pos_Host: list
+        Peak positions (x) of Olivine peaks (from the function smooth_and_trim_around_host)
 
     trough_x: float, int
-        Peak position (x) of Olivine trough (from the function smooth_and_trim_around_olivine)
+        Peak position (x) of Olivine trough (from the function smooth_and_trim_around_host)
 
     x_min:  float or int
         Minimum mixing proportion allowed
 
     x_max:  float or int
         Maximum mixing proportion allowed
 
@@ -345,19 +345,19 @@
         averages +- 1 width either side of the peak and troughs when doing assesment and regression
 
 
 
     Returns:
     -----------
     MI_Mix_Best: np.array
-        Spectra of best-fit unmixed spectra (e.g. where olivine peak and trough the smallest)
+        Spectra of best-fit unmixed spectra (e.g. where host peak and trough the smallest)
     ideal_mix: float
         Best fit mixing proportion (i.e. X)
     Dist: float
-        Vertical distance between the olivine peak and trough (in intensity units)
+        Vertical distance between the host peak and trough (in intensity units)
     MI_Mix: np.array
         Umixed spectra for each of the N_steps
     X: np.array
         X coordinates of unmixed spectra (along with MI_Mix and X allows plots of unmixing)
 
     if plot_figure is True, also returns a plot showing the unmixing process
 
@@ -372,19 +372,19 @@
 
         # print('Working on mixing proportion:')
         # print(X[i])
 
         # Geochemistry style mix
         #MI_Mix[i, :]=(smoothed_MI_y- smoothed_Ol_y*X[i])/(1-X[i])
         # True subtraction mix from Smith 2021
-        MI_Mix[i, :]=smoothed_MI_y- smoothed_Ol_y*X[i]
+        MI_Mix[i, :]=smoothed_MI_y- smoothed_host_y*X[i]
 
         Dist[i]=trough_or_peak_higher(spectra_x=x_new,
                           spectra_y=MI_Mix[i, :],
-                          peak_pos_x=peak_pos_Ol,
+                          peak_pos_x=peak_pos_Host,
                           trough_pos_x=trough_x,
                           trough_pos_y=trough_y,
                           av_width=2)
         #print(MI_Mix)
 
     mix_spline = interp1d(X, Dist, kind='cubic')
 
@@ -395,84 +395,84 @@
 
     # Closest point to zero
     val=np.argmax(y_cub_mix>0)
     ideal_mix=x_new_mix[val]
     #print('best fit proportion')
     #print(ideal_mix)
 
-    MI_Mix_Best_syn=(smoothed_MI_y-smoothed_Ol_y*ideal_mix)/(1-ideal_mix)
-    MI_Mix_Best=(MI_spectra- Ol_spectra*ideal_mix)/(1-ideal_mix)
+    MI_Mix_Best_syn=(smoothed_MI_y-smoothed_host_y*ideal_mix)/(1-ideal_mix)
+    MI_Mix_Best=(MI_spectra- Host_spectra*ideal_mix)/(1-ideal_mix)
 
     if plot_figure is True:
 
         fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(12,10))
         fig.suptitle('file='+filename)
         for i in range(0, N_steps):
             ax1.plot(x_new, MI_Mix[i, :], '-k')
-            ax1.plot([peak_pos_Ol[0], peak_pos_Ol[0]], [0.7, 1.5], '-', color='yellow')
-            ax1.plot([peak_pos_Ol[1], peak_pos_Ol[1]], [0.7, 1.5], '-', color='yellow')
+            ax1.plot([peak_pos_Host[0], peak_pos_Host[0]], [0.7, 1.5], '-', color='yellow')
+            ax1.plot([peak_pos_Host[1], peak_pos_Host[1]], [0.7, 1.5], '-', color='yellow')
             ax1.plot([trough_x, trough_x], [0.7, 1.5], '-', color='cyan')
 
 
         ax1.set_xlabel('Wavenumber (cm$^{-1}$')
         ax1.set_ylabel('Intensity ratioed to 1st coordinate')
 
         ax2.plot(X, Dist, 'or')
         ax2.plot([min(X), max(X)], [0, 0], '-k')
         ax2.set_xlabel('Mixing Proportion of Olivine')
         ax2.set_ylabel('Vert. Dist. between peaks reg & troughs')
         ax2.plot(x_new_mix, y_cub_mix, '-r')
 
         ax3.plot(MI_spectra[:, 0],MI_Mix_Best[:, 1], '-k')
         ax3.plot(MI_spectra[:, 0],MI_spectra[:, 1], '-', color='salmon')
-        ax3.plot(Ol_spectra[:, 0],Ol_spectra[:, 1], '-', color='g')
+        ax3.plot(Host_spectra[:, 0],Host_spectra[:, 1], '-', color='g')
         ax3.set_xlim([775, 900])
 
 
         ax4.plot(MI_spectra[:, 0],MI_Mix_Best[:, 1], '-k', label='Umixed glass')
         ax4.plot(MI_spectra[:, 0],MI_spectra[:, 1],  '-', color='salmon',label='Measured MI')
-        ax4.plot(Ol_spectra[:, 0],Ol_spectra[:, 1], '-', color='g', label='Measured Ol')
+        ax4.plot(Host_spectra[:, 0],Host_spectra[:, 1], '-', color='g', label='Measured Host')
         ax4.legend()
         ax3.set_xlabel('Wavenumber (cm$^{-1}$')
         ax4.set_xlabel('Wavenumber (cm$^{-1}$')
         ax3.set_ylabel('Intensity')
 
         path3=path+'/'+'H2O_Silicate_images'
 
         if os.path.exists(path3):
             out='path exists'
         else:
             os.makedirs(path+'/'+ 'H2O_Silicate_images', exist_ok=False)
 
 
         file=filename
-        fig.savefig(path3+'/'+'Ol_Glass_Umixing_{}.png'.format(filename), dpi=dpi)
+        fig.savefig(path3+'/'+'Host_Glass_Umixing_{}.png'.format(filename), dpi=dpi)
 
     return MI_Mix_Best, ideal_mix, Dist, MI_Mix, X
 
 
 ## Fitting silica and water peak areas
-def check_if_spectra_negative(*, path, filename, Spectra=None, peak_pos_Ol=None, tie_x_cord=2000,
+def check_if_spectra_negative(*, path, filename, Spectra=None, peak_pos_Host=None, tie_x_cord=2000,
 override=False, flip=False, plot_figure=True, dpi=200):
     """
     This function checks if the unmixed specta is negative, based on two tie points.
-    The first tie point is the mean y coordinate of the peak position of olivine +5 wavenumbers,
+    The first tie point is the mean y coordinate of the peak position of host +5 wavenumbers,
     and the second tie point (tie_x_cord) is an optional input. If the specta is inverte, this function inverts it.
 
 
     Parameters
     -----------
     Spectra: np.array
         Spectra from the function make_evaluate_mixed_spectra
 
-    peak_pos_Ol: list
-        Olivine peak positions from the function find_olivine_peak_trough_pos
+    peak_pos_Host: list
+        Host peak positions from the function find_host_peak_trough_pos
 
     tie_x_cord: int or float
-        X cooordinate to use as a tie point to ask whether the olivine peak's y coordinate is higher or lower than this.
+        X cooordinate to use as a tie point to ask whether the host peak's y coordinate is higher or lower than this.
 
     override: bool
         if False, function flips the spectra if its upsideown,
         if True, you can use the input 'flip' to manually flip the spectra
     flip: bool
         If override is true, flip=False leaves spectra how it is, True flips the y axis.
 
@@ -487,17 +487,17 @@
     Spectra=Spectra.copy()
 
     val=np.argmax(Spectra[:, 0]>tie_x_cord)
 
     tie_y_cord=Spectra[val, 1]
 
     mean_around_peak=np.nanmean(
-        Spectra[:, 1][(Spectra[:, 0]>peak_pos_Ol[0])
+        Spectra[:, 1][(Spectra[:, 0]>peak_pos_Host[0])
         &
-        (Spectra[:, 0]<peak_pos_Ol[0]+5)]
+        (Spectra[:, 0]<peak_pos_Host[0]+5)]
             )
 
 
 
     x=Spectra[:, 0]
     y_init=Spectra[:, 1]
 
@@ -509,39 +509,39 @@
         ax2.set_title('Returned Spectra')
         ax1.set_xlabel('Wavenumber (cm$^{-1}$)')
         ax2.set_xlabel('Wavenumber (cm$^{-1}$)')
         ax1.set_ylabel('Intensity')
         ax2.set_ylabel('Intensity')
         ax1.plot(x, y_init, '-r')
         ax1.plot(tie_x_cord, tie_y_cord, '*k',  ms=10,  label='tie_cord')
-        ax1.plot(peak_pos_Ol[0], mean_around_peak, '*k', mfc='yellow', ms=15,label='Av Ol coordinate')
+        ax1.plot(peak_pos_Host[0], mean_around_peak, '*k', mfc='yellow', ms=15,label='Av host coordinate')
 
     if override is False:
         if mean_around_peak>tie_y_cord:
             y=y_init
 
 
             #print('peak positive, spectra left as is')
 
             if plot_figure is True:
 
                 ax2.plot(x, y, '-r')
                 ax2.plot(tie_x_cord, tie_y_cord, '*k',  ms=10,  label='tie_cord')
-                ax2.plot(peak_pos_Ol[0], mean_around_peak, '*k', mfc='yellow', ms=15, label='Av Ol coordinate')
+                ax2.plot(peak_pos_Host[0], mean_around_peak, '*k', mfc='yellow', ms=15, label='Av Ol coordinate')
                 ax2.legend()
 
         else:
             #print('Peak negative, spectra inverted')
 
             y=-Spectra[:, 1]
             Spectra=np.column_stack((x, y))
             if plot_figure is True:
                 ax2.plot(x, y, '-r')
                 ax2.plot(tie_x_cord, -tie_y_cord, '*k', ms=10, label='tie_cord')
-                ax2.plot(peak_pos_Ol[0], -mean_around_peak, '*k', mfc='yellow', ms=15, label='Av Ol coordinate')
+                ax2.plot(peak_pos_Host[0], -mean_around_peak, '*k', mfc='yellow', ms=15, label='Av Ol coordinate')
 
                 ax2.legend()
 
 
 
 
 
@@ -951,15 +951,16 @@
 
 
 
 
 
 
 
-    df_sil=pd.DataFrame(data={'Silicate_LHS_Back1':lower_range_sil[0],
+    df_sil=pd.DataFrame(data={
+    'Silicate_LHS_Back1':lower_range_sil[0],
                           'Silicate_LHS_Back2':lower_range_sil[1],
                           'Silicate_RHS_Back1':upper_range_sil[0],
                           'Silicate_RHS_Back2':upper_range_sil[1],
                           'Silicate_N_Poly': N_poly_sil,
                           'Silicate_Trapezoid_Area':area_trap,
                           'Silicate_Simpson_Area': area_simps,
                           'LW_Silicate_Trapezoid_Area':area_trap_LW,
@@ -1016,15 +1017,15 @@
         File name
     Spectra : numpy.ndarray, optional
         2D array representing the spectrum data
     config1 : object
         Configuration object for water peak and background positions. Default parameters stored in water_bck_pos, user can tweak.
         Parameters that need tweaking:
 
-        fit_water: str 'poly', 
+        fit_water: str 'poly',
         N_poly_water: str, degree of polynomial to fit to background
         lower_bck_water: [float, float], background position to left of water peak
         upper_bck_water: [float, float], background position to right of water peak
 
     exclude_range1_water : list of float, optional
         List of two numbers representing the start and end of a range of wavenumbers to be excluded from the spectrum
     exclude_range2_water : list of float, optional
@@ -1200,71 +1201,82 @@
 
 
 
 
 
 
 
-    df_water=pd.DataFrame(data={'Water_LHS_Back1':lower_range_water[0],
+    df_water=pd.DataFrame(data={'Water Filename': filename,
+    'Water_LHS_Back1':lower_range_water[0],
                           'Water_LHS_Back2':lower_range_water[1],
                           'Water_RHS_Back1':upper_range_water[0],
                           'Water_RHS_Back2':upper_range_water[1],
                           'Water_N_Poly': N_poly_water,
                           'Water_Trapezoid_Area':area_trap,
                           'Water_Simpson_Area': area_simps}, index=[0])
     return df_water
 
 
     ## Stitching results together nicely for output.
 
 
-def stitch_dataframes_together(df_sil, df_water, MI_file, Ol_file=None):
+def stitch_dataframes_together(df_sil, df_water,  MI_file, Host_file=None, save_csv=False, path=False):
     """ This function stitches together results from the fit_area function for silicate and water peaks and returns a DataFrame with the combined results. The DataFrame includes peak areas and background positions for both silicate and water peaks, and adds columns for the ratios of water to silicate areas.
 
     Parameters
     -----------
 
     df_sil: pd.DataFrame
         DataFrame of peak area and background positions from fit_area_for_silicate_region()
 
     df_water: pd.DataFrame
         DataFrame of peak area and background positions from fit_area_for_water_region()
 
     MI_file: str
         MI file name
 
-    Ol_file: str, optional
+    Host_file: str, optional
         Olivine file name
 
 
     Returns
     -----------
     pd.DataFrame
         DataFrame with columns for MI filename, HW:LW_Trapezoid, HW:LW_Simpson, Water_Trapezoid_Area,
         Water_Simpson_Area, Silicate_Trapezoid_Area, and Silicate_Simpson_Area.
-        If Ol_file is provided,
-        the DataFrame will also include a column for Olivine filename.
+        If Host_file is provided,
+        the DataFrame will also include a column for Host filename.
 
 
     """
     Combo_Area=pd.concat([df_sil, df_water], axis=1)
-    if Ol_file is not None:
-        Combo_Area.insert(0, 'Olivine filename', Ol_file)
+    if Host_file is not None:
+        Combo_Area.insert(0, 'Host filename', Host_file)
     Combo_Area.insert(1, 'MI filename', MI_file)
     Combo_Area.insert(2, 'HW:LW_Trapezoid',
                       Combo_Area['Water_Trapezoid_Area']/Combo_Area['HW_Silicate_Trapezoid_Area'])
     Combo_Area.insert(3, 'HW:LW_Simpson',
                       Combo_Area['Water_Simpson_Area']/Combo_Area['HW_Silicate_Simpson_Area'])
 
-    if Ol_file is not None:
-        cols_to_move=['Olivine filename', 'MI filename', 'HW:LW_Trapezoid', 'HW:LW_Simpson',
+    if Host_file is not None:
+        cols_to_move=['Host filename', 'MI filename', 'HW:LW_Trapezoid', 'HW:LW_Simpson',
      'Water_Trapezoid_Area', 'Water_Simpson_Area', 'Silicate_Trapezoid_Area', 'Silicate_Simpson_Area']
     else:
         cols_to_move=['MI filename', 'HW:LW_Trapezoid', 'HW:LW_Simpson',
      'Water_Trapezoid_Area', 'Water_Simpson_Area', 'Silicate_Trapezoid_Area', 'Silicate_Simpson_Area']
 
 
 
     Combo_Area = Combo_Area[cols_to_move + [
         col for col in Combo_Area.columns if col not in cols_to_move]]
 
+    if save_csv is True:
+        if path is False:
+            raise TypeError('You need to enter a path to say where to save the CSV')
+        filename_with_ext=Combo_Area['Water Filename'][0]
+        filename, extension = os.path.splitext(filename_with_ext)
+        filename = filename.split('.')[0]
+        filename2=filename+ '_combo_fit.csv'
+        full_path = os.path.join(path, filename2)
+        Combo_Area.to_csv(full_path)
+
     return Combo_Area
```

### Comparing `DiadFit-0.0.69/src/DiadFit/Highrho_polyfit_data.pkl` & `DiadFit-0.0.70/src/DiadFit/Highrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/Lowrho_polyfit_data.pkl` & `DiadFit-0.0.70/src/DiadFit/Lowrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/Mediumrho_polyfit_data.pkl` & `DiadFit-0.0.70/src/DiadFit/Mediumrho_polyfit_data.pkl`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/Psensor.py` & `DiadFit-0.0.70/src/DiadFit/Psensor.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/__init__.py` & `DiadFit-0.0.70/src/DiadFit/__init__.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/argon_lines.py` & `DiadFit-0.0.70/src/DiadFit/argon_lines.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/cosmicray_filter.py` & `DiadFit-0.0.70/src/DiadFit/cosmicray_filter.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/densimeter_fitting.py` & `DiadFit-0.0.70/src/DiadFit/densimeter_fitting.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/densimeters.py` & `DiadFit-0.0.70/src/DiadFit/densimeters.py`

 * *Files 2% similar despite different names*

```diff
@@ -48,28 +48,30 @@
     MedD_SC=-47.2609 + 0.4596005*Split+ 0.0374189*(Split-103.733)**2-0.0187173*(Split-103.733)**3
     HighD_SC=-42.52782 + 0.4144277*Split- 0.1514429*(Split-104.566)**2
 
     if isinstance(Split, pd.Series) or isinstance(Split, np.ndarray):
 
         df=pd.DataFrame(data={'Preferred D': 0,
         'in range': 'Y',
+        'Corrected_Splitting': Split,
                                 'Notes': 'not in range',
                                 'LowD_RT': LowD_RT,
                                 'HighD_RT': HighD_RT,
                                 'LowD_SC': LowD_SC,
                                 'MedD_SC': MedD_SC,
                                 'HighD_SC': HighD_SC,
                                 'Temperature': temp,
                                 'Splitting': Split,
 
                                 })
 
     else:
         df=pd.DataFrame(data={'Preferred D': 0,
         'in range': 'Y',
+        'Corrected_Splitting': Split,
                                 'Notes': 'not in range',
                                 'LowD_RT': LowD_RT,
                                 'HighD_RT': HighD_RT,
                                 'LowD_SC': LowD_SC,
                                 'MedD_SC': MedD_SC,
                                 'HighD_SC': HighD_SC,
                                 'Temperature': temp,
@@ -270,29 +272,28 @@
 
 
     # Calculate the total uncertainty in the density estimation
     total_uncertainty = np.sqrt(uncertainty_split ** 2 + uncertainty_from_dens ** 2)
 
 
     df=pd.DataFrame(data={
-        str_d+'_Corrected_Splitting': new_x,
+
         str_d+'_Density': preferred_values,
         str_d + '_Density_σ': total_uncertainty,
         str_d+'_Density+1σ': preferred_values-total_uncertainty,
         str_d+'_Density-1σ': preferred_values+total_uncertainty,
         str_d+'_Density_σ_dens': (uncertainty_from_dens),
         str_d+'_Density_σ_split': (uncertainty_split),
 
     })
 
     return df
+## Function for if we dont have a densimeter yet
 
-
-## UCBerkeley densimeters
-def calculate_density_ucb(*, df_combo, Ne_pickle_str='polyfit_data.pkl',  temp='SupCrit', split_err=0, CI_split=0.67, CI_neon=0.67):
+def calculate_errors_no_densimeter(*, df_combo, Ne_pickle_str='polyfit_data.pkl',  temp='SupCrit', split_err=0, CI_split=0.67, CI_neon=0.67):
     """ This function converts Diad Splitting into CO$_2$ density using densimeters of UCB
 
     Parameters
     -------------
     df_combo: pandas DataFrame
         data frame of peak fitting information
 
@@ -316,20 +317,69 @@
     """
     time=df_combo['sec since midnight']
     Ne_corr=calculate_Ne_corr_std_err_values(pickle_str=Ne_pickle_str,
     new_x=time, CI=CI_neon)
 
     # Lets calculate  corrected splitting and the error on this.
     Split=df_combo['Splitting']*Ne_corr['preferred_values']
-
+    df_combo['Corrected_Splitting']=Split
     Split_err, pk_err=propagate_error_split_neon_peakfit(Ne_corr=Ne_corr, df_fits=df_combo)
     df_combo['Corrected_Splitting_σ']=Split_err
     df_combo['Corrected_Splitting_σ_Ne']=(Ne_corr['upper_values']*df_combo['Splitting']-Ne_corr['lower_values']*df_combo['Splitting'])/2
     df_combo['Corrected_Splitting_σ_peak_fit']=pk_err
 
+    cols_to_move = ['filename',
+     'Corrected_Splitting', 'Corrected_Splitting_σ',
+    'Corrected_Splitting_σ_Ne', 'Corrected_Splitting_σ_peak_fit']
+    df_merge = df_combo[cols_to_move + [
+        col for col in df_combo.columns if col not in cols_to_move]]
+
+    return df_combo
+
+
+## UCBerkeley densimeters
+def calculate_density_ucb(*, df_combo, Ne_pickle_str='polyfit_data.pkl',  temp='SupCrit', split_err=0, CI_split=0.67, CI_neon=0.67):
+    """ This function converts Diad Splitting into CO$_2$ density using densimeters of UCB
+
+    Parameters
+    -------------
+    df_combo_c: pandas DataFrame
+        data frame of peak fitting information
+
+    Ne_corr: pandas DataFrame
+        dataframe of Ne correction factors
+
+    temp: str
+        'SupCrit' if measurements done at 37C
+        'RoomT' if measurements done at 24C - Not supported at Berkeley.
+
+    Split: int, float, pd.Series, np.array
+
+    Returns
+    --------------
+    pd.DataFrame
+        Prefered Density (based on different equatoins being merged), and intermediate calculations
+
+
+
+
+    """
+    df_combo_c=df_combo.copy()
+    time=df_combo_c['sec since midnight']
+    Ne_corr=calculate_Ne_corr_std_err_values(pickle_str=Ne_pickle_str,
+    new_x=time, CI=CI_neon)
+
+    # Lets calculate  corrected splitting and the error on this.
+    Split=df_combo_c['Splitting']*Ne_corr['preferred_values']
+
+    Split_err, pk_err=propagate_error_split_neon_peakfit(Ne_corr=Ne_corr, df_fits=df_combo_c)
+    df_combo_c['Corrected_Splitting_σ']=Split_err
+    df_combo_c['Corrected_Splitting_σ_Ne']=(Ne_corr['upper_values']*df_combo_c['Splitting']-Ne_corr['lower_values']*df_combo_c['Splitting'])/2
+    df_combo_c['Corrected_Splitting_σ_peak_fit']=pk_err
+
     if temp=='RoomT':
         raise TypeError('Sorry, no UC Berkeley calibration at 24C, please enter temp=SupCrit')
     if isinstance(Split, float) or isinstance(Split, int):
         Split=pd.Series(Split)
     # #if temp is "RoomT":
     DiadFit_dir=Path(__file__).parent
 
@@ -359,14 +409,17 @@
     medD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
     pickle_str=pickle_str_medr,  CI_neon=CI_neon, CI_split=CI_split, str_d='MedD')
     highD_error=calculate_Densimeter_std_err_values(corrected_split=Split, corrected_split_err=Split_err,
     pickle_str=pickle_str_highr,   CI_neon=CI_neon, CI_split=CI_split,  str_d='HighD')
     MedD_SC = pd.Series(medrho_model(Split), index=Split.index)
     HighD_SC = pd.Series(highrho_model(Split), index=Split.index)
 
+    print('testing')
+    #print(df_combo_c['Corrected_Splitting'])
+
 
 
 
     df=pd.DataFrame(data={'Preferred D': 0,
     'Corrected_Splitting': Split,
     'Preferred D_σ': 0,
     'Preferred D_σ_split': 0,
@@ -489,15 +542,15 @@
     df.loc[roomT&Upper_Cal_RT, 'in range']='N'
 
     df.loc[SupCrit&Upper_Cal_SC, 'Preferred D'] = HighD_SC
     df.loc[SupCrit&Upper_Cal_SC, 'Notes']='Above upper Cali Limit'
     df.loc[SupCrit&Upper_Cal_SC, 'in range']='N'
 
 
-    df_merge1=pd.concat([df_combo, Ne_corr], axis=1).reset_index(drop=True)
+    df_merge1=pd.concat([df_combo_c, Ne_corr], axis=1).reset_index(drop=True)
     df_merge=pd.concat([df, df_merge1], axis=1).reset_index(drop=True)
 
     df_merge = df_merge.rename(columns={'Preferred D': 'Density g/cm3'})
     df_merge = df_merge.rename(columns={'Preferred D_σ': 'σ Density g/cm3'})
     df_merge = df_merge.rename(columns={'Preferred D_σ_split': 'σ Density g/cm3 (from Ne+peakfit)'})
     df_merge = df_merge.rename(columns={'Preferred D_σ_dens': 'σ Density g/cm3 (from densimeter)'})
     df_merge = df_merge.rename(columns={'filename_x': 'filename'})
```

### Comparing `DiadFit-0.0.69/src/DiadFit/density_depth_crustal_profiles.py` & `DiadFit-0.0.70/src/DiadFit/density_depth_crustal_profiles.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/diads.py` & `DiadFit-0.0.70/src/DiadFit/diads.py`

 * *Files 0% similar despite different names*

```diff
@@ -3233,7111 +3233,7120 @@
 0000ca00: 7561 6c20 706c 6f74 0a20 2020 2079 6461  ual plot.    yda
 0000ca10: 745f 696e 7261 6e67 653a 206e 702e 6172  t_inrange: np.ar
 0000ca20: 7261 7920 6f66 2064 6174 6120 7769 7468  ray of data with
 0000ca30: 696e 2027 7370 616e 270a 2020 2020 7864  in 'span'.    xd
 0000ca40: 6174 5f69 6e72 616e 6765 3a6e 702e 6172  at_inrange:np.ar
 0000ca50: 7261 7920 6f66 2064 6174 6120 7769 7468  ray of data with
 0000ca60: 696e 2027 7370 616e 270a 0a0a 0a20 2020  in 'span'....   
-0000ca70: 2022 2222 0a0a 0a20 2020 2023 2043 616c   """...    # Cal
-0000ca80: 6375 6c61 7465 2074 6865 2061 6d70 6c69  culate the ampli
-0000ca90: 7475 6465 2066 726f 6d20 7468 6520 7369  tude from the si
-0000caa0: 676d 6120 616e 6420 7468 6520 7072 6f6d  gma and the prom
-0000cab0: 696e 656e 6365 0a20 2020 2063 616c 635f  inence.    calc_
-0000cac0: 6469 6164 5f61 6d70 6c69 7475 6465 3d28  diad_amplitude=(
-0000cad0: 2863 6f6e 6669 6731 2e64 6961 645f 7369  (config1.diad_si
-0000cae0: 676d 6129 2a28 636f 6e66 6967 312e 6469  gma)*(config1.di
-0000caf0: 6164 5f70 726f 6d29 292f 302e 3339 3339  ad_prom))/0.3939
-0000cb00: 0a20 2020 2063 616c 635f 4842 5f61 6d70  .    calc_HB_amp
-0000cb10: 6c69 7475 6465 3d28 2863 6f6e 6669 6731  litude=((config1
-0000cb20: 2e64 6961 645f 7369 676d 6129 2a28 636f  .diad_sigma)*(co
-0000cb30: 6e66 6967 312e 4842 5f70 726f 6d29 292f  nfig1.HB_prom))/
-0000cb40: 302e 3339 3339 0a20 2020 2069 6620 6469  0.3939.    if di
-0000cb50: 6164 3220 6973 2054 7275 6520 616e 6420  ad2 is True and 
-0000cb60: 6669 745f 7065 616b 733d 3d33 3a0a 2020  fit_peaks==3:.  
-0000cb70: 2020 2020 2020 6361 6c63 5f43 3133 5f61        calc_C13_a
-0000cb80: 6d70 6c69 7475 6465 3d28 302e 352a 2863  mplitude=(0.5*(c
-0000cb90: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
-0000cba0: 6129 2a28 636f 6e66 6967 312e 4331 335f  a)*(config1.C13_
-0000cbb0: 7072 6f6d 2929 2f30 2e33 3933 390a 2020  prom))/0.3939.  
-0000cbc0: 2020 2320 4765 7473 206f 7665 7272 6964    # Gets overrid
-0000cbd0: 6465 6e20 6966 2079 6f75 2068 6176 6520  den if you have 
-0000cbe0: 7472 6967 6765 7265 6420 616e 7920 6f66  triggered any of
-0000cbf0: 2074 6865 2077 6172 6e69 6e67 730a 2020   the warnings.  
-0000cc00: 2020 7265 6669 743d 4661 6c73 650a 2020    refit=False.  
-0000cc10: 2020 7265 6669 745f 7061 7261 6d3d 2746    refit_param='F
-0000cc20: 6c61 6767 6564 2057 6172 6e69 6e67 733a  lagged Warnings:
-0000cc30: 270a 2020 2020 7370 6563 5f72 6573 3d6e  '.    spec_res=n
-0000cc40: 702e 6162 7328 7864 6174 5b31 5d2d 7864  p.abs(xdat[1]-xd
-0000cc50: 6174 5b30 5d29 0a0a 0a0a 0a0a 0a20 2020  at[0]).......   
-0000cc60: 2069 6e69 7469 616c 5f67 7565 7373 3d44   initial_guess=D
-0000cc70: 6961 645f 706f 730a 2020 2020 4842 5f69  iad_pos.    HB_i
-0000cc80: 6e69 7469 616c 5f67 7565 7373 3d48 425f  nitial_guess=HB_
-0000cc90: 706f 730a 2020 2020 4331 335f 696e 6974  pos.    C13_init
-0000cca0: 6961 6c5f 6775 6573 733d 4331 335f 706f  ial_guess=C13_po
-0000ccb0: 730a 0a0a 0a0a 2020 2020 6966 2063 6f6e  s.....    if con
-0000ccc0: 6669 6731 2e6d 6f64 656c 5f6e 616d 653d  fig1.model_name=
-0000ccd0: 3d22 566f 6967 744d 6f64 656c 223a 0a20  ="VoigtModel":. 
-0000cce0: 2020 2020 2020 206d 6f64 656c 5f69 6e69         model_ini
-0000ccf0: 203d 2056 6f69 6774 4d6f 6465 6c28 2923   = VoigtModel()#
-0000cd00: 2b20 436f 6e73 7461 6e74 4d6f 6465 6c28  + ConstantModel(
-0000cd10: 290a 2020 2020 6966 2063 6f6e 6669 6731  ).    if config1
-0000cd20: 2e6d 6f64 656c 5f6e 616d 653d 3d22 5073  .model_name=="Ps
-0000cd30: 6575 646f 566f 6967 744d 6f64 656c 223a  eudoVoigtModel":
-0000cd40: 0a20 2020 2020 2020 206d 6f64 656c 5f69  .        model_i
-0000cd50: 6e69 203d 2050 7365 7564 6f56 6f69 6774  ni = PseudoVoigt
-0000cd60: 4d6f 6465 6c28 2923 2b20 436f 6e73 7461  Model()#+ Consta
-0000cd70: 6e74 4d6f 6465 6c28 290a 0a20 2020 2023  ntModel()..    #
-0000cd80: 2043 7265 6174 6520 696e 6974 6961 6c20   Create initial 
-0000cd90: 7065 616b 2070 6172 616d 730a 2020 2020  peak params.    
-0000cda0: 2320 5365 7420 7065 616b 2070 6f73 6974  # Set peak posit
-0000cdb0: 696f 6e20 746f 2032 2073 7065 6374 7261  ion to 2 spectra
-0000cdc0: 6c20 7265 7320 756e 6974 7320 6569 7468  l res units eith
-0000cdd0: 6572 2073 6964 6520 6f66 2074 6865 2069  er side of the i
-0000cde0: 6e69 7469 616c 2067 7565 7373 206d 6164  nitial guess mad
-0000cdf0: 6520 6162 6f76 650a 2020 2020 7061 7261  e above.    para
-0000ce00: 6d73 5f69 6e69 203d 206d 6f64 656c 5f69  ms_ini = model_i
-0000ce10: 6e69 2e6d 616b 655f 7061 7261 6d73 2863  ni.make_params(c
-0000ce20: 656e 7465 723d 696e 6974 6961 6c5f 6775  enter=initial_gu
-0000ce30: 6573 732c 206d 6178 3d69 6e69 7469 616c  ess, max=initial
-0000ce40: 5f67 7565 7373 2b73 7065 635f 7265 732a  _guess+spec_res*
-0000ce50: 352c 206d 696e 3d69 6e69 7469 616c 5f67  5, min=initial_g
-0000ce60: 7565 7373 2d73 7065 635f 7265 732a 3529  uess-spec_res*5)
-0000ce70: 0a20 2020 2023 2053 6574 2074 6865 2061  .    # Set the a
-0000ce80: 6d70 6c69 7475 6465 2074 6f20 7769 7468  mplitude to with
-0000ce90: 696e 2058 302e 3120 6f72 2031 3058 206f  in X0.1 or 10X o
-0000cea0: 6620 7468 6520 6775 6573 7365 6420 616d  f the guessed am
-0000ceb0: 706c 6974 7564 650a 2020 2020 7061 7261  plitude.    para
-0000cec0: 6d73 5f69 6e69 5b27 616d 706c 6974 7564  ms_ini['amplitud
-0000ced0: 6527 5d2e 7365 7428 6361 6c63 5f64 6961  e'].set(calc_dia
-0000cee0: 645f 616d 706c 6974 7564 652c 206d 696e  d_amplitude, min
-0000cef0: 3d63 616c 635f 6469 6164 5f61 6d70 6c69  =calc_diad_ampli
-0000cf00: 7475 6465 2f35 2c0a 2020 2020 2020 2020  tude/5,.        
-0000cf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cf20: 2020 2020 2020 2020 206d 6178 3d63 616c           max=cal
-0000cf30: 635f 6469 6164 5f61 6d70 6c69 7475 6465  c_diad_amplitude
-0000cf40: 2a35 290a 2020 2020 2320 5365 7420 7369  *5).    # Set si
-0000cf50: 676d 6120 746f 2062 6520 7468 6520 656e  gma to be the en
-0000cf60: 7465 7265 6420 7661 6c75 652c 2074 6865  tered value, the
-0000cf70: 6e0a 2020 2020 7061 7261 6d73 5f69 6e69  n.    params_ini
-0000cf80: 5b27 7369 676d 6127 5d2e 7365 7428 636f  ['sigma'].set(co
-0000cf90: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
-0000cfa0: 2c20 6d69 6e3d 636f 6e66 6967 312e 6469  , min=config1.di
-0000cfb0: 6164 5f73 6967 6d61 2a63 6f6e 6669 6731  ad_sigma*config1
-0000cfc0: 2e64 6961 645f 7369 676d 615f 6d69 6e5f  .diad_sigma_min_
-0000cfd0: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
-0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cff0: 2020 2020 2020 2020 2020 206d 6178 3d63             max=c
-0000d000: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
-0000d010: 612a 636f 6e66 6967 312e 6469 6164 5f73  a*config1.diad_s
-0000d020: 6967 6d61 5f6d 6178 5f61 6c6c 6f77 616e  igma_max_allowan
-0000d030: 6365 290a 0a20 2020 2023 204e 6f77 206c  ce)..    # Now l
-0000d040: 6574 7320 7477 6561 6b20 616e 2069 6e69  ets tweak an ini
-0000d050: 7469 616c 206d 6f64 656c 2077 6974 6820  tial model with 
-0000d060: 6a75 7374 2031 2070 6561 6b2c 2074 6869  just 1 peak, thi
-0000d070: 7320 7265 616c 6c79 2068 656c 7073 2077  s really helps w
-0000d080: 6974 6820 7468 6520 6669 740a 2020 2020  ith the fit.    
-0000d090: 696e 6974 5f69 6e69 203d 206d 6f64 656c  init_ini = model
-0000d0a0: 5f69 6e69 2e65 7661 6c28 7061 7261 6d73  _ini.eval(params
-0000d0b0: 5f69 6e69 2c20 783d 7864 6174 290a 2020  _ini, x=xdat).  
-0000d0c0: 2020 7265 7375 6c74 5f69 6e69 2020 3d20    result_ini  = 
-0000d0d0: 6d6f 6465 6c5f 696e 692e 6669 7428 7964  model_ini.fit(yd
-0000d0e0: 6174 2c20 7061 7261 6d73 5f69 6e69 2c20  at, params_ini, 
-0000d0f0: 783d 7864 6174 290a 2020 2020 636f 6d70  x=xdat).    comp
-0000d100: 735f 696e 6920 203d 2072 6573 756c 745f  s_ini  = result_
-0000d110: 696e 692e 6576 616c 5f63 6f6d 706f 6e65  ini.eval_compone
-0000d120: 6e74 7328 290a 2020 2020 4365 6e74 6572  nts().    Center
-0000d130: 5f69 6e69 3d72 6573 756c 745f 696e 692e  _ini=result_ini.
-0000d140: 7061 7261 6d73 2e67 6574 2827 6365 6e74  params.get('cent
-0000d150: 6572 2729 0a20 2020 2041 6d70 6c69 7475  er').    Amplitu
-0000d160: 6465 5f69 6e69 3d72 6573 756c 745f 696e  de_ini=result_in
-0000d170: 692e 7061 7261 6d73 2e67 6574 2827 616d  i.params.get('am
-0000d180: 706c 6974 7564 6527 290a 2020 2020 7369  plitude').    si
-0000d190: 676d 615f 696e 693d 7265 7375 6c74 5f69  gma_ini=result_i
-0000d1a0: 6e69 2e70 6172 616d 732e 6765 7428 2773  ni.params.get('s
-0000d1b0: 6967 6d61 2729 0a20 2020 2066 7768 6d5f  igma').    fwhm_
-0000d1c0: 696e 693d 7265 7375 6c74 5f69 6e69 2e70  ini=result_ini.p
-0000d1d0: 6172 616d 732e 6765 7428 2766 7768 6d27  arams.get('fwhm'
-0000d1e0: 290a 0a0a 0a20 2020 2023 2046 6f72 2072  )....    # For r
-0000d1f0: 656c 6174 6976 656c 7920 7765 616b 2070  elatively weak p
-0000d200: 6561 6b73 2c20 796f 7520 776f 6e74 2077  eaks, you wont w
-0000d210: 616e 7420 6120 6761 7573 7369 616e 2062  ant a gaussian b
-0000d220: 6163 6b67 726f 756e 640a 2020 2020 6966  ackground.    if
-0000d230: 2063 6f6e 6669 6731 2e66 6974 5f67 6175   config1.fit_gau
-0000d240: 7373 2069 7320 4661 6c73 653a 0a0a 2020  ss is False:..  
-0000d250: 2020 2020 2020 2320 4966 2074 6865 7265        # If there
-0000d260: 2069 7320 3120 7065 616b 2c20 652e 672e   is 1 peak, e.g.
-0000d270: 2069 6620 6861 7665 2061 204e 616e 2066   if have a Nan f
-0000d280: 6f72 2068 6f74 6261 6e64 0a20 2020 2020  or hotband.     
-0000d290: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
-0000d2a0: 3d31 3a0a 2020 2020 2020 2020 2020 2020  =1:.            
-0000d2b0: 6966 2063 6f6e 6669 6731 2e6d 6f64 656c  if config1.model
-0000d2c0: 5f6e 616d 653d 3d27 566f 6967 744d 6f64  _name=='VoigtMod
-0000d2d0: 656c 273a 0a20 2020 2020 2020 2020 2020  el':.           
-0000d2e0: 2020 2020 206d 6f64 656c 5f46 203d 2056       model_F = V
-0000d2f0: 6f69 6774 4d6f 6465 6c28 7072 6566 6978  oigtModel(prefix
-0000d300: 3d27 6c7a 315f 2729 2023 2b20 436f 6e73  ='lz1_') #+ Cons
-0000d310: 7461 6e74 4d6f 6465 6c28 7072 6566 6978  tantModel(prefix
-0000d320: 3d27 6331 2729 0a20 2020 2020 2020 2020  ='c1').         
-0000d330: 2020 2069 6620 636f 6e66 6967 312e 6d6f     if config1.mo
-0000d340: 6465 6c5f 6e61 6d65 3d3d 2750 7365 7564  del_name=='Pseud
-0000d350: 6f56 6f69 6774 4d6f 6465 6c27 3a0a 2020  oVoigtModel':.  
-0000d360: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000d370: 6465 6c5f 4620 3d20 5073 6575 646f 566f  del_F = PseudoVo
-0000d380: 6967 744d 6f64 656c 2870 7265 6669 783d  igtModel(prefix=
-0000d390: 276c 7a31 5f27 2920 2b20 436f 6e73 7461  'lz1_') + Consta
-0000d3a0: 6e74 4d6f 6465 6c28 7072 6566 6978 3d27  ntModel(prefix='
-0000d3b0: 6331 2729 0a0a 2020 2020 2020 2020 2020  c1')..          
-0000d3c0: 2020 7061 7273 3120 3d20 6d6f 6465 6c5f    pars1 = model_
-0000d3d0: 462e 6d61 6b65 5f70 6172 616d 7328 290a  F.make_params().
-0000d3e0: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0000d3f0: 315b 276c 7a31 5f27 2b20 2761 6d70 6c69  1['lz1_'+ 'ampli
-0000d400: 7475 6465 275d 2e73 6574 2863 616c 635f  tude'].set(calc_
-0000d410: 6469 6164 5f61 6d70 6c69 7475 6465 2c20  diad_amplitude, 
-0000d420: 6d69 6e3d 302c 206d 6178 3d63 616c 635f  min=0, max=calc_
-0000d430: 6469 6164 5f61 6d70 6c69 7475 6465 2a31  diad_amplitude*1
-0000d440: 3029 0a20 2020 2020 2020 2020 2020 2070  0).            p
-0000d450: 6172 7331 5b27 6c7a 315f 272b 2027 6365  ars1['lz1_'+ 'ce
-0000d460: 6e74 6572 275d 2e73 6574 2843 656e 7465  nter'].set(Cente
-0000d470: 725f 696e 692c 206d 696e 3d43 656e 7465  r_ini, min=Cente
-0000d480: 725f 696e 692d 352a 7370 6563 5f72 6573  r_ini-5*spec_res
-0000d490: 2c20 6d61 783d 4365 6e74 6572 5f69 6e69  , max=Center_ini
-0000d4a0: 2b35 2a73 7065 635f 7265 7329 0a20 2020  +5*spec_res).   
-0000d4b0: 2020 2020 2020 2020 2070 6172 7331 5b27           pars1['
-0000d4c0: 6c7a 315f 272b 2027 7369 676d 6127 5d2e  lz1_'+ 'sigma'].
-0000d4d0: 7365 7428 636f 6e66 6967 312e 6469 6164  set(config1.diad
-0000d4e0: 5f73 6967 6d61 2c20 6d69 6e3d 636f 6e66  _sigma, min=conf
-0000d4f0: 6967 312e 6469 6164 5f73 6967 6d61 2a63  ig1.diad_sigma*c
-0000d500: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
-0000d510: 615f 6d69 6e5f 616c 6c6f 7761 6e63 652c  a_min_allowance,
-0000d520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d530: 2020 2020 2020 2020 2020 6d61 783d 636f            max=co
-0000d540: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
-0000d550: 2a63 6f6e 6669 6731 2e64 6961 645f 7369  *config1.diad_si
-0000d560: 676d 615f 6d61 785f 616c 6c6f 7761 6e63  gma_max_allowanc
-0000d570: 6529 0a20 2020 2020 2020 2020 2020 2070  e).            p
-0000d580: 6172 616d 733d 7061 7273 310a 0a0a 2020  arams=pars1...  
-0000d590: 2020 2020 2020 2320 4966 2074 6865 7265        # If there
-0000d5a0: 2069 7320 6d6f 7265 2074 6861 6e20 6f6e   is more than on
-0000d5b0: 6520 7065 616b 0a20 2020 2020 2020 2065  e peak.        e
-0000d5c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000d5d0: 2023 2053 6574 2075 7020 4c7a 3120 7468   # Set up Lz1 th
-0000d5e0: 6520 7361 6d65 2066 6f72 2061 6c6c 2073  e same for all s
-0000d5f0: 6974 7561 7469 6f6e 730a 2020 2020 2020  ituations.      
-0000d600: 2020 2020 2020 6966 2063 6f6e 6669 6731        if config1
-0000d610: 2e6d 6f64 656c 5f6e 616d 653d 3d27 566f  .model_name=='Vo
-0000d620: 6967 744d 6f64 656c 273a 0a20 2020 2020  igtModel':.     
-0000d630: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-0000d640: 3120 3d20 566f 6967 744d 6f64 656c 2870  1 = VoigtModel(p
-0000d650: 7265 6669 783d 276c 7a31 5f27 2923 202b  refix='lz1_')# +
-0000d660: 2043 6f6e 7374 616e 744d 6f64 656c 2870   ConstantModel(p
-0000d670: 7265 6669 783d 2763 3127 290a 2020 2020  refix='c1').    
-0000d680: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
-0000d690: 6731 2e6d 6f64 656c 5f6e 616d 653d 3d27  g1.model_name=='
-0000d6a0: 5073 6575 646f 566f 6967 744d 6f64 656c  PseudoVoigtModel
-0000d6b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-0000d6c0: 2020 206d 6f64 656c 3120 3d20 5073 6575     model1 = Pseu
-0000d6d0: 646f 566f 6967 744d 6f64 656c 2870 7265  doVoigtModel(pre
-0000d6e0: 6669 783d 276c 7a31 5f27 2920 232b 2043  fix='lz1_') #+ C
-0000d6f0: 6f6e 7374 616e 744d 6f64 656c 2870 7265  onstantModel(pre
-0000d700: 6669 783d 2763 3127 290a 0a20 2020 2020  fix='c1')..     
-0000d710: 2020 2020 2020 2070 6172 7331 203d 206d         pars1 = m
-0000d720: 6f64 656c 312e 6d61 6b65 5f70 6172 616d  odel1.make_param
-0000d730: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0000d740: 7061 7273 315b 276c 7a31 5f27 2b20 2761  pars1['lz1_'+ 'a
-0000d750: 6d70 6c69 7475 6465 275d 2e73 6574 2863  mplitude'].set(c
-0000d760: 616c 635f 6469 6164 5f61 6d70 6c69 7475  alc_diad_amplitu
-0000d770: 6465 2c20 6d69 6e3d 302c 206d 6178 3d63  de, min=0, max=c
-0000d780: 616c 635f 6469 6164 5f61 6d70 6c69 7475  alc_diad_amplitu
-0000d790: 6465 2a31 3029 0a0a 2020 2020 2020 2020  de*10)..        
-0000d7a0: 2020 2020 7061 7273 315b 276c 7a31 5f27      pars1['lz1_'
-0000d7b0: 2b20 2763 656e 7465 7227 5d2e 7365 7428  + 'center'].set(
-0000d7c0: 4365 6e74 6572 5f69 6e69 2c20 6d69 6e3d  Center_ini, min=
-0000d7d0: 4365 6e74 6572 5f69 6e69 2d33 2a73 7065  Center_ini-3*spe
-0000d7e0: 635f 7265 732c 206d 6178 3d43 656e 7465  c_res, max=Cente
-0000d7f0: 725f 696e 692b 332a 7370 6563 5f72 6573  r_ini+3*spec_res
-0000d800: 290a 0a20 2020 2020 2020 2020 2020 2070  )..            p
-0000d810: 6172 7331 5b27 6c7a 315f 272b 2027 7369  ars1['lz1_'+ 'si
-0000d820: 676d 6127 5d2e 7365 7428 636f 6e66 6967  gma'].set(config
-0000d830: 312e 6469 6164 5f73 6967 6d61 2c20 6d69  1.diad_sigma, mi
-0000d840: 6e3d 636f 6e66 6967 312e 6469 6164 5f73  n=config1.diad_s
-0000d850: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
-0000d860: 645f 7369 676d 615f 6d69 6e5f 616c 6c6f  d_sigma_min_allo
-0000d870: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
-0000d880: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000d890: 6178 3d63 6f6e 6669 6731 2e64 6961 645f  ax=config1.diad_
-0000d8a0: 7369 676d 612a 636f 6e66 6967 312e 6469  sigma*config1.di
-0000d8b0: 6164 5f73 6967 6d61 5f6d 6178 5f61 6c6c  ad_sigma_max_all
-0000d8c0: 6f77 616e 6365 290a 0a0a 0a0a 2020 2020  owance).....    
-0000d8d0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
-0000d8e0: 6561 6b73 3e31 3a0a 2020 2020 2020 2020  eaks>1:.        
-0000d8f0: 2020 2020 2020 2020 6d6f 6465 6c5f 463d          model_F=
-0000d900: 6d6f 6465 6c31 0a20 2020 2020 2020 2020  model1.         
-0000d910: 2020 2020 2020 2070 6172 616d 733d 7061         params=pa
-0000d920: 7273 310a 0a20 2020 2020 2020 2020 2020  rs1..           
-0000d930: 2069 6620 6669 745f 7065 616b 733d 3d32   if fit_peaks==2
-0000d940: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000d950: 2020 2023 2053 6563 6f6e 6420 7765 6520     # Second wee 
-0000d960: 7065 616b 0a20 2020 2020 2020 2020 2020  peak.           
-0000d970: 2020 2020 2070 7265 6669 783d 276c 7a32       prefix='lz2
-0000d980: 5f27 0a20 2020 2020 2020 2020 2020 2020  _'.             
-0000d990: 2020 2069 6620 636f 6e66 6967 312e 6d6f     if config1.mo
-0000d9a0: 6465 6c5f 6e61 6d65 3d3d 2756 6f69 6774  del_name=='Voigt
-0000d9b0: 4d6f 6465 6c27 3a0a 2020 2020 2020 2020  Model':.        
-0000d9c0: 2020 2020 2020 2020 2020 2020 7065 616b              peak
-0000d9d0: 203d 2056 6f69 6774 4d6f 6465 6c28 7072   = VoigtModel(pr
-0000d9e0: 6566 6978 3d27 6c7a 325f 2729 2320 2b20  efix='lz2_')# + 
-0000d9f0: 436f 6e73 7461 6e74 4d6f 6465 6c28 7072  ConstantModel(pr
-0000da00: 6566 6978 3d27 6331 2729 0a20 2020 2020  efix='c1').     
-0000da10: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0000da20: 6e66 6967 312e 6d6f 6465 6c5f 6e61 6d65  nfig1.model_name
-0000da30: 3d3d 2750 7365 7564 6f56 6f69 6774 4d6f  =='PseudoVoigtMo
-0000da40: 6465 6c27 3a0a 2020 2020 2020 2020 2020  del':.          
-0000da50: 2020 2020 2020 2020 2020 7065 616b 203d            peak =
-0000da60: 2050 7365 7564 6f56 6f69 6774 4d6f 6465   PseudoVoigtMode
-0000da70: 6c28 7072 6566 6978 3d27 6c7a 325f 2729  l(prefix='lz2_')
-0000da80: 2320 2b20 436f 6e73 7461 6e74 4d6f 6465  # + ConstantMode
-0000da90: 6c28 7072 6566 6978 3d27 6331 2729 0a0a  l(prefix='c1')..
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dab0: 7061 7273 203d 2070 6561 6b2e 6d61 6b65  pars = peak.make
-0000dac0: 5f70 6172 616d 7328 290a 0a20 2020 2020  _params()..     
-0000dad0: 2020 2020 2020 2020 2020 2070 6172 735b             pars[
-0000dae0: 7072 6566 6978 202b 2027 6365 6e74 6572  prefix + 'center
-0000daf0: 275d 2e73 6574 2848 425f 696e 6974 6961  '].set(HB_initia
-0000db00: 6c5f 6775 6573 732c 0a20 2020 2020 2020  l_guess,.       
-0000db10: 2020 2020 2020 2020 2020 2020 206d 696e               min
-0000db20: 3d48 425f 696e 6974 6961 6c5f 6775 6573  =HB_initial_gues
-0000db30: 732d 322a 7370 6563 5f72 6573 2c20 6d61  s-2*spec_res, ma
-0000db40: 783d 4842 5f69 6e69 7469 616c 5f67 7565  x=HB_initial_gue
-0000db50: 7373 2b32 290a 0a20 2020 2020 2020 2020  ss+2)..         
-0000db60: 2020 2020 2020 2070 6172 735b 7072 6566         pars[pref
-0000db70: 6978 202b 2027 616d 706c 6974 7564 6527  ix + 'amplitude'
-0000db80: 5d2e 7365 7428 6361 6c63 5f48 425f 616d  ].set(calc_HB_am
-0000db90: 706c 6974 7564 652c 206d 696e 3d41 6d70  plitude, min=Amp
-0000dba0: 6c69 7475 6465 5f69 6e69 2a63 6f6e 6669  litude_ini*confi
-0000dbb0: 6731 2e48 425f 616d 705f 6d69 6e5f 616c  g1.HB_amp_min_al
-0000dbc0: 6c6f 7761 6e63 652c 206d 6178 3d41 6d70  lowance, max=Amp
-0000dbd0: 6c69 7475 6465 5f69 6e69 2a63 6f6e 6669  litude_ini*confi
-0000dbe0: 6731 2e48 425f 616d 705f 6d61 785f 616c  g1.HB_amp_max_al
-0000dbf0: 6c6f 7761 6e63 6529 0a20 2020 2020 2020  lowance).       
-0000dc00: 2020 2020 2020 2020 2070 6172 735b 7072           pars[pr
-0000dc10: 6566 6978 2b20 2773 6967 6d61 275d 2e73  efix+ 'sigma'].s
-0000dc20: 6574 2873 6967 6d61 5f69 6e69 2c20 6d69  et(sigma_ini, mi
-0000dc30: 6e3d 7369 676d 615f 696e 692a 636f 6e66  n=sigma_ini*conf
-0000dc40: 6967 312e 4842 5f73 6967 6d61 5f6d 696e  ig1.HB_sigma_min
-0000dc50: 5f61 6c6c 6f77 616e 6365 2c20 6d61 783d  _allowance, max=
-0000dc60: 7369 676d 615f 696e 692a 636f 6e66 6967  sigma_ini*config
-0000dc70: 312e 4842 5f73 6967 6d61 5f6d 6178 5f61  1.HB_sigma_max_a
-0000dc80: 6c6c 6f77 616e 6365 290a 0a0a 2020 2020  llowance)...    
-0000dc90: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000dca0: 6c5f 463d 6d6f 6465 6c31 2b70 6561 6b0a  l_F=model1+peak.
-0000dcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dcc0: 2023 2075 7064 6174 696e 6720 7061 7273   # updating pars
-0000dcd0: 2031 2077 6974 6820 7661 6c75 6573 2069   1 with values i
-0000dce0: 6e20 7061 7273 0a20 2020 2020 2020 2020  n pars.         
-0000dcf0: 2020 2020 2020 2070 6172 7331 2e75 7064         pars1.upd
-0000dd00: 6174 6528 7061 7273 290a 2020 2020 2020  ate(pars).      
-0000dd10: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000dd20: 3d70 6172 7331 0a0a 0a20 2020 2020 2020  =pars1...       
-0000dd30: 2020 2020 2020 2020 2023 2041 7474 656d           # Attem
-0000dd40: 7074 2061 7420 7374 6162 696c 697a 696e  pt at stabilizin
-0000dd50: 6720 7065 616b 2066 6974 0a20 2020 2020  g peak fit.     
-0000dd60: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000dd70: 7420 3d20 6d6f 6465 6c5f 462e 6669 7428  t = model_F.fit(
-0000dd80: 7964 6174 2c20 7061 7273 312c 2078 3d78  ydat, pars1, x=x
-0000dd90: 6461 7429 0a20 2020 2020 2020 2020 2020  dat).           
-0000dda0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
-0000ddb0: 6d73 5b27 6c7a 325f 6365 6e74 6572 275d  ms['lz2_center']
-0000ddc0: 2e76 6172 7920 3d20 4661 6c73 650a 2020  .vary = False.  
-0000ddd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000dde0: 7375 6c74 2e70 6172 616d 735b 276c 7a32  sult.params['lz2
-0000ddf0: 5f61 6d70 6c69 7475 6465 275d 2e76 6172  _amplitude'].var
-0000de00: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
-0000de10: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000de20: 2e70 6172 616d 735b 276c 7a32 5f73 6967  .params['lz2_sig
-0000de30: 6d61 275d 2e76 6172 7920 3d20 4661 6c73  ma'].vary = Fals
-0000de40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000de50: 2020 6669 6e61 6c5f 7265 7375 6c74 203d    final_result =
-0000de60: 206d 6f64 656c 5f46 2e66 6974 2879 6461   model_F.fit(yda
-0000de70: 742c 2072 6573 756c 742e 7061 7261 6d73  t, result.params
-0000de80: 2c20 783d 7864 6174 290a 2020 2020 2020  , x=xdat).      
-0000de90: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000dea0: 2e75 7064 6174 6528 6669 6e61 6c5f 7265  .update(final_re
-0000deb0: 7375 6c74 2e70 6172 616d 7329 0a20 2020  sult.params).   
-0000dec0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000ded0: 616d 732e 7570 6461 7465 2866 696e 616c  ams.update(final
-0000dee0: 5f72 6573 756c 742e 7061 7261 6d73 290a  _result.params).
-0000def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df00: 7265 7375 6c74 3d66 696e 616c 5f72 6573  result=final_res
-0000df10: 756c 740a 0a0a 0a0a 0a0a 0a20 2020 2020  ult........     
-0000df20: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
-0000df30: 616b 733d 3d33 3a0a 2020 2020 2020 2020  aks==3:.        
-0000df40: 2020 2020 2020 2020 6966 2062 6c6f 636b          if block
-0000df50: 5f70 7269 6e74 2069 7320 4661 6c73 653a  _print is False:
-0000df60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df70: 2020 2020 2070 7269 6e74 2827 5472 7969       print('Tryi
-0000df80: 6e67 2074 6f20 6974 6572 6174 6976 656c  ng to iterativel
-0000df90: 7920 6669 7420 3320 7065 616b 7327 290a  y fit 3 peaks').
-0000dfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dfb0: 2070 6561 6b5f 706f 735f 6c65 6674 3d6e   peak_pos_left=n
-0000dfc0: 702e 6172 7261 7928 5b48 425f 696e 6974  p.array([HB_init
-0000dfd0: 6961 6c5f 6775 6573 732c 2043 3133 5f69  ial_guess, C13_i
-0000dfe0: 6e69 7469 616c 5f67 7565 7373 5d29 0a0a  nitial_guess])..
-0000dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e000: 666f 7220 692c 2063 656e 2069 6e20 656e  for i, cen in en
-0000e010: 756d 6572 6174 6528 7065 616b 5f70 6f73  umerate(peak_pos
-0000e020: 5f6c 6566 7429 3a0a 0a20 2020 2020 2020  _left):..       
-0000e030: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000e040: 693d 3d30 3a20 2320 5468 6973 2069 7320  i==0: # This is 
-0000e050: 7468 6520 686f 7462 616e 640a 2020 2020  the hotband.    
-0000e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e070: 2020 2020 7065 616b 2c20 7061 7273 203d      peak, pars =
-0000e080: 2061 6464 5f70 6561 6b28 7072 6566 6978   add_peak(prefix
-0000e090: 3d27 6c7a 2564 5f27 2025 2028 692b 3229  ='lz%d_' % (i+2)
-0000e0a0: 2c20 6365 6e74 6572 3d63 656e 2c0a 2020  , center=cen,.  
-0000e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0c0: 2020 2020 2020 6d69 6e5f 6365 6e74 3d63        min_cent=c
-0000e0d0: 656e 2d33 2a73 7065 635f 7265 732c 206d  en-3*spec_res, m
-0000e0e0: 6178 5f63 656e 743d 6365 6e2b 332a 7370  ax_cent=cen+3*sp
-0000e0f0: 6563 5f72 6573 2c20 7369 676d 613d 7369  ec_res, sigma=si
-0000e100: 676d 615f 696e 692c 0a20 2020 2020 2020  gma_ini,.       
-0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e120: 206d 696e 5f73 6967 6d61 3d73 6967 6d61   min_sigma=sigma
-0000e130: 5f69 6e69 2a63 6f6e 6669 6731 2e48 425f  _ini*config1.HB_
-0000e140: 7369 676d 615f 6d69 6e5f 616c 6c6f 7761  sigma_min_allowa
-0000e150: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-0000e160: 2020 2020 2020 2020 2020 2020 206d 6178               max
-0000e170: 5f73 6967 6d61 3d73 6967 6d61 5f69 6e69  _sigma=sigma_ini
-0000e180: 2a63 6f6e 6669 6731 2e48 425f 7369 676d  *config1.HB_sigm
-0000e190: 615f 6d61 785f 616c 6c6f 7761 6e63 652c  a_max_allowance,
-0000e1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e1b0: 2020 2020 2020 2020 2061 6d70 6c69 7475           amplitu
-0000e1c0: 6465 3d63 616c 635f 4842 5f61 6d70 6c69  de=calc_HB_ampli
-0000e1d0: 7475 6465 2c0a 2020 2020 2020 2020 2020  tude,.          
-0000e1e0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000e1f0: 6e5f 616d 706c 6974 7564 653d 416d 706c  n_amplitude=Ampl
-0000e200: 6974 7564 655f 696e 692a 636f 6e66 6967  itude_ini*config
-0000e210: 312e 4842 5f61 6d70 5f6d 696e 5f61 6c6c  1.HB_amp_min_all
-0000e220: 6f77 616e 6365 2c0a 2020 2020 2020 2020  owance,.        
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 6d61 785f 616d 706c 6974 7564 653d 416d  max_amplitude=Am
-0000e250: 706c 6974 7564 655f 696e 692a 636f 6e66  plitude_ini*conf
-0000e260: 6967 312e 4842 5f61 6d70 5f6d 6178 5f61  ig1.HB_amp_max_a
-0000e270: 6c6c 6f77 616e 6365 2c0a 2020 2020 2020  llowance,.      
-0000e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e290: 2020 6d6f 6465 6c5f 6e61 6d65 3d63 6f6e    model_name=con
-0000e2a0: 6669 6731 2e6d 6f64 656c 5f6e 616d 6529  fig1.model_name)
-0000e2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e2c0: 2020 2020 2020 2020 206d 6f64 656c 203d           model =
-0000e2d0: 2070 6561 6b2b 6d6f 6465 6c31 0a20 2020   peak+model1.   
-0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2f0: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-0000e300: 7465 2870 6172 7329 0a20 2020 2020 2020  te(pars).       
-0000e310: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000e320: 693d 3d31 3a20 2320 5468 6973 2069 7320  i==1: # This is 
-0000e330: 6331 330a 2020 2020 2020 2020 2020 2020  c13.            
-0000e340: 2020 2020 2020 2020 2020 2020 7065 616b              peak
-0000e350: 2c20 7061 7273 203d 2061 6464 5f70 6561  , pars = add_pea
-0000e360: 6b28 7072 6566 6978 3d27 6c7a 2564 5f27  k(prefix='lz%d_'
-0000e370: 2025 2028 692b 3229 2c20 6365 6e74 6572   % (i+2), center
-0000e380: 3d63 656e 2c0a 2020 2020 2020 2020 2020  =cen,.          
-0000e390: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000e3a0: 6e5f 6365 6e74 3d63 656e 2d33 2a73 7065  n_cent=cen-3*spe
-0000e3b0: 635f 7265 732c 206d 6178 5f63 656e 743d  c_res, max_cent=
-0000e3c0: 6365 6e2b 332a 7370 6563 5f72 6573 2c0a  cen+3*spec_res,.
+0000ca70: 2022 2222 0a0a 0a0a 2020 2020 2320 4361   """....    # Ca
+0000ca80: 6c63 756c 6174 6520 7468 6520 616d 706c  lculate the ampl
+0000ca90: 6974 7564 6520 6672 6f6d 2074 6865 2073  itude from the s
+0000caa0: 6967 6d61 2061 6e64 2074 6865 2070 726f  igma and the pro
+0000cab0: 6d69 6e65 6e63 650a 2020 2020 6361 6c63  minence.    calc
+0000cac0: 5f64 6961 645f 616d 706c 6974 7564 653d  _diad_amplitude=
+0000cad0: 2828 636f 6e66 6967 312e 6469 6164 5f73  ((config1.diad_s
+0000cae0: 6967 6d61 292a 2863 6f6e 6669 6731 2e64  igma)*(config1.d
+0000caf0: 6961 645f 7072 6f6d 2929 2f30 2e33 3933  iad_prom))/0.393
+0000cb00: 390a 2020 2020 6361 6c63 5f48 425f 616d  9.    calc_HB_am
+0000cb10: 706c 6974 7564 653d 2828 636f 6e66 6967  plitude=((config
+0000cb20: 312e 6469 6164 5f73 6967 6d61 292a 2863  1.diad_sigma)*(c
+0000cb30: 6f6e 6669 6731 2e48 425f 7072 6f6d 2929  onfig1.HB_prom))
+0000cb40: 2f30 2e33 3933 390a 0a20 2020 2023 2049  /0.3939..    # I
+0000cb50: 6620 6173 6b20 666f 7220 4761 7573 7369  f ask for Gaussi
+0000cb60: 616e 2c20 6275 7420 6669 7420 7065 616b  an, but fit peak
+0000cb70: 7320 6973 2031 2c20 7265 6d6f 7665 2067  s is 1, remove g
+0000cb80: 6175 7373 6961 6e0a 2020 2020 6966 2066  aussian.    if f
+0000cb90: 6974 5f70 6561 6b73 3d3d 3120 616e 6420  it_peaks==1 and 
+0000cba0: 636f 6e66 6967 312e 6669 745f 6761 7573  config1.fit_gaus
+0000cbb0: 7320 6973 2054 7275 653a 0a20 2020 2020  s is True:.     
+0000cbc0: 2020 2063 6f6e 6669 6731 2e66 6974 5f67     config1.fit_g
+0000cbd0: 6175 7373 3d46 616c 7365 0a0a 0a20 2020  auss=False...   
+0000cbe0: 2069 6620 6469 6164 3220 6973 2054 7275   if diad2 is Tru
+0000cbf0: 6520 616e 6420 6669 745f 7065 616b 733d  e and fit_peaks=
+0000cc00: 3d33 3a0a 2020 2020 2020 2020 6361 6c63  =3:.        calc
+0000cc10: 5f43 3133 5f61 6d70 6c69 7475 6465 3d28  _C13_amplitude=(
+0000cc20: 302e 352a 2863 6f6e 6669 6731 2e64 6961  0.5*(config1.dia
+0000cc30: 645f 7369 676d 6129 2a28 636f 6e66 6967  d_sigma)*(config
+0000cc40: 312e 4331 335f 7072 6f6d 2929 2f30 2e33  1.C13_prom))/0.3
+0000cc50: 3933 390a 2020 2020 2320 4765 7473 206f  939.    # Gets o
+0000cc60: 7665 7272 6964 6465 6e20 6966 2079 6f75  verridden if you
+0000cc70: 2068 6176 6520 7472 6967 6765 7265 6420   have triggered 
+0000cc80: 616e 7920 6f66 2074 6865 2077 6172 6e69  any of the warni
+0000cc90: 6e67 730a 2020 2020 7265 6669 743d 4661  ngs.    refit=Fa
+0000cca0: 6c73 650a 2020 2020 7265 6669 745f 7061  lse.    refit_pa
+0000ccb0: 7261 6d3d 2746 6c61 6767 6564 2057 6172  ram='Flagged War
+0000ccc0: 6e69 6e67 733a 270a 2020 2020 7370 6563  nings:'.    spec
+0000ccd0: 5f72 6573 3d6e 702e 6162 7328 7864 6174  _res=np.abs(xdat
+0000cce0: 5b31 5d2d 7864 6174 5b30 5d29 0a0a 0a0a  [1]-xdat[0])....
+0000ccf0: 0a0a 0a20 2020 2069 6e69 7469 616c 5f67  ...    initial_g
+0000cd00: 7565 7373 3d44 6961 645f 706f 730a 2020  uess=Diad_pos.  
+0000cd10: 2020 4842 5f69 6e69 7469 616c 5f67 7565    HB_initial_gue
+0000cd20: 7373 3d48 425f 706f 730a 2020 2020 4331  ss=HB_pos.    C1
+0000cd30: 335f 696e 6974 6961 6c5f 6775 6573 733d  3_initial_guess=
+0000cd40: 4331 335f 706f 730a 0a0a 0a0a 2020 2020  C13_pos.....    
+0000cd50: 6966 2063 6f6e 6669 6731 2e6d 6f64 656c  if config1.model
+0000cd60: 5f6e 616d 653d 3d22 566f 6967 744d 6f64  _name=="VoigtMod
+0000cd70: 656c 223a 0a20 2020 2020 2020 206d 6f64  el":.        mod
+0000cd80: 656c 5f69 6e69 203d 2056 6f69 6774 4d6f  el_ini = VoigtMo
+0000cd90: 6465 6c28 2923 2b20 436f 6e73 7461 6e74  del()#+ Constant
+0000cda0: 4d6f 6465 6c28 290a 2020 2020 6966 2063  Model().    if c
+0000cdb0: 6f6e 6669 6731 2e6d 6f64 656c 5f6e 616d  onfig1.model_nam
+0000cdc0: 653d 3d22 5073 6575 646f 566f 6967 744d  e=="PseudoVoigtM
+0000cdd0: 6f64 656c 223a 0a20 2020 2020 2020 206d  odel":.        m
+0000cde0: 6f64 656c 5f69 6e69 203d 2050 7365 7564  odel_ini = Pseud
+0000cdf0: 6f56 6f69 6774 4d6f 6465 6c28 2923 2b20  oVoigtModel()#+ 
+0000ce00: 436f 6e73 7461 6e74 4d6f 6465 6c28 290a  ConstantModel().
+0000ce10: 0a20 2020 2023 2043 7265 6174 6520 696e  .    # Create in
+0000ce20: 6974 6961 6c20 7065 616b 2070 6172 616d  itial peak param
+0000ce30: 730a 2020 2020 2320 5365 7420 7065 616b  s.    # Set peak
+0000ce40: 2070 6f73 6974 696f 6e20 746f 2032 2073   position to 2 s
+0000ce50: 7065 6374 7261 6c20 7265 7320 756e 6974  pectral res unit
+0000ce60: 7320 6569 7468 6572 2073 6964 6520 6f66  s either side of
+0000ce70: 2074 6865 2069 6e69 7469 616c 2067 7565   the initial gue
+0000ce80: 7373 206d 6164 6520 6162 6f76 650a 2020  ss made above.  
+0000ce90: 2020 7061 7261 6d73 5f69 6e69 203d 206d    params_ini = m
+0000cea0: 6f64 656c 5f69 6e69 2e6d 616b 655f 7061  odel_ini.make_pa
+0000ceb0: 7261 6d73 2863 656e 7465 723d 696e 6974  rams(center=init
+0000cec0: 6961 6c5f 6775 6573 732c 206d 6178 3d69  ial_guess, max=i
+0000ced0: 6e69 7469 616c 5f67 7565 7373 2b73 7065  nitial_guess+spe
+0000cee0: 635f 7265 732a 352c 206d 696e 3d69 6e69  c_res*5, min=ini
+0000cef0: 7469 616c 5f67 7565 7373 2d73 7065 635f  tial_guess-spec_
+0000cf00: 7265 732a 3529 0a20 2020 2023 2053 6574  res*5).    # Set
+0000cf10: 2074 6865 2061 6d70 6c69 7475 6465 2074   the amplitude t
+0000cf20: 6f20 7769 7468 696e 2058 302e 3120 6f72  o within X0.1 or
+0000cf30: 2031 3058 206f 6620 7468 6520 6775 6573   10X of the gues
+0000cf40: 7365 6420 616d 706c 6974 7564 650a 2020  sed amplitude.  
+0000cf50: 2020 7061 7261 6d73 5f69 6e69 5b27 616d    params_ini['am
+0000cf60: 706c 6974 7564 6527 5d2e 7365 7428 6361  plitude'].set(ca
+0000cf70: 6c63 5f64 6961 645f 616d 706c 6974 7564  lc_diad_amplitud
+0000cf80: 652c 206d 696e 3d63 616c 635f 6469 6164  e, min=calc_diad
+0000cf90: 5f61 6d70 6c69 7475 6465 2f35 2c0a 2020  _amplitude/5,.  
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000cfc0: 6178 3d63 616c 635f 6469 6164 5f61 6d70  ax=calc_diad_amp
+0000cfd0: 6c69 7475 6465 2a35 290a 2020 2020 2320  litude*5).    # 
+0000cfe0: 5365 7420 7369 676d 6120 746f 2062 6520  Set sigma to be 
+0000cff0: 7468 6520 656e 7465 7265 6420 7661 6c75  the entered valu
+0000d000: 652c 2074 6865 6e0a 2020 2020 7061 7261  e, then.    para
+0000d010: 6d73 5f69 6e69 5b27 7369 676d 6127 5d2e  ms_ini['sigma'].
+0000d020: 7365 7428 636f 6e66 6967 312e 6469 6164  set(config1.diad
+0000d030: 5f73 6967 6d61 2c20 6d69 6e3d 636f 6e66  _sigma, min=conf
+0000d040: 6967 312e 6469 6164 5f73 6967 6d61 2a63  ig1.diad_sigma*c
+0000d050: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
+0000d060: 615f 6d69 6e5f 616c 6c6f 7761 6e63 652c  a_min_allowance,
+0000d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d090: 206d 6178 3d63 6f6e 6669 6731 2e64 6961   max=config1.dia
+0000d0a0: 645f 7369 676d 612a 636f 6e66 6967 312e  d_sigma*config1.
+0000d0b0: 6469 6164 5f73 6967 6d61 5f6d 6178 5f61  diad_sigma_max_a
+0000d0c0: 6c6c 6f77 616e 6365 290a 0a20 2020 2023  llowance)..    #
+0000d0d0: 204e 6f77 206c 6574 7320 7477 6561 6b20   Now lets tweak 
+0000d0e0: 616e 2069 6e69 7469 616c 206d 6f64 656c  an initial model
+0000d0f0: 2077 6974 6820 6a75 7374 2031 2070 6561   with just 1 pea
+0000d100: 6b2c 2074 6869 7320 7265 616c 6c79 2068  k, this really h
+0000d110: 656c 7073 2077 6974 6820 7468 6520 6669  elps with the fi
+0000d120: 740a 2020 2020 696e 6974 5f69 6e69 203d  t.    init_ini =
+0000d130: 206d 6f64 656c 5f69 6e69 2e65 7661 6c28   model_ini.eval(
+0000d140: 7061 7261 6d73 5f69 6e69 2c20 783d 7864  params_ini, x=xd
+0000d150: 6174 290a 2020 2020 7265 7375 6c74 5f69  at).    result_i
+0000d160: 6e69 2020 3d20 6d6f 6465 6c5f 696e 692e  ni  = model_ini.
+0000d170: 6669 7428 7964 6174 2c20 7061 7261 6d73  fit(ydat, params
+0000d180: 5f69 6e69 2c20 783d 7864 6174 290a 2020  _ini, x=xdat).  
+0000d190: 2020 636f 6d70 735f 696e 6920 203d 2072    comps_ini  = r
+0000d1a0: 6573 756c 745f 696e 692e 6576 616c 5f63  esult_ini.eval_c
+0000d1b0: 6f6d 706f 6e65 6e74 7328 290a 2020 2020  omponents().    
+0000d1c0: 4365 6e74 6572 5f69 6e69 3d72 6573 756c  Center_ini=resul
+0000d1d0: 745f 696e 692e 7061 7261 6d73 2e67 6574  t_ini.params.get
+0000d1e0: 2827 6365 6e74 6572 2729 0a20 2020 2041  ('center').    A
+0000d1f0: 6d70 6c69 7475 6465 5f69 6e69 3d72 6573  mplitude_ini=res
+0000d200: 756c 745f 696e 692e 7061 7261 6d73 2e67  ult_ini.params.g
+0000d210: 6574 2827 616d 706c 6974 7564 6527 290a  et('amplitude').
+0000d220: 2020 2020 7369 676d 615f 696e 693d 7265      sigma_ini=re
+0000d230: 7375 6c74 5f69 6e69 2e70 6172 616d 732e  sult_ini.params.
+0000d240: 6765 7428 2773 6967 6d61 2729 0a20 2020  get('sigma').   
+0000d250: 2066 7768 6d5f 696e 693d 7265 7375 6c74   fwhm_ini=result
+0000d260: 5f69 6e69 2e70 6172 616d 732e 6765 7428  _ini.params.get(
+0000d270: 2766 7768 6d27 290a 0a0a 0a20 2020 2023  'fwhm')....    #
+0000d280: 2046 6f72 2072 656c 6174 6976 656c 7920   For relatively 
+0000d290: 7765 616b 2070 6561 6b73 2c20 796f 7520  weak peaks, you 
+0000d2a0: 776f 6e74 2077 616e 7420 6120 6761 7573  wont want a gaus
+0000d2b0: 7369 616e 2062 6163 6b67 726f 756e 640a  sian background.
+0000d2c0: 2020 2020 6966 2063 6f6e 6669 6731 2e66      if config1.f
+0000d2d0: 6974 5f67 6175 7373 2069 7320 4661 6c73  it_gauss is Fals
+0000d2e0: 653a 0a0a 2020 2020 2020 2020 2320 4966  e:..        # If
+0000d2f0: 2074 6865 7265 2069 7320 3120 7065 616b   there is 1 peak
+0000d300: 2c20 652e 672e 2069 6620 6861 7665 2061  , e.g. if have a
+0000d310: 204e 616e 2066 6f72 2068 6f74 6261 6e64   Nan for hotband
+0000d320: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
+0000d330: 7065 616b 733d 3d31 3a0a 2020 2020 2020  peaks==1:.      
+0000d340: 2020 2020 2020 6966 2063 6f6e 6669 6731        if config1
+0000d350: 2e6d 6f64 656c 5f6e 616d 653d 3d27 566f  .model_name=='Vo
+0000d360: 6967 744d 6f64 656c 273a 0a20 2020 2020  igtModel':.     
+0000d370: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000d380: 5f46 203d 2056 6f69 6774 4d6f 6465 6c28  _F = VoigtModel(
+0000d390: 7072 6566 6978 3d27 6c7a 315f 2729 2023  prefix='lz1_') #
+0000d3a0: 2b20 436f 6e73 7461 6e74 4d6f 6465 6c28  + ConstantModel(
+0000d3b0: 7072 6566 6978 3d27 6331 2729 0a20 2020  prefix='c1').   
+0000d3c0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+0000d3d0: 6967 312e 6d6f 6465 6c5f 6e61 6d65 3d3d  ig1.model_name==
+0000d3e0: 2750 7365 7564 6f56 6f69 6774 4d6f 6465  'PseudoVoigtMode
+0000d3f0: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
+0000d400: 2020 2020 6d6f 6465 6c5f 4620 3d20 5073      model_F = Ps
+0000d410: 6575 646f 566f 6967 744d 6f64 656c 2870  eudoVoigtModel(p
+0000d420: 7265 6669 783d 276c 7a31 5f27 2920 2b20  refix='lz1_') + 
+0000d430: 436f 6e73 7461 6e74 4d6f 6465 6c28 7072  ConstantModel(pr
+0000d440: 6566 6978 3d27 6331 2729 0a0a 2020 2020  efix='c1')..    
+0000d450: 2020 2020 2020 2020 7061 7273 3120 3d20          pars1 = 
+0000d460: 6d6f 6465 6c5f 462e 6d61 6b65 5f70 6172  model_F.make_par
+0000d470: 616d 7328 290a 2020 2020 2020 2020 2020  ams().          
+0000d480: 2020 7061 7273 315b 276c 7a31 5f27 2b20    pars1['lz1_'+ 
+0000d490: 2761 6d70 6c69 7475 6465 275d 2e73 6574  'amplitude'].set
+0000d4a0: 2863 616c 635f 6469 6164 5f61 6d70 6c69  (calc_diad_ampli
+0000d4b0: 7475 6465 2c20 6d69 6e3d 302c 206d 6178  tude, min=0, max
+0000d4c0: 3d63 616c 635f 6469 6164 5f61 6d70 6c69  =calc_diad_ampli
+0000d4d0: 7475 6465 2a31 3029 0a20 2020 2020 2020  tude*10).       
+0000d4e0: 2020 2020 2070 6172 7331 5b27 6c7a 315f       pars1['lz1_
+0000d4f0: 272b 2027 6365 6e74 6572 275d 2e73 6574  '+ 'center'].set
+0000d500: 2843 656e 7465 725f 696e 692c 206d 696e  (Center_ini, min
+0000d510: 3d43 656e 7465 725f 696e 692d 352a 7370  =Center_ini-5*sp
+0000d520: 6563 5f72 6573 2c20 6d61 783d 4365 6e74  ec_res, max=Cent
+0000d530: 6572 5f69 6e69 2b35 2a73 7065 635f 7265  er_ini+5*spec_re
+0000d540: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
+0000d550: 6172 7331 5b27 6c7a 315f 272b 2027 7369  ars1['lz1_'+ 'si
+0000d560: 676d 6127 5d2e 7365 7428 636f 6e66 6967  gma'].set(config
+0000d570: 312e 6469 6164 5f73 6967 6d61 2c20 6d69  1.diad_sigma, mi
+0000d580: 6e3d 636f 6e66 6967 312e 6469 6164 5f73  n=config1.diad_s
+0000d590: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
+0000d5a0: 645f 7369 676d 615f 6d69 6e5f 616c 6c6f  d_sigma_min_allo
+0000d5b0: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
+0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5d0: 6d61 783d 636f 6e66 6967 312e 6469 6164  max=config1.diad
+0000d5e0: 5f73 6967 6d61 2a63 6f6e 6669 6731 2e64  _sigma*config1.d
+0000d5f0: 6961 645f 7369 676d 615f 6d61 785f 616c  iad_sigma_max_al
+0000d600: 6c6f 7761 6e63 6529 0a20 2020 2020 2020  lowance).       
+0000d610: 2020 2020 2070 6172 616d 733d 7061 7273       params=pars
+0000d620: 310a 0a0a 2020 2020 2020 2020 2320 4966  1...        # If
+0000d630: 2074 6865 7265 2069 7320 6d6f 7265 2074   there is more t
+0000d640: 6861 6e20 6f6e 6520 7065 616b 0a20 2020  han one peak.   
+0000d650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000d660: 2020 2020 2020 2023 2053 6574 2075 7020         # Set up 
+0000d670: 4c7a 3120 7468 6520 7361 6d65 2066 6f72  Lz1 the same for
+0000d680: 2061 6c6c 2073 6974 7561 7469 6f6e 730a   all situations.
+0000d690: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0000d6a0: 6f6e 6669 6731 2e6d 6f64 656c 5f6e 616d  onfig1.model_nam
+0000d6b0: 653d 3d27 566f 6967 744d 6f64 656c 273a  e=='VoigtModel':
+0000d6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d6d0: 206d 6f64 656c 3120 3d20 566f 6967 744d   model1 = VoigtM
+0000d6e0: 6f64 656c 2870 7265 6669 783d 276c 7a31  odel(prefix='lz1
+0000d6f0: 5f27 2923 202b 2043 6f6e 7374 616e 744d  _')# + ConstantM
+0000d700: 6f64 656c 2870 7265 6669 783d 2763 3127  odel(prefix='c1'
+0000d710: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000d720: 2063 6f6e 6669 6731 2e6d 6f64 656c 5f6e   config1.model_n
+0000d730: 616d 653d 3d27 5073 6575 646f 566f 6967  ame=='PseudoVoig
+0000d740: 744d 6f64 656c 273a 0a20 2020 2020 2020  tModel':.       
+0000d750: 2020 2020 2020 2020 206d 6f64 656c 3120           model1 
+0000d760: 3d20 5073 6575 646f 566f 6967 744d 6f64  = PseudoVoigtMod
+0000d770: 656c 2870 7265 6669 783d 276c 7a31 5f27  el(prefix='lz1_'
+0000d780: 2920 232b 2043 6f6e 7374 616e 744d 6f64  ) #+ ConstantMod
+0000d790: 656c 2870 7265 6669 783d 2763 3127 290a  el(prefix='c1').
+0000d7a0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0000d7b0: 7331 203d 206d 6f64 656c 312e 6d61 6b65  s1 = model1.make
+0000d7c0: 5f70 6172 616d 7328 290a 2020 2020 2020  _params().      
+0000d7d0: 2020 2020 2020 7061 7273 315b 276c 7a31        pars1['lz1
+0000d7e0: 5f27 2b20 2761 6d70 6c69 7475 6465 275d  _'+ 'amplitude']
+0000d7f0: 2e73 6574 2863 616c 635f 6469 6164 5f61  .set(calc_diad_a
+0000d800: 6d70 6c69 7475 6465 2c20 6d69 6e3d 302c  mplitude, min=0,
+0000d810: 206d 6178 3d63 616c 635f 6469 6164 5f61   max=calc_diad_a
+0000d820: 6d70 6c69 7475 6465 2a31 3029 0a0a 2020  mplitude*10)..  
+0000d830: 2020 2020 2020 2020 2020 7061 7273 315b            pars1[
+0000d840: 276c 7a31 5f27 2b20 2763 656e 7465 7227  'lz1_'+ 'center'
+0000d850: 5d2e 7365 7428 4365 6e74 6572 5f69 6e69  ].set(Center_ini
+0000d860: 2c20 6d69 6e3d 4365 6e74 6572 5f69 6e69  , min=Center_ini
+0000d870: 2d33 2a73 7065 635f 7265 732c 206d 6178  -3*spec_res, max
+0000d880: 3d43 656e 7465 725f 696e 692b 332a 7370  =Center_ini+3*sp
+0000d890: 6563 5f72 6573 290a 0a20 2020 2020 2020  ec_res)..       
+0000d8a0: 2020 2020 2070 6172 7331 5b27 6c7a 315f       pars1['lz1_
+0000d8b0: 272b 2027 7369 676d 6127 5d2e 7365 7428  '+ 'sigma'].set(
+0000d8c0: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
+0000d8d0: 6d61 2c20 6d69 6e3d 636f 6e66 6967 312e  ma, min=config1.
+0000d8e0: 6469 6164 5f73 6967 6d61 2a63 6f6e 6669  diad_sigma*confi
+0000d8f0: 6731 2e64 6961 645f 7369 676d 615f 6d69  g1.diad_sigma_mi
+0000d900: 6e5f 616c 6c6f 7761 6e63 652c 0a20 2020  n_allowance,.   
+0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d920: 2020 2020 206d 6178 3d63 6f6e 6669 6731       max=config1
+0000d930: 2e64 6961 645f 7369 676d 612a 636f 6e66  .diad_sigma*conf
+0000d940: 6967 312e 6469 6164 5f73 6967 6d61 5f6d  ig1.diad_sigma_m
+0000d950: 6178 5f61 6c6c 6f77 616e 6365 290a 0a0a  ax_allowance)...
+0000d960: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000d970: 2066 6974 5f70 6561 6b73 3e31 3a0a 2020   fit_peaks>1:.  
+0000d980: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000d990: 6465 6c5f 463d 6d6f 6465 6c31 0a20 2020  del_F=model1.   
+0000d9a0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000d9b0: 616d 733d 7061 7273 310a 0a20 2020 2020  ams=pars1..     
+0000d9c0: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
+0000d9d0: 616b 733d 3d32 3a0a 0a20 2020 2020 2020  aks==2:..       
+0000d9e0: 2020 2020 2020 2020 2023 2053 6563 6f6e           # Secon
+0000d9f0: 6420 7765 6520 7065 616b 0a20 2020 2020  d wee peak.     
+0000da00: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
+0000da10: 783d 276c 7a32 5f27 0a20 2020 2020 2020  x='lz2_'.       
+0000da20: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+0000da30: 6967 312e 6d6f 6465 6c5f 6e61 6d65 3d3d  ig1.model_name==
+0000da40: 2756 6f69 6774 4d6f 6465 6c27 3a0a 2020  'VoigtModel':.  
+0000da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da60: 2020 7065 616b 203d 2056 6f69 6774 4d6f    peak = VoigtMo
+0000da70: 6465 6c28 7072 6566 6978 3d27 6c7a 325f  del(prefix='lz2_
+0000da80: 2729 2320 2b20 436f 6e73 7461 6e74 4d6f  ')# + ConstantMo
+0000da90: 6465 6c28 7072 6566 6978 3d27 6331 2729  del(prefix='c1')
+0000daa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dab0: 2069 6620 636f 6e66 6967 312e 6d6f 6465   if config1.mode
+0000dac0: 6c5f 6e61 6d65 3d3d 2750 7365 7564 6f56  l_name=='PseudoV
+0000dad0: 6f69 6774 4d6f 6465 6c27 3a0a 2020 2020  oigtModel':.    
+0000dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000daf0: 7065 616b 203d 2050 7365 7564 6f56 6f69  peak = PseudoVoi
+0000db00: 6774 4d6f 6465 6c28 7072 6566 6978 3d27  gtModel(prefix='
+0000db10: 6c7a 325f 2729 2320 2b20 436f 6e73 7461  lz2_')# + Consta
+0000db20: 6e74 4d6f 6465 6c28 7072 6566 6978 3d27  ntModel(prefix='
+0000db30: 6331 2729 0a0a 2020 2020 2020 2020 2020  c1')..          
+0000db40: 2020 2020 2020 7061 7273 203d 2070 6561        pars = pea
+0000db50: 6b2e 6d61 6b65 5f70 6172 616d 7328 290a  k.make_params().
+0000db60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000db70: 2070 6172 735b 7072 6566 6978 202b 2027   pars[prefix + '
+0000db80: 6365 6e74 6572 275d 2e73 6574 2848 425f  center'].set(HB_
+0000db90: 696e 6974 6961 6c5f 6775 6573 732c 0a20  initial_guess,. 
+0000dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbb0: 2020 206d 696e 3d48 425f 696e 6974 6961     min=HB_initia
+0000dbc0: 6c5f 6775 6573 732d 322a 7370 6563 5f72  l_guess-2*spec_r
+0000dbd0: 6573 2c20 6d61 783d 4842 5f69 6e69 7469  es, max=HB_initi
+0000dbe0: 616c 5f67 7565 7373 2b32 290a 0a20 2020  al_guess+2)..   
+0000dbf0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000dc00: 735b 7072 6566 6978 202b 2027 616d 706c  s[prefix + 'ampl
+0000dc10: 6974 7564 6527 5d2e 7365 7428 6361 6c63  itude'].set(calc
+0000dc20: 5f48 425f 616d 706c 6974 7564 652c 206d  _HB_amplitude, m
+0000dc30: 696e 3d41 6d70 6c69 7475 6465 5f69 6e69  in=Amplitude_ini
+0000dc40: 2a63 6f6e 6669 6731 2e48 425f 616d 705f  *config1.HB_amp_
+0000dc50: 6d69 6e5f 616c 6c6f 7761 6e63 652c 206d  min_allowance, m
+0000dc60: 6178 3d41 6d70 6c69 7475 6465 5f69 6e69  ax=Amplitude_ini
+0000dc70: 2a63 6f6e 6669 6731 2e48 425f 616d 705f  *config1.HB_amp_
+0000dc80: 6d61 785f 616c 6c6f 7761 6e63 6529 0a20  max_allowance). 
+0000dc90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000dca0: 6172 735b 7072 6566 6978 2b20 2773 6967  ars[prefix+ 'sig
+0000dcb0: 6d61 275d 2e73 6574 2873 6967 6d61 5f69  ma'].set(sigma_i
+0000dcc0: 6e69 2c20 6d69 6e3d 7369 676d 615f 696e  ni, min=sigma_in
+0000dcd0: 692a 636f 6e66 6967 312e 4842 5f73 6967  i*config1.HB_sig
+0000dce0: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+0000dcf0: 2c20 6d61 783d 7369 676d 615f 696e 692a  , max=sigma_ini*
+0000dd00: 636f 6e66 6967 312e 4842 5f73 6967 6d61  config1.HB_sigma
+0000dd10: 5f6d 6178 5f61 6c6c 6f77 616e 6365 290a  _max_allowance).
+0000dd20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dd30: 2020 6d6f 6465 6c5f 463d 6d6f 6465 6c31    model_F=model1
+0000dd40: 2b70 6561 6b0a 0a20 2020 2020 2020 2020  +peak..         
+0000dd50: 2020 2020 2020 2023 2075 7064 6174 696e         # updatin
+0000dd60: 6720 7061 7273 2031 2077 6974 6820 7661  g pars 1 with va
+0000dd70: 6c75 6573 2069 6e20 7061 7273 0a20 2020  lues in pars.   
+0000dd80: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000dd90: 7331 2e75 7064 6174 6528 7061 7273 290a  s1.update(pars).
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 7061 7261 6d73 3d70 6172 7331 0a0a 0a20  params=pars1... 
+0000ddc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000ddd0: 2041 7474 656d 7074 2061 7420 7374 6162   Attempt at stab
+0000dde0: 696c 697a 696e 6720 7065 616b 2066 6974  ilizing peak fit
+0000ddf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000de00: 2072 6573 756c 7420 3d20 6d6f 6465 6c5f   result = model_
+0000de10: 462e 6669 7428 7964 6174 2c20 7061 7273  F.fit(ydat, pars
+0000de20: 312c 2078 3d78 6461 7429 0a20 2020 2020  1, x=xdat).     
+0000de30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000de40: 742e 7061 7261 6d73 5b27 6c7a 325f 6365  t.params['lz2_ce
+0000de50: 6e74 6572 275d 2e76 6172 7920 3d20 4661  nter'].vary = Fa
+0000de60: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000de70: 2020 2020 7265 7375 6c74 2e70 6172 616d      result.param
+0000de80: 735b 276c 7a32 5f61 6d70 6c69 7475 6465  s['lz2_amplitude
+0000de90: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
+0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000deb0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
+0000dec0: 7a32 5f73 6967 6d61 275d 2e76 6172 7920  z2_sigma'].vary 
+0000ded0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000dee0: 2020 2020 2020 2020 6669 6e61 6c5f 7265          final_re
+0000def0: 7375 6c74 203d 206d 6f64 656c 5f46 2e66  sult = model_F.f
+0000df00: 6974 2879 6461 742c 2072 6573 756c 742e  it(ydat, result.
+0000df10: 7061 7261 6d73 2c20 783d 7864 6174 290a  params, x=xdat).
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df30: 7061 7261 6d73 2e75 7064 6174 6528 6669  params.update(fi
+0000df40: 6e61 6c5f 7265 7375 6c74 2e70 6172 616d  nal_result.param
+0000df50: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000df60: 2020 2070 6172 616d 732e 7570 6461 7465     params.update
+0000df70: 2866 696e 616c 5f72 6573 756c 742e 7061  (final_result.pa
+0000df80: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+0000df90: 2020 2020 2020 7265 7375 6c74 3d66 696e        result=fin
+0000dfa0: 616c 5f72 6573 756c 740a 0a0a 0a0a 0a0a  al_result.......
+0000dfb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000dfc0: 6669 745f 7065 616b 733d 3d33 3a0a 2020  fit_peaks==3:.  
+0000dfd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000dfe0: 2062 6c6f 636b 5f70 7269 6e74 2069 7320   block_print is 
+0000dff0: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
+0000e000: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000e010: 2827 5472 7969 6e67 2074 6f20 6974 6572  ('Trying to iter
+0000e020: 6174 6976 656c 7920 6669 7420 3320 7065  atively fit 3 pe
+0000e030: 616b 7327 290a 0a20 2020 2020 2020 2020  aks')..         
+0000e040: 2020 2020 2020 2070 6561 6b5f 706f 735f         peak_pos_
+0000e050: 6c65 6674 3d6e 702e 6172 7261 7928 5b48  left=np.array([H
+0000e060: 425f 696e 6974 6961 6c5f 6775 6573 732c  B_initial_guess,
+0000e070: 2043 3133 5f69 6e69 7469 616c 5f67 7565   C13_initial_gue
+0000e080: 7373 5d29 0a0a 2020 2020 2020 2020 2020  ss])..          
+0000e090: 2020 2020 2020 666f 7220 692c 2063 656e        for i, cen
+0000e0a0: 2069 6e20 656e 756d 6572 6174 6528 7065   in enumerate(pe
+0000e0b0: 616b 5f70 6f73 5f6c 6566 7429 3a0a 0a20  ak_pos_left):.. 
+0000e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0d0: 2020 2069 6620 693d 3d30 3a20 2320 5468     if i==0: # Th
+0000e0e0: 6973 2069 7320 7468 6520 686f 7462 616e  is is the hotban
+0000e0f0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0000e100: 2020 2020 2020 2020 2020 7065 616b 2c20            peak, 
+0000e110: 7061 7273 203d 2061 6464 5f70 6561 6b28  pars = add_peak(
+0000e120: 7072 6566 6978 3d27 6c7a 2564 5f27 2025  prefix='lz%d_' %
+0000e130: 2028 692b 3229 2c20 6365 6e74 6572 3d63   (i+2), center=c
+0000e140: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
+0000e150: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
+0000e160: 6365 6e74 3d63 656e 2d33 2a73 7065 635f  cent=cen-3*spec_
+0000e170: 7265 732c 206d 6178 5f63 656e 743d 6365  res, max_cent=ce
+0000e180: 6e2b 332a 7370 6563 5f72 6573 2c20 7369  n+3*spec_res, si
+0000e190: 676d 613d 7369 676d 615f 696e 692c 0a20  gma=sigma_ini,. 
+0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1b0: 2020 2020 2020 206d 696e 5f73 6967 6d61         min_sigma
+0000e1c0: 3d73 6967 6d61 5f69 6e69 2a63 6f6e 6669  =sigma_ini*confi
+0000e1d0: 6731 2e48 425f 7369 676d 615f 6d69 6e5f  g1.HB_sigma_min_
+0000e1e0: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
+0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e200: 2020 206d 6178 5f73 6967 6d61 3d73 6967     max_sigma=sig
+0000e210: 6d61 5f69 6e69 2a63 6f6e 6669 6731 2e48  ma_ini*config1.H
+0000e220: 425f 7369 676d 615f 6d61 785f 616c 6c6f  B_sigma_max_allo
+0000e230: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
+0000e240: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000e250: 6d70 6c69 7475 6465 3d63 616c 635f 4842  mplitude=calc_HB
+0000e260: 5f61 6d70 6c69 7475 6465 2c0a 2020 2020  _amplitude,.    
+0000e270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e280: 2020 2020 6d69 6e5f 616d 706c 6974 7564      min_amplitud
+0000e290: 653d 416d 706c 6974 7564 655f 696e 692a  e=Amplitude_ini*
+0000e2a0: 636f 6e66 6967 312e 4842 5f61 6d70 5f6d  config1.HB_amp_m
+0000e2b0: 696e 5f61 6c6c 6f77 616e 6365 2c0a 2020  in_allowance,.  
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2d0: 2020 2020 2020 6d61 785f 616d 706c 6974        max_amplit
+0000e2e0: 7564 653d 416d 706c 6974 7564 655f 696e  ude=Amplitude_in
+0000e2f0: 692a 636f 6e66 6967 312e 4842 5f61 6d70  i*config1.HB_amp
+0000e300: 5f6d 6178 5f61 6c6c 6f77 616e 6365 2c0a  _max_allowance,.
+0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e320: 2020 2020 2020 2020 6d6f 6465 6c5f 6e61          model_na
+0000e330: 6d65 3d63 6f6e 6669 6731 2e6d 6f64 656c  me=config1.model
+0000e340: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
+0000e350: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000e360: 6f64 656c 203d 2070 6561 6b2b 6d6f 6465  odel = peak+mode
+0000e370: 6c31 0a20 2020 2020 2020 2020 2020 2020  l1.             
+0000e380: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000e390: 732e 7570 6461 7465 2870 6172 7329 0a20  s.update(pars). 
+0000e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3b0: 2020 2069 6620 693d 3d31 3a20 2320 5468     if i==1: # Th
+0000e3c0: 6973 2069 7320 6331 330a 2020 2020 2020  is is c13.      
 0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3e0: 2020 2020 2020 2020 7369 676d 613d 7369          sigma=si
-0000e3f0: 676d 615f 696e 692f 352c 0a20 2020 2020  gma_ini/5,.     
-0000e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e410: 2020 206d 696e 5f73 6967 6d61 3d73 6967     min_sigma=sig
-0000e420: 6d61 5f69 6e69 2f32 302c 0a20 2020 2020  ma_ini/20,.     
-0000e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e440: 2020 206d 6178 5f73 6967 6d61 3d73 6967     max_sigma=sig
-0000e450: 6d61 5f69 6e69 2f32 2c0a 2020 2020 2020  ma_ini/2,.      
-0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e470: 2020 616d 706c 6974 7564 653d 6361 6c63    amplitude=calc
-0000e480: 5f43 3133 5f61 6d70 6c69 7475 6465 2c0a  _C13_amplitude,.
-0000e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4a0: 2020 2020 2020 2020 6d69 6e5f 616d 706c          min_ampl
-0000e4b0: 6974 7564 653d 6361 6c63 5f43 3133 5f61  itude=calc_C13_a
-0000e4c0: 6d70 6c69 7475 6465 2a28 302e 352a 636f  mplitude*(0.5*co
-0000e4d0: 6e66 6967 312e 4842 5f61 6d70 5f6d 696e  nfig1.HB_amp_min
-0000e4e0: 5f61 6c6c 6f77 616e 6365 292c 0a20 2020  _allowance),.   
+0000e3e0: 2020 7065 616b 2c20 7061 7273 203d 2061    peak, pars = a
+0000e3f0: 6464 5f70 6561 6b28 7072 6566 6978 3d27  dd_peak(prefix='
+0000e400: 6c7a 2564 5f27 2025 2028 692b 3229 2c20  lz%d_' % (i+2), 
+0000e410: 6365 6e74 6572 3d63 656e 2c0a 2020 2020  center=cen,.    
+0000e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e430: 2020 2020 6d69 6e5f 6365 6e74 3d63 656e      min_cent=cen
+0000e440: 2d33 2a73 7065 635f 7265 732c 206d 6178  -3*spec_res, max
+0000e450: 5f63 656e 743d 6365 6e2b 332a 7370 6563  _cent=cen+3*spec
+0000e460: 5f72 6573 2c0a 2020 2020 2020 2020 2020  _res,.          
+0000e470: 2020 2020 2020 2020 2020 2020 2020 7369                si
+0000e480: 676d 613d 7369 676d 615f 696e 692f 352c  gma=sigma_ini/5,
+0000e490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e4a0: 2020 2020 2020 2020 206d 696e 5f73 6967           min_sig
+0000e4b0: 6d61 3d73 6967 6d61 5f69 6e69 2f32 302c  ma=sigma_ini/20,
+0000e4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e4d0: 2020 2020 2020 2020 206d 6178 5f73 6967           max_sig
+0000e4e0: 6d61 3d73 6967 6d61 5f69 6e69 2f32 2c0a  ma=sigma_ini/2,.
 0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e500: 2020 2020 206d 6178 5f61 6d70 6c69 7475       max_amplitu
-0000e510: 6465 3d63 616c 635f 4331 335f 616d 706c  de=calc_C13_ampl
-0000e520: 6974 7564 652a 322a 2863 6f6e 6669 6731  itude*2*(config1
-0000e530: 2e48 425f 616d 705f 6d61 785f 616c 6c6f  .HB_amp_max_allo
-0000e540: 7761 6e63 6529 2c0a 2020 2020 2020 2020  wance),.        
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e560: 6d6f 6465 6c5f 6e61 6d65 3d63 6f6e 6669  model_name=confi
-0000e570: 6731 2e6d 6f64 656c 5f6e 616d 6529 0a20  g1.model_name). 
-0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e590: 2020 2020 2020 206d 6f64 656c 203d 2070         model = p
-0000e5a0: 6561 6b2b 6d6f 6465 6c0a 2020 2020 2020  eak+model.      
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5c0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
-0000e5d0: 7061 7273 290a 0a0a 0a0a 2020 2020 2020  pars).....      
-0000e5e0: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-0000e5f0: 463d 6d6f 6465 6c0a 0a0a 0a20 2020 2020  F=model....     
-0000e600: 2020 2020 2020 2020 2020 2023 2041 7474             # Att
-0000e610: 656d 7074 2061 7420 7374 6162 696c 697a  empt at stabiliz
-0000e620: 696e 6720 7065 616b 2066 6974 0a20 2020  ing peak fit.   
-0000e630: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000e640: 756c 7420 3d20 6d6f 6465 6c5f 462e 6669  ult = model_F.fi
-0000e650: 7428 7964 6174 2c20 7061 7273 312c 2078  t(ydat, pars1, x
-0000e660: 3d78 6461 7429 0a20 2020 2020 2020 2020  =xdat).         
-0000e670: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
-0000e680: 7261 6d73 5b27 6c7a 325f 6365 6e74 6572  rams['lz2_center
-0000e690: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
-0000e6c0: 7a32 5f61 6d70 6c69 7475 6465 275d 2e76  z2_amplitude'].v
-0000e6d0: 6172 7920 3d20 4661 6c73 650a 2020 2020  ary = False.    
-0000e6e0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000e6f0: 6c74 2e70 6172 616d 735b 276c 7a32 5f73  lt.params['lz2_s
-0000e700: 6967 6d61 275d 2e76 6172 7920 3d20 4661  igma'].vary = Fa
-0000e710: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000e720: 2020 2020 7265 7375 6c74 2e70 6172 616d      result.param
-0000e730: 735b 276c 7a33 5f63 656e 7465 7227 5d2e  s['lz3_center'].
-0000e740: 7661 7279 203d 2046 616c 7365 0a20 2020  vary = False.   
-0000e750: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0000e760: 756c 742e 7061 7261 6d73 5b27 6c7a 335f  ult.params['lz3_
-0000e770: 616d 706c 6974 7564 6527 5d2e 7661 7279  amplitude'].vary
-0000e780: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0000e790: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-0000e7a0: 7061 7261 6d73 5b27 6c7a 335f 7369 676d  params['lz3_sigm
-0000e7b0: 6127 5d2e 7661 7279 203d 2046 616c 7365  a'].vary = False
-0000e7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e7d0: 2066 696e 616c 5f72 6573 756c 7420 3d20   final_result = 
-0000e7e0: 6d6f 6465 6c5f 462e 6669 7428 7964 6174  model_F.fit(ydat
-0000e7f0: 2c20 7265 7375 6c74 2e70 6172 616d 732c  , result.params,
-0000e800: 2078 3d78 6461 7429 0a20 2020 2020 2020   x=xdat).       
-0000e810: 2020 2020 2020 2020 2070 6172 616d 732e           params.
-0000e820: 7570 6461 7465 2866 696e 616c 5f72 6573  update(final_res
-0000e830: 756c 742e 7061 7261 6d73 290a 2020 2020  ult.params).    
-0000e840: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0000e850: 6d73 2e75 7064 6174 6528 6669 6e61 6c5f  ms.update(final_
-0000e860: 7265 7375 6c74 2e70 6172 616d 7329 0a20  result.params). 
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e880: 6573 756c 743d 6669 6e61 6c5f 7265 7375  esult=final_resu
-0000e890: 6c74 0a0a 0a0a 0a20 2020 2023 2053 616d  lt.....    # Sam
-0000e8a0: 652c 2062 7574 2061 6c73 6f20 7769 7468  e, but also with
-0000e8b0: 2061 2047 6175 7373 6961 6e20 4261 636b   a Gaussian Back
-0000e8c0: 6772 6f75 6e64 0a20 2020 2069 6620 636f  ground.    if co
-0000e8d0: 6e66 6967 312e 6669 745f 6761 7573 7320  nfig1.fit_gauss 
-0000e8e0: 6973 206e 6f74 2046 616c 7365 3a0a 0a0a  is not False:...
-0000e8f0: 2020 2020 2020 2020 2320 6d61 6b69 6e67          # making
-0000e900: 2074 6865 2067 6175 7373 6961 6e20 6d6f   the gaussian mo
-0000e910: 6465 6c0a 2020 2020 2020 2020 6d6f 6465  del.        mode
-0000e920: 6c31 203d 2047 6175 7373 6961 6e4d 6f64  l1 = GaussianMod
-0000e930: 656c 2870 7265 6669 783d 2762 6b67 5f27  el(prefix='bkg_'
-0000e940: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
-0000e950: 203d 206d 6f64 656c 312e 6d61 6b65 5f70   = model1.make_p
-0000e960: 6172 616d 7328 290a 2020 2020 2020 2020  arams().        
-0000e970: 7061 7261 6d73 5b27 626b 675f 272b 2761  params['bkg_'+'a
-0000e980: 6d70 6c69 7475 6465 275d 2e73 6574 2863  mplitude'].set(c
-0000e990: 6f6e 6669 6731 2e67 6175 7373 5f61 6d70  onfig1.gauss_amp
-0000e9a0: 2c20 6d69 6e3d 636f 6e66 6967 312e 6761  , min=config1.ga
-0000e9b0: 7573 735f 616d 702f 3130 302c 206d 6178  uss_amp/100, max
-0000e9c0: 3d63 6f6e 6669 6731 2e67 6175 7373 5f61  =config1.gauss_a
-0000e9d0: 6d70 2a31 3029 0a20 2020 2020 2020 2070  mp*10).        p
-0000e9e0: 6172 616d 735b 2762 6b67 5f27 2b27 7369  arams['bkg_'+'si
-0000e9f0: 676d 6127 5d2e 7365 7428 7369 676d 615f  gma'].set(sigma_
-0000ea00: 696e 692a 3135 2c20 6d69 6e3d 7369 676d  ini*15, min=sigm
-0000ea10: 615f 696e 692a 3130 2c20 6d61 783d 7369  a_ini*10, max=si
-0000ea20: 676d 615f 696e 692a 3235 290a 2020 2020  gma_ini*25).    
-0000ea30: 2020 2020 7061 7261 6d73 5b27 626b 675f      params['bkg_
-0000ea40: 272b 2763 656e 7465 7227 5d2e 7365 7428  '+'center'].set(
-0000ea50: 696e 6974 6961 6c5f 6775 6573 732c 206d  initial_guess, m
-0000ea60: 696e 3d69 6e69 7469 616c 5f67 7565 7373  in=initial_guess
-0000ea70: 2d37 2c20 6d61 783d 696e 6974 6961 6c5f  -7, max=initial_
-0000ea80: 6775 6573 732b 3729 0a0a 0a0a 2020 2020  guess+7)....    
-0000ea90: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
-0000eaa0: 3d3d 323a 0a20 2020 2020 2020 2020 2020  ==2:.           
-0000eab0: 2070 6561 6b5f 706f 735f 766f 6967 743d   peak_pos_voigt=
-0000eac0: 6e70 2e61 7272 6179 285b 696e 6974 6961  np.array([initia
-0000ead0: 6c5f 6775 6573 732c 2048 425f 696e 6974  l_guess, HB_init
-0000eae0: 6961 6c5f 6775 6573 735d 290a 0a20 2020  ial_guess])..   
-0000eaf0: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0000eb00: 6365 6e20 696e 2065 6e75 6d65 7261 7465  cen in enumerate
-0000eb10: 2870 6561 6b5f 706f 735f 766f 6967 7429  (peak_pos_voigt)
-0000eb20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000eb30: 2020 6966 2069 3d3d 303a 2023 2054 6869    if i==0: # Thi
-0000eb40: 7320 6973 2074 6865 2044 6961 640a 2020  s is the Diad.  
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb60: 2020 7065 616b 2c20 7061 7273 203d 2061    peak, pars = a
-0000eb70: 6464 5f70 6561 6b28 7072 6566 6978 3d27  dd_peak(prefix='
-0000eb80: 6c7a 2564 5f27 2025 2028 692b 3129 2c0a  lz%d_' % (i+1),.
-0000eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eba0: 6365 6e74 6572 3d43 656e 7465 725f 696e  center=Center_in
-0000ebb0: 692c 206d 696e 5f63 656e 743d 6365 6e2d  i, min_cent=cen-
-0000ebc0: 332a 7370 6563 5f72 6573 2c20 6d61 785f  3*spec_res, max_
-0000ebd0: 6365 6e74 3d63 656e 2b33 2a73 7065 635f  cent=cen+3*spec_
-0000ebe0: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
-0000ebf0: 2020 2020 2073 6967 6d61 3d63 6f6e 6669       sigma=confi
-0000ec00: 6731 2e64 6961 645f 7369 676d 612c 0a20  g1.diad_sigma,. 
-0000ec10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000ec20: 6178 5f73 6967 6d61 3d63 6f6e 6669 6731  ax_sigma=config1
-0000ec30: 2e64 6961 645f 7369 676d 612a 636f 6e66  .diad_sigma*conf
-0000ec40: 6967 312e 6469 6164 5f73 6967 6d61 5f6d  ig1.diad_sigma_m
-0000ec50: 6178 5f61 6c6c 6f77 616e 6365 2c0a 2020  ax_allowance,.  
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000ec70: 6e5f 7369 676d 613d 636f 6e66 6967 312e  n_sigma=config1.
-0000ec80: 6469 6164 5f73 6967 6d61 2a63 6f6e 6669  diad_sigma*confi
-0000ec90: 6731 2e64 6961 645f 7369 676d 615f 6d69  g1.diad_sigma_mi
-0000eca0: 6e5f 616c 6c6f 7761 6e63 652c 0a20 2020  n_allowance,.   
-0000ecb0: 2020 2020 2020 2020 2020 2020 2061 6d70               amp
-0000ecc0: 6c69 7475 6465 3d63 616c 635f 6469 6164  litude=calc_diad
-0000ecd0: 5f61 6d70 6c69 7475 6465 2c20 6d69 6e5f  _amplitude, min_
-0000ece0: 616d 706c 6974 7564 653d 302c 206d 6178  amplitude=0, max
-0000ecf0: 5f61 6d70 6c69 7475 6465 3d31 302a 6361  _amplitude=10*ca
-0000ed00: 6c63 5f64 6961 645f 616d 706c 6974 7564  lc_diad_amplitud
-0000ed10: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000ed20: 2020 206d 6f64 656c 5f6e 616d 653d 636f     model_name=co
-0000ed30: 6e66 6967 312e 6d6f 6465 6c5f 6e61 6d65  nfig1.model_name
-0000ed40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ed50: 2020 6d6f 6465 6c20 3d20 7065 616b 2b6d    model = peak+m
-0000ed60: 6f64 656c 310a 2020 2020 2020 2020 2020  odel1.          
-0000ed70: 2020 2020 2020 7061 7261 6d73 2e75 7064        params.upd
-0000ed80: 6174 6528 7061 7273 290a 0a20 2020 2020  ate(pars)..     
-0000ed90: 2020 2020 2020 2020 2020 2069 6620 693d             if i=
-0000eda0: 3d31 3a20 2320 5468 6973 2069 7320 7468  =1: # This is th
-0000edb0: 6520 686f 7462 616e 640a 2020 2020 2020  e hotband.      
-0000edc0: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-0000edd0: 616b 2c20 7061 7273 203d 2061 6464 5f70  ak, pars = add_p
-0000ede0: 6561 6b28 7072 6566 6978 3d27 6c7a 2564  eak(prefix='lz%d
-0000edf0: 5f27 2025 2028 692b 3129 2c20 6365 6e74  _' % (i+1), cent
-0000ee00: 6572 3d63 656e 2c0a 2020 2020 2020 2020  er=cen,.        
-0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee20: 6d69 6e5f 6365 6e74 3d63 656e 2d33 2a73  min_cent=cen-3*s
-0000ee30: 7065 635f 7265 732c 206d 6178 5f63 656e  pec_res, max_cen
-0000ee40: 743d 6365 6e2b 332a 7370 6563 5f72 6573  t=cen+3*spec_res
-0000ee50: 2c20 7369 676d 613d 7369 676d 615f 696e  , sigma=sigma_in
-0000ee60: 692c 0a20 2020 2020 2020 2020 2020 2020  i,.             
-0000ee70: 2020 2020 2020 2020 2020 206d 696e 5f73             min_s
-0000ee80: 6967 6d61 3d73 6967 6d61 5f69 6e69 2a63  igma=sigma_ini*c
-0000ee90: 6f6e 6669 6731 2e48 425f 7369 676d 615f  onfig1.HB_sigma_
-0000eea0: 6d69 6e5f 616c 6c6f 7761 6e63 652c 0a20  min_allowance,. 
-0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eec0: 2020 2020 2020 206d 6178 5f73 6967 6d61         max_sigma
-0000eed0: 3d73 6967 6d61 5f69 6e69 2a63 6f6e 6669  =sigma_ini*confi
-0000eee0: 6731 2e48 425f 7369 676d 615f 6d61 785f  g1.HB_sigma_max_
-0000eef0: 616c 6c6f 7761 6e63 652c 0a20 2020 2020  allowance,.     
+0000e500: 2020 2020 2020 2020 616d 706c 6974 7564          amplitud
+0000e510: 653d 6361 6c63 5f43 3133 5f61 6d70 6c69  e=calc_C13_ampli
+0000e520: 7475 6465 2c0a 2020 2020 2020 2020 2020  tude,.          
+0000e530: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0000e540: 6e5f 616d 706c 6974 7564 653d 6361 6c63  n_amplitude=calc
+0000e550: 5f43 3133 5f61 6d70 6c69 7475 6465 2a28  _C13_amplitude*(
+0000e560: 302e 352a 636f 6e66 6967 312e 4842 5f61  0.5*config1.HB_a
+0000e570: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
+0000e580: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000e590: 2020 2020 2020 2020 2020 206d 6178 5f61             max_a
+0000e5a0: 6d70 6c69 7475 6465 3d63 616c 635f 4331  mplitude=calc_C1
+0000e5b0: 335f 616d 706c 6974 7564 652a 322a 2863  3_amplitude*2*(c
+0000e5c0: 6f6e 6669 6731 2e48 425f 616d 705f 6d61  onfig1.HB_amp_ma
+0000e5d0: 785f 616c 6c6f 7761 6e63 6529 2c0a 2020  x_allowance),.  
+0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5f0: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
+0000e600: 3d63 6f6e 6669 6731 2e6d 6f64 656c 5f6e  =config1.model_n
+0000e610: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0000e620: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000e630: 656c 203d 2070 6561 6b2b 6d6f 6465 6c0a  el = peak+model.
+0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
+0000e660: 7064 6174 6528 7061 7273 290a 0a0a 0a0a  pdate(pars).....
+0000e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e680: 6d6f 6465 6c5f 463d 6d6f 6465 6c0a 0a0a  model_F=model...
+0000e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e6a0: 2023 2041 7474 656d 7074 2061 7420 7374   # Attempt at st
+0000e6b0: 6162 696c 697a 696e 6720 7065 616b 2066  abilizing peak f
+0000e6c0: 6974 0a20 2020 2020 2020 2020 2020 2020  it.             
+0000e6d0: 2020 2072 6573 756c 7420 3d20 6d6f 6465     result = mode
+0000e6e0: 6c5f 462e 6669 7428 7964 6174 2c20 7061  l_F.fit(ydat, pa
+0000e6f0: 7273 312c 2078 3d78 6461 7429 0a20 2020  rs1, x=xdat).   
+0000e700: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000e710: 756c 742e 7061 7261 6d73 5b27 6c7a 325f  ult.params['lz2_
+0000e720: 6365 6e74 6572 275d 2e76 6172 7920 3d20  center'].vary = 
+0000e730: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000e740: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
+0000e750: 616d 735b 276c 7a32 5f61 6d70 6c69 7475  ams['lz2_amplitu
+0000e760: 6465 275d 2e76 6172 7920 3d20 4661 6c73  de'].vary = Fals
+0000e770: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000e780: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
+0000e790: 276c 7a32 5f73 6967 6d61 275d 2e76 6172  'lz2_sigma'].var
+0000e7a0: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
+0000e7b0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0000e7c0: 2e70 6172 616d 735b 276c 7a33 5f63 656e  .params['lz3_cen
+0000e7d0: 7465 7227 5d2e 7661 7279 203d 2046 616c  ter'].vary = Fal
+0000e7e0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0000e7f0: 2020 2072 6573 756c 742e 7061 7261 6d73     result.params
+0000e800: 5b27 6c7a 335f 616d 706c 6974 7564 6527  ['lz3_amplitude'
+0000e810: 5d2e 7661 7279 203d 2046 616c 7365 0a20  ].vary = False. 
+0000e820: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e830: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+0000e840: 335f 7369 676d 6127 5d2e 7661 7279 203d  3_sigma'].vary =
+0000e850: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000e860: 2020 2020 2020 2066 696e 616c 5f72 6573         final_res
+0000e870: 756c 7420 3d20 6d6f 6465 6c5f 462e 6669  ult = model_F.fi
+0000e880: 7428 7964 6174 2c20 7265 7375 6c74 2e70  t(ydat, result.p
+0000e890: 6172 616d 732c 2078 3d78 6461 7429 0a20  arams, x=xdat). 
+0000e8a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000e8b0: 6172 616d 732e 7570 6461 7465 2866 696e  arams.update(fin
+0000e8c0: 616c 5f72 6573 756c 742e 7061 7261 6d73  al_result.params
+0000e8d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e8e0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
+0000e8f0: 6669 6e61 6c5f 7265 7375 6c74 2e70 6172  final_result.par
+0000e900: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0000e910: 2020 2020 2072 6573 756c 743d 6669 6e61       result=fina
+0000e920: 6c5f 7265 7375 6c74 0a0a 0a0a 0a20 2020  l_result.....   
+0000e930: 2023 2053 616d 652c 2062 7574 2061 6c73   # Same, but als
+0000e940: 6f20 7769 7468 2061 2047 6175 7373 6961  o with a Gaussia
+0000e950: 6e20 4261 636b 6772 6f75 6e64 0a20 2020  n Background.   
+0000e960: 2069 6620 636f 6e66 6967 312e 6669 745f   if config1.fit_
+0000e970: 6761 7573 7320 6973 206e 6f74 2046 616c  gauss is not Fal
+0000e980: 7365 3a0a 0a0a 2020 2020 2020 2020 2320  se:...        # 
+0000e990: 6d61 6b69 6e67 2074 6865 2067 6175 7373  making the gauss
+0000e9a0: 6961 6e20 6d6f 6465 6c0a 2020 2020 2020  ian model.      
+0000e9b0: 2020 6d6f 6465 6c31 203d 2047 6175 7373    model1 = Gauss
+0000e9c0: 6961 6e4d 6f64 656c 2870 7265 6669 783d  ianModel(prefix=
+0000e9d0: 2762 6b67 5f27 290a 2020 2020 2020 2020  'bkg_').        
+0000e9e0: 7061 7261 6d73 203d 206d 6f64 656c 312e  params = model1.
+0000e9f0: 6d61 6b65 5f70 6172 616d 7328 290a 2020  make_params().  
+0000ea00: 2020 2020 2020 7061 7261 6d73 5b27 626b        params['bk
+0000ea10: 675f 272b 2761 6d70 6c69 7475 6465 275d  g_'+'amplitude']
+0000ea20: 2e73 6574 2863 6f6e 6669 6731 2e67 6175  .set(config1.gau
+0000ea30: 7373 5f61 6d70 2c20 6d69 6e3d 636f 6e66  ss_amp, min=conf
+0000ea40: 6967 312e 6761 7573 735f 616d 702f 3130  ig1.gauss_amp/10
+0000ea50: 302c 206d 6178 3d63 6f6e 6669 6731 2e67  0, max=config1.g
+0000ea60: 6175 7373 5f61 6d70 2a31 3029 0a20 2020  auss_amp*10).   
+0000ea70: 2020 2020 2070 6172 616d 735b 2762 6b67       params['bkg
+0000ea80: 5f27 2b27 7369 676d 6127 5d2e 7365 7428  _'+'sigma'].set(
+0000ea90: 7369 676d 615f 696e 692a 3135 2c20 6d69  sigma_ini*15, mi
+0000eaa0: 6e3d 7369 676d 615f 696e 692a 3130 2c20  n=sigma_ini*10, 
+0000eab0: 6d61 783d 7369 676d 615f 696e 692a 3235  max=sigma_ini*25
+0000eac0: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
+0000ead0: 5b27 626b 675f 272b 2763 656e 7465 7227  ['bkg_'+'center'
+0000eae0: 5d2e 7365 7428 696e 6974 6961 6c5f 6775  ].set(initial_gu
+0000eaf0: 6573 732c 206d 696e 3d69 6e69 7469 616c  ess, min=initial
+0000eb00: 5f67 7565 7373 2d37 2c20 6d61 783d 696e  _guess-7, max=in
+0000eb10: 6974 6961 6c5f 6775 6573 732b 3729 0a0a  itial_guess+7)..
+0000eb20: 0a0a 2020 2020 2020 2020 6966 2066 6974  ..        if fit
+0000eb30: 5f70 6561 6b73 3d3d 323a 0a20 2020 2020  _peaks==2:.     
+0000eb40: 2020 2020 2020 2070 6561 6b5f 706f 735f         peak_pos_
+0000eb50: 766f 6967 743d 6e70 2e61 7272 6179 285b  voigt=np.array([
+0000eb60: 696e 6974 6961 6c5f 6775 6573 732c 2048  initial_guess, H
+0000eb70: 425f 696e 6974 6961 6c5f 6775 6573 735d  B_initial_guess]
+0000eb80: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000eb90: 6f72 2069 2c20 6365 6e20 696e 2065 6e75  or i, cen in enu
+0000eba0: 6d65 7261 7465 2870 6561 6b5f 706f 735f  merate(peak_pos_
+0000ebb0: 766f 6967 7429 3a0a 2020 2020 2020 2020  voigt):.        
+0000ebc0: 2020 2020 2020 2020 6966 2069 3d3d 303a          if i==0:
+0000ebd0: 2023 2054 6869 7320 6973 2074 6865 2044   # This is the D
+0000ebe0: 6961 640a 2020 2020 2020 2020 2020 2020  iad.            
+0000ebf0: 2020 2020 2020 2020 7065 616b 2c20 7061          peak, pa
+0000ec00: 7273 203d 2061 6464 5f70 6561 6b28 7072  rs = add_peak(pr
+0000ec10: 6566 6978 3d27 6c7a 2564 5f27 2025 2028  efix='lz%d_' % (
+0000ec20: 692b 3129 2c0a 2020 2020 2020 2020 2020  i+1),.          
+0000ec30: 2020 2020 2020 6365 6e74 6572 3d43 656e        center=Cen
+0000ec40: 7465 725f 696e 692c 206d 696e 5f63 656e  ter_ini, min_cen
+0000ec50: 743d 6365 6e2d 332a 7370 6563 5f72 6573  t=cen-3*spec_res
+0000ec60: 2c20 6d61 785f 6365 6e74 3d63 656e 2b33  , max_cent=cen+3
+0000ec70: 2a73 7065 635f 7265 732c 0a20 2020 2020  *spec_res,.     
+0000ec80: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
+0000ec90: 3d63 6f6e 6669 6731 2e64 6961 645f 7369  =config1.diad_si
+0000eca0: 676d 612c 0a20 2020 2020 2020 2020 2020  gma,.           
+0000ecb0: 2020 2020 206d 6178 5f73 6967 6d61 3d63       max_sigma=c
+0000ecc0: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
+0000ecd0: 612a 636f 6e66 6967 312e 6469 6164 5f73  a*config1.diad_s
+0000ece0: 6967 6d61 5f6d 6178 5f61 6c6c 6f77 616e  igma_max_allowan
+0000ecf0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0000ed00: 2020 2020 6d69 6e5f 7369 676d 613d 636f      min_sigma=co
+0000ed10: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
+0000ed20: 2a63 6f6e 6669 6731 2e64 6961 645f 7369  *config1.diad_si
+0000ed30: 676d 615f 6d69 6e5f 616c 6c6f 7761 6e63  gma_min_allowanc
+0000ed40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000ed50: 2020 2061 6d70 6c69 7475 6465 3d63 616c     amplitude=cal
+0000ed60: 635f 6469 6164 5f61 6d70 6c69 7475 6465  c_diad_amplitude
+0000ed70: 2c20 6d69 6e5f 616d 706c 6974 7564 653d  , min_amplitude=
+0000ed80: 302c 206d 6178 5f61 6d70 6c69 7475 6465  0, max_amplitude
+0000ed90: 3d31 302a 6361 6c63 5f64 6961 645f 616d  =10*calc_diad_am
+0000eda0: 706c 6974 7564 652c 0a20 2020 2020 2020  plitude,.       
+0000edb0: 2020 2020 2020 2020 206d 6f64 656c 5f6e           model_n
+0000edc0: 616d 653d 636f 6e66 6967 312e 6d6f 6465  ame=config1.mode
+0000edd0: 6c5f 6e61 6d65 290a 2020 2020 2020 2020  l_name).        
+0000ede0: 2020 2020 2020 2020 6d6f 6465 6c20 3d20          model = 
+0000edf0: 7065 616b 2b6d 6f64 656c 310a 2020 2020  peak+model1.    
+0000ee00: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0000ee10: 6d73 2e75 7064 6174 6528 7061 7273 290a  ms.update(pars).
+0000ee20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee30: 2069 6620 693d 3d31 3a20 2320 5468 6973   if i==1: # This
+0000ee40: 2069 7320 7468 6520 686f 7462 616e 640a   is the hotband.
+0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee60: 2020 2020 7065 616b 2c20 7061 7273 203d      peak, pars =
+0000ee70: 2061 6464 5f70 6561 6b28 7072 6566 6978   add_peak(prefix
+0000ee80: 3d27 6c7a 2564 5f27 2025 2028 692b 3129  ='lz%d_' % (i+1)
+0000ee90: 2c20 6365 6e74 6572 3d63 656e 2c0a 2020  , center=cen,.  
+0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eeb0: 2020 2020 2020 6d69 6e5f 6365 6e74 3d63        min_cent=c
+0000eec0: 656e 2d33 2a73 7065 635f 7265 732c 206d  en-3*spec_res, m
+0000eed0: 6178 5f63 656e 743d 6365 6e2b 332a 7370  ax_cent=cen+3*sp
+0000eee0: 6563 5f72 6573 2c20 7369 676d 613d 7369  ec_res, sigma=si
+0000eef0: 676d 615f 696e 692c 0a20 2020 2020 2020  gma_ini,.       
 0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef10: 2020 2061 6d70 6c69 7475 6465 3d63 616c     amplitude=cal
-0000ef20: 635f 4842 5f61 6d70 6c69 7475 6465 2c0a  c_HB_amplitude,.
-0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef40: 2020 2020 2020 2020 6d69 6e5f 616d 706c          min_ampl
-0000ef50: 6974 7564 653d 416d 706c 6974 7564 655f  itude=Amplitude_
-0000ef60: 696e 692a 636f 6e66 6967 312e 4842 5f61  ini*config1.HB_a
-0000ef70: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
-0000ef80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ef90: 2020 2020 2020 2020 2020 6d61 785f 616d            max_am
-0000efa0: 706c 6974 7564 653d 416d 706c 6974 7564  plitude=Amplitud
-0000efb0: 655f 696e 692a 636f 6e66 6967 312e 4842  e_ini*config1.HB
-0000efc0: 5f61 6d70 5f6d 6178 5f61 6c6c 6f77 616e  _amp_max_allowan
-0000efd0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-0000efe0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0000eff0: 6c5f 6e61 6d65 3d63 6f6e 6669 6731 2e6d  l_name=config1.m
-0000f000: 6f64 656c 5f6e 616d 6529 0a20 2020 2020  odel_name).     
-0000f010: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000f020: 6f64 656c 3220 3d20 7065 616b 2b6d 6f64  odel2 = peak+mod
-0000f030: 656c 0a20 2020 2020 2020 2020 2020 2020  el.             
-0000f040: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
-0000f050: 6461 7465 2870 6172 7329 0a0a 0a20 2020  date(pars)...   
-0000f060: 2020 2020 2020 2020 2023 2041 7474 656d           # Attem
-0000f070: 7074 2061 7420 7374 6162 696c 697a 696e  pt at stabilizin
-0000f080: 6720 7065 616b 2066 6974 0a23 2075 7064  g peak fit.# upd
-0000f090: 6174 696e 6720 7061 7273 2031 2077 6974  ating pars 1 wit
-0000f0a0: 6820 7661 6c75 6573 2069 6e20 7061 7273  h values in pars
-0000f0b0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000f0c0: 7375 6c74 203d 206d 6f64 656c 322e 6669  sult = model2.fi
-0000f0d0: 7428 7964 6174 2c20 7061 7261 6d73 2c20  t(ydat, params, 
-0000f0e0: 783d 7864 6174 290a 0a0a 2020 2020 2020  x=xdat)...      
-0000f0f0: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
-0000f100: 7061 7261 6d65 7465 7273 206f 6620 276c  parameters of 'l
-0000f110: 7a31 2720 746f 2062 6520 6669 7865 640a  z1' to be fixed.
-0000f120: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000f130: 6c74 2e70 6172 616d 735b 276c 7a32 5f63  lt.params['lz2_c
-0000f140: 656e 7465 7227 5d2e 7661 7279 203d 2046  enter'].vary = F
-0000f150: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000f160: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
-0000f170: 6c7a 325f 616d 706c 6974 7564 6527 5d2e  lz2_amplitude'].
-0000f180: 7661 7279 203d 2046 616c 7365 0a20 2020  vary = False.   
-0000f190: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-0000f1a0: 7061 7261 6d73 5b27 6c7a 325f 7369 676d  params['lz2_sigm
-0000f1b0: 6127 5d2e 7661 7279 203d 2046 616c 7365  a'].vary = False
-0000f1c0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000f1d0: 756c 742e 7061 7261 6d73 5b27 626b 675f  ult.params['bkg_
-0000f1e0: 6365 6e74 6572 275d 2e76 6172 7920 3d20  center'].vary = 
-0000f1f0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0000f200: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
-0000f210: 2762 6b67 5f61 6d70 6c69 7475 6465 275d  'bkg_amplitude']
-0000f220: 2e76 6172 7920 3d20 4661 6c73 650a 2020  .vary = False.  
-0000f230: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000f240: 2e70 6172 616d 735b 2762 6b67 5f73 6967  .params['bkg_sig
-0000f250: 6d61 275d 2e76 6172 7920 3d20 4661 6c73  ma'].vary = Fals
-0000f260: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
-0000f270: 2050 6572 666f 726d 2066 6974 7469 6e67   Perform fitting
-0000f280: 2075 7369 6e67 2074 6865 2065 6e74 6972   using the entir
-0000f290: 6520 6d6f 6465 6c20 286d 6f64 656c 3229  e model (model2)
-0000f2a0: 2077 6974 6820 7468 6520 7374 6162 696c   with the stabil
-0000f2b0: 697a 6564 2027 6c7a 3127 2070 6172 616d  ized 'lz1' param
-0000f2c0: 6574 6572 730a 2020 2020 2020 2020 2020  eters.          
-0000f2d0: 2020 6669 6e61 6c5f 7265 7375 6c74 203d    final_result =
-0000f2e0: 206d 6f64 656c 322e 6669 7428 7964 6174   model2.fit(ydat
-0000f2f0: 2c20 7265 7375 6c74 2e70 6172 616d 732c  , result.params,
-0000f300: 2078 3d78 6461 7429 0a20 2020 2020 2020   x=xdat).       
-0000f310: 2020 2020 2063 656e 7465 725f 6572 726f       center_erro
-0000f320: 7220 3d20 6669 6e61 6c5f 7265 7375 6c74  r = final_result
-0000f330: 2e70 6172 616d 735b 276c 7a31 5f63 656e  .params['lz1_cen
-0000f340: 7465 7227 5d2e 7374 6465 7272 0a20 2020  ter'].stderr.   
-0000f350: 2020 2020 2020 2020 2070 6172 616d 732e           params.
-0000f360: 7570 6461 7465 2866 696e 616c 5f72 6573  update(final_res
-0000f370: 756c 742e 7061 7261 6d73 290a 0a0a 2020  ult.params)...  
-0000f380: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000f390: 3d66 696e 616c 5f72 6573 756c 740a 2020  =final_result.  
-0000f3a0: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-0000f3b0: 463d 6d6f 6465 6c32 0a0a 0a20 2020 2020  F=model2...     
-0000f3c0: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
-0000f3d0: 3d33 3a0a 2020 2020 2020 2020 2020 2020  =3:.            
-0000f3e0: 7065 616b 5f70 6f73 5f76 6f69 6774 3d6e  peak_pos_voigt=n
-0000f3f0: 702e 6172 7261 7928 5b69 6e69 7469 616c  p.array([initial
-0000f400: 5f67 7565 7373 2c20 4842 5f69 6e69 7469  _guess, HB_initi
-0000f410: 616c 5f67 7565 7373 2c20 4331 335f 696e  al_guess, C13_in
-0000f420: 6974 6961 6c5f 6775 6573 735d 290a 0a20  itial_guess]).. 
-0000f430: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0000f440: 2c20 6365 6e20 696e 2065 6e75 6d65 7261  , cen in enumera
-0000f450: 7465 2870 6561 6b5f 706f 735f 766f 6967  te(peak_pos_voig
-0000f460: 7429 3a0a 0a20 2020 2020 2020 2020 2020  t):..           
-0000f470: 2020 2020 2069 6620 693d 3d30 3a20 2320       if i==0: # 
-0000f480: 5468 6973 2069 7320 7468 6520 4469 6164  This is the Diad
-0000f490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f4a0: 2020 2020 2070 6561 6b2c 2070 6172 7320       peak, pars 
-0000f4b0: 3d20 6164 645f 7065 616b 2870 7265 6669  = add_peak(prefi
-0000f4c0: 783d 276c 7a25 645f 2720 2520 2869 2b31  x='lz%d_' % (i+1
-0000f4d0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000f4e0: 2020 2063 656e 7465 723d 4365 6e74 6572     center=Center
-0000f4f0: 5f69 6e69 2c20 6d69 6e5f 6365 6e74 3d63  _ini, min_cent=c
-0000f500: 656e 2d33 2a73 7065 635f 7265 732c 206d  en-3*spec_res, m
-0000f510: 6178 5f63 656e 743d 6365 6e2b 332a 7370  ax_cent=cen+3*sp
-0000f520: 6563 5f72 6573 2c0a 2020 2020 2020 2020  ec_res,.        
-0000f530: 2020 2020 2020 2020 7369 676d 613d 636f          sigma=co
-0000f540: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
-0000f550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f560: 2020 6d61 785f 7369 676d 613d 636f 6e66    max_sigma=conf
-0000f570: 6967 312e 6469 6164 5f73 6967 6d61 2a63  ig1.diad_sigma*c
-0000f580: 6f6e 6669 6731 2e64 6961 645f 7369 676d  onfig1.diad_sigm
-0000f590: 615f 6d61 785f 616c 6c6f 7761 6e63 652c  a_max_allowance,
-0000f5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f5b0: 206d 696e 5f73 6967 6d61 3d63 6f6e 6669   min_sigma=confi
-0000f5c0: 6731 2e64 6961 645f 7369 676d 612a 636f  g1.diad_sigma*co
-0000f5d0: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
-0000f5e0: 5f6d 696e 5f61 6c6c 6f77 616e 6365 2c0a  _min_allowance,.
-0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f600: 616d 706c 6974 7564 653d 6361 6c63 5f64  amplitude=calc_d
-0000f610: 6961 645f 616d 706c 6974 7564 652c 206d  iad_amplitude, m
-0000f620: 696e 5f61 6d70 6c69 7475 6465 3d30 2c20  in_amplitude=0, 
-0000f630: 6d61 785f 616d 706c 6974 7564 653d 3130  max_amplitude=10
-0000f640: 2a63 616c 635f 6469 6164 5f61 6d70 6c69  *calc_diad_ampli
-0000f650: 7475 6465 2c0a 2020 2020 2020 2020 2020  tude,.          
-0000f660: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
-0000f670: 3d63 6f6e 6669 6731 2e6d 6f64 656c 5f6e  =config1.model_n
-0000f680: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-0000f690: 2020 2020 206d 6f64 656c 203d 2070 6561       model = pea
-0000f6a0: 6b2b 6d6f 6465 6c31 0a20 2020 2020 2020  k+model1.       
-0000f6b0: 2020 2020 2020 2020 2070 6172 616d 732e           params.
-0000f6c0: 7570 6461 7465 2870 6172 7329 0a0a 2020  update(pars)..  
-0000f6d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000f6e0: 2069 3d3d 313a 2023 2054 6869 7320 6973   i==1: # This is
-0000f6f0: 2074 6865 2068 6f74 6261 6e64 0a0a 2020   the hotband..  
-0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f710: 2020 7065 616b 2c20 7061 7273 203d 2061    peak, pars = a
-0000f720: 6464 5f70 6561 6b28 7072 6566 6978 3d27  dd_peak(prefix='
-0000f730: 6c7a 2564 5f27 2025 2028 692b 3129 2c20  lz%d_' % (i+1), 
-0000f740: 6365 6e74 6572 3d63 656e 2c0a 2020 2020  center=cen,.    
-0000f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f760: 2020 2020 6d69 6e5f 6365 6e74 3d63 656e      min_cent=cen
-0000f770: 2d33 2a73 7065 635f 7265 732c 206d 6178  -3*spec_res, max
-0000f780: 5f63 656e 743d 6365 6e2b 332a 7370 6563  _cent=cen+3*spec
-0000f790: 5f72 6573 2c20 7369 676d 613d 7369 676d  _res, sigma=sigm
-0000f7a0: 615f 696e 692c 0a20 2020 2020 2020 2020  a_ini,.         
-0000f7b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000f7c0: 696e 5f73 6967 6d61 3d73 6967 6d61 5f69  in_sigma=sigma_i
-0000f7d0: 6e69 2a63 6f6e 6669 6731 2e48 425f 7369  ni*config1.HB_si
-0000f7e0: 676d 615f 6d69 6e5f 616c 6c6f 7761 6e63  gma_min_allowanc
-0000f7f0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000f800: 2020 2020 2020 2020 2020 206d 6178 5f73             max_s
-0000f810: 6967 6d61 3d73 6967 6d61 5f69 6e69 2a63  igma=sigma_ini*c
-0000f820: 6f6e 6669 6731 2e48 425f 7369 676d 615f  onfig1.HB_sigma_
-0000f830: 6d61 785f 616c 6c6f 7761 6e63 652c 0a20  max_allowance,. 
+0000ef10: 206d 696e 5f73 6967 6d61 3d73 6967 6d61   min_sigma=sigma
+0000ef20: 5f69 6e69 2a63 6f6e 6669 6731 2e48 425f  _ini*config1.HB_
+0000ef30: 7369 676d 615f 6d69 6e5f 616c 6c6f 7761  sigma_min_allowa
+0000ef40: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+0000ef50: 2020 2020 2020 2020 2020 2020 206d 6178               max
+0000ef60: 5f73 6967 6d61 3d73 6967 6d61 5f69 6e69  _sigma=sigma_ini
+0000ef70: 2a63 6f6e 6669 6731 2e48 425f 7369 676d  *config1.HB_sigm
+0000ef80: 615f 6d61 785f 616c 6c6f 7761 6e63 652c  a_max_allowance,
+0000ef90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000efa0: 2020 2020 2020 2020 2061 6d70 6c69 7475           amplitu
+0000efb0: 6465 3d63 616c 635f 4842 5f61 6d70 6c69  de=calc_HB_ampli
+0000efc0: 7475 6465 2c0a 2020 2020 2020 2020 2020  tude,.          
+0000efd0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0000efe0: 6e5f 616d 706c 6974 7564 653d 416d 706c  n_amplitude=Ampl
+0000eff0: 6974 7564 655f 696e 692a 636f 6e66 6967  itude_ini*config
+0000f000: 312e 4842 5f61 6d70 5f6d 696e 5f61 6c6c  1.HB_amp_min_all
+0000f010: 6f77 616e 6365 2c0a 2020 2020 2020 2020  owance,.        
+0000f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f030: 6d61 785f 616d 706c 6974 7564 653d 416d  max_amplitude=Am
+0000f040: 706c 6974 7564 655f 696e 692a 636f 6e66  plitude_ini*conf
+0000f050: 6967 312e 4842 5f61 6d70 5f6d 6178 5f61  ig1.HB_amp_max_a
+0000f060: 6c6c 6f77 616e 6365 2c0a 2020 2020 2020  llowance,.      
+0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f080: 2020 6d6f 6465 6c5f 6e61 6d65 3d63 6f6e    model_name=con
+0000f090: 6669 6731 2e6d 6f64 656c 5f6e 616d 6529  fig1.model_name)
+0000f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f0b0: 2020 2020 206d 6f64 656c 3220 3d20 7065       model2 = pe
+0000f0c0: 616b 2b6d 6f64 656c 0a20 2020 2020 2020  ak+model.       
+0000f0d0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000f0e0: 616d 732e 7570 6461 7465 2870 6172 7329  ams.update(pars)
+0000f0f0: 0a0a 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0000f100: 2041 7474 656d 7074 2061 7420 7374 6162   Attempt at stab
+0000f110: 696c 697a 696e 6720 7065 616b 2066 6974  ilizing peak fit
+0000f120: 0a23 2075 7064 6174 696e 6720 7061 7273  .# updating pars
+0000f130: 2031 2077 6974 6820 7661 6c75 6573 2069   1 with values i
+0000f140: 6e20 7061 7273 0a0a 2020 2020 2020 2020  n pars..        
+0000f150: 2020 2020 7265 7375 6c74 203d 206d 6f64      result = mod
+0000f160: 656c 322e 6669 7428 7964 6174 2c20 7061  el2.fit(ydat, pa
+0000f170: 7261 6d73 2c20 783d 7864 6174 290a 0a0a  rams, x=xdat)...
+0000f180: 2020 2020 2020 2020 2020 2020 2320 5365              # Se
+0000f190: 7420 7468 6520 7061 7261 6d65 7465 7273  t the parameters
+0000f1a0: 206f 6620 276c 7a31 2720 746f 2062 6520   of 'lz1' to be 
+0000f1b0: 6669 7865 640a 2020 2020 2020 2020 2020  fixed.          
+0000f1c0: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
+0000f1d0: 276c 7a32 5f63 656e 7465 7227 5d2e 7661  'lz2_center'].va
+0000f1e0: 7279 203d 2046 616c 7365 0a20 2020 2020  ry = False.     
+0000f1f0: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
+0000f200: 7261 6d73 5b27 6c7a 325f 616d 706c 6974  rams['lz2_amplit
+0000f210: 7564 6527 5d2e 7661 7279 203d 2046 616c  ude'].vary = Fal
+0000f220: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
+0000f230: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+0000f240: 325f 7369 676d 6127 5d2e 7661 7279 203d  2_sigma'].vary =
+0000f250: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
+0000f260: 2020 2072 6573 756c 742e 7061 7261 6d73     result.params
+0000f270: 5b27 626b 675f 6365 6e74 6572 275d 2e76  ['bkg_center'].v
+0000f280: 6172 7920 3d20 4661 6c73 650a 2020 2020  ary = False.    
+0000f290: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
+0000f2a0: 6172 616d 735b 2762 6b67 5f61 6d70 6c69  arams['bkg_ampli
+0000f2b0: 7475 6465 275d 2e76 6172 7920 3d20 4661  tude'].vary = Fa
+0000f2c0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000f2d0: 7265 7375 6c74 2e70 6172 616d 735b 2762  result.params['b
+0000f2e0: 6b67 5f73 6967 6d61 275d 2e76 6172 7920  kg_sigma'].vary 
+0000f2f0: 3d20 4661 6c73 650a 0a20 2020 2020 2020  = False..       
+0000f300: 2020 2020 2023 2050 6572 666f 726d 2066       # Perform f
+0000f310: 6974 7469 6e67 2075 7369 6e67 2074 6865  itting using the
+0000f320: 2065 6e74 6972 6520 6d6f 6465 6c20 286d   entire model (m
+0000f330: 6f64 656c 3229 2077 6974 6820 7468 6520  odel2) with the 
+0000f340: 7374 6162 696c 697a 6564 2027 6c7a 3127  stabilized 'lz1'
+0000f350: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
+0000f360: 2020 2020 2020 2020 6669 6e61 6c5f 7265          final_re
+0000f370: 7375 6c74 203d 206d 6f64 656c 322e 6669  sult = model2.fi
+0000f380: 7428 7964 6174 2c20 7265 7375 6c74 2e70  t(ydat, result.p
+0000f390: 6172 616d 732c 2078 3d78 6461 7429 0a20  arams, x=xdat). 
+0000f3a0: 2020 2020 2020 2020 2020 2063 656e 7465             cente
+0000f3b0: 725f 6572 726f 7220 3d20 6669 6e61 6c5f  r_error = final_
+0000f3c0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
+0000f3d0: 7a31 5f63 656e 7465 7227 5d2e 7374 6465  z1_center'].stde
+0000f3e0: 7272 0a20 2020 2020 2020 2020 2020 2070  rr.            p
+0000f3f0: 6172 616d 732e 7570 6461 7465 2866 696e  arams.update(fin
+0000f400: 616c 5f72 6573 756c 742e 7061 7261 6d73  al_result.params
+0000f410: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
+0000f420: 7265 7375 6c74 3d66 696e 616c 5f72 6573  result=final_res
+0000f430: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
+0000f440: 6d6f 6465 6c5f 463d 6d6f 6465 6c32 0a0a  model_F=model2..
+0000f450: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
+0000f460: 7065 616b 733d 3d33 3a0a 2020 2020 2020  peaks==3:.      
+0000f470: 2020 2020 2020 7065 616b 5f70 6f73 5f76        peak_pos_v
+0000f480: 6f69 6774 3d6e 702e 6172 7261 7928 5b69  oigt=np.array([i
+0000f490: 6e69 7469 616c 5f67 7565 7373 2c20 4842  nitial_guess, HB
+0000f4a0: 5f69 6e69 7469 616c 5f67 7565 7373 2c20  _initial_guess, 
+0000f4b0: 4331 335f 696e 6974 6961 6c5f 6775 6573  C13_initial_gues
+0000f4c0: 735d 290a 0a20 2020 2020 2020 2020 2020  s])..           
+0000f4d0: 2066 6f72 2069 2c20 6365 6e20 696e 2065   for i, cen in e
+0000f4e0: 6e75 6d65 7261 7465 2870 6561 6b5f 706f  numerate(peak_po
+0000f4f0: 735f 766f 6967 7429 3a0a 0a20 2020 2020  s_voigt):..     
+0000f500: 2020 2020 2020 2020 2020 2069 6620 693d             if i=
+0000f510: 3d30 3a20 2320 5468 6973 2069 7320 7468  =0: # This is th
+0000f520: 6520 4469 6164 0a20 2020 2020 2020 2020  e Diad.         
+0000f530: 2020 2020 2020 2020 2020 2070 6561 6b2c             peak,
+0000f540: 2070 6172 7320 3d20 6164 645f 7065 616b   pars = add_peak
+0000f550: 2870 7265 6669 783d 276c 7a25 645f 2720  (prefix='lz%d_' 
+0000f560: 2520 2869 2b31 292c 0a20 2020 2020 2020  % (i+1),.       
+0000f570: 2020 2020 2020 2020 2063 656e 7465 723d           center=
+0000f580: 4365 6e74 6572 5f69 6e69 2c20 6d69 6e5f  Center_ini, min_
+0000f590: 6365 6e74 3d63 656e 2d33 2a73 7065 635f  cent=cen-3*spec_
+0000f5a0: 7265 732c 206d 6178 5f63 656e 743d 6365  res, max_cent=ce
+0000f5b0: 6e2b 332a 7370 6563 5f72 6573 2c0a 2020  n+3*spec_res,.  
+0000f5c0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+0000f5d0: 676d 613d 636f 6e66 6967 312e 6469 6164  gma=config1.diad
+0000f5e0: 5f73 6967 6d61 2c0a 2020 2020 2020 2020  _sigma,.        
+0000f5f0: 2020 2020 2020 2020 6d61 785f 7369 676d          max_sigm
+0000f600: 613d 636f 6e66 6967 312e 6469 6164 5f73  a=config1.diad_s
+0000f610: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
+0000f620: 645f 7369 676d 615f 6d61 785f 616c 6c6f  d_sigma_max_allo
+0000f630: 7761 6e63 652c 0a20 2020 2020 2020 2020  wance,.         
+0000f640: 2020 2020 2020 206d 696e 5f73 6967 6d61         min_sigma
+0000f650: 3d63 6f6e 6669 6731 2e64 6961 645f 7369  =config1.diad_si
+0000f660: 676d 612a 636f 6e66 6967 312e 6469 6164  gma*config1.diad
+0000f670: 5f73 6967 6d61 5f6d 696e 5f61 6c6c 6f77  _sigma_min_allow
+0000f680: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+0000f690: 2020 2020 2020 616d 706c 6974 7564 653d        amplitude=
+0000f6a0: 6361 6c63 5f64 6961 645f 616d 706c 6974  calc_diad_amplit
+0000f6b0: 7564 652c 206d 696e 5f61 6d70 6c69 7475  ude, min_amplitu
+0000f6c0: 6465 3d30 2c20 6d61 785f 616d 706c 6974  de=0, max_amplit
+0000f6d0: 7564 653d 3130 2a63 616c 635f 6469 6164  ude=10*calc_diad
+0000f6e0: 5f61 6d70 6c69 7475 6465 2c0a 2020 2020  _amplitude,.    
+0000f6f0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0000f700: 6c5f 6e61 6d65 3d63 6f6e 6669 6731 2e6d  l_name=config1.m
+0000f710: 6f64 656c 5f6e 616d 6529 0a20 2020 2020  odel_name).     
+0000f720: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000f730: 203d 2070 6561 6b2b 6d6f 6465 6c31 0a20   = peak+model1. 
+0000f740: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f750: 6172 616d 732e 7570 6461 7465 2870 6172  arams.update(par
+0000f760: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+0000f770: 2020 2020 6966 2069 3d3d 313a 2023 2054      if i==1: # T
+0000f780: 6869 7320 6973 2074 6865 2068 6f74 6261  his is the hotba
+0000f790: 6e64 0a0a 2020 2020 2020 2020 2020 2020  nd..            
+0000f7a0: 2020 2020 2020 2020 7065 616b 2c20 7061          peak, pa
+0000f7b0: 7273 203d 2061 6464 5f70 6561 6b28 7072  rs = add_peak(pr
+0000f7c0: 6566 6978 3d27 6c7a 2564 5f27 2025 2028  efix='lz%d_' % (
+0000f7d0: 692b 3129 2c20 6365 6e74 6572 3d63 656e  i+1), center=cen
+0000f7e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f7f0: 2020 2020 2020 2020 2020 6d69 6e5f 6365            min_ce
+0000f800: 6e74 3d63 656e 2d33 2a73 7065 635f 7265  nt=cen-3*spec_re
+0000f810: 732c 206d 6178 5f63 656e 743d 6365 6e2b  s, max_cent=cen+
+0000f820: 332a 7370 6563 5f72 6573 2c20 7369 676d  3*spec_res, sigm
+0000f830: 613d 7369 676d 615f 696e 692c 0a20 2020  a=sigma_ini,.   
 0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f850: 2020 2020 2020 2061 6d70 6c69 7475 6465         amplitude
-0000f860: 3d63 616c 635f 4842 5f61 6d70 6c69 7475  =calc_HB_amplitu
-0000f870: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-0000f880: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-0000f890: 616d 706c 6974 7564 653d 416d 706c 6974  amplitude=Amplit
-0000f8a0: 7564 655f 696e 692a 636f 6e66 6967 312e  ude_ini*config1.
-0000f8b0: 4842 5f61 6d70 5f6d 696e 5f61 6c6c 6f77  HB_amp_min_allow
-0000f8c0: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
-0000f8d0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000f8e0: 785f 616d 706c 6974 7564 653d 416d 706c  x_amplitude=Ampl
-0000f8f0: 6974 7564 655f 696e 692a 636f 6e66 6967  itude_ini*config
-0000f900: 312e 4842 5f61 6d70 5f6d 6178 5f61 6c6c  1.HB_amp_max_all
-0000f910: 6f77 616e 6365 2c0a 2020 2020 2020 2020  owance,.        
-0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f930: 6d6f 6465 6c5f 6e61 6d65 3d63 6f6e 6669  model_name=confi
-0000f940: 6731 2e6d 6f64 656c 5f6e 616d 6529 0a20  g1.model_name). 
-0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f960: 2020 206d 6f64 656c 3220 3d20 7065 616b     model2 = peak
-0000f970: 2b6d 6f64 656c 0a20 2020 2020 2020 2020  +model.         
-0000f980: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000f990: 732e 7570 6461 7465 2870 6172 7329 0a0a  s.update(pars)..
-0000f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9b0: 6966 2069 3d3d 323a 2023 2054 6869 7320  if i==2: # This 
-0000f9c0: 6973 2063 3133 0a20 2020 2020 2020 2020  is c13.         
-0000f9d0: 2020 2020 2020 2020 2020 2070 6561 6b2c             peak,
-0000f9e0: 2070 6172 7320 3d20 6164 645f 7065 616b   pars = add_peak
-0000f9f0: 2870 7265 6669 783d 276c 7a25 645f 2720  (prefix='lz%d_' 
-0000fa00: 2520 2869 2b31 292c 2063 656e 7465 723d  % (i+1), center=
-0000fa10: 6365 6e2c 0a20 2020 2020 2020 2020 2020  cen,.           
-0000fa20: 2020 2020 2020 2020 2020 2020 206d 696e               min
-0000fa30: 5f63 656e 743d 6365 6e2d 332a 7370 6563  _cent=cen-3*spec
-0000fa40: 5f72 6573 2c20 6d61 785f 6365 6e74 3d63  _res, max_cent=c
-0000fa50: 656e 2b33 2a73 7065 635f 7265 732c 0a20  en+3*spec_res,. 
+0000f850: 2020 2020 206d 696e 5f73 6967 6d61 3d73       min_sigma=s
+0000f860: 6967 6d61 5f69 6e69 2a63 6f6e 6669 6731  igma_ini*config1
+0000f870: 2e48 425f 7369 676d 615f 6d69 6e5f 616c  .HB_sigma_min_al
+0000f880: 6c6f 7761 6e63 652c 0a20 2020 2020 2020  lowance,.       
+0000f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8a0: 206d 6178 5f73 6967 6d61 3d73 6967 6d61   max_sigma=sigma
+0000f8b0: 5f69 6e69 2a63 6f6e 6669 6731 2e48 425f  _ini*config1.HB_
+0000f8c0: 7369 676d 615f 6d61 785f 616c 6c6f 7761  sigma_max_allowa
+0000f8d0: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+0000f8e0: 2020 2020 2020 2020 2020 2020 2061 6d70               amp
+0000f8f0: 6c69 7475 6465 3d63 616c 635f 4842 5f61  litude=calc_HB_a
+0000f900: 6d70 6c69 7475 6465 2c0a 2020 2020 2020  mplitude,.      
+0000f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f920: 2020 6d69 6e5f 616d 706c 6974 7564 653d    min_amplitude=
+0000f930: 416d 706c 6974 7564 655f 696e 692a 636f  Amplitude_ini*co
+0000f940: 6e66 6967 312e 4842 5f61 6d70 5f6d 696e  nfig1.HB_amp_min
+0000f950: 5f61 6c6c 6f77 616e 6365 2c0a 2020 2020  _allowance,.    
+0000f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f970: 2020 2020 6d61 785f 616d 706c 6974 7564      max_amplitud
+0000f980: 653d 416d 706c 6974 7564 655f 696e 692a  e=Amplitude_ini*
+0000f990: 636f 6e66 6967 312e 4842 5f61 6d70 5f6d  config1.HB_amp_m
+0000f9a0: 6178 5f61 6c6c 6f77 616e 6365 2c0a 2020  ax_allowance,.  
+0000f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9c0: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
+0000f9d0: 3d63 6f6e 6669 6731 2e6d 6f64 656c 5f6e  =config1.model_n
+0000f9e0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0000f9f0: 2020 2020 2020 2020 206d 6f64 656c 3220           model2 
+0000fa00: 3d20 7065 616b 2b6d 6f64 656c 0a20 2020  = peak+model.   
+0000fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa20: 2070 6172 616d 732e 7570 6461 7465 2870   params.update(p
+0000fa30: 6172 7329 0a0a 2020 2020 2020 2020 2020  ars)..          
+0000fa40: 2020 2020 2020 6966 2069 3d3d 323a 2023        if i==2: #
+0000fa50: 2054 6869 7320 6973 2063 3133 0a20 2020   This is c13.   
 0000fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa70: 2020 2020 2020 2073 6967 6d61 3d73 6967         sigma=sig
-0000fa80: 6d61 5f69 6e69 2f35 2c0a 2020 2020 2020  ma_ini/5,.      
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000faa0: 2020 6d69 6e5f 7369 676d 613d 7369 676d    min_sigma=sigm
-0000fab0: 615f 696e 692f 3230 2c0a 2020 2020 2020  a_ini/20,.      
-0000fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fad0: 2020 6d61 785f 7369 676d 613d 7369 676d    max_sigma=sigm
-0000fae0: 615f 696e 692f 322c 0a20 2020 2020 2020  a_ini/2,.       
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb00: 2061 6d70 6c69 7475 6465 3d63 616c 635f   amplitude=calc_
-0000fb10: 4331 335f 616d 706c 6974 7564 652c 0a20  C13_amplitude,. 
+0000fa70: 2070 6561 6b2c 2070 6172 7320 3d20 6164   peak, pars = ad
+0000fa80: 645f 7065 616b 2870 7265 6669 783d 276c  d_peak(prefix='l
+0000fa90: 7a25 645f 2720 2520 2869 2b31 292c 2063  z%d_' % (i+1), c
+0000faa0: 656e 7465 723d 6365 6e2c 0a20 2020 2020  enter=cen,.     
+0000fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fac0: 2020 206d 696e 5f63 656e 743d 6365 6e2d     min_cent=cen-
+0000fad0: 332a 7370 6563 5f72 6573 2c20 6d61 785f  3*spec_res, max_
+0000fae0: 6365 6e74 3d63 656e 2b33 2a73 7065 635f  cent=cen+3*spec_
+0000faf0: 7265 732c 0a20 2020 2020 2020 2020 2020  res,.           
+0000fb00: 2020 2020 2020 2020 2020 2020 2073 6967               sig
+0000fb10: 6d61 3d73 6967 6d61 5f69 6e69 2f35 2c0a  ma=sigma_ini/5,.
 0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb30: 2020 2020 2020 206d 696e 5f61 6d70 6c69         min_ampli
-0000fb40: 7475 6465 3d63 616c 635f 4331 335f 616d  tude=calc_C13_am
-0000fb50: 706c 6974 7564 652a 2830 2e35 2a63 6f6e  plitude*(0.5*con
-0000fb60: 6669 6731 2e48 425f 616d 705f 6d69 6e5f  fig1.HB_amp_min_
-0000fb70: 616c 6c6f 7761 6e63 6529 2c0a 2020 2020  allowance),.    
+0000fb30: 2020 2020 2020 2020 6d69 6e5f 7369 676d          min_sigm
+0000fb40: 613d 7369 676d 615f 696e 692f 3230 2c0a  a=sigma_ini/20,.
+0000fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb60: 2020 2020 2020 2020 6d61 785f 7369 676d          max_sigm
+0000fb70: 613d 7369 676d 615f 696e 692f 322c 0a20  a=sigma_ini/2,. 
 0000fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb90: 2020 2020 6d61 785f 616d 706c 6974 7564      max_amplitud
-0000fba0: 653d 6361 6c63 5f43 3133 5f61 6d70 6c69  e=calc_C13_ampli
-0000fbb0: 7475 6465 2a32 2a28 636f 6e66 6967 312e  tude*2*(config1.
-0000fbc0: 4842 5f61 6d70 5f6d 6178 5f61 6c6c 6f77  HB_amp_max_allow
-0000fbd0: 616e 6365 292c 0a20 2020 2020 2020 2020  ance),.         
-0000fbe0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000fbf0: 6f64 656c 5f6e 616d 653d 636f 6e66 6967  odel_name=config
-0000fc00: 312e 6d6f 6465 6c5f 6e61 6d65 290a 2020  1.model_name).  
-0000fc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc20: 2020 6d6f 6465 6c33 203d 2070 6561 6b2b    model3 = peak+
-0000fc30: 6d6f 6465 6c32 0a20 2020 2020 2020 2020  model2.         
-0000fc40: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000fc50: 732e 7570 6461 7465 2870 6172 7329 0a0a  s.update(pars)..
-0000fc60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000fc70: 6c74 203d 206d 6f64 656c 332e 6669 7428  lt = model3.fit(
-0000fc80: 7964 6174 2c20 7061 7261 6d73 2c20 783d  ydat, params, x=
-0000fc90: 7864 6174 290a 0a0a 2020 2020 2020 2020  xdat)...        
-0000fca0: 2020 2020 2320 5365 7420 7468 6520 7061      # Set the pa
-0000fcb0: 7261 6d65 7465 7273 206f 6620 276c 7a31  rameters of 'lz1
-0000fcc0: 2720 746f 2062 6520 6669 7865 640a 2020  ' to be fixed.  
-0000fcd0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0000fce0: 2e70 6172 616d 735b 276c 7a32 5f63 656e  .params['lz2_cen
-0000fcf0: 7465 7227 5d2e 7661 7279 203d 2046 616c  ter'].vary = Fal
-0000fd00: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
-0000fd10: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
-0000fd20: 325f 616d 706c 6974 7564 6527 5d2e 7661  2_amplitude'].va
-0000fd30: 7279 203d 2046 616c 7365 0a20 2020 2020  ry = False.     
-0000fd40: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
-0000fd50: 7261 6d73 5b27 6c7a 325f 7369 676d 6127  rams['lz2_sigma'
-0000fd60: 5d2e 7661 7279 203d 2046 616c 7365 0a20  ].vary = False. 
-0000fd70: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000fd80: 742e 7061 7261 6d73 5b27 6c7a 335f 6365  t.params['lz3_ce
-0000fd90: 6e74 6572 275d 2e76 6172 7920 3d20 4661  nter'].vary = Fa
-0000fda0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000fdb0: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
-0000fdc0: 7a33 5f61 6d70 6c69 7475 6465 275d 2e76  z3_amplitude'].v
-0000fdd0: 6172 7920 3d20 4661 6c73 650a 2020 2020  ary = False.    
-0000fde0: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
-0000fdf0: 6172 616d 735b 276c 7a33 5f73 6967 6d61  arams['lz3_sigma
-0000fe00: 275d 2e76 6172 7920 3d20 4661 6c73 650a  '].vary = False.
-0000fe10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000fe20: 6c74 2e70 6172 616d 735b 2762 6b67 5f63  lt.params['bkg_c
-0000fe30: 656e 7465 7227 5d2e 7661 7279 203d 2046  enter'].vary = F
-0000fe40: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0000fe50: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
-0000fe60: 626b 675f 616d 706c 6974 7564 6527 5d2e  bkg_amplitude'].
-0000fe70: 7661 7279 203d 2046 616c 7365 0a20 2020  vary = False.   
-0000fe80: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-0000fe90: 7061 7261 6d73 5b27 626b 675f 7369 676d  params['bkg_sigm
-0000fea0: 6127 5d2e 7661 7279 203d 2046 616c 7365  a'].vary = False
-0000feb0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000fec0: 5065 7266 6f72 6d20 6669 7474 696e 6720  Perform fitting 
-0000fed0: 7573 696e 6720 7468 6520 656e 7469 7265  using the entire
-0000fee0: 206d 6f64 656c 2028 6d6f 6465 6c32 2920   model (model2) 
-0000fef0: 7769 7468 2074 6865 2073 7461 6269 6c69  with the stabili
-0000ff00: 7a65 6420 276c 7a31 2720 7061 7261 6d65  zed 'lz1' parame
-0000ff10: 7465 7273 0a20 2020 2020 2020 2020 2020  ters.           
-0000ff20: 2066 696e 616c 5f72 6573 756c 7420 3d20   final_result = 
-0000ff30: 6d6f 6465 6c33 2e66 6974 2879 6461 742c  model3.fit(ydat,
-0000ff40: 2072 6573 756c 742e 7061 7261 6d73 2c20   result.params, 
-0000ff50: 783d 7864 6174 290a 2020 2020 2020 2020  x=xdat).        
-0000ff60: 2020 2020 6365 6e74 6572 5f65 7272 6f72      center_error
-0000ff70: 203d 2066 696e 616c 5f72 6573 756c 742e   = final_result.
-0000ff80: 7061 7261 6d73 5b27 6c7a 315f 6365 6e74  params['lz1_cent
-0000ff90: 6572 275d 2e73 7464 6572 720a 0a20 2020  er'].stderr..   
-0000ffa0: 2020 2020 2020 2020 2072 6573 756c 743d           result=
-0000ffb0: 6669 6e61 6c5f 7265 7375 6c74 0a20 2020  final_result.   
-0000ffc0: 2020 2020 2020 2020 206d 6f64 656c 5f46           model_F
-0000ffd0: 3d6d 6f64 656c 330a 0a20 2020 2020 2020  =model3..       
-0000ffe0: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-0000fff0: 7465 2866 696e 616c 5f72 6573 756c 742e  te(final_result.
-00010000: 7061 7261 6d73 290a 0a0a 0a0a 0a0a 0a0a  params).........
-00010010: 0a20 2020 2023 2052 6567 6172 646c 6573  .    # Regardles
-00010020: 7320 6f66 2066 6974 2c20 6576 616c 7561  s of fit, evalua
-00010030: 7465 206d 6f64 656c 0a20 2020 2069 6e69  te model.    ini
-00010040: 7420 3d20 6d6f 6465 6c5f 462e 6576 616c  t = model_F.eval
-00010050: 2870 6172 616d 732c 2078 3d78 6461 7429  (params, x=xdat)
-00010060: 0a20 2020 2072 6573 756c 7420 3d20 6d6f  .    result = mo
-00010070: 6465 6c5f 462e 6669 7428 7964 6174 2c20  del_F.fit(ydat, 
-00010080: 7061 7261 6d73 2c20 783d 7864 6174 290a  params, x=xdat).
-00010090: 2020 2020 636f 6d70 7320 3d20 7265 7375      comps = resu
-000100a0: 6c74 2e65 7661 6c5f 636f 6d70 6f6e 656e  lt.eval_componen
-000100b0: 7473 2829 0a0a 2020 2020 2370 7269 6e74  ts()..    #print
-000100c0: 2872 6573 756c 742e 6369 5f72 6570 6f72  (result.ci_repor
-000100d0: 7428 2929 0a0a 2020 2020 2370 7269 6e74  t())..    #print
-000100e0: 2872 6573 756c 742e 636f 6e66 5f69 6e74  (result.conf_int
-000100f0: 6572 7661 6c28 6d65 7468 6f64 3d27 626f  erval(method='bo
-00010100: 6f74 7374 7261 7027 2929 0a0a 2020 2020  otstrap'))..    
-00010110: 2370 7269 6e74 2872 6573 756c 742e 6669  #print(result.fi
-00010120: 745f 7265 706f 7274 286d 696e 5f63 6f72  t_report(min_cor
-00010130: 7265 6c3d 302e 3529 290a 2020 2020 2320  rel=0.5)).    # 
-00010140: 4368 6563 6b20 6966 2066 756e 6374 696f  Check if functio
-00010150: 6e20 6769 7665 7320 6572 726f 7220 6261  n gives error ba
-00010160: 7273 0a0a 0a20 2020 2023 7072 696e 7428  rs...    #print(
-00010170: 7265 7375 6c74 2e62 6573 745f 7661 6c75  result.best_valu
-00010180: 6573 290a 2020 2020 2320 4765 7420 6669  es).    # Get fi
-00010190: 7273 7420 7065 616b 2063 656e 7465 720a  rst peak center.
-000101a0: 2020 2020 5065 616b 315f 4365 6e74 3d72      Peak1_Cent=r
-000101b0: 6573 756c 742e 6265 7374 5f76 616c 7565  esult.best_value
-000101c0: 732e 6765 7428 276c 7a31 5f63 656e 7465  s.get('lz1_cente
-000101d0: 7227 290a 2020 2020 5065 616b 315f 496e  r').    Peak1_In
-000101e0: 743d 7265 7375 6c74 2e62 6573 745f 7661  t=result.best_va
-000101f0: 6c75 6573 2e67 6574 2827 6c7a 315f 616d  lues.get('lz1_am
-00010200: 706c 6974 7564 6527 290a 2020 2020 5065  plitude').    Pe
-00010210: 616b 315f 5369 676d 613d 7265 7375 6c74  ak1_Sigma=result
-00010220: 2e62 6573 745f 7661 6c75 6573 2e67 6574  .best_values.get
-00010230: 2827 6c7a 315f 7369 676d 6127 290a 2020  ('lz1_sigma').  
-00010240: 2020 5065 616b 315f 6761 6d6d 613d 7265    Peak1_gamma=re
-00010250: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
-00010260: 2e67 6574 2827 6c7a 315f 6761 6d6d 6127  .get('lz1_gamma'
-00010270: 290a 2020 2020 5065 616b 315f 5072 6f70  ).    Peak1_Prop
-00010280: 5f4c 6f72 3d72 6573 756c 742e 6265 7374  _Lor=result.best
-00010290: 5f76 616c 7565 732e 6765 7428 276c 7a31  _values.get('lz1
-000102a0: 5f66 7261 6374 696f 6e27 290a 2020 2020  _fraction').    
-000102b0: 5065 616b 315f 6677 686d 3d72 6573 756c  Peak1_fwhm=resul
-000102c0: 742e 7061 7261 6d73 5b27 6c7a 315f 6677  t.params['lz1_fw
-000102d0: 686d 275d 2e76 616c 7565 0a0a 2020 2020  hm'].value..    
-000102e0: 4365 6e74 6572 5f70 6b32 5f65 7272 6f72  Center_pk2_error
-000102f0: 3d72 6573 756c 742e 7061 7261 6d73 2e67  =result.params.g
-00010300: 6574 2827 6c7a 315f 6365 6e74 6572 2729  et('lz1_center')
-00010310: 0a0a 2020 2020 6572 726f 725f 706b 3220  ..    error_pk2 
-00010320: 3d20 7265 7375 6c74 2e70 6172 616d 735b  = result.params[
-00010330: 276c 7a31 5f63 656e 7465 7227 5d2e 7374  'lz1_center'].st
-00010340: 6465 7272 0a0a 0a0a 2020 2020 785f 6c69  derr....    x_li
-00010350: 6e3d 6e70 2e6c 696e 7370 6163 6528 7370  n=np.linspace(sp
-00010360: 616e 5b30 5d2c 2073 7061 6e5b 315d 2c20  an[0], span[1], 
-00010370: 3230 3030 290a 2020 2020 795f 6265 7374  2000).    y_best
-00010380: 5f66 6974 3d72 6573 756c 742e 6576 616c  _fit=result.eval
-00010390: 2878 3d78 5f6c 696e 290a 2020 2020 636f  (x=x_lin).    co
-000103a0: 6d70 6f6e 656e 7473 3d72 6573 756c 742e  mponents=result.
-000103b0: 6576 616c 5f63 6f6d 706f 6e65 6e74 7328  eval_components(
-000103c0: 783d 785f 6c69 6e29 0a0a 0a0a 0a20 2020  x=x_lin).....   
-000103d0: 2069 6620 636f 6e66 6967 312e 6669 745f   if config1.fit_
-000103e0: 6761 7573 7320 6973 206e 6f74 2046 616c  gauss is not Fal
-000103f0: 7365 3a0a 2020 2020 2020 2020 4761 7573  se:.        Gaus
-00010400: 735f 6365 6e74 3d72 6573 756c 742e 6265  s_cent=result.be
-00010410: 7374 5f76 616c 7565 732e 6765 7428 2762  st_values.get('b
-00010420: 6b67 5f63 656e 7465 7227 290a 2020 2020  kg_center').    
-00010430: 2020 2020 4761 7573 735f 616d 703d 7265      Gauss_amp=re
-00010440: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
-00010450: 2e67 6574 2827 626b 675f 616d 706c 6974  .get('bkg_amplit
-00010460: 7564 6527 290a 2020 2020 2020 2020 4761  ude').        Ga
-00010470: 7573 735f 7369 676d 613d 7265 7375 6c74  uss_sigma=result
-00010480: 2e62 6573 745f 7661 6c75 6573 2e67 6574  .best_values.get
-00010490: 2827 626b 675f 7369 676d 6127 290a 0a20  ('bkg_sigma').. 
-000104a0: 2020 2020 2020 206d 6178 5f47 6175 7373         max_Gauss
-000104b0: 3d6e 702e 6d61 7828 636f 6d70 6f6e 656e  =np.max(componen
-000104c0: 7473 2e67 6574 2827 626b 675f 2729 290a  ts.get('bkg_')).
-000104d0: 2020 2020 2020 2020 6d61 785f 766f 6967          max_voig
-000104e0: 743d 6e70 2e6d 6178 2863 6f6d 706f 6e65  t=np.max(compone
-000104f0: 6e74 732e 6765 7428 276c 7a31 5f27 2929  nts.get('lz1_'))
-00010500: 0a20 2020 2020 2020 2069 6620 6d61 785f  .        if max_
-00010510: 4761 7573 733e 6d61 785f 766f 6967 742f  Gauss>max_voigt/
-00010520: 353a 0a20 2020 2020 2020 2020 2020 2072  5:.            r
-00010530: 6566 6974 5f70 6172 616d 3d73 7472 2872  efit_param=str(r
-00010540: 6566 6974 5f70 6172 616d 292b 2027 2047  efit_param)+ ' G
-00010550: 5f68 6967 6865 725f 7468 616e 5f64 6961  _higher_than_dia
-00010560: 6427 0a20 2020 2020 2020 2023 2069 6620  d'.        # if 
-00010570: 4761 7573 735f 7369 676d 613e 3d28 636f  Gauss_sigma>=(co
-00010580: 6e66 6967 312e 6761 7573 735f 7369 676d  nfig1.gauss_sigm
-00010590: 612a 3130 2d30 2e31 293a 0a20 2020 2020  a*10-0.1):.     
-000105a0: 2020 2023 2020 2020 2072 6566 6974 3d54     #     refit=T
-000105b0: 7275 650a 2020 2020 2020 2020 2320 2020  rue.        #   
-000105c0: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
-000105d0: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
-000105e0: 2047 5f69 6e70 7574 5f54 6f6f 4c6f 7753   G_input_TooLowS
-000105f0: 6967 6d61 270a 2020 2020 2020 2020 2320  igma'.        # 
-00010600: 6966 2047 6175 7373 5f73 6967 6d61 3c3d  if Gauss_sigma<=
-00010610: 2863 6f6e 6669 6731 2e67 6175 7373 5f73  (config1.gauss_s
-00010620: 6967 6d61 2f31 302b 302e 3129 3a0a 2020  igma/10+0.1):.  
-00010630: 2020 2020 2020 2320 2020 2020 7265 6669        #     refi
-00010640: 743d 5472 7565 0a20 2020 2020 2020 2023  t=True.        #
-00010650: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
-00010660: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
-00010670: 292b 2027 2047 5f69 6e70 7574 5f54 6f6f  )+ ' G_input_Too
-00010680: 4869 6768 5369 676d 6127 0a20 2020 2020  HighSigma'.     
-00010690: 2020 2023 0a20 2020 2020 2020 2023 2069     #.        # i
-000106a0: 6620 4761 7573 735f 616d 703e 3d28 636f  f Gauss_amp>=(co
-000106b0: 6e66 6967 312e 6761 7573 735f 616d 702a  nfig1.gauss_amp*
-000106c0: 3130 2d30 2e31 293a 0a20 2020 2020 2020  10-0.1):.       
-000106d0: 2023 2020 2020 2072 6566 6974 3d54 7275   #     refit=Tru
-000106e0: 650a 2020 2020 2020 2020 2320 2020 2020  e.        #     
-000106f0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
-00010700: 7265 6669 745f 7061 7261 6d29 2b27 2047  refit_param)+' G
-00010710: 5f69 6e70 7574 5f54 6f6f 4c6f 7741 6d70  _input_TooLowAmp
-00010720: 270a 2020 2020 2020 2020 2320 6966 2047  '.        # if G
-00010730: 6175 7373 5f61 6d70 3c3d 2863 6f6e 6669  auss_amp<=(confi
-00010740: 6731 2e67 6175 7373 5f73 6967 6d61 2b30  g1.gauss_sigma+0
-00010750: 2e31 293a 0a20 2020 2020 2020 2023 2020  .1):.        #  
-00010760: 2020 2072 6566 6974 3d54 7275 650a 2020     refit=True.  
-00010770: 2020 2020 2020 2320 2020 2020 7265 6669        #     refi
-00010780: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
-00010790: 745f 7061 7261 6d29 2b27 2047 5f41 6d70  t_param)+' G_Amp
-000107a0: 5f74 6f6f 5f68 6967 6827 0a20 2020 2020  _too_high'.     
-000107b0: 2020 2069 6620 4761 7573 735f 6365 6e74     if Gauss_cent
-000107c0: 3c3d 2863 6f6e 6669 6731 2e66 6974 5f67  <=(config1.fit_g
-000107d0: 6175 7373 2d33 302b 302e 3529 3a0a 2020  auss-30+0.5):.  
-000107e0: 2020 2020 2020 2020 2020 7265 6669 743d            refit=
-000107f0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00010800: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
-00010810: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
-00010820: 475f 496e 7075 7454 6f6f 4c6f 7743 656e  G_InputTooLowCen
-00010830: 7427 0a20 2020 2020 2020 2069 6620 4761  t'.        if Ga
-00010840: 7573 735f 6365 6e74 3e3d 2869 6e69 7469  uss_cent>=(initi
-00010850: 616c 5f67 7565 7373 2b33 302d 302e 3529  al_guess+30-0.5)
-00010860: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00010870: 6669 743d 5472 7565 0a20 2020 2020 2020  fit=True.       
-00010880: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
-00010890: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
-000108a0: 292b 2720 475f 496e 7075 7454 6f6f 4869  )+' G_InputTooHi
-000108b0: 6768 4365 6e74 270a 0a0a 0a0a 0a20 2020  ghCent'......   
-000108c0: 2023 2070 7269 6e74 2827 6677 686d 2067   # print('fwhm g
-000108d0: 6175 7373 2729 0a20 2020 2023 2070 7269  auss').    # pri
-000108e0: 6e74 2872 6573 756c 742e 6265 7374 5f76  nt(result.best_v
-000108f0: 616c 7565 7329 0a0a 0a0a 0a20 2020 2023  alues).....    #
-00010900: 0a0a 2020 2020 2320 576f 726b 206f 7574  ..    # Work out
-00010910: 2077 6861 7420 7065 616b 2069 7320 7768   what peak is wh
-00010920: 6174 0a20 2020 2069 6620 6469 6164 3220  at.    if diad2 
-00010930: 6973 2054 7275 653a 0a0a 2020 2020 2020  is True:..      
-00010940: 2020 6966 2066 6974 5f70 6561 6b73 3d3d    if fit_peaks==
-00010950: 313a 0a0a 2020 2020 2020 2020 2020 2020  1:..            
-00010960: 5065 616b 325f 4365 6e74 3d4e 6f6e 650a  Peak2_Cent=None.
-00010970: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00010980: 335f 4365 6e74 3d4e 6f6e 650a 2020 2020  3_Cent=None.    
-00010990: 2020 2020 2020 2020 6178 315f 786c 696d          ax1_xlim
-000109a0: 3d5b 4365 6e74 6572 5f69 6e69 2d31 352c  =[Center_ini-15,
-000109b0: 2043 656e 7465 725f 696e 692b 3135 5d0a   Center_ini+15].
-000109c0: 2020 2020 2020 2020 2020 2020 6178 325f              ax2_
-000109d0: 786c 696d 3d5b 4365 6e74 6572 5f69 6e69  xlim=[Center_ini
-000109e0: 2d31 352c 2043 656e 7465 725f 696e 692b  -15, Center_ini+
-000109f0: 3135 5d0a 0a20 2020 2020 2020 2069 6620  15]..        if 
-00010a00: 6669 745f 7065 616b 733d 3d32 3a0a 0a20  fit_peaks==2:.. 
-00010a10: 2020 2020 2020 2020 2020 2050 6561 6b32             Peak2
-00010a20: 5f43 656e 743d 7265 7375 6c74 2e62 6573  _Cent=result.bes
-00010a30: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
-00010a40: 325f 6365 6e74 6572 2729 0a20 2020 2020  2_center').     
-00010a50: 2020 2020 2020 2050 6561 6b32 5f49 6e74         Peak2_Int
-00010a60: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
-00010a70: 7565 732e 6765 7428 276c 7a32 5f61 6d70  ues.get('lz2_amp
-00010a80: 6c69 7475 6465 2729 0a20 2020 2020 2020  litude').       
-00010a90: 2020 2020 2050 6561 6b32 5f53 6967 6d61       Peak2_Sigma
-00010aa0: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
-00010ab0: 7565 732e 6765 7428 276c 7a32 5f73 6967  ues.get('lz2_sig
-00010ac0: 6d61 2729 0a20 2020 2020 2020 2020 2020  ma').           
-00010ad0: 2050 6561 6b33 5f43 656e 743d 4e6f 6e65   Peak3_Cent=None
-00010ae0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00010af0: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
-00010b00: 692d 3135 2c20 4365 6e74 6572 5f69 6e69  i-15, Center_ini
-00010b10: 2b33 305d 0a20 2020 2020 2020 2020 2020  +30].           
-00010b20: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
-00010b30: 725f 696e 692d 3135 2c20 4365 6e74 6572  r_ini-15, Center
-00010b40: 5f69 6e69 2b33 305d 0a0a 2020 2020 2020  _ini+30]..      
-00010b50: 2020 6966 2066 6974 5f70 6561 6b73 3d3d    if fit_peaks==
-00010b60: 333a 0a0a 2020 2020 2020 2020 2020 2020  3:..            
-00010b70: 5065 616b 325f 4365 6e74 3d72 6573 756c  Peak2_Cent=resul
-00010b80: 742e 6265 7374 5f76 616c 7565 732e 6765  t.best_values.ge
-00010b90: 7428 276c 7a32 5f63 656e 7465 7227 290a  t('lz2_center').
-00010ba0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00010bb0: 325f 496e 743d 7265 7375 6c74 2e62 6573  2_Int=result.bes
-00010bc0: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
-00010bd0: 325f 616d 706c 6974 7564 6527 290a 2020  2_amplitude').  
-00010be0: 2020 2020 2020 2020 2020 5065 616b 325f            Peak2_
-00010bf0: 5369 676d 613d 7265 7375 6c74 2e62 6573  Sigma=result.bes
-00010c00: 745f 7661 6c75 6573 2e67 6574 2827 6c7a  t_values.get('lz
-00010c10: 325f 7369 676d 6127 290a 2020 2020 2020  2_sigma').      
-00010c20: 2020 2020 2020 5065 616b 335f 4365 6e74        Peak3_Cent
-00010c30: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
-00010c40: 7565 732e 6765 7428 276c 7a33 5f63 656e  ues.get('lz3_cen
-00010c50: 7465 7227 290a 2020 2020 2020 2020 2020  ter').          
-00010c60: 2020 5065 616b 335f 496e 743d 7265 7375    Peak3_Int=resu
-00010c70: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
-00010c80: 6574 2827 6c7a 335f 616d 706c 6974 7564  et('lz3_amplitud
-00010c90: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-00010ca0: 5065 616b 335f 5369 676d 613d 7265 7375  Peak3_Sigma=resu
-00010cb0: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
-00010cc0: 6574 2827 6c7a 335f 7369 676d 6127 290a  et('lz3_sigma').
-00010cd0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00010ce0: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
-00010cf0: 692d 3330 2c20 4365 6e74 6572 5f69 6e69  i-30, Center_ini
-00010d00: 2b33 305d 0a20 2020 2020 2020 2020 2020  +30].           
-00010d10: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
-00010d20: 725f 696e 692d 3330 2c20 4365 6e74 6572  r_ini-30, Center
-00010d30: 5f69 6e69 2b33 305d 0a0a 2020 2020 2020  _ini+30]..      
-00010d40: 2020 6966 2050 6561 6b32 5f43 656e 7420    if Peak2_Cent 
-00010d50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00010d60: 2020 2020 2064 665f 6f75 743d 7064 2e44       df_out=pd.D
-00010d70: 6174 6146 7261 6d65 2864 6174 613d 7b27  ataFrame(data={'
-00010d80: 4469 6164 325f 566f 6967 745f 4365 6e74  Diad2_Voigt_Cent
-00010d90: 273a 2050 6561 6b31 5f43 656e 742c 0a20  ': Peak1_Cent,. 
-00010da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010dc0: 2020 2027 4469 6164 325f 6365 6e74 5f65     'Diad2_cent_e
-00010dd0: 7272 273a 2065 7272 6f72 5f70 6b32 2c0a  rr': error_pk2,.
-00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e00: 2020 2020 2744 6961 6432 5f56 6f69 6774      'Diad2_Voigt
-00010e10: 5f41 7265 6127 3a20 5065 616b 315f 496e  _Area': Peak1_In
-00010e20: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e40: 2020 2027 4469 6164 325f 566f 6967 745f     'Diad2_Voigt_
-00010e50: 5369 676d 6127 3a20 5065 616b 315f 5369  Sigma': Peak1_Si
-00010e60: 676d 612c 0a20 2020 2020 2020 2020 2020  gma,.           
-00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e80: 2020 2020 2027 4469 6164 325f 566f 6967       'Diad2_Voig
-00010e90: 745f 4761 6d6d 6127 3a20 5065 616b 315f  t_Gamma': Peak1_
-00010ea0: 6761 6d6d 612c 0a0a 0a20 2020 2020 2020  gamma,...       
-00010eb0: 2020 2020 207d 2c20 696e 6465 783d 5b30       }, index=[0
-00010ec0: 5d29 0a0a 2020 2020 2020 2020 6966 2050  ])..        if P
-00010ed0: 6561 6b32 5f43 656e 7420 6973 206e 6f74  eak2_Cent is not
-00010ee0: 204e 6f6e 653a 0a0a 0a20 2020 2020 2020   None:...       
-00010ef0: 2020 2020 2069 6620 5065 616b 335f 4365       if Peak3_Ce
-00010f00: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-00010f10: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00010f20: 733d 6e70 2e61 7272 6179 285b 5065 616b  s=np.array([Peak
-00010f30: 315f 4365 6e74 2c20 5065 616b 325f 4365  1_Cent, Peak2_Ce
-00010f40: 6e74 5d29 0a20 2020 2020 2020 2020 2020  nt]).           
-00010f50: 2020 2020 2023 2044 6961 6420 6973 206c       # Diad is l
-00010f60: 6f77 6572 2070 6561 6b0a 2020 2020 2020  ower peak.      
-00010f70: 2020 2020 2020 2020 2020 4469 6164 325f            Diad2_
-00010f80: 4365 6e74 3d6e 702e 6d69 6e28 5065 616b  Cent=np.min(Peak
-00010f90: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00010fa0: 2020 2023 2048 6f74 2062 616e 6420 6973     # Hot band is
-00010fb0: 2075 7070 6572 2070 6561 6b27 0a20 2020   upper peak'.   
-00010fc0: 2020 2020 2020 2020 2020 2020 2048 4232               HB2
-00010fd0: 5f43 656e 743d 6e70 2e6d 6178 2850 6561  _Cent=np.max(Pea
-00010fe0: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
-00010ff0: 2020 2020 2320 416c 6c6f 6361 7465 2061      # Allocate a
-00011000: 7265 6173 0a20 2020 2020 2020 2020 2020  reas.           
-00011010: 2020 2020 2069 6620 4469 6164 325f 4365       if Diad2_Ce
-00011020: 6e74 3d3d 5065 616b 325f 4365 6e74 3a0a  nt==Peak2_Cent:.
-00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011040: 2020 2020 4469 6164 325f 496e 743d 5065      Diad2_Int=Pe
-00011050: 616b 325f 496e 740a 2020 2020 2020 2020  ak2_Int.        
-00011060: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
-00011070: 496e 743d 5065 616b 315f 496e 740a 2020  Int=Peak1_Int.  
-00011080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011090: 2020 4842 325f 5369 676d 613d 5065 616b    HB2_Sigma=Peak
-000110a0: 315f 5369 676d 610a 2020 2020 2020 2020  1_Sigma.        
-000110b0: 2020 2020 2020 2020 6966 2044 6961 6432          if Diad2
-000110c0: 5f43 656e 743d 3d50 6561 6b31 5f43 656e  _Cent==Peak1_Cen
-000110d0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000110e0: 2020 2020 2020 2044 6961 6432 5f49 6e74         Diad2_Int
-000110f0: 3d50 6561 6b31 5f49 6e74 0a20 2020 2020  =Peak1_Int.     
-00011100: 2020 2020 2020 2020 2020 2020 2020 2048                 H
-00011110: 4232 5f49 6e74 3d50 6561 6b32 5f49 6e74  B2_Int=Peak2_Int
-00011120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011130: 2020 2020 2048 4232 5f53 6967 6d61 3d50       HB2_Sigma=P
-00011140: 6561 6b32 5f53 6967 6d61 0a0a 0a0a 0a20  eak2_Sigma..... 
-00011150: 2020 2020 2020 2020 2020 2069 6620 5065             if Pe
-00011160: 616b 335f 4365 6e74 2069 7320 6e6f 7420  ak3_Cent is not 
-00011170: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00011180: 2020 2020 2020 5065 616b 733d 6e70 2e61        Peaks=np.a
-00011190: 7272 6179 285b 5065 616b 315f 4365 6e74  rray([Peak1_Cent
-000111a0: 2c20 5065 616b 325f 4365 6e74 2c20 5065  , Peak2_Cent, Pe
-000111b0: 616b 335f 4365 6e74 5d29 0a0a 2020 2020  ak3_Cent])..    
-000111c0: 2020 2020 2020 2020 2020 2020 2320 4331              # C1
-000111d0: 3320 6973 206c 6f77 6572 2070 6561 6b0a  3 is lower peak.
-000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111f0: 4331 335f 4365 6e74 3d6e 702e 6d69 6e28  C13_Cent=np.min(
-00011200: 5065 616b 7329 0a20 2020 2020 2020 2020  Peaks).         
-00011210: 2020 2020 2020 2023 2044 6961 6420 6973         # Diad is
-00011220: 206d 6564 6975 6d20 7065 616b 0a20 2020   medium peak.   
-00011230: 2020 2020 2020 2020 2020 2020 2044 6961               Dia
-00011240: 6432 5f43 656e 743d 6e70 2e6d 6564 6961  d2_Cent=np.media
-00011250: 6e28 5065 616b 7329 0a20 2020 2020 2020  n(Peaks).       
-00011260: 2020 2020 2020 2020 2023 2048 6f74 2062           # Hot b
-00011270: 616e 6420 6973 2075 7070 6572 2070 6561  and is upper pea
-00011280: 6b27 0a20 2020 2020 2020 2020 2020 2020  k'.             
-00011290: 2020 2048 4232 5f43 656e 743d 6e70 2e6d     HB2_Cent=np.m
-000112a0: 6178 2850 6561 6b73 290a 0a20 2020 2020  ax(Peaks)..     
-000112b0: 2020 2020 2020 2020 2020 2069 6620 4469             if Di
-000112c0: 6164 325f 4365 6e74 3d3d 5065 616b 325f  ad2_Cent==Peak2_
-000112d0: 4365 6e74 3a0a 2020 2020 2020 2020 2020  Cent:.          
-000112e0: 2020 2020 2020 2020 2020 4469 6164 325f            Diad2_
-000112f0: 496e 743d 5065 616b 325f 496e 740a 2020  Int=Peak2_Int.  
-00011300: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011310: 2044 6961 6432 5f43 656e 743d 3d50 6561   Diad2_Cent==Pea
-00011320: 6b31 5f43 656e 743a 0a20 2020 2020 2020  k1_Cent:.       
-00011330: 2020 2020 2020 2020 2020 2020 2044 6961               Dia
-00011340: 6432 5f49 6e74 3d50 6561 6b31 5f49 6e74  d2_Int=Peak1_Int
-00011350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011360: 2069 6620 4469 6164 325f 4365 6e74 3d3d   if Diad2_Cent==
-00011370: 5065 616b 335f 4365 6e74 3a0a 2020 2020  Peak3_Cent:.    
-00011380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011390: 4469 6164 325f 496e 743d 5065 616b 335f  Diad2_Int=Peak3_
-000113a0: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
-000113b0: 2020 2020 2320 5361 6d65 2066 6f72 2068      # Same for h
-000113c0: 6f74 6261 6e64 0a20 2020 2020 2020 2020  otband.         
-000113d0: 2020 2020 2020 2069 6620 4842 325f 4365         if HB2_Ce
-000113e0: 6e74 3d3d 5065 616b 325f 4365 6e74 3a0a  nt==Peak2_Cent:.
-000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011400: 2020 2020 4842 325f 496e 743d 5065 616b      HB2_Int=Peak
-00011410: 325f 496e 740a 2020 2020 2020 2020 2020  2_Int.          
-00011420: 2020 2020 2020 2020 2020 4842 325f 5369            HB2_Si
-00011430: 676d 613d 5065 616b 325f 5369 676d 610a  gma=Peak2_Sigma.
-00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011450: 6966 2048 4232 5f43 656e 743d 3d50 6561  if HB2_Cent==Pea
-00011460: 6b31 5f43 656e 743a 0a20 2020 2020 2020  k1_Cent:.       
-00011470: 2020 2020 2020 2020 2020 2020 2048 4232               HB2
-00011480: 5f49 6e74 3d50 6561 6b31 5f49 6e74 0a20  _Int=Peak1_Int. 
-00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114a0: 2020 2048 4232 5f53 6967 6d61 3d50 6561     HB2_Sigma=Pea
-000114b0: 6b31 5f53 6967 6d61 0a20 2020 2020 2020  k1_Sigma.       
-000114c0: 2020 2020 2020 2020 2069 6620 4842 325f           if HB2_
-000114d0: 4365 6e74 3d3d 5065 616b 335f 4365 6e74  Cent==Peak3_Cent
-000114e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000114f0: 2020 2020 2020 4842 325f 496e 743d 5065        HB2_Int=Pe
-00011500: 616b 335f 496e 740a 2020 2020 2020 2020  ak3_Int.        
-00011510: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
-00011520: 5369 676d 613d 5065 616b 325f 5369 676d  Sigma=Peak2_Sigm
-00011530: 610a 0a0a 2020 2020 2020 2020 2020 2020  a...            
-00011540: 2020 2020 2320 5361 6d65 2066 6f72 2043      # Same for C
-00011550: 3133 0a20 2020 2020 2020 2020 2020 2020  13.             
-00011560: 2020 2069 6620 4331 335f 4365 6e74 3d3d     if C13_Cent==
-00011570: 5065 616b 325f 4365 6e74 3a0a 2020 2020  Peak2_Cent:.    
-00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011590: 4331 335f 496e 743d 5065 616b 325f 496e  C13_Int=Peak2_In
-000115a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000115b0: 2020 2020 2020 4331 335f 5369 676d 613d        C13_Sigma=
-000115c0: 5065 616b 325f 5369 676d 610a 2020 2020  Peak2_Sigma.    
-000115d0: 2020 2020 2020 2020 2020 2020 6966 2043              if C
-000115e0: 3133 5f43 656e 743d 3d50 6561 6b31 5f43  13_Cent==Peak1_C
-000115f0: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-00011600: 2020 2020 2020 2020 2043 3133 5f49 6e74           C13_Int
-00011610: 3d50 6561 6b31 5f49 6e74 0a20 2020 2020  =Peak1_Int.     
-00011620: 2020 2020 2020 2020 2020 2020 2020 2043                 C
-00011630: 3133 5f53 6967 6d61 3d50 6561 6b31 5f53  13_Sigma=Peak1_S
-00011640: 6967 6d61 0a20 2020 2020 2020 2020 2020  igma.           
-00011650: 2020 2020 2069 6620 4331 335f 4365 6e74       if C13_Cent
-00011660: 3d3d 5065 616b 335f 4365 6e74 3a0a 2020  ==Peak3_Cent:.  
-00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011680: 2020 4331 335f 496e 743d 5065 616b 335f    C13_Int=Peak3_
-00011690: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
-000116a0: 2020 2020 2020 2020 4331 335f 5369 676d          C13_Sigm
-000116b0: 613d 5065 616b 335f 5369 676d 610a 0a20  a=Peak3_Sigma.. 
-000116c0: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
-000116d0: 743d 7064 2e44 6174 6146 7261 6d65 2864  t=pd.DataFrame(d
-000116e0: 6174 613d 7b27 4469 6164 325f 566f 6967  ata={'Diad2_Voig
-000116f0: 745f 4365 6e74 273a 2044 6961 6432 5f43  t_Cent': Diad2_C
-00011700: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
-00011710: 2027 4469 6164 325f 6365 6e74 5f65 7272   'Diad2_cent_err
-00011720: 273a 2065 7272 6f72 5f70 6b32 2c0a 2020  ': error_pk2,.  
-00011730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011750: 2020 2744 6961 6432 5f56 6f69 6774 5f41    'Diad2_Voigt_A
-00011760: 7265 6127 3a20 4469 6164 325f 496e 742c  rea': Diad2_Int,
-00011770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011790: 2020 2020 2027 4469 6164 325f 566f 6967       'Diad2_Voig
-000117a0: 745f 5369 676d 6127 3a20 5065 616b 315f  t_Sigma': Peak1_
-000117b0: 5369 676d 612c 0a20 2020 2020 2020 2020  Sigma,.         
-000117c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117d0: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
-000117e0: 325f 566f 6967 745f 4761 6d6d 6127 3a20  2_Voigt_Gamma': 
-000117f0: 5065 616b 315f 6761 6d6d 612c 0a20 2020  Peak1_gamma,.   
-00011800: 2020 2020 2020 2020 207d 2c20 696e 6465           }, inde
-00011810: 783d 5b30 5d29 0a0a 2020 2020 2020 2020  x=[0])..        
-00011820: 2020 2020 6466 5f6f 7574 5b27 4842 325f      df_out['HB2_
-00011830: 4365 6e74 275d 3d48 4232 5f43 656e 740a  Cent']=HB2_Cent.
-00011840: 2020 2020 2020 2020 2020 2020 6466 5f6f              df_o
-00011850: 7574 5b27 4842 325f 4172 6561 275d 3d48  ut['HB2_Area']=H
-00011860: 4232 5f49 6e74 0a20 2020 2020 2020 2020  B2_Int.         
-00011870: 2020 2064 665f 6f75 745b 2748 4232 5f53     df_out['HB2_S
-00011880: 6967 6d61 275d 3d48 4232 5f53 6967 6d61  igma']=HB2_Sigma
-00011890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000118a0: 2050 6561 6b33 5f43 656e 7420 6973 206e   Peak3_Cent is n
-000118b0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-000118c0: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
-000118d0: 2743 3133 5f43 656e 7427 5d3d 4331 335f  'C13_Cent']=C13_
-000118e0: 4365 6e74 0a20 2020 2020 2020 2020 2020  Cent.           
-000118f0: 2020 2020 2064 665f 6f75 745b 2743 3133       df_out['C13
-00011900: 5f41 7265 6127 5d3d 4331 335f 496e 740a  _Area']=C13_Int.
-00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011920: 6466 5f6f 7574 5b27 4331 335f 5369 676d  df_out['C13_Sigm
-00011930: 6127 5d3d 4331 335f 5369 676d 610a 0a20  a']=C13_Sigma.. 
-00011940: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-00011950: 6164 325f 6f72 6967 785f 616c 6c3d 7265  ad2_origx_all=re
-00011960: 7375 6c74 2e65 7661 6c28 783d 7864 6174  sult.eval(x=xdat
-00011970: 290a 2020 2020 2020 2020 2320 5472 696d  ).        # Trim
-00011980: 2074 6f20 6265 2069 6e20 7261 6e67 650a   to be in range.
-00011990: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
-000119a0: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
-000119b0: 785f 616c 6c29 0a20 2020 2020 2020 2072  x_all).        r
-000119c0: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
-000119d0: 783d 7265 7375 6c74 5f64 6961 6432 5f6f  x=result_diad2_o
-000119e0: 7269 6778 5f61 6c6c 5b28 7864 6174 3e73  rigx_all[(xdat>s
-000119f0: 7061 6e5b 305d 2920 2620 2878 6461 743c  pan[0]) & (xdat<
-00011a00: 7370 616e 5b31 5d29 5d0a 2020 2020 2020  span[1])].      
-00011a10: 2020 7964 6174 5f69 6e72 616e 6765 3d79    ydat_inrange=y
-00011a20: 6461 745b 2878 6461 743e 7370 616e 5b30  dat[(xdat>span[0
-00011a30: 5d29 2026 2028 7864 6174 3c73 7061 6e5b  ]) & (xdat<span[
-00011a40: 315d 295d 0a20 2020 2020 2020 2078 6461  1])].        xda
-00011a50: 745f 696e 7261 6e67 653d 7864 6174 5b28  t_inrange=xdat[(
-00011a60: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
-00011a70: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
-00011a80: 2020 2020 2020 2020 7265 7369 6475 616c          residual
-00011a90: 5f64 6961 645f 636f 6f72 6473 3d79 6461  _diad_coords=yda
-00011aa0: 745f 696e 7261 6e67 652d 7265 7375 6c74  t_inrange-result
-00011ab0: 5f64 6961 6432 5f6f 7269 6778 0a0a 0a20  _diad2_origx... 
-00011ac0: 2020 2020 2020 2078 5f63 656e 745f 6c69         x_cent_li
-00011ad0: 6e3d 6e70 2e6c 696e 7370 6163 6528 6466  n=np.linspace(df
-00011ae0: 5f6f 7574 5b27 4469 6164 325f 566f 6967  _out['Diad2_Voig
-00011af0: 745f 4365 6e74 275d 2d31 2c20 6466 5f6f  t_Cent']-1, df_o
-00011b00: 7574 5b27 4469 6164 325f 566f 6967 745f  ut['Diad2_Voigt_
-00011b10: 4365 6e74 275d 2b31 2c20 3230 3030 3029  Cent']+1, 20000)
-00011b20: 0a20 2020 2020 2020 2079 5f63 656e 745f  .        y_cent_
-00011b30: 6265 7374 5f66 6974 3d72 6573 756c 742e  best_fit=result.
-00011b40: 6576 616c 2878 3d78 5f63 656e 745f 6c69  eval(x=x_cent_li
-00011b50: 6e29 0a20 2020 2020 2020 2064 6961 645f  n).        diad_
-00011b60: 6865 6967 6874 203d 206e 702e 6d61 7828  height = np.max(
-00011b70: 795f 6365 6e74 5f62 6573 745f 6669 7429  y_cent_best_fit)
-00011b80: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
-00011b90: 2744 6961 6432 5f43 6f6d 626f 6669 745f  'Diad2_Combofit_
-00011ba0: 4865 6967 6874 275d 3d20 6469 6164 5f68  Height']= diad_h
-00011bb0: 6569 6768 740a 2020 2020 2020 2020 6466  eight.        df
-00011bc0: 5f6f 7574 2e69 6e73 6572 7428 302c 2027  _out.insert(0, '
-00011bd0: 4469 6164 325f 436f 6d62 6f66 6974 5f43  Diad2_Combofit_C
-00011be0: 656e 7427 2c20 6e70 2e6e 616e 6d65 616e  ent', np.nanmean
-00011bf0: 2878 5f63 656e 745f 6c69 6e5b 795f 6365  (x_cent_lin[y_ce
-00011c00: 6e74 5f62 6573 745f 6669 743d 3d64 6961  nt_best_fit==dia
-00011c10: 645f 6865 6967 6874 5d29 290a 0a0a 2020  d_height]))...  
-00011c20: 2020 2020 2020 7265 7369 6475 616c 5f64        residual_d
-00011c30: 6961 6432 3d6e 702e 7375 6d28 2828 7964  iad2=np.sum(((yd
-00011c40: 6174 5f69 6e72 616e 6765 2d72 6573 756c  at_inrange-resul
-00011c50: 745f 6469 6164 325f 6f72 6967 7829 2a2a  t_diad2_origx)**
-00011c60: 3229 2a2a 302e 3529 2f28 6c65 6e28 7964  2)**0.5)/(len(yd
-00011c70: 6174 5f69 6e72 616e 6765 2929 0a20 2020  at_inrange)).   
-00011c80: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00011c90: 6432 5f52 6573 6964 7561 6c27 5d3d 7265  d2_Residual']=re
-00011ca0: 7369 6475 616c 5f64 6961 6432 0a20 2020  sidual_diad2.   
-00011cb0: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00011cc0: 6432 5f50 726f 705f 4c6f 7227 5d3d 2050  d2_Prop_Lor']= P
-00011cd0: 6561 6b31 5f50 726f 705f 4c6f 720a 2020  eak1_Prop_Lor.  
-00011ce0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
-00011cf0: 6164 325f 6677 686d 275d 3d50 6561 6b31  ad2_fwhm']=Peak1
-00011d00: 5f66 7768 6d0a 0a20 2020 2020 2020 2069  _fwhm..        i
-00011d10: 6620 636f 6e66 6967 312e 6669 745f 6761  f config1.fit_ga
-00011d20: 7573 7320 6973 206e 6f74 2046 616c 7365  uss is not False
-00011d30: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-00011d40: 5f6f 7574 5b27 4469 6164 325f 4761 7573  _out['Diad2_Gaus
-00011d50: 735f 4365 6e74 275d 3d47 6175 7373 5f63  s_Cent']=Gauss_c
-00011d60: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-00011d70: 6466 5f6f 7574 5b27 4469 6164 325f 4761  df_out['Diad2_Ga
-00011d80: 7573 735f 4172 6561 275d 3d47 6175 7373  uss_Area']=Gauss
-00011d90: 5f61 6d70 0a20 2020 2020 2020 2020 2020  _amp.           
-00011da0: 2064 665f 6f75 745b 2744 6961 6432 5f47   df_out['Diad2_G
-00011db0: 6175 7373 5f53 6967 6d61 275d 3d47 6175  auss_Sigma']=Gau
-00011dc0: 7373 5f73 6967 6d61 0a0a 0a20 2020 2020  ss_sigma...     
-00011dd0: 2020 2023 4368 6563 6b69 6e67 2077 6865     #Checking whe
-00011de0: 7468 6572 2079 6f75 206e 6565 6420 616e  ther you need an
-00011df0: 7920 666c 6167 732e 0a20 2020 2020 2020  y flags..       
-00011e00: 2069 6620 6572 726f 725f 706b 3220 6973   if error_pk2 is
-00011e10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00011e20: 2020 2072 6566 6974 3d54 7275 650a 2020     refit=True.  
-00011e30: 2020 2020 2020 2020 2020 7265 6669 745f            refit_
-00011e40: 7061 7261 6d3d 7374 7228 7265 6669 745f  param=str(refit_
-00011e50: 7061 7261 6d29 2b27 204e 6f20 4572 726f  param)+' No Erro
-00011e60: 7227 0a0a 0a20 2020 2020 2020 2069 6620  r'...        if 
-00011e70: 5065 616b 315f 496e 743e 3d28 6361 6c63  Peak1_Int>=(calc
-00011e80: 5f64 6961 645f 616d 706c 6974 7564 652a  _diad_amplitude*
-00011e90: 3130 2d30 2e31 293a 0a20 2020 2020 2020  10-0.1):.       
-00011ea0: 2020 2020 2072 6566 6974 3d54 7275 650a       refit=True.
-00011eb0: 2020 2020 2020 2020 2020 2020 7265 6669              refi
-00011ec0: 745f 7061 7261 6d3d 7374 7228 7265 6669  t_param=str(refi
-00011ed0: 745f 7061 7261 6d29 2b27 2056 5f4c 6f77  t_param)+' V_Low
-00011ee0: 416d 7027 0a20 2020 2020 2020 2069 6620  Amp'.        if 
-00011ef0: 5065 616b 315f 5369 676d 613e 3d28 6361  Peak1_Sigma>=(ca
-00011f00: 6c63 5f64 6961 645f 616d 706c 6974 7564  lc_diad_amplitud
-00011f10: 652a 3130 2d30 2e31 293a 0a20 2020 2020  e*10-0.1):.     
-00011f20: 2020 2020 2020 2072 6566 6974 3d54 7275         refit=Tru
-00011f30: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-00011f40: 6669 745f 7061 7261 6d3d 7374 7228 7265  fit_param=str(re
-00011f50: 6669 745f 7061 7261 6d29 2b27 2056 5f48  fit_param)+' V_H
-00011f60: 6967 6841 6d70 270a 2020 2020 2020 2020  ighAmp'.        
-00011f70: 6966 2050 6561 6b31 5f53 6967 6d61 3e3d  if Peak1_Sigma>=
-00011f80: 2863 6f6e 6669 6731 2e64 6961 645f 7369  (config1.diad_si
-00011f90: 676d 612a 636f 6e66 6967 312e 6469 6164  gma*config1.diad
-00011fa0: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
-00011fb0: 616e 6365 2d30 2e30 3031 293a 0a20 2020  ance-0.001):.   
-00011fc0: 2020 2020 2020 2020 2072 6566 6974 3d54           refit=T
-00011fd0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00011fe0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
-00011ff0: 7265 6669 745f 7061 7261 6d29 2b27 2056  refit_param)+' V
-00012000: 5f53 6967 6d61 5f74 6f6f 5f4c 6f77 270a  _Sigma_too_Low'.
-00012010: 2020 2020 2020 2020 6966 2020 6469 6164          if  diad
-00012020: 5f68 6569 6768 743e 2833 2a63 6f6e 6669  _height>(3*confi
-00012030: 6731 2e64 6961 645f 7072 6f6d 293a 0a20  g1.diad_prom):. 
-00012040: 2020 2020 2020 2020 2020 2072 6566 6974             refit
-00012050: 5f70 6172 616d 3d73 7472 2872 6566 6974  _param=str(refit
-00012060: 5f70 6172 616d 292b 2720 565f 5369 676d  _param)+' V_Sigm
-00012070: 615f 746f 6f5f 4c6f 7727 0a20 2020 2020  a_too_Low'.     
-00012080: 2020 2069 6620 2064 6961 645f 6865 6967     if  diad_heig
-00012090: 6874 3c28 302e 352a 636f 6e66 6967 312e  ht<(0.5*config1.
-000120a0: 6469 6164 5f70 726f 6d29 3a0a 2020 2020  diad_prom):.    
-000120b0: 2020 2020 2020 2020 7265 6669 745f 7061          refit_pa
-000120c0: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
-000120d0: 7261 6d29 2b27 2056 5f53 6967 6d61 5f74  ram)+' V_Sigma_t
-000120e0: 6f6f 5f48 6967 6827 0a20 2020 2020 2020  oo_High'.       
-000120f0: 2069 6620 5065 616b 315f 5369 676d 613c   if Peak1_Sigma<
-00012100: 3d28 636f 6e66 6967 312e 6469 6164 5f73  =(config1.diad_s
-00012110: 6967 6d61 2a63 6f6e 6669 6731 2e64 6961  igma*config1.dia
-00012120: 645f 7369 676d 615f 6d69 6e5f 616c 6c6f  d_sigma_min_allo
-00012130: 7761 6e63 652b 302e 3030 3129 3a0a 2020  wance+0.001):.  
-00012140: 2020 2020 2020 2020 2020 7265 6669 743d            refit=
-00012150: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00012160: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
-00012170: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
-00012180: 565f 5369 676d 615f 746f 6f5f 4869 6768  V_Sigma_too_High
-00012190: 270a 2020 2020 2020 2020 6966 2064 6961  '.        if dia
-000121a0: 645f 6865 6967 6874 3c63 6f6e 6669 6731  d_height<config1
-000121b0: 2e74 6872 6573 686f 6c64 5f69 6e74 656e  .threshold_inten
-000121c0: 7369 7479 3a0a 2020 2020 2020 2020 2020  sity:.          
-000121d0: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
-000121e0: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
-000121f0: 2042 656c 6f77 2074 6872 6573 686f 6c64   Below threshold
-00012200: 2069 6e74 656e 7369 7479 270a 0a20 2020   intensity'..   
-00012210: 2023 6966 2066 696e 646d 650a 0a0a 2020   #if findme...  
-00012220: 2020 2020 2020 6966 2070 6c6f 745f 6669        if plot_fi
-00012230: 6775 7265 2069 7320 5472 7565 3a0a 0a20  gure is True:.. 
-00012240: 2020 2020 2020 2020 2020 2066 6967 2c20             fig, 
-00012250: 2861 7831 2c20 6178 3229 203d 2070 6c74  (ax1, ax2) = plt
-00012260: 2e73 7562 706c 6f74 7328 312c 2032 2c20  .subplots(1, 2, 
-00012270: 6669 6773 697a 653d 2831 322c 3429 290a  figsize=(12,4)).
-00012280: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
-00012290: 706c 6f74 2878 5f6c 696e 2c20 795f 6265  plot(x_lin, y_be
-000122a0: 7374 5f66 6974 2c20 272d 6727 2c20 6c69  st_fit, '-g', li
-000122b0: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
-000122c0: 3d27 6265 7374 2066 6974 2729 0a20 2020  ='best fit').   
-000122d0: 2020 2020 2020 2020 2061 7831 2e70 6c6f           ax1.plo
-000122e0: 7428 7864 6174 2c20 7964 6174 2c20 2027  t(xdat, ydat,  '
-000122f0: 2e6b 272c 206c 6162 656c 3d27 6461 7461  .k', label='data
-00012300: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
-00012310: 7831 2e6c 6567 656e 6428 290a 2020 2020  x1.legend().    
-00012320: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
-00012330: 786c 696d 2861 7831 5f78 6c69 6d29 0a20  xlim(ax1_xlim). 
-00012340: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
-00012350: 6574 5f78 6c69 6d28 6178 325f 786c 696d  et_xlim(ax2_xlim
-00012360: 290a 0a0a 0a0a 0a0a 2020 2020 2020 2020  ).......        
-00012370: 2020 2020 6966 2063 6f6e 6669 6731 2e66      if config1.f
-00012380: 6974 5f67 6175 7373 2069 7320 6e6f 7420  it_gauss is not 
-00012390: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
-000123a0: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
-000123b0: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
-000123c0: 732e 6765 7428 2762 6b67 5f27 292c 2027  s.get('bkg_'), '
-000123d0: 2e63 272c 6c69 6e65 7769 6474 683d 322c  .c',linewidth=2,
-000123e0: 2020 6c61 6265 6c3d 2747 6175 7373 6961    label='Gaussia
-000123f0: 6e20 6263 6b27 290a 2020 2020 2020 2020  n bck').        
-00012400: 2020 2020 6178 322e 706c 6f74 2878 5f6c      ax2.plot(x_l
-00012410: 696e 2c20 636f 6d70 6f6e 656e 7473 2e67  in, components.g
-00012420: 6574 2827 6c7a 315f 2729 2c20 272d 6227  et('lz1_'), '-b'
-00012430: 2c20 6c69 6e65 7769 6474 683d 322c 206c  , linewidth=2, l
-00012440: 6162 656c 3d27 5065 616b 3127 290a 2020  abel='Peak1').  
-00012450: 2020 2020 2020 2020 2020 6178 322e 706c            ax2.pl
-00012460: 6f74 2878 6461 742c 2079 6461 742c 2027  ot(xdat, ydat, '
-00012470: 2e6b 2729 0a0a 0a20 2020 2020 2020 2023  .k')...        #
-00012480: 6178 322e 706c 6f74 2878 6461 742c 2072  ax2.plot(xdat, r
-00012490: 6573 756c 742e 6265 7374 5f66 6974 2c20  esult.best_fit, 
-000124a0: 272d 6727 2c20 6c61 6265 6c3d 2762 6573  '-g', label='bes
-000124b0: 7420 6669 7427 290a 0a20 2020 2020 2020  t fit')..       
-000124c0: 2020 2020 2066 6974 7370 616e 3d6d 6178       fitspan=max
-000124d0: 2879 5f62 6573 745f 6669 7429 2d6d 696e  (y_best_fit)-min
-000124e0: 2879 5f62 6573 745f 6669 7429 0a20 2020  (y_best_fit).   
-000124f0: 2020 2020 2020 2020 2061 7832 2e73 6574           ax2.set
-00012500: 5f79 6c69 6d28 5b6d 696e 2879 5f62 6573  _ylim([min(y_bes
-00012510: 745f 6669 7429 2d66 6974 7370 616e 2f35  t_fit)-fitspan/5
-00012520: 2c20 6d61 7828 795f 6265 7374 5f66 6974  , max(y_best_fit
-00012530: 292b 6669 7473 7061 6e2f 355d 290a 0a0a  )+fitspan/5])...
-00012540: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
-00012550: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
-00012560: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
-00012570: 2020 2020 6178 312e 7365 745f 786c 6162      ax1.set_xlab
-00012580: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
-00012590: 0a20 2020 2020 2020 2020 2020 2061 7832  .            ax2
-000125a0: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
-000125b0: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
-000125c0: 2020 2020 2061 7832 2e73 6574 5f78 6c61       ax2.set_xla
-000125d0: 6265 6c28 2757 6176 656e 756d 6265 7227  bel('Wavenumber'
-000125e0: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
-000125f0: 6966 2066 6974 5f70 6561 6b73 3e31 3a0a  if fit_peaks>1:.
-00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012610: 6178 322e 706c 6f74 2878 5f6c 696e 2c20  ax2.plot(x_lin, 
-00012620: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
-00012630: 6c7a 325f 2729 2c20 272d 7227 2c20 6c69  lz2_'), '-r', li
-00012640: 6e65 7769 6474 683d 322c 206c 6162 656c  newidth=2, label
-00012650: 3d27 5065 616b 3227 290a 0a20 2020 2020  ='Peak2')..     
-00012660: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
-00012670: 616b 733e 323a 0a20 2020 2020 2020 2020  aks>2:.         
-00012680: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
-00012690: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
-000126a0: 732e 6765 7428 276c 7a33 5f27 292c 2027  s.get('lz3_'), '
-000126b0: 2d6d 272c 206c 696e 6577 6964 7468 3d32  -m', linewidth=2
-000126c0: 2c20 6c61 6265 6c3d 2750 6561 6b33 2729  , label='Peak3')
-000126d0: 0a0a 0a20 2020 2020 2020 2020 2020 2061  ...            a
-000126e0: 7832 2e6c 6567 656e 6428 290a 0a20 2020  x2.legend()..   
-000126f0: 2020 2020 2020 2020 2070 6174 6833 3d70           path3=p
-00012700: 6174 682b 272f 272b 2764 6961 645f 6669  ath+'/'+'diad_fi
-00012710: 745f 696d 6167 6573 270a 2020 2020 2020  t_images'.      
-00012720: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00012730: 2e65 7869 7374 7328 7061 7468 3329 3a0a  .exists(path3):.
-00012740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012750: 6f75 743d 2770 6174 6820 6578 6973 7473  out='path exists
-00012760: 270a 2020 2020 2020 2020 2020 2020 656c  '.            el
-00012770: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00012780: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-00012790: 7061 7468 2b27 2f27 2b20 2764 6961 645f  path+'/'+ 'diad_
-000127a0: 6669 745f 696d 6167 6573 272c 2065 7869  fit_images', exi
-000127b0: 7374 5f6f 6b3d 4661 6c73 6529 0a0a 0a20  st_ok=False)... 
-000127c0: 2020 2020 2020 2020 2020 2066 696c 653d             file=
-000127d0: 6669 6c65 6e61 6d65 2e72 7370 6c69 7428  filename.rsplit(
-000127e0: 272e 7478 7427 2c20 3129 5b30 5d0a 2020  '.txt', 1)[0].  
-000127f0: 2020 2020 2020 2020 2020 6669 672e 7361            fig.sa
-00012800: 7665 6669 6728 7061 7468 332b 272f 272b  vefig(path3+'/'+
-00012810: 2744 6961 6432 5f46 6974 5f7b 7d2e 706e  'Diad2_Fit_{}.pn
-00012820: 6727 2e66 6f72 6d61 7428 6669 6c65 292c  g'.format(file),
-00012830: 2064 7069 3d64 7069 290a 0a0a 0a0a 2020   dpi=dpi).....  
-00012840: 2020 2020 2020 6265 7374 5f66 6974 3d72        best_fit=r
-00012850: 6573 756c 742e 6265 7374 5f66 6974 0a0a  esult.best_fit..
-00012860: 2020 2020 2020 2020 6466 5f6f 7574 5b27          df_out['
-00012870: 4469 6164 325f 7265 6669 7427 5d3d 7265  Diad2_refit']=re
-00012880: 6669 745f 7061 7261 6d0a 0a20 2020 2069  fit_param..    i
-00012890: 6620 6469 6164 3120 6973 2054 7275 653a  f diad1 is True:
-000128a0: 0a0a 0a0a 2020 2020 2020 2020 6966 2066  ....        if f
-000128b0: 6974 5f70 6561 6b73 3d3d 313a 0a20 2020  it_peaks==1:.   
-000128c0: 2020 2020 2020 2020 2050 6561 6b32 5f43           Peak2_C
-000128d0: 656e 743d 4e6f 6e65 0a20 2020 2020 2020  ent=None.       
-000128e0: 2020 2020 2050 6561 6b33 5f43 656e 743d       Peak3_Cent=
-000128f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00012900: 2061 7831 5f78 6c69 6d3d 5b43 656e 7465   ax1_xlim=[Cente
-00012910: 725f 696e 692d 3135 2c20 4365 6e74 6572  r_ini-15, Center
-00012920: 5f69 6e69 2b31 355d 0a20 2020 2020 2020  _ini+15].       
-00012930: 2020 2020 2061 7832 5f78 6c69 6d3d 5b43       ax2_xlim=[C
-00012940: 656e 7465 725f 696e 692d 3135 2c20 4365  enter_ini-15, Ce
-00012950: 6e74 6572 5f69 6e69 2b31 355d 0a20 2020  nter_ini+15].   
-00012960: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
-00012970: 733d 3d32 3a0a 2020 2020 2020 2020 2020  s==2:.          
-00012980: 2020 5065 616b 325f 4365 6e74 3d72 6573    Peak2_Cent=res
-00012990: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
-000129a0: 6765 7428 276c 7a32 5f63 656e 7465 7227  get('lz2_center'
-000129b0: 290a 2020 2020 2020 2020 2020 2020 5065  ).            Pe
-000129c0: 616b 325f 496e 743d 7265 7375 6c74 2e62  ak2_Int=result.b
-000129d0: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
-000129e0: 6c7a 325f 616d 706c 6974 7564 6527 290a  lz2_amplitude').
-000129f0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
-00012a00: 325f 5369 676d 613d 7265 7375 6c74 2e62  2_Sigma=result.b
-00012a10: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
-00012a20: 6c7a 325f 7369 676d 6127 290a 2020 2020  lz2_sigma').    
-00012a30: 2020 2020 2020 2020 2320 2320 4368 6563          # # Chec
-00012a40: 6b69 6e67 2070 6172 616d 6574 6572 7320  king parameters 
-00012a50: 666f 7220 686f 7420 6261 6e64 730a 2020  for hot bands.  
-00012a60: 2020 2020 2020 2020 2020 2320 6966 2050            # if P
-00012a70: 6561 6b32 5f53 6967 6d61 3e28 7369 676d  eak2_Sigma>(sigm
-00012a80: 615f 696e 692a 352d 302e 3129 3a0a 2020  a_ini*5-0.1):.  
-00012a90: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00012aa0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
-00012ab0: 7265 6669 745f 7061 7261 6d29 2b27 2048  refit_param)+' H
-00012ac0: 4231 5f48 6967 6853 6967 6d61 270a 2020  B1_HighSigma'.  
-00012ad0: 2020 2020 2020 2020 2020 2320 6966 2050            # if P
-00012ae0: 6561 6b32 5f53 6967 6d61 3c3d 2873 6967  eak2_Sigma<=(sig
-00012af0: 6d61 5f69 6e69 2f32 302b 302e 3129 3a0a  ma_ini/20+0.1):.
-00012b00: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00012b10: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
-00012b20: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
-00012b30: 2048 4231 5f4c 6f77 5369 676d 6127 0a20   HB1_LowSigma'. 
-00012b40: 2020 2020 2020 2020 2020 2023 0a20 2020             #.   
-00012b50: 2020 2020 2020 2020 2023 2069 6620 5065           # if Pe
-00012b60: 616b 325f 496e 743e 2841 6d70 6c69 7475  ak2_Int>(Amplitu
-00012b70: 6465 5f69 6e69 2f35 2d30 2e30 3031 293a  de_ini/5-0.001):
-00012b80: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-00012b90: 2020 2072 6566 6974 5f70 6172 616d 3d73     refit_param=s
-00012ba0: 7472 2872 6566 6974 5f70 6172 616d 292b  tr(refit_param)+
-00012bb0: 2720 4842 315f 4869 6768 416d 7027 0a20  ' HB1_HighAmp'. 
-00012bc0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00012bd0: 5065 616b 325f 496e 743c 3d28 416d 706c  Peak2_Int<=(Ampl
-00012be0: 6974 7564 655f 696e 692f 3130 302b 302e  itude_ini/100+0.
-00012bf0: 3030 3129 3a0a 2020 2020 2020 2020 2020  001):.          
-00012c00: 2020 2320 2020 2020 7265 6669 745f 7061    #     refit_pa
-00012c10: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
-00012c20: 7261 6d29 2b27 2048 4231 5f4c 6f77 416d  ram)+' HB1_LowAm
-00012c30: 7027 0a0a 0a20 2020 2020 2020 2020 2020  p'...           
-00012c40: 2050 6561 6b33 5f43 656e 743d 4e6f 6e65   Peak3_Cent=None
-00012c50: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-00012c60: 5f78 6c69 6d3d 5b43 656e 7465 725f 696e  _xlim=[Center_in
-00012c70: 692d 3330 2c20 4365 6e74 6572 5f69 6e69  i-30, Center_ini
-00012c80: 2b31 355d 0a20 2020 2020 2020 2020 2020  +15].           
-00012c90: 2061 7832 5f78 6c69 6d3d 5b43 656e 7465   ax2_xlim=[Cente
-00012ca0: 725f 696e 692d 3330 2c20 4365 6e74 6572  r_ini-30, Center
-00012cb0: 5f69 6e69 2b31 355d 0a0a 0a0a 2020 2020  _ini+15]....    
-00012cc0: 2020 2020 6966 2050 6561 6b32 5f43 656e      if Peak2_Cen
-00012cd0: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00012ce0: 2020 2020 2020 2064 665f 6f75 743d 7064         df_out=pd
-00012cf0: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-00012d00: 7b27 4469 6164 315f 566f 6967 745f 4365  {'Diad1_Voigt_Ce
-00012d10: 6e74 273a 2050 6561 6b31 5f43 656e 742c  nt': Peak1_Cent,
-00012d20: 0a20 2020 2020 2020 2020 2020 2027 4469  .            'Di
-00012d30: 6164 315f 6365 6e74 5f65 7272 273a 2065  ad1_cent_err': e
-00012d40: 7272 6f72 5f70 6b32 2c0a 2020 2020 2020  rror_pk2,.      
-00012d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d60: 2020 2020 2020 2020 2020 2020 2020 2744                'D
-00012d70: 6961 6431 5f56 6f69 6774 5f41 7265 6127  iad1_Voigt_Area'
-00012d80: 3a20 5065 616b 315f 496e 742c 0a20 2020  : Peak1_Int,.   
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012da0: 2020 2020 2020 2020 2020 2020 2027 4469               'Di
-00012db0: 6164 315f 566f 6967 745f 5369 676d 6127  ad1_Voigt_Sigma'
-00012dc0: 3a20 5065 616b 315f 5369 676d 612c 0a20  : Peak1_Sigma,. 
-00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012de0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00012df0: 4469 6164 315f 566f 6967 745f 4761 6d6d  Diad1_Voigt_Gamm
-00012e00: 6127 3a20 5065 616b 315f 6761 6d6d 612c  a': Peak1_gamma,
-00012e10: 0a0a 0a20 2020 2020 2020 2020 2020 207d  ...            }
-00012e20: 2c20 696e 6465 783d 5b30 5d29 0a20 2020  , index=[0]).   
-00012e30: 2020 2020 2069 6620 5065 616b 325f 4365       if Peak2_Ce
-00012e40: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nt is not None:.
-00012e50: 0a0a 0a0a 0a20 2020 2020 2020 2020 2020  .....           
-00012e60: 2064 665f 6f75 743d 7064 2e44 6174 6146   df_out=pd.DataF
-00012e70: 7261 6d65 2864 6174 613d 7b27 4469 6164  rame(data={'Diad
-00012e80: 315f 566f 6967 745f 4365 6e74 273a 2050  1_Voigt_Cent': P
-00012e90: 6561 6b31 5f43 656e 742c 0a20 2020 2020  eak1_Cent,.     
-00012ea0: 2020 2020 2020 2027 4469 6164 315f 6365         'Diad1_ce
-00012eb0: 6e74 5f65 7272 273a 2065 7272 6f72 5f70  nt_err': error_p
-00012ec0: 6b32 2c0a 2020 2020 2020 2020 2020 2020  k2,.            
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 2020 2020 2020 2020 2744 6961 6431 5f56          'Diad1_V
-00012ef0: 6f69 6774 5f41 7265 6127 3a20 5065 616b  oigt_Area': Peak
-00012f00: 315f 496e 742c 0a20 2020 2020 2020 2020  1_Int,.         
-00012f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f20: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
-00012f30: 315f 566f 6967 745f 5369 676d 6127 3a20  1_Voigt_Sigma': 
-00012f40: 5065 616b 315f 5369 676d 612c 0a20 2020  Peak1_Sigma,.   
-00012f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb90: 2020 2020 2020 2061 6d70 6c69 7475 6465         amplitude
+0000fba0: 3d63 616c 635f 4331 335f 616d 706c 6974  =calc_C13_amplit
+0000fbb0: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
+0000fbc0: 2020 2020 2020 2020 2020 2020 206d 696e               min
+0000fbd0: 5f61 6d70 6c69 7475 6465 3d63 616c 635f  _amplitude=calc_
+0000fbe0: 4331 335f 616d 706c 6974 7564 652a 2830  C13_amplitude*(0
+0000fbf0: 2e35 2a63 6f6e 6669 6731 2e48 425f 616d  .5*config1.HB_am
+0000fc00: 705f 6d69 6e5f 616c 6c6f 7761 6e63 6529  p_min_allowance)
+0000fc10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000fc20: 2020 2020 2020 2020 2020 6d61 785f 616d            max_am
+0000fc30: 706c 6974 7564 653d 6361 6c63 5f43 3133  plitude=calc_C13
+0000fc40: 5f61 6d70 6c69 7475 6465 2a32 2a28 636f  _amplitude*2*(co
+0000fc50: 6e66 6967 312e 4842 5f61 6d70 5f6d 6178  nfig1.HB_amp_max
+0000fc60: 5f61 6c6c 6f77 616e 6365 292c 0a20 2020  _allowance),.   
+0000fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc80: 2020 2020 206d 6f64 656c 5f6e 616d 653d       model_name=
+0000fc90: 636f 6e66 6967 312e 6d6f 6465 6c5f 6e61  config1.model_na
+0000fca0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+0000fcb0: 2020 2020 2020 2020 6d6f 6465 6c33 203d          model3 =
+0000fcc0: 2070 6561 6b2b 6d6f 6465 6c32 0a20 2020   peak+model2.   
+0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fce0: 2070 6172 616d 732e 7570 6461 7465 2870   params.update(p
+0000fcf0: 6172 7329 0a0a 2020 2020 2020 2020 2020  ars)..          
+0000fd00: 2020 7265 7375 6c74 203d 206d 6f64 656c    result = model
+0000fd10: 332e 6669 7428 7964 6174 2c20 7061 7261  3.fit(ydat, para
+0000fd20: 6d73 2c20 783d 7864 6174 290a 0a0a 2020  ms, x=xdat)...  
+0000fd30: 2020 2020 2020 2020 2020 2320 5365 7420            # Set 
+0000fd40: 7468 6520 7061 7261 6d65 7465 7273 206f  the parameters o
+0000fd50: 6620 276c 7a31 2720 746f 2062 6520 6669  f 'lz1' to be fi
+0000fd60: 7865 640a 2020 2020 2020 2020 2020 2020  xed.            
+0000fd70: 7265 7375 6c74 2e70 6172 616d 735b 276c  result.params['l
+0000fd80: 7a32 5f63 656e 7465 7227 5d2e 7661 7279  z2_center'].vary
+0000fd90: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0000fda0: 2020 2020 2072 6573 756c 742e 7061 7261       result.para
+0000fdb0: 6d73 5b27 6c7a 325f 616d 706c 6974 7564  ms['lz2_amplitud
+0000fdc0: 6527 5d2e 7661 7279 203d 2046 616c 7365  e'].vary = False
+0000fdd0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000fde0: 756c 742e 7061 7261 6d73 5b27 6c7a 325f  ult.params['lz2_
+0000fdf0: 7369 676d 6127 5d2e 7661 7279 203d 2046  sigma'].vary = F
+0000fe00: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000fe10: 2072 6573 756c 742e 7061 7261 6d73 5b27   result.params['
+0000fe20: 6c7a 335f 6365 6e74 6572 275d 2e76 6172  lz3_center'].var
+0000fe30: 7920 3d20 4661 6c73 650a 2020 2020 2020  y = False.      
+0000fe40: 2020 2020 2020 7265 7375 6c74 2e70 6172        result.par
+0000fe50: 616d 735b 276c 7a33 5f61 6d70 6c69 7475  ams['lz3_amplitu
+0000fe60: 6465 275d 2e76 6172 7920 3d20 4661 6c73  de'].vary = Fals
+0000fe70: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+0000fe80: 7375 6c74 2e70 6172 616d 735b 276c 7a33  sult.params['lz3
+0000fe90: 5f73 6967 6d61 275d 2e76 6172 7920 3d20  _sigma'].vary = 
+0000fea0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000feb0: 2020 7265 7375 6c74 2e70 6172 616d 735b    result.params[
+0000fec0: 2762 6b67 5f63 656e 7465 7227 5d2e 7661  'bkg_center'].va
+0000fed0: 7279 203d 2046 616c 7365 0a20 2020 2020  ry = False.     
+0000fee0: 2020 2020 2020 2072 6573 756c 742e 7061         result.pa
+0000fef0: 7261 6d73 5b27 626b 675f 616d 706c 6974  rams['bkg_amplit
+0000ff00: 7564 6527 5d2e 7661 7279 203d 2046 616c  ude'].vary = Fal
+0000ff10: 7365 0a20 2020 2020 2020 2020 2020 2072  se.            r
+0000ff20: 6573 756c 742e 7061 7261 6d73 5b27 626b  esult.params['bk
+0000ff30: 675f 7369 676d 6127 5d2e 7661 7279 203d  g_sigma'].vary =
+0000ff40: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+0000ff50: 2020 2020 2320 5065 7266 6f72 6d20 6669      # Perform fi
+0000ff60: 7474 696e 6720 7573 696e 6720 7468 6520  tting using the 
+0000ff70: 656e 7469 7265 206d 6f64 656c 2028 6d6f  entire model (mo
+0000ff80: 6465 6c32 2920 7769 7468 2074 6865 2073  del2) with the s
+0000ff90: 7461 6269 6c69 7a65 6420 276c 7a31 2720  tabilized 'lz1' 
+0000ffa0: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
+0000ffb0: 2020 2020 2020 2066 696e 616c 5f72 6573         final_res
+0000ffc0: 756c 7420 3d20 6d6f 6465 6c33 2e66 6974  ult = model3.fit
+0000ffd0: 2879 6461 742c 2072 6573 756c 742e 7061  (ydat, result.pa
+0000ffe0: 7261 6d73 2c20 783d 7864 6174 290a 2020  rams, x=xdat).  
+0000fff0: 2020 2020 2020 2020 2020 6365 6e74 6572            center
+00010000: 5f65 7272 6f72 203d 2066 696e 616c 5f72  _error = final_r
+00010010: 6573 756c 742e 7061 7261 6d73 5b27 6c7a  esult.params['lz
+00010020: 315f 6365 6e74 6572 275d 2e73 7464 6572  1_center'].stder
+00010030: 720a 0a20 2020 2020 2020 2020 2020 2072  r..            r
+00010040: 6573 756c 743d 6669 6e61 6c5f 7265 7375  esult=final_resu
+00010050: 6c74 0a20 2020 2020 2020 2020 2020 206d  lt.            m
+00010060: 6f64 656c 5f46 3d6d 6f64 656c 330a 0a20  odel_F=model3.. 
+00010070: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00010080: 732e 7570 6461 7465 2866 696e 616c 5f72  s.update(final_r
+00010090: 6573 756c 742e 7061 7261 6d73 290a 0a0a  esult.params)...
+000100a0: 0a0a 0a0a 0a0a 0a20 2020 2023 2052 6567  .......    # Reg
+000100b0: 6172 646c 6573 7320 6f66 2066 6974 2c20  ardless of fit, 
+000100c0: 6576 616c 7561 7465 206d 6f64 656c 0a20  evaluate model. 
+000100d0: 2020 2069 6e69 7420 3d20 6d6f 6465 6c5f     init = model_
+000100e0: 462e 6576 616c 2870 6172 616d 732c 2078  F.eval(params, x
+000100f0: 3d78 6461 7429 0a20 2020 2072 6573 756c  =xdat).    resul
+00010100: 7420 3d20 6d6f 6465 6c5f 462e 6669 7428  t = model_F.fit(
+00010110: 7964 6174 2c20 7061 7261 6d73 2c20 783d  ydat, params, x=
+00010120: 7864 6174 290a 2020 2020 636f 6d70 7320  xdat).    comps 
+00010130: 3d20 7265 7375 6c74 2e65 7661 6c5f 636f  = result.eval_co
+00010140: 6d70 6f6e 656e 7473 2829 0a0a 2020 2020  mponents()..    
+00010150: 2370 7269 6e74 2872 6573 756c 742e 6369  #print(result.ci
+00010160: 5f72 6570 6f72 7428 2929 0a0a 2020 2020  _report())..    
+00010170: 2370 7269 6e74 2872 6573 756c 742e 636f  #print(result.co
+00010180: 6e66 5f69 6e74 6572 7661 6c28 6d65 7468  nf_interval(meth
+00010190: 6f64 3d27 626f 6f74 7374 7261 7027 2929  od='bootstrap'))
+000101a0: 0a0a 2020 2020 2370 7269 6e74 2872 6573  ..    #print(res
+000101b0: 756c 742e 6669 745f 7265 706f 7274 286d  ult.fit_report(m
+000101c0: 696e 5f63 6f72 7265 6c3d 302e 3529 290a  in_correl=0.5)).
+000101d0: 2020 2020 2320 4368 6563 6b20 6966 2066      # Check if f
+000101e0: 756e 6374 696f 6e20 6769 7665 7320 6572  unction gives er
+000101f0: 726f 7220 6261 7273 0a0a 0a20 2020 2023  ror bars...    #
+00010200: 7072 696e 7428 7265 7375 6c74 2e62 6573  print(result.bes
+00010210: 745f 7661 6c75 6573 290a 2020 2020 2320  t_values).    # 
+00010220: 4765 7420 6669 7273 7420 7065 616b 2063  Get first peak c
+00010230: 656e 7465 720a 2020 2020 5065 616b 315f  enter.    Peak1_
+00010240: 4365 6e74 3d72 6573 756c 742e 6265 7374  Cent=result.best
+00010250: 5f76 616c 7565 732e 6765 7428 276c 7a31  _values.get('lz1
+00010260: 5f63 656e 7465 7227 290a 2020 2020 5065  _center').    Pe
+00010270: 616b 315f 496e 743d 7265 7375 6c74 2e62  ak1_Int=result.b
+00010280: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
+00010290: 6c7a 315f 616d 706c 6974 7564 6527 290a  lz1_amplitude').
+000102a0: 2020 2020 5065 616b 315f 5369 676d 613d      Peak1_Sigma=
+000102b0: 7265 7375 6c74 2e62 6573 745f 7661 6c75  result.best_valu
+000102c0: 6573 2e67 6574 2827 6c7a 315f 7369 676d  es.get('lz1_sigm
+000102d0: 6127 290a 2020 2020 5065 616b 315f 6761  a').    Peak1_ga
+000102e0: 6d6d 613d 7265 7375 6c74 2e62 6573 745f  mma=result.best_
+000102f0: 7661 6c75 6573 2e67 6574 2827 6c7a 315f  values.get('lz1_
+00010300: 6761 6d6d 6127 290a 2020 2020 5065 616b  gamma').    Peak
+00010310: 315f 5072 6f70 5f4c 6f72 3d72 6573 756c  1_Prop_Lor=resul
+00010320: 742e 6265 7374 5f76 616c 7565 732e 6765  t.best_values.ge
+00010330: 7428 276c 7a31 5f66 7261 6374 696f 6e27  t('lz1_fraction'
+00010340: 290a 2020 2020 5065 616b 315f 6677 686d  ).    Peak1_fwhm
+00010350: 3d72 6573 756c 742e 7061 7261 6d73 5b27  =result.params['
+00010360: 6c7a 315f 6677 686d 275d 2e76 616c 7565  lz1_fwhm'].value
+00010370: 0a0a 2020 2020 4365 6e74 6572 5f70 6b32  ..    Center_pk2
+00010380: 5f65 7272 6f72 3d72 6573 756c 742e 7061  _error=result.pa
+00010390: 7261 6d73 2e67 6574 2827 6c7a 315f 6365  rams.get('lz1_ce
+000103a0: 6e74 6572 2729 0a0a 2020 2020 6572 726f  nter')..    erro
+000103b0: 725f 706b 3220 3d20 7265 7375 6c74 2e70  r_pk2 = result.p
+000103c0: 6172 616d 735b 276c 7a31 5f63 656e 7465  arams['lz1_cente
+000103d0: 7227 5d2e 7374 6465 7272 0a0a 0a0a 2020  r'].stderr....  
+000103e0: 2020 785f 6c69 6e3d 6e70 2e6c 696e 7370    x_lin=np.linsp
+000103f0: 6163 6528 7370 616e 5b30 5d2c 2073 7061  ace(span[0], spa
+00010400: 6e5b 315d 2c20 3230 3030 290a 2020 2020  n[1], 2000).    
+00010410: 795f 6265 7374 5f66 6974 3d72 6573 756c  y_best_fit=resul
+00010420: 742e 6576 616c 2878 3d78 5f6c 696e 290a  t.eval(x=x_lin).
+00010430: 2020 2020 636f 6d70 6f6e 656e 7473 3d72      components=r
+00010440: 6573 756c 742e 6576 616c 5f63 6f6d 706f  esult.eval_compo
+00010450: 6e65 6e74 7328 783d 785f 6c69 6e29 0a0a  nents(x=x_lin)..
+00010460: 0a0a 0a20 2020 2069 6620 636f 6e66 6967  ...    if config
+00010470: 312e 6669 745f 6761 7573 7320 6973 206e  1.fit_gauss is n
+00010480: 6f74 2046 616c 7365 3a0a 2020 2020 2020  ot False:.      
+00010490: 2020 4761 7573 735f 6365 6e74 3d72 6573    Gauss_cent=res
+000104a0: 756c 742e 6265 7374 5f76 616c 7565 732e  ult.best_values.
+000104b0: 6765 7428 2762 6b67 5f63 656e 7465 7227  get('bkg_center'
+000104c0: 290a 2020 2020 2020 2020 4761 7573 735f  ).        Gauss_
+000104d0: 616d 703d 7265 7375 6c74 2e62 6573 745f  amp=result.best_
+000104e0: 7661 6c75 6573 2e67 6574 2827 626b 675f  values.get('bkg_
+000104f0: 616d 706c 6974 7564 6527 290a 2020 2020  amplitude').    
+00010500: 2020 2020 4761 7573 735f 7369 676d 613d      Gauss_sigma=
+00010510: 7265 7375 6c74 2e62 6573 745f 7661 6c75  result.best_valu
+00010520: 6573 2e67 6574 2827 626b 675f 7369 676d  es.get('bkg_sigm
+00010530: 6127 290a 0a20 2020 2020 2020 206d 6178  a')..        max
+00010540: 5f47 6175 7373 3d6e 702e 6d61 7828 636f  _Gauss=np.max(co
+00010550: 6d70 6f6e 656e 7473 2e67 6574 2827 626b  mponents.get('bk
+00010560: 675f 2729 290a 2020 2020 2020 2020 6d61  g_')).        ma
+00010570: 785f 766f 6967 743d 6e70 2e6d 6178 2863  x_voigt=np.max(c
+00010580: 6f6d 706f 6e65 6e74 732e 6765 7428 276c  omponents.get('l
+00010590: 7a31 5f27 2929 0a20 2020 2020 2020 2069  z1_')).        i
+000105a0: 6620 6d61 785f 4761 7573 733e 6d61 785f  f max_Gauss>max_
+000105b0: 766f 6967 742f 353a 0a20 2020 2020 2020  voigt/5:.       
+000105c0: 2020 2020 2072 6566 6974 5f70 6172 616d       refit_param
+000105d0: 3d73 7472 2872 6566 6974 5f70 6172 616d  =str(refit_param
+000105e0: 292b 2027 2047 5f68 6967 6865 725f 7468  )+ ' G_higher_th
+000105f0: 616e 5f64 6961 6427 0a20 2020 2020 2020  an_diad'.       
+00010600: 2023 2069 6620 4761 7573 735f 7369 676d   # if Gauss_sigm
+00010610: 613e 3d28 636f 6e66 6967 312e 6761 7573  a>=(config1.gaus
+00010620: 735f 7369 676d 612a 3130 2d30 2e31 293a  s_sigma*10-0.1):
+00010630: 0a20 2020 2020 2020 2023 2020 2020 2072  .        #     r
+00010640: 6566 6974 3d54 7275 650a 2020 2020 2020  efit=True.      
+00010650: 2020 2320 2020 2020 7265 6669 745f 7061    #     refit_pa
+00010660: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
+00010670: 7261 6d29 2b27 2047 5f69 6e70 7574 5f54  ram)+' G_input_T
+00010680: 6f6f 4c6f 7753 6967 6d61 270a 2020 2020  ooLowSigma'.    
+00010690: 2020 2020 2320 6966 2047 6175 7373 5f73      # if Gauss_s
+000106a0: 6967 6d61 3c3d 2863 6f6e 6669 6731 2e67  igma<=(config1.g
+000106b0: 6175 7373 5f73 6967 6d61 2f31 302b 302e  auss_sigma/10+0.
+000106c0: 3129 3a0a 2020 2020 2020 2020 2320 2020  1):.        #   
+000106d0: 2020 7265 6669 743d 5472 7565 0a20 2020    refit=True.   
+000106e0: 2020 2020 2023 2020 2020 2072 6566 6974       #     refit
+000106f0: 5f70 6172 616d 3d73 7472 2872 6566 6974  _param=str(refit
+00010700: 5f70 6172 616d 292b 2027 2047 5f69 6e70  _param)+ ' G_inp
+00010710: 7574 5f54 6f6f 4869 6768 5369 676d 6127  ut_TooHighSigma'
+00010720: 0a20 2020 2020 2020 2023 0a20 2020 2020  .        #.     
+00010730: 2020 2023 2069 6620 4761 7573 735f 616d     # if Gauss_am
+00010740: 703e 3d28 636f 6e66 6967 312e 6761 7573  p>=(config1.gaus
+00010750: 735f 616d 702a 3130 2d30 2e31 293a 0a20  s_amp*10-0.1):. 
+00010760: 2020 2020 2020 2023 2020 2020 2072 6566         #     ref
+00010770: 6974 3d54 7275 650a 2020 2020 2020 2020  it=True.        
+00010780: 2320 2020 2020 7265 6669 745f 7061 7261  #     refit_para
+00010790: 6d3d 7374 7228 7265 6669 745f 7061 7261  m=str(refit_para
+000107a0: 6d29 2b27 2047 5f69 6e70 7574 5f54 6f6f  m)+' G_input_Too
+000107b0: 4c6f 7741 6d70 270a 2020 2020 2020 2020  LowAmp'.        
+000107c0: 2320 6966 2047 6175 7373 5f61 6d70 3c3d  # if Gauss_amp<=
+000107d0: 2863 6f6e 6669 6731 2e67 6175 7373 5f73  (config1.gauss_s
+000107e0: 6967 6d61 2b30 2e31 293a 0a20 2020 2020  igma+0.1):.     
+000107f0: 2020 2023 2020 2020 2072 6566 6974 3d54     #     refit=T
+00010800: 7275 650a 2020 2020 2020 2020 2320 2020  rue.        #   
+00010810: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
+00010820: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
+00010830: 2047 5f41 6d70 5f74 6f6f 5f68 6967 6827   G_Amp_too_high'
+00010840: 0a20 2020 2020 2020 2069 6620 4761 7573  .        if Gaus
+00010850: 735f 6365 6e74 3c3d 2863 6f6e 6669 6731  s_cent<=(config1
+00010860: 2e66 6974 5f67 6175 7373 2d33 302b 302e  .fit_gauss-30+0.
+00010870: 3529 3a0a 2020 2020 2020 2020 2020 2020  5):.            
+00010880: 7265 6669 743d 5472 7565 0a20 2020 2020  refit=True.     
+00010890: 2020 2020 2020 2072 6566 6974 5f70 6172         refit_par
+000108a0: 616d 3d73 7472 2872 6566 6974 5f70 6172  am=str(refit_par
+000108b0: 616d 292b 2720 475f 496e 7075 7454 6f6f  am)+' G_InputToo
+000108c0: 4c6f 7743 656e 7427 0a20 2020 2020 2020  LowCent'.       
+000108d0: 2069 6620 4761 7573 735f 6365 6e74 3e3d   if Gauss_cent>=
+000108e0: 2869 6e69 7469 616c 5f67 7565 7373 2b33  (initial_guess+3
+000108f0: 302d 302e 3529 3a0a 2020 2020 2020 2020  0-0.5):.        
+00010900: 2020 2020 7265 6669 743d 5472 7565 0a20      refit=True. 
+00010910: 2020 2020 2020 2020 2020 2072 6566 6974             refit
+00010920: 5f70 6172 616d 3d73 7472 2872 6566 6974  _param=str(refit
+00010930: 5f70 6172 616d 292b 2720 475f 496e 7075  _param)+' G_Inpu
+00010940: 7454 6f6f 4869 6768 4365 6e74 270a 0a0a  tTooHighCent'...
+00010950: 0a0a 0a20 2020 2023 2070 7269 6e74 2827  ...    # print('
+00010960: 6677 686d 2067 6175 7373 2729 0a20 2020  fwhm gauss').   
+00010970: 2023 2070 7269 6e74 2872 6573 756c 742e   # print(result.
+00010980: 6265 7374 5f76 616c 7565 7329 0a0a 0a0a  best_values)....
+00010990: 0a20 2020 2023 0a0a 2020 2020 2320 576f  .    #..    # Wo
+000109a0: 726b 206f 7574 2077 6861 7420 7065 616b  rk out what peak
+000109b0: 2069 7320 7768 6174 0a20 2020 2069 6620   is what.    if 
+000109c0: 6469 6164 3220 6973 2054 7275 653a 0a0a  diad2 is True:..
+000109d0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
+000109e0: 6561 6b73 3d3d 313a 0a0a 2020 2020 2020  eaks==1:..      
+000109f0: 2020 2020 2020 5065 616b 325f 4365 6e74        Peak2_Cent
+00010a00: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00010a10: 2020 5065 616b 335f 4365 6e74 3d4e 6f6e    Peak3_Cent=Non
+00010a20: 650a 2020 2020 2020 2020 2020 2020 6178  e.            ax
+00010a30: 315f 786c 696d 3d5b 4365 6e74 6572 5f69  1_xlim=[Center_i
+00010a40: 6e69 2d31 352c 2043 656e 7465 725f 696e  ni-15, Center_in
+00010a50: 692b 3135 5d0a 2020 2020 2020 2020 2020  i+15].          
+00010a60: 2020 6178 325f 786c 696d 3d5b 4365 6e74    ax2_xlim=[Cent
+00010a70: 6572 5f69 6e69 2d31 352c 2043 656e 7465  er_ini-15, Cente
+00010a80: 725f 696e 692b 3135 5d0a 0a20 2020 2020  r_ini+15]..     
+00010a90: 2020 2069 6620 6669 745f 7065 616b 733d     if fit_peaks=
+00010aa0: 3d32 3a0a 0a20 2020 2020 2020 2020 2020  =2:..           
+00010ab0: 2050 6561 6b32 5f43 656e 743d 7265 7375   Peak2_Cent=resu
+00010ac0: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
+00010ad0: 6574 2827 6c7a 325f 6365 6e74 6572 2729  et('lz2_center')
+00010ae0: 0a20 2020 2020 2020 2020 2020 2050 6561  .            Pea
+00010af0: 6b32 5f49 6e74 3d72 6573 756c 742e 6265  k2_Int=result.be
+00010b00: 7374 5f76 616c 7565 732e 6765 7428 276c  st_values.get('l
+00010b10: 7a32 5f61 6d70 6c69 7475 6465 2729 0a20  z2_amplitude'). 
+00010b20: 2020 2020 2020 2020 2020 2050 6561 6b32             Peak2
+00010b30: 5f53 6967 6d61 3d72 6573 756c 742e 6265  _Sigma=result.be
+00010b40: 7374 5f76 616c 7565 732e 6765 7428 276c  st_values.get('l
+00010b50: 7a32 5f73 6967 6d61 2729 0a20 2020 2020  z2_sigma').     
+00010b60: 2020 2020 2020 2050 6561 6b33 5f43 656e         Peak3_Cen
+00010b70: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00010b80: 2020 2061 7831 5f78 6c69 6d3d 5b43 656e     ax1_xlim=[Cen
+00010b90: 7465 725f 696e 692d 3135 2c20 4365 6e74  ter_ini-15, Cent
+00010ba0: 6572 5f69 6e69 2b33 305d 0a20 2020 2020  er_ini+30].     
+00010bb0: 2020 2020 2020 2061 7832 5f78 6c69 6d3d         ax2_xlim=
+00010bc0: 5b43 656e 7465 725f 696e 692d 3135 2c20  [Center_ini-15, 
+00010bd0: 4365 6e74 6572 5f69 6e69 2b33 305d 0a0a  Center_ini+30]..
+00010be0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
+00010bf0: 6561 6b73 3d3d 333a 0a0a 2020 2020 2020  eaks==3:..      
+00010c00: 2020 2020 2020 5065 616b 325f 4365 6e74        Peak2_Cent
+00010c10: 3d72 6573 756c 742e 6265 7374 5f76 616c  =result.best_val
+00010c20: 7565 732e 6765 7428 276c 7a32 5f63 656e  ues.get('lz2_cen
+00010c30: 7465 7227 290a 2020 2020 2020 2020 2020  ter').          
+00010c40: 2020 5065 616b 325f 496e 743d 7265 7375    Peak2_Int=resu
+00010c50: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
+00010c60: 6574 2827 6c7a 325f 616d 706c 6974 7564  et('lz2_amplitud
+00010c70: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+00010c80: 5065 616b 325f 5369 676d 613d 7265 7375  Peak2_Sigma=resu
+00010c90: 6c74 2e62 6573 745f 7661 6c75 6573 2e67  lt.best_values.g
+00010ca0: 6574 2827 6c7a 325f 7369 676d 6127 290a  et('lz2_sigma').
+00010cb0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+00010cc0: 335f 4365 6e74 3d72 6573 756c 742e 6265  3_Cent=result.be
+00010cd0: 7374 5f76 616c 7565 732e 6765 7428 276c  st_values.get('l
+00010ce0: 7a33 5f63 656e 7465 7227 290a 2020 2020  z3_center').    
+00010cf0: 2020 2020 2020 2020 5065 616b 335f 496e          Peak3_In
+00010d00: 743d 7265 7375 6c74 2e62 6573 745f 7661  t=result.best_va
+00010d10: 6c75 6573 2e67 6574 2827 6c7a 335f 616d  lues.get('lz3_am
+00010d20: 706c 6974 7564 6527 290a 2020 2020 2020  plitude').      
+00010d30: 2020 2020 2020 5065 616b 335f 5369 676d        Peak3_Sigm
+00010d40: 613d 7265 7375 6c74 2e62 6573 745f 7661  a=result.best_va
+00010d50: 6c75 6573 2e67 6574 2827 6c7a 335f 7369  lues.get('lz3_si
+00010d60: 676d 6127 290a 0a20 2020 2020 2020 2020  gma')..         
+00010d70: 2020 2061 7831 5f78 6c69 6d3d 5b43 656e     ax1_xlim=[Cen
+00010d80: 7465 725f 696e 692d 3330 2c20 4365 6e74  ter_ini-30, Cent
+00010d90: 6572 5f69 6e69 2b33 305d 0a20 2020 2020  er_ini+30].     
+00010da0: 2020 2020 2020 2061 7832 5f78 6c69 6d3d         ax2_xlim=
+00010db0: 5b43 656e 7465 725f 696e 692d 3330 2c20  [Center_ini-30, 
+00010dc0: 4365 6e74 6572 5f69 6e69 2b33 305d 0a0a  Center_ini+30]..
+00010dd0: 2020 2020 2020 2020 6966 2050 6561 6b32          if Peak2
+00010de0: 5f43 656e 7420 6973 204e 6f6e 653a 0a20  _Cent is None:. 
+00010df0: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
+00010e00: 743d 7064 2e44 6174 6146 7261 6d65 2864  t=pd.DataFrame(d
+00010e10: 6174 613d 7b27 4469 6164 325f 566f 6967  ata={'Diad2_Voig
+00010e20: 745f 4365 6e74 273a 2050 6561 6b31 5f43  t_Cent': Peak1_C
+00010e30: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e50: 2020 2020 2020 2020 2027 4469 6164 325f           'Diad2_
+00010e60: 6365 6e74 5f65 7272 273a 2065 7272 6f72  cent_err': error
+00010e70: 5f70 6b32 2c0a 2020 2020 2020 2020 2020  _pk2,.          
+00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e90: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
+00010ea0: 5f56 6f69 6774 5f41 7265 6127 3a20 5065  _Voigt_Area': Pe
+00010eb0: 616b 315f 496e 742c 0a20 2020 2020 2020  ak1_Int,.       
+00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ed0: 2020 2020 2020 2020 2027 4469 6164 325f           'Diad2_
+00010ee0: 566f 6967 745f 5369 676d 6127 3a20 5065  Voigt_Sigma': Pe
+00010ef0: 616b 315f 5369 676d 612c 0a20 2020 2020  ak1_Sigma,.     
+00010f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f10: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
+00010f20: 325f 566f 6967 745f 4761 6d6d 6127 3a20  2_Voigt_Gamma': 
+00010f30: 5065 616b 315f 6761 6d6d 612c 0a0a 0a20  Peak1_gamma,... 
+00010f40: 2020 2020 2020 2020 2020 207d 2c20 696e             }, in
+00010f50: 6465 783d 5b30 5d29 0a0a 2020 2020 2020  dex=[0])..      
+00010f60: 2020 6966 2050 6561 6b32 5f43 656e 7420    if Peak2_Cent 
+00010f70: 6973 206e 6f74 204e 6f6e 653a 0a0a 0a20  is not None:... 
+00010f80: 2020 2020 2020 2020 2020 2069 6620 5065             if Pe
+00010f90: 616b 335f 4365 6e74 2069 7320 4e6f 6e65  ak3_Cent is None
+00010fa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010fb0: 2020 5065 616b 733d 6e70 2e61 7272 6179    Peaks=np.array
+00010fc0: 285b 5065 616b 315f 4365 6e74 2c20 5065  ([Peak1_Cent, Pe
+00010fd0: 616b 325f 4365 6e74 5d29 0a20 2020 2020  ak2_Cent]).     
+00010fe0: 2020 2020 2020 2020 2020 2023 2044 6961             # Dia
+00010ff0: 6420 6973 206c 6f77 6572 2070 6561 6b0a  d is lower peak.
+00011000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011010: 4469 6164 325f 4365 6e74 3d6e 702e 6d69  Diad2_Cent=np.mi
+00011020: 6e28 5065 616b 7329 0a20 2020 2020 2020  n(Peaks).       
+00011030: 2020 2020 2020 2020 2023 2048 6f74 2062           # Hot b
+00011040: 616e 6420 6973 2075 7070 6572 2070 6561  and is upper pea
+00011050: 6b27 0a20 2020 2020 2020 2020 2020 2020  k'.             
+00011060: 2020 2048 4232 5f43 656e 743d 6e70 2e6d     HB2_Cent=np.m
+00011070: 6178 2850 6561 6b73 290a 2020 2020 2020  ax(Peaks).      
+00011080: 2020 2020 2020 2020 2020 2320 416c 6c6f            # Allo
+00011090: 6361 7465 2061 7265 6173 0a20 2020 2020  cate areas.     
+000110a0: 2020 2020 2020 2020 2020 2069 6620 4469             if Di
+000110b0: 6164 325f 4365 6e74 3d3d 5065 616b 325f  ad2_Cent==Peak2_
+000110c0: 4365 6e74 3a0a 2020 2020 2020 2020 2020  Cent:.          
+000110d0: 2020 2020 2020 2020 2020 4469 6164 325f            Diad2_
+000110e0: 496e 743d 5065 616b 325f 496e 740a 2020  Int=Peak2_Int.  
+000110f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011100: 2020 4842 325f 496e 743d 5065 616b 315f    HB2_Int=Peak1_
+00011110: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
+00011120: 2020 2020 2020 2020 4842 325f 5369 676d          HB2_Sigm
+00011130: 613d 5065 616b 315f 5369 676d 610a 2020  a=Peak1_Sigma.  
+00011140: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011150: 2044 6961 6432 5f43 656e 743d 3d50 6561   Diad2_Cent==Pea
+00011160: 6b31 5f43 656e 743a 0a20 2020 2020 2020  k1_Cent:.       
+00011170: 2020 2020 2020 2020 2020 2020 2044 6961               Dia
+00011180: 6432 5f49 6e74 3d50 6561 6b31 5f49 6e74  d2_Int=Peak1_Int
+00011190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000111a0: 2020 2020 2048 4232 5f49 6e74 3d50 6561       HB2_Int=Pea
+000111b0: 6b32 5f49 6e74 0a20 2020 2020 2020 2020  k2_Int.         
+000111c0: 2020 2020 2020 2020 2020 2048 4232 5f53             HB2_S
+000111d0: 6967 6d61 3d50 6561 6b32 5f53 6967 6d61  igma=Peak2_Sigma
+000111e0: 0a0a 0a0a 0a20 2020 2020 2020 2020 2020  .....           
+000111f0: 2069 6620 5065 616b 335f 4365 6e74 2069   if Peak3_Cent i
+00011200: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00011210: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+00011220: 733d 6e70 2e61 7272 6179 285b 5065 616b  s=np.array([Peak
+00011230: 315f 4365 6e74 2c20 5065 616b 325f 4365  1_Cent, Peak2_Ce
+00011240: 6e74 2c20 5065 616b 335f 4365 6e74 5d29  nt, Peak3_Cent])
+00011250: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011260: 2020 2320 4331 3320 6973 206c 6f77 6572    # C13 is lower
+00011270: 2070 6561 6b0a 2020 2020 2020 2020 2020   peak.          
+00011280: 2020 2020 2020 4331 335f 4365 6e74 3d6e        C13_Cent=n
+00011290: 702e 6d69 6e28 5065 616b 7329 0a20 2020  p.min(Peaks).   
+000112a0: 2020 2020 2020 2020 2020 2020 2023 2044               # D
+000112b0: 6961 6420 6973 206d 6564 6975 6d20 7065  iad is medium pe
+000112c0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+000112d0: 2020 2044 6961 6432 5f43 656e 743d 6e70     Diad2_Cent=np
+000112e0: 2e6d 6564 6961 6e28 5065 616b 7329 0a20  .median(Peaks). 
+000112f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00011300: 2048 6f74 2062 616e 6420 6973 2075 7070   Hot band is upp
+00011310: 6572 2070 6561 6b27 0a20 2020 2020 2020  er peak'.       
+00011320: 2020 2020 2020 2020 2048 4232 5f43 656e           HB2_Cen
+00011330: 743d 6e70 2e6d 6178 2850 6561 6b73 290a  t=np.max(Peaks).
+00011340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011350: 2069 6620 4469 6164 325f 4365 6e74 3d3d   if Diad2_Cent==
+00011360: 5065 616b 325f 4365 6e74 3a0a 2020 2020  Peak2_Cent:.    
+00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011380: 4469 6164 325f 496e 743d 5065 616b 325f  Diad2_Int=Peak2_
+00011390: 496e 740a 2020 2020 2020 2020 2020 2020  Int.            
+000113a0: 2020 2020 6966 2044 6961 6432 5f43 656e      if Diad2_Cen
+000113b0: 743d 3d50 6561 6b31 5f43 656e 743a 0a20  t==Peak1_Cent:. 
+000113c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000113d0: 2020 2044 6961 6432 5f49 6e74 3d50 6561     Diad2_Int=Pea
+000113e0: 6b31 5f49 6e74 0a20 2020 2020 2020 2020  k1_Int.         
+000113f0: 2020 2020 2020 2069 6620 4469 6164 325f         if Diad2_
+00011400: 4365 6e74 3d3d 5065 616b 335f 4365 6e74  Cent==Peak3_Cent
+00011410: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011420: 2020 2020 2020 4469 6164 325f 496e 743d        Diad2_Int=
+00011430: 5065 616b 335f 496e 740a 2020 2020 2020  Peak3_Int.      
+00011440: 2020 2020 2020 2020 2020 2320 5361 6d65            # Same
+00011450: 2066 6f72 2068 6f74 6261 6e64 0a20 2020   for hotband.   
+00011460: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011470: 4842 325f 4365 6e74 3d3d 5065 616b 325f  HB2_Cent==Peak2_
+00011480: 4365 6e74 3a0a 2020 2020 2020 2020 2020  Cent:.          
+00011490: 2020 2020 2020 2020 2020 4842 325f 496e            HB2_In
+000114a0: 743d 5065 616b 325f 496e 740a 2020 2020  t=Peak2_Int.    
+000114b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114c0: 4842 325f 5369 676d 613d 5065 616b 325f  HB2_Sigma=Peak2_
+000114d0: 5369 676d 610a 2020 2020 2020 2020 2020  Sigma.          
+000114e0: 2020 2020 2020 6966 2048 4232 5f43 656e        if HB2_Cen
+000114f0: 743d 3d50 6561 6b31 5f43 656e 743a 0a20  t==Peak1_Cent:. 
+00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011510: 2020 2048 4232 5f49 6e74 3d50 6561 6b31     HB2_Int=Peak1
+00011520: 5f49 6e74 0a20 2020 2020 2020 2020 2020  _Int.           
+00011530: 2020 2020 2020 2020 2048 4232 5f53 6967           HB2_Sig
+00011540: 6d61 3d50 6561 6b31 5f53 6967 6d61 0a20  ma=Peak1_Sigma. 
+00011550: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011560: 6620 4842 325f 4365 6e74 3d3d 5065 616b  f HB2_Cent==Peak
+00011570: 335f 4365 6e74 3a0a 2020 2020 2020 2020  3_Cent:.        
+00011580: 2020 2020 2020 2020 2020 2020 4842 325f              HB2_
+00011590: 496e 743d 5065 616b 335f 496e 740a 2020  Int=Peak3_Int.  
+000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115b0: 2020 4842 325f 5369 676d 613d 5065 616b    HB2_Sigma=Peak
+000115c0: 325f 5369 676d 610a 0a0a 2020 2020 2020  2_Sigma...      
+000115d0: 2020 2020 2020 2020 2020 2320 5361 6d65            # Same
+000115e0: 2066 6f72 2043 3133 0a20 2020 2020 2020   for C13.       
+000115f0: 2020 2020 2020 2020 2069 6620 4331 335f           if C13_
+00011600: 4365 6e74 3d3d 5065 616b 325f 4365 6e74  Cent==Peak2_Cent
+00011610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011620: 2020 2020 2020 4331 335f 496e 743d 5065        C13_Int=Pe
+00011630: 616b 325f 496e 740a 2020 2020 2020 2020  ak2_Int.        
+00011640: 2020 2020 2020 2020 2020 2020 4331 335f              C13_
+00011650: 5369 676d 613d 5065 616b 325f 5369 676d  Sigma=Peak2_Sigm
+00011660: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
+00011670: 2020 6966 2043 3133 5f43 656e 743d 3d50    if C13_Cent==P
+00011680: 6561 6b31 5f43 656e 743a 0a20 2020 2020  eak1_Cent:.     
+00011690: 2020 2020 2020 2020 2020 2020 2020 2043                 C
+000116a0: 3133 5f49 6e74 3d50 6561 6b31 5f49 6e74  13_Int=Peak1_Int
+000116b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000116c0: 2020 2020 2043 3133 5f53 6967 6d61 3d50       C13_Sigma=P
+000116d0: 6561 6b31 5f53 6967 6d61 0a20 2020 2020  eak1_Sigma.     
+000116e0: 2020 2020 2020 2020 2020 2069 6620 4331             if C1
+000116f0: 335f 4365 6e74 3d3d 5065 616b 335f 4365  3_Cent==Peak3_Ce
+00011700: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
+00011710: 2020 2020 2020 2020 4331 335f 496e 743d          C13_Int=
+00011720: 5065 616b 335f 496e 740a 2020 2020 2020  Peak3_Int.      
+00011730: 2020 2020 2020 2020 2020 2020 2020 4331                C1
+00011740: 335f 5369 676d 613d 5065 616b 335f 5369  3_Sigma=Peak3_Si
+00011750: 676d 610a 0a20 2020 2020 2020 2020 2020  gma..           
+00011760: 2064 665f 6f75 743d 7064 2e44 6174 6146   df_out=pd.DataF
+00011770: 7261 6d65 2864 6174 613d 7b27 4469 6164  rame(data={'Diad
+00011780: 325f 566f 6967 745f 4365 6e74 273a 2044  2_Voigt_Cent': D
+00011790: 6961 6432 5f43 656e 742c 0a20 2020 2020  iad2_Cent,.     
+000117a0: 2020 2020 2020 2027 4469 6164 325f 6365         'Diad2_ce
+000117b0: 6e74 5f65 7272 273a 2065 7272 6f72 5f70  nt_err': error_p
+000117c0: 6b32 2c0a 2020 2020 2020 2020 2020 2020  k2,.            
+000117d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117e0: 2020 2020 2020 2020 2744 6961 6432 5f56          'Diad2_V
+000117f0: 6f69 6774 5f41 7265 6127 3a20 4469 6164  oigt_Area': Diad
+00011800: 325f 496e 742c 0a20 2020 2020 2020 2020  2_Int,.         
+00011810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011820: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
+00011830: 325f 566f 6967 745f 5369 676d 6127 3a20  2_Voigt_Sigma': 
+00011840: 5065 616b 315f 5369 676d 612c 0a20 2020  Peak1_Sigma,.   
+00011850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011870: 2027 4469 6164 325f 566f 6967 745f 4761   'Diad2_Voigt_Ga
+00011880: 6d6d 6127 3a20 5065 616b 315f 6761 6d6d  mma': Peak1_gamm
+00011890: 612c 0a20 2020 2020 2020 2020 2020 207d  a,.            }
+000118a0: 2c20 696e 6465 783d 5b30 5d29 0a0a 2020  , index=[0])..  
+000118b0: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+000118c0: 5b27 4842 325f 4365 6e74 275d 3d48 4232  ['HB2_Cent']=HB2
+000118d0: 5f43 656e 740a 2020 2020 2020 2020 2020  _Cent.          
+000118e0: 2020 6466 5f6f 7574 5b27 4842 325f 4172    df_out['HB2_Ar
+000118f0: 6561 275d 3d48 4232 5f49 6e74 0a20 2020  ea']=HB2_Int.   
+00011900: 2020 2020 2020 2020 2064 665f 6f75 745b           df_out[
+00011910: 2748 4232 5f53 6967 6d61 275d 3d48 4232  'HB2_Sigma']=HB2
+00011920: 5f53 6967 6d61 0a20 2020 2020 2020 2020  _Sigma.         
+00011930: 2020 2069 6620 2050 6561 6b33 5f43 656e     if  Peak3_Cen
+00011940: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+00011950: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011960: 665f 6f75 745b 2743 3133 5f43 656e 7427  f_out['C13_Cent'
+00011970: 5d3d 4331 335f 4365 6e74 0a20 2020 2020  ]=C13_Cent.     
+00011980: 2020 2020 2020 2020 2020 2064 665f 6f75             df_ou
+00011990: 745b 2743 3133 5f41 7265 6127 5d3d 4331  t['C13_Area']=C1
+000119a0: 335f 496e 740a 2020 2020 2020 2020 2020  3_Int.          
+000119b0: 2020 2020 2020 6466 5f6f 7574 5b27 4331        df_out['C1
+000119c0: 335f 5369 676d 6127 5d3d 4331 335f 5369  3_Sigma']=C13_Si
+000119d0: 676d 610a 0a20 2020 2020 2020 2072 6573  gma..        res
+000119e0: 756c 745f 6469 6164 325f 6f72 6967 785f  ult_diad2_origx_
+000119f0: 616c 6c3d 7265 7375 6c74 2e65 7661 6c28  all=result.eval(
+00011a00: 783d 7864 6174 290a 2020 2020 2020 2020  x=xdat).        
+00011a10: 2320 5472 696d 2074 6f20 6265 2069 6e20  # Trim to be in 
+00011a20: 7261 6e67 650a 2020 2020 2020 2020 2370  range.        #p
+00011a30: 7269 6e74 2872 6573 756c 745f 6469 6164  rint(result_diad
+00011a40: 325f 6f72 6967 785f 616c 6c29 0a20 2020  2_origx_all).   
+00011a50: 2020 2020 2072 6573 756c 745f 6469 6164       result_diad
+00011a60: 325f 6f72 6967 783d 7265 7375 6c74 5f64  2_origx=result_d
+00011a70: 6961 6432 5f6f 7269 6778 5f61 6c6c 5b28  iad2_origx_all[(
+00011a80: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
+00011a90: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
+00011aa0: 2020 2020 2020 2020 7964 6174 5f69 6e72          ydat_inr
+00011ab0: 616e 6765 3d79 6461 745b 2878 6461 743e  ange=ydat[(xdat>
+00011ac0: 7370 616e 5b30 5d29 2026 2028 7864 6174  span[0]) & (xdat
+00011ad0: 3c73 7061 6e5b 315d 295d 0a20 2020 2020  <span[1])].     
+00011ae0: 2020 2078 6461 745f 696e 7261 6e67 653d     xdat_inrange=
+00011af0: 7864 6174 5b28 7864 6174 3e73 7061 6e5b  xdat[(xdat>span[
+00011b00: 305d 2920 2620 2878 6461 743c 7370 616e  0]) & (xdat<span
+00011b10: 5b31 5d29 5d0a 2020 2020 2020 2020 7265  [1])].        re
+00011b20: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
+00011b30: 6473 3d79 6461 745f 696e 7261 6e67 652d  ds=ydat_inrange-
+00011b40: 7265 7375 6c74 5f64 6961 6432 5f6f 7269  result_diad2_ori
+00011b50: 6778 0a0a 0a20 2020 2020 2020 2078 5f63  gx...        x_c
+00011b60: 656e 745f 6c69 6e3d 6e70 2e6c 696e 7370  ent_lin=np.linsp
+00011b70: 6163 6528 6466 5f6f 7574 5b27 4469 6164  ace(df_out['Diad
+00011b80: 325f 566f 6967 745f 4365 6e74 275d 2d31  2_Voigt_Cent']-1
+00011b90: 2c20 6466 5f6f 7574 5b27 4469 6164 325f  , df_out['Diad2_
+00011ba0: 566f 6967 745f 4365 6e74 275d 2b31 2c20  Voigt_Cent']+1, 
+00011bb0: 3230 3030 3029 0a20 2020 2020 2020 2079  20000).        y
+00011bc0: 5f63 656e 745f 6265 7374 5f66 6974 3d72  _cent_best_fit=r
+00011bd0: 6573 756c 742e 6576 616c 2878 3d78 5f63  esult.eval(x=x_c
+00011be0: 656e 745f 6c69 6e29 0a20 2020 2020 2020  ent_lin).       
+00011bf0: 2064 6961 645f 6865 6967 6874 203d 206e   diad_height = n
+00011c00: 702e 6d61 7828 795f 6365 6e74 5f62 6573  p.max(y_cent_bes
+00011c10: 745f 6669 7429 0a20 2020 2020 2020 2064  t_fit).        d
+00011c20: 665f 6f75 745b 2744 6961 6432 5f43 6f6d  f_out['Diad2_Com
+00011c30: 626f 6669 745f 4865 6967 6874 275d 3d20  bofit_Height']= 
+00011c40: 6469 6164 5f68 6569 6768 740a 2020 2020  diad_height.    
+00011c50: 2020 2020 6466 5f6f 7574 2e69 6e73 6572      df_out.inser
+00011c60: 7428 302c 2027 4469 6164 325f 436f 6d62  t(0, 'Diad2_Comb
+00011c70: 6f66 6974 5f43 656e 7427 2c20 6e70 2e6e  ofit_Cent', np.n
+00011c80: 616e 6d65 616e 2878 5f63 656e 745f 6c69  anmean(x_cent_li
+00011c90: 6e5b 795f 6365 6e74 5f62 6573 745f 6669  n[y_cent_best_fi
+00011ca0: 743d 3d64 6961 645f 6865 6967 6874 5d29  t==diad_height])
+00011cb0: 290a 0a0a 2020 2020 2020 2020 7265 7369  )...        resi
+00011cc0: 6475 616c 5f64 6961 6432 3d6e 702e 7375  dual_diad2=np.su
+00011cd0: 6d28 2828 7964 6174 5f69 6e72 616e 6765  m(((ydat_inrange
+00011ce0: 2d72 6573 756c 745f 6469 6164 325f 6f72  -result_diad2_or
+00011cf0: 6967 7829 2a2a 3229 2a2a 302e 3529 2f28  igx)**2)**0.5)/(
+00011d00: 6c65 6e28 7964 6174 5f69 6e72 616e 6765  len(ydat_inrange
+00011d10: 2929 0a20 2020 2020 2020 2064 665f 6f75  )).        df_ou
+00011d20: 745b 2744 6961 6432 5f52 6573 6964 7561  t['Diad2_Residua
+00011d30: 6c27 5d3d 7265 7369 6475 616c 5f64 6961  l']=residual_dia
+00011d40: 6432 0a20 2020 2020 2020 2064 665f 6f75  d2.        df_ou
+00011d50: 745b 2744 6961 6432 5f50 726f 705f 4c6f  t['Diad2_Prop_Lo
+00011d60: 7227 5d3d 2050 6561 6b31 5f50 726f 705f  r']= Peak1_Prop_
+00011d70: 4c6f 720a 2020 2020 2020 2020 6466 5f6f  Lor.        df_o
+00011d80: 7574 5b27 4469 6164 325f 6677 686d 275d  ut['Diad2_fwhm']
+00011d90: 3d50 6561 6b31 5f66 7768 6d0a 0a20 2020  =Peak1_fwhm..   
+00011da0: 2020 2020 2069 6620 636f 6e66 6967 312e       if config1.
+00011db0: 6669 745f 6761 7573 7320 6973 206e 6f74  fit_gauss is not
+00011dc0: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
+00011dd0: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
+00011de0: 325f 4761 7573 735f 4365 6e74 275d 3d47  2_Gauss_Cent']=G
+00011df0: 6175 7373 5f63 656e 740a 2020 2020 2020  auss_cent.      
+00011e00: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
+00011e10: 6164 325f 4761 7573 735f 4172 6561 275d  ad2_Gauss_Area']
+00011e20: 3d47 6175 7373 5f61 6d70 0a20 2020 2020  =Gauss_amp.     
+00011e30: 2020 2020 2020 2064 665f 6f75 745b 2744         df_out['D
+00011e40: 6961 6432 5f47 6175 7373 5f53 6967 6d61  iad2_Gauss_Sigma
+00011e50: 275d 3d47 6175 7373 5f73 6967 6d61 0a0a  ']=Gauss_sigma..
+00011e60: 0a20 2020 2020 2020 2023 4368 6563 6b69  .        #Checki
+00011e70: 6e67 2077 6865 7468 6572 2079 6f75 206e  ng whether you n
+00011e80: 6565 6420 616e 7920 666c 6167 732e 0a20  eed any flags.. 
+00011e90: 2020 2020 2020 2069 6620 6572 726f 725f         if error_
+00011ea0: 706b 3220 6973 204e 6f6e 653a 0a20 2020  pk2 is None:.   
+00011eb0: 2020 2020 2020 2020 2072 6566 6974 3d54           refit=T
+00011ec0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00011ed0: 7265 6669 745f 7061 7261 6d3d 7374 7228  refit_param=str(
+00011ee0: 7265 6669 745f 7061 7261 6d29 2b27 204e  refit_param)+' N
+00011ef0: 6f20 4572 726f 7227 0a0a 0a20 2020 2020  o Error'...     
+00011f00: 2020 2069 6620 5065 616b 315f 496e 743e     if Peak1_Int>
+00011f10: 3d28 6361 6c63 5f64 6961 645f 616d 706c  =(calc_diad_ampl
+00011f20: 6974 7564 652a 3130 2d30 2e31 293a 0a20  itude*10-0.1):. 
+00011f30: 2020 2020 2020 2020 2020 2072 6566 6974             refit
+00011f40: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+00011f50: 2020 7265 6669 745f 7061 7261 6d3d 7374    refit_param=st
+00011f60: 7228 7265 6669 745f 7061 7261 6d29 2b27  r(refit_param)+'
+00011f70: 2056 5f4c 6f77 416d 7027 0a20 2020 2020   V_LowAmp'.     
+00011f80: 2020 2069 6620 5065 616b 315f 5369 676d     if Peak1_Sigm
+00011f90: 613e 3d28 6361 6c63 5f64 6961 645f 616d  a>=(calc_diad_am
+00011fa0: 706c 6974 7564 652a 3130 2d30 2e31 293a  plitude*10-0.1):
+00011fb0: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
+00011fc0: 6974 3d54 7275 650a 2020 2020 2020 2020  it=True.        
+00011fd0: 2020 2020 7265 6669 745f 7061 7261 6d3d      refit_param=
+00011fe0: 7374 7228 7265 6669 745f 7061 7261 6d29  str(refit_param)
+00011ff0: 2b27 2056 5f48 6967 6841 6d70 270a 2020  +' V_HighAmp'.  
+00012000: 2020 2020 2020 6966 2050 6561 6b31 5f53        if Peak1_S
+00012010: 6967 6d61 3e3d 2863 6f6e 6669 6731 2e64  igma>=(config1.d
+00012020: 6961 645f 7369 676d 612a 636f 6e66 6967  iad_sigma*config
+00012030: 312e 6469 6164 5f73 6967 6d61 5f6d 6178  1.diad_sigma_max
+00012040: 5f61 6c6c 6f77 616e 6365 2d30 2e30 3031  _allowance-0.001
+00012050: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00012060: 6566 6974 3d54 7275 650a 2020 2020 2020  efit=True.      
+00012070: 2020 2020 2020 7265 6669 745f 7061 7261        refit_para
+00012080: 6d3d 7374 7228 7265 6669 745f 7061 7261  m=str(refit_para
+00012090: 6d29 2b27 2056 5f53 6967 6d61 5f74 6f6f  m)+' V_Sigma_too
+000120a0: 5f4c 6f77 270a 2020 2020 2020 2020 6966  _Low'.        if
+000120b0: 2020 6469 6164 5f68 6569 6768 743e 2833    diad_height>(3
+000120c0: 2a63 6f6e 6669 6731 2e64 6961 645f 7072  *config1.diad_pr
+000120d0: 6f6d 293a 0a20 2020 2020 2020 2020 2020  om):.           
+000120e0: 2072 6566 6974 5f70 6172 616d 3d73 7472   refit_param=str
+000120f0: 2872 6566 6974 5f70 6172 616d 292b 2720  (refit_param)+' 
+00012100: 565f 5369 676d 615f 746f 6f5f 4c6f 7727  V_Sigma_too_Low'
+00012110: 0a20 2020 2020 2020 2069 6620 2064 6961  .        if  dia
+00012120: 645f 6865 6967 6874 3c28 302e 352a 636f  d_height<(0.5*co
+00012130: 6e66 6967 312e 6469 6164 5f70 726f 6d29  nfig1.diad_prom)
+00012140: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012150: 6669 745f 7061 7261 6d3d 7374 7228 7265  fit_param=str(re
+00012160: 6669 745f 7061 7261 6d29 2b27 2056 5f53  fit_param)+' V_S
+00012170: 6967 6d61 5f74 6f6f 5f48 6967 6827 0a20  igma_too_High'. 
+00012180: 2020 2020 2020 2069 6620 5065 616b 315f         if Peak1_
+00012190: 5369 676d 613c 3d28 636f 6e66 6967 312e  Sigma<=(config1.
+000121a0: 6469 6164 5f73 6967 6d61 2a63 6f6e 6669  diad_sigma*confi
+000121b0: 6731 2e64 6961 645f 7369 676d 615f 6d69  g1.diad_sigma_mi
+000121c0: 6e5f 616c 6c6f 7761 6e63 652b 302e 3030  n_allowance+0.00
+000121d0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+000121e0: 7265 6669 743d 5472 7565 0a20 2020 2020  refit=True.     
+000121f0: 2020 2020 2020 2072 6566 6974 5f70 6172         refit_par
+00012200: 616d 3d73 7472 2872 6566 6974 5f70 6172  am=str(refit_par
+00012210: 616d 292b 2720 565f 5369 676d 615f 746f  am)+' V_Sigma_to
+00012220: 6f5f 4869 6768 270a 2020 2020 2020 2020  o_High'.        
+00012230: 6966 2064 6961 645f 6865 6967 6874 3c63  if diad_height<c
+00012240: 6f6e 6669 6731 2e74 6872 6573 686f 6c64  onfig1.threshold
+00012250: 5f69 6e74 656e 7369 7479 3a0a 2020 2020  _intensity:.    
+00012260: 2020 2020 2020 2020 7265 6669 745f 7061          refit_pa
+00012270: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
+00012280: 7261 6d29 2b27 2042 656c 6f77 2074 6872  ram)+' Below thr
+00012290: 6573 686f 6c64 2069 6e74 656e 7369 7479  eshold intensity
+000122a0: 270a 0a20 2020 2023 6966 2066 696e 646d  '..    #if findm
+000122b0: 650a 0a0a 2020 2020 2020 2020 6966 2070  e...        if p
+000122c0: 6c6f 745f 6669 6775 7265 2069 7320 5472  lot_figure is Tr
+000122d0: 7565 3a0a 0a20 2020 2020 2020 2020 2020  ue:..           
+000122e0: 2066 6967 2c20 2861 7831 2c20 6178 3229   fig, (ax1, ax2)
+000122f0: 203d 2070 6c74 2e73 7562 706c 6f74 7328   = plt.subplots(
+00012300: 312c 2032 2c20 6669 6773 697a 653d 2831  1, 2, figsize=(1
+00012310: 322c 3429 290a 2020 2020 2020 2020 2020  2,4)).          
+00012320: 2020 6178 312e 706c 6f74 2878 5f6c 696e    ax1.plot(x_lin
+00012330: 2c20 795f 6265 7374 5f66 6974 2c20 272d  , y_best_fit, '-
+00012340: 6727 2c20 6c69 6e65 7769 6474 683d 322c  g', linewidth=2,
+00012350: 206c 6162 656c 3d27 6265 7374 2066 6974   label='best fit
+00012360: 2729 0a20 2020 2020 2020 2020 2020 2061  ').            a
+00012370: 7831 2e70 6c6f 7428 7864 6174 2c20 7964  x1.plot(xdat, yd
+00012380: 6174 2c20 2027 2e6b 272c 206c 6162 656c  at,  '.k', label
+00012390: 3d27 6461 7461 2729 0a20 2020 2020 2020  ='data').       
+000123a0: 2020 2020 2061 7831 2e6c 6567 656e 6428       ax1.legend(
+000123b0: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
+000123c0: 312e 7365 745f 786c 696d 2861 7831 5f78  1.set_xlim(ax1_x
+000123d0: 6c69 6d29 0a20 2020 2020 2020 2020 2020  lim).           
+000123e0: 2061 7832 2e73 6574 5f78 6c69 6d28 6178   ax2.set_xlim(ax
+000123f0: 325f 786c 696d 290a 0a0a 0a0a 0a0a 2020  2_xlim).......  
+00012400: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00012410: 6669 6731 2e66 6974 5f67 6175 7373 2069  fig1.fit_gauss i
+00012420: 7320 6e6f 7420 4661 6c73 653a 0a20 2020  s not False:.   
+00012430: 2020 2020 2020 2020 2020 2020 2061 7832               ax2
+00012440: 2e70 6c6f 7428 785f 6c69 6e2c 2063 6f6d  .plot(x_lin, com
+00012450: 706f 6e65 6e74 732e 6765 7428 2762 6b67  ponents.get('bkg
+00012460: 5f27 292c 2027 2e63 272c 6c69 6e65 7769  _'), '.c',linewi
+00012470: 6474 683d 322c 2020 6c61 6265 6c3d 2747  dth=2,  label='G
+00012480: 6175 7373 6961 6e20 6263 6b27 290a 2020  aussian bck').  
+00012490: 2020 2020 2020 2020 2020 6178 322e 706c            ax2.pl
+000124a0: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
+000124b0: 656e 7473 2e67 6574 2827 6c7a 315f 2729  ents.get('lz1_')
+000124c0: 2c20 272d 6227 2c20 6c69 6e65 7769 6474  , '-b', linewidt
+000124d0: 683d 322c 206c 6162 656c 3d27 5065 616b  h=2, label='Peak
+000124e0: 3127 290a 2020 2020 2020 2020 2020 2020  1').            
+000124f0: 6178 322e 706c 6f74 2878 6461 742c 2079  ax2.plot(xdat, y
+00012500: 6461 742c 2027 2e6b 2729 0a0a 0a20 2020  dat, '.k')...   
+00012510: 2020 2020 2023 6178 322e 706c 6f74 2878       #ax2.plot(x
+00012520: 6461 742c 2072 6573 756c 742e 6265 7374  dat, result.best
+00012530: 5f66 6974 2c20 272d 6727 2c20 6c61 6265  _fit, '-g', labe
+00012540: 6c3d 2762 6573 7420 6669 7427 290a 0a20  l='best fit').. 
+00012550: 2020 2020 2020 2020 2020 2066 6974 7370             fitsp
+00012560: 616e 3d6d 6178 2879 5f62 6573 745f 6669  an=max(y_best_fi
+00012570: 7429 2d6d 696e 2879 5f62 6573 745f 6669  t)-min(y_best_fi
+00012580: 7429 0a20 2020 2020 2020 2020 2020 2061  t).            a
+00012590: 7832 2e73 6574 5f79 6c69 6d28 5b6d 696e  x2.set_ylim([min
+000125a0: 2879 5f62 6573 745f 6669 7429 2d66 6974  (y_best_fit)-fit
+000125b0: 7370 616e 2f35 2c20 6d61 7828 795f 6265  span/5, max(y_be
+000125c0: 7374 5f66 6974 292b 6669 7473 7061 6e2f  st_fit)+fitspan/
+000125d0: 355d 290a 0a0a 2020 2020 2020 2020 2020  5])...          
+000125e0: 2020 6178 312e 7365 745f 796c 6162 656c    ax1.set_ylabel
+000125f0: 2827 496e 7465 6e73 6974 7927 290a 2020  ('Intensity').  
+00012600: 2020 2020 2020 2020 2020 6178 312e 7365            ax1.se
+00012610: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
+00012620: 6d62 6572 2729 0a20 2020 2020 2020 2020  mber').         
+00012630: 2020 2061 7832 2e73 6574 5f79 6c61 6265     ax2.set_ylabe
+00012640: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
+00012650: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
+00012660: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
+00012670: 756d 6265 7227 290a 0a0a 2020 2020 2020  umber')...      
+00012680: 2020 2020 2020 6966 2066 6974 5f70 6561        if fit_pea
+00012690: 6b73 3e31 3a0a 2020 2020 2020 2020 2020  ks>1:.          
+000126a0: 2020 2020 2020 6178 322e 706c 6f74 2878        ax2.plot(x
+000126b0: 5f6c 696e 2c20 636f 6d70 6f6e 656e 7473  _lin, components
+000126c0: 2e67 6574 2827 6c7a 325f 2729 2c20 272d  .get('lz2_'), '-
+000126d0: 7227 2c20 6c69 6e65 7769 6474 683d 322c  r', linewidth=2,
+000126e0: 206c 6162 656c 3d27 5065 616b 3227 290a   label='Peak2').
+000126f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012700: 6669 745f 7065 616b 733e 323a 0a20 2020  fit_peaks>2:.   
+00012710: 2020 2020 2020 2020 2020 2020 2061 7832               ax2
+00012720: 2e70 6c6f 7428 785f 6c69 6e2c 2063 6f6d  .plot(x_lin, com
+00012730: 706f 6e65 6e74 732e 6765 7428 276c 7a33  ponents.get('lz3
+00012740: 5f27 292c 2027 2d6d 272c 206c 696e 6577  _'), '-m', linew
+00012750: 6964 7468 3d32 2c20 6c61 6265 6c3d 2750  idth=2, label='P
+00012760: 6561 6b33 2729 0a0a 0a20 2020 2020 2020  eak3')...       
+00012770: 2020 2020 2061 7832 2e6c 6567 656e 6428       ax2.legend(
+00012780: 290a 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00012790: 6174 6833 3d70 6174 682b 272f 272b 2764  ath3=path+'/'+'d
+000127a0: 6961 645f 6669 745f 696d 6167 6573 270a  iad_fit_images'.
+000127b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000127c0: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
+000127d0: 7468 3329 3a0a 2020 2020 2020 2020 2020  th3):.          
+000127e0: 2020 2020 2020 6f75 743d 2770 6174 6820        out='path 
+000127f0: 6578 6973 7473 270a 2020 2020 2020 2020  exists'.        
+00012800: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012810: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+00012820: 6564 6972 7328 7061 7468 2b27 2f27 2b20  edirs(path+'/'+ 
+00012830: 2764 6961 645f 6669 745f 696d 6167 6573  'diad_fit_images
+00012840: 272c 2065 7869 7374 5f6f 6b3d 4661 6c73  ', exist_ok=Fals
+00012850: 6529 0a0a 0a20 2020 2020 2020 2020 2020  e)...           
+00012860: 2066 696c 653d 6669 6c65 6e61 6d65 2e72   file=filename.r
+00012870: 7370 6c69 7428 272e 7478 7427 2c20 3129  split('.txt', 1)
+00012880: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00012890: 6669 672e 7361 7665 6669 6728 7061 7468  fig.savefig(path
+000128a0: 332b 272f 272b 2744 6961 6432 5f46 6974  3+'/'+'Diad2_Fit
+000128b0: 5f7b 7d2e 706e 6727 2e66 6f72 6d61 7428  _{}.png'.format(
+000128c0: 6669 6c65 292c 2064 7069 3d64 7069 290a  file), dpi=dpi).
+000128d0: 0a0a 0a0a 2020 2020 2020 2020 6265 7374  ....        best
+000128e0: 5f66 6974 3d72 6573 756c 742e 6265 7374  _fit=result.best
+000128f0: 5f66 6974 0a0a 2020 2020 2020 2020 6466  _fit..        df
+00012900: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+00012910: 7427 5d3d 7265 6669 745f 7061 7261 6d0a  t']=refit_param.
+00012920: 0a20 2020 2069 6620 6469 6164 3120 6973  .    if diad1 is
+00012930: 2054 7275 653a 0a0a 0a0a 2020 2020 2020   True:....      
+00012940: 2020 6966 2066 6974 5f70 6561 6b73 3d3d    if fit_peaks==
+00012950: 313a 0a20 2020 2020 2020 2020 2020 2050  1:.            P
+00012960: 6561 6b32 5f43 656e 743d 4e6f 6e65 0a20  eak2_Cent=None. 
+00012970: 2020 2020 2020 2020 2020 2050 6561 6b33             Peak3
+00012980: 5f43 656e 743d 4e6f 6e65 0a20 2020 2020  _Cent=None.     
+00012990: 2020 2020 2020 2061 7831 5f78 6c69 6d3d         ax1_xlim=
+000129a0: 5b43 656e 7465 725f 696e 692d 3135 2c20  [Center_ini-15, 
+000129b0: 4365 6e74 6572 5f69 6e69 2b31 355d 0a20  Center_ini+15]. 
+000129c0: 2020 2020 2020 2020 2020 2061 7832 5f78             ax2_x
+000129d0: 6c69 6d3d 5b43 656e 7465 725f 696e 692d  lim=[Center_ini-
+000129e0: 3135 2c20 4365 6e74 6572 5f69 6e69 2b31  15, Center_ini+1
+000129f0: 355d 0a20 2020 2020 2020 2069 6620 6669  5].        if fi
+00012a00: 745f 7065 616b 733d 3d32 3a0a 2020 2020  t_peaks==2:.    
+00012a10: 2020 2020 2020 2020 5065 616b 325f 4365          Peak2_Ce
+00012a20: 6e74 3d72 6573 756c 742e 6265 7374 5f76  nt=result.best_v
+00012a30: 616c 7565 732e 6765 7428 276c 7a32 5f63  alues.get('lz2_c
+00012a40: 656e 7465 7227 290a 2020 2020 2020 2020  enter').        
+00012a50: 2020 2020 5065 616b 325f 496e 743d 7265      Peak2_Int=re
+00012a60: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
+00012a70: 2e67 6574 2827 6c7a 325f 616d 706c 6974  .get('lz2_amplit
+00012a80: 7564 6527 290a 2020 2020 2020 2020 2020  ude').          
+00012a90: 2020 5065 616b 325f 5369 676d 613d 7265    Peak2_Sigma=re
+00012aa0: 7375 6c74 2e62 6573 745f 7661 6c75 6573  sult.best_values
+00012ab0: 2e67 6574 2827 6c7a 325f 7369 676d 6127  .get('lz2_sigma'
+00012ac0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00012ad0: 2320 4368 6563 6b69 6e67 2070 6172 616d  # Checking param
+00012ae0: 6574 6572 7320 666f 7220 686f 7420 6261  eters for hot ba
+00012af0: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
+00012b00: 2320 6966 2050 6561 6b32 5f53 6967 6d61  # if Peak2_Sigma
+00012b10: 3e28 7369 676d 615f 696e 692a 352d 302e  >(sigma_ini*5-0.
+00012b20: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+00012b30: 2320 2020 2020 7265 6669 745f 7061 7261  #     refit_para
+00012b40: 6d3d 7374 7228 7265 6669 745f 7061 7261  m=str(refit_para
+00012b50: 6d29 2b27 2048 4231 5f48 6967 6853 6967  m)+' HB1_HighSig
+00012b60: 6d61 270a 2020 2020 2020 2020 2020 2020  ma'.            
+00012b70: 2320 6966 2050 6561 6b32 5f53 6967 6d61  # if Peak2_Sigma
+00012b80: 3c3d 2873 6967 6d61 5f69 6e69 2f32 302b  <=(sigma_ini/20+
+00012b90: 302e 3129 3a0a 2020 2020 2020 2020 2020  0.1):.          
+00012ba0: 2020 2320 2020 2020 7265 6669 745f 7061    #     refit_pa
+00012bb0: 7261 6d3d 7374 7228 7265 6669 745f 7061  ram=str(refit_pa
+00012bc0: 7261 6d29 2b27 2048 4231 5f4c 6f77 5369  ram)+' HB1_LowSi
+00012bd0: 676d 6127 0a20 2020 2020 2020 2020 2020  gma'.           
+00012be0: 2023 0a20 2020 2020 2020 2020 2020 2023   #.            #
+00012bf0: 2069 6620 5065 616b 325f 496e 743e 2841   if Peak2_Int>(A
+00012c00: 6d70 6c69 7475 6465 5f69 6e69 2f35 2d30  mplitude_ini/5-0
+00012c10: 2e30 3031 293a 0a20 2020 2020 2020 2020  .001):.         
+00012c20: 2020 2023 2020 2020 2072 6566 6974 5f70     #     refit_p
+00012c30: 6172 616d 3d73 7472 2872 6566 6974 5f70  aram=str(refit_p
+00012c40: 6172 616d 292b 2720 4842 315f 4869 6768  aram)+' HB1_High
+00012c50: 416d 7027 0a20 2020 2020 2020 2020 2020  Amp'.           
+00012c60: 2023 2069 6620 5065 616b 325f 496e 743c   # if Peak2_Int<
+00012c70: 3d28 416d 706c 6974 7564 655f 696e 692f  =(Amplitude_ini/
+00012c80: 3130 302b 302e 3030 3129 3a0a 2020 2020  100+0.001):.    
+00012c90: 2020 2020 2020 2020 2320 2020 2020 7265          #     re
+00012ca0: 6669 745f 7061 7261 6d3d 7374 7228 7265  fit_param=str(re
+00012cb0: 6669 745f 7061 7261 6d29 2b27 2048 4231  fit_param)+' HB1
+00012cc0: 5f4c 6f77 416d 7027 0a0a 0a20 2020 2020  _LowAmp'...     
+00012cd0: 2020 2020 2020 2050 6561 6b33 5f43 656e         Peak3_Cen
+00012ce0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00012cf0: 2020 2061 7831 5f78 6c69 6d3d 5b43 656e     ax1_xlim=[Cen
+00012d00: 7465 725f 696e 692d 3330 2c20 4365 6e74  ter_ini-30, Cent
+00012d10: 6572 5f69 6e69 2b31 355d 0a20 2020 2020  er_ini+15].     
+00012d20: 2020 2020 2020 2061 7832 5f78 6c69 6d3d         ax2_xlim=
+00012d30: 5b43 656e 7465 725f 696e 692d 3330 2c20  [Center_ini-30, 
+00012d40: 4365 6e74 6572 5f69 6e69 2b31 355d 0a0a  Center_ini+15]..
+00012d50: 0a0a 2020 2020 2020 2020 6966 2050 6561  ..        if Pea
+00012d60: 6b32 5f43 656e 7420 6973 204e 6f6e 653a  k2_Cent is None:
+00012d70: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
+00012d80: 6f75 743d 7064 2e44 6174 6146 7261 6d65  out=pd.DataFrame
+00012d90: 2864 6174 613d 7b27 4469 6164 315f 566f  (data={'Diad1_Vo
+00012da0: 6967 745f 4365 6e74 273a 2050 6561 6b31  igt_Cent': Peak1
+00012db0: 5f43 656e 742c 0a20 2020 2020 2020 2020  _Cent,.         
+00012dc0: 2020 2027 4469 6164 315f 6365 6e74 5f65     'Diad1_cent_e
+00012dd0: 7272 273a 2065 7272 6f72 5f70 6b32 2c0a  rr': error_pk2,.
+00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e00: 2020 2020 2744 6961 6431 5f56 6f69 6774      'Diad1_Voigt
+00012e10: 5f41 7265 6127 3a20 5065 616b 315f 496e  _Area': Peak1_In
+00012e20: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e40: 2020 2027 4469 6164 315f 566f 6967 745f     'Diad1_Voigt_
+00012e50: 5369 676d 6127 3a20 5065 616b 315f 5369  Sigma': Peak1_Si
+00012e60: 676d 612c 0a20 2020 2020 2020 2020 2020  gma,.           
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2020 2020 2027 4469 6164 315f 566f 6967       'Diad1_Voig
+00012e90: 745f 4761 6d6d 6127 3a20 5065 616b 315f  t_Gamma': Peak1_
+00012ea0: 6761 6d6d 612c 0a0a 0a20 2020 2020 2020  gamma,...       
+00012eb0: 2020 2020 207d 2c20 696e 6465 783d 5b30       }, index=[0
+00012ec0: 5d29 0a20 2020 2020 2020 2069 6620 5065  ]).        if Pe
+00012ed0: 616b 325f 4365 6e74 2069 7320 6e6f 7420  ak2_Cent is not 
+00012ee0: 4e6f 6e65 3a0a 0a0a 0a0a 0a20 2020 2020  None:......     
+00012ef0: 2020 2020 2020 2064 665f 6f75 743d 7064         df_out=pd
+00012f00: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
+00012f10: 7b27 4469 6164 315f 566f 6967 745f 4365  {'Diad1_Voigt_Ce
+00012f20: 6e74 273a 2050 6561 6b31 5f43 656e 742c  nt': Peak1_Cent,
+00012f30: 0a20 2020 2020 2020 2020 2020 2027 4469  .            'Di
+00012f40: 6164 315f 6365 6e74 5f65 7272 273a 2065  ad1_cent_err': e
+00012f50: 7272 6f72 5f70 6b32 2c0a 2020 2020 2020  rror_pk2,.      
 00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f70: 2027 4469 6164 315f 566f 6967 745f 4761   'Diad1_Voigt_Ga
-00012f80: 6d6d 6127 3a20 5065 616b 315f 6761 6d6d  mma': Peak1_gamm
-00012f90: 612c 0a20 2020 2020 2020 2020 2020 207d  a,.            }
-00012fa0: 2c20 696e 6465 783d 5b30 5d29 0a0a 2020  , index=[0])..  
-00012fb0: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
-00012fc0: 5b27 4842 315f 4365 6e74 275d 3d50 6561  ['HB1_Cent']=Pea
-00012fd0: 6b32 5f43 656e 740a 2020 2020 2020 2020  k2_Cent.        
-00012fe0: 2020 2020 6466 5f6f 7574 5b27 4842 315f      df_out['HB1_
-00012ff0: 4172 6561 275d 3d50 6561 6b32 5f49 6e74  Area']=Peak2_Int
-00013000: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-00013010: 6f75 745b 2748 4231 5f53 6967 6d61 275d  out['HB1_Sigma']
-00013020: 3d50 6561 6b32 5f53 6967 6d61 0a0a 0a20  =Peak2_Sigma... 
-00013030: 2020 2020 2020 2072 6573 756c 745f 6469         result_di
-00013040: 6164 315f 6f72 6967 785f 616c 6c3d 7265  ad1_origx_all=re
-00013050: 7375 6c74 2e65 7661 6c28 783d 7864 6174  sult.eval(x=xdat
-00013060: 290a 2020 2020 2020 2020 2320 5472 696d  ).        # Trim
-00013070: 2074 6f20 6265 2069 6e20 7261 6e67 650a   to be in range.
-00013080: 2020 2020 2020 2020 2370 7269 6e74 2872          #print(r
-00013090: 6573 756c 745f 6469 6164 325f 6f72 6967  esult_diad2_orig
-000130a0: 785f 616c 6c29 0a20 2020 2020 2020 2072  x_all).        r
-000130b0: 6573 756c 745f 6469 6164 315f 6f72 6967  esult_diad1_orig
-000130c0: 783d 7265 7375 6c74 5f64 6961 6431 5f6f  x=result_diad1_o
-000130d0: 7269 6778 5f61 6c6c 5b28 7864 6174 3e73  rigx_all[(xdat>s
-000130e0: 7061 6e5b 305d 2920 2620 2878 6461 743c  pan[0]) & (xdat<
-000130f0: 7370 616e 5b31 5d29 5d0a 2020 2020 2020  span[1])].      
-00013100: 2020 7964 6174 5f69 6e72 616e 6765 3d79    ydat_inrange=y
-00013110: 6461 745b 2878 6461 743e 7370 616e 5b30  dat[(xdat>span[0
-00013120: 5d29 2026 2028 7864 6174 3c73 7061 6e5b  ]) & (xdat<span[
-00013130: 315d 295d 0a20 2020 2020 2020 2078 6461  1])].        xda
-00013140: 745f 696e 7261 6e67 653d 7864 6174 5b28  t_inrange=xdat[(
-00013150: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
-00013160: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
-00013170: 2020 2020 2020 2020 7265 7369 6475 616c          residual
-00013180: 5f64 6961 645f 636f 6f72 6473 3d79 6461  _diad_coords=yda
-00013190: 745f 696e 7261 6e67 652d 7265 7375 6c74  t_inrange-result
-000131a0: 5f64 6961 6431 5f6f 7269 6778 0a0a 0a20  _diad1_origx... 
-000131b0: 2020 2020 2020 2078 5f63 656e 745f 6c69         x_cent_li
-000131c0: 6e3d 6e70 2e6c 696e 7370 6163 6528 6466  n=np.linspace(df
-000131d0: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
-000131e0: 745f 4365 6e74 275d 2d31 2c20 6466 5f6f  t_Cent']-1, df_o
-000131f0: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
-00013200: 4365 6e74 275d 2b31 2c20 3230 3030 3029  Cent']+1, 20000)
-00013210: 0a20 2020 2020 2020 2079 5f63 656e 745f  .        y_cent_
-00013220: 6265 7374 5f66 6974 3d72 6573 756c 742e  best_fit=result.
-00013230: 6576 616c 2878 3d78 5f63 656e 745f 6c69  eval(x=x_cent_li
-00013240: 6e29 0a20 2020 2020 2020 2064 6961 645f  n).        diad_
-00013250: 6865 6967 6874 203d 206e 702e 6d61 7828  height = np.max(
-00013260: 795f 6365 6e74 5f62 6573 745f 6669 7429  y_cent_best_fit)
-00013270: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
-00013280: 2744 6961 6431 5f43 6f6d 626f 6669 745f  'Diad1_Combofit_
-00013290: 4865 6967 6874 275d 3d20 6469 6164 5f68  Height']= diad_h
-000132a0: 6569 6768 740a 2020 2020 2020 2020 6466  eight.        df
-000132b0: 5f6f 7574 2e69 6e73 6572 7428 302c 2027  _out.insert(0, '
-000132c0: 4469 6164 315f 436f 6d62 6f66 6974 5f43  Diad1_Combofit_C
-000132d0: 656e 7427 2c20 6e70 2e6e 616e 6d65 616e  ent', np.nanmean
-000132e0: 2878 5f63 656e 745f 6c69 6e5b 795f 6365  (x_cent_lin[y_ce
-000132f0: 6e74 5f62 6573 745f 6669 743d 3d64 6961  nt_best_fit==dia
-00013300: 645f 6865 6967 6874 5d29 290a 0a0a 2020  d_height]))...  
-00013310: 2020 2020 2020 7265 7369 6475 616c 5f64        residual_d
-00013320: 6961 6431 3d6e 702e 7375 6d28 2828 7964  iad1=np.sum(((yd
-00013330: 6174 5f69 6e72 616e 6765 2d72 6573 756c  at_inrange-resul
-00013340: 745f 6469 6164 315f 6f72 6967 7829 2a2a  t_diad1_origx)**
-00013350: 3229 2a2a 302e 3529 2f28 6c65 6e28 7964  2)**0.5)/(len(yd
-00013360: 6174 5f69 6e72 616e 6765 2929 0a20 2020  at_inrange)).   
-00013370: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-00013380: 6431 5f52 6573 6964 7561 6c27 5d3d 7265  d1_Residual']=re
-00013390: 7369 6475 616c 5f64 6961 6431 0a20 2020  sidual_diad1.   
-000133a0: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
-000133b0: 6431 5f50 726f 705f 4c6f 7227 5d3d 2050  d1_Prop_Lor']= P
-000133c0: 6561 6b31 5f50 726f 705f 4c6f 720a 2020  eak1_Prop_Lor.  
-000133d0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
-000133e0: 6164 315f 6677 686d 275d 3d50 6561 6b31  ad1_fwhm']=Peak1
-000133f0: 5f66 7768 6d0a 0a20 2020 2020 2020 2069  _fwhm..        i
-00013400: 6620 636f 6e66 6967 312e 6669 745f 6761  f config1.fit_ga
-00013410: 7573 7320 6973 206e 6f74 2046 616c 7365  uss is not False
-00013420: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-00013430: 5f6f 7574 5b27 4469 6164 315f 4761 7573  _out['Diad1_Gaus
-00013440: 735f 4365 6e74 275d 3d47 6175 7373 5f63  s_Cent']=Gauss_c
-00013450: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-00013460: 6466 5f6f 7574 5b27 4469 6164 315f 4761  df_out['Diad1_Ga
-00013470: 7573 735f 4172 6561 275d 3d47 6175 7373  uss_Area']=Gauss
-00013480: 5f61 6d70 0a20 2020 2020 2020 2020 2020  _amp.           
-00013490: 2064 665f 6f75 745b 2744 6961 6431 5f47   df_out['Diad1_G
-000134a0: 6175 7373 5f53 6967 6d61 275d 3d47 6175  auss_Sigma']=Gau
-000134b0: 7373 5f73 6967 6d61 0a0a 0a0a 2020 2020  ss_sigma....    
-000134c0: 2020 2020 6966 2070 6c6f 745f 6669 6775      if plot_figu
-000134d0: 7265 2069 7320 5472 7565 3a0a 0a20 2020  re is True:..   
-000134e0: 2020 2020 2020 2020 2066 6967 2c20 2861           fig, (a
-000134f0: 7831 2c20 6178 3229 203d 2070 6c74 2e73  x1, ax2) = plt.s
-00013500: 7562 706c 6f74 7328 312c 2032 2c20 6669  ubplots(1, 2, fi
-00013510: 6773 697a 653d 2831 322c 3429 290a 2020  gsize=(12,4)).  
-00013520: 2020 2020 2020 2020 2020 6178 312e 706c            ax1.pl
-00013530: 6f74 2878 5f6c 696e 2c20 795f 6265 7374  ot(x_lin, y_best
-00013540: 5f66 6974 2c20 272d 6727 2c20 6c69 6e65  _fit, '-g', line
-00013550: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
-00013560: 6265 7374 2066 6974 2729 0a20 2020 2020  best fit').     
-00013570: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
-00013580: 7864 6174 2c20 7964 6174 2c20 2027 2e6b  xdat, ydat,  '.k
-00013590: 272c 206c 6162 656c 3d27 6461 7461 2729  ', label='data')
-000135a0: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
-000135b0: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
-000135c0: 2020 2020 2020 6178 312e 7365 745f 786c        ax1.set_xl
-000135d0: 696d 2861 7831 5f78 6c69 6d29 0a20 2020  im(ax1_xlim).   
-000135e0: 2020 2020 2020 2020 2061 7832 2e73 6574           ax2.set
-000135f0: 5f78 6c69 6d28 6178 325f 786c 696d 290a  _xlim(ax2_xlim).
-00013600: 0a0a 0a0a 0a0a 2020 2020 2020 2020 2020  ......          
-00013610: 2020 6966 2063 6f6e 6669 6731 2e66 6974    if config1.fit
-00013620: 5f67 6175 7373 2069 7320 6e6f 7420 4661  _gauss is not Fa
-00013630: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00013640: 2020 2020 2061 7832 2e70 6c6f 7428 785f       ax2.plot(x_
-00013650: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
-00013660: 6765 7428 2762 6b67 5f27 292c 2027 2e63  get('bkg_'), '.c
-00013670: 272c 6c69 6e65 7769 6474 683d 322c 2020  ',linewidth=2,  
-00013680: 6c61 6265 6c3d 2747 6175 7373 6961 6e20  label='Gaussian 
-00013690: 6263 6b27 290a 2020 2020 2020 2020 2020  bck').          
-000136a0: 2020 6178 322e 706c 6f74 2878 5f6c 696e    ax2.plot(x_lin
-000136b0: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
-000136c0: 2827 6c7a 315f 2729 2c20 272d 6227 2c20  ('lz1_'), '-b', 
-000136d0: 6c69 6e65 7769 6474 683d 322c 206c 6162  linewidth=2, lab
-000136e0: 656c 3d27 5065 616b 3127 290a 2020 2020  el='Peak1').    
-000136f0: 2020 2020 2020 2020 6178 322e 706c 6f74          ax2.plot
-00013700: 2878 6461 742c 2079 6461 742c 2027 2e6b  (xdat, ydat, '.k
-00013710: 2729 0a0a 0a20 2020 2020 2020 2023 6178  ')...        #ax
-00013720: 322e 706c 6f74 2878 6461 742c 2072 6573  2.plot(xdat, res
-00013730: 756c 742e 6265 7374 5f66 6974 2c20 272d  ult.best_fit, '-
-00013740: 6727 2c20 6c61 6265 6c3d 2762 6573 7420  g', label='best 
-00013750: 6669 7427 290a 0a20 2020 2020 2020 2020  fit')..         
-00013760: 2020 2066 6974 7370 616e 3d6d 6178 2879     fitspan=max(y
-00013770: 5f62 6573 745f 6669 7429 2d6d 696e 2879  _best_fit)-min(y
-00013780: 5f62 6573 745f 6669 7429 0a20 2020 2020  _best_fit).     
-00013790: 2020 2020 2020 2061 7832 2e73 6574 5f79         ax2.set_y
-000137a0: 6c69 6d28 5b6d 696e 2879 5f62 6573 745f  lim([min(y_best_
-000137b0: 6669 7429 2d66 6974 7370 616e 2f35 2c20  fit)-fitspan/5, 
-000137c0: 6d61 7828 795f 6265 7374 5f66 6974 292b  max(y_best_fit)+
-000137d0: 6669 7473 7061 6e2f 355d 290a 0a0a 2020  fitspan/5])...  
-000137e0: 2020 2020 2020 2020 2020 6178 312e 7365            ax1.se
-000137f0: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
-00013800: 6974 7927 290a 2020 2020 2020 2020 2020  ity').          
-00013810: 2020 6178 312e 7365 745f 786c 6162 656c    ax1.set_xlabel
-00013820: 2827 5761 7665 6e75 6d62 6572 2729 0a20  ('Wavenumber'). 
-00013830: 2020 2020 2020 2020 2020 2061 7832 2e73             ax2.s
-00013840: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-00013850: 7369 7479 2729 0a20 2020 2020 2020 2020  sity').         
-00013860: 2020 2061 7832 2e73 6574 5f78 6c61 6265     ax2.set_xlabe
-00013870: 6c28 2757 6176 656e 756d 6265 7227 290a  l('Wavenumber').
-00013880: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00013890: 2066 6974 5f70 6561 6b73 3e31 3a0a 2020   fit_peaks>1:.  
-000138a0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-000138b0: 322e 706c 6f74 2878 5f6c 696e 2c20 636f  2.plot(x_lin, co
-000138c0: 6d70 6f6e 656e 7473 2e67 6574 2827 6c7a  mponents.get('lz
-000138d0: 325f 2729 2c20 272d 7227 2c20 6c69 6e65  2_'), '-r', line
-000138e0: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
-000138f0: 5065 616b 3227 290a 0a20 2020 2020 2020  Peak2')..       
-00013900: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
-00013910: 733e 323a 0a20 2020 2020 2020 2020 2020  s>2:.           
-00013920: 2020 2020 2061 7832 2e70 6c6f 7428 785f       ax2.plot(x_
-00013930: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732e  lin, components.
-00013940: 6765 7428 276c 7a33 5f27 292c 2027 2d6d  get('lz3_'), '-m
-00013950: 272c 206c 696e 6577 6964 7468 3d32 2c20  ', linewidth=2, 
-00013960: 6c61 6265 6c3d 2750 6561 6b33 2729 0a20  label='Peak3'). 
-00013970: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00013980: 6c65 6e28 7065 616b 5f70 6f73 5f76 6f69  len(peak_pos_voi
-00013990: 6774 293e 313a 0a20 2020 2020 2020 2020  gt)>1:.         
-000139a0: 2020 2023 2020 2020 206c 6f77 6572 7065     #     lowerpe
-000139b0: 616b 3d6e 702e 6d69 6e28 5b50 6561 6b31  ak=np.min([Peak1
-000139c0: 5f43 656e 742c 2050 6561 6b32 5f43 656e  _Cent, Peak2_Cen
-000139d0: 745d 290a 2020 2020 2020 2020 2020 2020  t]).            
-000139e0: 2320 2020 2020 7570 7065 7270 6561 6b3d  #     upperpeak=
-000139f0: 6e70 2e6d 6178 285b 5065 616b 315f 4365  np.max([Peak1_Ce
-00013a00: 6e74 2c20 5065 616b 325f 4365 6e74 5d29  nt, Peak2_Cent])
-00013a10: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-00013a20: 2020 2061 7831 2e73 6574 5f78 6c69 6d28     ax1.set_xlim(
-00013a30: 5b6c 6f77 6572 7065 616b 2d31 352c 2075  [lowerpeak-15, u
-00013a40: 7070 6572 7065 616b 2b31 355d 290a 2020  pperpeak+15]).  
-00013a50: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
-00013a60: 656e 2870 6561 6b5f 706f 735f 766f 6967  en(peak_pos_voig
-00013a70: 7429 3e31 3a0a 2020 2020 2020 2020 2020  t)>1:.          
-00013a80: 2020 2320 2020 2020 6178 322e 7365 745f    #     ax2.set_
-00013a90: 786c 696d 285b 6c6f 7765 7270 6561 6b2d  xlim([lowerpeak-
-00013aa0: 3230 2c20 7570 7065 7270 6561 6b2b 3230  20, upperpeak+20
-00013ab0: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
-00013ac0: 6178 322e 6c65 6765 6e64 2829 0a0a 2020  ax2.legend()..  
-00013ad0: 2020 2020 2020 2020 2020 7061 7468 333d            path3=
-00013ae0: 7061 7468 2b27 2f27 2b27 6469 6164 5f66  path+'/'+'diad_f
-00013af0: 6974 5f69 6d61 6765 7327 0a20 2020 2020  it_images'.     
-00013b00: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00013b10: 682e 6578 6973 7473 2870 6174 6833 293a  h.exists(path3):
-00013b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b30: 206f 7574 3d27 7061 7468 2065 7869 7374   out='path exist
-00013b40: 7327 0a20 2020 2020 2020 2020 2020 2065  s'.            e
-00013b50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00013b60: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
-00013b70: 2870 6174 682b 272f 272b 2027 6469 6164  (path+'/'+ 'diad
-00013b80: 5f66 6974 5f69 6d61 6765 7327 2c20 6578  _fit_images', ex
-00013b90: 6973 745f 6f6b 3d46 616c 7365 290a 0a0a  ist_ok=False)...
-00013ba0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00013bb0: 3d66 696c 656e 616d 652e 7273 706c 6974  =filename.rsplit
-00013bc0: 2827 2e74 7874 272c 2031 295b 305d 0a20  ('.txt', 1)[0]. 
-00013bd0: 2020 2020 2020 2020 2020 2066 6967 2e73             fig.s
-00013be0: 6176 6566 6967 2870 6174 6833 2b27 2f27  avefig(path3+'/'
-00013bf0: 2b27 4469 6164 315f 4669 745f 7b7d 2e70  +'Diad1_Fit_{}.p
-00013c00: 6e67 272e 666f 726d 6174 2866 696c 6529  ng'.format(file)
-00013c10: 2c20 6470 693d 6470 6929 0a0a 0a0a 0a20  , dpi=dpi)..... 
-00013c20: 2020 2020 2020 2062 6573 745f 6669 743d         best_fit=
-00013c30: 7265 7375 6c74 2e62 6573 745f 6669 740a  result.best_fit.
-00013c40: 0a20 2020 2020 2020 2064 665f 6f75 745b  .        df_out[
-00013c50: 2744 6961 6431 5f72 6566 6974 275d 3d72  'Diad1_refit']=r
-00013c60: 6566 6974 5f70 6172 616d 0a0a 2020 2020  efit_param..    
-00013c70: 2020 2020 2320 4669 6e61 6c20 6368 6563      # Final chec
-00013c80: 6b20 2d20 7468 6174 2047 6175 7373 6961  k - that Gaussia
-00013c90: 6e20 6973 6e74 2061 6e79 7768 6572 6520  n isnt anywhere 
-00013ca0: 6e65 6172 2074 6865 2068 6569 6768 7420  near the height 
-00013cb0: 6f66 2074 6865 2064 6961 640a 0a0a 2020  of the diad...  
-00013cc0: 2020 6466 5f6f 7574 3d64 665f 6f75 742e    df_out=df_out.
-00013cd0: 6669 6c6c 6e61 2830 290a 0a20 2020 2072  fillna(0)..    r
-00013ce0: 6574 7572 6e20 7265 7375 6c74 2c20 6466  eturn result, df
-00013cf0: 5f6f 7574 2c20 795f 6265 7374 5f66 6974  _out, y_best_fit
-00013d00: 2c20 785f 6c69 6e2c 2063 6f6d 706f 6e65  , x_lin, compone
-00013d10: 6e74 732c 2078 6461 742c 2079 6461 742c  nts, xdat, ydat,
-00013d20: 2061 7831 5f78 6c69 6d2c 2061 7832 5f78   ax1_xlim, ax2_x
-00013d30: 6c69 6d2c 2072 6573 6964 7561 6c5f 6469  lim, residual_di
-00013d40: 6164 5f63 6f6f 7264 732c 2079 6461 745f  ad_coords, ydat_
-00013d50: 696e 7261 6e67 652c 2020 7864 6174 5f69  inrange,  xdat_i
-00013d60: 6e72 616e 6765 0a0a 0a0a 6465 6620 6669  nrange....def fi
-00013d70: 745f 6469 6164 5f32 5f77 5f62 636b 282a  t_diad_2_w_bck(*
-00013d80: 2c20 636f 6e66 6967 313a 2064 6961 6432  , config1: diad2
-00013d90: 5f66 6974 5f63 6f6e 6669 673d 6469 6164  _fit_config=diad
-00013da0: 325f 6669 745f 636f 6e66 6967 2829 2c20  2_fit_config(), 
-00013db0: 636f 6e66 6967 323a 2064 6961 645f 6964  config2: diad_id
-00013dc0: 5f63 6f6e 6669 673d 6469 6164 5f69 645f  _config=diad_id_
-00013dd0: 636f 6e66 6967 2829 2c0a 2020 2020 7061  config(),.    pa
-00013de0: 7468 3d4e 6f6e 652c 2066 696c 656e 616d  th=None, filenam
-00013df0: 653d 4e6f 6e65 2c20 7065 616b 5f70 6f73  e=None, peak_pos
-00013e00: 5f76 6f69 6774 3d4e 6f6e 652c 6669 6c65  _voigt=None,file
-00013e10: 7479 7065 3d4e 6f6e 652c 0a20 2020 2070  type=None,.    p
-00013e20: 6c6f 745f 6669 6775 7265 3d54 7275 652c  lot_figure=True,
-00013e30: 2063 6c6f 7365 5f66 6967 7572 653d 4661   close_figure=Fa
-00013e40: 6c73 652c 2044 6961 645f 706f 733d 4e6f  lse, Diad_pos=No
-00013e50: 6e65 2c20 4842 5f70 6f73 3d4e 6f6e 652c  ne, HB_pos=None,
-00013e60: 2043 3133 5f70 6f73 3d4e 6f6e 6529 3a0a   C13_pos=None):.
-00013e70: 2020 2020 2222 2220 5468 6973 2066 756e      """ This fun
-00013e80: 6374 696f 6e20 6669 7473 2074 6865 2062  ction fits the b
-00013e90: 6163 6b67 726f 756e 6420 2875 7369 6e67  ackground (using
-00013ea0: 2074 6865 2066 756e 6374 696f 6e20 7265   the function re
-00013eb0: 6d6f 7665 5f64 6961 645f 6261 7365 6c69  move_diad_baseli
-00013ec0: 6e65 2920 616e 6420 7468 656e 2066 6974  ne) and then fit
-00013ed0: 7320 7468 6520 7065 616b 7320 7573 696e  s the peaks usin
-00013ee0: 6720 6669 745f 6761 7573 7369 616e 5f76  g fit_gaussian_v
-00013ef0: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
-00013f00: 6428 290a 2020 2020 4974 2074 6865 6e20  d().    It then 
-00013f10: 6368 6563 6b73 2069 6620 616e 7920 7061  checks if any pa
-00013f20: 7261 6d65 7465 7273 2061 7265 2072 6967  rameters are rig
-00013f30: 6874 2061 7420 7468 6520 7065 726d 6974  ht at the permit
-00013f40: 7465 6420 6564 6765 2028 6d65 616e 696e  ted edge (meanin
-00013f50: 6720 6669 7474 696e 6720 6469 646e 7420  g fitting didnt 
-00013f60: 636f 6e76 6572 6765 292c 2061 6e64 2074  converge), and t
-00013f70: 7269 6573 2066 6974 7469 6e67 2069 6620  ries fitting if 
-00013f80: 736f 2e20 5468 656e 2069 7420 6d61 6b65  so. Then it make
-00013f90: 7320 6120 706c 6f74 0a20 2020 206f 6620  s a plot.    of 
-00013fa0: 7468 6520 7661 7269 6f75 7320 7061 7274  the various part
-00013fb0: 7320 6f66 2074 6865 2066 6974 7469 6e67  s of the fitting
-00013fc0: 2070 726f 6365 6475 7265 2c20 616e 6420   procedure, and 
-00013fd0: 7265 7475 726e 7320 6120 6461 7461 6672  returns a datafr
-00013fe0: 616d 6520 6f66 2074 6865 2066 6974 2070  ame of the fit p
-00013ff0: 6172 616d 6574 6572 732e 0a0a 0a20 2020  arameters....   
-00014000: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00014010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00014020: 636f 6e66 6967 313a 2062 7920 6465 6661  config1: by defa
-00014030: 756c 7420 7573 6573 2064 6961 6432 5f66  ult uses diad2_f
-00014040: 6974 5f63 6f6e 6669 6728 292e 204f 7074  it_config(). Opt
-00014050: 696f 6e73 2074 6f20 6564 6974 2077 6974  ions to edit wit
-00014060: 6869 6e20 7468 6973 3a0a 0a20 2020 2020  hin this:..     
-00014070: 2020 204e 5f70 6f6c 795f 6263 6b5f 6469     N_poly_bck_di
-00014080: 6164 323a 2069 6e74 0a20 2020 2020 2020  ad2: int.       
-00014090: 2020 2020 2064 6567 7265 6520 6f66 2070       degree of p
-000140a0: 6f6c 796e 6f6d 6961 6c20 746f 2066 6974  olynomial to fit
-000140b0: 2074 6f20 7468 6520 6261 636b 6772 6f75   to the backgrou
-000140c0: 6e64 2e0a 0a20 2020 2020 2020 206d 6f64  nd...        mod
-000140d0: 656c 5f6e 616d 653a 2073 7472 0a20 2020  el_name: str.   
-000140e0: 2020 2020 2020 2020 2057 6861 7420 7479           What ty
-000140f0: 7065 206f 6620 7065 616b 2079 6f75 2077  pe of peak you w
-00014100: 616e 7420 746f 2066 6974 2c20 6569 7468  ant to fit, eith
-00014110: 6572 2027 5073 6575 646f 566f 6967 744d  er 'PseudoVoigtM
-00014120: 6f64 656c 2720 6f72 2027 566f 6967 744d  odel' or 'VoigtM
-00014130: 6f64 656c 270a 0a20 2020 2020 2020 2066  odel'..        f
-00014140: 6974 5f70 6561 6b73 3a20 696e 740a 2020  it_peaks: int.  
-00014150: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-00014160: 206f 6620 7065 616b 7320 746f 2066 6974   of peaks to fit
-00014170: 2e20 3120 3d20 6a75 7374 2064 6961 642c  . 1 = just diad,
-00014180: 2032 3d20 6469 6164 2061 6e64 2048 6f74   2= diad and Hot
-00014190: 6261 6e64 2c20 333d 2064 6961 642c 2068  band, 3= diad, h
-000141a0: 6f74 6261 6e64 2c20 4331 330a 0a20 2020  otband, C13..   
-000141b0: 2020 2020 206c 6f77 6572 5f62 636b 5f64       lower_bck_d
-000141c0: 6961 6432 2c20 7570 7065 725f 6263 6b5f  iad2, upper_bck_
-000141d0: 6469 6164 323a 205b 666c 6f61 742c 2066  diad2: [float, f
-000141e0: 6c6f 6174 5d0a 2020 2020 2020 2020 2020  loat].          
-000141f0: 2020 6261 636b 6772 6f75 6e64 2070 6f73    background pos
-00014200: 6974 696f 6e20 746f 206c 6566 7420 616e  ition to left an
-00014210: 6420 7269 6768 7420 6f66 206f 7665 7261  d right of overa
-00014220: 6c20 6469 6164 2072 6567 696f 6e20 2869  l diad region (i
-00014230: 6e63 2064 6961 642b 2d48 422b 2d43 3133  nc diad+-HB+-C13
-00014240: 290a 0a20 2020 2020 2020 2066 6974 5f67  )..        fit_g
-00014250: 6175 7373 3a20 626f 6f6c 0a20 2020 2020  auss: bool.     
-00014260: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
-00014270: 6669 7473 2061 2067 6175 7373 6961 6e20  fits a gaussian 
-00014280: 7065 616b 0a0a 2020 2020 2020 2020 6761  peak..        ga
-00014290: 7573 735f 616d 703a 2020 666c 6f61 740a  uss_amp:  float.
-000142a0: 2020 2020 2020 2020 2020 2020 4573 7469              Esti
-000142b0: 6d61 7465 206f 6620 616d 706c 6974 7564  mate of amplitud
-000142c0: 6520 6f66 2047 6175 7373 6961 6e20 7065  e of Gaussian pe
-000142d0: 616b 2028 7765 2066 696e 6420 6120 676f  ak (we find a go
-000142e0: 6f64 2066 6972 7374 2067 7565 7373 2069  od first guess i
-000142f0: 7320 322a 2074 6865 2061 6273 6f6c 7574  s 2* the absolut
-00014300: 6520 7072 6f6d 696e 656e 6365 206f 6620  e prominence of 
-00014310: 7468 6520 4842 2070 6561 6b29 0a0a 2020  the HB peak)..  
-00014320: 2020 2020 2020 6469 6164 5f73 6967 6d61        diad_sigma
-00014330: 2c20 4842 5f73 6967 6d61 3a20 666c 6f61  , HB_sigma: floa
-00014340: 740a 2020 2020 2020 2020 2020 2020 4573  t.            Es
-00014350: 7469 6d61 7465 206f 6620 7468 6520 616d  timate of the am
-00014360: 706c 6974 7564 6520 6f66 2074 6865 2064  plitude of the d
-00014370: 6961 6420 7065 616b 2f48 4220 7065 616b  iad peak/HB peak
-00014380: 0a0a 2020 2020 2020 2020 6469 6164 5f70  ..        diad_p
-00014390: 726f 6d2c 2048 425f 7072 6f6d 2c20 4331  rom, HB_prom, C1
-000143a0: 335f 7072 6f6d 3a20 666c 6f61 740a 2020  3_prom: float.  
-000143b0: 2020 2020 2020 2020 2020 4573 7469 6d61            Estima
-000143c0: 7465 206f 6620 7072 6f6d 696e 656e 6365  te of prominence
-000143d0: 206f 6620 7065 616b 2e20 5573 6564 2061   of peak. Used a
-000143e0: 6c6f 6e67 7369 6465 2073 6967 6d61 2074  longside sigma t
-000143f0: 6f20 6573 7469 6d61 7465 2074 6865 2061  o estimate the a
-00014400: 6d70 6c69 7475 6465 206f 6620 7468 6520  mplitude of the 
-00014410: 6469 6164 2074 6f20 6169 6420 7065 616b  diad to aid peak
-00014420: 2066 6974 7469 6e67 2e0a 0a0a 2020 2020   fitting....    
-00014430: 2020 2020 6469 6164 5f73 6967 6d61 5f6d      diad_sigma_m
-00014440: 696e 5f61 6c6c 6f77 616e 6365 2c20 6469  in_allowance, di
-00014450: 6164 5f73 6967 6d61 5f6d 696e 5f61 6c6c  ad_sigma_min_all
-00014460: 6f77 616e 6365 3a20 666c 6f61 740a 2020  owance: float.  
-00014470: 2020 2020 2020 4842 5f73 6967 6d61 5f6d        HB_sigma_m
-00014480: 696e 5f61 6c6c 6f77 616e 6365 2c20 4842  in_allowance, HB
-00014490: 5f73 6967 6d61 5f6d 6178 5f61 6c6c 6f77  _sigma_max_allow
-000144a0: 616e 6365 3a20 666c 6f61 740a 2020 2020  ance: float.    
-000144b0: 2020 2020 2020 2020 4661 6374 6f72 2074          Factor t
-000144c0: 6861 7420 7369 676d 6120 6f66 2070 6561  hat sigma of pea
-000144d0: 6b20 6973 2061 6c6c 6f77 6564 2074 6f20  k is allowed to 
-000144e0: 6465 7669 6174 6520 6672 6f6d 2031 7374  deviate from 1st
-000144f0: 2067 7565 7373 2028 652e 672e 206d 6178   guess (e.g. max
-00014500: 3d32 2c20 322a 2067 7565 7373 2c20 6d69  =2, 2* guess, mi
-00014510: 6e3d 302e 352c 2030 2e35 202a 2067 7565  n=0.5, 0.5 * gue
-00014520: 7373 292e 0a0a 2020 2020 2020 2020 6469  ss)...        di
-00014530: 6164 5f61 6d70 5f6d 696e 5f61 6c6c 6f77  ad_amp_min_allow
-00014540: 616e 6365 2c20 6469 6164 5f61 6d70 5f6d  ance, diad_amp_m
-00014550: 696e 5f61 6c6c 6f77 616e 6365 3a20 666c  in_allowance: fl
-00014560: 6f61 740a 2020 2020 2020 2020 4842 5f61  oat.        HB_a
-00014570: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
-00014580: 2c20 4842 5f61 6d70 5f6d 6178 5f61 6c6c  , HB_amp_max_all
-00014590: 6f77 616e 6365 3a20 666c 6f61 740a 2020  owance: float.  
-000145a0: 2020 2020 2020 2020 2020 4661 6374 6f72            Factor
-000145b0: 2074 6861 7420 7468 6520 616d 706c 6974   that the amplit
-000145c0: 7564 6520 6f66 2070 6561 6b20 6973 2061  ude of peak is a
-000145d0: 6c6c 6f77 6564 2074 6f20 6465 7669 6174  llowed to deviat
-000145e0: 6520 6672 6f6d 2031 7374 2067 7565 7373  e from 1st guess
-000145f0: 2028 652e 672e 206d 6178 3d32 2c20 322a   (e.g. max=2, 2*
-00014600: 2067 7565 7373 2c20 6d69 6e3d 302e 352c   guess, min=0.5,
-00014610: 2030 2e35 202a 2067 7565 7373 292e 0a0a   0.5 * guess)...
-00014620: 2020 2020 2020 2020 2a20 4e6f 7465 2c20          * Note, 
-00014630: 666f 7220 4331 332c 2077 6520 6669 6e64  for C13, we find
-00014640: 2074 6865 2063 6f64 6520 776f 726b 7320   the code works 
-00014650: 6265 7474 6572 2c20 6966 2073 6967 6d61  better, if sigma
-00014660: 2069 7320 7365 7420 6173 2031 7374 2066   is set as 1st f
-00014670: 6974 206f 6620 6469 6164 2073 6967 6d61  it of diad sigma
-00014680: 2f35 2c20 616c 6c6f 7765 6420 746f 2076  /5, allowed to v
-00014690: 6172 790a 2020 2020 2020 2020 6265 7477  ary.        betw
-000146a0: 6565 6e20 6469 6164 5f73 6967 6d61 2f32  een diad_sigma/2
-000146b0: 3020 746f 2064 6961 645f 7369 676d 612f  0 to diad_sigma/
-000146c0: 322e 2054 6865 206d 696e 2061 6e64 206d  2. The min and m
-000146d0: 6178 2061 6d70 6c69 7475 6465 2061 7265  ax amplitude are
-000146e0: 2067 6f74 2030 2e35 2061 6e64 2032 2a20   got 0.5 and 2* 
-000146f0: 7468 6520 616c 6c6f 7761 6e63 6520 656e  the allowance en
-00014700: 7465 7265 6420 666f 7220 4842 320a 0a20  tered for HB2.. 
-00014710: 2020 2020 2020 2078 5f72 616e 6765 5f62         x_range_b
-00014720: 6173 656c 696e 653a 2066 6c6f 6174 206f  aseline: float o
-00014730: 7220 4e6f 6e65 0a20 2020 2020 2020 2020  r None.         
-00014740: 2020 2053 6574 7320 7820 6c69 6d69 7420     Sets x limit 
-00014750: 6f66 2070 6c6f 7420 7368 6f77 696e 6720  of plot showing 
-00014760: 6261 7365 6c69 6e65 7320 746f 2064 6961  baselines to dia
-00014770: 6420 6365 6e74 6572 202d 2078 5f72 616e  d center - x_ran
-00014780: 6765 5f62 6173 656c 696e 652c 2061 6e64  ge_baseline, and
-00014790: 202b 785f 7261 6e67 655f 6261 7365 6c69   +x_range_baseli
-000147a0: 6e65 0a0a 2020 2020 2020 2020 795f 7261  ne..        y_ra
-000147b0: 6e67 655f 6261 7365 6c69 6e65 3a20 666c  nge_baseline: fl
-000147c0: 6f61 7420 6f72 204e 6f6e 650a 2020 2020  oat or None.    
-000147d0: 2020 2020 2020 2020 5365 7473 2079 2061          Sets y a
-000147e0: 7869 7320 6f66 2062 6173 656c 696e 6520  xis of baseline 
-000147f0: 706c 6f74 2061 7320 6d69 6e69 6d75 6d20  plot as minimum 
-00014800: 6261 6c75 6520 6f66 2062 6173 656c 696e  balue of baselin
-00014810: 6520 7265 6769 6f6e 202d 795f 7261 6e67  e region -y_rang
-00014820: 655f 6261 7365 6c69 6e65 2f33 2c0a 2020  e_baseline/3,.  
-00014830: 2020 2020 2020 2020 2020 616e 6420 7468            and th
-00014840: 6520 7570 7065 7220 7661 6c75 6520 6173  e upper value as
-00014850: 206d 6178 2076 616c 7565 206f 6620 6261   max value of ba
-00014860: 7365 6c69 6e65 2072 6567 696f 6e20 2b20  seline region + 
-00014870: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
-00014880: 0a20 2020 2020 2020 2020 2020 2042 6173  .            Bas
-00014890: 656c 696e 6520 7265 6769 6f6e 2069 7320  eline region is 
-000148a0: 7468 6520 6465 6669 6e65 6420 7265 6769  the defined regi
-000148b0: 6f6e 206f 6620 6261 7365 6c69 6e65 206d  on of baseline m
-000148c0: 696e 7573 2061 6e79 2070 6f69 6e74 7320  inus any points 
-000148d0: 6f75 7473 6964 6520 7468 6520 7369 676d  outside the sigm
-000148e0: 6120 6669 6c74 6572 0a0a 2020 2020 2020  a filter..      
-000148f0: 2020 785f 7261 6e67 655f 7265 7369 6475    x_range_residu
-00014900: 616c 3a20 666c 6f61 740a 2020 2020 2020  al: float.      
-00014910: 2020 2020 2020 4469 7374 616e 6365 2065        Distance e
-00014920: 6974 6865 7220 7369 6465 206f 6620 6469  ither side of di
-00014930: 6164 2063 656e 7465 7220 746f 2073 686f  ad center to sho
-00014940: 7720 6f6e 2072 6573 6964 7561 6c20 706c  w on residual pl
-00014950: 6f74 2e0a 0a20 2020 2020 2020 2064 7069  ot...        dpi
-00014960: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-00014970: 2020 2020 6470 6920 746f 2073 6176 6520      dpi to save 
-00014980: 6669 6775 7265 2061 7420 6f66 206f 7665  figure at of ove
-00014990: 7261 6c6c 2066 6974 730a 0a20 2020 2063  rall fits..    c
-000149a0: 6f6e 6669 6732 3a20 6469 6164 5f69 645f  onfig2: diad_id_
-000149b0: 636f 6e66 6967 2829 2066 696c 652e 204f  config() file. O
-000149c0: 6e6c 7920 7468 696e 6720 6974 2075 7365  nly thing it use
-000149d0: 7320 6672 6f6d 2074 6869 7320 6973 2061  s from this is a
-000149e0: 6e79 2065 7863 6c75 6465 6420 7261 6e67  ny excluded rang
-000149f0: 6573 0a0a 2020 2020 7061 7468 3a20 7374  es..    path: st
-00014a00: 720a 2020 2020 2020 2020 466f 6c64 6572  r.        Folder
-00014a10: 2075 7365 7220 7769 7368 6573 2074 6f20   user wishes to 
-00014a20: 7265 6164 2064 6174 6120 6672 6f6d 0a0a  read data from..
-00014a30: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
-00014a40: 720a 2020 2020 2020 2020 5370 6563 6966  r.        Specif
-00014a50: 6963 206e 616d 6520 6f66 2066 696c 6520  ic name of file 
-00014a60: 6265 696e 6720 7573 6564 2e0a 0a20 2020  being used...   
-00014a70: 2066 696c 6574 7970 653a 2073 7472 0a20   filetype: str. 
-00014a80: 2020 2020 2020 2049 6465 6e74 6966 6965         Identifie
-00014a90: 7320 7479 7065 206f 6620 6669 6c65 2e20  s type of file. 
-00014aa0: 6368 6f6f 7365 2066 726f 6d20 2757 6974  choose from 'Wit
-00014ab0: 6563 5f41 5343 4949 272c 2027 6865 6164  ec_ASCII', 'head
-00014ac0: 6c65 7373 5f74 7874 272c 2027 6865 6164  less_txt', 'head
-00014ad0: 6c65 7373 5f63 7376 272c 2027 6865 6164  less_csv', 'head
-00014ae0: 5f63 7376 272c 2027 5769 7465 635f 4153  _csv', 'Witec_AS
-00014af0: 4349 4927 2c0a 2020 2020 2020 2020 2748  CII',.        'H
-00014b00: 4f52 4942 415f 7478 7427 2c20 2752 656e  ORIBA_txt', 'Ren
-00014b10: 6973 6861 775f 7478 7427 0a0a 2020 2020  ishaw_txt'..    
-00014b20: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-00014b30: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-00014b40: 652c 2073 6176 6573 2066 6967 7572 650a  e, saves figure.
-00014b50: 0a20 2020 2044 6961 645f 706f 733a 2066  .    Diad_pos: f
-00014b60: 6c6f 6174 0a20 2020 2020 2020 2045 7374  loat.        Est
-00014b70: 696d 6174 6520 6f66 2064 6961 6420 706f  imate of diad po
-00014b80: 7369 7469 6f6e 0a0a 2020 2020 4842 5f70  sition..    HB_p
-00014b90: 6f73 3a20 666c 6f61 740a 2020 2020 2020  os: float.      
-00014ba0: 2020 4573 7469 6d61 7465 206f 6620 4842    Estimate of HB
-00014bb0: 2070 6f73 6974 696f 6e0a 0a20 2020 2043   position..    C
-00014bc0: 3133 5f70 6f73 3a20 666c 6f61 740a 2020  13_pos: float.  
-00014bd0: 2020 2020 2020 4573 7469 6d61 7465 206f        Estimate o
-00014be0: 6620 4331 3320 706f 7369 7469 6f6e 0a0a  f C13 position..
-00014bf0: 2020 2020 636c 6f73 655f 6669 673a 2062      close_fig: b
-00014c00: 6f6f 6c0a 2020 2020 2020 2020 6966 2054  ool.        if T
-00014c10: 7275 652c 2064 6973 706c 6179 7320 6669  rue, displays fi
-00014c20: 6775 7265 2069 6e20 4e6f 7465 626f 6f6b  gure in Notebook
-00014c30: 2e20 4966 2046 616c 7365 2c20 636c 6f73  . If False, clos
-00014c40: 6573 2069 7420 2879 6f75 2063 616e 2073  es it (you can s
-00014c50: 7469 6c6c 2066 696e 6420 6974 2073 6176  till find it sav
-00014c60: 6564 290a 0a20 2020 2072 6574 7572 6e5f  ed)..    return_
-00014c70: 6f74 6865 725f 7061 7261 6d73 3a20 626f  other_params: bo
-00014c80: 6f6c 2028 6465 6661 756c 7420 4661 6c73  ol (default Fals
-00014c90: 6529 0a20 2020 2020 2020 2069 6620 4661  e).        if Fa
-00014ca0: 6c73 652c 206a 7573 7420 7265 7475 726e  lse, just return
-00014cb0: 7320 6120 6461 7461 6672 616d 6520 6f66  s a dataframe of
-00014cc0: 2070 6561 6b20 7061 7261 6d65 7465 7273   peak parameters
-00014cd0: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
-00014ce0: 2c20 616c 736f 2072 6574 7572 6e73 3a0a  , also returns:.
-00014cf0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00014d00: 6c74 3a20 6669 7420 7061 7261 6d65 7465  lt: fit paramete
-00014d10: 7273 0a20 2020 2020 2020 2020 2020 2079  rs.            y
-00014d20: 5f62 6573 745f 6669 743a 2062 6573 7420  _best_fit: best 
-00014d30: 6669 7420 746f 2061 6c6c 2063 7572 7665  fit to all curve
-00014d40: 7320 696e 2079 0a20 2020 2020 2020 2020  s in y.         
-00014d50: 2020 2078 5f6c 696e 3a20 6c69 6e73 7061     x_lin: linspa
-00014d60: 6365 206f 6620 6265 7374 2066 6974 2063  ce of best fit c
-00014d70: 6f6f 7264 696e 6174 6573 2069 6e20 782e  oordinates in x.
-00014d80: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00014d90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20    ------------. 
-00014da0: 2020 2073 6565 2061 626f 7665 2e20 4465     see above. De
-00014db0: 7065 6e64 7320 696e 2072 6574 7572 6e73  pends in returns
-00014dc0: 5f6f 7468 6572 5f70 6172 616d 730a 0a0a  _other_params...
-00014dd0: 0a0a 2020 2020 2222 220a 0a20 2020 2023  ..    """..    #
-00014de0: 2043 6865 636b 206e 756d 6265 7220 6f66   Check number of
-00014df0: 2070 6561 6b73 206d 616b 6573 2073 656e   peaks makes sen
-00014e00: 7365 0a20 2020 2066 6974 5f70 6561 6b73  se.    fit_peaks
-00014e10: 3d63 6f6e 6669 6731 2e66 6974 5f70 6561  =config1.fit_pea
-00014e20: 6b73 0a20 2020 2044 6961 645f 6466 3d67  ks.    Diad_df=g
-00014e30: 6574 5f64 6174 6128 7061 7468 3d70 6174  et_data(path=pat
-00014e40: 682c 2066 696c 656e 616d 653d 6669 6c65  h, filename=file
-00014e50: 6e61 6d65 2c20 6669 6c65 7479 7065 3d66  name, filetype=f
-00014e60: 696c 6574 7970 6529 0a20 2020 2044 6961  iletype).    Dia
-00014e70: 643d 6e70 2e61 7272 6179 2844 6961 645f  d=np.array(Diad_
-00014e80: 6466 290a 0a0a 2020 2020 6966 2066 6974  df)...    if fit
-00014e90: 5f70 6561 6b73 3d3d 323a 0a20 2020 2020  _peaks==2:.     
-00014ea0: 2020 2069 6620 6e70 2e69 736e 616e 2848     if np.isnan(H
-00014eb0: 425f 706f 7329 3d3d 5472 7565 206f 7220  B_pos)==True or 
-00014ec0: 636f 6e66 6967 312e 4842 5f70 726f 6d3c  config1.HB_prom<
-00014ed0: 303a 0a20 2020 2020 2020 2020 2020 2066  0:.            f
-00014ee0: 6974 5f70 6561 6b73 3d31 0a20 2020 2020  it_peaks=1.     
-00014ef0: 2020 2020 2020 2066 6974 5f67 6175 7373         fit_gauss
-00014f00: 3d46 616c 7365 0a0a 0a0a 2020 2020 6966  =False....    if
-00014f10: 2066 6974 5f70 6561 6b73 3d3d 333a 0a20   fit_peaks==3:. 
-00014f20: 2020 2020 2020 2023 2054 6869 7320 7465         # This te
-00014f30: 7374 7320 6966 2048 4220 6973 204e 616e  sts if HB is Nan
-00014f40: 2061 6e64 2043 3133 2069 7320 4e61 6e0a   and C13 is Nan.
-00014f50: 2020 2020 2020 2020 6966 206e 702e 6973          if np.is
-00014f60: 6e61 6e28 4842 5f70 6f73 293d 3d54 7275  nan(HB_pos)==Tru
-00014f70: 6520 616e 6420 6e70 2e69 736e 616e 2843  e and np.isnan(C
-00014f80: 3133 5f70 6f73 293d 3d54 7275 653a 0a20  13_pos)==True:. 
-00014f90: 2020 2020 2020 2020 2020 2066 6974 5f70             fit_p
-00014fa0: 6561 6b73 3d31 0a20 2020 2020 2020 2020  eaks=1.         
-00014fb0: 2020 2066 6974 5f67 6175 7373 3d46 616c     fit_gauss=Fal
-00014fc0: 7365 0a20 2020 2020 2020 2023 2049 6620  se.        # If 
-00014fd0: 6f6e 6c79 2048 4220 6973 204e 616e 2c20  only HB is Nan, 
-00014fe0: 6c65 7473 2069 6e73 7465 6164 2061 6c6c  lets instead all
-00014ff0: 6f63 6174 6520 6120 4842 2070 6f73 6974  ocate a HB posit
-00015000: 6f69 6e2e 0a20 2020 2020 2020 2065 6c69  oin..        eli
-00015010: 6620 6e70 2e69 736e 616e 2848 425f 706f  f np.isnan(HB_po
-00015020: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00015030: 4842 5f72 6567 696f 6e3d 5b44 6961 645f  HB_region=[Diad_
-00015040: 706f 732b 3139 2c20 4469 6164 5f70 6f73  pos+19, Diad_pos
-00015050: 2b32 335d 0a20 2020 2020 2020 2020 2020  +23].           
-00015060: 2066 696c 7465 723d 2844 6961 645b 3a2c   filter=(Diad[:,
-00015070: 2030 5d3e 3d48 425f 7265 6769 6f6e 5b30   0]>=HB_region[0
-00015080: 5d29 2620 2844 6961 645b 3a2c 305d 3c3d  ])& (Diad[:,0]<=
-00015090: 4842 5f72 6567 696f 6e5b 315d 290a 2020  HB_region[1]).  
-000150a0: 2020 2020 2020 2020 2020 5472 696d 4469            TrimDi
-000150b0: 6164 3d44 6961 645b 6669 6c74 6572 5d0a  ad=Diad[filter].
-000150c0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-000150d0: 6572 323d 2844 6961 645b 3a2c 2030 5d3e  er2=(Diad[:, 0]>
-000150e0: 3d28 4842 5f72 6567 696f 6e5b 305d 2d35  =(HB_region[0]-5
-000150f0: 2929 2620 2844 6961 645b 3a2c 305d 3c3d  ))& (Diad[:,0]<=
-00015100: 2848 425f 7265 6769 6f6e 5b31 5d2b 3529  (HB_region[1]+5)
-00015110: 290a 2020 2020 2020 2020 2020 2020 5472  ).            Tr
-00015120: 696d 4469 6164 323d 4469 6164 5b66 696c  imDiad2=Diad[fil
-00015130: 7465 7232 5d0a 2020 2020 2020 2020 2020  ter2].          
-00015140: 2020 6d61 7879 3d6e 702e 6d61 7828 5472    maxy=np.max(Tr
-00015150: 696d 4469 6164 5b3a 2c20 315d 290a 2020  imDiad[:, 1]).  
-00015160: 2020 2020 2020 2020 2020 6d61 7878 3d54            maxx=T
-00015170: 7269 6d44 6961 645b 5472 696d 4469 6164  rimDiad[TrimDiad
-00015180: 5b3a 2c20 315d 3d3d 6d61 7879 5d0a 2020  [:, 1]==maxy].  
-00015190: 2020 2020 2020 2020 2020 4842 5f70 6f73            HB_pos
-000151a0: 3d66 6c6f 6174 286d 6178 785b 3a2c 2030  =float(maxx[:, 0
-000151b0: 5d5b 305d 290a 2020 2020 2020 2020 2020  ][0]).          
-000151c0: 2020 6d69 6e79 3d6e 702e 6d69 6e28 5472    miny=np.min(Tr
-000151d0: 696d 4469 6164 325b 3a2c 2031 5d29 0a20  imDiad2[:, 1]). 
-000151e0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000151f0: 6731 2e48 425f 7072 6f6d 3d6d 6178 792d  g1.HB_prom=maxy-
-00015200: 6d69 6e79 0a20 2020 2020 2020 2020 2020  miny.           
-00015210: 2063 6f6e 6669 6731 2e67 6175 7373 5f61   config1.gauss_a
-00015220: 6d70 3d32 2a28 6d61 7879 2d6d 696e 7929  mp=2*(maxy-miny)
-00015230: 0a0a 0a0a 0a20 2020 2020 2020 2023 2049  .....        # I
-00015240: 6620 6e6f 2043 3133 2c20 7265 6475 6365  f no C13, reduce
-00015250: 2066 6974 2070 6561 6b73 2074 6f20 322e   fit peaks to 2.
-00015260: 0a20 2020 2020 2020 2065 6c69 6620 6e70  .        elif np
-00015270: 2e69 736e 616e 2843 3133 5f70 6f73 293d  .isnan(C13_pos)=
-00015280: 3d54 7275 6520 6f72 2063 6f6e 6669 6731  =True or config1
-00015290: 2e43 3133 5f70 726f 6d3c 3130 3a0a 2020  .C13_prom<10:.  
-000152a0: 2020 2020 2020 2020 2020 6669 745f 7065            fit_pe
-000152b0: 616b 733d 320a 0a0a 0a20 2020 2023 2046  aks=2....    # F
-000152c0: 6972 7374 2c20 7765 2066 6565 6420 6461  irst, we feed da
-000152d0: 7461 2069 6e74 6f20 7468 6520 7265 6d6f  ta into the remo
-000152e0: 7665 2062 6173 656c 696e 6520 6675 6e63  ve baseline func
-000152f0: 7469 6f6e 2c20 7768 6963 6820 7265 7475  tion, which retu
-00015300: 726e 7320 636f 7272 6563 7465 6420 6461  rns corrected da
-00015310: 7461 0a0a 2020 2020 795f 636f 7272 5f64  ta..    y_corr_d
-00015320: 6961 6432 2c20 5079 5f62 6173 655f 6469  iad2, Py_base_di
-00015330: 6164 322c 2078 5f64 6961 6432 2c20 2044  ad2, x_diad2,  D
-00015340: 6961 645f 7368 6f72 745f 6469 6164 322c  iad_short_diad2,
-00015350: 2050 795f 6261 7365 5f64 6961 6432 2c20   Py_base_diad2, 
-00015360: 5066 5f62 6173 656c 696e 655f 6469 6164  Pf_baseline_diad
-00015370: 322c 2020 4261 7365 6c69 6e65 5f79 7375  2,  Baseline_ysu
-00015380: 625f 6469 6164 322c 2042 6173 656c 696e  b_diad2, Baselin
-00015390: 655f 785f 6469 6164 322c 2042 6173 656c  e_x_diad2, Basel
-000153a0: 696e 655f 6469 6164 322c 2073 7061 6e5f  ine_diad2, span_
-000153b0: 6469 6164 323d 7265 6d6f 7665 5f64 6961  diad2=remove_dia
-000153c0: 645f 6261 7365 6c69 6e65 280a 2020 2070  d_baseline(.   p
-000153d0: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
-000153e0: 6d65 3d66 696c 656e 616d 652c 2066 696c  me=filename, fil
-000153f0: 6574 7970 653d 6669 6c65 7479 7065 2c20  etype=filetype, 
-00015400: 6578 636c 7564 655f 7261 6e67 6531 3d63  exclude_range1=c
-00015410: 6f6e 6669 6732 2e65 7863 6c75 6465 5f72  onfig2.exclude_r
-00015420: 616e 6765 312c 2065 7863 6c75 6465 5f72  ange1, exclude_r
-00015430: 616e 6765 323d 636f 6e66 6967 322e 6578  ange2=config2.ex
-00015440: 636c 7564 655f 7261 6e67 6532 2c20 4e5f  clude_range2, N_
-00015450: 706f 6c79 3d63 6f6e 6669 6731 2e4e 5f70  poly=config1.N_p
-00015460: 6f6c 795f 6263 6b5f 6469 6164 322c 0a20  oly_bck_diad2,. 
-00015470: 2020 206c 6f77 6572 5f62 636b 3d63 6f6e     lower_bck=con
-00015480: 6669 6731 2e6c 6f77 6572 5f62 636b 5f64  fig1.lower_bck_d
-00015490: 6961 6432 2c20 7570 7065 725f 6263 6b3d  iad2, upper_bck=
-000154a0: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
-000154b0: 6b5f 6469 6164 322c 2070 6c6f 745f 6669  k_diad2, plot_fi
-000154c0: 6775 7265 3d46 616c 7365 290a 0a0a 0a0a  gure=False).....
-000154d0: 0a20 2020 2023 2054 6865 6e2c 2077 6520  .    # Then, we 
-000154e0: 6665 6564 2074 6869 7320 6261 7365 6c69  feed this baseli
-000154f0: 6e65 2d63 6f72 7265 6374 6564 2064 6174  ne-corrected dat
-00015500: 6120 696e 746f 2074 6865 2063 6f6d 6269  a into the combi
-00015510: 6e65 6420 6761 7573 7369 616e 2d76 6f69  ned gaussian-voi
-00015520: 6774 2070 6561 6b20 6669 7474 696e 6720  gt peak fitting 
-00015530: 6675 6e63 7469 6f6e 0a20 2020 2072 6573  function.    res
-00015540: 756c 742c 2064 665f 6f75 742c 2079 5f62  ult, df_out, y_b
-00015550: 6573 745f 6669 742c 2078 5f6c 696e 2c20  est_fit, x_lin, 
-00015560: 636f 6d70 6f6e 656e 7473 2c20 7864 6174  components, xdat
-00015570: 2c20 7964 6174 2c20 6178 315f 786c 696d  , ydat, ax1_xlim
-00015580: 2c20 6178 325f 786c 696d 2c72 6573 6964  , ax2_xlim,resid
-00015590: 7561 6c5f 6469 6164 5f63 6f6f 7264 732c  ual_diad_coords,
-000155a0: 2079 6461 745f 696e 7261 6e67 652c 2020   ydat_inrange,  
-000155b0: 7864 6174 5f69 6e72 616e 6765 3d66 6974  xdat_inrange=fit
-000155c0: 5f67 6175 7373 6961 6e5f 766f 6967 745f  _gaussian_voigt_
-000155d0: 6765 6e65 7269 635f 6469 6164 2863 6f6e  generic_diad(con
-000155e0: 6669 6731 2c20 6469 6164 323d 5472 7565  fig1, diad2=True
-000155f0: 2c20 7061 7468 3d70 6174 682c 2066 696c  , path=path, fil
-00015600: 656e 616d 653d 6669 6c65 6e61 6d65 2c0a  ename=filename,.
-00015610: 2020 2020 7864 6174 3d78 5f64 6961 6432      xdat=x_diad2
-00015620: 2c20 7964 6174 3d79 5f63 6f72 725f 6469  , ydat=y_corr_di
-00015630: 6164 322c 0a20 2020 2073 7061 6e3d 7370  ad2,.    span=sp
-00015640: 616e 5f64 6961 6432 2c20 706c 6f74 5f66  an_diad2, plot_f
-00015650: 6967 7572 653d 4661 6c73 652c 2044 6961  igure=False, Dia
-00015660: 645f 706f 733d 4469 6164 5f70 6f73 2c20  d_pos=Diad_pos, 
-00015670: 4842 5f70 6f73 3d48 425f 706f 732c 2043  HB_pos=HB_pos, C
-00015680: 3133 5f70 6f73 3d43 3133 5f70 6f73 2c20  13_pos=C13_pos, 
-00015690: 6669 745f 7065 616b 733d 6669 745f 7065  fit_peaks=fit_pe
-000156a0: 616b 7329 0a0a 2020 2020 6966 2061 6e79  aks)..    if any
-000156b0: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-000156c0: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-000156d0: 696e 7328 2742 656c 6f77 2074 6872 6573  ins('Below thres
-000156e0: 686f 6c64 2069 6e74 656e 7369 7479 2729  hold intensity')
-000156f0: 293a 0a20 2020 2020 2020 2070 7269 6e74  ):.        print
-00015700: 2827 6265 6c6f 7720 796f 7572 2074 6872  ('below your thr
-00015710: 6573 686f 6c64 2069 6e74 656e 7369 7479  eshold intensity
-00015720: 2c20 7765 2068 6176 6520 6669 6c6c 6564  , we have filled
-00015730: 2077 6974 6820 6e61 6e73 2729 0a0a 0a20   with nans')... 
-00015740: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
-00015750: 2020 2320 5472 7920 5265 6669 7474 696e    # Try Refittin
-00015760: 6720 6f6e 6365 0a20 2020 2020 2020 2069  g once.        i
-00015770: 6620 7374 7228 6466 5f6f 7574 5b27 4469  f str(df_out['Di
-00015780: 6164 325f 7265 6669 7427 5d2e 696c 6f63  ad2_refit'].iloc
-00015790: 5b30 5d29 213d 2746 6c61 6767 6564 2057  [0])!='Flagged W
-000157a0: 6172 6e69 6e67 733a 273a 0a20 2020 2020  arnings:':.     
-000157b0: 2020 2020 2020 2070 7269 6e74 2827 7265         print('re
-000157c0: 6669 7420 6174 7465 6d70 7420 3127 290a  fit attempt 1').
-000157d0: 2020 2020 2020 2020 2020 2020 6661 6374              fact
-000157e0: 6f72 3d32 0a0a 2020 2020 2020 2020 2020  or=2..          
-000157f0: 2020 696d 706f 7274 2063 6f70 790a 2020    import copy.  
-00015800: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00015810: 5f74 7765 616b 6564 3d63 6f6e 6669 6731  _tweaked=config1
-00015820: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00015830: 6669 675f 7477 6561 6b65 643d 636f 7079  fig_tweaked=copy
-00015840: 2e63 6f70 7928 636f 6e66 6967 3129 0a0a  .copy(config1)..
-00015850: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00015860: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00015870: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00015880: 7461 696e 7328 2720 4e6f 2045 7272 6f72  tains(' No Error
-00015890: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
-000158a0: 2020 2020 2069 6620 6669 745f 7065 616b       if fit_peak
-000158b0: 733e 313a 0a20 2020 2020 2020 2020 2020  s>1:.           
-000158c0: 2020 2020 2020 2020 2066 6974 5f70 6561           fit_pea
-000158d0: 6b73 3d66 6974 5f70 6561 6b73 2d31 0a0a  ks=fit_peaks-1..
-000158e0: 0a0a 0a20 2020 2020 2020 2020 2020 2023  ...            #
-000158f0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
-00015900: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
-00015910: 722e 636f 6e74 6169 6e73 2827 565f 4869  r.contains('V_Hi
-00015920: 6768 416d 7027 2929 3a0a 2020 2020 2020  ghAmp')):.      
-00015930: 2020 2020 2020 2320 2020 2020 636f 6e66        #     conf
-00015940: 6967 5f74 7765 616b 6564 2e64 6961 645f  ig_tweaked.diad_
-00015950: 616d 706c 6974 7564 653d 6361 6c63 5f64  amplitude=calc_d
-00015960: 6961 645f 616d 706c 6974 7564 652f 3130  iad_amplitude/10
-00015970: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015980: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
-00015990: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
-000159a0: 6e74 6169 6e73 2827 565f 5369 676d 615f  ntains('V_Sigma_
-000159b0: 746f 6f5f 4c6f 7727 2929 3a0a 2020 2020  too_Low')):.    
-000159c0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-000159d0: 6967 5f74 7765 616b 6564 2e64 6961 645f  ig_tweaked.diad_
-000159e0: 7369 676d 613d 636f 6e66 6967 312e 6469  sigma=config1.di
-000159f0: 6164 5f73 6967 6d61 2a66 6163 746f 720a  ad_sigma*factor.
-00015a00: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00015a10: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00015a20: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00015a30: 7461 696e 7328 2756 5f53 6967 6d61 5f74  tains('V_Sigma_t
-00015a40: 6f6f 5f48 6967 6827 2929 3a0a 2020 2020  oo_High')):.    
-00015a50: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00015a60: 6967 5f74 7765 616b 6564 2e64 6961 645f  ig_tweaked.diad_
-00015a70: 7369 676d 613d 636f 6e66 6967 312e 6469  sigma=config1.di
-00015a80: 6164 5f73 6967 6d61 2f66 6163 746f 720a  ad_sigma/factor.
-00015a90: 2020 2020 2020 2020 2020 2020 2320 4761              # Ga
-00015aa0: 7573 7369 616e 2066 6974 2062 6974 730a  ussian fit bits.
-00015ab0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00015ac0: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00015ad0: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00015ae0: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
-00015af0: 6f6f 4869 6768 5369 676d 6127 2929 3a0a  ooHighSigma')):.
-00015b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b10: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-00015b20: 6175 7373 5f73 6967 6d61 3d63 6f6e 6669  auss_sigma=confi
-00015b30: 6731 2e67 6175 7373 5f73 6967 6d61 2f66  g1.gauss_sigma/f
-00015b40: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00012f70: 2020 2020 2020 2020 2020 2020 2020 2744                'D
+00012f80: 6961 6431 5f56 6f69 6774 5f41 7265 6127  iad1_Voigt_Area'
+00012f90: 3a20 5065 616b 315f 496e 742c 0a20 2020  : Peak1_Int,.   
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fc0: 2027 4469 6164 315f 566f 6967 745f 5369   'Diad1_Voigt_Si
+00012fd0: 676d 6127 3a20 5065 616b 315f 5369 676d  gma': Peak1_Sigm
+00012fe0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013000: 2020 2020 2020 2027 4469 6164 315f 566f         'Diad1_Vo
+00013010: 6967 745f 4761 6d6d 6127 3a20 5065 616b  igt_Gamma': Peak
+00013020: 315f 6761 6d6d 612c 0a20 2020 2020 2020  1_gamma,.       
+00013030: 2020 2020 207d 2c20 696e 6465 783d 5b30       }, index=[0
+00013040: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+00013050: 6466 5f6f 7574 5b27 4842 315f 4365 6e74  df_out['HB1_Cent
+00013060: 275d 3d50 6561 6b32 5f43 656e 740a 2020  ']=Peak2_Cent.  
+00013070: 2020 2020 2020 2020 2020 6466 5f6f 7574            df_out
+00013080: 5b27 4842 315f 4172 6561 275d 3d50 6561  ['HB1_Area']=Pea
+00013090: 6b32 5f49 6e74 0a20 2020 2020 2020 2020  k2_Int.         
+000130a0: 2020 2064 665f 6f75 745b 2748 4231 5f53     df_out['HB1_S
+000130b0: 6967 6d61 275d 3d50 6561 6b32 5f53 6967  igma']=Peak2_Sig
+000130c0: 6d61 0a0a 0a20 2020 2020 2020 2072 6573  ma...        res
+000130d0: 756c 745f 6469 6164 315f 6f72 6967 785f  ult_diad1_origx_
+000130e0: 616c 6c3d 7265 7375 6c74 2e65 7661 6c28  all=result.eval(
+000130f0: 783d 7864 6174 290a 2020 2020 2020 2020  x=xdat).        
+00013100: 2320 5472 696d 2074 6f20 6265 2069 6e20  # Trim to be in 
+00013110: 7261 6e67 650a 2020 2020 2020 2020 2370  range.        #p
+00013120: 7269 6e74 2872 6573 756c 745f 6469 6164  rint(result_diad
+00013130: 325f 6f72 6967 785f 616c 6c29 0a20 2020  2_origx_all).   
+00013140: 2020 2020 2072 6573 756c 745f 6469 6164       result_diad
+00013150: 315f 6f72 6967 783d 7265 7375 6c74 5f64  1_origx=result_d
+00013160: 6961 6431 5f6f 7269 6778 5f61 6c6c 5b28  iad1_origx_all[(
+00013170: 7864 6174 3e73 7061 6e5b 305d 2920 2620  xdat>span[0]) & 
+00013180: 2878 6461 743c 7370 616e 5b31 5d29 5d0a  (xdat<span[1])].
+00013190: 2020 2020 2020 2020 7964 6174 5f69 6e72          ydat_inr
+000131a0: 616e 6765 3d79 6461 745b 2878 6461 743e  ange=ydat[(xdat>
+000131b0: 7370 616e 5b30 5d29 2026 2028 7864 6174  span[0]) & (xdat
+000131c0: 3c73 7061 6e5b 315d 295d 0a20 2020 2020  <span[1])].     
+000131d0: 2020 2078 6461 745f 696e 7261 6e67 653d     xdat_inrange=
+000131e0: 7864 6174 5b28 7864 6174 3e73 7061 6e5b  xdat[(xdat>span[
+000131f0: 305d 2920 2620 2878 6461 743c 7370 616e  0]) & (xdat<span
+00013200: 5b31 5d29 5d0a 2020 2020 2020 2020 7265  [1])].        re
+00013210: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
+00013220: 6473 3d79 6461 745f 696e 7261 6e67 652d  ds=ydat_inrange-
+00013230: 7265 7375 6c74 5f64 6961 6431 5f6f 7269  result_diad1_ori
+00013240: 6778 0a0a 0a20 2020 2020 2020 2078 5f63  gx...        x_c
+00013250: 656e 745f 6c69 6e3d 6e70 2e6c 696e 7370  ent_lin=np.linsp
+00013260: 6163 6528 6466 5f6f 7574 5b27 4469 6164  ace(df_out['Diad
+00013270: 315f 566f 6967 745f 4365 6e74 275d 2d31  1_Voigt_Cent']-1
+00013280: 2c20 6466 5f6f 7574 5b27 4469 6164 315f  , df_out['Diad1_
+00013290: 566f 6967 745f 4365 6e74 275d 2b31 2c20  Voigt_Cent']+1, 
+000132a0: 3230 3030 3029 0a20 2020 2020 2020 2079  20000).        y
+000132b0: 5f63 656e 745f 6265 7374 5f66 6974 3d72  _cent_best_fit=r
+000132c0: 6573 756c 742e 6576 616c 2878 3d78 5f63  esult.eval(x=x_c
+000132d0: 656e 745f 6c69 6e29 0a20 2020 2020 2020  ent_lin).       
+000132e0: 2064 6961 645f 6865 6967 6874 203d 206e   diad_height = n
+000132f0: 702e 6d61 7828 795f 6365 6e74 5f62 6573  p.max(y_cent_bes
+00013300: 745f 6669 7429 0a20 2020 2020 2020 2064  t_fit).        d
+00013310: 665f 6f75 745b 2744 6961 6431 5f43 6f6d  f_out['Diad1_Com
+00013320: 626f 6669 745f 4865 6967 6874 275d 3d20  bofit_Height']= 
+00013330: 6469 6164 5f68 6569 6768 740a 2020 2020  diad_height.    
+00013340: 2020 2020 6466 5f6f 7574 2e69 6e73 6572      df_out.inser
+00013350: 7428 302c 2027 4469 6164 315f 436f 6d62  t(0, 'Diad1_Comb
+00013360: 6f66 6974 5f43 656e 7427 2c20 6e70 2e6e  ofit_Cent', np.n
+00013370: 616e 6d65 616e 2878 5f63 656e 745f 6c69  anmean(x_cent_li
+00013380: 6e5b 795f 6365 6e74 5f62 6573 745f 6669  n[y_cent_best_fi
+00013390: 743d 3d64 6961 645f 6865 6967 6874 5d29  t==diad_height])
+000133a0: 290a 0a0a 2020 2020 2020 2020 7265 7369  )...        resi
+000133b0: 6475 616c 5f64 6961 6431 3d6e 702e 7375  dual_diad1=np.su
+000133c0: 6d28 2828 7964 6174 5f69 6e72 616e 6765  m(((ydat_inrange
+000133d0: 2d72 6573 756c 745f 6469 6164 315f 6f72  -result_diad1_or
+000133e0: 6967 7829 2a2a 3229 2a2a 302e 3529 2f28  igx)**2)**0.5)/(
+000133f0: 6c65 6e28 7964 6174 5f69 6e72 616e 6765  len(ydat_inrange
+00013400: 2929 0a20 2020 2020 2020 2064 665f 6f75  )).        df_ou
+00013410: 745b 2744 6961 6431 5f52 6573 6964 7561  t['Diad1_Residua
+00013420: 6c27 5d3d 7265 7369 6475 616c 5f64 6961  l']=residual_dia
+00013430: 6431 0a20 2020 2020 2020 2064 665f 6f75  d1.        df_ou
+00013440: 745b 2744 6961 6431 5f50 726f 705f 4c6f  t['Diad1_Prop_Lo
+00013450: 7227 5d3d 2050 6561 6b31 5f50 726f 705f  r']= Peak1_Prop_
+00013460: 4c6f 720a 2020 2020 2020 2020 6466 5f6f  Lor.        df_o
+00013470: 7574 5b27 4469 6164 315f 6677 686d 275d  ut['Diad1_fwhm']
+00013480: 3d50 6561 6b31 5f66 7768 6d0a 0a20 2020  =Peak1_fwhm..   
+00013490: 2020 2020 2069 6620 636f 6e66 6967 312e       if config1.
+000134a0: 6669 745f 6761 7573 7320 6973 206e 6f74  fit_gauss is not
+000134b0: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
+000134c0: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
+000134d0: 315f 4761 7573 735f 4365 6e74 275d 3d47  1_Gauss_Cent']=G
+000134e0: 6175 7373 5f63 656e 740a 2020 2020 2020  auss_cent.      
+000134f0: 2020 2020 2020 6466 5f6f 7574 5b27 4469        df_out['Di
+00013500: 6164 315f 4761 7573 735f 4172 6561 275d  ad1_Gauss_Area']
+00013510: 3d47 6175 7373 5f61 6d70 0a20 2020 2020  =Gauss_amp.     
+00013520: 2020 2020 2020 2064 665f 6f75 745b 2744         df_out['D
+00013530: 6961 6431 5f47 6175 7373 5f53 6967 6d61  iad1_Gauss_Sigma
+00013540: 275d 3d47 6175 7373 5f73 6967 6d61 0a0a  ']=Gauss_sigma..
+00013550: 0a0a 2020 2020 2020 2020 6966 2070 6c6f  ..        if plo
+00013560: 745f 6669 6775 7265 2069 7320 5472 7565  t_figure is True
+00013570: 3a0a 0a20 2020 2020 2020 2020 2020 2066  :..            f
+00013580: 6967 2c20 2861 7831 2c20 6178 3229 203d  ig, (ax1, ax2) =
+00013590: 2070 6c74 2e73 7562 706c 6f74 7328 312c   plt.subplots(1,
+000135a0: 2032 2c20 6669 6773 697a 653d 2831 322c   2, figsize=(12,
+000135b0: 3429 290a 2020 2020 2020 2020 2020 2020  4)).            
+000135c0: 6178 312e 706c 6f74 2878 5f6c 696e 2c20  ax1.plot(x_lin, 
+000135d0: 795f 6265 7374 5f66 6974 2c20 272d 6727  y_best_fit, '-g'
+000135e0: 2c20 6c69 6e65 7769 6474 683d 322c 206c  , linewidth=2, l
+000135f0: 6162 656c 3d27 6265 7374 2066 6974 2729  abel='best fit')
+00013600: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+00013610: 2e70 6c6f 7428 7864 6174 2c20 7964 6174  .plot(xdat, ydat
+00013620: 2c20 2027 2e6b 272c 206c 6162 656c 3d27  ,  '.k', label='
+00013630: 6461 7461 2729 0a20 2020 2020 2020 2020  data').         
+00013640: 2020 2061 7831 2e6c 6567 656e 6428 290a     ax1.legend().
+00013650: 2020 2020 2020 2020 2020 2020 6178 312e              ax1.
+00013660: 7365 745f 786c 696d 2861 7831 5f78 6c69  set_xlim(ax1_xli
+00013670: 6d29 0a20 2020 2020 2020 2020 2020 2061  m).            a
+00013680: 7832 2e73 6574 5f78 6c69 6d28 6178 325f  x2.set_xlim(ax2_
+00013690: 786c 696d 290a 0a0a 0a0a 0a0a 2020 2020  xlim).......    
+000136a0: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
+000136b0: 6731 2e66 6974 5f67 6175 7373 2069 7320  g1.fit_gauss is 
+000136c0: 6e6f 7420 4661 6c73 653a 0a20 2020 2020  not False:.     
+000136d0: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
+000136e0: 6c6f 7428 785f 6c69 6e2c 2063 6f6d 706f  lot(x_lin, compo
+000136f0: 6e65 6e74 732e 6765 7428 2762 6b67 5f27  nents.get('bkg_'
+00013700: 292c 2027 2e63 272c 6c69 6e65 7769 6474  ), '.c',linewidt
+00013710: 683d 322c 2020 6c61 6265 6c3d 2747 6175  h=2,  label='Gau
+00013720: 7373 6961 6e20 6263 6b27 290a 2020 2020  ssian bck').    
+00013730: 2020 2020 2020 2020 6178 322e 706c 6f74          ax2.plot
+00013740: 2878 5f6c 696e 2c20 636f 6d70 6f6e 656e  (x_lin, componen
+00013750: 7473 2e67 6574 2827 6c7a 315f 2729 2c20  ts.get('lz1_'), 
+00013760: 272d 6227 2c20 6c69 6e65 7769 6474 683d  '-b', linewidth=
+00013770: 322c 206c 6162 656c 3d27 5065 616b 3127  2, label='Peak1'
+00013780: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
+00013790: 322e 706c 6f74 2878 6461 742c 2079 6461  2.plot(xdat, yda
+000137a0: 742c 2027 2e6b 2729 0a0a 0a20 2020 2020  t, '.k')...     
+000137b0: 2020 2023 6178 322e 706c 6f74 2878 6461     #ax2.plot(xda
+000137c0: 742c 2072 6573 756c 742e 6265 7374 5f66  t, result.best_f
+000137d0: 6974 2c20 272d 6727 2c20 6c61 6265 6c3d  it, '-g', label=
+000137e0: 2762 6573 7420 6669 7427 290a 0a20 2020  'best fit')..   
+000137f0: 2020 2020 2020 2020 2066 6974 7370 616e           fitspan
+00013800: 3d6d 6178 2879 5f62 6573 745f 6669 7429  =max(y_best_fit)
+00013810: 2d6d 696e 2879 5f62 6573 745f 6669 7429  -min(y_best_fit)
+00013820: 0a20 2020 2020 2020 2020 2020 2061 7832  .            ax2
+00013830: 2e73 6574 5f79 6c69 6d28 5b6d 696e 2879  .set_ylim([min(y
+00013840: 5f62 6573 745f 6669 7429 2d66 6974 7370  _best_fit)-fitsp
+00013850: 616e 2f35 2c20 6d61 7828 795f 6265 7374  an/5, max(y_best
+00013860: 5f66 6974 292b 6669 7473 7061 6e2f 355d  _fit)+fitspan/5]
+00013870: 290a 0a0a 2020 2020 2020 2020 2020 2020  )...            
+00013880: 6178 312e 7365 745f 796c 6162 656c 2827  ax1.set_ylabel('
+00013890: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+000138a0: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+000138b0: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+000138c0: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
+000138d0: 2061 7832 2e73 6574 5f79 6c61 6265 6c28   ax2.set_ylabel(
+000138e0: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
+000138f0: 2020 2020 2020 2020 2061 7832 2e73 6574           ax2.set
+00013900: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
+00013910: 6265 7227 290a 0a0a 2020 2020 2020 2020  ber')...        
+00013920: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
+00013930: 3e31 3a0a 2020 2020 2020 2020 2020 2020  >1:.            
+00013940: 2020 2020 6178 322e 706c 6f74 2878 5f6c      ax2.plot(x_l
+00013950: 696e 2c20 636f 6d70 6f6e 656e 7473 2e67  in, components.g
+00013960: 6574 2827 6c7a 325f 2729 2c20 272d 7227  et('lz2_'), '-r'
+00013970: 2c20 6c69 6e65 7769 6474 683d 322c 206c  , linewidth=2, l
+00013980: 6162 656c 3d27 5065 616b 3227 290a 0a20  abel='Peak2').. 
+00013990: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+000139a0: 745f 7065 616b 733e 323a 0a20 2020 2020  t_peaks>2:.     
+000139b0: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
+000139c0: 6c6f 7428 785f 6c69 6e2c 2063 6f6d 706f  lot(x_lin, compo
+000139d0: 6e65 6e74 732e 6765 7428 276c 7a33 5f27  nents.get('lz3_'
+000139e0: 292c 2027 2d6d 272c 206c 696e 6577 6964  ), '-m', linewid
+000139f0: 7468 3d32 2c20 6c61 6265 6c3d 2750 6561  th=2, label='Pea
+00013a00: 6b33 2729 0a20 2020 2020 2020 2020 2020  k3').           
+00013a10: 2023 2069 6620 6c65 6e28 7065 616b 5f70   # if len(peak_p
+00013a20: 6f73 5f76 6f69 6774 293e 313a 0a20 2020  os_voigt)>1:.   
+00013a30: 2020 2020 2020 2020 2023 2020 2020 206c           #     l
+00013a40: 6f77 6572 7065 616b 3d6e 702e 6d69 6e28  owerpeak=np.min(
+00013a50: 5b50 6561 6b31 5f43 656e 742c 2050 6561  [Peak1_Cent, Pea
+00013a60: 6b32 5f43 656e 745d 290a 2020 2020 2020  k2_Cent]).      
+00013a70: 2020 2020 2020 2320 2020 2020 7570 7065        #     uppe
+00013a80: 7270 6561 6b3d 6e70 2e6d 6178 285b 5065  rpeak=np.max([Pe
+00013a90: 616b 315f 4365 6e74 2c20 5065 616b 325f  ak1_Cent, Peak2_
+00013aa0: 4365 6e74 5d29 0a20 2020 2020 2020 2020  Cent]).         
+00013ab0: 2020 2023 2020 2020 2061 7831 2e73 6574     #     ax1.set
+00013ac0: 5f78 6c69 6d28 5b6c 6f77 6572 7065 616b  _xlim([lowerpeak
+00013ad0: 2d31 352c 2075 7070 6572 7065 616b 2b31  -15, upperpeak+1
+00013ae0: 355d 290a 2020 2020 2020 2020 2020 2020  5]).            
+00013af0: 2320 6966 206c 656e 2870 6561 6b5f 706f  # if len(peak_po
+00013b00: 735f 766f 6967 7429 3e31 3a0a 2020 2020  s_voigt)>1:.    
+00013b10: 2020 2020 2020 2020 2320 2020 2020 6178          #     ax
+00013b20: 322e 7365 745f 786c 696d 285b 6c6f 7765  2.set_xlim([lowe
+00013b30: 7270 6561 6b2d 3230 2c20 7570 7065 7270  rpeak-20, upperp
+00013b40: 6561 6b2b 3230 5d29 0a0a 2020 2020 2020  eak+20])..      
+00013b50: 2020 2020 2020 6178 322e 6c65 6765 6e64        ax2.legend
+00013b60: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00013b70: 7061 7468 333d 7061 7468 2b27 2f27 2b27  path3=path+'/'+'
+00013b80: 6469 6164 5f66 6974 5f69 6d61 6765 7327  diad_fit_images'
+00013b90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013ba0: 6f73 2e70 6174 682e 6578 6973 7473 2870  os.path.exists(p
+00013bb0: 6174 6833 293a 0a20 2020 2020 2020 2020  ath3):.         
+00013bc0: 2020 2020 2020 206f 7574 3d27 7061 7468         out='path
+00013bd0: 2065 7869 7374 7327 0a20 2020 2020 2020   exists'.       
+00013be0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00013bf0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+00013c00: 6b65 6469 7273 2870 6174 682b 272f 272b  kedirs(path+'/'+
+00013c10: 2027 6469 6164 5f66 6974 5f69 6d61 6765   'diad_fit_image
+00013c20: 7327 2c20 6578 6973 745f 6f6b 3d46 616c  s', exist_ok=Fal
+00013c30: 7365 290a 0a0a 2020 2020 2020 2020 2020  se)...          
+00013c40: 2020 6669 6c65 3d66 696c 656e 616d 652e    file=filename.
+00013c50: 7273 706c 6974 2827 2e74 7874 272c 2031  rsplit('.txt', 1
+00013c60: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+00013c70: 2066 6967 2e73 6176 6566 6967 2870 6174   fig.savefig(pat
+00013c80: 6833 2b27 2f27 2b27 4469 6164 315f 4669  h3+'/'+'Diad1_Fi
+00013c90: 745f 7b7d 2e70 6e67 272e 666f 726d 6174  t_{}.png'.format
+00013ca0: 2866 696c 6529 2c20 6470 693d 6470 6929  (file), dpi=dpi)
+00013cb0: 0a0a 0a0a 0a20 2020 2020 2020 2062 6573  .....        bes
+00013cc0: 745f 6669 743d 7265 7375 6c74 2e62 6573  t_fit=result.bes
+00013cd0: 745f 6669 740a 0a20 2020 2020 2020 2064  t_fit..        d
+00013ce0: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
+00013cf0: 6974 275d 3d72 6566 6974 5f70 6172 616d  it']=refit_param
+00013d00: 0a0a 2020 2020 2020 2020 2320 4669 6e61  ..        # Fina
+00013d10: 6c20 6368 6563 6b20 2d20 7468 6174 2047  l check - that G
+00013d20: 6175 7373 6961 6e20 6973 6e74 2061 6e79  aussian isnt any
+00013d30: 7768 6572 6520 6e65 6172 2074 6865 2068  where near the h
+00013d40: 6569 6768 7420 6f66 2074 6865 2064 6961  eight of the dia
+00013d50: 640a 0a0a 2020 2020 6466 5f6f 7574 3d64  d...    df_out=d
+00013d60: 665f 6f75 742e 6669 6c6c 6e61 2830 290a  f_out.fillna(0).
+00013d70: 0a20 2020 2072 6574 7572 6e20 7265 7375  .    return resu
+00013d80: 6c74 2c20 6466 5f6f 7574 2c20 795f 6265  lt, df_out, y_be
+00013d90: 7374 5f66 6974 2c20 785f 6c69 6e2c 2063  st_fit, x_lin, c
+00013da0: 6f6d 706f 6e65 6e74 732c 2078 6461 742c  omponents, xdat,
+00013db0: 2079 6461 742c 2061 7831 5f78 6c69 6d2c   ydat, ax1_xlim,
+00013dc0: 2061 7832 5f78 6c69 6d2c 2072 6573 6964   ax2_xlim, resid
+00013dd0: 7561 6c5f 6469 6164 5f63 6f6f 7264 732c  ual_diad_coords,
+00013de0: 2079 6461 745f 696e 7261 6e67 652c 2020   ydat_inrange,  
+00013df0: 7864 6174 5f69 6e72 616e 6765 0a0a 0a0a  xdat_inrange....
+00013e00: 6465 6620 6669 745f 6469 6164 5f32 5f77  def fit_diad_2_w
+00013e10: 5f62 636b 282a 2c20 636f 6e66 6967 313a  _bck(*, config1:
+00013e20: 2064 6961 6432 5f66 6974 5f63 6f6e 6669   diad2_fit_confi
+00013e30: 673d 6469 6164 325f 6669 745f 636f 6e66  g=diad2_fit_conf
+00013e40: 6967 2829 2c20 636f 6e66 6967 323a 2064  ig(), config2: d
+00013e50: 6961 645f 6964 5f63 6f6e 6669 673d 6469  iad_id_config=di
+00013e60: 6164 5f69 645f 636f 6e66 6967 2829 2c0a  ad_id_config(),.
+00013e70: 2020 2020 7061 7468 3d4e 6f6e 652c 2066      path=None, f
+00013e80: 696c 656e 616d 653d 4e6f 6e65 2c20 7065  ilename=None, pe
+00013e90: 616b 5f70 6f73 5f76 6f69 6774 3d4e 6f6e  ak_pos_voigt=Non
+00013ea0: 652c 6669 6c65 7479 7065 3d4e 6f6e 652c  e,filetype=None,
+00013eb0: 0a20 2020 2070 6c6f 745f 6669 6775 7265  .    plot_figure
+00013ec0: 3d54 7275 652c 2063 6c6f 7365 5f66 6967  =True, close_fig
+00013ed0: 7572 653d 4661 6c73 652c 2044 6961 645f  ure=False, Diad_
+00013ee0: 706f 733d 4e6f 6e65 2c20 4842 5f70 6f73  pos=None, HB_pos
+00013ef0: 3d4e 6f6e 652c 2043 3133 5f70 6f73 3d4e  =None, C13_pos=N
+00013f00: 6f6e 6529 3a0a 2020 2020 2222 2220 5468  one):.    """ Th
+00013f10: 6973 2066 756e 6374 696f 6e20 6669 7473  is function fits
+00013f20: 2074 6865 2062 6163 6b67 726f 756e 6420   the background 
+00013f30: 2875 7369 6e67 2074 6865 2066 756e 6374  (using the funct
+00013f40: 696f 6e20 7265 6d6f 7665 5f64 6961 645f  ion remove_diad_
+00013f50: 6261 7365 6c69 6e65 2920 616e 6420 7468  baseline) and th
+00013f60: 656e 2066 6974 7320 7468 6520 7065 616b  en fits the peak
+00013f70: 7320 7573 696e 6720 6669 745f 6761 7573  s using fit_gaus
+00013f80: 7369 616e 5f76 6f69 6774 5f67 656e 6572  sian_voigt_gener
+00013f90: 6963 5f64 6961 6428 290a 2020 2020 4974  ic_diad().    It
+00013fa0: 2074 6865 6e20 6368 6563 6b73 2069 6620   then checks if 
+00013fb0: 616e 7920 7061 7261 6d65 7465 7273 2061  any parameters a
+00013fc0: 7265 2072 6967 6874 2061 7420 7468 6520  re right at the 
+00013fd0: 7065 726d 6974 7465 6420 6564 6765 2028  permitted edge (
+00013fe0: 6d65 616e 696e 6720 6669 7474 696e 6720  meaning fitting 
+00013ff0: 6469 646e 7420 636f 6e76 6572 6765 292c  didnt converge),
+00014000: 2061 6e64 2074 7269 6573 2066 6974 7469   and tries fitti
+00014010: 6e67 2069 6620 736f 2e20 5468 656e 2069  ng if so. Then i
+00014020: 7420 6d61 6b65 7320 6120 706c 6f74 0a20  t makes a plot. 
+00014030: 2020 206f 6620 7468 6520 7661 7269 6f75     of the variou
+00014040: 7320 7061 7274 7320 6f66 2074 6865 2066  s parts of the f
+00014050: 6974 7469 6e67 2070 726f 6365 6475 7265  itting procedure
+00014060: 2c20 616e 6420 7265 7475 726e 7320 6120  , and returns a 
+00014070: 6461 7461 6672 616d 6520 6f66 2074 6865  dataframe of the
+00014080: 2066 6974 2070 6172 616d 6574 6572 732e   fit parameters.
+00014090: 0a0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+000140a0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+000140b0: 2d0a 2020 2020 636f 6e66 6967 313a 2062  -.    config1: b
+000140c0: 7920 6465 6661 756c 7420 7573 6573 2064  y default uses d
+000140d0: 6961 6432 5f66 6974 5f63 6f6e 6669 6728  iad2_fit_config(
+000140e0: 292e 204f 7074 696f 6e73 2074 6f20 6564  ). Options to ed
+000140f0: 6974 2077 6974 6869 6e20 7468 6973 3a0a  it within this:.
+00014100: 0a20 2020 2020 2020 204e 5f70 6f6c 795f  .        N_poly_
+00014110: 6263 6b5f 6469 6164 323a 2069 6e74 0a20  bck_diad2: int. 
+00014120: 2020 2020 2020 2020 2020 2064 6567 7265             degre
+00014130: 6520 6f66 2070 6f6c 796e 6f6d 6961 6c20  e of polynomial 
+00014140: 746f 2066 6974 2074 6f20 7468 6520 6261  to fit to the ba
+00014150: 636b 6772 6f75 6e64 2e0a 0a20 2020 2020  ckground...     
+00014160: 2020 206d 6f64 656c 5f6e 616d 653a 2073     model_name: s
+00014170: 7472 0a20 2020 2020 2020 2020 2020 2057  tr.            W
+00014180: 6861 7420 7479 7065 206f 6620 7065 616b  hat type of peak
+00014190: 2079 6f75 2077 616e 7420 746f 2066 6974   you want to fit
+000141a0: 2c20 6569 7468 6572 2027 5073 6575 646f  , either 'Pseudo
+000141b0: 566f 6967 744d 6f64 656c 2720 6f72 2027  VoigtModel' or '
+000141c0: 566f 6967 744d 6f64 656c 270a 0a20 2020  VoigtModel'..   
+000141d0: 2020 2020 2066 6974 5f70 6561 6b73 3a20       fit_peaks: 
+000141e0: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+000141f0: 4e75 6d62 6572 206f 6620 7065 616b 7320  Number of peaks 
+00014200: 746f 2066 6974 2e20 3120 3d20 6a75 7374  to fit. 1 = just
+00014210: 2064 6961 642c 2032 3d20 6469 6164 2061   diad, 2= diad a
+00014220: 6e64 2048 6f74 6261 6e64 2c20 333d 2064  nd Hotband, 3= d
+00014230: 6961 642c 2068 6f74 6261 6e64 2c20 4331  iad, hotband, C1
+00014240: 330a 0a20 2020 2020 2020 206c 6f77 6572  3..        lower
+00014250: 5f62 636b 5f64 6961 6432 2c20 7570 7065  _bck_diad2, uppe
+00014260: 725f 6263 6b5f 6469 6164 323a 205b 666c  r_bck_diad2: [fl
+00014270: 6f61 742c 2066 6c6f 6174 5d0a 2020 2020  oat, float].    
+00014280: 2020 2020 2020 2020 6261 636b 6772 6f75          backgrou
+00014290: 6e64 2070 6f73 6974 696f 6e20 746f 206c  nd position to l
+000142a0: 6566 7420 616e 6420 7269 6768 7420 6f66  eft and right of
+000142b0: 206f 7665 7261 6c20 6469 6164 2072 6567   overal diad reg
+000142c0: 696f 6e20 2869 6e63 2064 6961 642b 2d48  ion (inc diad+-H
+000142d0: 422b 2d43 3133 290a 0a20 2020 2020 2020  B+-C13)..       
+000142e0: 2066 6974 5f67 6175 7373 3a20 626f 6f6c   fit_gauss: bool
+000142f0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00014300: 5472 7565 2c20 6669 7473 2061 2067 6175  True, fits a gau
+00014310: 7373 6961 6e20 7065 616b 0a0a 2020 2020  ssian peak..    
+00014320: 2020 2020 6761 7573 735f 616d 703a 2020      gauss_amp:  
+00014330: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00014340: 2020 4573 7469 6d61 7465 206f 6620 616d    Estimate of am
+00014350: 706c 6974 7564 6520 6f66 2047 6175 7373  plitude of Gauss
+00014360: 6961 6e20 7065 616b 2028 7765 2066 696e  ian peak (we fin
+00014370: 6420 6120 676f 6f64 2066 6972 7374 2067  d a good first g
+00014380: 7565 7373 2069 7320 322a 2074 6865 2061  uess is 2* the a
+00014390: 6273 6f6c 7574 6520 7072 6f6d 696e 656e  bsolute prominen
+000143a0: 6365 206f 6620 7468 6520 4842 2070 6561  ce of the HB pea
+000143b0: 6b29 0a0a 2020 2020 2020 2020 6469 6164  k)..        diad
+000143c0: 5f73 6967 6d61 2c20 4842 5f73 6967 6d61  _sigma, HB_sigma
+000143d0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+000143e0: 2020 2020 4573 7469 6d61 7465 206f 6620      Estimate of 
+000143f0: 7468 6520 616d 706c 6974 7564 6520 6f66  the amplitude of
+00014400: 2074 6865 2064 6961 6420 7065 616b 2f48   the diad peak/H
+00014410: 4220 7065 616b 0a0a 2020 2020 2020 2020  B peak..        
+00014420: 6469 6164 5f70 726f 6d2c 2048 425f 7072  diad_prom, HB_pr
+00014430: 6f6d 2c20 4331 335f 7072 6f6d 3a20 666c  om, C13_prom: fl
+00014440: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00014450: 4573 7469 6d61 7465 206f 6620 7072 6f6d  Estimate of prom
+00014460: 696e 656e 6365 206f 6620 7065 616b 2e20  inence of peak. 
+00014470: 5573 6564 2061 6c6f 6e67 7369 6465 2073  Used alongside s
+00014480: 6967 6d61 2074 6f20 6573 7469 6d61 7465  igma to estimate
+00014490: 2074 6865 2061 6d70 6c69 7475 6465 206f   the amplitude o
+000144a0: 6620 7468 6520 6469 6164 2074 6f20 6169  f the diad to ai
+000144b0: 6420 7065 616b 2066 6974 7469 6e67 2e0a  d peak fitting..
+000144c0: 0a0a 2020 2020 2020 2020 6469 6164 5f73  ..        diad_s
+000144d0: 6967 6d61 5f6d 696e 5f61 6c6c 6f77 616e  igma_min_allowan
+000144e0: 6365 2c20 6469 6164 5f73 6967 6d61 5f6d  ce, diad_sigma_m
+000144f0: 696e 5f61 6c6c 6f77 616e 6365 3a20 666c  in_allowance: fl
+00014500: 6f61 740a 2020 2020 2020 2020 4842 5f73  oat.        HB_s
+00014510: 6967 6d61 5f6d 696e 5f61 6c6c 6f77 616e  igma_min_allowan
+00014520: 6365 2c20 4842 5f73 6967 6d61 5f6d 6178  ce, HB_sigma_max
+00014530: 5f61 6c6c 6f77 616e 6365 3a20 666c 6f61  _allowance: floa
+00014540: 740a 2020 2020 2020 2020 2020 2020 4661  t.            Fa
+00014550: 6374 6f72 2074 6861 7420 7369 676d 6120  ctor that sigma 
+00014560: 6f66 2070 6561 6b20 6973 2061 6c6c 6f77  of peak is allow
+00014570: 6564 2074 6f20 6465 7669 6174 6520 6672  ed to deviate fr
+00014580: 6f6d 2031 7374 2067 7565 7373 2028 652e  om 1st guess (e.
+00014590: 672e 206d 6178 3d32 2c20 322a 2067 7565  g. max=2, 2* gue
+000145a0: 7373 2c20 6d69 6e3d 302e 352c 2030 2e35  ss, min=0.5, 0.5
+000145b0: 202a 2067 7565 7373 292e 0a0a 2020 2020   * guess)...    
+000145c0: 2020 2020 6469 6164 5f61 6d70 5f6d 696e      diad_amp_min
+000145d0: 5f61 6c6c 6f77 616e 6365 2c20 6469 6164  _allowance, diad
+000145e0: 5f61 6d70 5f6d 696e 5f61 6c6c 6f77 616e  _amp_min_allowan
+000145f0: 6365 3a20 666c 6f61 740a 2020 2020 2020  ce: float.      
+00014600: 2020 4842 5f61 6d70 5f6d 696e 5f61 6c6c    HB_amp_min_all
+00014610: 6f77 616e 6365 2c20 4842 5f61 6d70 5f6d  owance, HB_amp_m
+00014620: 6178 5f61 6c6c 6f77 616e 6365 3a20 666c  ax_allowance: fl
+00014630: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00014640: 4661 6374 6f72 2074 6861 7420 7468 6520  Factor that the 
+00014650: 616d 706c 6974 7564 6520 6f66 2070 6561  amplitude of pea
+00014660: 6b20 6973 2061 6c6c 6f77 6564 2074 6f20  k is allowed to 
+00014670: 6465 7669 6174 6520 6672 6f6d 2031 7374  deviate from 1st
+00014680: 2067 7565 7373 2028 652e 672e 206d 6178   guess (e.g. max
+00014690: 3d32 2c20 322a 2067 7565 7373 2c20 6d69  =2, 2* guess, mi
+000146a0: 6e3d 302e 352c 2030 2e35 202a 2067 7565  n=0.5, 0.5 * gue
+000146b0: 7373 292e 0a0a 2020 2020 2020 2020 2a20  ss)...        * 
+000146c0: 4e6f 7465 2c20 666f 7220 4331 332c 2077  Note, for C13, w
+000146d0: 6520 6669 6e64 2074 6865 2063 6f64 6520  e find the code 
+000146e0: 776f 726b 7320 6265 7474 6572 2c20 6966  works better, if
+000146f0: 2073 6967 6d61 2069 7320 7365 7420 6173   sigma is set as
+00014700: 2031 7374 2066 6974 206f 6620 6469 6164   1st fit of diad
+00014710: 2073 6967 6d61 2f35 2c20 616c 6c6f 7765   sigma/5, allowe
+00014720: 6420 746f 2076 6172 790a 2020 2020 2020  d to vary.      
+00014730: 2020 6265 7477 6565 6e20 6469 6164 5f73    between diad_s
+00014740: 6967 6d61 2f32 3020 746f 2064 6961 645f  igma/20 to diad_
+00014750: 7369 676d 612f 322e 2054 6865 206d 696e  sigma/2. The min
+00014760: 2061 6e64 206d 6178 2061 6d70 6c69 7475   and max amplitu
+00014770: 6465 2061 7265 2067 6f74 2030 2e35 2061  de are got 0.5 a
+00014780: 6e64 2032 2a20 7468 6520 616c 6c6f 7761  nd 2* the allowa
+00014790: 6e63 6520 656e 7465 7265 6420 666f 7220  nce entered for 
+000147a0: 4842 320a 0a20 2020 2020 2020 2078 5f72  HB2..        x_r
+000147b0: 616e 6765 5f62 6173 656c 696e 653a 2066  ange_baseline: f
+000147c0: 6c6f 6174 206f 7220 4e6f 6e65 0a20 2020  loat or None.   
+000147d0: 2020 2020 2020 2020 2053 6574 7320 7820           Sets x 
+000147e0: 6c69 6d69 7420 6f66 2070 6c6f 7420 7368  limit of plot sh
+000147f0: 6f77 696e 6720 6261 7365 6c69 6e65 7320  owing baselines 
+00014800: 746f 2064 6961 6420 6365 6e74 6572 202d  to diad center -
+00014810: 2078 5f72 616e 6765 5f62 6173 656c 696e   x_range_baselin
+00014820: 652c 2061 6e64 202b 785f 7261 6e67 655f  e, and +x_range_
+00014830: 6261 7365 6c69 6e65 0a0a 2020 2020 2020  baseline..      
+00014840: 2020 795f 7261 6e67 655f 6261 7365 6c69    y_range_baseli
+00014850: 6e65 3a20 666c 6f61 7420 6f72 204e 6f6e  ne: float or Non
+00014860: 650a 2020 2020 2020 2020 2020 2020 5365  e.            Se
+00014870: 7473 2079 2061 7869 7320 6f66 2062 6173  ts y axis of bas
+00014880: 656c 696e 6520 706c 6f74 2061 7320 6d69  eline plot as mi
+00014890: 6e69 6d75 6d20 6261 6c75 6520 6f66 2062  nimum balue of b
+000148a0: 6173 656c 696e 6520 7265 6769 6f6e 202d  aseline region -
+000148b0: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+000148c0: 2f33 2c0a 2020 2020 2020 2020 2020 2020  /3,.            
+000148d0: 616e 6420 7468 6520 7570 7065 7220 7661  and the upper va
+000148e0: 6c75 6520 6173 206d 6178 2076 616c 7565  lue as max value
+000148f0: 206f 6620 6261 7365 6c69 6e65 2072 6567   of baseline reg
+00014900: 696f 6e20 2b20 795f 7261 6e67 655f 6261  ion + y_range_ba
+00014910: 7365 6c69 6e65 0a20 2020 2020 2020 2020  seline.         
+00014920: 2020 2042 6173 656c 696e 6520 7265 6769     Baseline regi
+00014930: 6f6e 2069 7320 7468 6520 6465 6669 6e65  on is the define
+00014940: 6420 7265 6769 6f6e 206f 6620 6261 7365  d region of base
+00014950: 6c69 6e65 206d 696e 7573 2061 6e79 2070  line minus any p
+00014960: 6f69 6e74 7320 6f75 7473 6964 6520 7468  oints outside th
+00014970: 6520 7369 676d 6120 6669 6c74 6572 0a0a  e sigma filter..
+00014980: 2020 2020 2020 2020 785f 7261 6e67 655f          x_range_
+00014990: 7265 7369 6475 616c 3a20 666c 6f61 740a  residual: float.
+000149a0: 2020 2020 2020 2020 2020 2020 4469 7374              Dist
+000149b0: 616e 6365 2065 6974 6865 7220 7369 6465  ance either side
+000149c0: 206f 6620 6469 6164 2063 656e 7465 7220   of diad center 
+000149d0: 746f 2073 686f 7720 6f6e 2072 6573 6964  to show on resid
+000149e0: 7561 6c20 706c 6f74 2e0a 0a20 2020 2020  ual plot...     
+000149f0: 2020 2064 7069 3a20 666c 6f61 740a 2020     dpi: float.  
+00014a00: 2020 2020 2020 2020 2020 6470 6920 746f            dpi to
+00014a10: 2073 6176 6520 6669 6775 7265 2061 7420   save figure at 
+00014a20: 6f66 206f 7665 7261 6c6c 2066 6974 730a  of overall fits.
+00014a30: 0a20 2020 2063 6f6e 6669 6732 3a20 6469  .    config2: di
+00014a40: 6164 5f69 645f 636f 6e66 6967 2829 2066  ad_id_config() f
+00014a50: 696c 652e 204f 6e6c 7920 7468 696e 6720  ile. Only thing 
+00014a60: 6974 2075 7365 7320 6672 6f6d 2074 6869  it uses from thi
+00014a70: 7320 6973 2061 6e79 2065 7863 6c75 6465  s is any exclude
+00014a80: 6420 7261 6e67 6573 0a0a 2020 2020 7061  d ranges..    pa
+00014a90: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
+00014aa0: 466f 6c64 6572 2075 7365 7220 7769 7368  Folder user wish
+00014ab0: 6573 2074 6f20 7265 6164 2064 6174 6120  es to read data 
+00014ac0: 6672 6f6d 0a0a 2020 2020 6669 6c65 6e61  from..    filena
+00014ad0: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
+00014ae0: 5370 6563 6966 6963 206e 616d 6520 6f66  Specific name of
+00014af0: 2066 696c 6520 6265 696e 6720 7573 6564   file being used
+00014b00: 2e0a 0a20 2020 2066 696c 6574 7970 653a  ...    filetype:
+00014b10: 2073 7472 0a20 2020 2020 2020 2049 6465   str.        Ide
+00014b20: 6e74 6966 6965 7320 7479 7065 206f 6620  ntifies type of 
+00014b30: 6669 6c65 2e20 6368 6f6f 7365 2066 726f  file. choose fro
+00014b40: 6d20 2757 6974 6563 5f41 5343 4949 272c  m 'Witec_ASCII',
+00014b50: 2027 6865 6164 6c65 7373 5f74 7874 272c   'headless_txt',
+00014b60: 2027 6865 6164 6c65 7373 5f63 7376 272c   'headless_csv',
+00014b70: 2027 6865 6164 5f63 7376 272c 2027 5769   'head_csv', 'Wi
+00014b80: 7465 635f 4153 4349 4927 2c0a 2020 2020  tec_ASCII',.    
+00014b90: 2020 2020 2748 4f52 4942 415f 7478 7427      'HORIBA_txt'
+00014ba0: 2c20 2752 656e 6973 6861 775f 7478 7427  , 'Renishaw_txt'
+00014bb0: 0a0a 2020 2020 706c 6f74 5f66 6967 7572  ..    plot_figur
+00014bc0: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
+00014bd0: 6966 2054 7275 652c 2073 6176 6573 2066  if True, saves f
+00014be0: 6967 7572 650a 0a20 2020 2044 6961 645f  igure..    Diad_
+00014bf0: 706f 733a 2066 6c6f 6174 0a20 2020 2020  pos: float.     
+00014c00: 2020 2045 7374 696d 6174 6520 6f66 2064     Estimate of d
+00014c10: 6961 6420 706f 7369 7469 6f6e 0a0a 2020  iad position..  
+00014c20: 2020 4842 5f70 6f73 3a20 666c 6f61 740a    HB_pos: float.
+00014c30: 2020 2020 2020 2020 4573 7469 6d61 7465          Estimate
+00014c40: 206f 6620 4842 2070 6f73 6974 696f 6e0a   of HB position.
+00014c50: 0a20 2020 2043 3133 5f70 6f73 3a20 666c  .    C13_pos: fl
+00014c60: 6f61 740a 2020 2020 2020 2020 4573 7469  oat.        Esti
+00014c70: 6d61 7465 206f 6620 4331 3320 706f 7369  mate of C13 posi
+00014c80: 7469 6f6e 0a0a 2020 2020 636c 6f73 655f  tion..    close_
+00014c90: 6669 673a 2062 6f6f 6c0a 2020 2020 2020  fig: bool.      
+00014ca0: 2020 6966 2054 7275 652c 2064 6973 706c    if True, displ
+00014cb0: 6179 7320 6669 6775 7265 2069 6e20 4e6f  ays figure in No
+00014cc0: 7465 626f 6f6b 2e20 4966 2046 616c 7365  tebook. If False
+00014cd0: 2c20 636c 6f73 6573 2069 7420 2879 6f75  , closes it (you
+00014ce0: 2063 616e 2073 7469 6c6c 2066 696e 6420   can still find 
+00014cf0: 6974 2073 6176 6564 290a 0a20 2020 2072  it saved)..    r
+00014d00: 6574 7572 6e5f 6f74 6865 725f 7061 7261  eturn_other_para
+00014d10: 6d73 3a20 626f 6f6c 2028 6465 6661 756c  ms: bool (defaul
+00014d20: 7420 4661 6c73 6529 0a20 2020 2020 2020  t False).       
+00014d30: 2069 6620 4661 6c73 652c 206a 7573 7420   if False, just 
+00014d40: 7265 7475 726e 7320 6120 6461 7461 6672  returns a datafr
+00014d50: 616d 6520 6f66 2070 6561 6b20 7061 7261  ame of peak para
+00014d60: 6d65 7465 7273 0a20 2020 2020 2020 2069  meters.        i
+00014d70: 6620 5472 7565 2c20 616c 736f 2072 6574  f True, also ret
+00014d80: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
+00014d90: 2020 7265 7375 6c74 3a20 6669 7420 7061    result: fit pa
+00014da0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00014db0: 2020 2020 2079 5f62 6573 745f 6669 743a       y_best_fit:
+00014dc0: 2062 6573 7420 6669 7420 746f 2061 6c6c   best fit to all
+00014dd0: 2063 7572 7665 7320 696e 2079 0a20 2020   curves in y.   
+00014de0: 2020 2020 2020 2020 2078 5f6c 696e 3a20           x_lin: 
+00014df0: 6c69 6e73 7061 6365 206f 6620 6265 7374  linspace of best
+00014e00: 2066 6974 2063 6f6f 7264 696e 6174 6573   fit coordinates
+00014e10: 2069 6e20 782e 0a0a 2020 2020 5265 7475   in x...    Retu
+00014e20: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  rns.    --------
+00014e30: 2d2d 2d2d 0a20 2020 2073 6565 2061 626f  ----.    see abo
+00014e40: 7665 2e20 4465 7065 6e64 7320 696e 2072  ve. Depends in r
+00014e50: 6574 7572 6e73 5f6f 7468 6572 5f70 6172  eturns_other_par
+00014e60: 616d 730a 0a0a 0a0a 2020 2020 2222 220a  ams.....    """.
+00014e70: 0a20 2020 2023 2043 6865 636b 206e 756d  .    # Check num
+00014e80: 6265 7220 6f66 2070 6561 6b73 206d 616b  ber of peaks mak
+00014e90: 6573 2073 656e 7365 0a20 2020 2066 6974  es sense.    fit
+00014ea0: 5f70 6561 6b73 3d63 6f6e 6669 6731 2e66  _peaks=config1.f
+00014eb0: 6974 5f70 6561 6b73 0a20 2020 2044 6961  it_peaks.    Dia
+00014ec0: 645f 6466 3d67 6574 5f64 6174 6128 7061  d_df=get_data(pa
+00014ed0: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
+00014ee0: 653d 6669 6c65 6e61 6d65 2c20 6669 6c65  e=filename, file
+00014ef0: 7479 7065 3d66 696c 6574 7970 6529 0a20  type=filetype). 
+00014f00: 2020 2044 6961 643d 6e70 2e61 7272 6179     Diad=np.array
+00014f10: 2844 6961 645f 6466 290a 0a0a 2020 2020  (Diad_df)...    
+00014f20: 6966 2066 6974 5f70 6561 6b73 3d3d 323a  if fit_peaks==2:
+00014f30: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
+00014f40: 736e 616e 2848 425f 706f 7329 3d3d 5472  snan(HB_pos)==Tr
+00014f50: 7565 206f 7220 636f 6e66 6967 312e 4842  ue or config1.HB
+00014f60: 5f70 726f 6d3c 303a 0a20 2020 2020 2020  _prom<0:.       
+00014f70: 2020 2020 2066 6974 5f70 6561 6b73 3d31       fit_peaks=1
+00014f80: 0a20 2020 2020 2020 2020 2020 2066 6974  .            fit
+00014f90: 5f67 6175 7373 3d46 616c 7365 0a0a 0a0a  _gauss=False....
+00014fa0: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
+00014fb0: 3d3d 333a 0a20 2020 2020 2020 2023 2054  ==3:.        # T
+00014fc0: 6869 7320 7465 7374 7320 6966 2048 4220  his tests if HB 
+00014fd0: 6973 204e 616e 2061 6e64 2043 3133 2069  is Nan and C13 i
+00014fe0: 7320 4e61 6e0a 2020 2020 2020 2020 6966  s Nan.        if
+00014ff0: 206e 702e 6973 6e61 6e28 4842 5f70 6f73   np.isnan(HB_pos
+00015000: 293d 3d54 7275 6520 616e 6420 6e70 2e69  )==True and np.i
+00015010: 736e 616e 2843 3133 5f70 6f73 293d 3d54  snan(C13_pos)==T
+00015020: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+00015030: 2066 6974 5f70 6561 6b73 3d31 0a20 2020   fit_peaks=1.   
+00015040: 2020 2020 2020 2020 2066 6974 5f67 6175           fit_gau
+00015050: 7373 3d46 616c 7365 0a20 2020 2020 2020  ss=False.       
+00015060: 2023 2049 6620 6f6e 6c79 2048 4220 6973   # If only HB is
+00015070: 204e 616e 2c20 6c65 7473 2069 6e73 7465   Nan, lets inste
+00015080: 6164 2061 6c6c 6f63 6174 6520 6120 4842  ad allocate a HB
+00015090: 2070 6f73 6974 6f69 6e2e 0a20 2020 2020   positoin..     
+000150a0: 2020 2065 6c69 6620 6e70 2e69 736e 616e     elif np.isnan
+000150b0: 2848 425f 706f 7329 3a0a 2020 2020 2020  (HB_pos):.      
+000150c0: 2020 2020 2020 4842 5f72 6567 696f 6e3d        HB_region=
+000150d0: 5b44 6961 645f 706f 732b 3139 2c20 4469  [Diad_pos+19, Di
+000150e0: 6164 5f70 6f73 2b32 335d 0a20 2020 2020  ad_pos+23].     
+000150f0: 2020 2020 2020 2066 696c 7465 723d 2844         filter=(D
+00015100: 6961 645b 3a2c 2030 5d3e 3d48 425f 7265  iad[:, 0]>=HB_re
+00015110: 6769 6f6e 5b30 5d29 2620 2844 6961 645b  gion[0])& (Diad[
+00015120: 3a2c 305d 3c3d 4842 5f72 6567 696f 6e5b  :,0]<=HB_region[
+00015130: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+00015140: 5472 696d 4469 6164 3d44 6961 645b 6669  TrimDiad=Diad[fi
+00015150: 6c74 6572 5d0a 2020 2020 2020 2020 2020  lter].          
+00015160: 2020 6669 6c74 6572 323d 2844 6961 645b    filter2=(Diad[
+00015170: 3a2c 2030 5d3e 3d28 4842 5f72 6567 696f  :, 0]>=(HB_regio
+00015180: 6e5b 305d 2d35 2929 2620 2844 6961 645b  n[0]-5))& (Diad[
+00015190: 3a2c 305d 3c3d 2848 425f 7265 6769 6f6e  :,0]<=(HB_region
+000151a0: 5b31 5d2b 3529 290a 2020 2020 2020 2020  [1]+5)).        
+000151b0: 2020 2020 5472 696d 4469 6164 323d 4469      TrimDiad2=Di
+000151c0: 6164 5b66 696c 7465 7232 5d0a 2020 2020  ad[filter2].    
+000151d0: 2020 2020 2020 2020 6d61 7879 3d6e 702e          maxy=np.
+000151e0: 6d61 7828 5472 696d 4469 6164 5b3a 2c20  max(TrimDiad[:, 
+000151f0: 315d 290a 2020 2020 2020 2020 2020 2020  1]).            
+00015200: 6d61 7878 3d54 7269 6d44 6961 645b 5472  maxx=TrimDiad[Tr
+00015210: 696d 4469 6164 5b3a 2c20 315d 3d3d 6d61  imDiad[:, 1]==ma
+00015220: 7879 5d0a 2020 2020 2020 2020 2020 2020  xy].            
+00015230: 4842 5f70 6f73 3d66 6c6f 6174 286d 6178  HB_pos=float(max
+00015240: 785b 3a2c 2030 5d5b 305d 290a 2020 2020  x[:, 0][0]).    
+00015250: 2020 2020 2020 2020 6d69 6e79 3d6e 702e          miny=np.
+00015260: 6d69 6e28 5472 696d 4469 6164 325b 3a2c  min(TrimDiad2[:,
+00015270: 2031 5d29 0a20 2020 2020 2020 2020 2020   1]).           
+00015280: 2063 6f6e 6669 6731 2e48 425f 7072 6f6d   config1.HB_prom
+00015290: 3d6d 6178 792d 6d69 6e79 0a20 2020 2020  =maxy-miny.     
+000152a0: 2020 2020 2020 2063 6f6e 6669 6731 2e67         config1.g
+000152b0: 6175 7373 5f61 6d70 3d32 2a28 6d61 7879  auss_amp=2*(maxy
+000152c0: 2d6d 696e 7929 0a0a 0a0a 0a20 2020 2020  -miny).....     
+000152d0: 2020 2023 2049 6620 6e6f 2043 3133 2c20     # If no C13, 
+000152e0: 7265 6475 6365 2066 6974 2070 6561 6b73  reduce fit peaks
+000152f0: 2074 6f20 322e 0a20 2020 2020 2020 2065   to 2..        e
+00015300: 6c69 6620 6e70 2e69 736e 616e 2843 3133  lif np.isnan(C13
+00015310: 5f70 6f73 293d 3d54 7275 6520 6f72 2063  _pos)==True or c
+00015320: 6f6e 6669 6731 2e43 3133 5f70 726f 6d3c  onfig1.C13_prom<
+00015330: 3130 3a0a 2020 2020 2020 2020 2020 2020  10:.            
+00015340: 6669 745f 7065 616b 733d 320a 0a0a 0a20  fit_peaks=2.... 
+00015350: 2020 2023 2046 6972 7374 2c20 7765 2066     # First, we f
+00015360: 6565 6420 6461 7461 2069 6e74 6f20 7468  eed data into th
+00015370: 6520 7265 6d6f 7665 2062 6173 656c 696e  e remove baselin
+00015380: 6520 6675 6e63 7469 6f6e 2c20 7768 6963  e function, whic
+00015390: 6820 7265 7475 726e 7320 636f 7272 6563  h returns correc
+000153a0: 7465 6420 6461 7461 0a0a 2020 2020 795f  ted data..    y_
+000153b0: 636f 7272 5f64 6961 6432 2c20 5079 5f62  corr_diad2, Py_b
+000153c0: 6173 655f 6469 6164 322c 2078 5f64 6961  ase_diad2, x_dia
+000153d0: 6432 2c20 2044 6961 645f 7368 6f72 745f  d2,  Diad_short_
+000153e0: 6469 6164 322c 2050 795f 6261 7365 5f64  diad2, Py_base_d
+000153f0: 6961 6432 2c20 5066 5f62 6173 656c 696e  iad2, Pf_baselin
+00015400: 655f 6469 6164 322c 2020 4261 7365 6c69  e_diad2,  Baseli
+00015410: 6e65 5f79 7375 625f 6469 6164 322c 2042  ne_ysub_diad2, B
+00015420: 6173 656c 696e 655f 785f 6469 6164 322c  aseline_x_diad2,
+00015430: 2042 6173 656c 696e 655f 6469 6164 322c   Baseline_diad2,
+00015440: 2073 7061 6e5f 6469 6164 323d 7265 6d6f   span_diad2=remo
+00015450: 7665 5f64 6961 645f 6261 7365 6c69 6e65  ve_diad_baseline
+00015460: 280a 2020 2070 6174 683d 7061 7468 2c20  (.   path=path, 
+00015470: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
+00015480: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
+00015490: 7479 7065 2c20 6578 636c 7564 655f 7261  type, exclude_ra
+000154a0: 6e67 6531 3d63 6f6e 6669 6732 2e65 7863  nge1=config2.exc
+000154b0: 6c75 6465 5f72 616e 6765 312c 2065 7863  lude_range1, exc
+000154c0: 6c75 6465 5f72 616e 6765 323d 636f 6e66  lude_range2=conf
+000154d0: 6967 322e 6578 636c 7564 655f 7261 6e67  ig2.exclude_rang
+000154e0: 6532 2c20 4e5f 706f 6c79 3d63 6f6e 6669  e2, N_poly=confi
+000154f0: 6731 2e4e 5f70 6f6c 795f 6263 6b5f 6469  g1.N_poly_bck_di
+00015500: 6164 322c 0a20 2020 206c 6f77 6572 5f62  ad2,.    lower_b
+00015510: 636b 3d63 6f6e 6669 6731 2e6c 6f77 6572  ck=config1.lower
+00015520: 5f62 636b 5f64 6961 6432 2c20 7570 7065  _bck_diad2, uppe
+00015530: 725f 6263 6b3d 636f 6e66 6967 312e 7570  r_bck=config1.up
+00015540: 7065 725f 6263 6b5f 6469 6164 322c 2070  per_bck_diad2, p
+00015550: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
+00015560: 290a 0a0a 0a0a 0a20 2020 2023 2054 6865  )......    # The
+00015570: 6e2c 2077 6520 6665 6564 2074 6869 7320  n, we feed this 
+00015580: 6261 7365 6c69 6e65 2d63 6f72 7265 6374  baseline-correct
+00015590: 6564 2064 6174 6120 696e 746f 2074 6865  ed data into the
+000155a0: 2063 6f6d 6269 6e65 6420 6761 7573 7369   combined gaussi
+000155b0: 616e 2d76 6f69 6774 2070 6561 6b20 6669  an-voigt peak fi
+000155c0: 7474 696e 6720 6675 6e63 7469 6f6e 0a20  tting function. 
+000155d0: 2020 2072 6573 756c 742c 2064 665f 6f75     result, df_ou
+000155e0: 742c 2079 5f62 6573 745f 6669 742c 2078  t, y_best_fit, x
+000155f0: 5f6c 696e 2c20 636f 6d70 6f6e 656e 7473  _lin, components
+00015600: 2c20 7864 6174 2c20 7964 6174 2c20 6178  , xdat, ydat, ax
+00015610: 315f 786c 696d 2c20 6178 325f 786c 696d  1_xlim, ax2_xlim
+00015620: 2c72 6573 6964 7561 6c5f 6469 6164 5f63  ,residual_diad_c
+00015630: 6f6f 7264 732c 2079 6461 745f 696e 7261  oords, ydat_inra
+00015640: 6e67 652c 2020 7864 6174 5f69 6e72 616e  nge,  xdat_inran
+00015650: 6765 3d66 6974 5f67 6175 7373 6961 6e5f  ge=fit_gaussian_
+00015660: 766f 6967 745f 6765 6e65 7269 635f 6469  voigt_generic_di
+00015670: 6164 2863 6f6e 6669 6731 2c20 6469 6164  ad(config1, diad
+00015680: 323d 5472 7565 2c20 7061 7468 3d70 6174  2=True, path=pat
+00015690: 682c 2066 696c 656e 616d 653d 6669 6c65  h, filename=file
+000156a0: 6e61 6d65 2c0a 2020 2020 7864 6174 3d78  name,.    xdat=x
+000156b0: 5f64 6961 6432 2c20 7964 6174 3d79 5f63  _diad2, ydat=y_c
+000156c0: 6f72 725f 6469 6164 322c 0a20 2020 2073  orr_diad2,.    s
+000156d0: 7061 6e3d 7370 616e 5f64 6961 6432 2c20  pan=span_diad2, 
+000156e0: 706c 6f74 5f66 6967 7572 653d 4661 6c73  plot_figure=Fals
+000156f0: 652c 2044 6961 645f 706f 733d 4469 6164  e, Diad_pos=Diad
+00015700: 5f70 6f73 2c20 4842 5f70 6f73 3d48 425f  _pos, HB_pos=HB_
+00015710: 706f 732c 2043 3133 5f70 6f73 3d43 3133  pos, C13_pos=C13
+00015720: 5f70 6f73 2c20 6669 745f 7065 616b 733d  _pos, fit_peaks=
+00015730: 6669 745f 7065 616b 7329 0a0a 2020 2020  fit_peaks)..    
+00015740: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+00015750: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+00015760: 2e63 6f6e 7461 696e 7328 2742 656c 6f77  .contains('Below
+00015770: 2074 6872 6573 686f 6c64 2069 6e74 656e   threshold inten
+00015780: 7369 7479 2729 293a 0a20 2020 2020 2020  sity')):.       
+00015790: 2070 7269 6e74 2827 6265 6c6f 7720 796f   print('below yo
+000157a0: 7572 2074 6872 6573 686f 6c64 2069 6e74  ur threshold int
+000157b0: 656e 7369 7479 2c20 7765 2068 6176 6520  ensity, we have 
+000157c0: 6669 6c6c 6564 2077 6974 6820 6e61 6e73  filled with nans
+000157d0: 2729 0a0a 0a20 2020 2065 6c73 653a 0a0a  ')...    else:..
+000157e0: 2020 2020 2020 2020 2320 5472 7920 5265          # Try Re
+000157f0: 6669 7474 696e 6720 6f6e 6365 0a20 2020  fitting once.   
+00015800: 2020 2020 2069 6620 7374 7228 6466 5f6f       if str(df_o
+00015810: 7574 5b27 4469 6164 325f 7265 6669 7427  ut['Diad2_refit'
+00015820: 5d2e 696c 6f63 5b30 5d29 213d 2746 6c61  ].iloc[0])!='Fla
+00015830: 6767 6564 2057 6172 6e69 6e67 733a 273a  gged Warnings:':
+00015840: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00015850: 6e74 2827 7265 6669 7420 6174 7465 6d70  nt('refit attemp
+00015860: 7420 3127 290a 2020 2020 2020 2020 2020  t 1').          
+00015870: 2020 6661 6374 6f72 3d32 0a0a 2020 2020    factor=2..    
+00015880: 2020 2020 2020 2020 696d 706f 7274 2063          import c
+00015890: 6f70 790a 2020 2020 2020 2020 2020 2020  opy.            
+000158a0: 636f 6e66 6967 5f74 7765 616b 6564 3d63  config_tweaked=c
+000158b0: 6f6e 6669 6731 0a20 2020 2020 2020 2020  onfig1.         
+000158c0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+000158d0: 643d 636f 7079 2e63 6f70 7928 636f 6e66  d=copy.copy(conf
+000158e0: 6967 3129 0a0a 2020 2020 2020 2020 2020  ig1)..          
+000158f0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00015900: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00015910: 7472 2e63 6f6e 7461 696e 7328 2720 4e6f  tr.contains(' No
+00015920: 2045 7272 6f72 2729 293a 0a20 2020 2020   Error')):.     
+00015930: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00015940: 745f 7065 616b 733e 313a 0a20 2020 2020  t_peaks>1:.     
+00015950: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015960: 6974 5f70 6561 6b73 3d66 6974 5f70 6561  it_peaks=fit_pea
+00015970: 6b73 2d31 0a0a 0a0a 0a20 2020 2020 2020  ks-1.....       
+00015980: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
+00015990: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+000159a0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+000159b0: 2827 565f 4869 6768 416d 7027 2929 3a0a  ('V_HighAmp')):.
+000159c0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000159d0: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+000159e0: 2e64 6961 645f 616d 706c 6974 7564 653d  .diad_amplitude=
+000159f0: 6361 6c63 5f64 6961 645f 616d 706c 6974  calc_diad_amplit
+00015a00: 7564 652f 3130 0a20 2020 2020 2020 2020  ude/10.         
+00015a10: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
+00015a20: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00015a30: 7374 722e 636f 6e74 6169 6e73 2827 565f  str.contains('V_
+00015a40: 5369 676d 615f 746f 6f5f 4c6f 7727 2929  Sigma_too_Low'))
+00015a50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015a60: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+00015a70: 2e64 6961 645f 7369 676d 613d 636f 6e66  .diad_sigma=conf
+00015a80: 6967 312e 6469 6164 5f73 6967 6d61 2a66  ig1.diad_sigma*f
+00015a90: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00015aa0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00015ab0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00015ac0: 7472 2e63 6f6e 7461 696e 7328 2756 5f53  tr.contains('V_S
+00015ad0: 6967 6d61 5f74 6f6f 5f48 6967 6827 2929  igma_too_High'))
+00015ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015af0: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+00015b00: 2e64 6961 645f 7369 676d 613d 636f 6e66  .diad_sigma=conf
+00015b10: 6967 312e 6469 6164 5f73 6967 6d61 2f66  ig1.diad_sigma/f
+00015b20: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00015b30: 2020 2320 4761 7573 7369 616e 2066 6974    # Gaussian fit
+00015b40: 2062 6974 730a 2020 2020 2020 2020 2020   bits.          
 00015b50: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
 00015b60: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
 00015b70: 7472 2e63 6f6e 7461 696e 7328 2747 5f69  tr.contains('G_i
-00015b80: 6e70 7574 5f54 6f6f 4c6f 7753 6967 6d61  nput_TooLowSigma
-00015b90: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
-00015ba0: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
-00015bb0: 6b65 642e 6761 7573 735f 7369 676d 613d  ked.gauss_sigma=
-00015bc0: 636f 6e66 6967 312e 6761 7573 735f 7369  config1.gauss_si
-00015bd0: 676d 612a 6661 6374 6f72 0a20 2020 2020  gma*factor.     
-00015be0: 2020 2020 2020 2069 6620 616e 7928 6466         if any(df
-00015bf0: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
-00015c00: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
-00015c10: 2827 475f 696e 7075 745f 546f 6f4c 6f77  ('G_input_TooLow
-00015c20: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
-00015c30: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
-00015c40: 7765 616b 6564 2e67 6175 7373 5f61 6d70  weaked.gauss_amp
-00015c50: 6c69 7475 6465 3d63 6f6e 6669 6731 2e67  litude=config1.g
-00015c60: 6175 7373 5f61 6d70 2a66 6163 746f 720a  auss_amp*factor.
-00015c70: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00015c80: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00015c90: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00015ca0: 7461 696e 7328 2747 5f41 6d70 5f74 6f6f  tains('G_Amp_too
-00015cb0: 5f68 6967 6827 2929 3a0a 2020 2020 2020  _high')):.      
-00015cc0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
-00015cd0: 5f74 7765 616b 6564 2e67 6175 7373 5f61  _tweaked.gauss_a
-00015ce0: 6d70 6c69 7475 6465 3d63 6f6e 6669 6731  mplitude=config1
-00015cf0: 2e67 6175 7373 5f61 6d70 2f66 6163 746f  .gauss_amp/facto
-00015d00: 720a 2020 2020 2020 2020 2020 2020 6966  r.            if
-00015d10: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-00015d20: 6432 5f72 6566 6974 275d 2e73 7472 2e63  d2_refit'].str.c
-00015d30: 6f6e 7461 696e 7328 2747 5f68 6967 6865  ontains('G_highe
-00015d40: 725f 7468 616e 5f64 6961 6427 2929 3a0a  r_than_diad')):.
+00015b80: 6e70 7574 5f54 6f6f 4869 6768 5369 676d  nput_TooHighSigm
+00015b90: 6127 2929 3a0a 2020 2020 2020 2020 2020  a')):.          
+00015ba0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+00015bb0: 616b 6564 2e67 6175 7373 5f73 6967 6d61  aked.gauss_sigma
+00015bc0: 3d63 6f6e 6669 6731 2e67 6175 7373 5f73  =config1.gauss_s
+00015bd0: 6967 6d61 2f66 6163 746f 720a 2020 2020  igma/factor.    
+00015be0: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
+00015bf0: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
+00015c00: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
+00015c10: 7328 2747 5f69 6e70 7574 5f54 6f6f 4c6f  s('G_input_TooLo
+00015c20: 7753 6967 6d61 2729 293a 0a20 2020 2020  wSigma')):.     
+00015c30: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00015c40: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
+00015c50: 7369 676d 613d 636f 6e66 6967 312e 6761  sigma=config1.ga
+00015c60: 7573 735f 7369 676d 612a 6661 6374 6f72  uss_sigma*factor
+00015c70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015c80: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
+00015c90: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
+00015ca0: 6e74 6169 6e73 2827 475f 696e 7075 745f  ntains('G_input_
+00015cb0: 546f 6f4c 6f77 416d 7027 2929 3a0a 2020  TooLowAmp')):.  
+00015cc0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00015cd0: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
+00015ce0: 7373 5f61 6d70 6c69 7475 6465 3d63 6f6e  ss_amplitude=con
+00015cf0: 6669 6731 2e67 6175 7373 5f61 6d70 2a66  fig1.gauss_amp*f
+00015d00: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
+00015d10: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+00015d20: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+00015d30: 7472 2e63 6f6e 7461 696e 7328 2747 5f41  tr.contains('G_A
+00015d40: 6d70 5f74 6f6f 5f68 6967 6827 2929 3a0a  mp_too_high')):.
 00015d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015d60: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
 00015d70: 6175 7373 5f61 6d70 6c69 7475 6465 3d63  auss_amplitude=c
 00015d80: 6f6e 6669 6731 2e67 6175 7373 5f61 6d70  onfig1.gauss_amp
 00015d90: 2f66 6163 746f 720a 2020 2020 2020 2020  /factor.        
-00015da0: 2020 2020 2020 2020 2363 6f6e 6669 675f          #config_
-00015db0: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
-00015dc0: 676d 613d 636f 6e66 6967 312e 6761 7573  gma=config1.gaus
-00015dd0: 735f 7369 676d 612a 6661 6374 6f72 0a20  s_sigma*factor. 
-00015de0: 2020 2020 2020 2020 2020 2023 2048 6f74             # Hot
-00015df0: 2062 616e 6420 6669 7420 6269 7473 0a20   band fit bits. 
-00015e00: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00015e10: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
-00015e20: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
-00015e30: 6e74 6169 6e73 2827 4842 325f 4c6f 7741  ntains('HB2_LowA
-00015e40: 6d70 2729 293a 0a20 2020 2020 2020 2020  mp')):.         
-00015e50: 2020 2023 2020 2020 2063 6f6e 6669 675f     #     config_
-00015e60: 7477 6561 6b65 642e 4842 5f61 6d70 6c69  tweaked.HB_ampli
-00015e70: 7475 6465 3d63 616c 635f 4842 5f61 6d70  tude=calc_HB_amp
-00015e80: 6c69 7475 6465 2f32 0a20 2020 2020 2020  litude/2.       
-00015e90: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
-00015ea0: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
-00015eb0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
-00015ec0: 2827 4842 325f 4869 6768 416d 7027 2929  ('HB2_HighAmp'))
-00015ed0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00015ee0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-00015ef0: 6564 2e48 425f 616d 706c 6974 7564 653d  ed.HB_amplitude=
-00015f00: 6361 6c63 5f48 425f 616d 706c 6974 7564  calc_HB_amplitud
-00015f10: 652a 320a 0a0a 2020 2020 2020 2020 2020  e*2...          
-00015f20: 2020 7265 7375 6c74 2c20 6466 5f6f 7574    result, df_out
-00015f30: 2c20 795f 6265 7374 5f66 6974 2c20 785f  , y_best_fit, x_
-00015f40: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732c  lin, components,
-00015f50: 2078 6461 742c 2079 6461 742c 2061 7831   xdat, ydat, ax1
-00015f60: 5f78 6c69 6d2c 2061 7832 5f78 6c69 6d2c  _xlim, ax2_xlim,
-00015f70: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-00015f80: 6f72 6473 2c20 7964 6174 5f69 6e72 616e  ords, ydat_inran
-00015f90: 6765 2c20 2078 6461 745f 696e 7261 6e67  ge,  xdat_inrang
-00015fa0: 653d 6669 745f 6761 7573 7369 616e 5f76  e=fit_gaussian_v
-00015fb0: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
-00015fc0: 6428 636f 6e66 6967 5f74 7765 616b 6564  d(config_tweaked
-00015fd0: 2c20 6469 6164 323d 5472 7565 2c20 7061  , diad2=True, pa
-00015fe0: 7468 3d70 6174 682c 2066 696c 656e 616d  th=path, filenam
-00015ff0: 653d 6669 6c65 6e61 6d65 2c0a 2020 2020  e=filename,.    
-00016000: 2020 2020 2020 2020 7864 6174 3d78 5f64          xdat=x_d
-00016010: 6961 6432 2c20 7964 6174 3d79 5f63 6f72  iad2, ydat=y_cor
-00016020: 725f 6469 6164 322c 0a20 2020 2020 2020  r_diad2,.       
-00016030: 2073 7061 6e3d 7370 616e 5f64 6961 6432   span=span_diad2
-00016040: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
-00016050: 6c73 652c 2044 6961 645f 706f 733d 4469  lse, Diad_pos=Di
-00016060: 6164 5f70 6f73 2c20 4842 5f70 6f73 3d48  ad_pos, HB_pos=H
-00016070: 425f 706f 732c 2043 3133 5f70 6f73 3d43  B_pos, C13_pos=C
-00016080: 3133 5f70 6f73 2c20 6669 745f 7065 616b  13_pos, fit_peak
-00016090: 733d 6669 745f 7065 616b 7329 0a20 2020  s=fit_peaks).   
-000160a0: 2020 2020 2020 2020 2069 3d32 0a20 2020           i=2.   
-000160b0: 2020 2020 2020 2020 2077 6869 6c65 2073           while s
-000160c0: 7472 2864 665f 6f75 745b 2744 6961 6432  tr(df_out['Diad2
-000160d0: 5f72 6566 6974 275d 2e69 6c6f 635b 305d  _refit'].iloc[0]
-000160e0: 2921 3d27 466c 6167 6765 6420 5761 726e  )!='Flagged Warn
-000160f0: 696e 6773 3a27 3a0a 0a20 2020 2020 2020  ings:':..       
-00016100: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00016110: 7265 6669 7420 6174 7465 6d70 7420 203d  refit attempt  =
-00016120: 272b 7374 7228 6929 202b 2027 2c20 272b  '+str(i) + ', '+
-00016130: 7374 7228 6466 5f6f 7574 5b27 4469 6164  str(df_out['Diad
-00016140: 325f 7265 6669 7427 5d2e 696c 6f63 5b30  2_refit'].iloc[0
-00016150: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-00016160: 2020 2020 7072 696e 7428 6466 5f6f 7574      print(df_out
-00016170: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
-00016180: 696c 6f63 5b30 5d29 0a0a 0a20 2020 2020  iloc[0])...     
-00016190: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000161a0: 675f 7477 6561 6b65 6432 3d63 6f70 792e  g_tweaked2=copy.
-000161b0: 636f 7079 2863 6f6e 6669 675f 7477 6561  copy(config_twea
-000161c0: 6b65 6429 0a20 2020 2020 2020 2020 2020  ked).           
-000161d0: 2020 2020 2066 6163 746f 7232 3d66 6163       factor2=fac
-000161e0: 746f 722a 320a 0a20 2020 2020 2020 2020  tor*2..         
-000161f0: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-00016200: 2020 2020 2020 2020 2023 2069 6620 616e           # if an
-00016210: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
-00016220: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-00016230: 6169 6e73 2827 565f 4c6f 7741 6d70 2729  ains('V_LowAmp')
-00016240: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016250: 2020 2023 2020 2020 2063 6f6e 6669 675f     #     config_
-00016260: 7477 6561 6b65 6432 2e64 6961 645f 616d  tweaked2.diad_am
-00016270: 706c 6974 7564 653d 636f 6e66 6967 5f74  plitude=config_t
-00016280: 7765 616b 6564 2e64 6961 645f 616d 706c  weaked.diad_ampl
-00016290: 6974 7564 652a 3130 0a20 2020 2020 2020  itude*10.       
-000162a0: 2020 2020 2020 2020 2023 2069 6620 616e           # if an
-000162b0: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
-000162c0: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
-000162d0: 6169 6e73 2827 565f 4869 6768 416d 7027  ains('V_HighAmp'
-000162e0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000162f0: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
-00016300: 5f74 7765 616b 6564 322e 6469 6164 5f61  _tweaked2.diad_a
-00016310: 6d70 6c69 7475 6465 3d63 6f6e 6669 675f  mplitude=config_
-00016320: 7477 6561 6b65 642e 6469 6164 5f61 6d70  tweaked.diad_amp
-00016330: 6c69 7475 6465 2f31 300a 2020 2020 2020  litude/10.      
-00016340: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-00016350: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-00016360: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-00016370: 696e 7328 2756 5f53 6967 6d61 5f74 6f6f  ins('V_Sigma_too
-00016380: 5f4c 6f77 2729 293a 0a20 2020 2020 2020  _Low')):.       
-00016390: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000163a0: 6669 675f 7477 6561 6b65 6432 2e64 6961  fig_tweaked2.dia
-000163b0: 645f 7369 676d 613d 636f 6e66 6967 5f74  d_sigma=config_t
-000163c0: 7765 616b 6564 2e64 6961 645f 7369 676d  weaked.diad_sigm
-000163d0: 612a 6661 6374 6f72 320a 2020 2020 2020  a*factor2.      
-000163e0: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-000163f0: 2864 665f 6f75 745b 2744 6961 6432 5f72  (df_out['Diad2_r
-00016400: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-00016410: 696e 7328 2756 5f53 6967 6d61 5f74 6f6f  ins('V_Sigma_too
-00016420: 5f48 6967 6827 2929 3a0a 2020 2020 2020  _High')):.      
-00016430: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016440: 6e66 6967 5f74 7765 616b 6564 322e 6469  nfig_tweaked2.di
-00016450: 6164 5f73 6967 6d61 3d63 6f6e 6669 675f  ad_sigma=config_
-00016460: 7477 6561 6b65 642e 6469 6164 5f73 6967  tweaked.diad_sig
-00016470: 6d61 2f66 6163 746f 7232 0a20 2020 2020  ma/factor2.     
-00016480: 2020 2020 2020 2020 2020 2023 2047 6175             # Gau
-00016490: 7373 6961 6e20 6669 7420 6269 7473 0a20  ssian fit bits. 
-000164a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000164b0: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
-000164c0: 6164 325f 7265 6669 7427 5d2e 7374 722e  ad2_refit'].str.
-000164d0: 636f 6e74 6169 6e73 2827 475f 696e 7075  contains('G_inpu
-000164e0: 745f 546f 6f48 6967 6853 6967 6d61 2729  t_TooHighSigma')
-000164f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00016500: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
-00016510: 6561 6b65 6432 2e67 6175 7373 5f73 6967  eaked2.gauss_sig
-00016520: 6d61 3d63 6f6e 6669 675f 7477 6561 6b65  ma=config_tweake
-00016530: 642e 6761 7573 735f 7369 676d 612f 6661  d.gauss_sigma/fa
-00016540: 6374 6f72 320a 2020 2020 2020 2020 2020  ctor2.          
-00016550: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
-00016560: 6f75 745b 2744 6961 6432 5f72 6566 6974  out['Diad2_refit
-00016570: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
-00016580: 2747 5f69 6e70 7574 5f54 6f6f 4c6f 7753  'G_input_TooLowS
-00016590: 6967 6d61 2729 293a 0a20 2020 2020 2020  igma')):.       
-000165a0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000165b0: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
-000165c0: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
-000165d0: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
-000165e0: 676d 612a 6661 6374 6f72 320a 2020 2020  gma*factor2.    
-000165f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00016600: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
-00016610: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-00016620: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
-00016630: 6f6f 4c6f 7741 6d70 2729 293a 0a20 2020  ooLowAmp')):.   
-00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016650: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
-00016660: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
-00016670: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
-00016680: 6761 7573 735f 616d 702a 6661 6374 6f72  gauss_amp*factor
-00016690: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-000166a0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
-000166b0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
-000166c0: 7472 2e63 6f6e 7461 696e 7328 2747 5f41  tr.contains('G_A
-000166d0: 6d70 5f74 6f6f 5f68 6967 6827 2929 3a0a  mp_too_high')):.
-000166e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000166f0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
-00016700: 6564 322e 6761 7573 735f 616d 706c 6974  ed2.gauss_amplit
-00016710: 7564 653d 636f 6e66 6967 5f74 7765 616b  ude=config_tweak
-00016720: 6564 2e67 6175 7373 5f61 6d70 2f66 6163  ed.gauss_amp/fac
-00016730: 746f 7232 0a20 2020 2020 2020 2020 2020  tor2.           
-00016740: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
-00016750: 7574 5b27 4469 6164 325f 7265 6669 7427  ut['Diad2_refit'
-00016760: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
-00016770: 475f 6869 6768 6572 5f74 6861 6e5f 6469  G_higher_than_di
-00016780: 6164 2729 293a 0a20 2020 2020 2020 2020  ad')):.         
-00016790: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-000167a0: 675f 7477 6561 6b65 6432 2e67 6175 7373  g_tweaked2.gauss
-000167b0: 5f61 6d70 6c69 7475 6465 3d63 6f6e 6669  _amplitude=confi
-000167c0: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
-000167d0: 616d 702f 6661 6374 6f72 320a 2020 2020  amp/factor2.    
-000167e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167f0: 2363 6f6e 6669 675f 7477 6561 6b65 6432  #config_tweaked2
-00016800: 2e67 6175 7373 5f73 6967 6d61 3d63 6f6e  .gauss_sigma=con
-00016810: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
-00016820: 735f 7369 676d 612a 6661 6374 6f72 320a  s_sigma*factor2.
-00016830: 2020 2020 2020 2020 2020 2020 2320 2320              # # 
-00016840: 486f 7420 6261 6e64 7320 6269 7473 0a20  Hot bands bits. 
-00016850: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00016860: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
-00016870: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
-00016880: 722e 636f 6e74 6169 6e73 2827 4842 325f  r.contains('HB2_
-00016890: 4c6f 7741 6d70 2729 293a 0a20 2020 2020  LowAmp')):.     
-000168a0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-000168b0: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
-000168c0: 2e48 425f 616d 706c 6974 7564 653d 636f  .HB_amplitude=co
-000168d0: 6e66 6967 5f74 7765 616b 6564 2e48 425f  nfig_tweaked.HB_
-000168e0: 616d 706c 6974 7564 652f 320a 2020 2020  amplitude/2.    
-000168f0: 2020 2020 2020 2020 2320 2020 2020 6966          #     if
-00016900: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-00016910: 6432 5f72 6566 6974 275d 2e73 7472 2e63  d2_refit'].str.c
-00016920: 6f6e 7461 696e 7328 2748 4232 5f48 6967  ontains('HB2_Hig
-00016930: 6841 6d70 2729 293a 0a20 2020 2020 2020  hAmp')):.       
-00016940: 2020 2020 2023 2020 2020 2020 2020 2063       #         c
-00016950: 6f6e 6669 675f 7477 6561 6b65 6432 2e48  onfig_tweaked2.H
-00016960: 425f 616d 706c 6974 7564 653d 636f 6e66  B_amplitude=conf
-00016970: 6967 5f74 7765 616b 6564 2e48 425f 616d  ig_tweaked.HB_am
-00016980: 706c 6974 7564 652a 320a 0a0a 2020 2020  plitude*2...    
-00016990: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000169a0: 6c74 2c20 6466 5f6f 7574 2c20 795f 6265  lt, df_out, y_be
-000169b0: 7374 5f66 6974 2c20 785f 6c69 6e2c 2063  st_fit, x_lin, c
-000169c0: 6f6d 706f 6e65 6e74 732c 2078 6461 742c  omponents, xdat,
-000169d0: 2079 6461 742c 2061 7831 5f78 6c69 6d2c   ydat, ax1_xlim,
-000169e0: 2061 7832 5f78 6c69 6d2c 7265 7369 6475   ax2_xlim,residu
-000169f0: 616c 5f64 6961 645f 636f 6f72 6473 2c20  al_diad_coords, 
-00016a00: 7964 6174 5f69 6e72 616e 6765 2c20 2078  ydat_inrange,  x
-00016a10: 6461 745f 696e 7261 6e67 653d 6669 745f  dat_inrange=fit_
-00016a20: 6761 7573 7369 616e 5f76 6f69 6774 5f67  gaussian_voigt_g
-00016a30: 656e 6572 6963 5f64 6961 6428 636f 6e66  eneric_diad(conf
-00016a40: 6967 5f74 7765 616b 6564 322c 2064 6961  ig_tweaked2, dia
-00016a50: 6432 3d54 7275 652c 2070 6174 683d 7061  d2=True, path=pa
-00016a60: 7468 2c20 6669 6c65 6e61 6d65 3d66 696c  th, filename=fil
-00016a70: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
-00016a80: 2020 2078 6461 743d 785f 6469 6164 322c     xdat=x_diad2,
-00016a90: 2079 6461 743d 795f 636f 7272 5f64 6961   ydat=y_corr_dia
-00016aa0: 6432 2c20 7370 616e 3d73 7061 6e5f 6469  d2, span=span_di
-00016ab0: 6164 322c 2070 6c6f 745f 6669 6775 7265  ad2, plot_figure
-00016ac0: 3d46 616c 7365 2c20 4469 6164 5f70 6f73  =False, Diad_pos
-00016ad0: 3d44 6961 645f 706f 732c 2048 425f 706f  =Diad_pos, HB_po
-00016ae0: 733d 4842 5f70 6f73 2c20 4331 335f 706f  s=HB_pos, C13_po
-00016af0: 733d 4331 335f 706f 732c 2066 6974 5f70  s=C13_pos, fit_p
-00016b00: 6561 6b73 3d66 6974 5f70 6561 6b73 290a  eaks=fit_peaks).
-00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b20: 693d 692b 310a 2020 2020 2020 2020 2020  i=i+1.          
-00016b30: 2020 2020 2020 6966 2069 3e35 3a0a 2020        if i>5:.  
-00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b50: 2020 7072 696e 7428 2747 6f74 2074 6f20    print('Got to 
-00016b60: 3520 6974 6572 6174 6f69 6e73 2061 6e64  5 iteratoins and
-00016b70: 2073 7469 6c6c 2063 6f75 6c64 6e74 2061   still couldnt a
-00016b80: 646a 7573 7420 7468 6520 6669 7420 7061  djust the fit pa
-00016b90: 7261 6d65 7465 7273 2729 0a20 2020 2020  rameters').     
-00016ba0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00016bb0: 7265 616b 0a0a 0a20 2020 2023 2067 6574  reak...    # get
-00016bc0: 2061 2062 6573 7420 6669 7420 746f 2074   a best fit to t
-00016bd0: 6865 2062 6173 656c 696e 6520 7573 696e  he baseline usin
-00016be0: 6720 6120 6c69 6e73 7061 6365 2066 726f  g a linspace fro
-00016bf0: 6d20 7468 6520 7065 616b 2066 6974 7469  m the peak fitti
-00016c00: 6e67 0a20 2020 2079 6261 7365 5f78 6c69  ng.    ybase_xli
-00016c10: 6e3d 5066 5f62 6173 656c 696e 655f 6469  n=Pf_baseline_di
-00016c20: 6164 3228 785f 6c69 6e29 0a0a 2020 2020  ad2(x_lin)..    
-00016c30: 2320 5765 2065 7874 7261 6374 2074 6865  # We extract the
-00016c40: 2066 756c 6c20 7370 6563 7472 6120 746f   full spectra to
-00016c50: 2070 6c6f 7420 6174 2074 6865 2065 6e64   plot at the end
-00016c60: 2c20 616e 6420 636f 6e76 6572 7420 746f  , and convert to
-00016c70: 2061 2064 6174 6166 7261 6d65 0a20 2020   a dataframe.   
-00016c80: 2053 7065 6374 7261 5f64 663d 6765 745f   Spectra_df=get_
-00016c90: 6461 7461 2870 6174 683d 7061 7468 2c20  data(path=path, 
-00016ca0: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
-00016cb0: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
-00016cc0: 7479 7065 290a 2020 2020 5370 6563 7472  type).    Spectr
-00016cd0: 613d 6e70 2e61 7272 6179 2853 7065 6374  a=np.array(Spect
-00016ce0: 7261 5f64 6629 0a0a 0a0a 2020 2020 2320  ra_df)....    # 
-00016cf0: 4d61 6b65 206e 6963 6520 6669 6775 7265  Make nice figure
-00016d00: 0a20 2020 2069 6620 706c 6f74 5f66 6967  .    if plot_fig
-00016d10: 7572 6520 6973 2054 7275 653a 0a0a 2020  ure is True:..  
-00016d20: 2020 2020 2020 6669 6775 7265 5f6d 6f73        figure_mos
-00016d30: 6169 633d 2222 220a 2020 2020 2020 2020  aic=""".        
-00016d40: 5859 0a20 2020 2020 2020 2041 420a 2020  XY.        AB.  
-00016d50: 2020 2020 2020 4344 0a20 2020 2020 2020        CD.       
-00016d60: 2045 450a 2020 2020 2020 2020 2222 220a   EE.        """.
-00016d70: 0a20 2020 2020 2020 2066 6967 2c61 7865  .        fig,axe
-00016d80: 733d 706c 742e 7375 6270 6c6f 745f 6d6f  s=plt.subplot_mo
-00016d90: 7361 6963 286d 6f73 6169 633d 6669 6775  saic(mosaic=figu
-00016da0: 7265 5f6d 6f73 6169 632c 2066 6967 7369  re_mosaic, figsi
-00016db0: 7a65 3d28 3132 2c20 3136 2929 0a20 2020  ze=(12, 16)).   
-00016dc0: 2020 2020 2069 6620 6466 5f6f 7574 5b27       if df_out['
-00016dd0: 4469 6164 325f 7265 6669 7427 5d20 6973  Diad2_refit'] is
-00016de0: 206e 6f74 2046 616c 7365 3a0a 2020 2020   not False:.    
-00016df0: 2020 2020 2020 2020 6669 672e 7375 7074          fig.supt
-00016e00: 6974 6c65 2827 4469 6164 2032 2c20 6669  itle('Diad 2, fi
-00016e10: 6c65 3d20 272b 2073 7472 2866 696c 656e  le= '+ str(filen
-00016e20: 616d 6529 202b 2027 205c 6e27 202b 2073  ame) + ' \n' + s
-00016e30: 7472 2864 665f 6f75 745b 2744 6961 6432  tr(df_out['Diad2
-00016e40: 5f72 6566 6974 275d 2e69 6c6f 635b 305d  _refit'].iloc[0]
-00016e50: 292c 2066 6f6e 7473 697a 653d 3136 2c20  ), fontsize=16, 
-00016e60: 783d 302e 352c 2079 3d31 2e30 290a 2020  x=0.5, y=1.0).  
-00016e70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00016e80: 2020 2020 2020 2020 6669 672e 7375 7074          fig.supt
-00016e90: 6974 6c65 2827 4469 6164 2032 2c20 6669  itle('Diad 2, fi
-00016ea0: 6c65 3d20 272b 2073 7472 2866 696c 656e  le= '+ str(filen
-00016eb0: 616d 6529 2c20 666f 6e74 7369 7a65 3d31  ame), fontsize=1
-00016ec0: 362c 2078 3d30 2e35 2c20 793d 312e 3029  6, x=0.5, y=1.0)
-00016ed0: 0a20 2020 2020 2020 2023 2042 6163 6b67  .        # Backg
-00016ee0: 726f 756e 6420 706c 6f74 2066 6f72 2072  round plot for r
-00016ef0: 6561 6c0a 0a20 2020 2020 2020 2023 2050  eal..        # P
-00016f00: 6c6f 7420 6265 7374 2066 6974 206f 6e20  lot best fit on 
-00016f10: 7468 6520 4c48 532c 2061 6e64 2069 6e64  the LHS, and ind
-00016f20: 6976 6964 7561 6c20 6669 7473 206f 6e20  ividual fits on 
-00016f30: 7468 6520 5248 5320 6174 2074 6865 2074  the RHS at the t
-00016f40: 6f70 0a0a 2020 2020 2020 2020 6178 6573  op..        axes
-00016f50: 5b27 5827 5d2e 7365 745f 7469 746c 6528  ['X'].set_title(
-00016f60: 2761 2920 4261 636b 6772 6f75 6e64 2066  'a) Background f
-00016f70: 6974 2729 0a20 2020 2020 2020 2061 7865  it').        axe
-00016f80: 735b 2758 275d 2e70 6c6f 7428 4469 6164  s['X'].plot(Diad
-00016f90: 5b3a 2c20 305d 2c20 4469 6164 5b3a 2c20  [:, 0], Diad[:, 
-00016fa0: 315d 2c20 272d 272c 2063 6f6c 6f72 3d27  1], '-', color='
-00016fb0: 6772 6579 2729 0a20 2020 2020 2020 2061  grey').        a
-00016fc0: 7865 735b 2758 275d 2e70 6c6f 7428 4469  xes['X'].plot(Di
-00016fd0: 6164 5f73 686f 7274 5f64 6961 6432 5b3a  ad_short_diad2[:
-00016fe0: 2c20 305d 2c20 4469 6164 5f73 686f 7274  , 0], Diad_short
-00016ff0: 5f64 6961 6432 5b3a 2c20 315d 2c20 272d  _diad2[:, 1], '-
-00017000: 7227 2c20 6c61 6265 6c3d 2753 7065 6374  r', label='Spect
-00017010: 7261 2729 0a0a 2020 2020 2020 2020 2361  ra')..        #a
-00017020: 7865 735b 2758 275d 2e70 6c6f 7428 4261  xes['X'].plot(Ba
-00017030: 7365 6c69 6e65 5b3a 2c20 305d 2c20 4261  seline[:, 0], Ba
-00017040: 7365 6c69 6e65 5b3a 2c20 315d 2c20 272d  seline[:, 1], '-
-00017050: 6227 2c20 6c61 6265 6c3d 2742 636b 2070  b', label='Bck p
-00017060: 6f69 6e74 7327 290a 2020 2020 2020 2020  oints').        
-00017070: 6178 6573 5b27 5827 5d2e 706c 6f74 2842  axes['X'].plot(B
-00017080: 6173 656c 696e 655f 6469 6164 325b 3a2c  aseline_diad2[:,
-00017090: 2030 5d2c 2042 6173 656c 696e 655f 6469   0], Baseline_di
-000170a0: 6164 325b 3a2c 2031 5d2c 2027 2e62 272c  ad2[:, 1], '.b',
-000170b0: 206c 6162 656c 3d27 6265 6c2e 2042 636b   label='bel. Bck
-000170c0: 2e20 7074 7327 290a 2020 2020 2020 2020  . pts').        
-000170d0: 6178 6573 5b27 5827 5d2e 706c 6f74 2844  axes['X'].plot(D
-000170e0: 6961 645f 7368 6f72 745f 6469 6164 325b  iad_short_diad2[
-000170f0: 3a2c 2030 5d2c 2050 795f 6261 7365 5f64  :, 0], Py_base_d
-00017100: 6961 6432 2c20 272d 6b27 2c20 6c61 6265  iad2, '-k', labe
-00017110: 6c3d 2762 636b 2e20 706f 6c79 2066 6974  l='bck. poly fit
-00017120: 2729 0a0a 0a0a 2020 2020 2020 2020 6178  ')....        ax
-00017130: 315f 796d 696e 3d6e 702e 6d69 6e28 4261  1_ymin=np.min(Ba
-00017140: 7365 6c69 6e65 5f64 6961 6432 5b3a 2c20  seline_diad2[:, 
-00017150: 315d 292d 3130 2a6e 702e 7374 6428 4261  1])-10*np.std(Ba
-00017160: 7365 6c69 6e65 5f64 6961 6432 5b3a 2c20  seline_diad2[:, 
-00017170: 315d 290a 2020 2020 2020 2020 6178 315f  1]).        ax1_
-00017180: 796d 6178 3d6e 702e 6d61 7828 4261 7365  ymax=np.max(Base
-00017190: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
-000171a0: 292b 3130 2a6e 702e 7374 6428 4261 7365  )+10*np.std(Base
-000171b0: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
-000171c0: 290a 2020 2020 2020 2020 6178 315f 786d  ).        ax1_xm
-000171d0: 696e 3d63 6f6e 6669 6731 2e6c 6f77 6572  in=config1.lower
-000171e0: 5f62 636b 5f64 6961 6432 5b30 5d2d 3330  _bck_diad2[0]-30
-000171f0: 0a20 2020 2020 2020 2061 7831 5f78 6d61  .        ax1_xma
-00017200: 783d 636f 6e66 6967 312e 7570 7065 725f  x=config1.upper_
-00017210: 6263 6b5f 6469 6164 325b 315d 2b33 300a  bck_diad2[1]+30.
-00017220: 2020 2020 2020 2020 2320 4164 6469 6e67          # Adding
-00017230: 2070 6174 6368 6573 0a0a 0a20 2020 2020   patches...     
-00017240: 2020 2072 6563 745f 6469 6164 325f 6231     rect_diad2_b1
-00017250: 3d70 6174 6368 6573 2e52 6563 7461 6e67  =patches.Rectang
-00017260: 6c65 2828 636f 6e66 6967 312e 6c6f 7765  le((config1.lowe
-00017270: 725f 6263 6b5f 6469 6164 325b 305d 2c20  r_bck_diad2[0], 
-00017280: 6178 315f 796d 696e 292c 636f 6e66 6967  ax1_ymin),config
-00017290: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
-000172a0: 325b 315d 2d63 6f6e 6669 6731 2e6c 6f77  2[1]-config1.low
-000172b0: 6572 5f62 636b 5f64 6961 6432 5b30 5d2c  er_bck_diad2[0],
-000172c0: 6178 315f 796d 6178 2d61 7831 5f79 6d69  ax1_ymax-ax1_ymi
-000172d0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172f0: 2020 206c 696e 6577 6964 7468 3d31 2c65     linewidth=1,e
-00017300: 6467 6563 6f6c 6f72 3d27 6e6f 6e65 272c  dgecolor='none',
-00017310: 6661 6365 636f 6c6f 723d 2763 7961 6e27  facecolor='cyan'
-00017320: 2c20 6c61 6265 6c3d 2773 656c 2e20 6263  , label='sel. bc
-00017330: 6b2e 2072 6567 696f 6e27 2c20 616c 7068  k. region', alph
-00017340: 613d 302e 332c 207a 6f72 6465 723d 3029  a=0.3, zorder=0)
-00017350: 0a20 2020 2020 2020 2061 7865 735b 2758  .        axes['X
-00017360: 275d 2e61 6464 5f70 6174 6368 2872 6563  '].add_patch(rec
-00017370: 745f 6469 6164 325f 6231 290a 2020 2020  t_diad2_b1).    
-00017380: 2020 2020 7265 6374 5f64 6961 6432 5f62      rect_diad2_b
-00017390: 323d 7061 7463 6865 732e 5265 6374 616e  2=patches.Rectan
-000173a0: 676c 6528 2863 6f6e 6669 6731 2e75 7070  gle((config1.upp
-000173b0: 6572 5f62 636b 5f64 6961 6432 5b30 5d2c  er_bck_diad2[0],
-000173c0: 2061 7831 5f79 6d69 6e29 2c63 6f6e 6669   ax1_ymin),confi
-000173d0: 6731 2e75 7070 6572 5f62 636b 5f64 6961  g1.upper_bck_dia
-000173e0: 6432 5b31 5d2d 636f 6e66 6967 312e 7570  d2[1]-config1.up
-000173f0: 7065 725f 6263 6b5f 6469 6164 325b 305d  per_bck_diad2[0]
-00017400: 2c61 7831 5f79 6d61 782d 6178 315f 796d  ,ax1_ymax-ax1_ym
-00017410: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2020 2020 6c69 6e65 7769 6474 683d 312c      linewidth=1,
-00017440: 6564 6765 636f 6c6f 723d 276e 6f6e 6527  edgecolor='none'
-00017450: 2c66 6163 6563 6f6c 6f72 3d27 6379 616e  ,facecolor='cyan
-00017460: 272c 2061 6c70 6861 3d30 2e33 2c20 7a6f  ', alpha=0.3, zo
-00017470: 7264 6572 3d30 290a 2020 2020 2020 2020  rder=0).        
-00017480: 6178 6573 5b27 5827 5d2e 6164 645f 7061  axes['X'].add_pa
-00017490: 7463 6828 7265 6374 5f64 6961 6432 5f62  tch(rect_diad2_b
-000174a0: 3229 0a20 2020 2020 2020 2061 7865 735b  2).        axes[
-000174b0: 2758 275d 2e73 6574 5f78 6c69 6d28 5b61  'X'].set_xlim([a
-000174c0: 7831 5f78 6d69 6e2c 2061 7831 5f78 6d61  x1_xmin, ax1_xma
-000174d0: 785d 290a 2020 2020 2020 2020 6178 6573  x]).        axes
-000174e0: 5b27 5827 5d2e 7365 745f 796c 696d 285b  ['X'].set_ylim([
-000174f0: 6178 315f 796d 696e 2c20 6178 315f 796d  ax1_ymin, ax1_ym
-00017500: 6178 5d29 0a0a 2020 2020 2020 2020 6178  ax])..        ax
-00017510: 6573 5b27 5827 5d2e 7365 745f 796c 6162  es['X'].set_ylab
-00017520: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
-00017530: 2020 2020 2020 2020 6178 6573 5b27 5927          axes['Y'
-00017540: 5d2e 7365 745f 796c 6162 656c 2827 496e  ].set_ylabel('In
-00017550: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
-00017560: 2020 6178 6573 5b27 5927 5d2e 7365 745f    axes['Y'].set_
-00017570: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-00017580: 6572 2729 0a20 2020 2020 2020 2061 7865  er').        axe
-00017590: 735b 2758 275d 2e6c 6567 656e 6428 290a  s['X'].legend().
-000175a0: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
-000175b0: 2759 275d 2e73 6574 5f74 6974 6c65 2827  'Y'].set_title('
-000175c0: 6229 2042 6163 6b67 726f 756e 6420 7375  b) Background su
-000175d0: 6274 7261 6374 6564 2073 7065 6374 7261  btracted spectra
-000175e0: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
-000175f0: 2759 275d 2e70 6c6f 7428 785f 6469 6164  'Y'].plot(x_diad
-00017600: 322c 2079 5f63 6f72 725f 6469 6164 322c  2, y_corr_diad2,
-00017610: 2027 2d72 2729 0a20 2020 2020 2020 2068   '-r').        h
-00017620: 6569 6768 745f 703d 6e70 2e6d 6178 2844  eight_p=np.max(D
-00017630: 6961 645f 7368 6f72 745f 6469 6164 325b  iad_short_diad2[
-00017640: 3a2c 2031 5d29 2d6e 702e 6d69 6e28 4469  :, 1])-np.min(Di
-00017650: 6164 5f73 686f 7274 5f64 6961 6432 5b3a  ad_short_diad2[:
-00017660: 2c20 315d 290a 2020 2020 2020 2020 6178  , 1]).        ax
-00017670: 6573 5b27 5927 5d2e 7365 745f 796c 696d  es['Y'].set_ylim
-00017680: 285b 6e70 2e6d 696e 2879 5f63 6f72 725f  ([np.min(y_corr_
-00017690: 6469 6164 3229 2c20 312e 322a 6865 6967  diad2), 1.2*heig
-000176a0: 6874 5f70 205d 290a 2020 2020 2020 2020  ht_p ]).        
-000176b0: 6178 6573 5b27 5827 5d2e 7365 745f 786c  axes['X'].set_xl
-000176c0: 6162 656c 2827 5761 7665 6e75 6d62 6572  abel('Wavenumber
-000176d0: 2729 0a0a 0a0a 2020 2020 2020 2020 6178  ')....        ax
-000176e0: 6573 5b27 4127 5d2e 706c 6f74 2878 6461  es['A'].plot(xda
-000176f0: 742c 2079 6461 742c 2020 272e 6b27 2c20  t, ydat,  '.k', 
-00017700: 6c61 6265 6c3d 2762 636b 2e20 7375 622e  label='bck. sub.
-00017710: 2064 6174 6127 290a 2020 2020 2020 2020   data').        
-00017720: 6178 6573 5b27 4127 5d2e 706c 6f74 2820  axes['A'].plot( 
-00017730: 785f 6c69 6e20 2c79 5f62 6573 745f 6669  x_lin ,y_best_fi
-00017740: 742c 2027 2d67 272c 206c 696e 6577 6964  t, '-g', linewid
-00017750: 7468 3d31 2c20 6c61 6265 6c3d 2762 6573  th=1, label='bes
-00017760: 7420 6669 7427 290a 2020 2020 2020 2020  t fit').        
-00017770: 6178 6573 5b27 4127 5d2e 6c65 6765 6e64  axes['A'].legend
-00017780: 2829 0a20 2020 2020 2020 2061 7865 735b  ().        axes[
-00017790: 2741 275d 2e73 6574 5f79 6c61 6265 6c28  'A'].set_ylabel(
-000177a0: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
-000177b0: 2020 2020 2061 7865 735b 2741 275d 2e73       axes['A'].s
-000177c0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
-000177d0: 756d 6265 7227 290a 2020 2020 2020 2020  umber').        
-000177e0: 6178 6573 5b27 4127 5d2e 7365 745f 786c  axes['A'].set_xl
-000177f0: 696d 2861 7831 5f78 6c69 6d29 0a20 2020  im(ax1_xlim).   
-00017800: 2020 2020 2061 7865 735b 2741 275d 2e73       axes['A'].s
-00017810: 6574 5f74 6974 6c65 2827 6329 204f 7665  et_title('c) Ove
-00017820: 7261 6c6c 2042 6573 7420 4669 7427 290a  rall Best Fit').
-00017830: 0a20 2020 2023 2069 6e64 6976 6964 7561  .    # individua
-00017840: 6c20 6669 7473 0a20 2020 2020 2020 2061  l fits.        a
-00017850: 7865 735b 2742 275d 2e70 6c6f 7428 7864  xes['B'].plot(xd
-00017860: 6174 2c20 7964 6174 2c20 272e 6b27 290a  at, ydat, '.k').
-00017870: 0a20 2020 2020 2020 2023 2054 6869 7320  .        # This 
-00017880: 6973 2066 6f72 2069 6620 7468 6572 6520  is for if there 
-00017890: 6973 206d 6f72 6520 7468 616e 2031 2070  is more than 1 p
-000178a0: 6561 6b2c 2074 6869 7320 6973 2077 6865  eak, this is whe
-000178b0: 6e20 7765 2077 616e 7420 746f 2070 6c6f  n we want to plo
-000178c0: 7420 7468 6520 6265 7374 2066 6974 0a0a  t the best fit..
-000178d0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
-000178e0: 6561 6b73 3e31 3a0a 0a0a 2020 2020 2020  eaks>1:...      
-000178f0: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
-00017900: 706c 6f74 2878 5f6c 696e 2c20 636f 6d70  plot(x_lin, comp
-00017910: 6f6e 656e 7473 2e67 6574 2827 6c7a 325f  onents.get('lz2_
-00017920: 2729 2c20 272d 7227 2c20 6c69 6e65 7769  '), '-r', linewi
-00017930: 6474 683d 322c 206c 6162 656c 3d27 4842  dth=2, label='HB
-00017940: 3227 290a 0a20 2020 2020 2020 2061 7865  2')..        axe
-00017950: 735b 2742 275d 2e70 6c6f 7428 785f 6c69  s['B'].plot(x_li
-00017960: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
-00017970: 7428 276c 7a31 5f27 292c 2027 2d62 272c  t('lz1_'), '-b',
-00017980: 206c 696e 6577 6964 7468 3d32 2c20 6c61   linewidth=2, la
-00017990: 6265 6c3d 2744 6961 6432 2729 0a20 2020  bel='Diad2').   
-000179a0: 2020 2020 2069 6620 636f 6e66 6967 312e       if config1.
-000179b0: 6669 745f 6761 7573 7320 6973 206e 6f74  fit_gauss is not
-000179c0: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-000179d0: 2020 2020 6178 6573 5b27 4227 5d2e 706c      axes['B'].pl
-000179e0: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
-000179f0: 656e 7473 2e67 6574 2827 626b 675f 2729  ents.get('bkg_')
-00017a00: 2c20 272d 6d27 2c20 6c61 6265 6c3d 2747  , '-m', label='G
-00017a10: 6175 7373 6961 6e20 6263 6b27 2c20 6c69  aussian bck', li
-00017a20: 6e65 7769 6474 683d 3229 0a20 2020 2020  newidth=2).     
-00017a30: 2020 2023 6178 322e 706c 6f74 2878 6461     #ax2.plot(xda
-00017a40: 742c 2072 6573 756c 742e 6265 7374 5f66  t, result.best_f
-00017a50: 6974 2c20 272d 6727 2c20 6c61 6265 6c3d  it, '-g', label=
-00017a60: 2762 6573 7420 6669 7427 290a 2020 2020  'best fit').    
-00017a70: 2020 2020 6178 6573 5b27 4227 5d2e 6c65      axes['B'].le
-00017a80: 6765 6e64 2829 0a0a 2020 2020 2020 2020  gend()..        
-00017a90: 6669 7473 7061 6e3d 6d61 7828 795f 6265  fitspan=max(y_be
-00017aa0: 7374 5f66 6974 292d 6d69 6e28 795f 6265  st_fit)-min(y_be
-00017ab0: 7374 5f66 6974 290a 2020 2020 2020 2020  st_fit).        
-00017ac0: 6178 6573 5b27 4227 5d2e 7365 745f 796c  axes['B'].set_yl
-00017ad0: 696d 285b 6d69 6e28 795f 6265 7374 5f66  im([min(y_best_f
-00017ae0: 6974 292d 6669 7473 7061 6e2f 352c 206d  it)-fitspan/5, m
-00017af0: 6178 2879 5f62 6573 745f 6669 7429 2b66  ax(y_best_fit)+f
-00017b00: 6974 7370 616e 2f35 5d29 0a0a 2020 2020  itspan/5])..    
-00017b10: 2020 2020 6178 6573 5b27 4227 5d2e 7365      axes['B'].se
-00017b20: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
-00017b30: 6974 7927 290a 2020 2020 2020 2020 6178  ity').        ax
-00017b40: 6573 5b27 4227 5d2e 7365 745f 786c 6162  es['B'].set_xlab
-00017b50: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
-00017b60: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
-00017b70: 2742 275d 2e73 6574 5f78 6c69 6d28 6178  'B'].set_xlim(ax
-00017b80: 325f 786c 696d 290a 0a20 2020 2020 2020  2_xlim)..       
-00017b90: 2023 2044 6173 6865 6420 6c69 6e65 7320   # Dashed lines 
-00017ba0: 736f 206d 6174 6368 6573 2070 6172 7420  so matches part 
-00017bb0: 440a 0a20 2020 2020 2020 2061 7865 735b  D..        axes[
-00017bc0: 2742 275d 2e70 6c6f 7428 5b64 665f 6f75  'B'].plot([df_ou
-00017bd0: 745b 2744 6961 6432 5f56 6f69 6774 5f43  t['Diad2_Voigt_C
-00017be0: 656e 7427 5d2c 2064 665f 6f75 745b 2744  ent'], df_out['D
-00017bf0: 6961 6432 5f56 6f69 6774 5f43 656e 7427  iad2_Voigt_Cent'
-00017c00: 5d5d 2c20 5b6e 702e 6d69 6e28 7964 6174  ]], [np.min(ydat
-00017c10: 292c 206e 702e 6d61 7828 7964 6174 295d  ), np.max(ydat)]
-00017c20: 2c20 273a 6227 290a 0a0a 2020 2020 2020  , ':b')...      
-00017c30: 2020 6966 2066 6974 5f70 6561 6b73 3e3d    if fit_peaks>=
-00017c40: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00017c50: 2020 2061 7865 735b 2742 275d 2e70 6c6f     axes['B'].plo
-00017c60: 7428 5b64 665f 6f75 745b 2748 4232 5f43  t([df_out['HB2_C
-00017c70: 656e 7427 5d2c 2064 665f 6f75 745b 2748  ent'], df_out['H
-00017c80: 4232 5f43 656e 7427 5d5d 2c20 5b6e 702e  B2_Cent']], [np.
-00017c90: 6d69 6e28 7964 6174 292c 206e 702e 6d61  min(ydat), np.ma
-00017ca0: 7828 7964 6174 295d 2c20 273a 7227 290a  x(ydat)], ':r').
-00017cb0: 0a20 2020 2020 2020 2061 7865 735b 2742  .        axes['B
-00017cc0: 275d 2e73 6574 5f74 6974 6c65 2827 6329  '].set_title('c)
-00017cd0: 2046 6974 2043 6f6d 706f 6e65 6e74 7327   Fit Components'
-00017ce0: 290a 0a20 2020 2020 2020 2023 2042 6163  )..        # Bac
-00017cf0: 6b67 726f 756e 6420 6669 740a 0a20 2020  kground fit..   
-00017d00: 2020 2020 2023 2046 6972 7374 2c20 7365       # First, se
-00017d10: 7420 7570 2078 2061 6e64 2079 206c 696d  t up x and y lim
-00017d20: 6974 7320 6f6e 2061 7869 730a 0a20 2020  its on axis..   
-00017d30: 2020 2020 2069 6620 636f 6e66 6967 312e       if config1.
-00017d40: 785f 7261 6e67 655f 6261 7365 6c69 6e65  x_range_baseline
-00017d50: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00017d60: 2020 2020 2020 2020 2020 6178 635f 786d            axc_xm
-00017d70: 696e 3d64 665f 6f75 745b 2744 6961 6432  in=df_out['Diad2
-00017d80: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
-00017d90: 2d63 6f6e 6669 6731 2e78 5f72 616e 6765  -config1.x_range
-00017da0: 5f62 6173 656c 696e 650a 2020 2020 2020  _baseline.      
-00017db0: 2020 2020 2020 6178 635f 786d 6178 3d64        axc_xmax=d
-00017dc0: 665f 6f75 745b 2744 6961 6432 5f56 6f69  f_out['Diad2_Voi
-00017dd0: 6774 5f43 656e 7427 5d5b 305d 2b63 6f6e  gt_Cent'][0]+con
-00017de0: 6669 6731 2e78 5f72 616e 6765 5f62 6173  fig1.x_range_bas
-00017df0: 656c 696e 650a 2020 2020 2020 2020 656c  eline.        el
-00017e00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017e10: 6178 635f 786d 696e 3d63 6f6e 6669 6731  axc_xmin=config1
-00017e20: 2e6c 6f77 6572 5f62 636b 5f64 6961 6432  .lower_bck_diad2
-00017e30: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00017e40: 6178 635f 786d 6178 3d63 6f6e 6669 6731  axc_xmax=config1
-00017e50: 2e75 7070 6572 5f62 636b 5f64 6961 6432  .upper_bck_diad2
-00017e60: 5b31 5d0a 2020 2020 2020 2020 6178 635f  [1].        axc_
-00017e70: 796d 696e 3d6e 702e 6d69 6e28 4261 7365  ymin=np.min(Base
-00017e80: 6c69 6e65 5f64 6961 6432 5b3a 2c20 315d  line_diad2[:, 1]
-00017e90: 292d 636f 6e66 6967 312e 795f 7261 6e67  )-config1.y_rang
-00017ea0: 655f 6261 7365 6c69 6e65 2f33 0a20 2020  e_baseline/3.   
-00017eb0: 2020 2020 2061 7863 5f79 6d61 783d 6e70       axc_ymax=np
-00017ec0: 2e6d 6178 2842 6173 656c 696e 655f 6469  .max(Baseline_di
-00017ed0: 6164 325b 3a2c 2031 5d29 2b63 6f6e 6669  ad2[:, 1])+confi
-00017ee0: 6731 2e79 5f72 616e 6765 5f62 6173 656c  g1.y_range_basel
-00017ef0: 696e 650a 0a20 2020 2020 2020 2072 6563  ine..        rec
-00017f00: 745f 6469 6164 325f 6231 3d70 6174 6368  t_diad2_b1=patch
-00017f10: 6573 2e52 6563 7461 6e67 6c65 2828 636f  es.Rectangle((co
-00017f20: 6e66 6967 312e 6c6f 7765 725f 6263 6b5f  nfig1.lower_bck_
-00017f30: 6469 6164 325b 305d 2c61 7863 5f79 6d69  diad2[0],axc_ymi
-00017f40: 6e29 2c63 6f6e 6669 6731 2e6c 6f77 6572  n),config1.lower
-00017f50: 5f62 636b 5f64 6961 6432 5b31 5d2d 636f  _bck_diad2[1]-co
-00017f60: 6e66 6967 312e 6c6f 7765 725f 6263 6b5f  nfig1.lower_bck_
-00017f70: 6469 6164 325b 305d 2c61 7863 5f79 6d61  diad2[0],axc_yma
-00017f80: 782d 6178 635f 796d 696e 2c0a 2020 2020  x-axc_ymin,.    
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00017fb0: 7769 6474 683d 312c 6564 6765 636f 6c6f  width=1,edgecolo
-00017fc0: 723d 276e 6f6e 6527 2c66 6163 6563 6f6c  r='none',facecol
-00017fd0: 6f72 3d27 6379 616e 272c 206c 6162 656c  or='cyan', label
-00017fe0: 3d27 6263 6b27 2c20 616c 7068 613d 302e  ='bck', alpha=0.
-00017ff0: 332c 207a 6f72 6465 723d 3029 0a0a 0a0a  3, zorder=0)....
-00018000: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
-00018010: 5d2e 7365 745f 7469 746c 6528 2764 2920  ].set_title('d) 
-00018020: 5065 616b 7320 6f76 6572 6c61 696e 206f  Peaks overlain o
-00018030: 6e20 6461 7461 2062 6566 6f72 6520 7375  n data before su
-00018040: 6274 7261 6374 696f 6e27 290a 2020 2020  btraction').    
-00018050: 2020 2020 6178 6573 5b27 4327 5d2e 706c      axes['C'].pl
-00018060: 6f74 2844 6961 645f 7368 6f72 745f 6469  ot(Diad_short_di
-00018070: 6164 325b 3a2c 2030 5d2c 2044 6961 645f  ad2[:, 0], Diad_
-00018080: 7368 6f72 745f 6469 6164 325b 3a2c 2031  short_diad2[:, 1
-00018090: 5d2c 2027 2e72 272c 206c 6162 656c 3d27  ], '.r', label='
-000180a0: 6461 7461 2729 0a20 2020 2020 2020 2061  data').        a
-000180b0: 7865 735b 2743 275d 2e70 6c6f 7428 4261  xes['C'].plot(Ba
-000180c0: 7365 6c69 6e65 5f64 6961 6432 5b3a 2c20  seline_diad2[:, 
-000180d0: 305d 2c20 4261 7365 6c69 6e65 5f64 6961  0], Baseline_dia
-000180e0: 6432 5b3a 2c20 315d 2c20 272e 6227 2c20  d2[:, 1], '.b', 
-000180f0: 6c61 6265 6c3d 2762 636b 2729 0a20 2020  label='bck').   
-00018100: 2020 2020 2061 7865 735b 2743 275d 2e70       axes['C'].p
-00018110: 6c6f 7428 4469 6164 5f73 686f 7274 5f64  lot(Diad_short_d
-00018120: 6961 6432 5b3a 2c20 305d 2c20 5079 5f62  iad2[:, 0], Py_b
-00018130: 6173 655f 6469 6164 322c 2027 2d6b 272c  ase_diad2, '-k',
-00018140: 206c 6162 656c 3d27 506f 6c79 2062 636b   label='Poly bck
-00018150: 2066 6974 2729 0a0a 0a20 2020 2020 2020   fit')...       
-00018160: 2061 7865 735b 2743 275d 2e73 6574 5f79   axes['C'].set_y
-00018170: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-00018180: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
-00018190: 2743 275d 2e73 6574 5f78 6c61 6265 6c28  'C'].set_xlabel(
-000181a0: 2757 6176 656e 756d 6265 7227 290a 0a0a  'Wavenumber')...
-000181b0: 2020 2020 2020 2020 6966 2063 6f6e 6669          if confi
-000181c0: 6731 2e66 6974 5f67 6175 7373 2069 7320  g1.fit_gauss is 
-000181d0: 6e6f 7420 4661 6c73 653a 0a0a 2020 2020  not False:..    
-000181e0: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
-000181f0: 5d2e 706c 6f74 2878 5f6c 696e 2c20 636f  ].plot(x_lin, co
-00018200: 6d70 6f6e 656e 7473 2e67 6574 2827 626b  mponents.get('bk
-00018210: 675f 2729 2b79 6261 7365 5f78 6c69 6e2c  g_')+ybase_xlin,
-00018220: 2027 2d6d 272c 206c 6162 656c 3d27 4761   '-m', label='Ga
-00018230: 7573 7369 616e 2062 636b 272c 206c 696e  ussian bck', lin
-00018240: 6577 6964 7468 3d32 290a 0a20 2020 2020  ewidth=2)..     
-00018250: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
-00018260: 7428 2078 5f6c 696e 202c 795f 6265 7374  t( x_lin ,y_best
-00018270: 5f66 6974 2b79 6261 7365 5f78 6c69 6e2c  _fit+ybase_xlin,
-00018280: 2027 2d67 272c 206c 696e 6577 6964 7468   '-g', linewidth
-00018290: 3d32 2c20 6c61 6265 6c3d 2742 6573 7420  =2, label='Best 
-000182a0: 4669 7427 290a 2020 2020 2020 2020 6178  Fit').        ax
-000182b0: 6573 5b27 4327 5d2e 706c 6f74 2878 5f6c  es['C'].plot(x_l
-000182c0: 696e 2c20 636f 6d70 6f6e 656e 7473 2e67  in, components.g
-000182d0: 6574 2827 6c7a 315f 2729 2b79 6261 7365  et('lz1_')+ybase
-000182e0: 5f78 6c69 6e2c 2027 2d62 272c 206c 6162  _xlin, '-b', lab
-000182f0: 656c 3d27 4469 6164 3227 2c20 6c69 6e65  el='Diad2', line
-00018300: 7769 6474 683d 3129 0a20 2020 2020 2020  width=1).       
-00018310: 2069 6620 6669 745f 7065 616b 733e 313a   if fit_peaks>1:
-00018320: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-00018330: 735b 2743 275d 2e70 6c6f 7428 785f 6c69  s['C'].plot(x_li
-00018340: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
-00018350: 7428 276c 7a32 5f27 292b 7962 6173 655f  t('lz2_')+ybase_
-00018360: 786c 696e 2c20 272d 7227 2c20 6c61 6265  xlin, '-r', labe
-00018370: 6c3d 2748 4232 272c 206c 696e 6577 6964  l='HB2', linewid
-00018380: 7468 3d31 290a 2020 2020 2020 2020 6966  th=1).        if
-00018390: 2066 6974 5f70 6561 6b73 3e32 3a0a 2020   fit_peaks>2:.  
-000183a0: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
-000183b0: 4327 5d2e 706c 6f74 2878 5f6c 696e 2c20  C'].plot(x_lin, 
-000183c0: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
-000183d0: 6c7a 335f 2729 2b79 6261 7365 5f78 6c69  lz3_')+ybase_xli
-000183e0: 6e2c 2027 2d63 272c 206c 6162 656c 3d27  n, '-c', label='
-000183f0: 4331 3327 2c20 6c69 6e65 7769 6474 683d  C13', linewidth=
-00018400: 3129 0a0a 2020 2020 2020 2020 6178 6573  1)..        axes
-00018410: 5b27 4327 5d2e 6c65 6765 6e64 286e 636f  ['C'].legend(nco
-00018420: 6c3d 332c 206c 6f63 3d27 6c6f 7765 7220  l=3, loc='lower 
-00018430: 6365 6e74 6572 2729 0a0a 0a0a 2020 2020  center')....    
-00018440: 2020 2020 6178 6573 5b27 4327 5d2e 7365      axes['C'].se
-00018450: 745f 786c 696d 285b 6178 635f 786d 696e  t_xlim([axc_xmin
-00018460: 2c20 6178 635f 786d 6178 5d29 0a20 2020  , axc_xmax]).   
-00018470: 2020 2020 2061 7865 735b 2743 275d 2e73       axes['C'].s
-00018480: 6574 5f79 6c69 6d28 5b61 7863 5f79 6d69  et_ylim([axc_ymi
-00018490: 6e2c 2061 7863 5f79 6d61 785d 290a 2020  n, axc_ymax]).  
-000184a0: 2020 2020 2020 2361 7865 735b 2743 275d        #axes['C']
-000184b0: 2e70 6c6f 7428 4469 6164 5f73 686f 7274  .plot(Diad_short
-000184c0: 5b3a 2c20 305d 2c20 4469 6164 5f73 686f  [:, 0], Diad_sho
-000184d0: 7274 5b3a 2c20 315d 2c20 2722 7227 2c20  rt[:, 1], '"r', 
-000184e0: 6c61 6265 6c3d 2744 6174 6127 290a 0a0a  label='Data')...
-000184f0: 2020 2020 2020 2020 2320 5265 7369 6475          # Residu
-00018500: 616c 206f 6e20 706c 6f74 2044 0a20 2020  al on plot D.   
-00018510: 2020 2020 2061 7865 735b 2744 275d 2e73       axes['D'].s
-00018520: 6574 5f74 6974 6c65 2827 6629 2052 6573  et_title('f) Res
-00018530: 6964 7561 6c73 2729 0a20 2020 2020 2020  iduals').       
-00018540: 2061 7865 735b 2744 275d 2e70 6c6f 7428   axes['D'].plot(
-00018550: 5b64 665f 6f75 745b 2744 6961 6432 5f56  [df_out['Diad2_V
-00018560: 6f69 6774 5f43 656e 7427 5d2c 2064 665f  oigt_Cent'], df_
-00018570: 6f75 745b 2744 6961 6432 5f56 6f69 6774  out['Diad2_Voigt
-00018580: 5f43 656e 7427 5d5d 2c20 5b6e 702e 6d69  _Cent']], [np.mi
-00018590: 6e28 7265 7369 6475 616c 5f64 6961 645f  n(residual_diad_
-000185a0: 636f 6f72 6473 292c 206e 702e 6d61 7828  coords), np.max(
-000185b0: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-000185c0: 6f72 6473 295d 2c20 273a 6227 290a 2020  ords)], ':b').  
-000185d0: 2020 2020 2020 6966 2066 6974 5f70 6561        if fit_pea
-000185e0: 6b73 3e31 3a0a 2020 2020 2020 2020 2020  ks>1:.          
-000185f0: 2020 2020 2020 6178 6573 5b27 4427 5d2e        axes['D'].
-00018600: 706c 6f74 285b 6466 5f6f 7574 5b27 4842  plot([df_out['HB
-00018610: 325f 4365 6e74 275d 2c20 6466 5f6f 7574  2_Cent'], df_out
-00018620: 5b27 4842 325f 4365 6e74 275d 5d2c 205b  ['HB2_Cent']], [
-00018630: 6e70 2e6d 696e 2872 6573 6964 7561 6c5f  np.min(residual_
-00018640: 6469 6164 5f63 6f6f 7264 7329 2c20 6e70  diad_coords), np
-00018650: 2e6d 6178 2872 6573 6964 7561 6c5f 6469  .max(residual_di
-00018660: 6164 5f63 6f6f 7264 7329 5d2c 2027 3a72  ad_coords)], ':r
-00018670: 2729 0a0a 2020 2020 2020 2020 6178 6573  ')..        axes
-00018680: 5b27 4427 5d2e 706c 6f74 2878 6461 745f  ['D'].plot(xdat_
-00018690: 696e 7261 6e67 652c 2072 6573 6964 7561  inrange, residua
-000186a0: 6c5f 6469 6164 5f63 6f6f 7264 732c 2027  l_diad_coords, '
-000186b0: 6f6b 272c 206d 6663 3d27 6327 2029 0a20  ok', mfc='c' ). 
-000186c0: 2020 2020 2020 2061 7865 735b 2744 275d         axes['D']
-000186d0: 2e70 6c6f 7428 7864 6174 5f69 6e72 616e  .plot(xdat_inran
-000186e0: 6765 2c20 7265 7369 6475 616c 5f64 6961  ge, residual_dia
-000186f0: 645f 636f 6f72 6473 2c20 272d 6327 2029  d_coords, '-c' )
-00018700: 0a20 2020 2020 2020 2061 7865 735b 2744  .        axes['D
-00018710: 275d 2e73 6574 5f79 6c61 6265 6c28 2752  '].set_ylabel('R
-00018720: 6573 6964 7561 6c27 290a 2020 2020 2020  esidual').      
-00018730: 2020 6178 6573 5b27 4427 5d2e 7365 745f    axes['D'].set_
-00018740: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-00018750: 6572 2729 0a20 2020 2020 2020 2023 2061  er').        # a
-00018760: 7865 735b 2744 275d 2e73 6574 5f78 6c69  xes['D'].set_xli
-00018770: 6d28 6178 315f 786c 696d 290a 2020 2020  m(ax1_xlim).    
-00018780: 2020 2020 2320 6178 6573 5b27 4427 5d2e      # axes['D'].
-00018790: 7365 745f 786c 696d 2861 7832 5f78 6c69  set_xlim(ax2_xli
-000187a0: 6d29 0a20 2020 2020 2020 204c 6f63 616c  m).        Local
-000187b0: 5f52 6573 6964 7561 6c5f 6469 6164 323d  _Residual_diad2=
-000187c0: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
-000187d0: 6f72 6473 5b28 2878 6461 745f 696e 7261  ords[((xdat_inra
-000187e0: 6e67 653e 2864 665f 6f75 745b 2744 6961  nge>(df_out['Dia
-000187f0: 6432 5f56 6f69 6774 5f43 656e 7427 5d5b  d2_Voigt_Cent'][
-00018800: 305d 2d63 6f6e 6669 6731 2e78 5f72 616e  0]-config1.x_ran
-00018810: 6765 5f72 6573 6964 7561 6c29 290a 2020  ge_residual)).  
-00018820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018840: 2020 2020 2020 2020 2020 2020 2020 2628                &(
-00018850: 7864 6174 5f69 6e72 616e 6765 3c64 665f  xdat_inrange<df_
-00018860: 6f75 745b 2744 6961 6432 5f56 6f69 6774  out['Diad2_Voigt
-00018870: 5f43 656e 7427 5d5b 305d 2b63 6f6e 6669  _Cent'][0]+confi
-00018880: 6731 2e78 5f72 616e 6765 5f72 6573 6964  g1.x_range_resid
-00018890: 7561 6c29 295d 0a20 2020 2020 2020 2061  ual))].        a
-000188a0: 7865 735b 2744 275d 2e73 6574 5f78 6c69  xes['D'].set_xli
-000188b0: 6d28 5b64 665f 6f75 745b 2744 6961 6432  m([df_out['Diad2
-000188c0: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
-000188d0: 2d63 6f6e 6669 6731 2e78 5f72 616e 6765  -config1.x_range
-000188e0: 5f72 6573 6964 7561 6c2c 0a20 2020 2020  _residual,.     
-000188f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00018900: 665f 6f75 745b 2744 6961 6432 5f56 6f69  f_out['Diad2_Voi
-00018910: 6774 5f43 656e 7427 5d5b 305d 2b63 6f6e  gt_Cent'][0]+con
-00018920: 6669 6731 2e78 5f72 616e 6765 5f72 6573  fig1.x_range_res
-00018930: 6964 7561 6c5d 290a 2020 2020 2020 2020  idual]).        
-00018940: 2361 7835 2e70 6c6f 7428 5b63 656e 745f  #ax5.plot([cent_
-00018950: 3131 3137 2c20 6365 6e74 5f31 3131 3720  1117, cent_1117 
-00018960: 5d2c 205b 6e70 2e6d 696e 284c 6f63 616c  ], [np.min(Local
-00018970: 5f52 6573 6964 7561 6c5f 3131 3137 292d  _Residual_1117)-
-00018980: 3130 2c20 6e70 2e6d 6178 284c 6f63 616c  10, np.max(Local
-00018990: 5f52 6573 6964 7561 6c5f 3131 3137 292b  _Residual_1117)+
-000189a0: 3130 5d2c 2027 3a6b 2729 0a20 2020 2020  10], ':k').     
-000189b0: 2020 2061 7865 735b 2744 275d 2e73 6574     axes['D'].set
-000189c0: 5f79 6c69 6d28 5b6e 702e 6d69 6e28 4c6f  _ylim([np.min(Lo
-000189d0: 6361 6c5f 5265 7369 6475 616c 5f64 6961  cal_Residual_dia
-000189e0: 6432 292d 3130 2c20 6e70 2e6d 6178 284c  d2)-10, np.max(L
-000189f0: 6f63 616c 5f52 6573 6964 7561 6c5f 6469  ocal_Residual_di
-00018a00: 6164 3229 2b31 305d 290a 0a0a 0a0a 0a20  ad2)+10])...... 
-00018a10: 2020 2020 2020 2023 204f 7665 7261 6c20         # Overal 
-00018a20: 7370 6563 7472 610a 2020 2020 2020 2020  spectra.        
-00018a30: 6178 6573 5b27 4527 5d2e 7365 745f 7469  axes['E'].set_ti
-00018a40: 746c 6528 2767 2920 5375 6d6d 6172 7920  tle('g) Summary 
-00018a50: 706c 6f74 206f 6620 7261 7720 7370 6563  plot of raw spec
-00018a60: 7472 6120 666f 7220 6669 6c65 203d 2027  tra for file = '
-00018a70: 202b 2066 696c 656e 616d 6529 0a20 2020   + filename).   
-00018a80: 2020 2020 2061 7865 735b 2745 275d 2e70       axes['E'].p
-00018a90: 6c6f 7428 5370 6563 7472 615b 3a2c 2030  lot(Spectra[:, 0
-00018aa0: 5d2c 2053 7065 6374 7261 5b3a 2c20 315d  ], Spectra[:, 1]
-00018ab0: 2c20 272d 7227 290a 2020 2020 2020 2020  , '-r').        
-00018ac0: 6178 6573 5b27 4527 5d2e 7365 745f 796c  axes['E'].set_yl
-00018ad0: 6162 656c 2827 496e 7465 6e73 6974 7927  abel('Intensity'
-00018ae0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-00018af0: 4527 5d2e 7365 745f 786c 6162 656c 2827  E'].set_xlabel('
-00018b00: 5761 7665 6e75 6d62 6572 2729 0a0a 0a0a  Wavenumber')....
-00018b10: 0a20 2020 2020 2020 2070 6174 6833 3d70  .        path3=p
-00018b20: 6174 682b 272f 272b 2764 6961 645f 6669  ath+'/'+'diad_fi
-00018b30: 745f 696d 6167 6573 270a 2020 2020 2020  t_images'.      
-00018b40: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00018b50: 7374 7328 7061 7468 3329 3a0a 2020 2020  sts(path3):.    
-00018b60: 2020 2020 2020 2020 6f75 743d 2770 6174          out='pat
-00018b70: 6820 6578 6973 7473 270a 2020 2020 2020  h exists'.      
-00018b80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018b90: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-00018ba0: 7061 7468 2b27 2f27 2b20 2764 6961 645f  path+'/'+ 'diad_
-00018bb0: 6669 745f 696d 6167 6573 272c 2065 7869  fit_images', exi
-00018bc0: 7374 5f6f 6b3d 4661 6c73 6529 0a0a 2020  st_ok=False)..  
-00018bd0: 2020 2020 2020 6669 672e 7469 6768 745f        fig.tight_
-00018be0: 6c61 796f 7574 2829 0a0a 2020 2020 2020  layout()..      
-00018bf0: 2020 6669 6c65 3d66 696c 656e 616d 652e    file=filename.
-00018c00: 7273 706c 6974 2827 2e74 7874 272c 2031  rsplit('.txt', 1
-00018c10: 295b 305d 0a20 2020 2020 2020 2066 6967  )[0].        fig
-00018c20: 2e73 6176 6566 6967 2870 6174 6833 2b27  .savefig(path3+'
-00018c30: 2f27 2b27 6469 6164 325f 4669 745f 7b7d  /'+'diad2_Fit_{}
-00018c40: 2e70 6e67 272e 666f 726d 6174 2866 696c  .png'.format(fil
-00018c50: 6529 2c20 6470 693d 636f 6e66 6967 312e  e), dpi=config1.
-00018c60: 6470 6929 0a0a 0a20 2020 2069 6620 636c  dpi)...    if cl
-00018c70: 6f73 655f 6669 6775 7265 2069 7320 5472  ose_figure is Tr
-00018c80: 7565 3a0a 2020 2020 2020 2020 706c 742e  ue:.        plt.
-00018c90: 636c 6f73 6528 6669 6729 0a0a 0a0a 2020  close(fig)....  
-00018ca0: 2020 6966 2020 636f 6e66 6967 312e 7265    if  config1.re
-00018cb0: 7475 726e 5f6f 7468 6572 5f70 6172 616d  turn_other_param
-00018cc0: 7320 6973 2046 616c 7365 3a0a 2020 2020  s is False:.    
-00018cd0: 2020 2020 7265 7475 726e 2064 665f 6f75      return df_ou
-00018ce0: 740a 2020 2020 656c 7365 3a0a 2020 2020  t.    else:.    
-00018cf0: 2020 2020 7265 7475 726e 2064 665f 6f75      return df_ou
-00018d00: 742c 2072 6573 756c 742c 2079 5f62 6573  t, result, y_bes
-00018d10: 745f 6669 742c 2078 5f6c 696e 0a0a 0a0a  t_fit, x_lin....
-00018d20: 0a64 6566 2066 6974 5f64 6961 645f 315f  .def fit_diad_1_
-00018d30: 775f 6263 6b28 2a2c 2063 6f6e 6669 6731  w_bck(*, config1
-00018d40: 3a20 6469 6164 315f 6669 745f 636f 6e66  : diad1_fit_conf
-00018d50: 6967 3d64 6961 6431 5f66 6974 5f63 6f6e  ig=diad1_fit_con
-00018d60: 6669 6728 292c 2063 6f6e 6669 6732 3a20  fig(), config2: 
-00018d70: 6469 6164 5f69 645f 636f 6e66 6967 3d64  diad_id_config=d
-00018d80: 6961 645f 6964 5f63 6f6e 6669 6728 292c  iad_id_config(),
-00018d90: 0a20 2020 2070 6174 683d 4e6f 6e65 2c20  .    path=None, 
-00018da0: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2066  filename=None, f
-00018db0: 696c 6574 7970 653d 4e6f 6e65 2c20 2070  iletype=None,  p
-00018dc0: 6c6f 745f 6669 6775 7265 3d54 7275 652c  lot_figure=True,
-00018dd0: 2063 6c6f 7365 5f66 6967 7572 653d 5472   close_figure=Tr
-00018de0: 7565 2c20 4469 6164 5f70 6f73 3d4e 6f6e  ue, Diad_pos=Non
-00018df0: 652c 2048 425f 706f 733d 4e6f 6e65 293a  e, HB_pos=None):
-00018e00: 0a20 2020 2022 2222 2054 6869 7320 6675  .    """ This fu
-00018e10: 6e63 7469 6f6e 2066 6974 7320 7468 6520  nction fits the 
-00018e20: 6261 636b 6772 6f75 6e64 2028 7573 696e  background (usin
-00018e30: 6720 7468 6520 6675 6e63 7469 6f6e 2072  g the function r
-00018e40: 656d 6f76 655f 6469 6164 5f62 6173 656c  emove_diad_basel
-00018e50: 696e 6529 2061 6e64 2074 6865 6e20 6669  ine) and then fi
-00018e60: 7473 2074 6865 2070 6561 6b73 2075 7369  ts the peaks usi
-00018e70: 6e67 2066 6974 5f67 6175 7373 6961 6e5f  ng fit_gaussian_
-00018e80: 766f 6967 745f 6765 6e65 7269 635f 6469  voigt_generic_di
-00018e90: 6164 2829 0a20 2020 2049 7420 7468 656e  ad().    It then
-00018ea0: 2063 6865 636b 7320 6966 2061 6e79 2070   checks if any p
-00018eb0: 6172 616d 6574 6572 7320 6172 6520 7269  arameters are ri
-00018ec0: 6768 7420 6174 2074 6865 2070 6572 6d69  ght at the permi
-00018ed0: 7474 6564 2065 6467 6520 286d 6561 6e69  tted edge (meani
-00018ee0: 6e67 2066 6974 7469 6e67 2064 6964 6e74  ng fitting didnt
-00018ef0: 2063 6f6e 7665 7267 6529 2c20 616e 6420   converge), and 
-00018f00: 7472 6965 7320 6669 7474 696e 6720 6966  tries fitting if
-00018f10: 2073 6f2e 2054 6865 6e20 6974 206d 616b   so. Then it mak
-00018f20: 6573 2061 2070 6c6f 740a 2020 2020 6f66  es a plot.    of
-00018f30: 2074 6865 2076 6172 696f 7573 2070 6172   the various par
-00018f40: 7473 206f 6620 7468 6520 6669 7474 696e  ts of the fittin
-00018f50: 6720 7072 6f63 6564 7572 652c 2061 6e64  g procedure, and
-00018f60: 2072 6574 7572 6e73 2061 2064 6174 6166   returns a dataf
-00018f70: 7261 6d65 206f 6620 7468 6520 6669 7420  rame of the fit 
-00018f80: 7061 7261 6d65 7465 7273 2e0a 0a0a 2020  parameters....  
-00018f90: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00018fa0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020   -----------.   
-00018fb0: 2063 6f6e 6669 6731 3a20 6279 2064 6566   config1: by def
-00018fc0: 6175 6c74 2075 7365 7320 6469 6164 315f  ault uses diad1_
-00018fd0: 6669 745f 636f 6e66 6967 2829 2e20 4f70  fit_config(). Op
-00018fe0: 7469 6f6e 7320 746f 2065 6469 7420 7769  tions to edit wi
-00018ff0: 7468 696e 2074 6869 733a 0a0a 2020 2020  thin this:..    
-00019000: 2020 2020 4e5f 706f 6c79 5f62 636b 5f64      N_poly_bck_d
-00019010: 6961 6431 3a20 696e 740a 2020 2020 2020  iad1: int.      
-00019020: 2020 2020 2020 6465 6772 6565 206f 6620        degree of 
-00019030: 706f 6c79 6e6f 6d69 616c 2074 6f20 6669  polynomial to fi
-00019040: 7420 746f 2074 6865 2062 6163 6b67 726f  t to the backgro
-00019050: 756e 642e 0a0a 2020 2020 2020 2020 6d6f  und...        mo
-00019060: 6465 6c5f 6e61 6d65 3a20 7374 720a 2020  del_name: str.  
-00019070: 2020 2020 2020 2020 2020 5768 6174 2074            What t
-00019080: 7970 6520 6f66 2070 6561 6b20 796f 7520  ype of peak you 
-00019090: 7761 6e74 2074 6f20 6669 742c 2065 6974  want to fit, eit
-000190a0: 6865 7220 2750 7365 7564 6f56 6f69 6774  her 'PseudoVoigt
-000190b0: 4d6f 6465 6c27 206f 7220 2756 6f69 6774  Model' or 'Voigt
-000190c0: 4d6f 6465 6c27 0a0a 2020 2020 2020 2020  Model'..        
-000190d0: 6669 745f 7065 616b 733a 2069 6e74 0a20  fit_peaks: int. 
-000190e0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-000190f0: 7220 6f66 2070 6561 6b73 2074 6f20 6669  r of peaks to fi
-00019100: 742e 2031 203d 206a 7573 7420 6469 6164  t. 1 = just diad
-00019110: 2c20 323d 2064 6961 640a 0a20 2020 2020  , 2= diad..     
-00019120: 2020 206c 6f77 6572 5f62 636b 5f64 6961     lower_bck_dia
-00019130: 6431 2c20 7570 7065 725f 6263 6b5f 6469  d1, upper_bck_di
-00019140: 6164 313a 205b 666c 6f61 742c 2066 6c6f  ad1: [float, flo
-00019150: 6174 5d0a 2020 2020 2020 2020 2020 2020  at].            
-00019160: 6261 636b 6772 6f75 6e64 2070 6f73 6974  background posit
-00019170: 696f 6e20 746f 206c 6566 7420 616e 6420  ion to left and 
-00019180: 7269 6768 7420 6f66 206f 7665 7261 6c20  right of overal 
-00019190: 6469 6164 2072 6567 696f 6e20 2869 6e63  diad region (inc
-000191a0: 2064 6961 642b 2d48 422b 2d43 3133 290a   diad+-HB+-C13).
-000191b0: 0a20 2020 2020 2020 2066 6974 5f67 6175  .        fit_gau
-000191c0: 7373 3a20 626f 6f6c 0a20 2020 2020 2020  ss: bool.       
-000191d0: 2020 2020 2049 6620 5472 7565 2c20 6669       If True, fi
-000191e0: 7473 2061 2067 6175 7373 6961 6e20 7065  ts a gaussian pe
-000191f0: 616b 0a0a 2020 2020 2020 2020 6761 7573  ak..        gaus
-00019200: 735f 616d 703a 2020 666c 6f61 740a 2020  s_amp:  float.  
-00019210: 2020 2020 2020 2020 2020 4573 7469 6d61            Estima
-00019220: 7465 206f 6620 616d 706c 6974 7564 6520  te of amplitude 
-00019230: 6f66 2047 6175 7373 6961 6e20 7065 616b  of Gaussian peak
-00019240: 2028 7765 2066 696e 6420 6120 676f 6f64   (we find a good
-00019250: 2066 6972 7374 2067 7565 7373 2069 7320   first guess is 
-00019260: 322a 2074 6865 2061 6273 6f6c 7574 6520  2* the absolute 
-00019270: 7072 6f6d 696e 656e 6365 206f 6620 7468  prominence of th
-00019280: 6520 4842 2070 6561 6b29 0a0a 2020 2020  e HB peak)..    
-00019290: 2020 2020 6469 6164 5f73 6967 6d61 2c20      diad_sigma, 
-000192a0: 4842 5f73 6967 6d61 3a20 666c 6f61 740a  HB_sigma: float.
-000192b0: 2020 2020 2020 2020 2020 2020 4573 7469              Esti
-000192c0: 6d61 7465 206f 6620 7468 6520 616d 706c  mate of the ampl
-000192d0: 6974 7564 6520 6f66 2074 6865 2064 6961  itude of the dia
-000192e0: 6420 7065 616b 2f48 4220 7065 616b 0a0a  d peak/HB peak..
-000192f0: 2020 2020 2020 2020 6469 6164 5f70 726f          diad_pro
-00019300: 6d2c 2048 425f 7072 6f6d 2c20 4331 335f  m, HB_prom, C13_
-00019310: 7072 6f6d 3a20 666c 6f61 740a 2020 2020  prom: float.    
-00019320: 2020 2020 2020 2020 4573 7469 6d61 7465          Estimate
-00019330: 206f 6620 7072 6f6d 696e 656e 6365 206f   of prominence o
-00019340: 6620 7065 616b 2e20 5573 6564 2061 6c6f  f peak. Used alo
-00019350: 6e67 7369 6465 2073 6967 6d61 2074 6f20  ngside sigma to 
-00019360: 6573 7469 6d61 7465 2074 6865 2061 6d70  estimate the amp
-00019370: 6c69 7475 6465 206f 6620 7468 6520 6469  litude of the di
-00019380: 6164 2074 6f20 6169 6420 7065 616b 2066  ad to aid peak f
-00019390: 6974 7469 6e67 2e0a 0a0a 2020 2020 2020  itting....      
-000193a0: 2020 6469 6164 5f73 6967 6d61 5f6d 696e    diad_sigma_min
-000193b0: 5f61 6c6c 6f77 616e 6365 2c20 6469 6164  _allowance, diad
-000193c0: 5f73 6967 6d61 5f6d 696e 5f61 6c6c 6f77  _sigma_min_allow
-000193d0: 616e 6365 3a20 666c 6f61 740a 2020 2020  ance: float.    
-000193e0: 2020 2020 4842 5f73 6967 6d61 5f6d 696e      HB_sigma_min
-000193f0: 5f61 6c6c 6f77 616e 6365 2c20 4842 5f73  _allowance, HB_s
-00019400: 6967 6d61 5f6d 6178 5f61 6c6c 6f77 616e  igma_max_allowan
-00019410: 6365 3a20 666c 6f61 740a 2020 2020 2020  ce: float.      
-00019420: 2020 2020 2020 4661 6374 6f72 2074 6861        Factor tha
-00019430: 7420 7369 676d 6120 6f66 2070 6561 6b20  t sigma of peak 
-00019440: 6973 2061 6c6c 6f77 6564 2074 6f20 6465  is allowed to de
-00019450: 7669 6174 6520 6672 6f6d 2031 7374 2067  viate from 1st g
-00019460: 7565 7373 2028 652e 672e 206d 6178 3d32  uess (e.g. max=2
-00019470: 2c20 322a 2067 7565 7373 2c20 6d69 6e3d  , 2* guess, min=
-00019480: 302e 352c 2030 2e35 202a 2067 7565 7373  0.5, 0.5 * guess
-00019490: 292e 0a0a 2020 2020 2020 2020 6469 6164  )...        diad
-000194a0: 5f61 6d70 5f6d 696e 5f61 6c6c 6f77 616e  _amp_min_allowan
-000194b0: 6365 2c20 6469 6164 5f61 6d70 5f6d 696e  ce, diad_amp_min
-000194c0: 5f61 6c6c 6f77 616e 6365 3a20 666c 6f61  _allowance: floa
-000194d0: 740a 2020 2020 2020 2020 4842 5f61 6d70  t.        HB_amp
-000194e0: 5f6d 696e 5f61 6c6c 6f77 616e 6365 2c20  _min_allowance, 
-000194f0: 4842 5f61 6d70 5f6d 6178 5f61 6c6c 6f77  HB_amp_max_allow
-00019500: 616e 6365 3a20 666c 6f61 740a 2020 2020  ance: float.    
-00019510: 2020 2020 2020 2020 4661 6374 6f72 2074          Factor t
-00019520: 6861 7420 7468 6520 616d 706c 6974 7564  hat the amplitud
-00019530: 6520 6f66 2070 6561 6b20 6973 2061 6c6c  e of peak is all
-00019540: 6f77 6564 2074 6f20 6465 7669 6174 6520  owed to deviate 
-00019550: 6672 6f6d 2031 7374 2067 7565 7373 2028  from 1st guess (
-00019560: 652e 672e 206d 6178 3d32 2c20 322a 2067  e.g. max=2, 2* g
-00019570: 7565 7373 2c20 6d69 6e3d 302e 352c 2030  uess, min=0.5, 0
-00019580: 2e35 202a 2067 7565 7373 292e 0a0a 0a20  .5 * guess).... 
-00019590: 2020 2020 2020 2078 5f72 616e 6765 5f62         x_range_b
-000195a0: 6173 656c 696e 653a 2066 6c6f 6174 206f  aseline: float o
-000195b0: 7220 4e6f 6e65 0a20 2020 2020 2020 2020  r None.         
-000195c0: 2020 2053 6574 7320 7820 6c69 6d69 7420     Sets x limit 
-000195d0: 6f66 2070 6c6f 7420 7368 6f77 696e 6720  of plot showing 
-000195e0: 6261 7365 6c69 6e65 7320 746f 2064 6961  baselines to dia
-000195f0: 6420 6365 6e74 6572 202d 2078 5f72 616e  d center - x_ran
-00019600: 6765 5f62 6173 656c 696e 652c 2061 6e64  ge_baseline, and
-00019610: 202b 785f 7261 6e67 655f 6261 7365 6c69   +x_range_baseli
-00019620: 6e65 0a0a 2020 2020 2020 2020 795f 7261  ne..        y_ra
-00019630: 6e67 655f 6261 7365 6c69 6e65 3a20 666c  nge_baseline: fl
-00019640: 6f61 7420 6f72 204e 6f6e 650a 2020 2020  oat or None.    
-00019650: 2020 2020 2020 2020 5365 7473 2079 2061          Sets y a
-00019660: 7869 7320 6f66 2062 6173 656c 696e 6520  xis of baseline 
-00019670: 706c 6f74 2061 7320 6d69 6e69 6d75 6d20  plot as minimum 
-00019680: 6261 6c75 6520 6f66 2062 6173 656c 696e  balue of baselin
-00019690: 6520 7265 6769 6f6e 202d 795f 7261 6e67  e region -y_rang
-000196a0: 655f 6261 7365 6c69 6e65 2f33 2c0a 2020  e_baseline/3,.  
-000196b0: 2020 2020 2020 2020 2020 616e 6420 7468            and th
-000196c0: 6520 7570 7065 7220 7661 6c75 6520 6173  e upper value as
-000196d0: 206d 6178 2076 616c 7565 206f 6620 6261   max value of ba
-000196e0: 7365 6c69 6e65 2072 6567 696f 6e20 2b20  seline region + 
-000196f0: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
-00019700: 0a20 2020 2020 2020 2020 2020 2042 6173  .            Bas
-00019710: 656c 696e 6520 7265 6769 6f6e 2069 7320  eline region is 
-00019720: 7468 6520 6465 6669 6e65 6420 7265 6769  the defined regi
-00019730: 6f6e 206f 6620 6261 7365 6c69 6e65 206d  on of baseline m
-00019740: 696e 7573 2061 6e79 2070 6f69 6e74 7320  inus any points 
-00019750: 6f75 7473 6964 6520 7468 6520 7369 676d  outside the sigm
-00019760: 6120 6669 6c74 6572 0a0a 2020 2020 2020  a filter..      
-00019770: 2020 785f 7261 6e67 655f 7265 7369 6475    x_range_residu
-00019780: 616c 3a20 666c 6f61 740a 2020 2020 2020  al: float.      
-00019790: 2020 2020 2020 4469 7374 616e 6365 2065        Distance e
-000197a0: 6974 6865 7220 7369 6465 206f 6620 6469  ither side of di
-000197b0: 6164 2063 656e 7465 7220 746f 2073 686f  ad center to sho
-000197c0: 7720 6f6e 2072 6573 6964 7561 6c20 706c  w on residual pl
-000197d0: 6f74 2e0a 0a20 2020 2020 2020 2064 7069  ot...        dpi
-000197e0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
-000197f0: 2020 2020 6470 6920 746f 2073 6176 6520      dpi to save 
-00019800: 6669 6775 7265 2061 7420 6f66 206f 7665  figure at of ove
-00019810: 7261 6c6c 2066 6974 730a 0a20 2020 2063  rall fits..    c
-00019820: 6f6e 6669 6732 3a20 6469 6164 5f69 645f  onfig2: diad_id_
-00019830: 636f 6e66 6967 2829 2066 696c 652e 204f  config() file. O
-00019840: 6e6c 7920 7468 696e 6720 6974 2075 7365  nly thing it use
-00019850: 7320 6672 6f6d 2074 6869 7320 6973 2061  s from this is a
-00019860: 6e79 2065 7863 6c75 6465 6420 7261 6e67  ny excluded rang
-00019870: 6573 0a0a 2020 2020 7061 7468 3a20 7374  es..    path: st
-00019880: 720a 2020 2020 2020 2020 466f 6c64 6572  r.        Folder
-00019890: 2075 7365 7220 7769 7368 6573 2074 6f20   user wishes to 
-000198a0: 7265 6164 2064 6174 6120 6672 6f6d 0a0a  read data from..
-000198b0: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
-000198c0: 720a 2020 2020 2020 2020 5370 6563 6966  r.        Specif
-000198d0: 6963 206e 616d 6520 6f66 2066 696c 6520  ic name of file 
-000198e0: 6265 696e 6720 7573 6564 2e0a 0a20 2020  being used...   
-000198f0: 2066 696c 6574 7970 653a 2073 7472 0a20   filetype: str. 
-00019900: 2020 2020 2020 2049 6465 6e74 6966 6965         Identifie
-00019910: 7320 7479 7065 206f 6620 6669 6c65 2e20  s type of file. 
-00019920: 6368 6f6f 7365 2066 726f 6d20 2757 6974  choose from 'Wit
-00019930: 6563 5f41 5343 4949 272c 2027 6865 6164  ec_ASCII', 'head
-00019940: 6c65 7373 5f74 7874 272c 2027 6865 6164  less_txt', 'head
-00019950: 6c65 7373 5f63 7376 272c 2027 6865 6164  less_csv', 'head
-00019960: 5f63 7376 272c 2027 5769 7465 635f 4153  _csv', 'Witec_AS
-00019970: 4349 4927 2c0a 2020 2020 2020 2020 2748  CII',.        'H
-00019980: 4f52 4942 415f 7478 7427 2c20 2752 656e  ORIBA_txt', 'Ren
-00019990: 6973 6861 775f 7478 7427 0a0a 2020 2020  ishaw_txt'..    
-000199a0: 706c 6f74 5f66 6967 7572 653a 2062 6f6f  plot_figure: boo
-000199b0: 6c0a 2020 2020 2020 2020 6966 2054 7275  l.        if Tru
-000199c0: 652c 2073 6176 6573 2066 6967 7572 650a  e, saves figure.
-000199d0: 0a20 2020 2044 6961 645f 706f 733a 2066  .    Diad_pos: f
-000199e0: 6c6f 6174 0a20 2020 2020 2020 2045 7374  loat.        Est
-000199f0: 696d 6174 6520 6f66 2064 6961 6420 706f  imate of diad po
-00019a00: 7369 7469 6f6e 0a0a 2020 2020 4842 5f70  sition..    HB_p
-00019a10: 6f73 3a20 666c 6f61 740a 2020 2020 2020  os: float.      
-00019a20: 2020 4573 7469 6d61 7465 206f 6620 4842    Estimate of HB
-00019a30: 2070 6f73 6974 696f 6e0a 0a0a 2020 2020   position...    
-00019a40: 636c 6f73 655f 6669 673a 2062 6f6f 6c0a  close_fig: bool.
-00019a50: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-00019a60: 2064 6973 706c 6179 7320 6669 6775 7265   displays figure
-00019a70: 2069 6e20 4e6f 7465 626f 6f6b 2e20 4966   in Notebook. If
-00019a80: 2046 616c 7365 2c20 636c 6f73 6573 2069   False, closes i
-00019a90: 7420 2879 6f75 2063 616e 2073 7469 6c6c  t (you can still
-00019aa0: 2066 696e 6420 6974 2073 6176 6564 290a   find it saved).
-00019ab0: 0a20 2020 2072 6574 7572 6e5f 6f74 6865  .    return_othe
-00019ac0: 725f 7061 7261 6d73 3a20 626f 6f6c 2028  r_params: bool (
-00019ad0: 6465 6661 756c 7420 4661 6c73 6529 0a20  default False). 
-00019ae0: 2020 2020 2020 2069 6620 4661 6c73 652c         if False,
-00019af0: 206a 7573 7420 7265 7475 726e 7320 6120   just returns a 
-00019b00: 6461 7461 6672 616d 6520 6f66 2070 6561  dataframe of pea
-00019b10: 6b20 7061 7261 6d65 7465 7273 0a20 2020  k parameters.   
-00019b20: 2020 2020 2069 6620 5472 7565 2c20 616c       if True, al
-00019b30: 736f 2072 6574 7572 6e73 3a0a 2020 2020  so returns:.    
-00019b40: 2020 2020 2020 2020 7265 7375 6c74 3a20          result: 
-00019b50: 6669 7420 7061 7261 6d65 7465 7273 0a20  fit parameters. 
-00019b60: 2020 2020 2020 2020 2020 2079 5f62 6573             y_bes
-00019b70: 745f 6669 743a 2062 6573 7420 6669 7420  t_fit: best fit 
-00019b80: 746f 2061 6c6c 2063 7572 7665 7320 696e  to all curves in
-00019b90: 2079 0a20 2020 2020 2020 2020 2020 2078   y.            x
-00019ba0: 5f6c 696e 3a20 6c69 6e73 7061 6365 206f  _lin: linspace o
-00019bb0: 6620 6265 7374 2066 6974 2063 6f6f 7264  f best fit coord
-00019bc0: 696e 6174 6573 2069 6e20 782e 0a0a 2020  inates in x...  
-00019bd0: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
-00019be0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073  ----------.    s
-00019bf0: 6565 2061 626f 7665 2e20 4465 7065 6e64  ee above. Depend
-00019c00: 7320 696e 2072 6574 7572 6e73 5f6f 7468  s in returns_oth
-00019c10: 6572 5f70 6172 616d 730a 0a0a 2222 220a  er_params...""".
-00019c20: 0a20 2020 2066 6974 5f70 6561 6b73 3d63  .    fit_peaks=c
-00019c30: 6f6e 6669 6731 2e66 6974 5f70 6561 6b73  onfig1.fit_peaks
-00019c40: 0a0a 2020 2020 6966 2066 6974 5f70 6561  ..    if fit_pea
-00019c50: 6b73 3d3d 323a 0a20 2020 2020 2020 2069  ks==2:.        i
-00019c60: 6620 6e70 2e69 736e 616e 2848 425f 706f  f np.isnan(HB_po
-00019c70: 7329 3d3d 5472 7565 206f 7220 636f 6e66  s)==True or conf
-00019c80: 6967 312e 4842 5f70 726f 6d3c 2d35 303a  ig1.HB_prom<-50:
-00019c90: 0a20 2020 2020 2020 2020 2020 2066 6974  .            fit
-00019ca0: 5f70 6561 6b73 3d31 0a20 2020 2020 2020  _peaks=1.       
-00019cb0: 2020 2020 2063 6f6e 6669 6731 2e66 6974       config1.fit
-00019cc0: 5f67 6175 7373 3d46 616c 7365 0a20 2020  _gauss=False.   
-00019cd0: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
-00019ce0: 2745 6974 6865 7220 6e6f 2068 6220 706f  'Either no hb po
-00019cf0: 7369 7469 6f6e 2c20 6f72 2070 726f 6d69  sition, or promi
-00019d00: 6e65 6e63 653c 2d35 302c 2075 7369 6e67  nence<-50, using
-00019d10: 2031 2066 6974 2729 0a0a 2020 2020 4469   1 fit')..    Di
-00019d20: 6164 5f64 663d 6765 745f 6461 7461 2870  ad_df=get_data(p
-00019d30: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
-00019d40: 6d65 3d66 696c 656e 616d 652c 2066 696c  me=filename, fil
-00019d50: 6574 7970 653d 6669 6c65 7479 7065 290a  etype=filetype).
-00019d60: 2020 2020 4469 6164 3d6e 702e 6172 7261      Diad=np.arra
-00019d70: 7928 4469 6164 5f64 6629 0a20 2020 2023  y(Diad_df).    #
-00019d80: 2046 6972 7374 2c20 7765 2066 6565 6420   First, we feed 
-00019d90: 6461 7461 2069 6e74 6f20 7468 6520 7265  data into the re
-00019da0: 6d6f 7665 2062 6173 656c 696e 6520 6675  move baseline fu
-00019db0: 6e63 7469 6f6e 2c20 7768 6963 6820 7265  nction, which re
-00019dc0: 7475 726e 7320 636f 7272 6563 7465 6420  turns corrected 
-00019dd0: 6461 7461 0a0a 2020 2020 795f 636f 7272  data..    y_corr
-00019de0: 5f64 6961 6431 2c20 5079 5f62 6173 655f  _diad1, Py_base_
-00019df0: 6469 6164 312c 2078 5f64 6961 6431 2c20  diad1, x_diad1, 
-00019e00: 2044 6961 645f 7368 6f72 745f 6469 6164   Diad_short_diad
-00019e10: 312c 2050 795f 6261 7365 5f64 6961 6431  1, Py_base_diad1
-00019e20: 2c20 5066 5f62 6173 656c 696e 655f 6469  , Pf_baseline_di
-00019e30: 6164 312c 2020 4261 7365 6c69 6e65 5f79  ad1,  Baseline_y
-00019e40: 7375 625f 6469 6164 312c 2042 6173 656c  sub_diad1, Basel
-00019e50: 696e 655f 785f 6469 6164 312c 2042 6173  ine_x_diad1, Bas
-00019e60: 656c 696e 655f 6469 6164 312c 2073 7061  eline_diad1, spa
-00019e70: 6e5f 6469 6164 313d 7265 6d6f 7665 5f64  n_diad1=remove_d
-00019e80: 6961 645f 6261 7365 6c69 6e65 280a 2020  iad_baseline(.  
-00019e90: 2070 6174 683d 7061 7468 2c20 6669 6c65   path=path, file
-00019ea0: 6e61 6d65 3d66 696c 656e 616d 652c 2066  name=filename, f
-00019eb0: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-00019ec0: 2c20 6578 636c 7564 655f 7261 6e67 6531  , exclude_range1
-00019ed0: 3d63 6f6e 6669 6732 2e65 7863 6c75 6465  =config2.exclude
-00019ee0: 5f72 616e 6765 312c 2065 7863 6c75 6465  _range1, exclude
-00019ef0: 5f72 616e 6765 323d 636f 6e66 6967 322e  _range2=config2.
-00019f00: 6578 636c 7564 655f 7261 6e67 6532 2c20  exclude_range2, 
-00019f10: 4e5f 706f 6c79 3d63 6f6e 6669 6731 2e4e  N_poly=config1.N
-00019f20: 5f70 6f6c 795f 6263 6b5f 6469 6164 312c  _poly_bck_diad1,
-00019f30: 0a20 2020 206c 6f77 6572 5f62 636b 3d63  .    lower_bck=c
-00019f40: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
-00019f50: 5f64 6961 6431 2c20 7570 7065 725f 6263  _diad1, upper_bc
-00019f60: 6b3d 636f 6e66 6967 312e 7570 7065 725f  k=config1.upper_
-00019f70: 6263 6b5f 6469 6164 312c 2070 6c6f 745f  bck_diad1, plot_
-00019f80: 6669 6775 7265 3d46 616c 7365 290a 0a0a  figure=False)...
-00019f90: 0a0a 0a20 2020 2023 2054 6865 6e2c 2077  ...    # Then, w
-00019fa0: 6520 6665 6564 2074 6869 7320 6261 7365  e feed this base
-00019fb0: 6c69 6e65 2d63 6f72 7265 6374 6564 2064  line-corrected d
-00019fc0: 6174 6120 696e 746f 2074 6865 2063 6f6d  ata into the com
-00019fd0: 6269 6e65 6420 6761 7573 7369 616e 2d76  bined gaussian-v
-00019fe0: 6f69 6774 2070 6561 6b20 6669 7474 696e  oigt peak fittin
-00019ff0: 6720 6675 6e63 7469 6f6e 0a0a 2020 2020  g function..    
-0001a000: 7265 7375 6c74 2c20 6466 5f6f 7574 2c20  result, df_out, 
-0001a010: 795f 6265 7374 5f66 6974 2c20 785f 6c69  y_best_fit, x_li
-0001a020: 6e2c 2063 6f6d 706f 6e65 6e74 732c 2078  n, components, x
-0001a030: 6461 742c 2079 6461 742c 2061 7831 5f78  dat, ydat, ax1_x
-0001a040: 6c69 6d2c 2061 7832 5f78 6c69 6d2c 7265  lim, ax2_xlim,re
-0001a050: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
-0001a060: 6473 2c20 7964 6174 5f69 6e72 616e 6765  ds, ydat_inrange
-0001a070: 2c20 2078 6461 745f 696e 7261 6e67 653d  ,  xdat_inrange=
-0001a080: 6669 745f 6761 7573 7369 616e 5f76 6f69  fit_gaussian_voi
-0001a090: 6774 5f67 656e 6572 6963 5f64 6961 6428  gt_generic_diad(
-0001a0a0: 636f 6e66 6967 312c 6469 6164 313d 5472  config1,diad1=Tr
-0001a0b0: 7565 2c20 7061 7468 3d70 6174 682c 2066  ue, path=path, f
-0001a0c0: 696c 656e 616d 653d 6669 6c65 6e61 6d65  ilename=filename
-0001a0d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a0e0: 2020 2020 2020 7864 6174 3d78 5f64 6961        xdat=x_dia
-0001a0f0: 6431 2c20 7964 6174 3d79 5f63 6f72 725f  d1, ydat=y_corr_
-0001a100: 6469 6164 312c 0a20 2020 2020 2020 2020  diad1,.         
-0001a110: 2020 2020 2020 2020 2020 2073 7061 6e3d             span=
-0001a120: 7370 616e 5f64 6961 6431 2c20 706c 6f74  span_diad1, plot
-0001a130: 5f66 6967 7572 653d 4661 6c73 652c 0a20  _figure=False,. 
-0001a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a150: 2020 2044 6961 645f 706f 733d 4469 6164     Diad_pos=Diad
-0001a160: 5f70 6f73 2c20 4842 5f70 6f73 3d48 425f  _pos, HB_pos=HB_
-0001a170: 706f 732c 6669 745f 7065 616b 733d 6669  pos,fit_peaks=fi
-0001a180: 745f 7065 616b 7329 0a0a 0a0a 2020 2020  t_peaks)....    
-0001a190: 2320 6966 2064 665f 6f75 745b 2744 6961  # if df_out['Dia
-0001a1a0: 6431 5f63 656e 745f 6572 7227 5d2e 696c  d1_cent_err'].il
-0001a1b0: 6f63 5b30 5d3d 3d30 3a0a 2020 2020 2320  oc[0]==0:.    # 
-0001a1c0: 2020 2020 6966 2063 6f6e 6669 6731 2e66      if config1.f
-0001a1d0: 6974 5f70 6561 6b73 3e31 3a0a 2020 2020  it_peaks>1:.    
-0001a1e0: 2320 2020 2020 2020 2020 636f 6e66 6967  #         config
-0001a1f0: 5f74 7765 616b 6564 2e66 6974 5f70 6561  _tweaked.fit_pea
-0001a200: 6b73 3d63 6f6e 6669 6731 2e66 6974 5f70  ks=config1.fit_p
-0001a210: 6561 6b73 2d31 0a20 2020 2023 2020 2020  eaks-1.    #    
-0001a220: 2020 2020 2070 7269 6e74 2827 7265 6475       print('redu
-0001a230: 6369 6e67 2070 6561 6b73 2062 7920 3120  cing peaks by 1 
-0001a240: 746f 2074 7279 2074 6f20 6765 7420 616e  to try to get an
-0001a250: 2065 7272 6f72 2729 0a0a 0a20 2020 2023   error')...    #
-0001a260: 2054 7279 2052 6566 6974 7469 6e67 206f   Try Refitting o
-0001a270: 6e63 650a 2020 2020 6966 2073 7472 2864  nce.    if str(d
-0001a280: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001a290: 6974 275d 2e69 6c6f 635b 305d 2921 3d27  it'].iloc[0])!='
-0001a2a0: 466c 6167 6765 6420 5761 726e 696e 6773  Flagged Warnings
-0001a2b0: 3a27 3a0a 2020 2020 2020 2020 7072 696e  :':.        prin
-0001a2c0: 7428 2772 6566 6974 2061 7474 656d 7074  t('refit attempt
-0001a2d0: 2031 2729 0a20 2020 2020 2020 2066 6163   1').        fac
-0001a2e0: 746f 723d 320a 2020 2020 2020 2020 696d  tor=2.        im
-0001a2f0: 706f 7274 2063 6f70 790a 2020 2020 2020  port copy.      
-0001a300: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001a310: 3d63 6f6e 6669 6731 0a20 2020 2020 2020  =config1.       
-0001a320: 2063 6f6e 6669 675f 7477 6561 6b65 643d   config_tweaked=
-0001a330: 636f 7079 2e63 6f70 7928 636f 6e66 6967  copy.copy(config
-0001a340: 3129 0a0a 2020 2020 2020 2020 6966 2061  1)..        if a
-0001a350: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
-0001a360: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-0001a370: 7461 696e 7328 2720 4e6f 2045 7272 6f72  tains(' No Error
-0001a380: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
-0001a390: 2069 6620 636f 6e66 6967 312e 6669 745f   if config1.fit_
-0001a3a0: 7065 616b 733e 323a 0a20 2020 2020 2020  peaks>2:.       
-0001a3b0: 2020 2020 2020 2020 2063 6f6e 6669 675f           config_
-0001a3c0: 7477 6561 6b65 642e 6669 745f 7065 616b  tweaked.fit_peak
-0001a3d0: 733d 636f 6e66 6967 312e 6669 745f 7065  s=config1.fit_pe
-0001a3e0: 616b 732d 310a 2020 2020 2020 2020 2020  aks-1.          
-0001a3f0: 2020 2020 2020 6669 745f 7065 616b 733d        fit_peaks=
-0001a400: 636f 6e66 6967 5f74 7765 616b 6564 2e66  config_tweaked.f
-0001a410: 6974 5f70 6561 6b73 0a0a 0a20 2020 2020  it_peaks...     
-0001a420: 2020 2069 6620 616e 7928 6466 5f6f 7574     if any(df_out
-0001a430: 5b27 4469 6164 315f 7265 6669 7427 5d2e  ['Diad1_refit'].
-0001a440: 7374 722e 636f 6e74 6169 6e73 2827 565f  str.contains('V_
-0001a450: 5369 676d 615f 746f 6f5f 4c6f 7727 2929  Sigma_too_Low'))
-0001a460: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0001a470: 6e66 6967 5f74 7765 616b 6564 2e64 6961  nfig_tweaked.dia
-0001a480: 645f 7369 676d 613d 636f 6e66 6967 312e  d_sigma=config1.
-0001a490: 6469 6164 5f73 6967 6d61 2a66 6163 746f  diad_sigma*facto
-0001a4a0: 720a 2020 2020 2020 2020 6966 2061 6e79  r.        if any
-0001a4b0: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
-0001a4c0: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
-0001a4d0: 696e 7328 2756 5f53 6967 6d61 5f74 6f6f  ins('V_Sigma_too
-0001a4e0: 5f48 6967 6827 2929 3a0a 2020 2020 2020  _High')):.      
-0001a4f0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
-0001a500: 616b 6564 2e64 6961 645f 7369 676d 613d  aked.diad_sigma=
-0001a510: 636f 6e66 6967 312e 6469 6164 5f73 6967  config1.diad_sig
-0001a520: 6d61 2f66 6163 746f 720a 2020 2020 2020  ma/factor.      
-0001a530: 2020 2320 4761 7573 7369 616e 2066 6974    # Gaussian fit
-0001a540: 2062 6974 730a 2020 2020 2020 2020 6966   bits.        if
-0001a550: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
-0001a560: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
-0001a570: 6f6e 7461 696e 7328 2747 5f69 6e70 7574  ontains('G_input
-0001a580: 5f54 6f6f 4869 6768 5369 676d 6127 2929  _TooHighSigma'))
-0001a590: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0001a5a0: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
-0001a5b0: 7373 5f73 6967 6d61 3d63 6f6e 6669 6731  ss_sigma=config1
-0001a5c0: 2e67 6175 7373 5f73 6967 6d61 2f66 6163  .gauss_sigma/fac
-0001a5d0: 746f 720a 2020 2020 2020 2020 6966 2061  tor.        if a
-0001a5e0: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
-0001a5f0: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-0001a600: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
-0001a610: 6f6f 4c6f 7753 6967 6d61 2729 293a 0a20  ooLowSigma')):. 
-0001a620: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0001a630: 675f 7477 6561 6b65 642e 6761 7573 735f  g_tweaked.gauss_
-0001a640: 7369 676d 613d 636f 6e66 6967 312e 6761  sigma=config1.ga
-0001a650: 7573 735f 7369 676d 612a 6661 6374 6f72  uss_sigma*factor
-0001a660: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
-0001a670: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
-0001a680: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-0001a690: 6e73 2827 475f 696e 7075 745f 546f 6f4c  ns('G_input_TooL
-0001a6a0: 6f77 416d 7027 2929 3a0a 2020 2020 2020  owAmp')):.      
-0001a6b0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
-0001a6c0: 616b 6564 2e67 6175 7373 5f61 6d70 6c69  aked.gauss_ampli
-0001a6d0: 7475 6465 3d63 6f6e 6669 6731 2e67 6175  tude=config1.gau
-0001a6e0: 7373 5f61 6d70 2a66 6163 746f 720a 2020  ss_amp*factor.  
-0001a6f0: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
-0001a700: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
-0001a710: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
-0001a720: 2747 5f41 6d70 5f74 6f6f 5f68 6967 6827  'G_Amp_too_high'
-0001a730: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0001a740: 636f 6e66 6967 5f74 7765 616b 6564 2e67  config_tweaked.g
-0001a750: 6175 7373 5f61 6d70 6c69 7475 6465 3d63  auss_amplitude=c
-0001a760: 6f6e 6669 6731 2e67 6175 7373 5f61 6d70  onfig1.gauss_amp
-0001a770: 2f66 6163 746f 720a 2020 2020 2020 2020  /factor.        
-0001a780: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
-0001a790: 6961 6431 5f72 6566 6974 275d 2e73 7472  iad1_refit'].str
-0001a7a0: 2e63 6f6e 7461 696e 7328 2747 5f68 6967  .contains('G_hig
-0001a7b0: 6865 725f 7468 616e 5f64 6961 6427 2929  her_than_diad'))
-0001a7c0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0001a7d0: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
-0001a7e0: 7373 5f61 6d70 6c69 7475 6465 3d63 6f6e  ss_amplitude=con
-0001a7f0: 6669 6731 2e67 6175 7373 5f61 6d70 2f66  fig1.gauss_amp/f
-0001a800: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
-0001a810: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001a820: 2e67 6175 7373 5f73 6967 6d61 3d63 6f6e  .gauss_sigma=con
-0001a830: 6669 6731 2e67 6175 7373 5f73 6967 6d61  fig1.gauss_sigma
-0001a840: 2a66 6163 746f 720a 2020 2020 2020 2020  *factor.        
-0001a850: 2320 2320 486f 7420 6261 6e64 2066 6974  # # Hot band fit
-0001a860: 2062 6974 730a 2020 2020 2020 2020 2320   bits.        # 
-0001a870: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
-0001a880: 6961 6431 5f72 6566 6974 275d 2e73 7472  iad1_refit'].str
-0001a890: 2e63 6f6e 7461 696e 7328 2748 4231 5f4c  .contains('HB1_L
-0001a8a0: 6f77 416d 7027 2929 3a0a 2020 2020 2020  owAmp')):.      
-0001a8b0: 2020 2320 2020 2020 636f 6e66 6967 5f74    #     config_t
-0001a8c0: 7765 616b 6564 2e48 425f 616d 706c 6974  weaked.HB_amplit
-0001a8d0: 7564 653d 6361 6c63 5f48 425f 616d 706c  ude=calc_HB_ampl
-0001a8e0: 6974 7564 652f 320a 2020 2020 2020 2020  itude/2.        
-0001a8f0: 2320 6966 2061 6e79 2864 665f 6f75 745b  # if any(df_out[
-0001a900: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
-0001a910: 7472 2e63 6f6e 7461 696e 7328 2748 4231  tr.contains('HB1
-0001a920: 5f48 6967 6841 6d70 2729 293a 0a20 2020  _HighAmp')):.   
-0001a930: 2020 2020 2023 2020 2020 2063 6f6e 6669       #     confi
-0001a940: 675f 7477 6561 6b65 642e 4842 5f61 6d70  g_tweaked.HB_amp
-0001a950: 6c69 7475 6465 3d63 616c 635f 4842 5f61  litude=calc_HB_a
-0001a960: 6d70 6c69 7475 6465 2a32 0a0a 2020 2020  mplitude*2..    
-0001a970: 2020 2020 7265 7375 6c74 2c20 6466 5f6f      result, df_o
-0001a980: 7574 2c20 795f 6265 7374 5f66 6974 2c20  ut, y_best_fit, 
-0001a990: 785f 6c69 6e2c 2063 6f6d 706f 6e65 6e74  x_lin, component
-0001a9a0: 732c 2078 6461 742c 2079 6461 742c 2061  s, xdat, ydat, a
-0001a9b0: 7831 5f78 6c69 6d2c 2061 7832 5f78 6c69  x1_xlim, ax2_xli
-0001a9c0: 6d2c 7265 7369 6475 616c 5f64 6961 645f  m,residual_diad_
-0001a9d0: 636f 6f72 6473 2c20 7964 6174 5f69 6e72  coords, ydat_inr
-0001a9e0: 616e 6765 2c20 2078 6461 745f 696e 7261  ange,  xdat_inra
-0001a9f0: 6e67 653d 6669 745f 6761 7573 7369 616e  nge=fit_gaussian
-0001aa00: 5f76 6f69 6774 5f67 656e 6572 6963 5f64  _voigt_generic_d
-0001aa10: 6961 6428 636f 6e66 6967 5f74 7765 616b  iad(config_tweak
-0001aa20: 6564 2c20 6469 6164 313d 5472 7565 2c20  ed, diad1=True, 
-0001aa30: 7061 7468 3d70 6174 682c 2066 696c 656e  path=path, filen
-0001aa40: 616d 653d 6669 6c65 6e61 6d65 2c0a 2020  ame=filename,.  
-0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa60: 2020 7864 6174 3d78 5f64 6961 6431 2c20    xdat=x_diad1, 
-0001aa70: 7964 6174 3d79 5f63 6f72 725f 6469 6164  ydat=y_corr_diad
-0001aa80: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0001aa90: 2020 2020 2020 2073 7061 6e3d 7370 616e         span=span
-0001aaa0: 5f64 6961 6431 2c20 706c 6f74 5f66 6967  _diad1, plot_fig
-0001aab0: 7572 653d 4661 6c73 652c 2044 6961 645f  ure=False, Diad_
-0001aac0: 706f 733d 4469 6164 5f70 6f73 2c20 4842  pos=Diad_pos, HB
-0001aad0: 5f70 6f73 3d48 425f 706f 732c 2066 6974  _pos=HB_pos, fit
-0001aae0: 5f70 6561 6b73 3d63 6f6e 6669 675f 7477  _peaks=config_tw
-0001aaf0: 6561 6b65 642e 6669 745f 7065 616b 7329  eaked.fit_peaks)
-0001ab00: 0a20 2020 2020 2020 2069 3d32 0a20 2020  .        i=2.   
-0001ab10: 2020 2020 2077 6869 6c65 2073 7472 2864       while str(d
-0001ab20: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001ab30: 6974 275d 2e69 6c6f 635b 305d 2921 3d27  it'].iloc[0])!='
-0001ab40: 466c 6167 6765 6420 5761 726e 696e 6773  Flagged Warnings
-0001ab50: 3a27 3a0a 0a20 2020 2020 2020 2020 2020  :':..           
-0001ab60: 2070 7269 6e74 2827 7265 6669 7420 6174   print('refit at
-0001ab70: 7465 6d70 7420 203d 272b 7374 7228 6929  tempt  ='+str(i)
-0001ab80: 202b 2027 2c20 272b 7374 7228 6466 5f6f   + ', '+str(df_o
-0001ab90: 7574 5b27 4469 6164 315f 7265 6669 7427  ut['Diad1_refit'
-0001aba0: 5d2e 696c 6f63 5b30 5d29 290a 2020 2020  ].iloc[0])).    
-0001abb0: 2020 2020 2020 2020 7072 696e 7428 6466          print(df
-0001abc0: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
-0001abd0: 7427 5d2e 696c 6f63 5b30 5d29 0a0a 2020  t'].iloc[0])..  
-0001abe0: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0001abf0: 2063 6f70 790a 2020 2020 2020 2020 2020   copy.          
-0001ac00: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001ac10: 323d 636f 7079 2e63 6f70 7928 636f 6e66  2=copy.copy(conf
-0001ac20: 6967 5f74 7765 616b 6564 290a 2020 2020  ig_tweaked).    
-0001ac30: 2020 2020 2020 2020 6661 6374 6f72 323d          factor2=
-0001ac40: 6661 6374 6f72 2a32 0a0a 0a20 2020 2020  factor*2...     
-0001ac50: 2020 2020 2020 2023 2069 6620 616e 7928         # if any(
-0001ac60: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
-0001ac70: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-0001ac80: 6e73 2827 565f 4c6f 7741 6d70 2729 293a  ns('V_LowAmp')):
-0001ac90: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0001aca0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
-0001acb0: 6432 2e64 6961 645f 616d 706c 6974 7564  d2.diad_amplitud
-0001acc0: 653d 636f 6e66 6967 5f74 7765 616b 6564  e=config_tweaked
-0001acd0: 2e64 6961 645f 616d 706c 6974 7564 652a  .diad_amplitude*
-0001ace0: 3130 0a20 2020 2020 2020 2020 2020 2023  10.            #
-0001acf0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
-0001ad00: 4469 6164 315f 7265 6669 7427 5d2e 7374  Diad1_refit'].st
-0001ad10: 722e 636f 6e74 6169 6e73 2827 565f 4869  r.contains('V_Hi
-0001ad20: 6768 416d 7027 2929 3a0a 2020 2020 2020  ghAmp')):.      
-0001ad30: 2020 2020 2020 2320 2020 2020 636f 6e66        #     conf
-0001ad40: 6967 5f74 7765 616b 6564 322e 6469 6164  ig_tweaked2.diad
-0001ad50: 5f61 6d70 6c69 7475 6465 3d63 6f6e 6669  _amplitude=confi
-0001ad60: 675f 7477 6561 6b65 642e 6469 6164 5f61  g_tweaked.diad_a
-0001ad70: 6d70 6c69 7475 6465 2f31 300a 2020 2020  mplitude/10.    
-0001ad80: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
-0001ad90: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001ada0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-0001adb0: 7328 2756 5f53 6967 6d61 5f74 6f6f 5f4c  s('V_Sigma_too_L
-0001adc0: 6f77 2729 293a 0a20 2020 2020 2020 2020  ow')):.         
-0001add0: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
-0001ade0: 6561 6b65 6432 2e64 6961 645f 7369 676d  eaked2.diad_sigm
-0001adf0: 613d 636f 6e66 6967 5f74 7765 616b 6564  a=config_tweaked
-0001ae00: 2e64 6961 645f 7369 676d 612a 6661 6374  .diad_sigma*fact
-0001ae10: 6f72 320a 2020 2020 2020 2020 2020 2020  or2.            
-0001ae20: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
-0001ae30: 6961 6431 5f72 6566 6974 275d 2e73 7472  iad1_refit'].str
-0001ae40: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
-0001ae50: 6d61 5f74 6f6f 5f48 6967 6827 2929 3a0a  ma_too_High')):.
-0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae70: 636f 6e66 6967 5f74 7765 616b 6564 322e  config_tweaked2.
-0001ae80: 6469 6164 5f73 6967 6d61 3d63 6f6e 6669  diad_sigma=confi
-0001ae90: 675f 7477 6561 6b65 642e 6469 6164 5f73  g_tweaked.diad_s
-0001aea0: 6967 6d61 2f66 6163 746f 7232 0a20 2020  igma/factor2.   
-0001aeb0: 2020 2020 2020 2020 2023 2047 6175 7373           # Gauss
-0001aec0: 6961 6e20 6669 7420 6269 7473 0a20 2020  ian fit bits.   
-0001aed0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-0001aee0: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
-0001aef0: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
-0001af00: 6e73 2827 475f 696e 7075 745f 546f 6f48  ns('G_input_TooH
-0001af10: 6967 6853 6967 6d61 2729 293a 0a20 2020  ighSigma')):.   
-0001af20: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001af30: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
-0001af40: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
-0001af50: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
-0001af60: 676d 612f 6661 6374 6f72 320a 2020 2020  gma/factor2.    
-0001af70: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
-0001af80: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
-0001af90: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
-0001afa0: 7328 2747 5f69 6e70 7574 5f54 6f6f 4c6f  s('G_input_TooLo
-0001afb0: 7753 6967 6d61 2729 293a 0a20 2020 2020  wSigma')):.     
-0001afc0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-0001afd0: 675f 7477 6561 6b65 6432 2e67 6175 7373  g_tweaked2.gauss
-0001afe0: 5f73 6967 6d61 3d63 6f6e 6669 675f 7477  _sigma=config_tw
-0001aff0: 6561 6b65 642e 6761 7573 735f 7369 676d  eaked.gauss_sigm
-0001b000: 612a 6661 6374 6f72 320a 2020 2020 2020  a*factor2.      
-0001b010: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
-0001b020: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
-0001b030: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
-0001b040: 2747 5f69 6e70 7574 5f54 6f6f 4c6f 7741  'G_input_TooLowA
-0001b050: 6d70 2729 293a 0a20 2020 2020 2020 2020  mp')):.         
-0001b060: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
-0001b070: 6561 6b65 6432 2e67 6175 7373 5f61 6d70  eaked2.gauss_amp
-0001b080: 6c69 7475 6465 3d63 6f6e 6669 675f 7477  litude=config_tw
-0001b090: 6561 6b65 642e 6761 7573 735f 616d 702a  eaked.gauss_amp*
-0001b0a0: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
-0001b0b0: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
-0001b0c0: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
-0001b0d0: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
-0001b0e0: 5f41 6d70 5f74 6f6f 5f68 6967 6827 2929  _Amp_too_high'))
-0001b0f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b100: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001b110: 322e 6761 7573 735f 616d 706c 6974 7564  2.gauss_amplitud
-0001b120: 653d 636f 6e66 6967 5f74 7765 616b 6564  e=config_tweaked
-0001b130: 2e67 6175 7373 5f61 6d70 2f66 6163 746f  .gauss_amp/facto
-0001b140: 7232 0a20 2020 2020 2020 2020 2020 2069  r2.            i
-0001b150: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
-0001b160: 6164 315f 7265 6669 7427 5d2e 7374 722e  ad1_refit'].str.
-0001b170: 636f 6e74 6169 6e73 2827 475f 6869 6768  contains('G_high
-0001b180: 6572 5f74 6861 6e5f 6469 6164 2729 293a  er_than_diad')):
-0001b190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b1a0: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
-0001b1b0: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
-0001b1c0: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
-0001b1d0: 6761 7573 735f 616d 702f 6661 6374 6f72  gauss_amp/factor
-0001b1e0: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
-0001b1f0: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
-0001b200: 322e 6761 7573 735f 7369 676d 613d 636f  2.gauss_sigma=co
-0001b210: 6e66 6967 5f74 7765 616b 6564 2e67 6175  nfig_tweaked.gau
-0001b220: 7373 5f73 6967 6d61 2a66 6163 746f 7232  ss_sigma*factor2
-0001b230: 0a20 2020 2020 2020 2020 2020 2023 2048  .            # H
-0001b240: 6f74 2062 616e 6473 2062 6974 730a 2020  ot bands bits.  
-0001b250: 2020 2020 2020 2020 2020 2320 6966 2061            # if a
-0001b260: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
-0001b270: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
-0001b280: 7461 696e 7328 2748 4231 5f4c 6f77 416d  tains('HB1_LowAm
-0001b290: 7027 2929 3a0a 2020 2020 2020 2020 2020  p')):.          
-0001b2a0: 2020 2320 2020 2020 636f 6e66 6967 5f74    #     config_t
-0001b2b0: 7765 616b 6564 322e 4842 5f61 6d70 6c69  weaked2.HB_ampli
-0001b2c0: 7475 6465 3d63 6f6e 6669 675f 7477 6561  tude=config_twea
-0001b2d0: 6b65 642e 4842 5f61 6d70 6c69 7475 6465  ked.HB_amplitude
-0001b2e0: 2f32 0a20 2020 2020 2020 2020 2020 2023  /2.            #
-0001b2f0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
-0001b300: 4469 6164 315f 7265 6669 7427 5d2e 7374  Diad1_refit'].st
-0001b310: 722e 636f 6e74 6169 6e73 2827 4842 315f  r.contains('HB1_
-0001b320: 4869 6768 416d 7027 2929 3a0a 2020 2020  HighAmp')):.    
+00015da0: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+00015db0: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
+00015dc0: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
+00015dd0: 5f68 6967 6865 725f 7468 616e 5f64 6961  _higher_than_dia
+00015de0: 6427 2929 3a0a 2020 2020 2020 2020 2020  d')):.          
+00015df0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+00015e00: 616b 6564 2e67 6175 7373 5f61 6d70 6c69  aked.gauss_ampli
+00015e10: 7475 6465 3d63 6f6e 6669 6731 2e67 6175  tude=config1.gau
+00015e20: 7373 5f61 6d70 2f66 6163 746f 720a 2020  ss_amp/factor.  
+00015e30: 2020 2020 2020 2020 2020 2020 2020 2363                #c
+00015e40: 6f6e 6669 675f 7477 6561 6b65 642e 6761  onfig_tweaked.ga
+00015e50: 7573 735f 7369 676d 613d 636f 6e66 6967  uss_sigma=config
+00015e60: 312e 6761 7573 735f 7369 676d 612a 6661  1.gauss_sigma*fa
+00015e70: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
+00015e80: 2023 2048 6f74 2062 616e 6420 6669 7420   # Hot band fit 
+00015e90: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+00015ea0: 2023 2069 6620 616e 7928 6466 5f6f 7574   # if any(df_out
+00015eb0: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+00015ec0: 7374 722e 636f 6e74 6169 6e73 2827 4842  str.contains('HB
+00015ed0: 325f 4c6f 7741 6d70 2729 293a 0a20 2020  2_LowAmp')):.   
+00015ee0: 2020 2020 2020 2020 2023 2020 2020 2063           #     c
+00015ef0: 6f6e 6669 675f 7477 6561 6b65 642e 4842  onfig_tweaked.HB
+00015f00: 5f61 6d70 6c69 7475 6465 3d63 616c 635f  _amplitude=calc_
+00015f10: 4842 5f61 6d70 6c69 7475 6465 2f32 0a20  HB_amplitude/2. 
+00015f20: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+00015f30: 616e 7928 6466 5f6f 7574 5b27 4469 6164  any(df_out['Diad
+00015f40: 325f 7265 6669 7427 5d2e 7374 722e 636f  2_refit'].str.co
+00015f50: 6e74 6169 6e73 2827 4842 325f 4869 6768  ntains('HB2_High
+00015f60: 416d 7027 2929 3a0a 2020 2020 2020 2020  Amp')):.        
+00015f70: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
+00015f80: 5f74 7765 616b 6564 2e48 425f 616d 706c  _tweaked.HB_ampl
+00015f90: 6974 7564 653d 6361 6c63 5f48 425f 616d  itude=calc_HB_am
+00015fa0: 706c 6974 7564 652a 320a 0a0a 2020 2020  plitude*2...    
+00015fb0: 2020 2020 2020 2020 7265 7375 6c74 2c20          result, 
+00015fc0: 6466 5f6f 7574 2c20 795f 6265 7374 5f66  df_out, y_best_f
+00015fd0: 6974 2c20 785f 6c69 6e2c 2063 6f6d 706f  it, x_lin, compo
+00015fe0: 6e65 6e74 732c 2078 6461 742c 2079 6461  nents, xdat, yda
+00015ff0: 742c 2061 7831 5f78 6c69 6d2c 2061 7832  t, ax1_xlim, ax2
+00016000: 5f78 6c69 6d2c 7265 7369 6475 616c 5f64  _xlim,residual_d
+00016010: 6961 645f 636f 6f72 6473 2c20 7964 6174  iad_coords, ydat
+00016020: 5f69 6e72 616e 6765 2c20 2078 6461 745f  _inrange,  xdat_
+00016030: 696e 7261 6e67 653d 6669 745f 6761 7573  inrange=fit_gaus
+00016040: 7369 616e 5f76 6f69 6774 5f67 656e 6572  sian_voigt_gener
+00016050: 6963 5f64 6961 6428 636f 6e66 6967 5f74  ic_diad(config_t
+00016060: 7765 616b 6564 2c20 6469 6164 323d 5472  weaked, diad2=Tr
+00016070: 7565 2c20 7061 7468 3d70 6174 682c 2066  ue, path=path, f
+00016080: 696c 656e 616d 653d 6669 6c65 6e61 6d65  ilename=filename
+00016090: 2c0a 2020 2020 2020 2020 2020 2020 7864  ,.            xd
+000160a0: 6174 3d78 5f64 6961 6432 2c20 7964 6174  at=x_diad2, ydat
+000160b0: 3d79 5f63 6f72 725f 6469 6164 322c 0a20  =y_corr_diad2,. 
+000160c0: 2020 2020 2020 2073 7061 6e3d 7370 616e         span=span
+000160d0: 5f64 6961 6432 2c20 706c 6f74 5f66 6967  _diad2, plot_fig
+000160e0: 7572 653d 4661 6c73 652c 2044 6961 645f  ure=False, Diad_
+000160f0: 706f 733d 4469 6164 5f70 6f73 2c20 4842  pos=Diad_pos, HB
+00016100: 5f70 6f73 3d48 425f 706f 732c 2043 3133  _pos=HB_pos, C13
+00016110: 5f70 6f73 3d43 3133 5f70 6f73 2c20 6669  _pos=C13_pos, fi
+00016120: 745f 7065 616b 733d 6669 745f 7065 616b  t_peaks=fit_peak
+00016130: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+00016140: 3d32 0a20 2020 2020 2020 2020 2020 2077  =2.            w
+00016150: 6869 6c65 2073 7472 2864 665f 6f75 745b  hile str(df_out[
+00016160: 2744 6961 6432 5f72 6566 6974 275d 2e69  'Diad2_refit'].i
+00016170: 6c6f 635b 305d 2921 3d27 466c 6167 6765  loc[0])!='Flagge
+00016180: 6420 5761 726e 696e 6773 3a27 3a0a 0a20  d Warnings:':.. 
+00016190: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000161a0: 7269 6e74 2827 7265 6669 7420 6174 7465  rint('refit atte
+000161b0: 6d70 7420 203d 272b 7374 7228 6929 202b  mpt  ='+str(i) +
+000161c0: 2027 2c20 272b 7374 7228 6466 5f6f 7574   ', '+str(df_out
+000161d0: 5b27 4469 6164 325f 7265 6669 7427 5d2e  ['Diad2_refit'].
+000161e0: 696c 6f63 5b30 5d29 290a 2020 2020 2020  iloc[0])).      
+000161f0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00016200: 6466 5f6f 7574 5b27 4469 6164 325f 7265  df_out['Diad2_re
+00016210: 6669 7427 5d2e 696c 6f63 5b30 5d29 0a0a  fit'].iloc[0])..
+00016220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016230: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
+00016240: 3d63 6f70 792e 636f 7079 2863 6f6e 6669  =copy.copy(confi
+00016250: 675f 7477 6561 6b65 6429 0a20 2020 2020  g_tweaked).     
+00016260: 2020 2020 2020 2020 2020 2066 6163 746f             facto
+00016270: 7232 3d66 6163 746f 722a 320a 0a20 2020  r2=factor*2..   
+00016280: 2020 2020 2020 2020 2020 2020 2023 0a20               #. 
+00016290: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000162a0: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+000162b0: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
+000162c0: 722e 636f 6e74 6169 6e73 2827 565f 4c6f  r.contains('V_Lo
+000162d0: 7741 6d70 2729 293a 0a20 2020 2020 2020  wAmp')):.       
+000162e0: 2020 2020 2020 2020 2023 2020 2020 2063           #     c
+000162f0: 6f6e 6669 675f 7477 6561 6b65 6432 2e64  onfig_tweaked2.d
+00016300: 6961 645f 616d 706c 6974 7564 653d 636f  iad_amplitude=co
+00016310: 6e66 6967 5f74 7765 616b 6564 2e64 6961  nfig_tweaked.dia
+00016320: 645f 616d 706c 6974 7564 652a 3130 0a20  d_amplitude*10. 
+00016330: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00016340: 2069 6620 616e 7928 6466 5f6f 7574 5b27   if any(df_out['
+00016350: 4469 6164 325f 7265 6669 7427 5d2e 7374  Diad2_refit'].st
+00016360: 722e 636f 6e74 6169 6e73 2827 565f 4869  r.contains('V_Hi
+00016370: 6768 416d 7027 2929 3a0a 2020 2020 2020  ghAmp')):.      
+00016380: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00016390: 636f 6e66 6967 5f74 7765 616b 6564 322e  config_tweaked2.
+000163a0: 6469 6164 5f61 6d70 6c69 7475 6465 3d63  diad_amplitude=c
+000163b0: 6f6e 6669 675f 7477 6561 6b65 642e 6469  onfig_tweaked.di
+000163c0: 6164 5f61 6d70 6c69 7475 6465 2f31 300a  ad_amplitude/10.
+000163d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163e0: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+000163f0: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+00016400: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
+00016410: 6d61 5f74 6f6f 5f4c 6f77 2729 293a 0a20  ma_too_Low')):. 
+00016420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016430: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+00016440: 6432 2e64 6961 645f 7369 676d 613d 636f  d2.diad_sigma=co
+00016450: 6e66 6967 5f74 7765 616b 6564 2e64 6961  nfig_tweaked.dia
+00016460: 645f 7369 676d 612a 6661 6374 6f72 320a  d_sigma*factor2.
+00016470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016480: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+00016490: 6961 6432 5f72 6566 6974 275d 2e73 7472  iad2_refit'].str
+000164a0: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
+000164b0: 6d61 5f74 6f6f 5f48 6967 6827 2929 3a0a  ma_too_High')):.
+000164c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164d0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+000164e0: 6564 322e 6469 6164 5f73 6967 6d61 3d63  ed2.diad_sigma=c
+000164f0: 6f6e 6669 675f 7477 6561 6b65 642e 6469  onfig_tweaked.di
+00016500: 6164 5f73 6967 6d61 2f66 6163 746f 7232  ad_sigma/factor2
+00016510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016520: 2023 2047 6175 7373 6961 6e20 6669 7420   # Gaussian fit 
+00016530: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+00016540: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
+00016550: 7574 5b27 4469 6164 325f 7265 6669 7427  ut['Diad2_refit'
+00016560: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
+00016570: 475f 696e 7075 745f 546f 6f48 6967 6853  G_input_TooHighS
+00016580: 6967 6d61 2729 293a 0a20 2020 2020 2020  igma')):.       
+00016590: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000165a0: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
+000165b0: 7373 5f73 6967 6d61 3d63 6f6e 6669 675f  ss_sigma=config_
+000165c0: 7477 6561 6b65 642e 6761 7573 735f 7369  tweaked.gauss_si
+000165d0: 676d 612f 6661 6374 6f72 320a 2020 2020  gma/factor2.    
+000165e0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+000165f0: 6e79 2864 665f 6f75 745b 2744 6961 6432  ny(df_out['Diad2
+00016600: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+00016610: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
+00016620: 6f6f 4c6f 7753 6967 6d61 2729 293a 0a20  ooLowSigma')):. 
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+00016650: 6432 2e67 6175 7373 5f73 6967 6d61 3d63  d2.gauss_sigma=c
+00016660: 6f6e 6669 675f 7477 6561 6b65 642e 6761  onfig_tweaked.ga
+00016670: 7573 735f 7369 676d 612a 6661 6374 6f72  uss_sigma*factor
+00016680: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+00016690: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+000166a0: 2744 6961 6432 5f72 6566 6974 275d 2e73  'Diad2_refit'].s
+000166b0: 7472 2e63 6f6e 7461 696e 7328 2747 5f69  tr.contains('G_i
+000166c0: 6e70 7574 5f54 6f6f 4c6f 7741 6d70 2729  nput_TooLowAmp')
+000166d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000166e0: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+000166f0: 6561 6b65 6432 2e67 6175 7373 5f61 6d70  eaked2.gauss_amp
+00016700: 6c69 7475 6465 3d63 6f6e 6669 675f 7477  litude=config_tw
+00016710: 6561 6b65 642e 6761 7573 735f 616d 702a  eaked.gauss_amp*
+00016720: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
+00016730: 2020 2020 2020 2020 6966 2061 6e79 2864          if any(d
+00016740: 665f 6f75 745b 2744 6961 6432 5f72 6566  f_out['Diad2_ref
+00016750: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
+00016760: 7328 2747 5f41 6d70 5f74 6f6f 5f68 6967  s('G_Amp_too_hig
+00016770: 6827 2929 3a0a 2020 2020 2020 2020 2020  h')):.          
+00016780: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00016790: 5f74 7765 616b 6564 322e 6761 7573 735f  _tweaked2.gauss_
+000167a0: 616d 706c 6974 7564 653d 636f 6e66 6967  amplitude=config
+000167b0: 5f74 7765 616b 6564 2e67 6175 7373 5f61  _tweaked.gauss_a
+000167c0: 6d70 2f66 6163 746f 7232 0a20 2020 2020  mp/factor2.     
+000167d0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
+000167e0: 7928 6466 5f6f 7574 5b27 4469 6164 325f  y(df_out['Diad2_
+000167f0: 7265 6669 7427 5d2e 7374 722e 636f 6e74  refit'].str.cont
+00016800: 6169 6e73 2827 475f 6869 6768 6572 5f74  ains('G_higher_t
+00016810: 6861 6e5f 6469 6164 2729 293a 0a20 2020  han_diad')):.   
+00016820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016830: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
+00016840: 2e67 6175 7373 5f61 6d70 6c69 7475 6465  .gauss_amplitude
+00016850: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
+00016860: 6761 7573 735f 616d 702f 6661 6374 6f72  gauss_amp/factor
+00016870: 320a 2020 2020 2020 2020 2020 2020 2020  2.              
+00016880: 2020 2020 2020 2363 6f6e 6669 675f 7477        #config_tw
+00016890: 6561 6b65 6432 2e67 6175 7373 5f73 6967  eaked2.gauss_sig
+000168a0: 6d61 3d63 6f6e 6669 675f 7477 6561 6b65  ma=config_tweake
+000168b0: 642e 6761 7573 735f 7369 676d 612a 6661  d.gauss_sigma*fa
+000168c0: 6374 6f72 320a 2020 2020 2020 2020 2020  ctor2.          
+000168d0: 2020 2320 2320 486f 7420 6261 6e64 7320    # # Hot bands 
+000168e0: 6269 7473 0a20 2020 2020 2020 2020 2020  bits.           
+000168f0: 2023 2020 2020 2069 6620 616e 7928 6466   #     if any(df
+00016900: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+00016910: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+00016920: 2827 4842 325f 4c6f 7741 6d70 2729 293a  ('HB2_LowAmp')):
+00016930: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00016940: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+00016950: 6561 6b65 6432 2e48 425f 616d 706c 6974  eaked2.HB_amplit
+00016960: 7564 653d 636f 6e66 6967 5f74 7765 616b  ude=config_tweak
+00016970: 6564 2e48 425f 616d 706c 6974 7564 652f  ed.HB_amplitude/
+00016980: 320a 2020 2020 2020 2020 2020 2020 2320  2.            # 
+00016990: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+000169a0: 745b 2744 6961 6432 5f72 6566 6974 275d  t['Diad2_refit']
+000169b0: 2e73 7472 2e63 6f6e 7461 696e 7328 2748  .str.contains('H
+000169c0: 4232 5f48 6967 6841 6d70 2729 293a 0a20  B2_HighAmp')):. 
+000169d0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+000169e0: 2020 2020 2063 6f6e 6669 675f 7477 6561       config_twea
+000169f0: 6b65 6432 2e48 425f 616d 706c 6974 7564  ked2.HB_amplitud
+00016a00: 653d 636f 6e66 6967 5f74 7765 616b 6564  e=config_tweaked
+00016a10: 2e48 425f 616d 706c 6974 7564 652a 320a  .HB_amplitude*2.
+00016a20: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016a30: 2020 7265 7375 6c74 2c20 6466 5f6f 7574    result, df_out
+00016a40: 2c20 795f 6265 7374 5f66 6974 2c20 785f  , y_best_fit, x_
+00016a50: 6c69 6e2c 2063 6f6d 706f 6e65 6e74 732c  lin, components,
+00016a60: 2078 6461 742c 2079 6461 742c 2061 7831   xdat, ydat, ax1
+00016a70: 5f78 6c69 6d2c 2061 7832 5f78 6c69 6d2c  _xlim, ax2_xlim,
+00016a80: 7265 7369 6475 616c 5f64 6961 645f 636f  residual_diad_co
+00016a90: 6f72 6473 2c20 7964 6174 5f69 6e72 616e  ords, ydat_inran
+00016aa0: 6765 2c20 2078 6461 745f 696e 7261 6e67  ge,  xdat_inrang
+00016ab0: 653d 6669 745f 6761 7573 7369 616e 5f76  e=fit_gaussian_v
+00016ac0: 6f69 6774 5f67 656e 6572 6963 5f64 6961  oigt_generic_dia
+00016ad0: 6428 636f 6e66 6967 5f74 7765 616b 6564  d(config_tweaked
+00016ae0: 322c 2064 6961 6432 3d54 7275 652c 2070  2, diad2=True, p
+00016af0: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+00016b00: 6d65 3d66 696c 656e 616d 652c 0a20 2020  me=filename,.   
+00016b10: 2020 2020 2020 2020 2078 6461 743d 785f           xdat=x_
+00016b20: 6469 6164 322c 2079 6461 743d 795f 636f  diad2, ydat=y_co
+00016b30: 7272 5f64 6961 6432 2c20 7370 616e 3d73  rr_diad2, span=s
+00016b40: 7061 6e5f 6469 6164 322c 2070 6c6f 745f  pan_diad2, plot_
+00016b50: 6669 6775 7265 3d46 616c 7365 2c20 4469  figure=False, Di
+00016b60: 6164 5f70 6f73 3d44 6961 645f 706f 732c  ad_pos=Diad_pos,
+00016b70: 2048 425f 706f 733d 4842 5f70 6f73 2c20   HB_pos=HB_pos, 
+00016b80: 4331 335f 706f 733d 4331 335f 706f 732c  C13_pos=C13_pos,
+00016b90: 2066 6974 5f70 6561 6b73 3d66 6974 5f70   fit_peaks=fit_p
+00016ba0: 6561 6b73 290a 2020 2020 2020 2020 2020  eaks).          
+00016bb0: 2020 2020 2020 693d 692b 310a 2020 2020        i=i+1.    
+00016bc0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00016bd0: 3e35 3a0a 2020 2020 2020 2020 2020 2020  >5:.            
+00016be0: 2020 2020 2020 2020 7072 696e 7428 2747          print('G
+00016bf0: 6f74 2074 6f20 3520 6974 6572 6174 6f69  ot to 5 iteratoi
+00016c00: 6e73 2061 6e64 2073 7469 6c6c 2063 6f75  ns and still cou
+00016c10: 6c64 6e74 2061 646a 7573 7420 7468 6520  ldnt adjust the 
+00016c20: 6669 7420 7061 7261 6d65 7465 7273 2729  fit parameters')
+00016c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016c40: 2020 2020 2062 7265 616b 0a0a 0a20 2020       break...   
+00016c50: 2023 2067 6574 2061 2062 6573 7420 6669   # get a best fi
+00016c60: 7420 746f 2074 6865 2062 6173 656c 696e  t to the baselin
+00016c70: 6520 7573 696e 6720 6120 6c69 6e73 7061  e using a linspa
+00016c80: 6365 2066 726f 6d20 7468 6520 7065 616b  ce from the peak
+00016c90: 2066 6974 7469 6e67 0a20 2020 2079 6261   fitting.    yba
+00016ca0: 7365 5f78 6c69 6e3d 5066 5f62 6173 656c  se_xlin=Pf_basel
+00016cb0: 696e 655f 6469 6164 3228 785f 6c69 6e29  ine_diad2(x_lin)
+00016cc0: 0a0a 2020 2020 2320 5765 2065 7874 7261  ..    # We extra
+00016cd0: 6374 2074 6865 2066 756c 6c20 7370 6563  ct the full spec
+00016ce0: 7472 6120 746f 2070 6c6f 7420 6174 2074  tra to plot at t
+00016cf0: 6865 2065 6e64 2c20 616e 6420 636f 6e76  he end, and conv
+00016d00: 6572 7420 746f 2061 2064 6174 6166 7261  ert to a datafra
+00016d10: 6d65 0a20 2020 2053 7065 6374 7261 5f64  me.    Spectra_d
+00016d20: 663d 6765 745f 6461 7461 2870 6174 683d  f=get_data(path=
+00016d30: 7061 7468 2c20 6669 6c65 6e61 6d65 3d66  path, filename=f
+00016d40: 696c 656e 616d 652c 2066 696c 6574 7970  ilename, filetyp
+00016d50: 653d 6669 6c65 7479 7065 290a 2020 2020  e=filetype).    
+00016d60: 5370 6563 7472 613d 6e70 2e61 7272 6179  Spectra=np.array
+00016d70: 2853 7065 6374 7261 5f64 6629 0a0a 0a0a  (Spectra_df)....
+00016d80: 2020 2020 2320 4d61 6b65 206e 6963 6520      # Make nice 
+00016d90: 6669 6775 7265 0a20 2020 2069 6620 706c  figure.    if pl
+00016da0: 6f74 5f66 6967 7572 6520 6973 2054 7275  ot_figure is Tru
+00016db0: 653a 0a0a 2020 2020 2020 2020 6669 6775  e:..        figu
+00016dc0: 7265 5f6d 6f73 6169 633d 2222 220a 2020  re_mosaic=""".  
+00016dd0: 2020 2020 2020 5859 0a20 2020 2020 2020        XY.       
+00016de0: 2041 420a 2020 2020 2020 2020 4344 0a20   AB.        CD. 
+00016df0: 2020 2020 2020 2045 450a 2020 2020 2020         EE.      
+00016e00: 2020 2222 220a 0a20 2020 2020 2020 2066    """..        f
+00016e10: 6967 2c61 7865 733d 706c 742e 7375 6270  ig,axes=plt.subp
+00016e20: 6c6f 745f 6d6f 7361 6963 286d 6f73 6169  lot_mosaic(mosai
+00016e30: 633d 6669 6775 7265 5f6d 6f73 6169 632c  c=figure_mosaic,
+00016e40: 2066 6967 7369 7a65 3d28 3132 2c20 3136   figsize=(12, 16
+00016e50: 2929 0a20 2020 2020 2020 2069 6620 6466  )).        if df
+00016e60: 5f6f 7574 5b27 4469 6164 325f 7265 6669  _out['Diad2_refi
+00016e70: 7427 5d20 6973 206e 6f74 2046 616c 7365  t'] is not False
+00016e80: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
+00016e90: 672e 7375 7074 6974 6c65 2827 4469 6164  g.suptitle('Diad
+00016ea0: 2032 2c20 6669 6c65 3d20 272b 2073 7472   2, file= '+ str
+00016eb0: 2866 696c 656e 616d 6529 202b 2027 205c  (filename) + ' \
+00016ec0: 6e27 202b 2073 7472 2864 665f 6f75 745b  n' + str(df_out[
+00016ed0: 2744 6961 6432 5f72 6566 6974 275d 2e69  'Diad2_refit'].i
+00016ee0: 6c6f 635b 305d 292c 2066 6f6e 7473 697a  loc[0]), fontsiz
+00016ef0: 653d 3136 2c20 783d 302e 352c 2079 3d31  e=16, x=0.5, y=1
+00016f00: 2e30 290a 2020 2020 2020 2020 656c 7365  .0).        else
+00016f10: 3a0a 2020 2020 2020 2020 2020 2020 6669  :.            fi
+00016f20: 672e 7375 7074 6974 6c65 2827 4469 6164  g.suptitle('Diad
+00016f30: 2032 2c20 6669 6c65 3d20 272b 2073 7472   2, file= '+ str
+00016f40: 2866 696c 656e 616d 6529 2c20 666f 6e74  (filename), font
+00016f50: 7369 7a65 3d31 362c 2078 3d30 2e35 2c20  size=16, x=0.5, 
+00016f60: 793d 312e 3029 0a20 2020 2020 2020 2023  y=1.0).        #
+00016f70: 2042 6163 6b67 726f 756e 6420 706c 6f74   Background plot
+00016f80: 2066 6f72 2072 6561 6c0a 0a20 2020 2020   for real..     
+00016f90: 2020 2023 2050 6c6f 7420 6265 7374 2066     # Plot best f
+00016fa0: 6974 206f 6e20 7468 6520 4c48 532c 2061  it on the LHS, a
+00016fb0: 6e64 2069 6e64 6976 6964 7561 6c20 6669  nd individual fi
+00016fc0: 7473 206f 6e20 7468 6520 5248 5320 6174  ts on the RHS at
+00016fd0: 2074 6865 2074 6f70 0a0a 2020 2020 2020   the top..      
+00016fe0: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
+00016ff0: 7469 746c 6528 2761 2920 4261 636b 6772  title('a) Backgr
+00017000: 6f75 6e64 2066 6974 2729 0a20 2020 2020  ound fit').     
+00017010: 2020 2061 7865 735b 2758 275d 2e70 6c6f     axes['X'].plo
+00017020: 7428 4469 6164 5b3a 2c20 305d 2c20 4469  t(Diad[:, 0], Di
+00017030: 6164 5b3a 2c20 315d 2c20 272d 272c 2063  ad[:, 1], '-', c
+00017040: 6f6c 6f72 3d27 6772 6579 2729 0a20 2020  olor='grey').   
+00017050: 2020 2020 2061 7865 735b 2758 275d 2e70       axes['X'].p
+00017060: 6c6f 7428 4469 6164 5f73 686f 7274 5f64  lot(Diad_short_d
+00017070: 6961 6432 5b3a 2c20 305d 2c20 4469 6164  iad2[:, 0], Diad
+00017080: 5f73 686f 7274 5f64 6961 6432 5b3a 2c20  _short_diad2[:, 
+00017090: 315d 2c20 272d 7227 2c20 6c61 6265 6c3d  1], '-r', label=
+000170a0: 2753 7065 6374 7261 2729 0a0a 2020 2020  'Spectra')..    
+000170b0: 2020 2020 2361 7865 735b 2758 275d 2e70      #axes['X'].p
+000170c0: 6c6f 7428 4261 7365 6c69 6e65 5b3a 2c20  lot(Baseline[:, 
+000170d0: 305d 2c20 4261 7365 6c69 6e65 5b3a 2c20  0], Baseline[:, 
+000170e0: 315d 2c20 272d 6227 2c20 6c61 6265 6c3d  1], '-b', label=
+000170f0: 2742 636b 2070 6f69 6e74 7327 290a 2020  'Bck points').  
+00017100: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+00017110: 706c 6f74 2842 6173 656c 696e 655f 6469  plot(Baseline_di
+00017120: 6164 325b 3a2c 2030 5d2c 2042 6173 656c  ad2[:, 0], Basel
+00017130: 696e 655f 6469 6164 325b 3a2c 2031 5d2c  ine_diad2[:, 1],
+00017140: 2027 2e62 272c 206c 6162 656c 3d27 6265   '.b', label='be
+00017150: 6c2e 2042 636b 2e20 7074 7327 290a 2020  l. Bck. pts').  
+00017160: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+00017170: 706c 6f74 2844 6961 645f 7368 6f72 745f  plot(Diad_short_
+00017180: 6469 6164 325b 3a2c 2030 5d2c 2050 795f  diad2[:, 0], Py_
+00017190: 6261 7365 5f64 6961 6432 2c20 272d 6b27  base_diad2, '-k'
+000171a0: 2c20 6c61 6265 6c3d 2762 636b 2e20 706f  , label='bck. po
+000171b0: 6c79 2066 6974 2729 0a0a 0a0a 2020 2020  ly fit')....    
+000171c0: 2020 2020 6178 315f 796d 696e 3d6e 702e      ax1_ymin=np.
+000171d0: 6d69 6e28 4261 7365 6c69 6e65 5f64 6961  min(Baseline_dia
+000171e0: 6432 5b3a 2c20 315d 292d 3130 2a6e 702e  d2[:, 1])-10*np.
+000171f0: 7374 6428 4261 7365 6c69 6e65 5f64 6961  std(Baseline_dia
+00017200: 6432 5b3a 2c20 315d 290a 2020 2020 2020  d2[:, 1]).      
+00017210: 2020 6178 315f 796d 6178 3d6e 702e 6d61    ax1_ymax=np.ma
+00017220: 7828 4261 7365 6c69 6e65 5f64 6961 6432  x(Baseline_diad2
+00017230: 5b3a 2c20 315d 292b 3130 2a6e 702e 7374  [:, 1])+10*np.st
+00017240: 6428 4261 7365 6c69 6e65 5f64 6961 6432  d(Baseline_diad2
+00017250: 5b3a 2c20 315d 290a 2020 2020 2020 2020  [:, 1]).        
+00017260: 6178 315f 786d 696e 3d63 6f6e 6669 6731  ax1_xmin=config1
+00017270: 2e6c 6f77 6572 5f62 636b 5f64 6961 6432  .lower_bck_diad2
+00017280: 5b30 5d2d 3330 0a20 2020 2020 2020 2061  [0]-30.        a
+00017290: 7831 5f78 6d61 783d 636f 6e66 6967 312e  x1_xmax=config1.
+000172a0: 7570 7065 725f 6263 6b5f 6469 6164 325b  upper_bck_diad2[
+000172b0: 315d 2b33 300a 2020 2020 2020 2020 2320  1]+30.        # 
+000172c0: 4164 6469 6e67 2070 6174 6368 6573 0a0a  Adding patches..
+000172d0: 0a20 2020 2020 2020 2072 6563 745f 6469  .        rect_di
+000172e0: 6164 325f 6231 3d70 6174 6368 6573 2e52  ad2_b1=patches.R
+000172f0: 6563 7461 6e67 6c65 2828 636f 6e66 6967  ectangle((config
+00017300: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+00017310: 325b 305d 2c20 6178 315f 796d 696e 292c  2[0], ax1_ymin),
+00017320: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
+00017330: 6b5f 6469 6164 325b 315d 2d63 6f6e 6669  k_diad2[1]-confi
+00017340: 6731 2e6c 6f77 6572 5f62 636b 5f64 6961  g1.lower_bck_dia
+00017350: 6432 5b30 5d2c 6178 315f 796d 6178 2d61  d2[0],ax1_ymax-a
+00017360: 7831 5f79 6d69 6e2c 0a20 2020 2020 2020  x1_ymin,.       
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
+00017390: 7468 3d31 2c65 6467 6563 6f6c 6f72 3d27  th=1,edgecolor='
+000173a0: 6e6f 6e65 272c 6661 6365 636f 6c6f 723d  none',facecolor=
+000173b0: 2763 7961 6e27 2c20 6c61 6265 6c3d 2773  'cyan', label='s
+000173c0: 656c 2e20 6263 6b2e 2072 6567 696f 6e27  el. bck. region'
+000173d0: 2c20 616c 7068 613d 302e 332c 207a 6f72  , alpha=0.3, zor
+000173e0: 6465 723d 3029 0a20 2020 2020 2020 2061  der=0).        a
+000173f0: 7865 735b 2758 275d 2e61 6464 5f70 6174  xes['X'].add_pat
+00017400: 6368 2872 6563 745f 6469 6164 325f 6231  ch(rect_diad2_b1
+00017410: 290a 2020 2020 2020 2020 7265 6374 5f64  ).        rect_d
+00017420: 6961 6432 5f62 323d 7061 7463 6865 732e  iad2_b2=patches.
+00017430: 5265 6374 616e 676c 6528 2863 6f6e 6669  Rectangle((confi
+00017440: 6731 2e75 7070 6572 5f62 636b 5f64 6961  g1.upper_bck_dia
+00017450: 6432 5b30 5d2c 2061 7831 5f79 6d69 6e29  d2[0], ax1_ymin)
+00017460: 2c63 6f6e 6669 6731 2e75 7070 6572 5f62  ,config1.upper_b
+00017470: 636b 5f64 6961 6432 5b31 5d2d 636f 6e66  ck_diad2[1]-conf
+00017480: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
+00017490: 6164 325b 305d 2c61 7831 5f79 6d61 782d  ad2[0],ax1_ymax-
+000174a0: 6178 315f 796d 696e 2c0a 2020 2020 2020  ax1_ymin,.      
+000174b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174c0: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
+000174d0: 6474 683d 312c 6564 6765 636f 6c6f 723d  dth=1,edgecolor=
+000174e0: 276e 6f6e 6527 2c66 6163 6563 6f6c 6f72  'none',facecolor
+000174f0: 3d27 6379 616e 272c 2061 6c70 6861 3d30  ='cyan', alpha=0
+00017500: 2e33 2c20 7a6f 7264 6572 3d30 290a 2020  .3, zorder=0).  
+00017510: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+00017520: 6164 645f 7061 7463 6828 7265 6374 5f64  add_patch(rect_d
+00017530: 6961 6432 5f62 3229 0a20 2020 2020 2020  iad2_b2).       
+00017540: 2061 7865 735b 2758 275d 2e73 6574 5f78   axes['X'].set_x
+00017550: 6c69 6d28 5b61 7831 5f78 6d69 6e2c 2061  lim([ax1_xmin, a
+00017560: 7831 5f78 6d61 785d 290a 2020 2020 2020  x1_xmax]).      
+00017570: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
+00017580: 796c 696d 285b 6178 315f 796d 696e 2c20  ylim([ax1_ymin, 
+00017590: 6178 315f 796d 6178 5d29 0a0a 2020 2020  ax1_ymax])..    
+000175a0: 2020 2020 6178 6573 5b27 5827 5d2e 7365      axes['X'].se
+000175b0: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
+000175c0: 6974 7927 290a 2020 2020 2020 2020 6178  ity').        ax
+000175d0: 6573 5b27 5927 5d2e 7365 745f 796c 6162  es['Y'].set_ylab
+000175e0: 656c 2827 496e 7465 6e73 6974 7927 290a  el('Intensity').
+000175f0: 2020 2020 2020 2020 6178 6573 5b27 5927          axes['Y'
+00017600: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
+00017610: 7665 6e75 6d62 6572 2729 0a20 2020 2020  venumber').     
+00017620: 2020 2061 7865 735b 2758 275d 2e6c 6567     axes['X'].leg
+00017630: 656e 6428 290a 0a0a 0a20 2020 2020 2020  end()....       
+00017640: 2061 7865 735b 2759 275d 2e73 6574 5f74   axes['Y'].set_t
+00017650: 6974 6c65 2827 6229 2042 6163 6b67 726f  itle('b) Backgro
+00017660: 756e 6420 7375 6274 7261 6374 6564 2073  und subtracted s
+00017670: 7065 6374 7261 2729 0a20 2020 2020 2020  pectra').       
+00017680: 2061 7865 735b 2759 275d 2e70 6c6f 7428   axes['Y'].plot(
+00017690: 785f 6469 6164 322c 2079 5f63 6f72 725f  x_diad2, y_corr_
+000176a0: 6469 6164 322c 2027 2d72 2729 0a20 2020  diad2, '-r').   
+000176b0: 2020 2020 2068 6569 6768 745f 703d 6e70       height_p=np
+000176c0: 2e6d 6178 2844 6961 645f 7368 6f72 745f  .max(Diad_short_
+000176d0: 6469 6164 325b 3a2c 2031 5d29 2d6e 702e  diad2[:, 1])-np.
+000176e0: 6d69 6e28 4469 6164 5f73 686f 7274 5f64  min(Diad_short_d
+000176f0: 6961 6432 5b3a 2c20 315d 290a 2020 2020  iad2[:, 1]).    
+00017700: 2020 2020 6178 6573 5b27 5927 5d2e 7365      axes['Y'].se
+00017710: 745f 796c 696d 285b 6e70 2e6d 696e 2879  t_ylim([np.min(y
+00017720: 5f63 6f72 725f 6469 6164 3229 2c20 312e  _corr_diad2), 1.
+00017730: 322a 6865 6967 6874 5f70 205d 290a 2020  2*height_p ]).  
+00017740: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+00017750: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
+00017760: 6e75 6d62 6572 2729 0a0a 0a0a 2020 2020  number')....    
+00017770: 2020 2020 6178 6573 5b27 4127 5d2e 706c      axes['A'].pl
+00017780: 6f74 2878 6461 742c 2079 6461 742c 2020  ot(xdat, ydat,  
+00017790: 272e 6b27 2c20 6c61 6265 6c3d 2762 636b  '.k', label='bck
+000177a0: 2e20 7375 622e 2064 6174 6127 290a 2020  . sub. data').  
+000177b0: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+000177c0: 706c 6f74 2820 785f 6c69 6e20 2c79 5f62  plot( x_lin ,y_b
+000177d0: 6573 745f 6669 742c 2027 2d67 272c 206c  est_fit, '-g', l
+000177e0: 696e 6577 6964 7468 3d31 2c20 6c61 6265  inewidth=1, labe
+000177f0: 6c3d 2762 6573 7420 6669 7427 290a 2020  l='best fit').  
+00017800: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+00017810: 6c65 6765 6e64 2829 0a20 2020 2020 2020  legend().       
+00017820: 2061 7865 735b 2741 275d 2e73 6574 5f79   axes['A'].set_y
+00017830: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
+00017840: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
+00017850: 2741 275d 2e73 6574 5f78 6c61 6265 6c28  'A'].set_xlabel(
+00017860: 2757 6176 656e 756d 6265 7227 290a 2020  'Wavenumber').  
+00017870: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+00017880: 7365 745f 786c 696d 2861 7831 5f78 6c69  set_xlim(ax1_xli
+00017890: 6d29 0a20 2020 2020 2020 2061 7865 735b  m).        axes[
+000178a0: 2741 275d 2e73 6574 5f74 6974 6c65 2827  'A'].set_title('
+000178b0: 6329 204f 7665 7261 6c6c 2042 6573 7420  c) Overall Best 
+000178c0: 4669 7427 290a 0a20 2020 2023 2069 6e64  Fit')..    # ind
+000178d0: 6976 6964 7561 6c20 6669 7473 0a20 2020  ividual fits.   
+000178e0: 2020 2020 2061 7865 735b 2742 275d 2e70       axes['B'].p
+000178f0: 6c6f 7428 7864 6174 2c20 7964 6174 2c20  lot(xdat, ydat, 
+00017900: 272e 6b27 290a 0a20 2020 2020 2020 2023  '.k')..        #
+00017910: 2054 6869 7320 6973 2066 6f72 2069 6620   This is for if 
+00017920: 7468 6572 6520 6973 206d 6f72 6520 7468  there is more th
+00017930: 616e 2031 2070 6561 6b2c 2074 6869 7320  an 1 peak, this 
+00017940: 6973 2077 6865 6e20 7765 2077 616e 7420  is when we want 
+00017950: 746f 2070 6c6f 7420 7468 6520 6265 7374  to plot the best
+00017960: 2066 6974 0a0a 2020 2020 2020 2020 6966   fit..        if
+00017970: 2066 6974 5f70 6561 6b73 3e31 3a0a 0a0a   fit_peaks>1:...
+00017980: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00017990: 5b27 4227 5d2e 706c 6f74 2878 5f6c 696e  ['B'].plot(x_lin
+000179a0: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
+000179b0: 2827 6c7a 325f 2729 2c20 272d 7227 2c20  ('lz2_'), '-r', 
+000179c0: 6c69 6e65 7769 6474 683d 322c 206c 6162  linewidth=2, lab
+000179d0: 656c 3d27 4842 3227 290a 0a20 2020 2020  el='HB2')..     
+000179e0: 2020 2061 7865 735b 2742 275d 2e70 6c6f     axes['B'].plo
+000179f0: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
+00017a00: 6e74 732e 6765 7428 276c 7a31 5f27 292c  nts.get('lz1_'),
+00017a10: 2027 2d62 272c 206c 696e 6577 6964 7468   '-b', linewidth
+00017a20: 3d32 2c20 6c61 6265 6c3d 2744 6961 6432  =2, label='Diad2
+00017a30: 2729 0a20 2020 2020 2020 2069 6620 636f  ').        if co
+00017a40: 6e66 6967 312e 6669 745f 6761 7573 7320  nfig1.fit_gauss 
+00017a50: 6973 206e 6f74 2046 616c 7365 3a0a 2020  is not False:.  
+00017a60: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
+00017a70: 4227 5d2e 706c 6f74 2878 5f6c 696e 2c20  B'].plot(x_lin, 
+00017a80: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
+00017a90: 626b 675f 2729 2c20 272d 6d27 2c20 6c61  bkg_'), '-m', la
+00017aa0: 6265 6c3d 2747 6175 7373 6961 6e20 6263  bel='Gaussian bc
+00017ab0: 6b27 2c20 6c69 6e65 7769 6474 683d 3229  k', linewidth=2)
+00017ac0: 0a20 2020 2020 2020 2023 6178 322e 706c  .        #ax2.pl
+00017ad0: 6f74 2878 6461 742c 2072 6573 756c 742e  ot(xdat, result.
+00017ae0: 6265 7374 5f66 6974 2c20 272d 6727 2c20  best_fit, '-g', 
+00017af0: 6c61 6265 6c3d 2762 6573 7420 6669 7427  label='best fit'
+00017b00: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+00017b10: 4227 5d2e 6c65 6765 6e64 2829 0a0a 2020  B'].legend()..  
+00017b20: 2020 2020 2020 6669 7473 7061 6e3d 6d61        fitspan=ma
+00017b30: 7828 795f 6265 7374 5f66 6974 292d 6d69  x(y_best_fit)-mi
+00017b40: 6e28 795f 6265 7374 5f66 6974 290a 2020  n(y_best_fit).  
+00017b50: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
+00017b60: 7365 745f 796c 696d 285b 6d69 6e28 795f  set_ylim([min(y_
+00017b70: 6265 7374 5f66 6974 292d 6669 7473 7061  best_fit)-fitspa
+00017b80: 6e2f 352c 206d 6178 2879 5f62 6573 745f  n/5, max(y_best_
+00017b90: 6669 7429 2b66 6974 7370 616e 2f35 5d29  fit)+fitspan/5])
+00017ba0: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
+00017bb0: 4227 5d2e 7365 745f 796c 6162 656c 2827  B'].set_ylabel('
+00017bc0: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+00017bd0: 2020 2020 6178 6573 5b27 4227 5d2e 7365      axes['B'].se
+00017be0: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
+00017bf0: 6d62 6572 2729 0a0a 0a20 2020 2020 2020  mber')...       
+00017c00: 2061 7865 735b 2742 275d 2e73 6574 5f78   axes['B'].set_x
+00017c10: 6c69 6d28 6178 325f 786c 696d 290a 0a20  lim(ax2_xlim).. 
+00017c20: 2020 2020 2020 2023 2044 6173 6865 6420         # Dashed 
+00017c30: 6c69 6e65 7320 736f 206d 6174 6368 6573  lines so matches
+00017c40: 2070 6172 7420 440a 0a20 2020 2020 2020   part D..       
+00017c50: 2061 7865 735b 2742 275d 2e70 6c6f 7428   axes['B'].plot(
+00017c60: 5b64 665f 6f75 745b 2744 6961 6432 5f56  [df_out['Diad2_V
+00017c70: 6f69 6774 5f43 656e 7427 5d2c 2064 665f  oigt_Cent'], df_
+00017c80: 6f75 745b 2744 6961 6432 5f56 6f69 6774  out['Diad2_Voigt
+00017c90: 5f43 656e 7427 5d5d 2c20 5b6e 702e 6d69  _Cent']], [np.mi
+00017ca0: 6e28 7964 6174 292c 206e 702e 6d61 7828  n(ydat), np.max(
+00017cb0: 7964 6174 295d 2c20 273a 6227 290a 0a0a  ydat)], ':b')...
+00017cc0: 2020 2020 2020 2020 6966 2066 6974 5f70          if fit_p
+00017cd0: 6561 6b73 3e3d 323a 0a20 2020 2020 2020  eaks>=2:.       
+00017ce0: 2020 2020 2020 2020 2061 7865 735b 2742           axes['B
+00017cf0: 275d 2e70 6c6f 7428 5b64 665f 6f75 745b  '].plot([df_out[
+00017d00: 2748 4232 5f43 656e 7427 5d2c 2064 665f  'HB2_Cent'], df_
+00017d10: 6f75 745b 2748 4232 5f43 656e 7427 5d5d  out['HB2_Cent']]
+00017d20: 2c20 5b6e 702e 6d69 6e28 7964 6174 292c  , [np.min(ydat),
+00017d30: 206e 702e 6d61 7828 7964 6174 295d 2c20   np.max(ydat)], 
+00017d40: 273a 7227 290a 0a20 2020 2020 2020 2061  ':r')..        a
+00017d50: 7865 735b 2742 275d 2e73 6574 5f74 6974  xes['B'].set_tit
+00017d60: 6c65 2827 6329 2046 6974 2043 6f6d 706f  le('c) Fit Compo
+00017d70: 6e65 6e74 7327 290a 0a20 2020 2020 2020  nents')..       
+00017d80: 2023 2042 6163 6b67 726f 756e 6420 6669   # Background fi
+00017d90: 740a 0a20 2020 2020 2020 2023 2046 6972  t..        # Fir
+00017da0: 7374 2c20 7365 7420 7570 2078 2061 6e64  st, set up x and
+00017db0: 2079 206c 696d 6974 7320 6f6e 2061 7869   y limits on axi
+00017dc0: 730a 0a20 2020 2020 2020 2069 6620 636f  s..        if co
+00017dd0: 6e66 6967 312e 785f 7261 6e67 655f 6261  nfig1.x_range_ba
+00017de0: 7365 6c69 6e65 2069 7320 6e6f 7420 4e6f  seline is not No
+00017df0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00017e00: 6178 635f 786d 696e 3d64 665f 6f75 745b  axc_xmin=df_out[
+00017e10: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
+00017e20: 7427 5d5b 305d 2d63 6f6e 6669 6731 2e78  t'][0]-config1.x
+00017e30: 5f72 616e 6765 5f62 6173 656c 696e 650a  _range_baseline.
+00017e40: 2020 2020 2020 2020 2020 2020 6178 635f              axc_
+00017e50: 786d 6178 3d64 665f 6f75 745b 2744 6961  xmax=df_out['Dia
+00017e60: 6432 5f56 6f69 6774 5f43 656e 7427 5d5b  d2_Voigt_Cent'][
+00017e70: 305d 2b63 6f6e 6669 6731 2e78 5f72 616e  0]+config1.x_ran
+00017e80: 6765 5f62 6173 656c 696e 650a 2020 2020  ge_baseline.    
+00017e90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00017ea0: 2020 2020 2020 6178 635f 786d 696e 3d63        axc_xmin=c
+00017eb0: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
+00017ec0: 5f64 6961 6432 5b30 5d0a 2020 2020 2020  _diad2[0].      
+00017ed0: 2020 2020 2020 6178 635f 786d 6178 3d63        axc_xmax=c
+00017ee0: 6f6e 6669 6731 2e75 7070 6572 5f62 636b  onfig1.upper_bck
+00017ef0: 5f64 6961 6432 5b31 5d0a 2020 2020 2020  _diad2[1].      
+00017f00: 2020 6178 635f 796d 696e 3d6e 702e 6d69    axc_ymin=np.mi
+00017f10: 6e28 4261 7365 6c69 6e65 5f64 6961 6432  n(Baseline_diad2
+00017f20: 5b3a 2c20 315d 292d 636f 6e66 6967 312e  [:, 1])-config1.
+00017f30: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+00017f40: 2f33 0a20 2020 2020 2020 2061 7863 5f79  /3.        axc_y
+00017f50: 6d61 783d 6e70 2e6d 6178 2842 6173 656c  max=np.max(Basel
+00017f60: 696e 655f 6469 6164 325b 3a2c 2031 5d29  ine_diad2[:, 1])
+00017f70: 2b63 6f6e 6669 6731 2e79 5f72 616e 6765  +config1.y_range
+00017f80: 5f62 6173 656c 696e 650a 0a20 2020 2020  _baseline..     
+00017f90: 2020 2072 6563 745f 6469 6164 325f 6231     rect_diad2_b1
+00017fa0: 3d70 6174 6368 6573 2e52 6563 7461 6e67  =patches.Rectang
+00017fb0: 6c65 2828 636f 6e66 6967 312e 6c6f 7765  le((config1.lowe
+00017fc0: 725f 6263 6b5f 6469 6164 325b 305d 2c61  r_bck_diad2[0],a
+00017fd0: 7863 5f79 6d69 6e29 2c63 6f6e 6669 6731  xc_ymin),config1
+00017fe0: 2e6c 6f77 6572 5f62 636b 5f64 6961 6432  .lower_bck_diad2
+00017ff0: 5b31 5d2d 636f 6e66 6967 312e 6c6f 7765  [1]-config1.lowe
+00018000: 725f 6263 6b5f 6469 6164 325b 305d 2c61  r_bck_diad2[0],a
+00018010: 7863 5f79 6d61 782d 6178 635f 796d 696e  xc_ymax-axc_ymin
+00018020: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018040: 2020 6c69 6e65 7769 6474 683d 312c 6564    linewidth=1,ed
+00018050: 6765 636f 6c6f 723d 276e 6f6e 6527 2c66  gecolor='none',f
+00018060: 6163 6563 6f6c 6f72 3d27 6379 616e 272c  acecolor='cyan',
+00018070: 206c 6162 656c 3d27 6263 6b27 2c20 616c   label='bck', al
+00018080: 7068 613d 302e 332c 207a 6f72 6465 723d  pha=0.3, zorder=
+00018090: 3029 0a0a 0a0a 2020 2020 2020 2020 6178  0)....        ax
+000180a0: 6573 5b27 4327 5d2e 7365 745f 7469 746c  es['C'].set_titl
+000180b0: 6528 2764 2920 5065 616b 7320 6f76 6572  e('d) Peaks over
+000180c0: 6c61 696e 206f 6e20 6461 7461 2062 6566  lain on data bef
+000180d0: 6f72 6520 7375 6274 7261 6374 696f 6e27  ore subtraction'
+000180e0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+000180f0: 4327 5d2e 706c 6f74 2844 6961 645f 7368  C'].plot(Diad_sh
+00018100: 6f72 745f 6469 6164 325b 3a2c 2030 5d2c  ort_diad2[:, 0],
+00018110: 2044 6961 645f 7368 6f72 745f 6469 6164   Diad_short_diad
+00018120: 325b 3a2c 2031 5d2c 2027 2e72 272c 206c  2[:, 1], '.r', l
+00018130: 6162 656c 3d27 6461 7461 2729 0a20 2020  abel='data').   
+00018140: 2020 2020 2061 7865 735b 2743 275d 2e70       axes['C'].p
+00018150: 6c6f 7428 4261 7365 6c69 6e65 5f64 6961  lot(Baseline_dia
+00018160: 6432 5b3a 2c20 305d 2c20 4261 7365 6c69  d2[:, 0], Baseli
+00018170: 6e65 5f64 6961 6432 5b3a 2c20 315d 2c20  ne_diad2[:, 1], 
+00018180: 272e 6227 2c20 6c61 6265 6c3d 2762 636b  '.b', label='bck
+00018190: 2729 0a20 2020 2020 2020 2061 7865 735b  ').        axes[
+000181a0: 2743 275d 2e70 6c6f 7428 4469 6164 5f73  'C'].plot(Diad_s
+000181b0: 686f 7274 5f64 6961 6432 5b3a 2c20 305d  hort_diad2[:, 0]
+000181c0: 2c20 5079 5f62 6173 655f 6469 6164 322c  , Py_base_diad2,
+000181d0: 2027 2d6b 272c 206c 6162 656c 3d27 506f   '-k', label='Po
+000181e0: 6c79 2062 636b 2066 6974 2729 0a0a 0a20  ly bck fit')... 
+000181f0: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
+00018200: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+00018210: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+00018220: 2061 7865 735b 2743 275d 2e73 6574 5f78   axes['C'].set_x
+00018230: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
+00018240: 7227 290a 0a0a 2020 2020 2020 2020 6966  r')...        if
+00018250: 2063 6f6e 6669 6731 2e66 6974 5f67 6175   config1.fit_gau
+00018260: 7373 2069 7320 6e6f 7420 4661 6c73 653a  ss is not False:
+00018270: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00018280: 6573 5b27 4327 5d2e 706c 6f74 2878 5f6c  es['C'].plot(x_l
+00018290: 696e 2c20 636f 6d70 6f6e 656e 7473 2e67  in, components.g
+000182a0: 6574 2827 626b 675f 2729 2b79 6261 7365  et('bkg_')+ybase
+000182b0: 5f78 6c69 6e2c 2027 2d6d 272c 206c 6162  _xlin, '-m', lab
+000182c0: 656c 3d27 4761 7573 7369 616e 2062 636b  el='Gaussian bck
+000182d0: 272c 206c 696e 6577 6964 7468 3d32 290a  ', linewidth=2).
+000182e0: 0a20 2020 2020 2020 2061 7865 735b 2743  .        axes['C
+000182f0: 275d 2e70 6c6f 7428 2078 5f6c 696e 202c  '].plot( x_lin ,
+00018300: 795f 6265 7374 5f66 6974 2b79 6261 7365  y_best_fit+ybase
+00018310: 5f78 6c69 6e2c 2027 2d67 272c 206c 696e  _xlin, '-g', lin
+00018320: 6577 6964 7468 3d32 2c20 6c61 6265 6c3d  ewidth=2, label=
+00018330: 2742 6573 7420 4669 7427 290a 2020 2020  'Best Fit').    
+00018340: 2020 2020 6178 6573 5b27 4327 5d2e 706c      axes['C'].pl
+00018350: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
+00018360: 656e 7473 2e67 6574 2827 6c7a 315f 2729  ents.get('lz1_')
+00018370: 2b79 6261 7365 5f78 6c69 6e2c 2027 2d62  +ybase_xlin, '-b
+00018380: 272c 206c 6162 656c 3d27 4469 6164 3227  ', label='Diad2'
+00018390: 2c20 6c69 6e65 7769 6474 683d 3129 0a20  , linewidth=1). 
+000183a0: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
+000183b0: 616b 733e 313a 0a20 2020 2020 2020 2020  aks>1:.         
+000183c0: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
+000183d0: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
+000183e0: 6e74 732e 6765 7428 276c 7a32 5f27 292b  nts.get('lz2_')+
+000183f0: 7962 6173 655f 786c 696e 2c20 272d 7227  ybase_xlin, '-r'
+00018400: 2c20 6c61 6265 6c3d 2748 4232 272c 206c  , label='HB2', l
+00018410: 696e 6577 6964 7468 3d31 290a 2020 2020  inewidth=1).    
+00018420: 2020 2020 6966 2066 6974 5f70 6561 6b73      if fit_peaks
+00018430: 3e32 3a0a 2020 2020 2020 2020 2020 2020  >2:.            
+00018440: 6178 6573 5b27 4327 5d2e 706c 6f74 2878  axes['C'].plot(x
+00018450: 5f6c 696e 2c20 636f 6d70 6f6e 656e 7473  _lin, components
+00018460: 2e67 6574 2827 6c7a 335f 2729 2b79 6261  .get('lz3_')+yba
+00018470: 7365 5f78 6c69 6e2c 2027 2d63 272c 206c  se_xlin, '-c', l
+00018480: 6162 656c 3d27 4331 3327 2c20 6c69 6e65  abel='C13', line
+00018490: 7769 6474 683d 3129 0a0a 2020 2020 2020  width=1)..      
+000184a0: 2020 6178 6573 5b27 4327 5d2e 6c65 6765    axes['C'].lege
+000184b0: 6e64 286e 636f 6c3d 332c 206c 6f63 3d27  nd(ncol=3, loc='
+000184c0: 6c6f 7765 7220 6365 6e74 6572 2729 0a0a  lower center')..
+000184d0: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
+000184e0: 4327 5d2e 7365 745f 786c 696d 285b 6178  C'].set_xlim([ax
+000184f0: 635f 786d 696e 2c20 6178 635f 786d 6178  c_xmin, axc_xmax
+00018500: 5d29 0a20 2020 2020 2020 2061 7865 735b  ]).        axes[
+00018510: 2743 275d 2e73 6574 5f79 6c69 6d28 5b61  'C'].set_ylim([a
+00018520: 7863 5f79 6d69 6e2c 2061 7863 5f79 6d61  xc_ymin, axc_yma
+00018530: 785d 290a 2020 2020 2020 2020 2361 7865  x]).        #axe
+00018540: 735b 2743 275d 2e70 6c6f 7428 4469 6164  s['C'].plot(Diad
+00018550: 5f73 686f 7274 5b3a 2c20 305d 2c20 4469  _short[:, 0], Di
+00018560: 6164 5f73 686f 7274 5b3a 2c20 315d 2c20  ad_short[:, 1], 
+00018570: 2722 7227 2c20 6c61 6265 6c3d 2744 6174  '"r', label='Dat
+00018580: 6127 290a 0a0a 2020 2020 2020 2020 2320  a')...        # 
+00018590: 5265 7369 6475 616c 206f 6e20 706c 6f74  Residual on plot
+000185a0: 2044 0a20 2020 2020 2020 2061 7865 735b   D.        axes[
+000185b0: 2744 275d 2e73 6574 5f74 6974 6c65 2827  'D'].set_title('
+000185c0: 6629 2052 6573 6964 7561 6c73 2729 0a20  f) Residuals'). 
+000185d0: 2020 2020 2020 2061 7865 735b 2744 275d         axes['D']
+000185e0: 2e70 6c6f 7428 5b64 665f 6f75 745b 2744  .plot([df_out['D
+000185f0: 6961 6432 5f56 6f69 6774 5f43 656e 7427  iad2_Voigt_Cent'
+00018600: 5d2c 2064 665f 6f75 745b 2744 6961 6432  ], df_out['Diad2
+00018610: 5f56 6f69 6774 5f43 656e 7427 5d5d 2c20  _Voigt_Cent']], 
+00018620: 5b6e 702e 6d69 6e28 7265 7369 6475 616c  [np.min(residual
+00018630: 5f64 6961 645f 636f 6f72 6473 292c 206e  _diad_coords), n
+00018640: 702e 6d61 7828 7265 7369 6475 616c 5f64  p.max(residual_d
+00018650: 6961 645f 636f 6f72 6473 295d 2c20 273a  iad_coords)], ':
+00018660: 6227 290a 2020 2020 2020 2020 6966 2066  b').        if f
+00018670: 6974 5f70 6561 6b73 3e31 3a0a 2020 2020  it_peaks>1:.    
+00018680: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00018690: 5b27 4427 5d2e 706c 6f74 285b 6466 5f6f  ['D'].plot([df_o
+000186a0: 7574 5b27 4842 325f 4365 6e74 275d 2c20  ut['HB2_Cent'], 
+000186b0: 6466 5f6f 7574 5b27 4842 325f 4365 6e74  df_out['HB2_Cent
+000186c0: 275d 5d2c 205b 6e70 2e6d 696e 2872 6573  ']], [np.min(res
+000186d0: 6964 7561 6c5f 6469 6164 5f63 6f6f 7264  idual_diad_coord
+000186e0: 7329 2c20 6e70 2e6d 6178 2872 6573 6964  s), np.max(resid
+000186f0: 7561 6c5f 6469 6164 5f63 6f6f 7264 7329  ual_diad_coords)
+00018700: 5d2c 2027 3a72 2729 0a0a 2020 2020 2020  ], ':r')..      
+00018710: 2020 6178 6573 5b27 4427 5d2e 706c 6f74    axes['D'].plot
+00018720: 2878 6461 745f 696e 7261 6e67 652c 2072  (xdat_inrange, r
+00018730: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
+00018740: 7264 732c 2027 6f6b 272c 206d 6663 3d27  rds, 'ok', mfc='
+00018750: 6327 2029 0a20 2020 2020 2020 2061 7865  c' ).        axe
+00018760: 735b 2744 275d 2e70 6c6f 7428 7864 6174  s['D'].plot(xdat
+00018770: 5f69 6e72 616e 6765 2c20 7265 7369 6475  _inrange, residu
+00018780: 616c 5f64 6961 645f 636f 6f72 6473 2c20  al_diad_coords, 
+00018790: 272d 6327 2029 0a20 2020 2020 2020 2061  '-c' ).        a
+000187a0: 7865 735b 2744 275d 2e73 6574 5f79 6c61  xes['D'].set_yla
+000187b0: 6265 6c28 2752 6573 6964 7561 6c27 290a  bel('Residual').
+000187c0: 2020 2020 2020 2020 6178 6573 5b27 4427          axes['D'
+000187d0: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
+000187e0: 7665 6e75 6d62 6572 2729 0a20 2020 2020  venumber').     
+000187f0: 2020 2023 2061 7865 735b 2744 275d 2e73     # axes['D'].s
+00018800: 6574 5f78 6c69 6d28 6178 315f 786c 696d  et_xlim(ax1_xlim
+00018810: 290a 2020 2020 2020 2020 2320 6178 6573  ).        # axes
+00018820: 5b27 4427 5d2e 7365 745f 786c 696d 2861  ['D'].set_xlim(a
+00018830: 7832 5f78 6c69 6d29 0a20 2020 2020 2020  x2_xlim).       
+00018840: 204c 6f63 616c 5f52 6573 6964 7561 6c5f   Local_Residual_
+00018850: 6469 6164 323d 7265 7369 6475 616c 5f64  diad2=residual_d
+00018860: 6961 645f 636f 6f72 6473 5b28 2878 6461  iad_coords[((xda
+00018870: 745f 696e 7261 6e67 653e 2864 665f 6f75  t_inrange>(df_ou
+00018880: 745b 2744 6961 6432 5f56 6f69 6774 5f43  t['Diad2_Voigt_C
+00018890: 656e 7427 5d5b 305d 2d63 6f6e 6669 6731  ent'][0]-config1
+000188a0: 2e78 5f72 616e 6765 5f72 6573 6964 7561  .x_range_residua
+000188b0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188e0: 2020 2020 2628 7864 6174 5f69 6e72 616e      &(xdat_inran
+000188f0: 6765 3c64 665f 6f75 745b 2744 6961 6432  ge<df_out['Diad2
+00018900: 5f56 6f69 6774 5f43 656e 7427 5d5b 305d  _Voigt_Cent'][0]
+00018910: 2b63 6f6e 6669 6731 2e78 5f72 616e 6765  +config1.x_range
+00018920: 5f72 6573 6964 7561 6c29 295d 0a20 2020  _residual))].   
+00018930: 2020 2020 2061 7865 735b 2744 275d 2e73       axes['D'].s
+00018940: 6574 5f78 6c69 6d28 5b64 665f 6f75 745b  et_xlim([df_out[
+00018950: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
+00018960: 7427 5d5b 305d 2d63 6f6e 6669 6731 2e78  t'][0]-config1.x
+00018970: 5f72 616e 6765 5f72 6573 6964 7561 6c2c  _range_residual,
+00018980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018990: 2020 2020 2064 665f 6f75 745b 2744 6961       df_out['Dia
+000189a0: 6432 5f56 6f69 6774 5f43 656e 7427 5d5b  d2_Voigt_Cent'][
+000189b0: 305d 2b63 6f6e 6669 6731 2e78 5f72 616e  0]+config1.x_ran
+000189c0: 6765 5f72 6573 6964 7561 6c5d 290a 2020  ge_residual]).  
+000189d0: 2020 2020 2020 2361 7835 2e70 6c6f 7428        #ax5.plot(
+000189e0: 5b63 656e 745f 3131 3137 2c20 6365 6e74  [cent_1117, cent
+000189f0: 5f31 3131 3720 5d2c 205b 6e70 2e6d 696e  _1117 ], [np.min
+00018a00: 284c 6f63 616c 5f52 6573 6964 7561 6c5f  (Local_Residual_
+00018a10: 3131 3137 292d 3130 2c20 6e70 2e6d 6178  1117)-10, np.max
+00018a20: 284c 6f63 616c 5f52 6573 6964 7561 6c5f  (Local_Residual_
+00018a30: 3131 3137 292b 3130 5d2c 2027 3a6b 2729  1117)+10], ':k')
+00018a40: 0a20 2020 2020 2020 2061 7865 735b 2744  .        axes['D
+00018a50: 275d 2e73 6574 5f79 6c69 6d28 5b6e 702e  '].set_ylim([np.
+00018a60: 6d69 6e28 4c6f 6361 6c5f 5265 7369 6475  min(Local_Residu
+00018a70: 616c 5f64 6961 6432 292d 3130 2c20 6e70  al_diad2)-10, np
+00018a80: 2e6d 6178 284c 6f63 616c 5f52 6573 6964  .max(Local_Resid
+00018a90: 7561 6c5f 6469 6164 3229 2b31 305d 290a  ual_diad2)+10]).
+00018aa0: 0a0a 0a0a 0a20 2020 2020 2020 2023 204f  .....        # O
+00018ab0: 7665 7261 6c20 7370 6563 7472 610a 2020  veral spectra.  
+00018ac0: 2020 2020 2020 6178 6573 5b27 4527 5d2e        axes['E'].
+00018ad0: 7365 745f 7469 746c 6528 2767 2920 5375  set_title('g) Su
+00018ae0: 6d6d 6172 7920 706c 6f74 206f 6620 7261  mmary plot of ra
+00018af0: 7720 7370 6563 7472 6120 666f 7220 6669  w spectra for fi
+00018b00: 6c65 203d 2027 202b 2066 696c 656e 616d  le = ' + filenam
+00018b10: 6529 0a20 2020 2020 2020 2061 7865 735b  e).        axes[
+00018b20: 2745 275d 2e70 6c6f 7428 5370 6563 7472  'E'].plot(Spectr
+00018b30: 615b 3a2c 2030 5d2c 2053 7065 6374 7261  a[:, 0], Spectra
+00018b40: 5b3a 2c20 315d 2c20 272d 7227 290a 2020  [:, 1], '-r').  
+00018b50: 2020 2020 2020 6178 6573 5b27 4527 5d2e        axes['E'].
+00018b60: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+00018b70: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+00018b80: 6178 6573 5b27 4527 5d2e 7365 745f 786c  axes['E'].set_xl
+00018b90: 6162 656c 2827 5761 7665 6e75 6d62 6572  abel('Wavenumber
+00018ba0: 2729 0a0a 0a0a 0a20 2020 2020 2020 2070  ').....        p
+00018bb0: 6174 6833 3d70 6174 682b 272f 272b 2764  ath3=path+'/'+'d
+00018bc0: 6961 645f 6669 745f 696d 6167 6573 270a  iad_fit_images'.
+00018bd0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00018be0: 7468 2e65 7869 7374 7328 7061 7468 3329  th.exists(path3)
+00018bf0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+00018c00: 743d 2770 6174 6820 6578 6973 7473 270a  t='path exists'.
+00018c10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018c20: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+00018c30: 6564 6972 7328 7061 7468 2b27 2f27 2b20  edirs(path+'/'+ 
+00018c40: 2764 6961 645f 6669 745f 696d 6167 6573  'diad_fit_images
+00018c50: 272c 2065 7869 7374 5f6f 6b3d 4661 6c73  ', exist_ok=Fals
+00018c60: 6529 0a0a 2020 2020 2020 2020 6669 672e  e)..        fig.
+00018c70: 7469 6768 745f 6c61 796f 7574 2829 0a0a  tight_layout()..
+00018c80: 2020 2020 2020 2020 6669 6c65 3d66 696c          file=fil
+00018c90: 656e 616d 652e 7273 706c 6974 2827 2e74  ename.rsplit('.t
+00018ca0: 7874 272c 2031 295b 305d 0a20 2020 2020  xt', 1)[0].     
+00018cb0: 2020 2066 6967 2e73 6176 6566 6967 2870     fig.savefig(p
+00018cc0: 6174 6833 2b27 2f27 2b27 6469 6164 325f  ath3+'/'+'diad2_
+00018cd0: 4669 745f 7b7d 2e70 6e67 272e 666f 726d  Fit_{}.png'.form
+00018ce0: 6174 2866 696c 6529 2c20 6470 693d 636f  at(file), dpi=co
+00018cf0: 6e66 6967 312e 6470 6929 0a0a 0a20 2020  nfig1.dpi)...   
+00018d00: 2069 6620 636c 6f73 655f 6669 6775 7265   if close_figure
+00018d10: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+00018d20: 2020 706c 742e 636c 6f73 6528 6669 6729    plt.close(fig)
+00018d30: 0a0a 0a0a 2020 2020 6966 2020 636f 6e66  ....    if  conf
+00018d40: 6967 312e 7265 7475 726e 5f6f 7468 6572  ig1.return_other
+00018d50: 5f70 6172 616d 7320 6973 2046 616c 7365  _params is False
+00018d60: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00018d70: 2064 665f 6f75 740a 2020 2020 656c 7365   df_out.    else
+00018d80: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00018d90: 2064 665f 6f75 742c 2072 6573 756c 742c   df_out, result,
+00018da0: 2079 5f62 6573 745f 6669 742c 2078 5f6c   y_best_fit, x_l
+00018db0: 696e 0a0a 0a0a 0a64 6566 2066 6974 5f64  in.....def fit_d
+00018dc0: 6961 645f 315f 775f 6263 6b28 2a2c 2063  iad_1_w_bck(*, c
+00018dd0: 6f6e 6669 6731 3a20 6469 6164 315f 6669  onfig1: diad1_fi
+00018de0: 745f 636f 6e66 6967 3d64 6961 6431 5f66  t_config=diad1_f
+00018df0: 6974 5f63 6f6e 6669 6728 292c 2063 6f6e  it_config(), con
+00018e00: 6669 6732 3a20 6469 6164 5f69 645f 636f  fig2: diad_id_co
+00018e10: 6e66 6967 3d64 6961 645f 6964 5f63 6f6e  nfig=diad_id_con
+00018e20: 6669 6728 292c 0a20 2020 2070 6174 683d  fig(),.    path=
+00018e30: 4e6f 6e65 2c20 6669 6c65 6e61 6d65 3d4e  None, filename=N
+00018e40: 6f6e 652c 2066 696c 6574 7970 653d 4e6f  one, filetype=No
+00018e50: 6e65 2c20 2070 6c6f 745f 6669 6775 7265  ne,  plot_figure
+00018e60: 3d54 7275 652c 2063 6c6f 7365 5f66 6967  =True, close_fig
+00018e70: 7572 653d 5472 7565 2c20 4469 6164 5f70  ure=True, Diad_p
+00018e80: 6f73 3d4e 6f6e 652c 2048 425f 706f 733d  os=None, HB_pos=
+00018e90: 4e6f 6e65 293a 0a20 2020 2022 2222 2054  None):.    """ T
+00018ea0: 6869 7320 6675 6e63 7469 6f6e 2066 6974  his function fit
+00018eb0: 7320 7468 6520 6261 636b 6772 6f75 6e64  s the background
+00018ec0: 2028 7573 696e 6720 7468 6520 6675 6e63   (using the func
+00018ed0: 7469 6f6e 2072 656d 6f76 655f 6469 6164  tion remove_diad
+00018ee0: 5f62 6173 656c 696e 6529 2061 6e64 2074  _baseline) and t
+00018ef0: 6865 6e20 6669 7473 2074 6865 2070 6561  hen fits the pea
+00018f00: 6b73 2075 7369 6e67 2066 6974 5f67 6175  ks using fit_gau
+00018f10: 7373 6961 6e5f 766f 6967 745f 6765 6e65  ssian_voigt_gene
+00018f20: 7269 635f 6469 6164 2829 0a20 2020 2049  ric_diad().    I
+00018f30: 7420 7468 656e 2063 6865 636b 7320 6966  t then checks if
+00018f40: 2061 6e79 2070 6172 616d 6574 6572 7320   any parameters 
+00018f50: 6172 6520 7269 6768 7420 6174 2074 6865  are right at the
+00018f60: 2070 6572 6d69 7474 6564 2065 6467 6520   permitted edge 
+00018f70: 286d 6561 6e69 6e67 2066 6974 7469 6e67  (meaning fitting
+00018f80: 2064 6964 6e74 2063 6f6e 7665 7267 6529   didnt converge)
+00018f90: 2c20 616e 6420 7472 6965 7320 6669 7474  , and tries fitt
+00018fa0: 696e 6720 6966 2073 6f2e 2054 6865 6e20  ing if so. Then 
+00018fb0: 6974 206d 616b 6573 2061 2070 6c6f 740a  it makes a plot.
+00018fc0: 2020 2020 6f66 2074 6865 2076 6172 696f      of the vario
+00018fd0: 7573 2070 6172 7473 206f 6620 7468 6520  us parts of the 
+00018fe0: 6669 7474 696e 6720 7072 6f63 6564 7572  fitting procedur
+00018ff0: 652c 2061 6e64 2072 6574 7572 6e73 2061  e, and returns a
+00019000: 2064 6174 6166 7261 6d65 206f 6620 7468   dataframe of th
+00019010: 6520 6669 7420 7061 7261 6d65 7465 7273  e fit parameters
+00019020: 2e0a 0a0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
+00019030: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00019040: 2d2d 0a20 2020 2063 6f6e 6669 6731 3a20  --.    config1: 
+00019050: 6279 2064 6566 6175 6c74 2075 7365 7320  by default uses 
+00019060: 6469 6164 315f 6669 745f 636f 6e66 6967  diad1_fit_config
+00019070: 2829 2e20 4f70 7469 6f6e 7320 746f 2065  (). Options to e
+00019080: 6469 7420 7769 7468 696e 2074 6869 733a  dit within this:
+00019090: 0a0a 2020 2020 2020 2020 4e5f 706f 6c79  ..        N_poly
+000190a0: 5f62 636b 5f64 6961 6431 3a20 696e 740a  _bck_diad1: int.
+000190b0: 2020 2020 2020 2020 2020 2020 6465 6772              degr
+000190c0: 6565 206f 6620 706f 6c79 6e6f 6d69 616c  ee of polynomial
+000190d0: 2074 6f20 6669 7420 746f 2074 6865 2062   to fit to the b
+000190e0: 6163 6b67 726f 756e 642e 0a0a 2020 2020  ackground...    
+000190f0: 2020 2020 6d6f 6465 6c5f 6e61 6d65 3a20      model_name: 
+00019100: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+00019110: 5768 6174 2074 7970 6520 6f66 2070 6561  What type of pea
+00019120: 6b20 796f 7520 7761 6e74 2074 6f20 6669  k you want to fi
+00019130: 742c 2065 6974 6865 7220 2750 7365 7564  t, either 'Pseud
+00019140: 6f56 6f69 6774 4d6f 6465 6c27 206f 7220  oVoigtModel' or 
+00019150: 2756 6f69 6774 4d6f 6465 6c27 0a0a 2020  'VoigtModel'..  
+00019160: 2020 2020 2020 6669 745f 7065 616b 733a        fit_peaks:
+00019170: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+00019180: 204e 756d 6265 7220 6f66 2070 6561 6b73   Number of peaks
+00019190: 2074 6f20 6669 742e 2031 203d 206a 7573   to fit. 1 = jus
+000191a0: 7420 6469 6164 2c20 323d 2064 6961 640a  t diad, 2= diad.
+000191b0: 0a20 2020 2020 2020 206c 6f77 6572 5f62  .        lower_b
+000191c0: 636b 5f64 6961 6431 2c20 7570 7065 725f  ck_diad1, upper_
+000191d0: 6263 6b5f 6469 6164 313a 205b 666c 6f61  bck_diad1: [floa
+000191e0: 742c 2066 6c6f 6174 5d0a 2020 2020 2020  t, float].      
+000191f0: 2020 2020 2020 6261 636b 6772 6f75 6e64        background
+00019200: 2070 6f73 6974 696f 6e20 746f 206c 6566   position to lef
+00019210: 7420 616e 6420 7269 6768 7420 6f66 206f  t and right of o
+00019220: 7665 7261 6c20 6469 6164 2072 6567 696f  veral diad regio
+00019230: 6e20 2869 6e63 2064 6961 642b 2d48 422b  n (inc diad+-HB+
+00019240: 2d43 3133 290a 0a20 2020 2020 2020 2066  -C13)..        f
+00019250: 6974 5f67 6175 7373 3a20 626f 6f6c 0a20  it_gauss: bool. 
+00019260: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00019270: 7565 2c20 6669 7473 2061 2067 6175 7373  ue, fits a gauss
+00019280: 6961 6e20 7065 616b 0a0a 2020 2020 2020  ian peak..      
+00019290: 2020 6761 7573 735f 616d 703a 2020 666c    gauss_amp:  fl
+000192a0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+000192b0: 4573 7469 6d61 7465 206f 6620 616d 706c  Estimate of ampl
+000192c0: 6974 7564 6520 6f66 2047 6175 7373 6961  itude of Gaussia
+000192d0: 6e20 7065 616b 2028 7765 2066 696e 6420  n peak (we find 
+000192e0: 6120 676f 6f64 2066 6972 7374 2067 7565  a good first gue
+000192f0: 7373 2069 7320 322a 2074 6865 2061 6273  ss is 2* the abs
+00019300: 6f6c 7574 6520 7072 6f6d 696e 656e 6365  olute prominence
+00019310: 206f 6620 7468 6520 4842 2070 6561 6b29   of the HB peak)
+00019320: 0a0a 2020 2020 2020 2020 6469 6164 5f73  ..        diad_s
+00019330: 6967 6d61 2c20 4842 5f73 6967 6d61 3a20  igma, HB_sigma: 
+00019340: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00019350: 2020 4573 7469 6d61 7465 206f 6620 7468    Estimate of th
+00019360: 6520 616d 706c 6974 7564 6520 6f66 2074  e amplitude of t
+00019370: 6865 2064 6961 6420 7065 616b 2f48 4220  he diad peak/HB 
+00019380: 7065 616b 0a0a 2020 2020 2020 2020 6469  peak..        di
+00019390: 6164 5f70 726f 6d2c 2048 425f 7072 6f6d  ad_prom, HB_prom
+000193a0: 2c20 4331 335f 7072 6f6d 3a20 666c 6f61  , C13_prom: floa
+000193b0: 740a 2020 2020 2020 2020 2020 2020 4573  t.            Es
+000193c0: 7469 6d61 7465 206f 6620 7072 6f6d 696e  timate of promin
+000193d0: 656e 6365 206f 6620 7065 616b 2e20 5573  ence of peak. Us
+000193e0: 6564 2061 6c6f 6e67 7369 6465 2073 6967  ed alongside sig
+000193f0: 6d61 2074 6f20 6573 7469 6d61 7465 2074  ma to estimate t
+00019400: 6865 2061 6d70 6c69 7475 6465 206f 6620  he amplitude of 
+00019410: 7468 6520 6469 6164 2074 6f20 6169 6420  the diad to aid 
+00019420: 7065 616b 2066 6974 7469 6e67 2e0a 0a0a  peak fitting....
+00019430: 2020 2020 2020 2020 6469 6164 5f73 6967          diad_sig
+00019440: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+00019450: 2c20 6469 6164 5f73 6967 6d61 5f6d 696e  , diad_sigma_min
+00019460: 5f61 6c6c 6f77 616e 6365 3a20 666c 6f61  _allowance: floa
+00019470: 740a 2020 2020 2020 2020 4842 5f73 6967  t.        HB_sig
+00019480: 6d61 5f6d 696e 5f61 6c6c 6f77 616e 6365  ma_min_allowance
+00019490: 2c20 4842 5f73 6967 6d61 5f6d 6178 5f61  , HB_sigma_max_a
+000194a0: 6c6c 6f77 616e 6365 3a20 666c 6f61 740a  llowance: float.
+000194b0: 2020 2020 2020 2020 2020 2020 4661 6374              Fact
+000194c0: 6f72 2074 6861 7420 7369 676d 6120 6f66  or that sigma of
+000194d0: 2070 6561 6b20 6973 2061 6c6c 6f77 6564   peak is allowed
+000194e0: 2074 6f20 6465 7669 6174 6520 6672 6f6d   to deviate from
+000194f0: 2031 7374 2067 7565 7373 2028 652e 672e   1st guess (e.g.
+00019500: 206d 6178 3d32 2c20 322a 2067 7565 7373   max=2, 2* guess
+00019510: 2c20 6d69 6e3d 302e 352c 2030 2e35 202a  , min=0.5, 0.5 *
+00019520: 2067 7565 7373 292e 0a0a 2020 2020 2020   guess)...      
+00019530: 2020 6469 6164 5f61 6d70 5f6d 696e 5f61    diad_amp_min_a
+00019540: 6c6c 6f77 616e 6365 2c20 6469 6164 5f61  llowance, diad_a
+00019550: 6d70 5f6d 696e 5f61 6c6c 6f77 616e 6365  mp_min_allowance
+00019560: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+00019570: 4842 5f61 6d70 5f6d 696e 5f61 6c6c 6f77  HB_amp_min_allow
+00019580: 616e 6365 2c20 4842 5f61 6d70 5f6d 6178  ance, HB_amp_max
+00019590: 5f61 6c6c 6f77 616e 6365 3a20 666c 6f61  _allowance: floa
+000195a0: 740a 2020 2020 2020 2020 2020 2020 4661  t.            Fa
+000195b0: 6374 6f72 2074 6861 7420 7468 6520 616d  ctor that the am
+000195c0: 706c 6974 7564 6520 6f66 2070 6561 6b20  plitude of peak 
+000195d0: 6973 2061 6c6c 6f77 6564 2074 6f20 6465  is allowed to de
+000195e0: 7669 6174 6520 6672 6f6d 2031 7374 2067  viate from 1st g
+000195f0: 7565 7373 2028 652e 672e 206d 6178 3d32  uess (e.g. max=2
+00019600: 2c20 322a 2067 7565 7373 2c20 6d69 6e3d  , 2* guess, min=
+00019610: 302e 352c 2030 2e35 202a 2067 7565 7373  0.5, 0.5 * guess
+00019620: 292e 0a0a 0a20 2020 2020 2020 2078 5f72  )....        x_r
+00019630: 616e 6765 5f62 6173 656c 696e 653a 2066  ange_baseline: f
+00019640: 6c6f 6174 206f 7220 4e6f 6e65 0a20 2020  loat or None.   
+00019650: 2020 2020 2020 2020 2053 6574 7320 7820           Sets x 
+00019660: 6c69 6d69 7420 6f66 2070 6c6f 7420 7368  limit of plot sh
+00019670: 6f77 696e 6720 6261 7365 6c69 6e65 7320  owing baselines 
+00019680: 746f 2064 6961 6420 6365 6e74 6572 202d  to diad center -
+00019690: 2078 5f72 616e 6765 5f62 6173 656c 696e   x_range_baselin
+000196a0: 652c 2061 6e64 202b 785f 7261 6e67 655f  e, and +x_range_
+000196b0: 6261 7365 6c69 6e65 0a0a 2020 2020 2020  baseline..      
+000196c0: 2020 795f 7261 6e67 655f 6261 7365 6c69    y_range_baseli
+000196d0: 6e65 3a20 666c 6f61 7420 6f72 204e 6f6e  ne: float or Non
+000196e0: 650a 2020 2020 2020 2020 2020 2020 5365  e.            Se
+000196f0: 7473 2079 2061 7869 7320 6f66 2062 6173  ts y axis of bas
+00019700: 656c 696e 6520 706c 6f74 2061 7320 6d69  eline plot as mi
+00019710: 6e69 6d75 6d20 6261 6c75 6520 6f66 2062  nimum balue of b
+00019720: 6173 656c 696e 6520 7265 6769 6f6e 202d  aseline region -
+00019730: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+00019740: 2f33 2c0a 2020 2020 2020 2020 2020 2020  /3,.            
+00019750: 616e 6420 7468 6520 7570 7065 7220 7661  and the upper va
+00019760: 6c75 6520 6173 206d 6178 2076 616c 7565  lue as max value
+00019770: 206f 6620 6261 7365 6c69 6e65 2072 6567   of baseline reg
+00019780: 696f 6e20 2b20 795f 7261 6e67 655f 6261  ion + y_range_ba
+00019790: 7365 6c69 6e65 0a20 2020 2020 2020 2020  seline.         
+000197a0: 2020 2042 6173 656c 696e 6520 7265 6769     Baseline regi
+000197b0: 6f6e 2069 7320 7468 6520 6465 6669 6e65  on is the define
+000197c0: 6420 7265 6769 6f6e 206f 6620 6261 7365  d region of base
+000197d0: 6c69 6e65 206d 696e 7573 2061 6e79 2070  line minus any p
+000197e0: 6f69 6e74 7320 6f75 7473 6964 6520 7468  oints outside th
+000197f0: 6520 7369 676d 6120 6669 6c74 6572 0a0a  e sigma filter..
+00019800: 2020 2020 2020 2020 785f 7261 6e67 655f          x_range_
+00019810: 7265 7369 6475 616c 3a20 666c 6f61 740a  residual: float.
+00019820: 2020 2020 2020 2020 2020 2020 4469 7374              Dist
+00019830: 616e 6365 2065 6974 6865 7220 7369 6465  ance either side
+00019840: 206f 6620 6469 6164 2063 656e 7465 7220   of diad center 
+00019850: 746f 2073 686f 7720 6f6e 2072 6573 6964  to show on resid
+00019860: 7561 6c20 706c 6f74 2e0a 0a20 2020 2020  ual plot...     
+00019870: 2020 2064 7069 3a20 666c 6f61 740a 2020     dpi: float.  
+00019880: 2020 2020 2020 2020 2020 6470 6920 746f            dpi to
+00019890: 2073 6176 6520 6669 6775 7265 2061 7420   save figure at 
+000198a0: 6f66 206f 7665 7261 6c6c 2066 6974 730a  of overall fits.
+000198b0: 0a20 2020 2063 6f6e 6669 6732 3a20 6469  .    config2: di
+000198c0: 6164 5f69 645f 636f 6e66 6967 2829 2066  ad_id_config() f
+000198d0: 696c 652e 204f 6e6c 7920 7468 696e 6720  ile. Only thing 
+000198e0: 6974 2075 7365 7320 6672 6f6d 2074 6869  it uses from thi
+000198f0: 7320 6973 2061 6e79 2065 7863 6c75 6465  s is any exclude
+00019900: 6420 7261 6e67 6573 0a0a 2020 2020 7061  d ranges..    pa
+00019910: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
+00019920: 466f 6c64 6572 2075 7365 7220 7769 7368  Folder user wish
+00019930: 6573 2074 6f20 7265 6164 2064 6174 6120  es to read data 
+00019940: 6672 6f6d 0a0a 2020 2020 6669 6c65 6e61  from..    filena
+00019950: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
+00019960: 5370 6563 6966 6963 206e 616d 6520 6f66  Specific name of
+00019970: 2066 696c 6520 6265 696e 6720 7573 6564   file being used
+00019980: 2e0a 0a20 2020 2066 696c 6574 7970 653a  ...    filetype:
+00019990: 2073 7472 0a20 2020 2020 2020 2049 6465   str.        Ide
+000199a0: 6e74 6966 6965 7320 7479 7065 206f 6620  ntifies type of 
+000199b0: 6669 6c65 2e20 6368 6f6f 7365 2066 726f  file. choose fro
+000199c0: 6d20 2757 6974 6563 5f41 5343 4949 272c  m 'Witec_ASCII',
+000199d0: 2027 6865 6164 6c65 7373 5f74 7874 272c   'headless_txt',
+000199e0: 2027 6865 6164 6c65 7373 5f63 7376 272c   'headless_csv',
+000199f0: 2027 6865 6164 5f63 7376 272c 2027 5769   'head_csv', 'Wi
+00019a00: 7465 635f 4153 4349 4927 2c0a 2020 2020  tec_ASCII',.    
+00019a10: 2020 2020 2748 4f52 4942 415f 7478 7427      'HORIBA_txt'
+00019a20: 2c20 2752 656e 6973 6861 775f 7478 7427  , 'Renishaw_txt'
+00019a30: 0a0a 2020 2020 706c 6f74 5f66 6967 7572  ..    plot_figur
+00019a40: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
+00019a50: 6966 2054 7275 652c 2073 6176 6573 2066  if True, saves f
+00019a60: 6967 7572 650a 0a20 2020 2044 6961 645f  igure..    Diad_
+00019a70: 706f 733a 2066 6c6f 6174 0a20 2020 2020  pos: float.     
+00019a80: 2020 2045 7374 696d 6174 6520 6f66 2064     Estimate of d
+00019a90: 6961 6420 706f 7369 7469 6f6e 0a0a 2020  iad position..  
+00019aa0: 2020 4842 5f70 6f73 3a20 666c 6f61 740a    HB_pos: float.
+00019ab0: 2020 2020 2020 2020 4573 7469 6d61 7465          Estimate
+00019ac0: 206f 6620 4842 2070 6f73 6974 696f 6e0a   of HB position.
+00019ad0: 0a0a 2020 2020 636c 6f73 655f 6669 673a  ..    close_fig:
+00019ae0: 2062 6f6f 6c0a 2020 2020 2020 2020 6966   bool.        if
+00019af0: 2054 7275 652c 2064 6973 706c 6179 7320   True, displays 
+00019b00: 6669 6775 7265 2069 6e20 4e6f 7465 626f  figure in Notebo
+00019b10: 6f6b 2e20 4966 2046 616c 7365 2c20 636c  ok. If False, cl
+00019b20: 6f73 6573 2069 7420 2879 6f75 2063 616e  oses it (you can
+00019b30: 2073 7469 6c6c 2066 696e 6420 6974 2073   still find it s
+00019b40: 6176 6564 290a 0a20 2020 2072 6574 7572  aved)..    retur
+00019b50: 6e5f 6f74 6865 725f 7061 7261 6d73 3a20  n_other_params: 
+00019b60: 626f 6f6c 2028 6465 6661 756c 7420 4661  bool (default Fa
+00019b70: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
+00019b80: 4661 6c73 652c 206a 7573 7420 7265 7475  False, just retu
+00019b90: 726e 7320 6120 6461 7461 6672 616d 6520  rns a dataframe 
+00019ba0: 6f66 2070 6561 6b20 7061 7261 6d65 7465  of peak paramete
+00019bb0: 7273 0a20 2020 2020 2020 2069 6620 5472  rs.        if Tr
+00019bc0: 7565 2c20 616c 736f 2072 6574 7572 6e73  ue, also returns
+00019bd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00019be0: 7375 6c74 3a20 6669 7420 7061 7261 6d65  sult: fit parame
+00019bf0: 7465 7273 0a20 2020 2020 2020 2020 2020  ters.           
+00019c00: 2079 5f62 6573 745f 6669 743a 2062 6573   y_best_fit: bes
+00019c10: 7420 6669 7420 746f 2061 6c6c 2063 7572  t fit to all cur
+00019c20: 7665 7320 696e 2079 0a20 2020 2020 2020  ves in y.       
+00019c30: 2020 2020 2078 5f6c 696e 3a20 6c69 6e73       x_lin: lins
+00019c40: 7061 6365 206f 6620 6265 7374 2066 6974  pace of best fit
+00019c50: 2063 6f6f 7264 696e 6174 6573 2069 6e20   coordinates in 
+00019c60: 782e 0a0a 2020 2020 5265 7475 726e 730a  x...    Returns.
+00019c70: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00019c80: 0a20 2020 2073 6565 2061 626f 7665 2e20  .    see above. 
+00019c90: 4465 7065 6e64 7320 696e 2072 6574 7572  Depends in retur
+00019ca0: 6e73 5f6f 7468 6572 5f70 6172 616d 730a  ns_other_params.
+00019cb0: 0a0a 2222 220a 0a20 2020 2066 6974 5f70  .."""..    fit_p
+00019cc0: 6561 6b73 3d63 6f6e 6669 6731 2e66 6974  eaks=config1.fit
+00019cd0: 5f70 6561 6b73 0a0a 2020 2020 6966 2066  _peaks..    if f
+00019ce0: 6974 5f70 6561 6b73 3d3d 323a 0a20 2020  it_peaks==2:.   
+00019cf0: 2020 2020 2069 6620 6e70 2e69 736e 616e       if np.isnan
+00019d00: 2848 425f 706f 7329 3d3d 5472 7565 206f  (HB_pos)==True o
+00019d10: 7220 636f 6e66 6967 312e 4842 5f70 726f  r config1.HB_pro
+00019d20: 6d3c 2d35 303a 0a20 2020 2020 2020 2020  m<-50:.         
+00019d30: 2020 2066 6974 5f70 6561 6b73 3d31 0a20     fit_peaks=1. 
+00019d40: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00019d50: 6731 2e66 6974 5f67 6175 7373 3d46 616c  g1.fit_gauss=Fal
+00019d60: 7365 0a20 2020 2020 2020 2020 2020 2023  se.            #
+00019d70: 7072 696e 7428 2745 6974 6865 7220 6e6f  print('Either no
+00019d80: 2068 6220 706f 7369 7469 6f6e 2c20 6f72   hb position, or
+00019d90: 2070 726f 6d69 6e65 6e63 653c 2d35 302c   prominence<-50,
+00019da0: 2075 7369 6e67 2031 2066 6974 2729 0a0a   using 1 fit')..
+00019db0: 2020 2020 4469 6164 5f64 663d 6765 745f      Diad_df=get_
+00019dc0: 6461 7461 2870 6174 683d 7061 7468 2c20  data(path=path, 
+00019dd0: 6669 6c65 6e61 6d65 3d66 696c 656e 616d  filename=filenam
+00019de0: 652c 2066 696c 6574 7970 653d 6669 6c65  e, filetype=file
+00019df0: 7479 7065 290a 2020 2020 4469 6164 3d6e  type).    Diad=n
+00019e00: 702e 6172 7261 7928 4469 6164 5f64 6629  p.array(Diad_df)
+00019e10: 0a20 2020 2023 2046 6972 7374 2c20 7765  .    # First, we
+00019e20: 2066 6565 6420 6461 7461 2069 6e74 6f20   feed data into 
+00019e30: 7468 6520 7265 6d6f 7665 2062 6173 656c  the remove basel
+00019e40: 696e 6520 6675 6e63 7469 6f6e 2c20 7768  ine function, wh
+00019e50: 6963 6820 7265 7475 726e 7320 636f 7272  ich returns corr
+00019e60: 6563 7465 6420 6461 7461 0a0a 2020 2020  ected data..    
+00019e70: 795f 636f 7272 5f64 6961 6431 2c20 5079  y_corr_diad1, Py
+00019e80: 5f62 6173 655f 6469 6164 312c 2078 5f64  _base_diad1, x_d
+00019e90: 6961 6431 2c20 2044 6961 645f 7368 6f72  iad1,  Diad_shor
+00019ea0: 745f 6469 6164 312c 2050 795f 6261 7365  t_diad1, Py_base
+00019eb0: 5f64 6961 6431 2c20 5066 5f62 6173 656c  _diad1, Pf_basel
+00019ec0: 696e 655f 6469 6164 312c 2020 4261 7365  ine_diad1,  Base
+00019ed0: 6c69 6e65 5f79 7375 625f 6469 6164 312c  line_ysub_diad1,
+00019ee0: 2042 6173 656c 696e 655f 785f 6469 6164   Baseline_x_diad
+00019ef0: 312c 2042 6173 656c 696e 655f 6469 6164  1, Baseline_diad
+00019f00: 312c 2073 7061 6e5f 6469 6164 313d 7265  1, span_diad1=re
+00019f10: 6d6f 7665 5f64 6961 645f 6261 7365 6c69  move_diad_baseli
+00019f20: 6e65 280a 2020 2070 6174 683d 7061 7468  ne(.   path=path
+00019f30: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+00019f40: 616d 652c 2066 696c 6574 7970 653d 6669  ame, filetype=fi
+00019f50: 6c65 7479 7065 2c20 6578 636c 7564 655f  letype, exclude_
+00019f60: 7261 6e67 6531 3d63 6f6e 6669 6732 2e65  range1=config2.e
+00019f70: 7863 6c75 6465 5f72 616e 6765 312c 2065  xclude_range1, e
+00019f80: 7863 6c75 6465 5f72 616e 6765 323d 636f  xclude_range2=co
+00019f90: 6e66 6967 322e 6578 636c 7564 655f 7261  nfig2.exclude_ra
+00019fa0: 6e67 6532 2c20 4e5f 706f 6c79 3d63 6f6e  nge2, N_poly=con
+00019fb0: 6669 6731 2e4e 5f70 6f6c 795f 6263 6b5f  fig1.N_poly_bck_
+00019fc0: 6469 6164 312c 0a20 2020 206c 6f77 6572  diad1,.    lower
+00019fd0: 5f62 636b 3d63 6f6e 6669 6731 2e6c 6f77  _bck=config1.low
+00019fe0: 6572 5f62 636b 5f64 6961 6431 2c20 7570  er_bck_diad1, up
+00019ff0: 7065 725f 6263 6b3d 636f 6e66 6967 312e  per_bck=config1.
+0001a000: 7570 7065 725f 6263 6b5f 6469 6164 312c  upper_bck_diad1,
+0001a010: 2070 6c6f 745f 6669 6775 7265 3d46 616c   plot_figure=Fal
+0001a020: 7365 290a 0a0a 0a0a 0a20 2020 2023 2054  se)......    # T
+0001a030: 6865 6e2c 2077 6520 6665 6564 2074 6869  hen, we feed thi
+0001a040: 7320 6261 7365 6c69 6e65 2d63 6f72 7265  s baseline-corre
+0001a050: 6374 6564 2064 6174 6120 696e 746f 2074  cted data into t
+0001a060: 6865 2063 6f6d 6269 6e65 6420 6761 7573  he combined gaus
+0001a070: 7369 616e 2d76 6f69 6774 2070 6561 6b20  sian-voigt peak 
+0001a080: 6669 7474 696e 6720 6675 6e63 7469 6f6e  fitting function
+0001a090: 0a0a 2020 2020 7265 7375 6c74 2c20 6466  ..    result, df
+0001a0a0: 5f6f 7574 2c20 795f 6265 7374 5f66 6974  _out, y_best_fit
+0001a0b0: 2c20 785f 6c69 6e2c 2063 6f6d 706f 6e65  , x_lin, compone
+0001a0c0: 6e74 732c 2078 6461 742c 2079 6461 742c  nts, xdat, ydat,
+0001a0d0: 2061 7831 5f78 6c69 6d2c 2061 7832 5f78   ax1_xlim, ax2_x
+0001a0e0: 6c69 6d2c 7265 7369 6475 616c 5f64 6961  lim,residual_dia
+0001a0f0: 645f 636f 6f72 6473 2c20 7964 6174 5f69  d_coords, ydat_i
+0001a100: 6e72 616e 6765 2c20 2078 6461 745f 696e  nrange,  xdat_in
+0001a110: 7261 6e67 653d 6669 745f 6761 7573 7369  range=fit_gaussi
+0001a120: 616e 5f76 6f69 6774 5f67 656e 6572 6963  an_voigt_generic
+0001a130: 5f64 6961 6428 636f 6e66 6967 312c 6469  _diad(config1,di
+0001a140: 6164 313d 5472 7565 2c20 7061 7468 3d70  ad1=True, path=p
+0001a150: 6174 682c 2066 696c 656e 616d 653d 6669  ath, filename=fi
+0001a160: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
+0001a170: 2020 2020 2020 2020 2020 2020 7864 6174              xdat
+0001a180: 3d78 5f64 6961 6431 2c20 7964 6174 3d79  =x_diad1, ydat=y
+0001a190: 5f63 6f72 725f 6469 6164 312c 0a20 2020  _corr_diad1,.   
+0001a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1b0: 2073 7061 6e3d 7370 616e 5f64 6961 6431   span=span_diad1
+0001a1c0: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
+0001a1d0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0001a1e0: 2020 2020 2020 2020 2044 6961 645f 706f           Diad_po
+0001a1f0: 733d 4469 6164 5f70 6f73 2c20 4842 5f70  s=Diad_pos, HB_p
+0001a200: 6f73 3d48 425f 706f 732c 6669 745f 7065  os=HB_pos,fit_pe
+0001a210: 616b 733d 6669 745f 7065 616b 7329 0a0a  aks=fit_peaks)..
+0001a220: 0a0a 2020 2020 2320 6966 2064 665f 6f75  ..    # if df_ou
+0001a230: 745b 2744 6961 6431 5f63 656e 745f 6572  t['Diad1_cent_er
+0001a240: 7227 5d2e 696c 6f63 5b30 5d3d 3d30 3a0a  r'].iloc[0]==0:.
+0001a250: 2020 2020 2320 2020 2020 6966 2063 6f6e      #     if con
+0001a260: 6669 6731 2e66 6974 5f70 6561 6b73 3e31  fig1.fit_peaks>1
+0001a270: 3a0a 2020 2020 2320 2020 2020 2020 2020  :.    #         
+0001a280: 636f 6e66 6967 5f74 7765 616b 6564 2e66  config_tweaked.f
+0001a290: 6974 5f70 6561 6b73 3d63 6f6e 6669 6731  it_peaks=config1
+0001a2a0: 2e66 6974 5f70 6561 6b73 2d31 0a20 2020  .fit_peaks-1.   
+0001a2b0: 2023 2020 2020 2020 2020 2070 7269 6e74   #         print
+0001a2c0: 2827 7265 6475 6369 6e67 2070 6561 6b73  ('reducing peaks
+0001a2d0: 2062 7920 3120 746f 2074 7279 2074 6f20   by 1 to try to 
+0001a2e0: 6765 7420 616e 2065 7272 6f72 2729 0a0a  get an error')..
+0001a2f0: 0a20 2020 2023 2054 7279 2052 6566 6974  .    # Try Refit
+0001a300: 7469 6e67 206f 6e63 650a 2020 2020 6966  ting once.    if
+0001a310: 2073 7472 2864 665f 6f75 745b 2744 6961   str(df_out['Dia
+0001a320: 6431 5f72 6566 6974 275d 2e69 6c6f 635b  d1_refit'].iloc[
+0001a330: 305d 2921 3d27 466c 6167 6765 6420 5761  0])!='Flagged Wa
+0001a340: 726e 696e 6773 3a27 3a0a 2020 2020 2020  rnings:':.      
+0001a350: 2020 7072 696e 7428 2772 6566 6974 2061    print('refit a
+0001a360: 7474 656d 7074 2031 2729 0a20 2020 2020  ttempt 1').     
+0001a370: 2020 2066 6163 746f 723d 320a 2020 2020     factor=2.    
+0001a380: 2020 2020 696d 706f 7274 2063 6f70 790a      import copy.
+0001a390: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001a3a0: 7765 616b 6564 3d63 6f6e 6669 6731 0a20  weaked=config1. 
+0001a3b0: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+0001a3c0: 6561 6b65 643d 636f 7079 2e63 6f70 7928  eaked=copy.copy(
+0001a3d0: 636f 6e66 6967 3129 0a0a 2020 2020 2020  config1)..      
+0001a3e0: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+0001a3f0: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
+0001a400: 7472 2e63 6f6e 7461 696e 7328 2720 4e6f  tr.contains(' No
+0001a410: 2045 7272 6f72 2729 293a 0a20 2020 2020   Error')):.     
+0001a420: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+0001a430: 312e 6669 745f 7065 616b 733e 323a 0a20  1.fit_peaks>2:. 
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001a450: 6f6e 6669 675f 7477 6561 6b65 642e 6669  onfig_tweaked.fi
+0001a460: 745f 7065 616b 733d 636f 6e66 6967 312e  t_peaks=config1.
+0001a470: 6669 745f 7065 616b 732d 310a 2020 2020  fit_peaks-1.    
+0001a480: 2020 2020 2020 2020 2020 2020 6669 745f              fit_
+0001a490: 7065 616b 733d 636f 6e66 6967 5f74 7765  peaks=config_twe
+0001a4a0: 616b 6564 2e66 6974 5f70 6561 6b73 0a0a  aked.fit_peaks..
+0001a4b0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+0001a4c0: 6466 5f6f 7574 5b27 4469 6164 315f 7265  df_out['Diad1_re
+0001a4d0: 6669 7427 5d2e 7374 722e 636f 6e74 6169  fit'].str.contai
+0001a4e0: 6e73 2827 565f 5369 676d 615f 746f 6f5f  ns('V_Sigma_too_
+0001a4f0: 4c6f 7727 2929 3a0a 2020 2020 2020 2020  Low')):.        
+0001a500: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+0001a510: 6564 2e64 6961 645f 7369 676d 613d 636f  ed.diad_sigma=co
+0001a520: 6e66 6967 312e 6469 6164 5f73 6967 6d61  nfig1.diad_sigma
+0001a530: 2a66 6163 746f 720a 2020 2020 2020 2020  *factor.        
+0001a540: 6966 2061 6e79 2864 665f 6f75 745b 2744  if any(df_out['D
+0001a550: 6961 6431 5f72 6566 6974 275d 2e73 7472  iad1_refit'].str
+0001a560: 2e63 6f6e 7461 696e 7328 2756 5f53 6967  .contains('V_Sig
+0001a570: 6d61 5f74 6f6f 5f48 6967 6827 2929 3a0a  ma_too_High')):.
+0001a580: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0001a590: 6967 5f74 7765 616b 6564 2e64 6961 645f  ig_tweaked.diad_
+0001a5a0: 7369 676d 613d 636f 6e66 6967 312e 6469  sigma=config1.di
+0001a5b0: 6164 5f73 6967 6d61 2f66 6163 746f 720a  ad_sigma/factor.
+0001a5c0: 2020 2020 2020 2020 2320 4761 7573 7369          # Gaussi
+0001a5d0: 616e 2066 6974 2062 6974 730a 2020 2020  an fit bits.    
+0001a5e0: 2020 2020 6966 2061 6e79 2864 665f 6f75      if any(df_ou
+0001a5f0: 745b 2744 6961 6431 5f72 6566 6974 275d  t['Diad1_refit']
+0001a600: 2e73 7472 2e63 6f6e 7461 696e 7328 2747  .str.contains('G
+0001a610: 5f69 6e70 7574 5f54 6f6f 4869 6768 5369  _input_TooHighSi
+0001a620: 676d 6127 2929 3a0a 2020 2020 2020 2020  gma')):.        
+0001a630: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+0001a640: 6564 2e67 6175 7373 5f73 6967 6d61 3d63  ed.gauss_sigma=c
+0001a650: 6f6e 6669 6731 2e67 6175 7373 5f73 6967  onfig1.gauss_sig
+0001a660: 6d61 2f66 6163 746f 720a 2020 2020 2020  ma/factor.      
+0001a670: 2020 6966 2061 6e79 2864 665f 6f75 745b    if any(df_out[
+0001a680: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
+0001a690: 7472 2e63 6f6e 7461 696e 7328 2747 5f69  tr.contains('G_i
+0001a6a0: 6e70 7574 5f54 6f6f 4c6f 7753 6967 6d61  nput_TooLowSigma
+0001a6b0: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
+0001a6c0: 2063 6f6e 6669 675f 7477 6561 6b65 642e   config_tweaked.
+0001a6d0: 6761 7573 735f 7369 676d 613d 636f 6e66  gauss_sigma=conf
+0001a6e0: 6967 312e 6761 7573 735f 7369 676d 612a  ig1.gauss_sigma*
+0001a6f0: 6661 6374 6f72 0a20 2020 2020 2020 2069  factor.        i
+0001a700: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
+0001a710: 6164 315f 7265 6669 7427 5d2e 7374 722e  ad1_refit'].str.
+0001a720: 636f 6e74 6169 6e73 2827 475f 696e 7075  contains('G_inpu
+0001a730: 745f 546f 6f4c 6f77 416d 7027 2929 3a0a  t_TooLowAmp')):.
+0001a740: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0001a750: 6967 5f74 7765 616b 6564 2e67 6175 7373  ig_tweaked.gauss
+0001a760: 5f61 6d70 6c69 7475 6465 3d63 6f6e 6669  _amplitude=confi
+0001a770: 6731 2e67 6175 7373 5f61 6d70 2a66 6163  g1.gauss_amp*fac
+0001a780: 746f 720a 2020 2020 2020 2020 6966 2061  tor.        if a
+0001a790: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
+0001a7a0: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+0001a7b0: 7461 696e 7328 2747 5f41 6d70 5f74 6f6f  tains('G_Amp_too
+0001a7c0: 5f68 6967 6827 2929 3a0a 2020 2020 2020  _high')):.      
+0001a7d0: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+0001a7e0: 616b 6564 2e67 6175 7373 5f61 6d70 6c69  aked.gauss_ampli
+0001a7f0: 7475 6465 3d63 6f6e 6669 6731 2e67 6175  tude=config1.gau
+0001a800: 7373 5f61 6d70 2f66 6163 746f 720a 2020  ss_amp/factor.  
+0001a810: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
+0001a820: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
+0001a830: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
+0001a840: 2747 5f68 6967 6865 725f 7468 616e 5f64  'G_higher_than_d
+0001a850: 6961 6427 2929 3a0a 2020 2020 2020 2020  iad')):.        
+0001a860: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+0001a870: 6564 2e67 6175 7373 5f61 6d70 6c69 7475  ed.gauss_amplitu
+0001a880: 6465 3d63 6f6e 6669 6731 2e67 6175 7373  de=config1.gauss
+0001a890: 5f61 6d70 2f66 6163 746f 720a 2020 2020  _amp/factor.    
+0001a8a0: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001a8b0: 7765 616b 6564 2e67 6175 7373 5f73 6967  weaked.gauss_sig
+0001a8c0: 6d61 3d63 6f6e 6669 6731 2e67 6175 7373  ma=config1.gauss
+0001a8d0: 5f73 6967 6d61 2a66 6163 746f 720a 2020  _sigma*factor.  
+0001a8e0: 2020 2020 2020 2320 2320 486f 7420 6261        # # Hot ba
+0001a8f0: 6e64 2066 6974 2062 6974 730a 2020 2020  nd fit bits.    
+0001a900: 2020 2020 2320 6966 2061 6e79 2864 665f      # if any(df_
+0001a910: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
+0001a920: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
+0001a930: 2748 4231 5f4c 6f77 416d 7027 2929 3a0a  'HB1_LowAmp')):.
+0001a940: 2020 2020 2020 2020 2320 2020 2020 636f          #     co
+0001a950: 6e66 6967 5f74 7765 616b 6564 2e48 425f  nfig_tweaked.HB_
+0001a960: 616d 706c 6974 7564 653d 6361 6c63 5f48  amplitude=calc_H
+0001a970: 425f 616d 706c 6974 7564 652f 320a 2020  B_amplitude/2.  
+0001a980: 2020 2020 2020 2320 6966 2061 6e79 2864        # if any(d
+0001a990: 665f 6f75 745b 2744 6961 6431 5f72 6566  f_out['Diad1_ref
+0001a9a0: 6974 275d 2e73 7472 2e63 6f6e 7461 696e  it'].str.contain
+0001a9b0: 7328 2748 4231 5f48 6967 6841 6d70 2729  s('HB1_HighAmp')
+0001a9c0: 293a 0a20 2020 2020 2020 2023 2020 2020  ):.        #    
+0001a9d0: 2063 6f6e 6669 675f 7477 6561 6b65 642e   config_tweaked.
+0001a9e0: 4842 5f61 6d70 6c69 7475 6465 3d63 616c  HB_amplitude=cal
+0001a9f0: 635f 4842 5f61 6d70 6c69 7475 6465 2a32  c_HB_amplitude*2
+0001aa00: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+0001aa10: 2c20 6466 5f6f 7574 2c20 795f 6265 7374  , df_out, y_best
+0001aa20: 5f66 6974 2c20 785f 6c69 6e2c 2063 6f6d  _fit, x_lin, com
+0001aa30: 706f 6e65 6e74 732c 2078 6461 742c 2079  ponents, xdat, y
+0001aa40: 6461 742c 2061 7831 5f78 6c69 6d2c 2061  dat, ax1_xlim, a
+0001aa50: 7832 5f78 6c69 6d2c 7265 7369 6475 616c  x2_xlim,residual
+0001aa60: 5f64 6961 645f 636f 6f72 6473 2c20 7964  _diad_coords, yd
+0001aa70: 6174 5f69 6e72 616e 6765 2c20 2078 6461  at_inrange,  xda
+0001aa80: 745f 696e 7261 6e67 653d 6669 745f 6761  t_inrange=fit_ga
+0001aa90: 7573 7369 616e 5f76 6f69 6774 5f67 656e  ussian_voigt_gen
+0001aaa0: 6572 6963 5f64 6961 6428 636f 6e66 6967  eric_diad(config
+0001aab0: 5f74 7765 616b 6564 2c20 6469 6164 313d  _tweaked, diad1=
+0001aac0: 5472 7565 2c20 7061 7468 3d70 6174 682c  True, path=path,
+0001aad0: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
+0001aae0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0001aaf0: 2020 2020 2020 2020 7864 6174 3d78 5f64          xdat=x_d
+0001ab00: 6961 6431 2c20 7964 6174 3d79 5f63 6f72  iad1, ydat=y_cor
+0001ab10: 725f 6469 6164 312c 0a20 2020 2020 2020  r_diad1,.       
+0001ab20: 2020 2020 2020 2020 2020 2020 2073 7061               spa
+0001ab30: 6e3d 7370 616e 5f64 6961 6431 2c20 706c  n=span_diad1, pl
+0001ab40: 6f74 5f66 6967 7572 653d 4661 6c73 652c  ot_figure=False,
+0001ab50: 2044 6961 645f 706f 733d 4469 6164 5f70   Diad_pos=Diad_p
+0001ab60: 6f73 2c20 4842 5f70 6f73 3d48 425f 706f  os, HB_pos=HB_po
+0001ab70: 732c 2066 6974 5f70 6561 6b73 3d63 6f6e  s, fit_peaks=con
+0001ab80: 6669 675f 7477 6561 6b65 642e 6669 745f  fig_tweaked.fit_
+0001ab90: 7065 616b 7329 0a20 2020 2020 2020 2069  peaks).        i
+0001aba0: 3d32 0a20 2020 2020 2020 2077 6869 6c65  =2.        while
+0001abb0: 2073 7472 2864 665f 6f75 745b 2744 6961   str(df_out['Dia
+0001abc0: 6431 5f72 6566 6974 275d 2e69 6c6f 635b  d1_refit'].iloc[
+0001abd0: 305d 2921 3d27 466c 6167 6765 6420 5761  0])!='Flagged Wa
+0001abe0: 726e 696e 6773 3a27 3a0a 0a20 2020 2020  rnings:':..     
+0001abf0: 2020 2020 2020 2070 7269 6e74 2827 7265         print('re
+0001ac00: 6669 7420 6174 7465 6d70 7420 203d 272b  fit attempt  ='+
+0001ac10: 7374 7228 6929 202b 2027 2c20 272b 7374  str(i) + ', '+st
+0001ac20: 7228 6466 5f6f 7574 5b27 4469 6164 315f  r(df_out['Diad1_
+0001ac30: 7265 6669 7427 5d2e 696c 6f63 5b30 5d29  refit'].iloc[0])
+0001ac40: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0001ac50: 696e 7428 6466 5f6f 7574 5b27 4469 6164  int(df_out['Diad
+0001ac60: 315f 7265 6669 7427 5d2e 696c 6f63 5b30  1_refit'].iloc[0
+0001ac70: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
+0001ac80: 696d 706f 7274 2063 6f70 790a 2020 2020  import copy.    
+0001ac90: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001aca0: 7765 616b 6564 323d 636f 7079 2e63 6f70  weaked2=copy.cop
+0001acb0: 7928 636f 6e66 6967 5f74 7765 616b 6564  y(config_tweaked
+0001acc0: 290a 2020 2020 2020 2020 2020 2020 6661  ).            fa
+0001acd0: 6374 6f72 323d 6661 6374 6f72 2a32 0a0a  ctor2=factor*2..
+0001ace0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
+0001acf0: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
+0001ad00: 6164 315f 7265 6669 7427 5d2e 7374 722e  ad1_refit'].str.
+0001ad10: 636f 6e74 6169 6e73 2827 565f 4c6f 7741  contains('V_LowA
+0001ad20: 6d70 2729 293a 0a20 2020 2020 2020 2020  mp')):.         
+0001ad30: 2020 2023 2020 2020 2063 6f6e 6669 675f     #     config_
+0001ad40: 7477 6561 6b65 6432 2e64 6961 645f 616d  tweaked2.diad_am
+0001ad50: 706c 6974 7564 653d 636f 6e66 6967 5f74  plitude=config_t
+0001ad60: 7765 616b 6564 2e64 6961 645f 616d 706c  weaked.diad_ampl
+0001ad70: 6974 7564 652a 3130 0a20 2020 2020 2020  itude*10.       
+0001ad80: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
+0001ad90: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001ada0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+0001adb0: 2827 565f 4869 6768 416d 7027 2929 3a0a  ('V_HighAmp')):.
+0001adc0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0001add0: 2020 636f 6e66 6967 5f74 7765 616b 6564    config_tweaked
+0001ade0: 322e 6469 6164 5f61 6d70 6c69 7475 6465  2.diad_amplitude
+0001adf0: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
+0001ae00: 6469 6164 5f61 6d70 6c69 7475 6465 2f31  diad_amplitude/1
+0001ae10: 300a 2020 2020 2020 2020 2020 2020 6966  0.            if
+0001ae20: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
+0001ae30: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
+0001ae40: 6f6e 7461 696e 7328 2756 5f53 6967 6d61  ontains('V_Sigma
+0001ae50: 5f74 6f6f 5f4c 6f77 2729 293a 0a20 2020  _too_Low')):.   
+0001ae60: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001ae70: 6669 675f 7477 6561 6b65 6432 2e64 6961  fig_tweaked2.dia
+0001ae80: 645f 7369 676d 613d 636f 6e66 6967 5f74  d_sigma=config_t
+0001ae90: 7765 616b 6564 2e64 6961 645f 7369 676d  weaked.diad_sigm
+0001aea0: 612a 6661 6374 6f72 320a 2020 2020 2020  a*factor2.      
+0001aeb0: 2020 2020 2020 6966 2061 6e79 2864 665f        if any(df_
+0001aec0: 6f75 745b 2744 6961 6431 5f72 6566 6974  out['Diad1_refit
+0001aed0: 275d 2e73 7472 2e63 6f6e 7461 696e 7328  '].str.contains(
+0001aee0: 2756 5f53 6967 6d61 5f74 6f6f 5f48 6967  'V_Sigma_too_Hig
+0001aef0: 6827 2929 3a0a 2020 2020 2020 2020 2020  h')):.          
+0001af00: 2020 2020 2020 636f 6e66 6967 5f74 7765        config_twe
+0001af10: 616b 6564 322e 6469 6164 5f73 6967 6d61  aked2.diad_sigma
+0001af20: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
+0001af30: 6469 6164 5f73 6967 6d61 2f66 6163 746f  diad_sigma/facto
+0001af40: 7232 0a20 2020 2020 2020 2020 2020 2023  r2.            #
+0001af50: 2047 6175 7373 6961 6e20 6669 7420 6269   Gaussian fit bi
+0001af60: 7473 0a20 2020 2020 2020 2020 2020 2069  ts.            i
+0001af70: 6620 616e 7928 6466 5f6f 7574 5b27 4469  f any(df_out['Di
+0001af80: 6164 315f 7265 6669 7427 5d2e 7374 722e  ad1_refit'].str.
+0001af90: 636f 6e74 6169 6e73 2827 475f 696e 7075  contains('G_inpu
+0001afa0: 745f 546f 6f48 6967 6853 6967 6d61 2729  t_TooHighSigma')
+0001afb0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001afc0: 2020 2063 6f6e 6669 675f 7477 6561 6b65     config_tweake
+0001afd0: 6432 2e67 6175 7373 5f73 6967 6d61 3d63  d2.gauss_sigma=c
+0001afe0: 6f6e 6669 675f 7477 6561 6b65 642e 6761  onfig_tweaked.ga
+0001aff0: 7573 735f 7369 676d 612f 6661 6374 6f72  uss_sigma/factor
+0001b000: 320a 2020 2020 2020 2020 2020 2020 6966  2.            if
+0001b010: 2061 6e79 2864 665f 6f75 745b 2744 6961   any(df_out['Dia
+0001b020: 6431 5f72 6566 6974 275d 2e73 7472 2e63  d1_refit'].str.c
+0001b030: 6f6e 7461 696e 7328 2747 5f69 6e70 7574  ontains('G_input
+0001b040: 5f54 6f6f 4c6f 7753 6967 6d61 2729 293a  _TooLowSigma')):
+0001b050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b060: 2063 6f6e 6669 675f 7477 6561 6b65 6432   config_tweaked2
+0001b070: 2e67 6175 7373 5f73 6967 6d61 3d63 6f6e  .gauss_sigma=con
+0001b080: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
+0001b090: 735f 7369 676d 612a 6661 6374 6f72 320a  s_sigma*factor2.
+0001b0a0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0001b0b0: 6e79 2864 665f 6f75 745b 2744 6961 6431  ny(df_out['Diad1
+0001b0c0: 5f72 6566 6974 275d 2e73 7472 2e63 6f6e  _refit'].str.con
+0001b0d0: 7461 696e 7328 2747 5f69 6e70 7574 5f54  tains('G_input_T
+0001b0e0: 6f6f 4c6f 7741 6d70 2729 293a 0a20 2020  ooLowAmp')):.   
+0001b0f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001b100: 6669 675f 7477 6561 6b65 6432 2e67 6175  fig_tweaked2.gau
+0001b110: 7373 5f61 6d70 6c69 7475 6465 3d63 6f6e  ss_amplitude=con
+0001b120: 6669 675f 7477 6561 6b65 642e 6761 7573  fig_tweaked.gaus
+0001b130: 735f 616d 702a 6661 6374 6f72 320a 2020  s_amp*factor2.  
+0001b140: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
+0001b150: 2864 665f 6f75 745b 2744 6961 6431 5f72  (df_out['Diad1_r
+0001b160: 6566 6974 275d 2e73 7472 2e63 6f6e 7461  efit'].str.conta
+0001b170: 696e 7328 2747 5f41 6d70 5f74 6f6f 5f68  ins('G_Amp_too_h
+0001b180: 6967 6827 2929 3a0a 2020 2020 2020 2020  igh')):.        
+0001b190: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001b1a0: 7765 616b 6564 322e 6761 7573 735f 616d  weaked2.gauss_am
+0001b1b0: 706c 6974 7564 653d 636f 6e66 6967 5f74  plitude=config_t
+0001b1c0: 7765 616b 6564 2e67 6175 7373 5f61 6d70  weaked.gauss_amp
+0001b1d0: 2f66 6163 746f 7232 0a20 2020 2020 2020  /factor2.       
+0001b1e0: 2020 2020 2069 6620 616e 7928 6466 5f6f       if any(df_o
+0001b1f0: 7574 5b27 4469 6164 315f 7265 6669 7427  ut['Diad1_refit'
+0001b200: 5d2e 7374 722e 636f 6e74 6169 6e73 2827  ].str.contains('
+0001b210: 475f 6869 6768 6572 5f74 6861 6e5f 6469  G_higher_than_di
+0001b220: 6164 2729 293a 0a20 2020 2020 2020 2020  ad')):.         
+0001b230: 2020 2020 2020 2063 6f6e 6669 675f 7477         config_tw
+0001b240: 6561 6b65 6432 2e67 6175 7373 5f61 6d70  eaked2.gauss_amp
+0001b250: 6c69 7475 6465 3d63 6f6e 6669 675f 7477  litude=config_tw
+0001b260: 6561 6b65 642e 6761 7573 735f 616d 702f  eaked.gauss_amp/
+0001b270: 6661 6374 6f72 320a 2020 2020 2020 2020  factor2.        
+0001b280: 2020 2020 2020 2020 636f 6e66 6967 5f74          config_t
+0001b290: 7765 616b 6564 322e 6761 7573 735f 7369  weaked2.gauss_si
+0001b2a0: 676d 613d 636f 6e66 6967 5f74 7765 616b  gma=config_tweak
+0001b2b0: 6564 2e67 6175 7373 5f73 6967 6d61 2a66  ed.gauss_sigma*f
+0001b2c0: 6163 746f 7232 0a20 2020 2020 2020 2020  actor2.         
+0001b2d0: 2020 2023 2048 6f74 2062 616e 6473 2062     # Hot bands b
+0001b2e0: 6974 730a 2020 2020 2020 2020 2020 2020  its.            
+0001b2f0: 2320 6966 2061 6e79 2864 665f 6f75 745b  # if any(df_out[
+0001b300: 2744 6961 6431 5f72 6566 6974 275d 2e73  'Diad1_refit'].s
+0001b310: 7472 2e63 6f6e 7461 696e 7328 2748 4231  tr.contains('HB1
+0001b320: 5f4c 6f77 416d 7027 2929 3a0a 2020 2020  _LowAmp')):.    
 0001b330: 2020 2020 2020 2020 2320 2020 2020 636f          #     co
 0001b340: 6e66 6967 5f74 7765 616b 6564 322e 4842  nfig_tweaked2.HB
 0001b350: 5f61 6d70 6c69 7475 6465 3d63 6f6e 6669  _amplitude=confi
 0001b360: 675f 7477 6561 6b65 642e 4842 5f61 6d70  g_tweaked.HB_amp
-0001b370: 6c69 7475 6465 2a32 0a0a 0a20 2020 2020  litude*2...     
-0001b380: 2020 2020 2020 2072 6573 756c 742c 2064         result, d
-0001b390: 665f 6f75 742c 2079 5f62 6573 745f 6669  f_out, y_best_fi
-0001b3a0: 742c 2078 5f6c 696e 2c20 636f 6d70 6f6e  t, x_lin, compon
-0001b3b0: 656e 7473 2c20 7864 6174 2c20 7964 6174  ents, xdat, ydat
-0001b3c0: 2c20 6178 315f 786c 696d 2c20 6178 325f  , ax1_xlim, ax2_
-0001b3d0: 786c 696d 2c72 6573 6964 7561 6c5f 6469  xlim,residual_di
-0001b3e0: 6164 5f63 6f6f 7264 732c 2079 6461 745f  ad_coords, ydat_
-0001b3f0: 696e 7261 6e67 652c 2020 7864 6174 5f69  inrange,  xdat_i
-0001b400: 6e72 616e 6765 3d66 6974 5f67 6175 7373  nrange=fit_gauss
-0001b410: 6961 6e5f 766f 6967 745f 6765 6e65 7269  ian_voigt_generi
-0001b420: 635f 6469 6164 2863 6f6e 6669 675f 7477  c_diad(config_tw
-0001b430: 6561 6b65 6432 2c64 6961 6431 3d54 7275  eaked2,diad1=Tru
-0001b440: 652c 2070 6174 683d 7061 7468 2c20 6669  e, path=path, fi
-0001b450: 6c65 6e61 6d65 3d66 696c 656e 616d 652c  lename=filename,
-0001b460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b470: 2020 2020 2078 6461 743d 785f 6469 6164       xdat=x_diad
-0001b480: 312c 2079 6461 743d 795f 636f 7272 5f64  1, ydat=y_corr_d
-0001b490: 6961 6431 2c0a 2020 2020 2020 2020 2020  iad1,.          
-0001b4a0: 2020 2020 2020 2020 2020 7370 616e 3d73            span=s
-0001b4b0: 7061 6e5f 6469 6164 312c 2070 6c6f 745f  pan_diad1, plot_
-0001b4c0: 6669 6775 7265 3d46 616c 7365 2c20 4469  figure=False, Di
-0001b4d0: 6164 5f70 6f73 3d44 6961 645f 706f 732c  ad_pos=Diad_pos,
-0001b4e0: 2048 425f 706f 733d 4842 5f70 6f73 2c20   HB_pos=HB_pos, 
-0001b4f0: 6669 745f 7065 616b 733d 636f 6e66 6967  fit_peaks=config
-0001b500: 5f74 7765 616b 6564 2e66 6974 5f70 6561  _tweaked.fit_pea
-0001b510: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
-0001b520: 693d 692b 310a 2020 2020 2020 2020 2020  i=i+1.          
-0001b530: 2020 6966 2069 3e35 3a0a 2020 2020 2020    if i>5:.      
-0001b540: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0001b550: 2747 6f74 2074 6f20 3520 6974 6572 6174  'Got to 5 iterat
-0001b560: 6f69 6e73 2061 6e64 2073 7469 6c6c 2063  oins and still c
-0001b570: 6f75 6c64 6e74 2061 646a 7573 7420 7468  ouldnt adjust th
-0001b580: 6520 6669 7420 7061 7261 6d65 7465 7273  e fit parameters
-0001b590: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-0001b5a0: 2020 2062 7265 616b 0a0a 0a0a 0a0a 0a20     break....... 
-0001b5b0: 2020 2023 2067 6574 2061 2062 6573 7420     # get a best 
-0001b5c0: 6669 7420 746f 2074 6865 2062 6173 656c  fit to the basel
-0001b5d0: 696e 6520 7573 696e 6720 6120 6c69 6e73  ine using a lins
-0001b5e0: 7061 6365 2066 726f 6d20 7468 6520 7065  pace from the pe
-0001b5f0: 616b 2066 6974 7469 6e67 0a20 2020 2079  ak fitting.    y
-0001b600: 6261 7365 5f78 6c69 6e3d 5066 5f62 6173  base_xlin=Pf_bas
-0001b610: 656c 696e 655f 6469 6164 3128 785f 6c69  eline_diad1(x_li
-0001b620: 6e29 0a0a 2020 2020 2320 5765 2065 7874  n)..    # We ext
-0001b630: 7261 6374 2074 6865 2066 756c 6c20 7370  ract the full sp
-0001b640: 6563 7472 6120 746f 2070 6c6f 7420 6174  ectra to plot at
-0001b650: 2074 6865 2065 6e64 2c20 616e 6420 636f   the end, and co
-0001b660: 6e76 6572 7420 746f 2061 2064 6174 6166  nvert to a dataf
-0001b670: 7261 6d65 0a20 2020 2053 7065 6374 7261  rame.    Spectra
-0001b680: 5f64 663d 6765 745f 6461 7461 2870 6174  _df=get_data(pat
-0001b690: 683d 7061 7468 2c20 6669 6c65 6e61 6d65  h=path, filename
-0001b6a0: 3d66 696c 656e 616d 652c 2066 696c 6574  =filename, filet
-0001b6b0: 7970 653d 6669 6c65 7479 7065 290a 2020  ype=filetype).  
-0001b6c0: 2020 5370 6563 7472 613d 6e70 2e61 7272    Spectra=np.arr
-0001b6d0: 6179 2853 7065 6374 7261 5f64 6629 0a0a  ay(Spectra_df)..
-0001b6e0: 0a0a 2020 2020 2320 4d61 6b65 206e 6963  ..    # Make nic
-0001b6f0: 6520 6669 6775 7265 0a20 2020 2069 6620  e figure.    if 
-0001b700: 706c 6f74 5f66 6967 7572 6520 6973 2054  plot_figure is T
-0001b710: 7275 653a 0a0a 2020 2020 2020 2020 6669  rue:..        fi
-0001b720: 6775 7265 5f6d 6f73 6169 633d 2222 220a  gure_mosaic=""".
-0001b730: 2020 2020 2020 2020 5859 0a20 2020 2020          XY.     
-0001b740: 2020 2041 420a 2020 2020 2020 2020 4344     AB.        CD
-0001b750: 0a20 2020 2020 2020 2045 450a 2020 2020  .        EE.    
-0001b760: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0001b770: 2066 6967 2c61 7865 733d 706c 742e 7375   fig,axes=plt.su
-0001b780: 6270 6c6f 745f 6d6f 7361 6963 286d 6f73  bplot_mosaic(mos
-0001b790: 6169 633d 6669 6775 7265 5f6d 6f73 6169  aic=figure_mosai
-0001b7a0: 632c 2066 6967 7369 7a65 3d28 3132 2c20  c, figsize=(12, 
-0001b7b0: 3136 2929 0a20 2020 2020 2020 2066 6967  16)).        fig
-0001b7c0: 2e73 7570 7469 746c 6528 2744 6961 6420  .suptitle('Diad 
-0001b7d0: 312c 2066 696c 653d 2027 2b20 7374 7228  1, file= '+ str(
-0001b7e0: 6669 6c65 6e61 6d65 2920 2b20 2720 5c6e  filename) + ' \n
-0001b7f0: 2720 2b20 7374 7228 6466 5f6f 7574 5b27  ' + str(df_out['
-0001b800: 4469 6164 315f 7265 6669 7427 5d2e 696c  Diad1_refit'].il
-0001b810: 6f63 5b30 5d29 2c20 666f 6e74 7369 7a65  oc[0]), fontsize
-0001b820: 3d31 362c 2078 3d30 2e35 2c20 793d 312e  =16, x=0.5, y=1.
-0001b830: 3029 0a0a 2020 2020 2020 2020 2320 4261  0)..        # Ba
-0001b840: 636b 6772 6f75 6e64 2070 6c6f 7420 666f  ckground plot fo
-0001b850: 7220 7265 610a 0a20 2020 2020 2020 2023  r rea..        #
-0001b860: 2050 6c6f 7420 6265 7374 2066 6974 206f   Plot best fit o
-0001b870: 6e20 7468 6520 4c48 532c 2061 6e64 2069  n the LHS, and i
-0001b880: 6e64 6976 6964 7561 6c20 6669 7473 206f  ndividual fits o
-0001b890: 6e20 7468 6520 5248 5320 6174 2074 6865  n the RHS at the
-0001b8a0: 2074 6f70 0a0a 2020 2020 2020 2020 6178   top..        ax
-0001b8b0: 6573 5b27 5827 5d2e 7365 745f 7469 746c  es['X'].set_titl
-0001b8c0: 6528 2761 2920 4261 636b 6772 6f75 6e64  e('a) Background
-0001b8d0: 2066 6974 2729 0a20 2020 2020 2020 2061   fit').        a
-0001b8e0: 7865 735b 2758 275d 2e70 6c6f 7428 4469  xes['X'].plot(Di
-0001b8f0: 6164 5b3a 2c20 305d 2c20 4469 6164 5b3a  ad[:, 0], Diad[:
-0001b900: 2c20 315d 2c20 272d 272c 2063 6f6c 6f72  , 1], '-', color
-0001b910: 3d27 6772 6579 2729 0a20 2020 2020 2020  ='grey').       
-0001b920: 2061 7865 735b 2758 275d 2e70 6c6f 7428   axes['X'].plot(
-0001b930: 4469 6164 5f73 686f 7274 5f64 6961 6431  Diad_short_diad1
-0001b940: 5b3a 2c20 305d 2c20 4469 6164 5f73 686f  [:, 0], Diad_sho
-0001b950: 7274 5f64 6961 6431 5b3a 2c20 315d 2c20  rt_diad1[:, 1], 
-0001b960: 272d 7227 2c20 6c61 6265 6c3d 2753 7065  '-r', label='Spe
-0001b970: 6374 7261 2729 0a0a 2020 2020 2020 2020  ctra')..        
-0001b980: 2361 7865 735b 2758 275d 2e70 6c6f 7428  #axes['X'].plot(
-0001b990: 4261 7365 6c69 6e65 5b3a 2c20 305d 2c20  Baseline[:, 0], 
-0001b9a0: 4261 7365 6c69 6e65 5b3a 2c20 315d 2c20  Baseline[:, 1], 
-0001b9b0: 272d 6227 2c20 6c61 6265 6c3d 2742 636b  '-b', label='Bck
-0001b9c0: 2070 6f69 6e74 7327 290a 2020 2020 2020   points').      
-0001b9d0: 2020 6178 6573 5b27 5827 5d2e 706c 6f74    axes['X'].plot
-0001b9e0: 2842 6173 656c 696e 655f 6469 6164 315b  (Baseline_diad1[
-0001b9f0: 3a2c 2030 5d2c 2042 6173 656c 696e 655f  :, 0], Baseline_
-0001ba00: 6469 6164 315b 3a2c 2031 5d2c 2027 2e62  diad1[:, 1], '.b
-0001ba10: 272c 206c 6162 656c 3d27 5365 6c2e 2062  ', label='Sel. b
-0001ba20: 636b 2e20 7074 7327 290a 2020 2020 2020  ck. pts').      
-0001ba30: 2020 6178 6573 5b27 5827 5d2e 706c 6f74    axes['X'].plot
-0001ba40: 2844 6961 645f 7368 6f72 745f 6469 6164  (Diad_short_diad
-0001ba50: 315b 3a2c 2030 5d2c 2050 795f 6261 7365  1[:, 0], Py_base
-0001ba60: 5f64 6961 6431 2c20 272d 6b27 2c20 6c61  _diad1, '-k', la
-0001ba70: 6265 6c3d 2762 636b 2e20 706f 6c79 2066  bel='bck. poly f
-0001ba80: 6974 2729 0a0a 0a0a 2020 2020 2020 2020  it')....        
-0001ba90: 6178 315f 796d 696e 3d6e 702e 6d69 6e28  ax1_ymin=np.min(
-0001baa0: 4261 7365 6c69 6e65 5f64 6961 6431 5b3a  Baseline_diad1[:
-0001bab0: 2c20 315d 292d 3130 2a6e 702e 7374 6428  , 1])-10*np.std(
-0001bac0: 4261 7365 6c69 6e65 5f64 6961 6431 5b3a  Baseline_diad1[:
-0001bad0: 2c20 315d 290a 2020 2020 2020 2020 6178  , 1]).        ax
-0001bae0: 315f 796d 6178 3d6e 702e 6d61 7828 4261  1_ymax=np.max(Ba
-0001baf0: 7365 6c69 6e65 5f64 6961 6431 5b3a 2c20  seline_diad1[:, 
-0001bb00: 315d 292b 3130 2a6e 702e 7374 6428 4261  1])+10*np.std(Ba
-0001bb10: 7365 6c69 6e65 5f64 6961 6431 5b3a 2c20  seline_diad1[:, 
-0001bb20: 315d 290a 2020 2020 2020 2020 6178 315f  1]).        ax1_
-0001bb30: 786d 696e 3d63 6f6e 6669 6731 2e6c 6f77  xmin=config1.low
-0001bb40: 6572 5f62 636b 5f64 6961 6431 5b30 5d2d  er_bck_diad1[0]-
-0001bb50: 3330 0a20 2020 2020 2020 2061 7831 5f78  30.        ax1_x
-0001bb60: 6d61 783d 636f 6e66 6967 312e 7570 7065  max=config1.uppe
-0001bb70: 725f 6263 6b5f 6469 6164 315b 315d 2b33  r_bck_diad1[1]+3
-0001bb80: 300a 2020 2020 2020 2020 2320 4164 6469  0.        # Addi
-0001bb90: 6e67 2070 6174 6368 6573 0a0a 0a20 2020  ng patches...   
-0001bba0: 2020 2020 2072 6563 745f 6469 6164 315f       rect_diad1_
-0001bbb0: 6231 3d70 6174 6368 6573 2e52 6563 7461  b1=patches.Recta
-0001bbc0: 6e67 6c65 2828 636f 6e66 6967 312e 6c6f  ngle((config1.lo
-0001bbd0: 7765 725f 6263 6b5f 6469 6164 315b 305d  wer_bck_diad1[0]
-0001bbe0: 2c20 6178 315f 796d 696e 292c 636f 6e66  , ax1_ymin),conf
-0001bbf0: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
-0001bc00: 6164 315b 315d 2d63 6f6e 6669 6731 2e6c  ad1[1]-config1.l
-0001bc10: 6f77 6572 5f62 636b 5f64 6961 6431 5b30  ower_bck_diad1[0
-0001bc20: 5d2c 6178 315f 796d 6178 2d61 7831 5f79  ],ax1_ymax-ax1_y
-0001bc30: 6d69 6e2c 0a20 2020 2020 2020 2020 2020  min,.           
-0001bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc50: 2020 2020 206c 696e 6577 6964 7468 3d31       linewidth=1
-0001bc60: 2c65 6467 6563 6f6c 6f72 3d27 6e6f 6e65  ,edgecolor='none
-0001bc70: 272c 6661 6365 636f 6c6f 723d 2763 7961  ',facecolor='cya
-0001bc80: 6e27 2c20 6c61 6265 6c3d 2773 656c 2e20  n', label='sel. 
-0001bc90: 6263 6b2e 2072 6567 696f 6e27 2c20 616c  bck. region', al
-0001bca0: 7068 613d 302e 332c 207a 6f72 6465 723d  pha=0.3, zorder=
-0001bcb0: 3029 0a20 2020 2020 2020 2061 7865 735b  0).        axes[
-0001bcc0: 2758 275d 2e61 6464 5f70 6174 6368 2872  'X'].add_patch(r
-0001bcd0: 6563 745f 6469 6164 315f 6231 290a 2020  ect_diad1_b1).  
-0001bce0: 2020 2020 2020 7265 6374 5f64 6961 6431        rect_diad1
-0001bcf0: 5f62 323d 7061 7463 6865 732e 5265 6374  _b2=patches.Rect
-0001bd00: 616e 676c 6528 2863 6f6e 6669 6731 2e75  angle((config1.u
-0001bd10: 7070 6572 5f62 636b 5f64 6961 6431 5b30  pper_bck_diad1[0
-0001bd20: 5d2c 2061 7831 5f79 6d69 6e29 2c63 6f6e  ], ax1_ymin),con
-0001bd30: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
-0001bd40: 6961 6431 5b31 5d2d 636f 6e66 6967 312e  iad1[1]-config1.
-0001bd50: 7570 7065 725f 6263 6b5f 6469 6164 315b  upper_bck_diad1[
-0001bd60: 305d 2c61 7831 5f79 6d61 782d 6178 315f  0],ax1_ymax-ax1_
-0001bd70: 796d 696e 2c0a 2020 2020 2020 2020 2020  ymin,.          
-0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2020 6c69 6e65 7769 6474 683d        linewidth=
-0001bda0: 312c 6564 6765 636f 6c6f 723d 276e 6f6e  1,edgecolor='non
-0001bdb0: 6527 2c66 6163 6563 6f6c 6f72 3d27 6379  e',facecolor='cy
-0001bdc0: 616e 272c 2061 6c70 6861 3d30 2e33 2c20  an', alpha=0.3, 
-0001bdd0: 7a6f 7264 6572 3d30 290a 2020 2020 2020  zorder=0).      
-0001bde0: 2020 6178 6573 5b27 5827 5d2e 6164 645f    axes['X'].add_
-0001bdf0: 7061 7463 6828 7265 6374 5f64 6961 6431  patch(rect_diad1
-0001be00: 5f62 3229 0a20 2020 2020 2020 2061 7865  _b2).        axe
-0001be10: 735b 2758 275d 2e73 6574 5f78 6c69 6d28  s['X'].set_xlim(
-0001be20: 5b61 7831 5f78 6d69 6e2c 2061 7831 5f78  [ax1_xmin, ax1_x
-0001be30: 6d61 785d 290a 2020 2020 2020 2020 6178  max]).        ax
-0001be40: 6573 5b27 5827 5d2e 7365 745f 796c 696d  es['X'].set_ylim
-0001be50: 285b 6178 315f 796d 696e 2c20 6178 315f  ([ax1_ymin, ax1_
-0001be60: 796d 6178 5d29 0a0a 2020 2020 2020 2020  ymax])..        
-0001be70: 6178 6573 5b27 5827 5d2e 7365 745f 796c  axes['X'].set_yl
-0001be80: 6162 656c 2827 496e 7465 6e73 6974 7927  abel('Intensity'
-0001be90: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-0001bea0: 5927 5d2e 7365 745f 796c 6162 656c 2827  Y'].set_ylabel('
-0001beb0: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
-0001bec0: 2020 2020 6178 6573 5b27 5927 5d2e 7365      axes['Y'].se
-0001bed0: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
-0001bee0: 6d62 6572 2729 0a20 2020 2020 2020 2061  mber').        a
-0001bef0: 7865 735b 2758 275d 2e6c 6567 656e 6428  xes['X'].legend(
-0001bf00: 290a 0a0a 0a20 2020 2020 2020 2061 7865  )....        axe
-0001bf10: 735b 2759 275d 2e73 6574 5f74 6974 6c65  s['Y'].set_title
-0001bf20: 2827 6229 2042 6163 6b67 726f 756e 6420  ('b) Background 
-0001bf30: 7375 6274 7261 6374 6564 2073 7065 6374  subtracted spect
-0001bf40: 7261 2729 0a20 2020 2020 2020 2061 7865  ra').        axe
-0001bf50: 735b 2759 275d 2e70 6c6f 7428 785f 6469  s['Y'].plot(x_di
-0001bf60: 6164 312c 2079 5f63 6f72 725f 6469 6164  ad1, y_corr_diad
-0001bf70: 312c 2027 2d72 2729 0a20 2020 2020 2020  1, '-r').       
-0001bf80: 2068 6569 6768 745f 703d 6e70 2e6d 6178   height_p=np.max
-0001bf90: 2844 6961 645f 7368 6f72 745f 6469 6164  (Diad_short_diad
-0001bfa0: 315b 3a2c 2031 5d29 2d6e 702e 6d69 6e28  1[:, 1])-np.min(
-0001bfb0: 4469 6164 5f73 686f 7274 5f64 6961 6431  Diad_short_diad1
-0001bfc0: 5b3a 2c20 315d 290a 2020 2020 2020 2020  [:, 1]).        
-0001bfd0: 6178 6573 5b27 5927 5d2e 7365 745f 796c  axes['Y'].set_yl
-0001bfe0: 696d 285b 6e70 2e6d 696e 2879 5f63 6f72  im([np.min(y_cor
-0001bff0: 725f 6469 6164 3129 2c20 312e 322a 6865  r_diad1), 1.2*he
-0001c000: 6967 6874 5f70 205d 290a 2020 2020 2020  ight_p ]).      
-0001c010: 2020 6178 6573 5b27 5827 5d2e 7365 745f    axes['X'].set_
-0001c020: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-0001c030: 6572 2729 0a0a 0a0a 2020 2020 2020 2020  er')....        
-0001c040: 6178 6573 5b27 4127 5d2e 706c 6f74 2878  axes['A'].plot(x
-0001c050: 6461 742c 2079 6461 742c 2020 272e 6b27  dat, ydat,  '.k'
-0001c060: 2c20 6c61 6265 6c3d 2762 636b 2e20 7375  , label='bck. su
-0001c070: 622e 2064 6174 6127 290a 2020 2020 2020  b. data').      
-0001c080: 2020 6178 6573 5b27 4127 5d2e 706c 6f74    axes['A'].plot
-0001c090: 2820 785f 6c69 6e20 2c79 5f62 6573 745f  ( x_lin ,y_best_
-0001c0a0: 6669 742c 2027 2d67 272c 206c 696e 6577  fit, '-g', linew
-0001c0b0: 6964 7468 3d31 2c20 6c61 6265 6c3d 2762  idth=1, label='b
-0001c0c0: 6573 7420 6669 7427 290a 2020 2020 2020  est fit').      
-0001c0d0: 2020 6178 6573 5b27 4127 5d2e 6c65 6765    axes['A'].lege
-0001c0e0: 6e64 2829 0a20 2020 2020 2020 2061 7865  nd().        axe
-0001c0f0: 735b 2741 275d 2e73 6574 5f79 6c61 6265  s['A'].set_ylabe
-0001c100: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-0001c110: 2020 2020 2020 2061 7865 735b 2741 275d         axes['A']
-0001c120: 2e73 6574 5f78 6c61 6265 6c28 2757 6176  .set_xlabel('Wav
-0001c130: 656e 756d 6265 7227 290a 2020 2020 2020  enumber').      
-0001c140: 2020 6178 6573 5b27 4127 5d2e 7365 745f    axes['A'].set_
-0001c150: 786c 696d 2861 7831 5f78 6c69 6d29 0a20  xlim(ax1_xlim). 
-0001c160: 2020 2020 2020 2061 7865 735b 2741 275d         axes['A']
-0001c170: 2e73 6574 5f74 6974 6c65 2827 6329 204f  .set_title('c) O
-0001c180: 7665 7261 6c6c 2042 6573 7420 4669 7427  verall Best Fit'
-0001c190: 290a 0a20 2020 2023 2069 6e64 6976 6964  )..    # individ
-0001c1a0: 7561 6c20 6669 7473 0a20 2020 2020 2020  ual fits.       
-0001c1b0: 2061 7865 735b 2742 275d 2e70 6c6f 7428   axes['B'].plot(
-0001c1c0: 7864 6174 2c20 7964 6174 2c20 272e 6b27  xdat, ydat, '.k'
-0001c1d0: 290a 0a20 2020 2020 2020 2023 2054 6869  )..        # Thi
-0001c1e0: 7320 6973 2066 6f72 2069 6620 7468 6572  s is for if ther
-0001c1f0: 6520 6973 206d 6f72 6520 7468 616e 2031  e is more than 1
-0001c200: 2070 6561 6b2c 2074 6869 7320 6973 2077   peak, this is w
-0001c210: 6865 6e20 7765 2077 616e 7420 746f 2070  hen we want to p
-0001c220: 6c6f 7420 7468 6520 6265 7374 2066 6974  lot the best fit
-0001c230: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
-0001c240: 7065 616b 733e 313a 0a0a 2020 2020 2020  peaks>1:..      
-0001c250: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
-0001c260: 706c 6f74 2878 5f6c 696e 2c20 636f 6d70  plot(x_lin, comp
-0001c270: 6f6e 656e 7473 2e67 6574 2827 6c7a 325f  onents.get('lz2_
-0001c280: 2729 2c20 272d 7227 2c20 6c69 6e65 7769  '), '-r', linewi
-0001c290: 6474 683d 322c 206c 6162 656c 3d27 4842  dth=2, label='HB
-0001c2a0: 3127 290a 0a20 2020 2020 2020 2061 7865  1')..        axe
-0001c2b0: 735b 2742 275d 2e70 6c6f 7428 785f 6c69  s['B'].plot(x_li
-0001c2c0: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
-0001c2d0: 7428 276c 7a31 5f27 292c 2027 2d62 272c  t('lz1_'), '-b',
-0001c2e0: 206c 696e 6577 6964 7468 3d32 2c20 6c61   linewidth=2, la
-0001c2f0: 6265 6c3d 2744 6961 6431 2729 0a20 2020  bel='Diad1').   
-0001c300: 2020 2020 2069 6620 636f 6e66 6967 312e       if config1.
-0001c310: 6669 745f 6761 7573 7320 6973 206e 6f74  fit_gauss is not
-0001c320: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-0001c330: 2020 2020 6178 6573 5b27 4227 5d2e 706c      axes['B'].pl
-0001c340: 6f74 2878 5f6c 696e 2c20 636f 6d70 6f6e  ot(x_lin, compon
-0001c350: 656e 7473 2e67 6574 2827 626b 675f 2729  ents.get('bkg_')
-0001c360: 2c20 272d 6d27 2c20 6c61 6265 6c3d 2747  , '-m', label='G
-0001c370: 6175 7373 6961 6e20 6263 6b27 2c20 6c69  aussian bck', li
-0001c380: 6e65 7769 6474 683d 3229 0a20 2020 2020  newidth=2).     
-0001c390: 2020 2023 6178 322e 706c 6f74 2878 6461     #ax2.plot(xda
-0001c3a0: 742c 2072 6573 756c 742e 6265 7374 5f66  t, result.best_f
-0001c3b0: 6974 2c20 272d 6727 2c20 6c61 6265 6c3d  it, '-g', label=
-0001c3c0: 2762 6573 7420 6669 7427 290a 2020 2020  'best fit').    
-0001c3d0: 2020 2020 6178 6573 5b27 4227 5d2e 6c65      axes['B'].le
-0001c3e0: 6765 6e64 2829 0a0a 2020 2020 2020 2020  gend()..        
-0001c3f0: 6669 7473 7061 6e3d 6d61 7828 795f 6265  fitspan=max(y_be
-0001c400: 7374 5f66 6974 292d 6d69 6e28 795f 6265  st_fit)-min(y_be
-0001c410: 7374 5f66 6974 290a 2020 2020 2020 2020  st_fit).        
-0001c420: 6178 6573 5b27 4227 5d2e 7365 745f 796c  axes['B'].set_yl
-0001c430: 696d 285b 6d69 6e28 795f 6265 7374 5f66  im([min(y_best_f
-0001c440: 6974 292d 6669 7473 7061 6e2f 352c 206d  it)-fitspan/5, m
-0001c450: 6178 2879 5f62 6573 745f 6669 7429 2b66  ax(y_best_fit)+f
-0001c460: 6974 7370 616e 2f35 5d29 0a0a 2020 2020  itspan/5])..    
-0001c470: 2020 2020 6178 6573 5b27 4227 5d2e 7365      axes['B'].se
-0001c480: 745f 796c 6162 656c 2827 496e 7465 6e73  t_ylabel('Intens
-0001c490: 6974 7927 290a 2020 2020 2020 2020 6178  ity').        ax
-0001c4a0: 6573 5b27 4227 5d2e 7365 745f 786c 6162  es['B'].set_xlab
-0001c4b0: 656c 2827 5761 7665 6e75 6d62 6572 2729  el('Wavenumber')
-0001c4c0: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
-0001c4d0: 2742 275d 2e73 6574 5f78 6c69 6d28 6178  'B'].set_xlim(ax
-0001c4e0: 325f 786c 696d 290a 0a20 2020 2020 2020  2_xlim)..       
-0001c4f0: 2023 2044 6173 6865 6420 6c69 6e65 7320   # Dashed lines 
-0001c500: 736f 206d 6174 6368 6573 2070 6172 7420  so matches part 
-0001c510: 440a 2020 2020 2020 2020 6178 6573 5b27  D.        axes['
-0001c520: 4227 5d2e 706c 6f74 285b 6466 5f6f 7574  B'].plot([df_out
-0001c530: 5b27 4469 6164 315f 566f 6967 745f 4365  ['Diad1_Voigt_Ce
-0001c540: 6e74 275d 2c20 6466 5f6f 7574 5b27 4469  nt'], df_out['Di
-0001c550: 6164 315f 566f 6967 745f 4365 6e74 275d  ad1_Voigt_Cent']
-0001c560: 5d2c 205b 6e70 2e6d 696e 2879 6461 7429  ], [np.min(ydat)
-0001c570: 2c20 6e70 2e6d 6178 2879 6461 7429 5d2c  , np.max(ydat)],
-0001c580: 2027 3a62 2729 0a0a 2020 2020 2020 2020   ':b')..        
-0001c590: 6966 2066 6974 5f70 6561 6b73 3e32 3a0a  if fit_peaks>2:.
-0001c5a0: 2020 2020 2020 2020 2020 2020 6178 6573              axes
-0001c5b0: 5b27 4227 5d2e 706c 6f74 285b 6466 5f6f  ['B'].plot([df_o
-0001c5c0: 7574 5b27 4842 315f 4365 6e74 275d 2c20  ut['HB1_Cent'], 
-0001c5d0: 6466 5f6f 7574 5b27 4842 315f 4365 6e74  df_out['HB1_Cent
-0001c5e0: 275d 5d2c 205b 6e70 2e6d 696e 2879 6461  ']], [np.min(yda
-0001c5f0: 7429 2c20 6e70 2e6d 6178 2879 6461 7429  t), np.max(ydat)
-0001c600: 5d2c 2027 3a72 2729 0a0a 2020 2020 2020  ], ':r')..      
-0001c610: 2020 6178 6573 5b27 4227 5d2e 7365 745f    axes['B'].set_
-0001c620: 7469 746c 6528 2763 2920 4669 7420 436f  title('c) Fit Co
-0001c630: 6d70 6f6e 656e 7473 2729 0a0a 2020 2020  mponents')..    
-0001c640: 2020 2020 2320 4261 636b 6772 6f75 6e64      # Background
-0001c650: 2066 6974 0a0a 2020 2020 2020 2020 2320   fit..        # 
-0001c660: 4669 7273 742c 2073 6574 2075 7020 7820  First, set up x 
-0001c670: 616e 6420 7920 6c69 6d69 7473 206f 6e20  and y limits on 
-0001c680: 6178 6973 0a0a 2020 2020 2020 2020 6966  axis..        if
-0001c690: 2063 6f6e 6669 6731 2e78 5f72 616e 6765   config1.x_range
-0001c6a0: 5f62 6173 656c 696e 6520 6973 206e 6f74  _baseline is not
-0001c6b0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001c6c0: 2020 2061 7863 5f78 6d69 6e3d 6466 5f6f     axc_xmin=df_o
-0001c6d0: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
-0001c6e0: 4365 6e74 275d 5b30 5d2d 636f 6e66 6967  Cent'][0]-config
-0001c6f0: 312e 785f 7261 6e67 655f 6261 7365 6c69  1.x_range_baseli
-0001c700: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
-0001c710: 7863 5f78 6d61 783d 6466 5f6f 7574 5b27  xc_xmax=df_out['
-0001c720: 4469 6164 315f 566f 6967 745f 4365 6e74  Diad1_Voigt_Cent
-0001c730: 275d 5b30 5d2b 636f 6e66 6967 312e 785f  '][0]+config1.x_
-0001c740: 7261 6e67 655f 6261 7365 6c69 6e65 0a20  range_baseline. 
-0001c750: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001c760: 2020 2020 2020 2020 2061 7863 5f78 6d69           axc_xmi
-0001c770: 6e3d 636f 6e66 6967 312e 6c6f 7765 725f  n=config1.lower_
-0001c780: 6263 6b5f 6469 6164 315b 305d 0a20 2020  bck_diad1[0].   
-0001c790: 2020 2020 2020 2020 2061 7863 5f78 6d61           axc_xma
-0001c7a0: 783d 636f 6e66 6967 312e 7570 7065 725f  x=config1.upper_
-0001c7b0: 6263 6b5f 6469 6164 315b 315d 0a20 2020  bck_diad1[1].   
-0001c7c0: 2020 2020 2061 7863 5f79 6d69 6e3d 6e70       axc_ymin=np
-0001c7d0: 2e6d 696e 2842 6173 656c 696e 655f 6469  .min(Baseline_di
-0001c7e0: 6164 315b 3a2c 2031 5d29 2d63 6f6e 6669  ad1[:, 1])-confi
-0001c7f0: 6731 2e79 5f72 616e 6765 5f62 6173 656c  g1.y_range_basel
-0001c800: 696e 650a 2020 2020 2020 2020 6178 635f  ine.        axc_
-0001c810: 796d 6178 3d6e 702e 6d61 7828 4261 7365  ymax=np.max(Base
-0001c820: 6c69 6e65 5f64 6961 6431 5b3a 2c20 315d  line_diad1[:, 1]
-0001c830: 292b 636f 6e66 6967 312e 795f 7261 6e67  )+config1.y_rang
-0001c840: 655f 6261 7365 6c69 6e65 0a0a 0a0a 0a20  e_baseline..... 
-0001c850: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
-0001c860: 2e73 6574 5f74 6974 6c65 2827 6429 2050  .set_title('d) P
-0001c870: 6561 6b73 206f 7665 726c 6169 6e20 6f6e  eaks overlain on
-0001c880: 2064 6174 6120 6265 666f 7265 2073 7562   data before sub
-0001c890: 7472 6163 7469 6f6e 2729 0a20 2020 2020  traction').     
-0001c8a0: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
-0001c8b0: 7428 4469 6164 5f73 686f 7274 5f64 6961  t(Diad_short_dia
-0001c8c0: 6431 5b3a 2c20 305d 2c20 4469 6164 5f73  d1[:, 0], Diad_s
-0001c8d0: 686f 7274 5f64 6961 6431 5b3a 2c20 315d  hort_diad1[:, 1]
-0001c8e0: 2c20 272e 7227 2c20 6c61 6265 6c3d 2744  , '.r', label='D
-0001c8f0: 6174 6127 290a 2020 2020 2020 2020 6178  ata').        ax
-0001c900: 6573 5b27 4327 5d2e 706c 6f74 2842 6173  es['C'].plot(Bas
-0001c910: 656c 696e 655f 6469 6164 315b 3a2c 2030  eline_diad1[:, 0
-0001c920: 5d2c 2042 6173 656c 696e 655f 6469 6164  ], Baseline_diad
-0001c930: 315b 3a2c 2031 5d2c 2027 2e62 272c 206c  1[:, 1], '.b', l
-0001c940: 6162 656c 3d27 6263 6b27 290a 2020 2020  abel='bck').    
-0001c950: 2020 2020 6178 6573 5b27 4327 5d2e 706c      axes['C'].pl
-0001c960: 6f74 2844 6961 645f 7368 6f72 745f 6469  ot(Diad_short_di
-0001c970: 6164 315b 3a2c 2030 5d2c 2050 795f 6261  ad1[:, 0], Py_ba
-0001c980: 7365 5f64 6961 6431 2c20 272d 6b27 2c20  se_diad1, '-k', 
-0001c990: 6c61 6265 6c3d 2750 6f6c 7920 6263 6b20  label='Poly bck 
-0001c9a0: 6669 7427 290a 0a0a 2020 2020 2020 2020  fit')...        
-0001c9b0: 6178 6573 5b27 4327 5d2e 7365 745f 796c  axes['C'].set_yl
-0001c9c0: 6162 656c 2827 496e 7465 6e73 6974 7927  abel('Intensity'
-0001c9d0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
-0001c9e0: 4327 5d2e 7365 745f 786c 6162 656c 2827  C'].set_xlabel('
-0001c9f0: 5761 7665 6e75 6d62 6572 2729 0a0a 0a20  Wavenumber')... 
-0001ca00: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
-0001ca10: 312e 6669 745f 6761 7573 7320 6973 206e  1.fit_gauss is n
-0001ca20: 6f74 2046 616c 7365 3a0a 0a20 2020 2020  ot False:..     
-0001ca30: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
-0001ca40: 2e70 6c6f 7428 785f 6c69 6e2c 2063 6f6d  .plot(x_lin, com
-0001ca50: 706f 6e65 6e74 732e 6765 7428 2762 6b67  ponents.get('bkg
-0001ca60: 5f27 292b 7962 6173 655f 786c 696e 2c20  _')+ybase_xlin, 
-0001ca70: 272d 6d27 2c20 6c61 6265 6c3d 2747 6175  '-m', label='Gau
-0001ca80: 7373 6961 6e20 6263 6b27 2c20 6c69 6e65  ssian bck', line
-0001ca90: 7769 6474 683d 3229 0a0a 2020 2020 2020  width=2)..      
-0001caa0: 2020 6178 6573 5b27 4327 5d2e 706c 6f74    axes['C'].plot
-0001cab0: 2820 785f 6c69 6e20 2c79 5f62 6573 745f  ( x_lin ,y_best_
-0001cac0: 6669 742b 7962 6173 655f 786c 696e 2c20  fit+ybase_xlin, 
-0001cad0: 272d 6727 2c20 6c69 6e65 7769 6474 683d  '-g', linewidth=
-0001cae0: 322c 206c 6162 656c 3d27 4265 7374 2046  2, label='Best F
-0001caf0: 6974 2729 0a20 2020 2020 2020 2061 7865  it').        axe
-0001cb00: 735b 2743 275d 2e70 6c6f 7428 785f 6c69  s['C'].plot(x_li
-0001cb10: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
-0001cb20: 7428 276c 7a31 5f27 292b 7962 6173 655f  t('lz1_')+ybase_
-0001cb30: 786c 696e 2c20 272d 6227 2c20 6c61 6265  xlin, '-b', labe
-0001cb40: 6c3d 2744 6961 6431 272c 206c 696e 6577  l='Diad1', linew
-0001cb50: 6964 7468 3d31 290a 0a20 2020 2020 2020  idth=1)..       
-0001cb60: 2069 6620 6669 745f 7065 616b 733e 313a   if fit_peaks>1:
-0001cb70: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-0001cb80: 735b 2743 275d 2e70 6c6f 7428 785f 6c69  s['C'].plot(x_li
-0001cb90: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
-0001cba0: 7428 276c 7a32 5f27 292b 7962 6173 655f  t('lz2_')+ybase_
-0001cbb0: 786c 696e 2c20 272d 7227 2c20 6c61 6265  xlin, '-r', labe
-0001cbc0: 6c3d 2748 4231 272c 206c 696e 6577 6964  l='HB1', linewid
-0001cbd0: 7468 3d31 290a 0a0a 0a0a 2020 2020 2020  th=1).....      
-0001cbe0: 2020 6178 6573 5b27 4327 5d2e 6c65 6765    axes['C'].lege
-0001cbf0: 6e64 286e 636f 6c3d 332c 206c 6f63 3d27  nd(ncol=3, loc='
-0001cc00: 6c6f 7765 7220 6365 6e74 6572 2729 0a20  lower center'). 
-0001cc10: 2020 2020 2020 2061 7865 735b 2743 275d         axes['C']
-0001cc20: 2e73 6574 5f78 6c69 6d28 5b61 7863 5f78  .set_xlim([axc_x
-0001cc30: 6d69 6e2c 2061 7863 5f78 6d61 785d 290a  min, axc_xmax]).
-0001cc40: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
-0001cc50: 5d2e 7365 745f 796c 696d 285b 6178 635f  ].set_ylim([axc_
-0001cc60: 796d 696e 2c20 6178 635f 796d 6178 5d29  ymin, axc_ymax])
-0001cc70: 0a20 2020 2020 2020 2023 6178 6573 5b27  .        #axes['
-0001cc80: 4327 5d2e 706c 6f74 2844 6961 645f 7368  C'].plot(Diad_sh
-0001cc90: 6f72 745b 3a2c 2030 5d2c 2044 6961 645f  ort[:, 0], Diad_
-0001cca0: 7368 6f72 745b 3a2c 2031 5d2c 2027 2272  short[:, 1], '"r
-0001ccb0: 272c 206c 6162 656c 3d27 4461 7461 2729  ', label='Data')
-0001ccc0: 0a0a 0a20 2020 2020 2020 2023 2052 6573  ...        # Res
-0001ccd0: 6964 7561 6c20 6f6e 2070 6c6f 7420 440a  idual on plot D.
-0001cce0: 2020 2020 2020 2020 6178 6573 5b27 4427          axes['D'
-0001ccf0: 5d2e 7365 745f 7469 746c 6528 2766 2920  ].set_title('f) 
-0001cd00: 5265 7369 6475 616c 7327 290a 2020 2020  Residuals').    
-0001cd10: 2020 2020 6178 6573 5b27 4427 5d2e 706c      axes['D'].pl
-0001cd20: 6f74 285b 6466 5f6f 7574 5b27 4469 6164  ot([df_out['Diad
-0001cd30: 315f 566f 6967 745f 4365 6e74 275d 2c20  1_Voigt_Cent'], 
-0001cd40: 6466 5f6f 7574 5b27 4469 6164 315f 566f  df_out['Diad1_Vo
-0001cd50: 6967 745f 4365 6e74 275d 5d2c 205b 6e70  igt_Cent']], [np
-0001cd60: 2e6d 696e 2872 6573 6964 7561 6c5f 6469  .min(residual_di
-0001cd70: 6164 5f63 6f6f 7264 7329 2c20 6e70 2e6d  ad_coords), np.m
-0001cd80: 6178 2872 6573 6964 7561 6c5f 6469 6164  ax(residual_diad
-0001cd90: 5f63 6f6f 7264 7329 5d2c 2027 3a62 2729  _coords)], ':b')
-0001cda0: 0a20 2020 2020 2020 2069 6620 6669 745f  .        if fit_
-0001cdb0: 7065 616b 733e 323a 0a20 2020 2020 2020  peaks>2:.       
-0001cdc0: 2020 2020 2061 7865 735b 2744 275d 2e70       axes['D'].p
-0001cdd0: 6c6f 7428 5b64 665f 6f75 745b 2748 4231  lot([df_out['HB1
-0001cde0: 5f43 656e 7427 5d2c 2064 665f 6f75 745b  _Cent'], df_out[
-0001cdf0: 2748 4231 5f43 656e 7427 5d5d 2c20 5b6e  'HB1_Cent']], [n
-0001ce00: 702e 6d69 6e28 7265 7369 6475 616c 5f64  p.min(residual_d
-0001ce10: 6961 645f 636f 6f72 6473 292c 206e 702e  iad_coords), np.
-0001ce20: 6d61 7828 7265 7369 6475 616c 5f64 6961  max(residual_dia
-0001ce30: 645f 636f 6f72 6473 295d 2c20 273a 7227  d_coords)], ':r'
-0001ce40: 290a 0a20 2020 2020 2020 2061 7865 735b  )..        axes[
-0001ce50: 2744 275d 2e70 6c6f 7428 7864 6174 5f69  'D'].plot(xdat_i
-0001ce60: 6e72 616e 6765 2c20 7265 7369 6475 616c  nrange, residual
-0001ce70: 5f64 6961 645f 636f 6f72 6473 2c20 276f  _diad_coords, 'o
-0001ce80: 6b27 2c20 6d66 633d 2763 2720 290a 2020  k', mfc='c' ).  
-0001ce90: 2020 2020 2020 6178 6573 5b27 4427 5d2e        axes['D'].
-0001cea0: 706c 6f74 2878 6461 745f 696e 7261 6e67  plot(xdat_inrang
-0001ceb0: 652c 2072 6573 6964 7561 6c5f 6469 6164  e, residual_diad
-0001cec0: 5f63 6f6f 7264 732c 2027 2d63 2720 290a  _coords, '-c' ).
-0001ced0: 2020 2020 2020 2020 6178 6573 5b27 4427          axes['D'
-0001cee0: 5d2e 7365 745f 796c 6162 656c 2827 5265  ].set_ylabel('Re
-0001cef0: 7369 6475 616c 2729 0a20 2020 2020 2020  sidual').       
-0001cf00: 2061 7865 735b 2744 275d 2e73 6574 5f78   axes['D'].set_x
-0001cf10: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
-0001cf20: 7227 290a 2020 2020 2020 2020 2320 6178  r').        # ax
-0001cf30: 6573 5b27 4427 5d2e 7365 745f 786c 696d  es['D'].set_xlim
-0001cf40: 2861 7831 5f78 6c69 6d29 0a20 2020 2020  (ax1_xlim).     
-0001cf50: 2020 2023 2061 7865 735b 2744 275d 2e73     # axes['D'].s
-0001cf60: 6574 5f78 6c69 6d28 6178 325f 786c 696d  et_xlim(ax2_xlim
-0001cf70: 290a 2020 2020 2020 2020 4c6f 6361 6c5f  ).        Local_
-0001cf80: 5265 7369 6475 616c 5f64 6961 6431 3d72  Residual_diad1=r
-0001cf90: 6573 6964 7561 6c5f 6469 6164 5f63 6f6f  esidual_diad_coo
-0001cfa0: 7264 735b 2828 7864 6174 5f69 6e72 616e  rds[((xdat_inran
-0001cfb0: 6765 3e28 6466 5f6f 7574 5b27 4469 6164  ge>(df_out['Diad
-0001cfc0: 315f 566f 6967 745f 4365 6e74 275d 5b30  1_Voigt_Cent'][0
-0001cfd0: 5d2d 636f 6e66 6967 312e 785f 7261 6e67  ]-config1.x_rang
-0001cfe0: 655f 7265 7369 6475 616c 2929 0a20 2020  e_residual)).   
-0001cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d010: 2020 2020 2020 2020 2020 2020 2026 2878               &(x
-0001d020: 6461 745f 696e 7261 6e67 653c 6466 5f6f  dat_inrange<df_o
-0001d030: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
-0001d040: 4365 6e74 275d 5b30 5d2b 636f 6e66 6967  Cent'][0]+config
-0001d050: 312e 785f 7261 6e67 655f 7265 7369 6475  1.x_range_residu
-0001d060: 616c 2929 5d0a 2020 2020 2020 2020 6178  al))].        ax
-0001d070: 6573 5b27 4427 5d2e 7365 745f 786c 696d  es['D'].set_xlim
-0001d080: 285b 6466 5f6f 7574 5b27 4469 6164 315f  ([df_out['Diad1_
-0001d090: 566f 6967 745f 4365 6e74 275d 5b30 5d2d  Voigt_Cent'][0]-
-0001d0a0: 636f 6e66 6967 312e 785f 7261 6e67 655f  config1.x_range_
-0001d0b0: 7265 7369 6475 616c 2c0a 2020 2020 2020  residual,.      
-0001d0c0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-0001d0d0: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
-0001d0e0: 745f 4365 6e74 275d 5b30 5d2b 636f 6e66  t_Cent'][0]+conf
-0001d0f0: 6967 312e 785f 7261 6e67 655f 7265 7369  ig1.x_range_resi
-0001d100: 6475 616c 5d29 0a20 2020 2020 2020 2023  dual]).        #
-0001d110: 6178 352e 706c 6f74 285b 6365 6e74 5f31  ax5.plot([cent_1
-0001d120: 3131 372c 2063 656e 745f 3131 3137 205d  117, cent_1117 ]
-0001d130: 2c20 5b6e 702e 6d69 6e28 4c6f 6361 6c5f  , [np.min(Local_
-0001d140: 5265 7369 6475 616c 5f31 3131 3729 2d31  Residual_1117)-1
-0001d150: 302c 206e 702e 6d61 7828 4c6f 6361 6c5f  0, np.max(Local_
-0001d160: 5265 7369 6475 616c 5f31 3131 3729 2b31  Residual_1117)+1
-0001d170: 305d 2c20 273a 6b27 290a 0a0a 0a20 2020  0], ':k')....   
-0001d180: 2020 2020 2061 7865 735b 2744 275d 2e73       axes['D'].s
-0001d190: 6574 5f79 6c69 6d28 5b6e 702e 6d69 6e28  et_ylim([np.min(
-0001d1a0: 4c6f 6361 6c5f 5265 7369 6475 616c 5f64  Local_Residual_d
-0001d1b0: 6961 6431 292d 3130 2c20 6e70 2e6d 6178  iad1)-10, np.max
-0001d1c0: 284c 6f63 616c 5f52 6573 6964 7561 6c5f  (Local_Residual_
-0001d1d0: 6469 6164 3129 2b31 305d 290a 0a0a 0a0a  diad1)+10]).....
-0001d1e0: 0a20 2020 2020 2020 2023 204f 7665 7261  .        # Overa
-0001d1f0: 6c20 7370 6563 7472 610a 2020 2020 2020  l spectra.      
-0001d200: 2020 6178 6573 5b27 4527 5d2e 7365 745f    axes['E'].set_
-0001d210: 7469 746c 6528 2767 2920 5375 6d6d 6172  title('g) Summar
-0001d220: 7920 706c 6f74 206f 6620 7261 7720 7370  y plot of raw sp
-0001d230: 6563 7472 6120 666f 7220 6669 6c65 203d  ectra for file =
-0001d240: 2027 202b 2066 696c 656e 616d 6529 0a20   ' + filename). 
-0001d250: 2020 2020 2020 2061 7865 735b 2745 275d         axes['E']
-0001d260: 2e70 6c6f 7428 5370 6563 7472 615b 3a2c  .plot(Spectra[:,
-0001d270: 2030 5d2c 2053 7065 6374 7261 5b3a 2c20   0], Spectra[:, 
-0001d280: 315d 2c20 272d 7227 290a 2020 2020 2020  1], '-r').      
-0001d290: 2020 6178 6573 5b27 4527 5d2e 7365 745f    axes['E'].set_
-0001d2a0: 796c 6162 656c 2827 496e 7465 6e73 6974  ylabel('Intensit
-0001d2b0: 7927 290a 2020 2020 2020 2020 6178 6573  y').        axes
-0001d2c0: 5b27 4527 5d2e 7365 745f 786c 6162 656c  ['E'].set_xlabel
-0001d2d0: 2827 5761 7665 6e75 6d62 6572 2729 0a0a  ('Wavenumber')..
-0001d2e0: 0a20 2020 2020 2020 2070 6174 6833 3d70  .        path3=p
-0001d2f0: 6174 682b 272f 272b 2764 6961 645f 6669  ath+'/'+'diad_fi
-0001d300: 745f 696d 6167 6573 270a 2020 2020 2020  t_images'.      
-0001d310: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-0001d320: 7374 7328 7061 7468 3329 3a0a 2020 2020  sts(path3):.    
-0001d330: 2020 2020 2020 2020 6f75 743d 2770 6174          out='pat
-0001d340: 6820 6578 6973 7473 270a 2020 2020 2020  h exists'.      
-0001d350: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001d360: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-0001d370: 7061 7468 2b27 2f27 2b20 2764 6961 645f  path+'/'+ 'diad_
-0001d380: 6669 745f 696d 6167 6573 272c 2065 7869  fit_images', exi
-0001d390: 7374 5f6f 6b3d 4661 6c73 6529 0a0a 2020  st_ok=False)..  
-0001d3a0: 2020 2020 2020 6669 672e 7469 6768 745f        fig.tight_
-0001d3b0: 6c61 796f 7574 2829 0a0a 2020 2020 2020  layout()..      
-0001d3c0: 2020 6669 6c65 3d66 696c 656e 616d 652e    file=filename.
-0001d3d0: 7273 706c 6974 2827 2e74 7874 272c 2031  rsplit('.txt', 1
-0001d3e0: 295b 305d 0a20 2020 2020 2020 2066 6967  )[0].        fig
-0001d3f0: 2e73 6176 6566 6967 2870 6174 6833 2b27  .savefig(path3+'
-0001d400: 2f27 2b27 4469 6164 315f 4669 745f 7b7d  /'+'Diad1_Fit_{}
-0001d410: 2e70 6e67 272e 666f 726d 6174 2866 696c  .png'.format(fil
-0001d420: 6529 2c20 6470 693d 636f 6e66 6967 312e  e), dpi=config1.
-0001d430: 6470 6929 0a0a 2020 2020 2020 2020 6966  dpi)..        if
-0001d440: 2063 6c6f 7365 5f66 6967 7572 6520 6973   close_figure is
-0001d450: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-0001d460: 2020 2070 6c74 2e63 6c6f 7365 2866 6967     plt.close(fig
-0001d470: 290a 0a20 2020 2069 6620 2063 6f6e 6669  )..    if  confi
-0001d480: 6731 2e72 6574 7572 6e5f 6f74 6865 725f  g1.return_other_
-0001d490: 7061 7261 6d73 2069 7320 4661 6c73 653a  params is False:
-0001d4a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d4b0: 6466 5f6f 7574 0a20 2020 2065 6c73 653a  df_out.    else:
-0001d4c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d4d0: 6466 5f6f 7574 2c20 7265 7375 6c74 2c20  df_out, result, 
-0001d4e0: 795f 6265 7374 5f66 6974 2c20 785f 6c69  y_best_fit, x_li
-0001d4f0: 6e0a 0a0a 6465 6620 636f 6d62 696e 655f  n...def combine_
-0001d500: 6469 6164 5f6f 7574 7075 7473 282a 2c20  diad_outputs(*, 
-0001d510: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2070  filename=None, p
-0001d520: 7265 6669 783d 5472 7565 2c0a 4469 6164  refix=True,.Diad
-0001d530: 315f 6669 743d 4e6f 6e65 2c20 4469 6164  1_fit=None, Diad
-0001d540: 325f 6669 743d 4e6f 6e65 2c20 746f 5f63  2_fit=None, to_c
-0001d550: 7376 3d46 616c 7365 2c0a 746f 5f63 6c69  sv=False,.to_cli
-0001d560: 7062 6f61 7264 3d46 616c 7365 2c20 7061  pboard=False, pa
-0001d570: 7468 3d4e 6f6e 6529 3a0a 2020 2020 2222  th=None):.    ""
-0001d580: 2220 5468 6973 2066 756e 6374 696f 6e20  " This function 
-0001d590: 636f 6d62 696e 6573 2074 6865 2064 6174  combines the dat
-0001d5a0: 6166 7261 6d65 7320 6672 6f6d 2066 6974  aframes from fit
-0001d5b0: 5f64 6961 645f 325f 775f 6263 6b20 616e  _diad_2_w_bck an
-0001d5c0: 6420 6669 745f 6469 6164 5f31 5f77 5f62  d fit_diad_1_w_b
-0001d5d0: 636b 2069 6e74 6f20 6120 7369 6e67 6c65  ck into a single
-0001d5e0: 2064 6174 6166 7261 6d65 0a0a 2020 2020   dataframe..    
-0001d5f0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001d600: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a  --------------..
-0001d610: 2020 2020 6669 6c65 6e61 6d65 3a20 7374      filename: st
-0001d620: 720a 2020 2020 2020 2020 6669 6c65 6e61  r.        filena
-0001d630: 6d65 2064 6174 6120 6973 2066 6f72 0a0a  me data is for..
-0001d640: 2020 2020 7072 6566 6978 3a20 626f 6f6c      prefix: bool
-0001d650: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
-0001d660: 2c20 7370 6c69 7473 2066 696c 656e 616d  , splits filenam
-0001d670: 6520 6f6e 2027 2027 2c20 6966 2046 616c  e on ' ', if Fal
-0001d680: 7365 2c20 6c65 6176 6573 2061 7320 6973  se, leaves as is
-0001d690: 0a0a 2020 2020 4469 6164 315f 6669 743a  ..    Diad1_fit:
-0001d6a0: 2070 642e 4461 7461 4672 616d 650a 2020   pd.DataFrame.  
-0001d6b0: 2020 2020 2020 7064 2e44 6174 6146 7261        pd.DataFra
-0001d6c0: 6d65 206f 6620 6669 7420 6672 6f6d 2066  me of fit from f
-0001d6d0: 6974 5f64 6961 645f 315f 775f 6263 6b20  it_diad_1_w_bck 
-0001d6e0: 6675 6e63 7469 6f6e 0a0a 2020 2020 4469  function..    Di
-0001d6f0: 6164 325f 6669 743a 2070 642e 4461 7461  ad2_fit: pd.Data
-0001d700: 4672 616d 650a 2020 2020 2020 2020 7064  Frame.        pd
-0001d710: 2e44 6174 6146 7261 6d65 206f 6620 6669  .DataFrame of fi
-0001d720: 7420 6672 6f6d 2066 6974 5f64 6961 645f  t from fit_diad_
-0001d730: 325f 775f 6263 6b20 6675 6e63 7469 6f6e  2_w_bck function
-0001d740: 0a0a 2020 2020 746f 5f63 6c69 7062 6f61  ..    to_clipboa
-0001d750: 7264 3a20 626f 6f6c 0a20 2020 2020 2020  rd: bool.       
-0001d760: 2049 6620 5472 7565 2c20 636f 7069 6573   If True, copies
-0001d770: 206d 6572 6765 6420 6461 7461 6672 616d   merged datafram
-0001d780: 6520 746f 2063 6c69 7062 6f61 7264 0a0a  e to clipboard..
-0001d790: 2020 2020 746f 5f63 7376 3a20 626f 6f6c      to_csv: bool
-0001d7a0: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
-0001d7b0: 2c20 7361 7665 7320 6669 7420 746f 2043  , saves fit to C
-0001d7c0: 7376 2c20 6279 206d 616b 696e 6720 6120  sv, by making a 
-0001d7d0: 7375 6266 6f6c 6465 7220 2744 6961 645f  subfolder 'Diad_
-0001d7e0: 4669 7473 2720 696e 7369 6465 2074 6865  Fits' inside the
-0001d7f0: 2066 6f6c 6465 7220 2770 6174 6827 0a0a   folder 'path'..
-0001d800: 0a0a 0a20 2020 2022 2222 0a0a 2020 2020  ...    """..    
-0001d810: 6966 2070 7265 6669 7820 6973 2054 7275  if prefix is Tru
-0001d820: 653a 0a20 2020 2020 2020 2066 696c 656e  e:.        filen
-0001d830: 616d 653d 6669 6c65 6e61 6d65 2e73 706c  ame=filename.spl
-0001d840: 6974 2827 2027 295b 313a 5d5b 305d 0a0a  it(' ')[1:][0]..
-0001d850: 2020 2020 6966 2044 6961 6431 5f66 6974      if Diad1_fit
-0001d860: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0001d870: 2044 6961 6432 5f66 6974 2069 7320 6e6f   Diad2_fit is no
-0001d880: 7420 4e6f 6e65 3a0a 0a20 2020 2020 2020  t None:..       
-0001d890: 2063 6f6d 626f 3d70 642e 636f 6e63 6174   combo=pd.concat
-0001d8a0: 285b 4469 6164 315f 6669 742c 2044 6961  ([Diad1_fit, Dia
-0001d8b0: 6432 5f66 6974 5d2c 2061 7869 733d 3129  d2_fit], axis=1)
-0001d8c0: 0a20 2020 2020 2020 2023 2046 696c 6c20  .        # Fill 
-0001d8d0: 616e 7920 636f 6c75 6d6e 7320 7768 6963  any columns whic
-0001d8e0: 6820 646f 6e74 2720 6578 6973 7420 736f  h dont' exist so
-0001d8f0: 2063 616e 2072 652d 6f72 6465 7220 7468   can re-order th
-0001d900: 6520 7361 6d65 2065 7665 7279 2074 696d  e same every tim
-0001d910: 650a 2020 2020 2020 2020 6966 2027 4842  e.        if 'HB
-0001d920: 315f 4365 6e74 2720 6e6f 7420 696e 2063  1_Cent' not in c
-0001d930: 6f6d 626f 2e63 6f6c 756d 6e73 3a0a 2020  ombo.columns:.  
-0001d940: 2020 2020 2020 2020 2020 636f 6d62 6f5b            combo[
-0001d950: 2748 4231 5f43 656e 7427 5d3d 6e70 2e6e  'HB1_Cent']=np.n
-0001d960: 616e 0a20 2020 2020 2020 2020 2020 2063  an.            c
-0001d970: 6f6d 626f 5b27 4842 315f 4172 6561 275d  ombo['HB1_Area']
-0001d980: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
-0001d990: 2020 2020 636f 6d62 6f5b 2748 4231 5f53      combo['HB1_S
-0001d9a0: 6967 6d61 275d 3d6e 702e 6e61 6e0a 2020  igma']=np.nan.  
-0001d9b0: 2020 2020 2020 6966 2027 4842 325f 4365        if 'HB2_Ce
-0001d9c0: 6e74 2720 6e6f 7420 696e 2063 6f6d 626f  nt' not in combo
-0001d9d0: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-0001d9e0: 2020 2020 2020 636f 6d62 6f5b 2748 4232        combo['HB2
-0001d9f0: 5f43 656e 7427 5d3d 6e70 2e6e 616e 0a20  _Cent']=np.nan. 
-0001da00: 2020 2020 2020 2020 2020 2063 6f6d 626f             combo
-0001da10: 5b27 4842 325f 4172 6561 275d 3d6e 702e  ['HB2_Area']=np.
-0001da20: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-0001da30: 636f 6d62 6f5b 2748 4232 5f53 6967 6d61  combo['HB2_Sigma
-0001da40: 275d 3d6e 702e 6e61 6e0a 2020 2020 2020  ']=np.nan.      
-0001da50: 2020 6966 2027 4331 335f 4365 6e74 2720    if 'C13_Cent' 
-0001da60: 6e6f 7420 696e 2063 6f6d 626f 2e63 6f6c  not in combo.col
-0001da70: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0001da80: 2020 636f 6d62 6f5b 2743 3133 5f43 656e    combo['C13_Cen
-0001da90: 7427 5d3d 6e70 2e6e 616e 0a20 2020 2020  t']=np.nan.     
-0001daa0: 2020 2020 2020 2063 6f6d 626f 5b27 4331         combo['C1
-0001dab0: 335f 4172 6561 275d 3d6e 702e 6e61 6e0a  3_Area']=np.nan.
-0001dac0: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0001dad0: 6f5b 2743 3133 5f53 6967 6d61 275d 3d6e  o['C13_Sigma']=n
-0001dae0: 702e 6e61 6e0a 2020 2020 2020 2020 6966  p.nan.        if
-0001daf0: 2027 4469 6164 315f 4761 7573 735f 4365   'Diad1_Gauss_Ce
-0001db00: 6e74 2720 6e6f 7420 696e 2063 6f6d 626f  nt' not in combo
-0001db10: 2e63 6f6c 756d 6e73 3a0a 2020 2020 2020  .columns:.      
-0001db20: 2020 2020 2020 636f 6d62 6f5b 2744 6961        combo['Dia
-0001db30: 6431 5f47 6175 7373 5f43 656e 7427 5d3d  d1_Gauss_Cent']=
-0001db40: 6e70 2e6e 616e 0a20 2020 2020 2020 2020  np.nan.         
-0001db50: 2020 2063 6f6d 626f 5b27 4469 6164 315f     combo['Diad1_
-0001db60: 4761 7573 735f 4172 6561 275d 3d6e 702e  Gauss_Area']=np.
-0001db70: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-0001db80: 636f 6d62 6f5b 2744 6961 6431 5f47 6175  combo['Diad1_Gau
-0001db90: 7373 5f53 6967 6d61 275d 3d6e 702e 6e61  ss_Sigma']=np.na
-0001dba0: 6e0a 2020 2020 2020 2020 6966 2027 4469  n.        if 'Di
-0001dbb0: 6164 325f 4761 7573 735f 4365 6e74 2720  ad2_Gauss_Cent' 
-0001dbc0: 6e6f 7420 696e 2063 6f6d 626f 2e63 6f6c  not in combo.col
-0001dbd0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0001dbe0: 2020 636f 6d62 6f5b 2744 6961 6432 5f47    combo['Diad2_G
-0001dbf0: 6175 7373 5f43 656e 7427 5d3d 6e70 2e6e  auss_Cent']=np.n
-0001dc00: 616e 0a20 2020 2020 2020 2020 2020 2063  an.            c
-0001dc10: 6f6d 626f 5b27 4469 6164 325f 4761 7573  ombo['Diad2_Gaus
-0001dc20: 735f 4172 6561 275d 3d6e 702e 6e61 6e0a  s_Area']=np.nan.
-0001dc30: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0001dc40: 6f5b 2744 6961 6432 5f47 6175 7373 5f53  o['Diad2_Gauss_S
-0001dc50: 6967 6d61 275d 3d6e 702e 6e61 6e0a 0a20  igma']=np.nan.. 
-0001dc60: 2020 2020 2020 2063 6f6d 626f 5b27 5370         combo['Sp
-0001dc70: 6c69 7474 696e 6727 5d3d 636f 6d62 6f5b  litting']=combo[
-0001dc80: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
-0001dc90: 7427 5d2d 636f 6d62 6f5b 2744 6961 6431  t']-combo['Diad1
-0001dca0: 5f56 6f69 6774 5f43 656e 7427 5d0a 2020  _Voigt_Cent'].  
-0001dcb0: 2020 2020 2020 2363 6f6d 626f 5b27 5370        #combo['Sp
-0001dcc0: 6c69 745f 6572 725f 6162 7327 5d3d 636f  lit_err_abs']=co
-0001dcd0: 6d62 6f5b 2744 6961 6431 5f63 656e 745f  mbo['Diad1_cent_
-0001dce0: 6572 7227 5d2b 636f 6d62 6f5b 2744 6961  err']+combo['Dia
-0001dcf0: 6432 5f63 656e 745f 6572 7227 5d0a 2020  d2_cent_err'].  
-0001dd00: 2020 2020 2020 636f 6d62 6f5b 2753 706c        combo['Spl
-0001dd10: 6974 5fcf 8327 5d3d 2863 6f6d 626f 5b27  it_..']=(combo['
-0001dd20: 4469 6164 315f 6365 6e74 5f65 7272 275d  Diad1_cent_err']
-0001dd30: 2a2a 322b 636f 6d62 6f5b 2744 6961 6432  **2+combo['Diad2
-0001dd40: 5f63 656e 745f 6572 7227 5d2a 2a32 292a  _cent_err']**2)*
-0001dd50: 2a30 2e35 0a20 2020 2020 2020 2063 6f6c  *0.5.        col
-0001dd60: 735f 746f 5f6d 6f76 6520 3d20 5b27 5370  s_to_move = ['Sp
-0001dd70: 6c69 7474 696e 6727 2c20 2753 706c 6974  litting', 'Split
-0001dd80: 5fcf 8327 2c20 2027 4469 6164 315f 436f  _..',  'Diad1_Co
-0001dd90: 6d62 6f66 6974 5f43 656e 7427 2c20 2744  mbofit_Cent', 'D
-0001dda0: 6961 6431 5f63 656e 745f 6572 7227 2c20  iad1_cent_err', 
-0001ddb0: 2744 6961 6431 5f43 6f6d 626f 6669 745f  'Diad1_Combofit_
-0001ddc0: 4865 6967 6874 272c 2027 4469 6164 315f  Height', 'Diad1_
-0001ddd0: 566f 6967 745f 4365 6e74 272c 2027 4469  Voigt_Cent', 'Di
-0001dde0: 6164 315f 566f 6967 745f 4172 6561 272c  ad1_Voigt_Area',
-0001ddf0: 2027 4469 6164 315f 566f 6967 745f 5369   'Diad1_Voigt_Si
-0001de00: 676d 6127 2c20 2027 4469 6164 315f 5265  gma',  'Diad1_Re
-0001de10: 7369 6475 616c 272c 2027 4469 6164 315f  sidual', 'Diad1_
-0001de20: 5072 6f70 5f4c 6f72 272c 2027 4469 6164  Prop_Lor', 'Diad
-0001de30: 315f 6677 686d 272c 2027 4469 6164 315f  1_fwhm', 'Diad1_
-0001de40: 7265 6669 7427 2c27 4469 6164 325f 436f  refit','Diad2_Co
-0001de50: 6d62 6f66 6974 5f43 656e 7427 2c20 2744  mbofit_Cent', 'D
-0001de60: 6961 6432 5f63 656e 745f 6572 7227 2c20  iad2_cent_err', 
-0001de70: 2027 4469 6164 325f 436f 6d62 6f66 6974   'Diad2_Combofit
-0001de80: 5f48 6569 6768 7427 2c20 2744 6961 6432  _Height', 'Diad2
-0001de90: 5f56 6f69 6774 5f43 656e 7427 2c20 2744  _Voigt_Cent', 'D
-0001dea0: 6961 6432 5f56 6f69 6774 5f41 7265 6127  iad2_Voigt_Area'
-0001deb0: 2c20 2744 6961 6432 5f56 6f69 6774 5f53  , 'Diad2_Voigt_S
-0001dec0: 6967 6d61 272c 2027 4469 6164 325f 566f  igma', 'Diad2_Vo
-0001ded0: 6967 745f 4761 6d6d 6127 2c20 2744 6961  igt_Gamma', 'Dia
-0001dee0: 6432 5f52 6573 6964 7561 6c27 2c20 2744  d2_Residual', 'D
-0001def0: 6961 6432 5f50 726f 705f 4c6f 7227 2c20  iad2_Prop_Lor', 
-0001df00: 2744 6961 6432 5f66 7768 6d27 2c20 2744  'Diad2_fwhm', 'D
-0001df10: 6961 6432 5f72 6566 6974 272c 0a20 2020  iad2_refit',.   
-0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df30: 2027 4842 315f 4365 6e74 272c 2027 4842   'HB1_Cent', 'HB
-0001df40: 315f 4172 6561 272c 2027 4842 315f 5369  1_Area', 'HB1_Si
-0001df50: 676d 6127 2c20 2748 4232 5f43 656e 7427  gma', 'HB2_Cent'
-0001df60: 2c20 2748 4232 5f41 7265 6127 2c20 2748  , 'HB2_Area', 'H
-0001df70: 4232 5f53 6967 6d61 272c 2027 4331 335f  B2_Sigma', 'C13_
-0001df80: 4365 6e74 272c 2027 4331 335f 4172 6561  Cent', 'C13_Area
-0001df90: 272c 2027 4331 335f 5369 676d 6127 2c0a  ', 'C13_Sigma',.
-0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfb0: 2020 2020 2744 6961 6432 5f47 6175 7373      'Diad2_Gauss
-0001dfc0: 5f43 656e 7427 2c20 2744 6961 6432 5f47  _Cent', 'Diad2_G
-0001dfd0: 6175 7373 5f41 7265 6127 2c27 4469 6164  auss_Area','Diad
-0001dfe0: 325f 4761 7573 735f 5369 676d 6127 2c20  2_Gauss_Sigma', 
-0001dff0: 2744 6961 6431 5f47 6175 7373 5f43 656e  'Diad1_Gauss_Cen
-0001e000: 7427 2c20 2744 6961 6431 5f47 6175 7373  t', 'Diad1_Gauss
-0001e010: 5f41 7265 6127 2c27 4469 6164 315f 4761  _Area','Diad1_Ga
-0001e020: 7573 735f 5369 676d 6127 2c5d 0a20 2020  uss_Sigma',].   
-0001e030: 2020 2020 2063 6f6d 626f 5f66 203d 2063       combo_f = c
-0001e040: 6f6d 626f 5b63 6f6c 735f 746f 5f6d 6f76  ombo[cols_to_mov
-0001e050: 6520 2b20 5b0a 2020 2020 2020 2020 2020  e + [.          
-0001e060: 2020 2020 2020 636f 6c20 666f 7220 636f        col for co
-0001e070: 6c20 696e 2063 6f6d 626f 2e63 6f6c 756d  l in combo.colum
-0001e080: 6e73 2069 6620 636f 6c20 6e6f 7420 696e  ns if col not in
-0001e090: 2063 6f6c 735f 746f 5f6d 6f76 655d 5d0a   cols_to_move]].
-0001e0a0: 2020 2020 2020 2020 636f 6d62 6f5f 663d          combo_f=
-0001e0b0: 636f 6d62 6f5f 662e 696c 6f63 5b3a 2c20  combo_f.iloc[:, 
-0001e0c0: 303a 6c65 6e28 636f 6c73 5f74 6f5f 6d6f  0:len(cols_to_mo
-0001e0d0: 7665 295d 0a20 2020 2020 2020 2066 696c  ve)].        fil
-0001e0e0: 653d 6669 6c65 6e61 6d65 2e72 7370 6c69  e=filename.rspli
-0001e0f0: 7428 272e 7478 7427 2c20 3129 5b30 5d0a  t('.txt', 1)[0].
-0001e100: 2020 2020 2020 2020 636f 6d62 6f5f 662e          combo_f.
-0001e110: 696e 7365 7274 2830 2c20 2766 696c 656e  insert(0, 'filen
-0001e120: 616d 6527 2c20 6669 6c65 290a 0a20 2020  ame', file)..   
-0001e130: 2069 6620 4469 6164 315f 6669 7420 6973   if Diad1_fit is
-0001e140: 204e 6f6e 6520 616e 6420 4469 6164 325f   None and Diad2_
-0001e150: 6669 7420 6973 204e 6f6e 653a 0a20 2020  fit is None:.   
-0001e160: 2020 2020 2064 663d 7064 2e44 6174 6146       df=pd.DataF
-0001e170: 7261 6d65 2864 6174 613d 7b27 6669 6c65  rame(data={'file
-0001e180: 6e61 6d65 273a 2066 696c 656e 616d 652c  name': filename,
-0001e190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e1a0: 2020 2020 2020 2020 2020 2020 2027 5370               'Sp
-0001e1b0: 6c69 7474 696e 6727 3a20 6e70 2e6e 616e  litting': np.nan
-0001e1c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1e0: 2020 2744 6961 6431 5f56 6f69 6774 5f43    'Diad1_Voigt_C
-0001e1f0: 656e 7427 3a6e 702e 6e61 6e2c 0a20 2020  ent':np.nan,.   
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e220: 2027 4469 6164 315f 566f 6967 745f 4172   'Diad1_Voigt_Ar
-0001e230: 6561 273a 6e70 2e6e 616e 2c0a 2020 2020  ea':np.nan,.    
-0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e260: 2752 6573 6964 7561 6c5f 4469 6164 3127  'Residual_Diad1'
-0001e270: 3a20 6e70 2e6e 616e 2c0a 2020 2020 2020  : np.nan,.      
-0001e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2a0: 2020 2744 6961 6432 5f56 6f69 6774 5f43    'Diad2_Voigt_C
-0001e2b0: 656e 7427 3a6e 702e 6e61 6e2c 0a20 2020  ent':np.nan,.   
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2e0: 2020 2020 2027 4469 6164 325f 566f 6967       'Diad2_Voig
-0001e2f0: 745f 4172 6561 273a 6e70 2e6e 616e 2c0a  t_Area':np.nan,.
-0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b370: 6c69 7475 6465 2f32 0a20 2020 2020 2020  litude/2.       
+0001b380: 2020 2020 2023 2069 6620 616e 7928 6466       # if any(df
+0001b390: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001b3a0: 7427 5d2e 7374 722e 636f 6e74 6169 6e73  t'].str.contains
+0001b3b0: 2827 4842 315f 4869 6768 416d 7027 2929  ('HB1_HighAmp'))
+0001b3c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001b3d0: 2020 2020 636f 6e66 6967 5f74 7765 616b      config_tweak
+0001b3e0: 6564 322e 4842 5f61 6d70 6c69 7475 6465  ed2.HB_amplitude
+0001b3f0: 3d63 6f6e 6669 675f 7477 6561 6b65 642e  =config_tweaked.
+0001b400: 4842 5f61 6d70 6c69 7475 6465 2a32 0a0a  HB_amplitude*2..
+0001b410: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0001b420: 756c 742c 2064 665f 6f75 742c 2079 5f62  ult, df_out, y_b
+0001b430: 6573 745f 6669 742c 2078 5f6c 696e 2c20  est_fit, x_lin, 
+0001b440: 636f 6d70 6f6e 656e 7473 2c20 7864 6174  components, xdat
+0001b450: 2c20 7964 6174 2c20 6178 315f 786c 696d  , ydat, ax1_xlim
+0001b460: 2c20 6178 325f 786c 696d 2c72 6573 6964  , ax2_xlim,resid
+0001b470: 7561 6c5f 6469 6164 5f63 6f6f 7264 732c  ual_diad_coords,
+0001b480: 2079 6461 745f 696e 7261 6e67 652c 2020   ydat_inrange,  
+0001b490: 7864 6174 5f69 6e72 616e 6765 3d66 6974  xdat_inrange=fit
+0001b4a0: 5f67 6175 7373 6961 6e5f 766f 6967 745f  _gaussian_voigt_
+0001b4b0: 6765 6e65 7269 635f 6469 6164 2863 6f6e  generic_diad(con
+0001b4c0: 6669 675f 7477 6561 6b65 6432 2c64 6961  fig_tweaked2,dia
+0001b4d0: 6431 3d54 7275 652c 2070 6174 683d 7061  d1=True, path=pa
+0001b4e0: 7468 2c20 6669 6c65 6e61 6d65 3d66 696c  th, filename=fil
+0001b4f0: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
+0001b500: 2020 2020 2020 2020 2020 2078 6461 743d             xdat=
+0001b510: 785f 6469 6164 312c 2079 6461 743d 795f  x_diad1, ydat=y_
+0001b520: 636f 7272 5f64 6961 6431 2c0a 2020 2020  corr_diad1,.    
+0001b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b540: 7370 616e 3d73 7061 6e5f 6469 6164 312c  span=span_diad1,
+0001b550: 2070 6c6f 745f 6669 6775 7265 3d46 616c   plot_figure=Fal
+0001b560: 7365 2c20 4469 6164 5f70 6f73 3d44 6961  se, Diad_pos=Dia
+0001b570: 645f 706f 732c 2048 425f 706f 733d 4842  d_pos, HB_pos=HB
+0001b580: 5f70 6f73 2c20 6669 745f 7065 616b 733d  _pos, fit_peaks=
+0001b590: 636f 6e66 6967 5f74 7765 616b 6564 2e66  config_tweaked.f
+0001b5a0: 6974 5f70 6561 6b73 290a 2020 2020 2020  it_peaks).      
+0001b5b0: 2020 2020 2020 693d 692b 310a 2020 2020        i=i+1.    
+0001b5c0: 2020 2020 2020 2020 6966 2069 3e35 3a0a          if i>5:.
+0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5e0: 7072 696e 7428 2747 6f74 2074 6f20 3520  print('Got to 5 
+0001b5f0: 6974 6572 6174 6f69 6e73 2061 6e64 2073  iteratoins and s
+0001b600: 7469 6c6c 2063 6f75 6c64 6e74 2061 646a  till couldnt adj
+0001b610: 7573 7420 7468 6520 6669 7420 7061 7261  ust the fit para
+0001b620: 6d65 7465 7273 2729 0a20 2020 2020 2020  meters').       
+0001b630: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+0001b640: 0a0a 0a0a 0a20 2020 2023 2067 6574 2061  .....    # get a
+0001b650: 2062 6573 7420 6669 7420 746f 2074 6865   best fit to the
+0001b660: 2062 6173 656c 696e 6520 7573 696e 6720   baseline using 
+0001b670: 6120 6c69 6e73 7061 6365 2066 726f 6d20  a linspace from 
+0001b680: 7468 6520 7065 616b 2066 6974 7469 6e67  the peak fitting
+0001b690: 0a20 2020 2079 6261 7365 5f78 6c69 6e3d  .    ybase_xlin=
+0001b6a0: 5066 5f62 6173 656c 696e 655f 6469 6164  Pf_baseline_diad
+0001b6b0: 3128 785f 6c69 6e29 0a0a 2020 2020 2320  1(x_lin)..    # 
+0001b6c0: 5765 2065 7874 7261 6374 2074 6865 2066  We extract the f
+0001b6d0: 756c 6c20 7370 6563 7472 6120 746f 2070  ull spectra to p
+0001b6e0: 6c6f 7420 6174 2074 6865 2065 6e64 2c20  lot at the end, 
+0001b6f0: 616e 6420 636f 6e76 6572 7420 746f 2061  and convert to a
+0001b700: 2064 6174 6166 7261 6d65 0a20 2020 2053   dataframe.    S
+0001b710: 7065 6374 7261 5f64 663d 6765 745f 6461  pectra_df=get_da
+0001b720: 7461 2870 6174 683d 7061 7468 2c20 6669  ta(path=path, fi
+0001b730: 6c65 6e61 6d65 3d66 696c 656e 616d 652c  lename=filename,
+0001b740: 2066 696c 6574 7970 653d 6669 6c65 7479   filetype=filety
+0001b750: 7065 290a 2020 2020 5370 6563 7472 613d  pe).    Spectra=
+0001b760: 6e70 2e61 7272 6179 2853 7065 6374 7261  np.array(Spectra
+0001b770: 5f64 6629 0a0a 0a0a 2020 2020 2320 4d61  _df)....    # Ma
+0001b780: 6b65 206e 6963 6520 6669 6775 7265 0a20  ke nice figure. 
+0001b790: 2020 2069 6620 706c 6f74 5f66 6967 7572     if plot_figur
+0001b7a0: 6520 6973 2054 7275 653a 0a0a 2020 2020  e is True:..    
+0001b7b0: 2020 2020 6669 6775 7265 5f6d 6f73 6169      figure_mosai
+0001b7c0: 633d 2222 220a 2020 2020 2020 2020 5859  c=""".        XY
+0001b7d0: 0a20 2020 2020 2020 2041 420a 2020 2020  .        AB.    
+0001b7e0: 2020 2020 4344 0a20 2020 2020 2020 2045      CD.        E
+0001b7f0: 450a 2020 2020 2020 2020 2222 220a 0a20  E.        """.. 
+0001b800: 2020 2020 2020 2066 6967 2c61 7865 733d         fig,axes=
+0001b810: 706c 742e 7375 6270 6c6f 745f 6d6f 7361  plt.subplot_mosa
+0001b820: 6963 286d 6f73 6169 633d 6669 6775 7265  ic(mosaic=figure
+0001b830: 5f6d 6f73 6169 632c 2066 6967 7369 7a65  _mosaic, figsize
+0001b840: 3d28 3132 2c20 3136 2929 0a20 2020 2020  =(12, 16)).     
+0001b850: 2020 2066 6967 2e73 7570 7469 746c 6528     fig.suptitle(
+0001b860: 2744 6961 6420 312c 2066 696c 653d 2027  'Diad 1, file= '
+0001b870: 2b20 7374 7228 6669 6c65 6e61 6d65 2920  + str(filename) 
+0001b880: 2b20 2720 5c6e 2720 2b20 7374 7228 6466  + ' \n' + str(df
+0001b890: 5f6f 7574 5b27 4469 6164 315f 7265 6669  _out['Diad1_refi
+0001b8a0: 7427 5d2e 696c 6f63 5b30 5d29 2c20 666f  t'].iloc[0]), fo
+0001b8b0: 6e74 7369 7a65 3d31 362c 2078 3d30 2e35  ntsize=16, x=0.5
+0001b8c0: 2c20 793d 312e 3029 0a0a 2020 2020 2020  , y=1.0)..      
+0001b8d0: 2020 2320 4261 636b 6772 6f75 6e64 2070    # Background p
+0001b8e0: 6c6f 7420 666f 7220 7265 610a 0a20 2020  lot for rea..   
+0001b8f0: 2020 2020 2023 2050 6c6f 7420 6265 7374       # Plot best
+0001b900: 2066 6974 206f 6e20 7468 6520 4c48 532c   fit on the LHS,
+0001b910: 2061 6e64 2069 6e64 6976 6964 7561 6c20   and individual 
+0001b920: 6669 7473 206f 6e20 7468 6520 5248 5320  fits on the RHS 
+0001b930: 6174 2074 6865 2074 6f70 0a0a 2020 2020  at the top..    
+0001b940: 2020 2020 6178 6573 5b27 5827 5d2e 7365      axes['X'].se
+0001b950: 745f 7469 746c 6528 2761 2920 4261 636b  t_title('a) Back
+0001b960: 6772 6f75 6e64 2066 6974 2729 0a20 2020  ground fit').   
+0001b970: 2020 2020 2061 7865 735b 2758 275d 2e70       axes['X'].p
+0001b980: 6c6f 7428 4469 6164 5b3a 2c20 305d 2c20  lot(Diad[:, 0], 
+0001b990: 4469 6164 5b3a 2c20 315d 2c20 272d 272c  Diad[:, 1], '-',
+0001b9a0: 2063 6f6c 6f72 3d27 6772 6579 2729 0a20   color='grey'). 
+0001b9b0: 2020 2020 2020 2061 7865 735b 2758 275d         axes['X']
+0001b9c0: 2e70 6c6f 7428 4469 6164 5f73 686f 7274  .plot(Diad_short
+0001b9d0: 5f64 6961 6431 5b3a 2c20 305d 2c20 4469  _diad1[:, 0], Di
+0001b9e0: 6164 5f73 686f 7274 5f64 6961 6431 5b3a  ad_short_diad1[:
+0001b9f0: 2c20 315d 2c20 272d 7227 2c20 6c61 6265  , 1], '-r', labe
+0001ba00: 6c3d 2753 7065 6374 7261 2729 0a0a 2020  l='Spectra')..  
+0001ba10: 2020 2020 2020 2361 7865 735b 2758 275d        #axes['X']
+0001ba20: 2e70 6c6f 7428 4261 7365 6c69 6e65 5b3a  .plot(Baseline[:
+0001ba30: 2c20 305d 2c20 4261 7365 6c69 6e65 5b3a  , 0], Baseline[:
+0001ba40: 2c20 315d 2c20 272d 6227 2c20 6c61 6265  , 1], '-b', labe
+0001ba50: 6c3d 2742 636b 2070 6f69 6e74 7327 290a  l='Bck points').
+0001ba60: 2020 2020 2020 2020 6178 6573 5b27 5827          axes['X'
+0001ba70: 5d2e 706c 6f74 2842 6173 656c 696e 655f  ].plot(Baseline_
+0001ba80: 6469 6164 315b 3a2c 2030 5d2c 2042 6173  diad1[:, 0], Bas
+0001ba90: 656c 696e 655f 6469 6164 315b 3a2c 2031  eline_diad1[:, 1
+0001baa0: 5d2c 2027 2e62 272c 206c 6162 656c 3d27  ], '.b', label='
+0001bab0: 5365 6c2e 2062 636b 2e20 7074 7327 290a  Sel. bck. pts').
+0001bac0: 2020 2020 2020 2020 6178 6573 5b27 5827          axes['X'
+0001bad0: 5d2e 706c 6f74 2844 6961 645f 7368 6f72  ].plot(Diad_shor
+0001bae0: 745f 6469 6164 315b 3a2c 2030 5d2c 2050  t_diad1[:, 0], P
+0001baf0: 795f 6261 7365 5f64 6961 6431 2c20 272d  y_base_diad1, '-
+0001bb00: 6b27 2c20 6c61 6265 6c3d 2762 636b 2e20  k', label='bck. 
+0001bb10: 706f 6c79 2066 6974 2729 0a0a 0a0a 2020  poly fit')....  
+0001bb20: 2020 2020 2020 6178 315f 796d 696e 3d6e        ax1_ymin=n
+0001bb30: 702e 6d69 6e28 4261 7365 6c69 6e65 5f64  p.min(Baseline_d
+0001bb40: 6961 6431 5b3a 2c20 315d 292d 3130 2a6e  iad1[:, 1])-10*n
+0001bb50: 702e 7374 6428 4261 7365 6c69 6e65 5f64  p.std(Baseline_d
+0001bb60: 6961 6431 5b3a 2c20 315d 290a 2020 2020  iad1[:, 1]).    
+0001bb70: 2020 2020 6178 315f 796d 6178 3d6e 702e      ax1_ymax=np.
+0001bb80: 6d61 7828 4261 7365 6c69 6e65 5f64 6961  max(Baseline_dia
+0001bb90: 6431 5b3a 2c20 315d 292b 3130 2a6e 702e  d1[:, 1])+10*np.
+0001bba0: 7374 6428 4261 7365 6c69 6e65 5f64 6961  std(Baseline_dia
+0001bbb0: 6431 5b3a 2c20 315d 290a 2020 2020 2020  d1[:, 1]).      
+0001bbc0: 2020 6178 315f 786d 696e 3d63 6f6e 6669    ax1_xmin=confi
+0001bbd0: 6731 2e6c 6f77 6572 5f62 636b 5f64 6961  g1.lower_bck_dia
+0001bbe0: 6431 5b30 5d2d 3330 0a20 2020 2020 2020  d1[0]-30.       
+0001bbf0: 2061 7831 5f78 6d61 783d 636f 6e66 6967   ax1_xmax=config
+0001bc00: 312e 7570 7065 725f 6263 6b5f 6469 6164  1.upper_bck_diad
+0001bc10: 315b 315d 2b33 300a 2020 2020 2020 2020  1[1]+30.        
+0001bc20: 2320 4164 6469 6e67 2070 6174 6368 6573  # Adding patches
+0001bc30: 0a0a 0a20 2020 2020 2020 2072 6563 745f  ...        rect_
+0001bc40: 6469 6164 315f 6231 3d70 6174 6368 6573  diad1_b1=patches
+0001bc50: 2e52 6563 7461 6e67 6c65 2828 636f 6e66  .Rectangle((conf
+0001bc60: 6967 312e 6c6f 7765 725f 6263 6b5f 6469  ig1.lower_bck_di
+0001bc70: 6164 315b 305d 2c20 6178 315f 796d 696e  ad1[0], ax1_ymin
+0001bc80: 292c 636f 6e66 6967 312e 6c6f 7765 725f  ),config1.lower_
+0001bc90: 6263 6b5f 6469 6164 315b 315d 2d63 6f6e  bck_diad1[1]-con
+0001bca0: 6669 6731 2e6c 6f77 6572 5f62 636b 5f64  fig1.lower_bck_d
+0001bcb0: 6961 6431 5b30 5d2c 6178 315f 796d 6178  iad1[0],ax1_ymax
+0001bcc0: 2d61 7831 5f79 6d69 6e2c 0a20 2020 2020  -ax1_ymin,.     
+0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bce0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+0001bcf0: 6964 7468 3d31 2c65 6467 6563 6f6c 6f72  idth=1,edgecolor
+0001bd00: 3d27 6e6f 6e65 272c 6661 6365 636f 6c6f  ='none',facecolo
+0001bd10: 723d 2763 7961 6e27 2c20 6c61 6265 6c3d  r='cyan', label=
+0001bd20: 2773 656c 2e20 6263 6b2e 2072 6567 696f  'sel. bck. regio
+0001bd30: 6e27 2c20 616c 7068 613d 302e 332c 207a  n', alpha=0.3, z
+0001bd40: 6f72 6465 723d 3029 0a20 2020 2020 2020  order=0).       
+0001bd50: 2061 7865 735b 2758 275d 2e61 6464 5f70   axes['X'].add_p
+0001bd60: 6174 6368 2872 6563 745f 6469 6164 315f  atch(rect_diad1_
+0001bd70: 6231 290a 2020 2020 2020 2020 7265 6374  b1).        rect
+0001bd80: 5f64 6961 6431 5f62 323d 7061 7463 6865  _diad1_b2=patche
+0001bd90: 732e 5265 6374 616e 676c 6528 2863 6f6e  s.Rectangle((con
+0001bda0: 6669 6731 2e75 7070 6572 5f62 636b 5f64  fig1.upper_bck_d
+0001bdb0: 6961 6431 5b30 5d2c 2061 7831 5f79 6d69  iad1[0], ax1_ymi
+0001bdc0: 6e29 2c63 6f6e 6669 6731 2e75 7070 6572  n),config1.upper
+0001bdd0: 5f62 636b 5f64 6961 6431 5b31 5d2d 636f  _bck_diad1[1]-co
+0001bde0: 6e66 6967 312e 7570 7065 725f 6263 6b5f  nfig1.upper_bck_
+0001bdf0: 6469 6164 315b 305d 2c61 7831 5f79 6d61  diad1[0],ax1_yma
+0001be00: 782d 6178 315f 796d 696e 2c0a 2020 2020  x-ax1_ymin,.    
+0001be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be20: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+0001be30: 7769 6474 683d 312c 6564 6765 636f 6c6f  width=1,edgecolo
+0001be40: 723d 276e 6f6e 6527 2c66 6163 6563 6f6c  r='none',facecol
+0001be50: 6f72 3d27 6379 616e 272c 2061 6c70 6861  or='cyan', alpha
+0001be60: 3d30 2e33 2c20 7a6f 7264 6572 3d30 290a  =0.3, zorder=0).
+0001be70: 2020 2020 2020 2020 6178 6573 5b27 5827          axes['X'
+0001be80: 5d2e 6164 645f 7061 7463 6828 7265 6374  ].add_patch(rect
+0001be90: 5f64 6961 6431 5f62 3229 0a20 2020 2020  _diad1_b2).     
+0001bea0: 2020 2061 7865 735b 2758 275d 2e73 6574     axes['X'].set
+0001beb0: 5f78 6c69 6d28 5b61 7831 5f78 6d69 6e2c  _xlim([ax1_xmin,
+0001bec0: 2061 7831 5f78 6d61 785d 290a 2020 2020   ax1_xmax]).    
+0001bed0: 2020 2020 6178 6573 5b27 5827 5d2e 7365      axes['X'].se
+0001bee0: 745f 796c 696d 285b 6178 315f 796d 696e  t_ylim([ax1_ymin
+0001bef0: 2c20 6178 315f 796d 6178 5d29 0a0a 2020  , ax1_ymax])..  
+0001bf00: 2020 2020 2020 6178 6573 5b27 5827 5d2e        axes['X'].
+0001bf10: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+0001bf20: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+0001bf30: 6178 6573 5b27 5927 5d2e 7365 745f 796c  axes['Y'].set_yl
+0001bf40: 6162 656c 2827 496e 7465 6e73 6974 7927  abel('Intensity'
+0001bf50: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+0001bf60: 5927 5d2e 7365 745f 786c 6162 656c 2827  Y'].set_xlabel('
+0001bf70: 5761 7665 6e75 6d62 6572 2729 0a20 2020  Wavenumber').   
+0001bf80: 2020 2020 2061 7865 735b 2758 275d 2e6c       axes['X'].l
+0001bf90: 6567 656e 6428 290a 0a0a 0a20 2020 2020  egend()....     
+0001bfa0: 2020 2061 7865 735b 2759 275d 2e73 6574     axes['Y'].set
+0001bfb0: 5f74 6974 6c65 2827 6229 2042 6163 6b67  _title('b) Backg
+0001bfc0: 726f 756e 6420 7375 6274 7261 6374 6564  round subtracted
+0001bfd0: 2073 7065 6374 7261 2729 0a20 2020 2020   spectra').     
+0001bfe0: 2020 2061 7865 735b 2759 275d 2e70 6c6f     axes['Y'].plo
+0001bff0: 7428 785f 6469 6164 312c 2079 5f63 6f72  t(x_diad1, y_cor
+0001c000: 725f 6469 6164 312c 2027 2d72 2729 0a20  r_diad1, '-r'). 
+0001c010: 2020 2020 2020 2068 6569 6768 745f 703d         height_p=
+0001c020: 6e70 2e6d 6178 2844 6961 645f 7368 6f72  np.max(Diad_shor
+0001c030: 745f 6469 6164 315b 3a2c 2031 5d29 2d6e  t_diad1[:, 1])-n
+0001c040: 702e 6d69 6e28 4469 6164 5f73 686f 7274  p.min(Diad_short
+0001c050: 5f64 6961 6431 5b3a 2c20 315d 290a 2020  _diad1[:, 1]).  
+0001c060: 2020 2020 2020 6178 6573 5b27 5927 5d2e        axes['Y'].
+0001c070: 7365 745f 796c 696d 285b 6e70 2e6d 696e  set_ylim([np.min
+0001c080: 2879 5f63 6f72 725f 6469 6164 3129 2c20  (y_corr_diad1), 
+0001c090: 312e 322a 6865 6967 6874 5f70 205d 290a  1.2*height_p ]).
+0001c0a0: 2020 2020 2020 2020 6178 6573 5b27 5827          axes['X'
+0001c0b0: 5d2e 7365 745f 786c 6162 656c 2827 5761  ].set_xlabel('Wa
+0001c0c0: 7665 6e75 6d62 6572 2729 0a0a 0a0a 2020  venumber')....  
+0001c0d0: 2020 2020 2020 6178 6573 5b27 4127 5d2e        axes['A'].
+0001c0e0: 706c 6f74 2878 6461 742c 2079 6461 742c  plot(xdat, ydat,
+0001c0f0: 2020 272e 6b27 2c20 6c61 6265 6c3d 2762    '.k', label='b
+0001c100: 636b 2e20 7375 622e 2064 6174 6127 290a  ck. sub. data').
+0001c110: 2020 2020 2020 2020 6178 6573 5b27 4127          axes['A'
+0001c120: 5d2e 706c 6f74 2820 785f 6c69 6e20 2c79  ].plot( x_lin ,y
+0001c130: 5f62 6573 745f 6669 742c 2027 2d67 272c  _best_fit, '-g',
+0001c140: 206c 696e 6577 6964 7468 3d31 2c20 6c61   linewidth=1, la
+0001c150: 6265 6c3d 2762 6573 7420 6669 7427 290a  bel='best fit').
+0001c160: 2020 2020 2020 2020 6178 6573 5b27 4127          axes['A'
+0001c170: 5d2e 6c65 6765 6e64 2829 0a20 2020 2020  ].legend().     
+0001c180: 2020 2061 7865 735b 2741 275d 2e73 6574     axes['A'].set
+0001c190: 5f79 6c61 6265 6c28 2749 6e74 656e 7369  _ylabel('Intensi
+0001c1a0: 7479 2729 0a20 2020 2020 2020 2061 7865  ty').        axe
+0001c1b0: 735b 2741 275d 2e73 6574 5f78 6c61 6265  s['A'].set_xlabe
+0001c1c0: 6c28 2757 6176 656e 756d 6265 7227 290a  l('Wavenumber').
+0001c1d0: 2020 2020 2020 2020 6178 6573 5b27 4127          axes['A'
+0001c1e0: 5d2e 7365 745f 786c 696d 2861 7831 5f78  ].set_xlim(ax1_x
+0001c1f0: 6c69 6d29 0a20 2020 2020 2020 2061 7865  lim).        axe
+0001c200: 735b 2741 275d 2e73 6574 5f74 6974 6c65  s['A'].set_title
+0001c210: 2827 6329 204f 7665 7261 6c6c 2042 6573  ('c) Overall Bes
+0001c220: 7420 4669 7427 290a 0a20 2020 2023 2069  t Fit')..    # i
+0001c230: 6e64 6976 6964 7561 6c20 6669 7473 0a20  ndividual fits. 
+0001c240: 2020 2020 2020 2061 7865 735b 2742 275d         axes['B']
+0001c250: 2e70 6c6f 7428 7864 6174 2c20 7964 6174  .plot(xdat, ydat
+0001c260: 2c20 272e 6b27 290a 0a20 2020 2020 2020  , '.k')..       
+0001c270: 2023 2054 6869 7320 6973 2066 6f72 2069   # This is for i
+0001c280: 6620 7468 6572 6520 6973 206d 6f72 6520  f there is more 
+0001c290: 7468 616e 2031 2070 6561 6b2c 2074 6869  than 1 peak, thi
+0001c2a0: 7320 6973 2077 6865 6e20 7765 2077 616e  s is when we wan
+0001c2b0: 7420 746f 2070 6c6f 7420 7468 6520 6265  t to plot the be
+0001c2c0: 7374 2066 6974 0a20 2020 2020 2020 2069  st fit.        i
+0001c2d0: 6620 6669 745f 7065 616b 733e 313a 0a0a  f fit_peaks>1:..
+0001c2e0: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+0001c2f0: 5b27 4227 5d2e 706c 6f74 2878 5f6c 696e  ['B'].plot(x_lin
+0001c300: 2c20 636f 6d70 6f6e 656e 7473 2e67 6574  , components.get
+0001c310: 2827 6c7a 325f 2729 2c20 272d 7227 2c20  ('lz2_'), '-r', 
+0001c320: 6c69 6e65 7769 6474 683d 322c 206c 6162  linewidth=2, lab
+0001c330: 656c 3d27 4842 3127 290a 0a20 2020 2020  el='HB1')..     
+0001c340: 2020 2061 7865 735b 2742 275d 2e70 6c6f     axes['B'].plo
+0001c350: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
+0001c360: 6e74 732e 6765 7428 276c 7a31 5f27 292c  nts.get('lz1_'),
+0001c370: 2027 2d62 272c 206c 696e 6577 6964 7468   '-b', linewidth
+0001c380: 3d32 2c20 6c61 6265 6c3d 2744 6961 6431  =2, label='Diad1
+0001c390: 2729 0a20 2020 2020 2020 2069 6620 636f  ').        if co
+0001c3a0: 6e66 6967 312e 6669 745f 6761 7573 7320  nfig1.fit_gauss 
+0001c3b0: 6973 206e 6f74 2046 616c 7365 3a0a 2020  is not False:.  
+0001c3c0: 2020 2020 2020 2020 2020 6178 6573 5b27            axes['
+0001c3d0: 4227 5d2e 706c 6f74 2878 5f6c 696e 2c20  B'].plot(x_lin, 
+0001c3e0: 636f 6d70 6f6e 656e 7473 2e67 6574 2827  components.get('
+0001c3f0: 626b 675f 2729 2c20 272d 6d27 2c20 6c61  bkg_'), '-m', la
+0001c400: 6265 6c3d 2747 6175 7373 6961 6e20 6263  bel='Gaussian bc
+0001c410: 6b27 2c20 6c69 6e65 7769 6474 683d 3229  k', linewidth=2)
+0001c420: 0a20 2020 2020 2020 2023 6178 322e 706c  .        #ax2.pl
+0001c430: 6f74 2878 6461 742c 2072 6573 756c 742e  ot(xdat, result.
+0001c440: 6265 7374 5f66 6974 2c20 272d 6727 2c20  best_fit, '-g', 
+0001c450: 6c61 6265 6c3d 2762 6573 7420 6669 7427  label='best fit'
+0001c460: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+0001c470: 4227 5d2e 6c65 6765 6e64 2829 0a0a 2020  B'].legend()..  
+0001c480: 2020 2020 2020 6669 7473 7061 6e3d 6d61        fitspan=ma
+0001c490: 7828 795f 6265 7374 5f66 6974 292d 6d69  x(y_best_fit)-mi
+0001c4a0: 6e28 795f 6265 7374 5f66 6974 290a 2020  n(y_best_fit).  
+0001c4b0: 2020 2020 2020 6178 6573 5b27 4227 5d2e        axes['B'].
+0001c4c0: 7365 745f 796c 696d 285b 6d69 6e28 795f  set_ylim([min(y_
+0001c4d0: 6265 7374 5f66 6974 292d 6669 7473 7061  best_fit)-fitspa
+0001c4e0: 6e2f 352c 206d 6178 2879 5f62 6573 745f  n/5, max(y_best_
+0001c4f0: 6669 7429 2b66 6974 7370 616e 2f35 5d29  fit)+fitspan/5])
+0001c500: 0a0a 2020 2020 2020 2020 6178 6573 5b27  ..        axes['
+0001c510: 4227 5d2e 7365 745f 796c 6162 656c 2827  B'].set_ylabel('
+0001c520: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+0001c530: 2020 2020 6178 6573 5b27 4227 5d2e 7365      axes['B'].se
+0001c540: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
+0001c550: 6d62 6572 2729 0a0a 0a20 2020 2020 2020  mber')...       
+0001c560: 2061 7865 735b 2742 275d 2e73 6574 5f78   axes['B'].set_x
+0001c570: 6c69 6d28 6178 325f 786c 696d 290a 0a20  lim(ax2_xlim).. 
+0001c580: 2020 2020 2020 2023 2044 6173 6865 6420         # Dashed 
+0001c590: 6c69 6e65 7320 736f 206d 6174 6368 6573  lines so matches
+0001c5a0: 2070 6172 7420 440a 2020 2020 2020 2020   part D.        
+0001c5b0: 6178 6573 5b27 4227 5d2e 706c 6f74 285b  axes['B'].plot([
+0001c5c0: 6466 5f6f 7574 5b27 4469 6164 315f 566f  df_out['Diad1_Vo
+0001c5d0: 6967 745f 4365 6e74 275d 2c20 6466 5f6f  igt_Cent'], df_o
+0001c5e0: 7574 5b27 4469 6164 315f 566f 6967 745f  ut['Diad1_Voigt_
+0001c5f0: 4365 6e74 275d 5d2c 205b 6e70 2e6d 696e  Cent']], [np.min
+0001c600: 2879 6461 7429 2c20 6e70 2e6d 6178 2879  (ydat), np.max(y
+0001c610: 6461 7429 5d2c 2027 3a62 2729 0a0a 2020  dat)], ':b')..  
+0001c620: 2020 2020 2020 6966 2066 6974 5f70 6561        if fit_pea
+0001c630: 6b73 3e32 3a0a 2020 2020 2020 2020 2020  ks>2:.          
+0001c640: 2020 6178 6573 5b27 4227 5d2e 706c 6f74    axes['B'].plot
+0001c650: 285b 6466 5f6f 7574 5b27 4842 315f 4365  ([df_out['HB1_Ce
+0001c660: 6e74 275d 2c20 6466 5f6f 7574 5b27 4842  nt'], df_out['HB
+0001c670: 315f 4365 6e74 275d 5d2c 205b 6e70 2e6d  1_Cent']], [np.m
+0001c680: 696e 2879 6461 7429 2c20 6e70 2e6d 6178  in(ydat), np.max
+0001c690: 2879 6461 7429 5d2c 2027 3a72 2729 0a0a  (ydat)], ':r')..
+0001c6a0: 2020 2020 2020 2020 6178 6573 5b27 4227          axes['B'
+0001c6b0: 5d2e 7365 745f 7469 746c 6528 2763 2920  ].set_title('c) 
+0001c6c0: 4669 7420 436f 6d70 6f6e 656e 7473 2729  Fit Components')
+0001c6d0: 0a0a 2020 2020 2020 2020 2320 4261 636b  ..        # Back
+0001c6e0: 6772 6f75 6e64 2066 6974 0a0a 2020 2020  ground fit..    
+0001c6f0: 2020 2020 2320 4669 7273 742c 2073 6574      # First, set
+0001c700: 2075 7020 7820 616e 6420 7920 6c69 6d69   up x and y limi
+0001c710: 7473 206f 6e20 6178 6973 0a0a 2020 2020  ts on axis..    
+0001c720: 2020 2020 6966 2063 6f6e 6669 6731 2e78      if config1.x
+0001c730: 5f72 616e 6765 5f62 6173 656c 696e 6520  _range_baseline 
+0001c740: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001c750: 2020 2020 2020 2020 2061 7863 5f78 6d69           axc_xmi
+0001c760: 6e3d 6466 5f6f 7574 5b27 4469 6164 315f  n=df_out['Diad1_
+0001c770: 566f 6967 745f 4365 6e74 275d 5b30 5d2d  Voigt_Cent'][0]-
+0001c780: 636f 6e66 6967 312e 785f 7261 6e67 655f  config1.x_range_
+0001c790: 6261 7365 6c69 6e65 0a20 2020 2020 2020  baseline.       
+0001c7a0: 2020 2020 2061 7863 5f78 6d61 783d 6466       axc_xmax=df
+0001c7b0: 5f6f 7574 5b27 4469 6164 315f 566f 6967  _out['Diad1_Voig
+0001c7c0: 745f 4365 6e74 275d 5b30 5d2b 636f 6e66  t_Cent'][0]+conf
+0001c7d0: 6967 312e 785f 7261 6e67 655f 6261 7365  ig1.x_range_base
+0001c7e0: 6c69 6e65 0a20 2020 2020 2020 2065 6c73  line.        els
+0001c7f0: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
+0001c800: 7863 5f78 6d69 6e3d 636f 6e66 6967 312e  xc_xmin=config1.
+0001c810: 6c6f 7765 725f 6263 6b5f 6469 6164 315b  lower_bck_diad1[
+0001c820: 305d 0a20 2020 2020 2020 2020 2020 2061  0].            a
+0001c830: 7863 5f78 6d61 783d 636f 6e66 6967 312e  xc_xmax=config1.
+0001c840: 7570 7065 725f 6263 6b5f 6469 6164 315b  upper_bck_diad1[
+0001c850: 315d 0a20 2020 2020 2020 2061 7863 5f79  1].        axc_y
+0001c860: 6d69 6e3d 6e70 2e6d 696e 2842 6173 656c  min=np.min(Basel
+0001c870: 696e 655f 6469 6164 315b 3a2c 2031 5d29  ine_diad1[:, 1])
+0001c880: 2d63 6f6e 6669 6731 2e79 5f72 616e 6765  -config1.y_range
+0001c890: 5f62 6173 656c 696e 650a 2020 2020 2020  _baseline.      
+0001c8a0: 2020 6178 635f 796d 6178 3d6e 702e 6d61    axc_ymax=np.ma
+0001c8b0: 7828 4261 7365 6c69 6e65 5f64 6961 6431  x(Baseline_diad1
+0001c8c0: 5b3a 2c20 315d 292b 636f 6e66 6967 312e  [:, 1])+config1.
+0001c8d0: 795f 7261 6e67 655f 6261 7365 6c69 6e65  y_range_baseline
+0001c8e0: 0a0a 0a0a 0a20 2020 2020 2020 2061 7865  .....        axe
+0001c8f0: 735b 2743 275d 2e73 6574 5f74 6974 6c65  s['C'].set_title
+0001c900: 2827 6429 2050 6561 6b73 206f 7665 726c  ('d) Peaks overl
+0001c910: 6169 6e20 6f6e 2064 6174 6120 6265 666f  ain on data befo
+0001c920: 7265 2073 7562 7472 6163 7469 6f6e 2729  re subtraction')
+0001c930: 0a20 2020 2020 2020 2061 7865 735b 2743  .        axes['C
+0001c940: 275d 2e70 6c6f 7428 4469 6164 5f73 686f  '].plot(Diad_sho
+0001c950: 7274 5f64 6961 6431 5b3a 2c20 305d 2c20  rt_diad1[:, 0], 
+0001c960: 4469 6164 5f73 686f 7274 5f64 6961 6431  Diad_short_diad1
+0001c970: 5b3a 2c20 315d 2c20 272e 7227 2c20 6c61  [:, 1], '.r', la
+0001c980: 6265 6c3d 2744 6174 6127 290a 2020 2020  bel='Data').    
+0001c990: 2020 2020 6178 6573 5b27 4327 5d2e 706c      axes['C'].pl
+0001c9a0: 6f74 2842 6173 656c 696e 655f 6469 6164  ot(Baseline_diad
+0001c9b0: 315b 3a2c 2030 5d2c 2042 6173 656c 696e  1[:, 0], Baselin
+0001c9c0: 655f 6469 6164 315b 3a2c 2031 5d2c 2027  e_diad1[:, 1], '
+0001c9d0: 2e62 272c 206c 6162 656c 3d27 6263 6b27  .b', label='bck'
+0001c9e0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+0001c9f0: 4327 5d2e 706c 6f74 2844 6961 645f 7368  C'].plot(Diad_sh
+0001ca00: 6f72 745f 6469 6164 315b 3a2c 2030 5d2c  ort_diad1[:, 0],
+0001ca10: 2050 795f 6261 7365 5f64 6961 6431 2c20   Py_base_diad1, 
+0001ca20: 272d 6b27 2c20 6c61 6265 6c3d 2750 6f6c  '-k', label='Pol
+0001ca30: 7920 6263 6b20 6669 7427 290a 0a0a 2020  y bck fit')...  
+0001ca40: 2020 2020 2020 6178 6573 5b27 4327 5d2e        axes['C'].
+0001ca50: 7365 745f 796c 6162 656c 2827 496e 7465  set_ylabel('Inte
+0001ca60: 6e73 6974 7927 290a 2020 2020 2020 2020  nsity').        
+0001ca70: 6178 6573 5b27 4327 5d2e 7365 745f 786c  axes['C'].set_xl
+0001ca80: 6162 656c 2827 5761 7665 6e75 6d62 6572  abel('Wavenumber
+0001ca90: 2729 0a0a 0a20 2020 2020 2020 2069 6620  ')...        if 
+0001caa0: 636f 6e66 6967 312e 6669 745f 6761 7573  config1.fit_gaus
+0001cab0: 7320 6973 206e 6f74 2046 616c 7365 3a0a  s is not False:.
+0001cac0: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
+0001cad0: 735b 2743 275d 2e70 6c6f 7428 785f 6c69  s['C'].plot(x_li
+0001cae0: 6e2c 2063 6f6d 706f 6e65 6e74 732e 6765  n, components.ge
+0001caf0: 7428 2762 6b67 5f27 292b 7962 6173 655f  t('bkg_')+ybase_
+0001cb00: 786c 696e 2c20 272d 6d27 2c20 6c61 6265  xlin, '-m', labe
+0001cb10: 6c3d 2747 6175 7373 6961 6e20 6263 6b27  l='Gaussian bck'
+0001cb20: 2c20 6c69 6e65 7769 6474 683d 3229 0a0a  , linewidth=2)..
+0001cb30: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
+0001cb40: 5d2e 706c 6f74 2820 785f 6c69 6e20 2c79  ].plot( x_lin ,y
+0001cb50: 5f62 6573 745f 6669 742b 7962 6173 655f  _best_fit+ybase_
+0001cb60: 786c 696e 2c20 272d 6727 2c20 6c69 6e65  xlin, '-g', line
+0001cb70: 7769 6474 683d 322c 206c 6162 656c 3d27  width=2, label='
+0001cb80: 4265 7374 2046 6974 2729 0a20 2020 2020  Best Fit').     
+0001cb90: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
+0001cba0: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
+0001cbb0: 6e74 732e 6765 7428 276c 7a31 5f27 292b  nts.get('lz1_')+
+0001cbc0: 7962 6173 655f 786c 696e 2c20 272d 6227  ybase_xlin, '-b'
+0001cbd0: 2c20 6c61 6265 6c3d 2744 6961 6431 272c  , label='Diad1',
+0001cbe0: 206c 696e 6577 6964 7468 3d31 290a 0a20   linewidth=1).. 
+0001cbf0: 2020 2020 2020 2069 6620 6669 745f 7065         if fit_pe
+0001cc00: 616b 733e 313a 0a20 2020 2020 2020 2020  aks>1:.         
+0001cc10: 2020 2061 7865 735b 2743 275d 2e70 6c6f     axes['C'].plo
+0001cc20: 7428 785f 6c69 6e2c 2063 6f6d 706f 6e65  t(x_lin, compone
+0001cc30: 6e74 732e 6765 7428 276c 7a32 5f27 292b  nts.get('lz2_')+
+0001cc40: 7962 6173 655f 786c 696e 2c20 272d 7227  ybase_xlin, '-r'
+0001cc50: 2c20 6c61 6265 6c3d 2748 4231 272c 206c  , label='HB1', l
+0001cc60: 696e 6577 6964 7468 3d31 290a 0a0a 0a0a  inewidth=1).....
+0001cc70: 2020 2020 2020 2020 6178 6573 5b27 4327          axes['C'
+0001cc80: 5d2e 6c65 6765 6e64 286e 636f 6c3d 332c  ].legend(ncol=3,
+0001cc90: 206c 6f63 3d27 6c6f 7765 7220 6365 6e74   loc='lower cent
+0001cca0: 6572 2729 0a20 2020 2020 2020 2061 7865  er').        axe
+0001ccb0: 735b 2743 275d 2e73 6574 5f78 6c69 6d28  s['C'].set_xlim(
+0001ccc0: 5b61 7863 5f78 6d69 6e2c 2061 7863 5f78  [axc_xmin, axc_x
+0001ccd0: 6d61 785d 290a 2020 2020 2020 2020 6178  max]).        ax
+0001cce0: 6573 5b27 4327 5d2e 7365 745f 796c 696d  es['C'].set_ylim
+0001ccf0: 285b 6178 635f 796d 696e 2c20 6178 635f  ([axc_ymin, axc_
+0001cd00: 796d 6178 5d29 0a20 2020 2020 2020 2023  ymax]).        #
+0001cd10: 6178 6573 5b27 4327 5d2e 706c 6f74 2844  axes['C'].plot(D
+0001cd20: 6961 645f 7368 6f72 745b 3a2c 2030 5d2c  iad_short[:, 0],
+0001cd30: 2044 6961 645f 7368 6f72 745b 3a2c 2031   Diad_short[:, 1
+0001cd40: 5d2c 2027 2272 272c 206c 6162 656c 3d27  ], '"r', label='
+0001cd50: 4461 7461 2729 0a0a 0a20 2020 2020 2020  Data')...       
+0001cd60: 2023 2052 6573 6964 7561 6c20 6f6e 2070   # Residual on p
+0001cd70: 6c6f 7420 440a 2020 2020 2020 2020 6178  lot D.        ax
+0001cd80: 6573 5b27 4427 5d2e 7365 745f 7469 746c  es['D'].set_titl
+0001cd90: 6528 2766 2920 5265 7369 6475 616c 7327  e('f) Residuals'
+0001cda0: 290a 2020 2020 2020 2020 6178 6573 5b27  ).        axes['
+0001cdb0: 4427 5d2e 706c 6f74 285b 6466 5f6f 7574  D'].plot([df_out
+0001cdc0: 5b27 4469 6164 315f 566f 6967 745f 4365  ['Diad1_Voigt_Ce
+0001cdd0: 6e74 275d 2c20 6466 5f6f 7574 5b27 4469  nt'], df_out['Di
+0001cde0: 6164 315f 566f 6967 745f 4365 6e74 275d  ad1_Voigt_Cent']
+0001cdf0: 5d2c 205b 6e70 2e6d 696e 2872 6573 6964  ], [np.min(resid
+0001ce00: 7561 6c5f 6469 6164 5f63 6f6f 7264 7329  ual_diad_coords)
+0001ce10: 2c20 6e70 2e6d 6178 2872 6573 6964 7561  , np.max(residua
+0001ce20: 6c5f 6469 6164 5f63 6f6f 7264 7329 5d2c  l_diad_coords)],
+0001ce30: 2027 3a62 2729 0a20 2020 2020 2020 2069   ':b').        i
+0001ce40: 6620 6669 745f 7065 616b 733e 323a 0a20  f fit_peaks>2:. 
+0001ce50: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
+0001ce60: 2744 275d 2e70 6c6f 7428 5b64 665f 6f75  'D'].plot([df_ou
+0001ce70: 745b 2748 4231 5f43 656e 7427 5d2c 2064  t['HB1_Cent'], d
+0001ce80: 665f 6f75 745b 2748 4231 5f43 656e 7427  f_out['HB1_Cent'
+0001ce90: 5d5d 2c20 5b6e 702e 6d69 6e28 7265 7369  ]], [np.min(resi
+0001cea0: 6475 616c 5f64 6961 645f 636f 6f72 6473  dual_diad_coords
+0001ceb0: 292c 206e 702e 6d61 7828 7265 7369 6475  ), np.max(residu
+0001cec0: 616c 5f64 6961 645f 636f 6f72 6473 295d  al_diad_coords)]
+0001ced0: 2c20 273a 7227 290a 0a20 2020 2020 2020  , ':r')..       
+0001cee0: 2061 7865 735b 2744 275d 2e70 6c6f 7428   axes['D'].plot(
+0001cef0: 7864 6174 5f69 6e72 616e 6765 2c20 7265  xdat_inrange, re
+0001cf00: 7369 6475 616c 5f64 6961 645f 636f 6f72  sidual_diad_coor
+0001cf10: 6473 2c20 276f 6b27 2c20 6d66 633d 2763  ds, 'ok', mfc='c
+0001cf20: 2720 290a 2020 2020 2020 2020 6178 6573  ' ).        axes
+0001cf30: 5b27 4427 5d2e 706c 6f74 2878 6461 745f  ['D'].plot(xdat_
+0001cf40: 696e 7261 6e67 652c 2072 6573 6964 7561  inrange, residua
+0001cf50: 6c5f 6469 6164 5f63 6f6f 7264 732c 2027  l_diad_coords, '
+0001cf60: 2d63 2720 290a 2020 2020 2020 2020 6178  -c' ).        ax
+0001cf70: 6573 5b27 4427 5d2e 7365 745f 796c 6162  es['D'].set_ylab
+0001cf80: 656c 2827 5265 7369 6475 616c 2729 0a20  el('Residual'). 
+0001cf90: 2020 2020 2020 2061 7865 735b 2744 275d         axes['D']
+0001cfa0: 2e73 6574 5f78 6c61 6265 6c28 2757 6176  .set_xlabel('Wav
+0001cfb0: 656e 756d 6265 7227 290a 2020 2020 2020  enumber').      
+0001cfc0: 2020 2320 6178 6573 5b27 4427 5d2e 7365    # axes['D'].se
+0001cfd0: 745f 786c 696d 2861 7831 5f78 6c69 6d29  t_xlim(ax1_xlim)
+0001cfe0: 0a20 2020 2020 2020 2023 2061 7865 735b  .        # axes[
+0001cff0: 2744 275d 2e73 6574 5f78 6c69 6d28 6178  'D'].set_xlim(ax
+0001d000: 325f 786c 696d 290a 2020 2020 2020 2020  2_xlim).        
+0001d010: 4c6f 6361 6c5f 5265 7369 6475 616c 5f64  Local_Residual_d
+0001d020: 6961 6431 3d72 6573 6964 7561 6c5f 6469  iad1=residual_di
+0001d030: 6164 5f63 6f6f 7264 735b 2828 7864 6174  ad_coords[((xdat
+0001d040: 5f69 6e72 616e 6765 3e28 6466 5f6f 7574  _inrange>(df_out
+0001d050: 5b27 4469 6164 315f 566f 6967 745f 4365  ['Diad1_Voigt_Ce
+0001d060: 6e74 275d 5b30 5d2d 636f 6e66 6967 312e  nt'][0]-config1.
+0001d070: 785f 7261 6e67 655f 7265 7369 6475 616c  x_range_residual
+0001d080: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0b0: 2020 2026 2878 6461 745f 696e 7261 6e67     &(xdat_inrang
+0001d0c0: 653c 6466 5f6f 7574 5b27 4469 6164 315f  e<df_out['Diad1_
+0001d0d0: 566f 6967 745f 4365 6e74 275d 5b30 5d2b  Voigt_Cent'][0]+
+0001d0e0: 636f 6e66 6967 312e 785f 7261 6e67 655f  config1.x_range_
+0001d0f0: 7265 7369 6475 616c 2929 5d0a 2020 2020  residual))].    
+0001d100: 2020 2020 6178 6573 5b27 4427 5d2e 7365      axes['D'].se
+0001d110: 745f 786c 696d 285b 6466 5f6f 7574 5b27  t_xlim([df_out['
+0001d120: 4469 6164 315f 566f 6967 745f 4365 6e74  Diad1_Voigt_Cent
+0001d130: 275d 5b30 5d2d 636f 6e66 6967 312e 785f  '][0]-config1.x_
+0001d140: 7261 6e67 655f 7265 7369 6475 616c 2c0a  range_residual,.
+0001d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d160: 2020 2020 6466 5f6f 7574 5b27 4469 6164      df_out['Diad
+0001d170: 315f 566f 6967 745f 4365 6e74 275d 5b30  1_Voigt_Cent'][0
+0001d180: 5d2b 636f 6e66 6967 312e 785f 7261 6e67  ]+config1.x_rang
+0001d190: 655f 7265 7369 6475 616c 5d29 0a20 2020  e_residual]).   
+0001d1a0: 2020 2020 2023 6178 352e 706c 6f74 285b       #ax5.plot([
+0001d1b0: 6365 6e74 5f31 3131 372c 2063 656e 745f  cent_1117, cent_
+0001d1c0: 3131 3137 205d 2c20 5b6e 702e 6d69 6e28  1117 ], [np.min(
+0001d1d0: 4c6f 6361 6c5f 5265 7369 6475 616c 5f31  Local_Residual_1
+0001d1e0: 3131 3729 2d31 302c 206e 702e 6d61 7828  117)-10, np.max(
+0001d1f0: 4c6f 6361 6c5f 5265 7369 6475 616c 5f31  Local_Residual_1
+0001d200: 3131 3729 2b31 305d 2c20 273a 6b27 290a  117)+10], ':k').
+0001d210: 0a0a 0a20 2020 2020 2020 2061 7865 735b  ...        axes[
+0001d220: 2744 275d 2e73 6574 5f79 6c69 6d28 5b6e  'D'].set_ylim([n
+0001d230: 702e 6d69 6e28 4c6f 6361 6c5f 5265 7369  p.min(Local_Resi
+0001d240: 6475 616c 5f64 6961 6431 292d 3130 2c20  dual_diad1)-10, 
+0001d250: 6e70 2e6d 6178 284c 6f63 616c 5f52 6573  np.max(Local_Res
+0001d260: 6964 7561 6c5f 6469 6164 3129 2b31 305d  idual_diad1)+10]
+0001d270: 290a 0a0a 0a0a 0a20 2020 2020 2020 2023  )......        #
+0001d280: 204f 7665 7261 6c20 7370 6563 7472 610a   Overal spectra.
+0001d290: 2020 2020 2020 2020 6178 6573 5b27 4527          axes['E'
+0001d2a0: 5d2e 7365 745f 7469 746c 6528 2767 2920  ].set_title('g) 
+0001d2b0: 5375 6d6d 6172 7920 706c 6f74 206f 6620  Summary plot of 
+0001d2c0: 7261 7720 7370 6563 7472 6120 666f 7220  raw spectra for 
+0001d2d0: 6669 6c65 203d 2027 202b 2066 696c 656e  file = ' + filen
+0001d2e0: 616d 6529 0a20 2020 2020 2020 2061 7865  ame).        axe
+0001d2f0: 735b 2745 275d 2e70 6c6f 7428 5370 6563  s['E'].plot(Spec
+0001d300: 7472 615b 3a2c 2030 5d2c 2053 7065 6374  tra[:, 0], Spect
+0001d310: 7261 5b3a 2c20 315d 2c20 272d 7227 290a  ra[:, 1], '-r').
+0001d320: 2020 2020 2020 2020 6178 6573 5b27 4527          axes['E'
+0001d330: 5d2e 7365 745f 796c 6162 656c 2827 496e  ].set_ylabel('In
+0001d340: 7465 6e73 6974 7927 290a 2020 2020 2020  tensity').      
+0001d350: 2020 6178 6573 5b27 4527 5d2e 7365 745f    axes['E'].set_
+0001d360: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
+0001d370: 6572 2729 0a0a 0a20 2020 2020 2020 2070  er')...        p
+0001d380: 6174 6833 3d70 6174 682b 272f 272b 2764  ath3=path+'/'+'d
+0001d390: 6961 645f 6669 745f 696d 6167 6573 270a  iad_fit_images'.
+0001d3a0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+0001d3b0: 7468 2e65 7869 7374 7328 7061 7468 3329  th.exists(path3)
+0001d3c0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
+0001d3d0: 743d 2770 6174 6820 6578 6973 7473 270a  t='path exists'.
+0001d3e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001d3f0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+0001d400: 6564 6972 7328 7061 7468 2b27 2f27 2b20  edirs(path+'/'+ 
+0001d410: 2764 6961 645f 6669 745f 696d 6167 6573  'diad_fit_images
+0001d420: 272c 2065 7869 7374 5f6f 6b3d 4661 6c73  ', exist_ok=Fals
+0001d430: 6529 0a0a 2020 2020 2020 2020 6669 672e  e)..        fig.
+0001d440: 7469 6768 745f 6c61 796f 7574 2829 0a0a  tight_layout()..
+0001d450: 2020 2020 2020 2020 6669 6c65 3d66 696c          file=fil
+0001d460: 656e 616d 652e 7273 706c 6974 2827 2e74  ename.rsplit('.t
+0001d470: 7874 272c 2031 295b 305d 0a20 2020 2020  xt', 1)[0].     
+0001d480: 2020 2066 6967 2e73 6176 6566 6967 2870     fig.savefig(p
+0001d490: 6174 6833 2b27 2f27 2b27 4469 6164 315f  ath3+'/'+'Diad1_
+0001d4a0: 4669 745f 7b7d 2e70 6e67 272e 666f 726d  Fit_{}.png'.form
+0001d4b0: 6174 2866 696c 6529 2c20 6470 693d 636f  at(file), dpi=co
+0001d4c0: 6e66 6967 312e 6470 6929 0a0a 2020 2020  nfig1.dpi)..    
+0001d4d0: 2020 2020 6966 2063 6c6f 7365 5f66 6967      if close_fig
+0001d4e0: 7572 6520 6973 2054 7275 653a 0a20 2020  ure is True:.   
+0001d4f0: 2020 2020 2020 2020 2070 6c74 2e63 6c6f           plt.clo
+0001d500: 7365 2866 6967 290a 0a20 2020 2069 6620  se(fig)..    if 
+0001d510: 2063 6f6e 6669 6731 2e72 6574 7572 6e5f   config1.return_
+0001d520: 6f74 6865 725f 7061 7261 6d73 2069 7320  other_params is 
+0001d530: 4661 6c73 653a 0a20 2020 2020 2020 2072  False:.        r
+0001d540: 6574 7572 6e20 6466 5f6f 7574 0a20 2020  eturn df_out.   
+0001d550: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
+0001d560: 6574 7572 6e20 6466 5f6f 7574 2c20 7265  eturn df_out, re
+0001d570: 7375 6c74 2c20 795f 6265 7374 5f66 6974  sult, y_best_fit
+0001d580: 2c20 785f 6c69 6e0a 0a0a 6465 6620 636f  , x_lin...def co
+0001d590: 6d62 696e 655f 6469 6164 5f6f 7574 7075  mbine_diad_outpu
+0001d5a0: 7473 282a 2c20 6669 6c65 6e61 6d65 3d4e  ts(*, filename=N
+0001d5b0: 6f6e 652c 2070 7265 6669 783d 5472 7565  one, prefix=True
+0001d5c0: 2c0a 4469 6164 315f 6669 743d 4e6f 6e65  ,.Diad1_fit=None
+0001d5d0: 2c20 4469 6164 325f 6669 743d 4e6f 6e65  , Diad2_fit=None
+0001d5e0: 2c20 746f 5f63 7376 3d46 616c 7365 2c0a  , to_csv=False,.
+0001d5f0: 746f 5f63 6c69 7062 6f61 7264 3d46 616c  to_clipboard=Fal
+0001d600: 7365 2c20 7061 7468 3d4e 6f6e 6529 3a0a  se, path=None):.
+0001d610: 2020 2020 2222 2220 5468 6973 2066 756e      """ This fun
+0001d620: 6374 696f 6e20 636f 6d62 696e 6573 2074  ction combines t
+0001d630: 6865 2064 6174 6166 7261 6d65 7320 6672  he dataframes fr
+0001d640: 6f6d 2066 6974 5f64 6961 645f 325f 775f  om fit_diad_2_w_
+0001d650: 6263 6b20 616e 6420 6669 745f 6469 6164  bck and fit_diad
+0001d660: 5f31 5f77 5f62 636b 2069 6e74 6f20 6120  _1_w_bck into a 
+0001d670: 7369 6e67 6c65 2064 6174 6166 7261 6d65  single dataframe
+0001d680: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+0001d690: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d  .    -----------
+0001d6a0: 2d2d 2d2d 0a0a 2020 2020 6669 6c65 6e61  ----..    filena
+0001d6b0: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
+0001d6c0: 6669 6c65 6e61 6d65 2064 6174 6120 6973  filename data is
+0001d6d0: 2066 6f72 0a0a 2020 2020 7072 6566 6978   for..    prefix
+0001d6e0: 3a20 626f 6f6c 0a20 2020 2020 2020 2069  : bool.        i
+0001d6f0: 6620 5472 7565 2c20 7370 6c69 7473 2066  f True, splits f
+0001d700: 696c 656e 616d 6520 6f6e 2027 2027 2c20  ilename on ' ', 
+0001d710: 6966 2046 616c 7365 2c20 6c65 6176 6573  if False, leaves
+0001d720: 2061 7320 6973 0a0a 2020 2020 4469 6164   as is..    Diad
+0001d730: 315f 6669 743a 2070 642e 4461 7461 4672  1_fit: pd.DataFr
+0001d740: 616d 650a 2020 2020 2020 2020 7064 2e44  ame.        pd.D
+0001d750: 6174 6146 7261 6d65 206f 6620 6669 7420  ataFrame of fit 
+0001d760: 6672 6f6d 2066 6974 5f64 6961 645f 315f  from fit_diad_1_
+0001d770: 775f 6263 6b20 6675 6e63 7469 6f6e 0a0a  w_bck function..
+0001d780: 2020 2020 4469 6164 325f 6669 743a 2070      Diad2_fit: p
+0001d790: 642e 4461 7461 4672 616d 650a 2020 2020  d.DataFrame.    
+0001d7a0: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
+0001d7b0: 206f 6620 6669 7420 6672 6f6d 2066 6974   of fit from fit
+0001d7c0: 5f64 6961 645f 325f 775f 6263 6b20 6675  _diad_2_w_bck fu
+0001d7d0: 6e63 7469 6f6e 0a0a 2020 2020 746f 5f63  nction..    to_c
+0001d7e0: 6c69 7062 6f61 7264 3a20 626f 6f6c 0a20  lipboard: bool. 
+0001d7f0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0001d800: 636f 7069 6573 206d 6572 6765 6420 6461  copies merged da
+0001d810: 7461 6672 616d 6520 746f 2063 6c69 7062  taframe to clipb
+0001d820: 6f61 7264 0a0a 2020 2020 746f 5f63 7376  oard..    to_csv
+0001d830: 3a20 626f 6f6c 0a20 2020 2020 2020 2069  : bool.        i
+0001d840: 6620 5472 7565 2c20 7361 7665 7320 6669  f True, saves fi
+0001d850: 7420 746f 2043 7376 2c20 6279 206d 616b  t to Csv, by mak
+0001d860: 696e 6720 6120 7375 6266 6f6c 6465 7220  ing a subfolder 
+0001d870: 2744 6961 645f 4669 7473 2720 696e 7369  'Diad_Fits' insi
+0001d880: 6465 2074 6865 2066 6f6c 6465 7220 2770  de the folder 'p
+0001d890: 6174 6827 0a0a 0a0a 0a20 2020 2022 2222  ath'.....    """
+0001d8a0: 0a0a 2020 2020 6966 2070 7265 6669 7820  ..    if prefix 
+0001d8b0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+0001d8c0: 2066 696c 656e 616d 653d 6669 6c65 6e61   filename=filena
+0001d8d0: 6d65 2e73 706c 6974 2827 2027 295b 313a  me.split(' ')[1:
+0001d8e0: 5d5b 305d 0a0a 2020 2020 6966 2044 6961  ][0]..    if Dia
+0001d8f0: 6431 5f66 6974 2069 7320 6e6f 7420 4e6f  d1_fit is not No
+0001d900: 6e65 2061 6e64 2044 6961 6432 5f66 6974  ne and Diad2_fit
+0001d910: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 0a20   is not None:.. 
+0001d920: 2020 2020 2020 2063 6f6d 626f 3d70 642e         combo=pd.
+0001d930: 636f 6e63 6174 285b 4469 6164 315f 6669  concat([Diad1_fi
+0001d940: 742c 2044 6961 6432 5f66 6974 5d2c 2061  t, Diad2_fit], a
+0001d950: 7869 733d 3129 0a20 2020 2020 2020 2023  xis=1).        #
+0001d960: 2046 696c 6c20 616e 7920 636f 6c75 6d6e   Fill any column
+0001d970: 7320 7768 6963 6820 646f 6e74 2720 6578  s which dont' ex
+0001d980: 6973 7420 736f 2063 616e 2072 652d 6f72  ist so can re-or
+0001d990: 6465 7220 7468 6520 7361 6d65 2065 7665  der the same eve
+0001d9a0: 7279 2074 696d 650a 2020 2020 2020 2020  ry time.        
+0001d9b0: 6966 2027 4842 315f 4365 6e74 2720 6e6f  if 'HB1_Cent' no
+0001d9c0: 7420 696e 2063 6f6d 626f 2e63 6f6c 756d  t in combo.colum
+0001d9d0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0001d9e0: 636f 6d62 6f5b 2748 4231 5f43 656e 7427  combo['HB1_Cent'
+0001d9f0: 5d3d 6e70 2e6e 616e 0a20 2020 2020 2020  ]=np.nan.       
+0001da00: 2020 2020 2063 6f6d 626f 5b27 4842 315f       combo['HB1_
+0001da10: 4172 6561 275d 3d6e 702e 6e61 6e0a 2020  Area']=np.nan.  
+0001da20: 2020 2020 2020 2020 2020 636f 6d62 6f5b            combo[
+0001da30: 2748 4231 5f53 6967 6d61 275d 3d6e 702e  'HB1_Sigma']=np.
+0001da40: 6e61 6e0a 2020 2020 2020 2020 6966 2027  nan.        if '
+0001da50: 4842 325f 4365 6e74 2720 6e6f 7420 696e  HB2_Cent' not in
+0001da60: 2063 6f6d 626f 2e63 6f6c 756d 6e73 3a0a   combo.columns:.
+0001da70: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+0001da80: 6f5b 2748 4232 5f43 656e 7427 5d3d 6e70  o['HB2_Cent']=np
+0001da90: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
+0001daa0: 2063 6f6d 626f 5b27 4842 325f 4172 6561   combo['HB2_Area
+0001dab0: 275d 3d6e 702e 6e61 6e0a 2020 2020 2020  ']=np.nan.      
+0001dac0: 2020 2020 2020 636f 6d62 6f5b 2748 4232        combo['HB2
+0001dad0: 5f53 6967 6d61 275d 3d6e 702e 6e61 6e0a  _Sigma']=np.nan.
+0001dae0: 2020 2020 2020 2020 6966 2027 4331 335f          if 'C13_
+0001daf0: 4365 6e74 2720 6e6f 7420 696e 2063 6f6d  Cent' not in com
+0001db00: 626f 2e63 6f6c 756d 6e73 3a0a 2020 2020  bo.columns:.    
+0001db10: 2020 2020 2020 2020 636f 6d62 6f5b 2743          combo['C
+0001db20: 3133 5f43 656e 7427 5d3d 6e70 2e6e 616e  13_Cent']=np.nan
+0001db30: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+0001db40: 626f 5b27 4331 335f 4172 6561 275d 3d6e  bo['C13_Area']=n
+0001db50: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+0001db60: 2020 636f 6d62 6f5b 2743 3133 5f53 6967    combo['C13_Sig
+0001db70: 6d61 275d 3d6e 702e 6e61 6e0a 2020 2020  ma']=np.nan.    
+0001db80: 2020 2020 6966 2027 4469 6164 315f 4761      if 'Diad1_Ga
+0001db90: 7573 735f 4365 6e74 2720 6e6f 7420 696e  uss_Cent' not in
+0001dba0: 2063 6f6d 626f 2e63 6f6c 756d 6e73 3a0a   combo.columns:.
+0001dbb0: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+0001dbc0: 6f5b 2744 6961 6431 5f47 6175 7373 5f43  o['Diad1_Gauss_C
+0001dbd0: 656e 7427 5d3d 6e70 2e6e 616e 0a20 2020  ent']=np.nan.   
+0001dbe0: 2020 2020 2020 2020 2063 6f6d 626f 5b27           combo['
+0001dbf0: 4469 6164 315f 4761 7573 735f 4172 6561  Diad1_Gauss_Area
+0001dc00: 275d 3d6e 702e 6e61 6e0a 2020 2020 2020  ']=np.nan.      
+0001dc10: 2020 2020 2020 636f 6d62 6f5b 2744 6961        combo['Dia
+0001dc20: 6431 5f47 6175 7373 5f53 6967 6d61 275d  d1_Gauss_Sigma']
+0001dc30: 3d6e 702e 6e61 6e0a 2020 2020 2020 2020  =np.nan.        
+0001dc40: 6966 2027 4469 6164 325f 4761 7573 735f  if 'Diad2_Gauss_
+0001dc50: 4365 6e74 2720 6e6f 7420 696e 2063 6f6d  Cent' not in com
+0001dc60: 626f 2e63 6f6c 756d 6e73 3a0a 2020 2020  bo.columns:.    
+0001dc70: 2020 2020 2020 2020 636f 6d62 6f5b 2744          combo['D
+0001dc80: 6961 6432 5f47 6175 7373 5f43 656e 7427  iad2_Gauss_Cent'
+0001dc90: 5d3d 6e70 2e6e 616e 0a20 2020 2020 2020  ]=np.nan.       
+0001dca0: 2020 2020 2063 6f6d 626f 5b27 4469 6164       combo['Diad
+0001dcb0: 325f 4761 7573 735f 4172 6561 275d 3d6e  2_Gauss_Area']=n
+0001dcc0: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+0001dcd0: 2020 636f 6d62 6f5b 2744 6961 6432 5f47    combo['Diad2_G
+0001dce0: 6175 7373 5f53 6967 6d61 275d 3d6e 702e  auss_Sigma']=np.
+0001dcf0: 6e61 6e0a 0a20 2020 2020 2020 2063 6f6d  nan..        com
+0001dd00: 626f 5b27 5370 6c69 7474 696e 6727 5d3d  bo['Splitting']=
+0001dd10: 636f 6d62 6f5b 2744 6961 6432 5f56 6f69  combo['Diad2_Voi
+0001dd20: 6774 5f43 656e 7427 5d2d 636f 6d62 6f5b  gt_Cent']-combo[
+0001dd30: 2744 6961 6431 5f56 6f69 6774 5f43 656e  'Diad1_Voigt_Cen
+0001dd40: 7427 5d0a 2020 2020 2020 2020 2363 6f6d  t'].        #com
+0001dd50: 626f 5b27 5370 6c69 745f 6572 725f 6162  bo['Split_err_ab
+0001dd60: 7327 5d3d 636f 6d62 6f5b 2744 6961 6431  s']=combo['Diad1
+0001dd70: 5f63 656e 745f 6572 7227 5d2b 636f 6d62  _cent_err']+comb
+0001dd80: 6f5b 2744 6961 6432 5f63 656e 745f 6572  o['Diad2_cent_er
+0001dd90: 7227 5d0a 2020 2020 2020 2020 636f 6d62  r'].        comb
+0001dda0: 6f5b 2753 706c 6974 5fcf 8327 5d3d 2863  o['Split_..']=(c
+0001ddb0: 6f6d 626f 5b27 4469 6164 315f 6365 6e74  ombo['Diad1_cent
+0001ddc0: 5f65 7272 275d 2a2a 322b 636f 6d62 6f5b  _err']**2+combo[
+0001ddd0: 2744 6961 6432 5f63 656e 745f 6572 7227  'Diad2_cent_err'
+0001dde0: 5d2a 2a32 292a 2a30 2e35 0a20 2020 2020  ]**2)**0.5.     
+0001ddf0: 2020 2063 6f6c 735f 746f 5f6d 6f76 6520     cols_to_move 
+0001de00: 3d20 5b27 5370 6c69 7474 696e 6727 2c20  = ['Splitting', 
+0001de10: 2753 706c 6974 5fcf 8327 2c20 2027 4469  'Split_..',  'Di
+0001de20: 6164 315f 436f 6d62 6f66 6974 5f43 656e  ad1_Combofit_Cen
+0001de30: 7427 2c20 2744 6961 6431 5f63 656e 745f  t', 'Diad1_cent_
+0001de40: 6572 7227 2c20 2744 6961 6431 5f43 6f6d  err', 'Diad1_Com
+0001de50: 626f 6669 745f 4865 6967 6874 272c 2027  bofit_Height', '
+0001de60: 4469 6164 315f 566f 6967 745f 4365 6e74  Diad1_Voigt_Cent
+0001de70: 272c 2027 4469 6164 315f 566f 6967 745f  ', 'Diad1_Voigt_
+0001de80: 4172 6561 272c 2027 4469 6164 315f 566f  Area', 'Diad1_Vo
+0001de90: 6967 745f 5369 676d 6127 2c20 2027 4469  igt_Sigma',  'Di
+0001dea0: 6164 315f 5265 7369 6475 616c 272c 2027  ad1_Residual', '
+0001deb0: 4469 6164 315f 5072 6f70 5f4c 6f72 272c  Diad1_Prop_Lor',
+0001dec0: 2027 4469 6164 315f 6677 686d 272c 2027   'Diad1_fwhm', '
+0001ded0: 4469 6164 315f 7265 6669 7427 2c27 4469  Diad1_refit','Di
+0001dee0: 6164 325f 436f 6d62 6f66 6974 5f43 656e  ad2_Combofit_Cen
+0001def0: 7427 2c20 2744 6961 6432 5f63 656e 745f  t', 'Diad2_cent_
+0001df00: 6572 7227 2c20 2027 4469 6164 325f 436f  err',  'Diad2_Co
+0001df10: 6d62 6f66 6974 5f48 6569 6768 7427 2c20  mbofit_Height', 
+0001df20: 2744 6961 6432 5f56 6f69 6774 5f43 656e  'Diad2_Voigt_Cen
+0001df30: 7427 2c20 2744 6961 6432 5f56 6f69 6774  t', 'Diad2_Voigt
+0001df40: 5f41 7265 6127 2c20 2744 6961 6432 5f56  _Area', 'Diad2_V
+0001df50: 6f69 6774 5f53 6967 6d61 272c 2027 4469  oigt_Sigma', 'Di
+0001df60: 6164 325f 566f 6967 745f 4761 6d6d 6127  ad2_Voigt_Gamma'
+0001df70: 2c20 2744 6961 6432 5f52 6573 6964 7561  , 'Diad2_Residua
+0001df80: 6c27 2c20 2744 6961 6432 5f50 726f 705f  l', 'Diad2_Prop_
+0001df90: 4c6f 7227 2c20 2744 6961 6432 5f66 7768  Lor', 'Diad2_fwh
+0001dfa0: 6d27 2c20 2744 6961 6432 5f72 6566 6974  m', 'Diad2_refit
+0001dfb0: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001dfc0: 2020 2020 2020 2027 4842 315f 4365 6e74         'HB1_Cent
+0001dfd0: 272c 2027 4842 315f 4172 6561 272c 2027  ', 'HB1_Area', '
+0001dfe0: 4842 315f 5369 676d 6127 2c20 2748 4232  HB1_Sigma', 'HB2
+0001dff0: 5f43 656e 7427 2c20 2748 4232 5f41 7265  _Cent', 'HB2_Are
+0001e000: 6127 2c20 2748 4232 5f53 6967 6d61 272c  a', 'HB2_Sigma',
+0001e010: 2027 4331 335f 4365 6e74 272c 2027 4331   'C13_Cent', 'C1
+0001e020: 335f 4172 6561 272c 2027 4331 335f 5369  3_Area', 'C13_Si
+0001e030: 676d 6127 2c0a 2020 2020 2020 2020 2020  gma',.          
+0001e040: 2020 2020 2020 2020 2020 2744 6961 6432            'Diad2
+0001e050: 5f47 6175 7373 5f43 656e 7427 2c20 2744  _Gauss_Cent', 'D
+0001e060: 6961 6432 5f47 6175 7373 5f41 7265 6127  iad2_Gauss_Area'
+0001e070: 2c27 4469 6164 325f 4761 7573 735f 5369  ,'Diad2_Gauss_Si
+0001e080: 676d 6127 2c20 2744 6961 6431 5f47 6175  gma', 'Diad1_Gau
+0001e090: 7373 5f43 656e 7427 2c20 2744 6961 6431  ss_Cent', 'Diad1
+0001e0a0: 5f47 6175 7373 5f41 7265 6127 2c27 4469  _Gauss_Area','Di
+0001e0b0: 6164 315f 4761 7573 735f 5369 676d 6127  ad1_Gauss_Sigma'
+0001e0c0: 2c5d 0a20 2020 2020 2020 2063 6f6d 626f  ,].        combo
+0001e0d0: 5f66 203d 2063 6f6d 626f 5b63 6f6c 735f  _f = combo[cols_
+0001e0e0: 746f 5f6d 6f76 6520 2b20 5b0a 2020 2020  to_move + [.    
+0001e0f0: 2020 2020 2020 2020 2020 2020 636f 6c20              col 
+0001e100: 666f 7220 636f 6c20 696e 2063 6f6d 626f  for col in combo
+0001e110: 2e63 6f6c 756d 6e73 2069 6620 636f 6c20  .columns if col 
+0001e120: 6e6f 7420 696e 2063 6f6c 735f 746f 5f6d  not in cols_to_m
+0001e130: 6f76 655d 5d0a 2020 2020 2020 2020 636f  ove]].        co
+0001e140: 6d62 6f5f 663d 636f 6d62 6f5f 662e 696c  mbo_f=combo_f.il
+0001e150: 6f63 5b3a 2c20 303a 6c65 6e28 636f 6c73  oc[:, 0:len(cols
+0001e160: 5f74 6f5f 6d6f 7665 295d 0a20 2020 2020  _to_move)].     
+0001e170: 2020 2066 696c 653d 6669 6c65 6e61 6d65     file=filename
+0001e180: 2e72 7370 6c69 7428 272e 7478 7427 2c20  .rsplit('.txt', 
+0001e190: 3129 5b30 5d0a 2020 2020 2020 2020 636f  1)[0].        co
+0001e1a0: 6d62 6f5f 662e 696e 7365 7274 2830 2c20  mbo_f.insert(0, 
+0001e1b0: 2766 696c 656e 616d 6527 2c20 6669 6c65  'filename', file
+0001e1c0: 290a 0a20 2020 2069 6620 4469 6164 315f  )..    if Diad1_
+0001e1d0: 6669 7420 6973 204e 6f6e 6520 616e 6420  fit is None and 
+0001e1e0: 4469 6164 325f 6669 7420 6973 204e 6f6e  Diad2_fit is Non
+0001e1f0: 653a 0a20 2020 2020 2020 2064 663d 7064  e:.        df=pd
+0001e200: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
+0001e210: 7b27 6669 6c65 6e61 6d65 273a 2066 696c  {'filename': fil
+0001e220: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
+0001e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e240: 2020 2027 5370 6c69 7474 696e 6727 3a20     'Splitting': 
+0001e250: 6e70 2e6e 616e 2c0a 2020 2020 2020 2020  np.nan,.        
+0001e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e270: 2020 2020 2020 2020 2744 6961 6431 5f56          'Diad1_V
+0001e280: 6f69 6774 5f43 656e 7427 3a6e 702e 6e61  oigt_Cent':np.na
+0001e290: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2b0: 2020 2020 2020 2027 4469 6164 315f 566f         'Diad1_Vo
+0001e2c0: 6967 745f 4172 6561 273a 6e70 2e6e 616e  igt_Area':np.nan
+0001e2d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2f0: 2020 2020 2020 2752 6573 6964 7561 6c5f        'Residual_
+0001e300: 4469 6164 3127 3a20 6e70 2e6e 616e 2c0a  Diad1': np.nan,.
 0001e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e320: 2020 2020 2020 2020 2752 6573 6964 7561          'Residua
-0001e330: 6c5f 4469 6164 3227 3a20 6e70 2e6e 616e  l_Diad2': np.nan
-0001e340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e360: 2020 2020 2020 2020 2020 2020 2020 2748                'H
-0001e370: 4231 5f43 656e 7427 3a6e 702e 6e61 6e2c  B1_Cent':np.nan,
-0001e380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e330: 2020 2020 2020 2020 2744 6961 6432 5f56          'Diad2_V
+0001e340: 6f69 6774 5f43 656e 7427 3a6e 702e 6e61  oigt_Cent':np.na
+0001e350: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e370: 2020 2020 2020 2020 2020 2027 4469 6164             'Diad
+0001e380: 325f 566f 6967 745f 4172 6561 273a 6e70  2_Voigt_Area':np
+0001e390: 2e6e 616e 2c0a 2020 2020 2020 2020 2020  .nan,.          
 0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3b0: 2027 4842 315f 4172 6561 273a 6e70 2e6e   'HB1_Area':np.n
-0001e3c0: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
-0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2752                'R
+0001e3c0: 6573 6964 7561 6c5f 4469 6164 3227 3a20  esidual_Diad2': 
+0001e3d0: 6e70 2e6e 616e 2c0a 2020 2020 2020 2020  np.nan,.        
 0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3f0: 2020 2020 2748 4232 5f43 656e 7427 3a6e      'HB2_Cent':n
-0001e400: 702e 6e61 6e2c 0a20 2020 2020 2020 2020  p.nan,.         
-0001e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e400: 2020 2020 2748 4231 5f43 656e 7427 3a6e      'HB1_Cent':n
+0001e410: 702e 6e61 6e2c 0a20 2020 2020 2020 2020  p.nan,.         
 0001e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e430: 2020 2020 2020 2020 2020 2027 4842 325f             'HB2_
-0001e440: 4172 6561 273a 6e70 2e6e 616e 2c0a 2020  Area':np.nan,.  
-0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 2020 2020 2027 4842 315f 4172 6561         'HB1_Area
+0001e450: 273a 6e70 2e6e 616e 2c0a 2020 2020 2020  ':np.nan,.      
 0001e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e480: 2020 2020 2020 2743 3133 5f43 656e 7427        'C13_Cent'
-0001e490: 3a20 6e70 2e6e 616e 2c0a 2020 2020 2020  : np.nan,.      
+0001e480: 2020 2020 2020 2020 2020 2748 4232 5f43            'HB2_C
+0001e490: 656e 7427 3a6e 702e 6e61 6e2c 0a20 2020  ent':np.nan,.   
 0001e4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4d0: 2020 2743 3133 5f41 7265 6127 3a20 6e70    'C13_Area': np
-0001e4e0: 2e6e 616e 2c0a 2020 2020 2020 2020 2020  .nan,.          
+0001e4d0: 2027 4842 325f 4172 6561 273a 6e70 2e6e   'HB2_Area':np.n
+0001e4e0: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
 0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e510: 2020 2020 2020 2020 2020 2020 2020 7d29                })
-0001e520: 0a20 2020 2020 2020 2063 6f6d 626f 5f66  .        combo_f
-0001e530: 3d70 642e 636f 6e63 6174 285b 6466 2c20  =pd.concat([df, 
-0001e540: 4361 7262 5f66 6974 5d2c 2061 7869 733d  Carb_fit], axis=
-0001e550: 3129 0a20 2020 2020 2020 2069 6620 746f  1).        if to
-0001e560: 5f63 6c69 7062 6f61 7264 2069 7320 5472  _clipboard is Tr
-0001e570: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-0001e580: 6466 2e74 6f5f 636c 6970 626f 6172 6428  df.to_clipboard(
-0001e590: 6578 6365 6c3d 5472 7565 2c20 6865 6164  excel=True, head
-0001e5a0: 6572 3d46 616c 7365 2c20 696e 6465 783d  er=False, index=
-0001e5b0: 4661 6c73 6529 0a20 2020 2020 2020 2063  False).        c
-0001e5c0: 6f6d 626f 5f66 3d64 660a 0a20 2020 2069  ombo_f=df..    i
-0001e5d0: 6620 746f 5f63 7376 2069 7320 5472 7565  f to_csv is True
-0001e5e0: 3a0a 2020 2020 2020 2020 6966 2070 6174  :.        if pat
-0001e5f0: 6820 6973 204e 6f6e 653a 0a20 2020 2020  h is None:.     
-0001e600: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0001e610: 6570 7469 6f6e 2827 596f 7520 6e65 6564  eption('You need
-0001e620: 2074 6f20 7370 6563 6966 7920 7061 7468   to specify path
-0001e630: 3d20 666f 7220 7768 6572 6576 6572 2079  = for wherever y
-0001e640: 6f75 2077 616e 7420 7468 6973 2073 6176  ou want this sav
-0001e650: 6564 2729 0a20 2020 2020 2020 2070 6174  ed').        pat
-0001e660: 685f 6669 7473 3d70 6174 682b 272f 272b  h_fits=path+'/'+
-0001e670: 2744 6961 645f 4669 7473 270a 2020 2020  'Diad_Fits'.    
-0001e680: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0001e690: 7869 7374 7328 7061 7468 5f66 6974 7329  xists(path_fits)
-0001e6a0: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-0001e6b0: 743d 2770 6174 6820 6578 6973 7473 270a  t='path exists'.
-0001e6c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001e6d0: 2020 2020 2020 2020 2020 6469 7232 3d6f            dir2=o
-0001e6e0: 732e 6d61 6b65 6469 7273 2870 6174 682b  s.makedirs(path+
-0001e6f0: 272f 272b 2027 4469 6164 5f46 6974 7327  '/'+ 'Diad_Fits'
-0001e700: 2c20 6578 6973 745f 6f6b 3d46 616c 7365  , exist_ok=False
-0001e710: 290a 2020 2020 2020 2020 2366 696c 6570  ).        #filep
-0001e720: 6174 683d 5061 7468 2870 6174 682b 272f  ath=Path(path+'/
-0001e730: 272b 2027 5065 616b 5f46 6974 7327 2b27  '+ 'Peak_Fits'+'
-0001e740: 2f27 2b66 696c 656e 616d 6529 0a20 2020  /'+filename).   
-0001e750: 2020 2020 2063 6f6d 626f 5f66 2e74 6f5f       combo_f.to_
-0001e760: 6373 7628 7061 7468 2b27 2f27 2b27 4469  csv(path+'/'+'Di
-0001e770: 6164 5f46 6974 7327 2b27 2f27 2b27 6669  ad_Fits'+'/'+'fi
-0001e780: 7473 5f27 2b66 696c 656e 616d 6529 0a20  ts_'+filename). 
-0001e790: 2020 2072 6574 7572 6e20 636f 6d62 6f5f     return combo_
-0001e7a0: 660a 0a0a 0a0a 0a0a 0a0a 0a23 2320 4669  f..........## Fi
-0001e7b0: 7420 6765 6e65 7269 6320 7065 616b 0a0a  t generic peak..
-0001e7c0: 4064 6174 6163 6c61 7373 0a63 6c61 7373  @dataclass.class
-0001e7d0: 2067 656e 6572 6963 5f70 6561 6b5f 636f   generic_peak_co
-0001e7e0: 6e66 6967 3a0a 0a20 2020 2023 204e 616d  nfig:..    # Nam
-0001e7f0: 6520 7468 6174 2067 6574 7320 7374 616d  e that gets stam
-0001e800: 7065 6420 6f6e 746f 2066 6974 730a 2020  ped onto fits.  
-0001e810: 2020 6e61 6d65 3a20 7374 723d 2027 6765    name: str= 'ge
-0001e820: 6e65 7269 6327 0a20 2020 2023 2053 656c  neric'.    # Sel
-0001e830: 6563 7469 6e67 2074 6865 2074 776f 2062  ecting the two b
-0001e840: 6163 6b67 726f 756e 6420 706f 7369 7469  ackground positi
-0001e850: 6f6e 730a 2020 2020 6c6f 7765 725f 6263  ons.    lower_bc
-0001e860: 6b3a 2054 7570 6c65 5b66 6c6f 6174 2c20  k: Tuple[float, 
-0001e870: 666c 6f61 745d 3d28 3130 3630 2c20 3130  float]=(1060, 10
-0001e880: 3635 290a 2020 2020 7570 7065 725f 6263  65).    upper_bc
-0001e890: 6b3a 2054 7570 6c65 5b66 6c6f 6174 2c20  k: Tuple[float, 
-0001e8a0: 666c 6f61 745d 3d28 3131 3230 2c20 3131  float]=(1120, 11
-0001e8b0: 3330 290a 0a20 2020 2023 0a20 2020 206d  30)..    #.    m
-0001e8c0: 6f64 656c 5f6e 616d 653a 2073 7472 3d27  odel_name: str='
-0001e8d0: 5073 6575 646f 566f 6967 744d 6f64 656c  PseudoVoigtModel
-0001e8e0: 270a 2020 2020 785f 7261 6e67 655f 6263  '.    x_range_bc
-0001e8f0: 6b3a 2066 6c6f 6174 3d31 300a 0a20 2020  k: float=10..   
-0001e900: 2023 2042 6163 6b67 726f 756e 6420 6465   # Background de
-0001e910: 6772 6565 206f 6620 706f 6c79 6e6f 6d69  gree of polynomi
-0001e920: 616c 0a20 2020 204e 5f70 6f6c 795f 6361  al.    N_poly_ca
-0001e930: 7262 5f62 636b 3a20 666c 6f61 7420 3d31  rb_bck: float =1
-0001e940: 0a20 2020 2023 2053 656c 6574 6374 696e  .    # Seletctin
-0001e950: 6720 7468 6520 616d 706c 6974 7564 650a  g the amplitude.
-0001e960: 2020 2020 616d 706c 6974 7564 653a 2066      amplitude: f
-0001e970: 6c6f 6174 203d 3130 3030 0a0a 2020 2020  loat =1000..    
-0001e980: 2320 5365 6c65 6374 696e 6720 7468 6520  # Selecting the 
-0001e990: 7065 616b 2063 656e 7465 720a 2020 2020  peak center.    
-0001e9a0: 6365 6e74 3a20 666c 6f61 7420 3d31 3039  cent: float =109
-0001e9b0: 300a 0a20 2020 2023 206f 7574 6c69 6572  0..    # outlier
-0001e9c0: 2073 6967 6d61 2074 6f20 6469 7363 6172   sigma to discar
-0001e9d0: 6420 6261 636b 6772 6f75 6e64 2061 740a  d background at.
-0001e9e0: 2020 2020 6f75 746c 6965 725f 7369 676d      outlier_sigm
-0001e9f0: 613a 2066 6c6f 6174 203d 3132 0a0a 0a0a  a: float =12....
-0001ea00: 2020 2020 2320 5061 7261 6d65 7465 7273      # Parameters
-0001ea10: 2066 6f72 2053 6369 7079 2066 696e 6420   for Scipy find 
-0001ea20: 7065 616b 730a 2020 2020 6469 7374 616e  peaks.    distan
-0001ea30: 6365 3a20 666c 6f61 743d 3130 0a20 2020  ce: float=10.   
-0001ea40: 2070 726f 6d69 6e65 6e63 653a 2066 6c6f   prominence: flo
-0001ea50: 6174 3d35 0a20 2020 2077 6964 7468 3a20  at=5.    width: 
-0001ea60: 666c 6f61 743d 360a 2020 2020 7468 7265  float=6.    thre
-0001ea70: 7368 6f6c 643a 2066 6c6f 6174 3d30 2e31  shold: float=0.1
-0001ea80: 0a20 2020 2068 6569 6768 743a 666c 6f61  .    height:floa
-0001ea90: 7420 3d31 3030 0a0a 2020 2020 2320 4578  t =100..    # Ex
-0001eaa0: 636c 7564 696e 6720 6120 7261 6e67 6520  cluding a range 
-0001eab0: 666f 7220 636f 736d 6963 2072 6179 7320  for cosmic rays 
-0001eac0: 6574 632e 0a20 2020 2065 7863 6c75 6465  etc..    exclude
-0001ead0: 5f72 616e 6765 3a20 4f70 7469 6f6e 616c  _range: Optional
-0001eae0: 205b 5475 706c 655b 666c 6f61 742c 2066   [Tuple[float, f
-0001eaf0: 6c6f 6174 5d5d 3d4e 6f6e 650a 0a0a 2020  loat]]=None...  
-0001eb00: 2020 2320 5265 7475 726e 206f 7468 6572    # Return other
-0001eb10: 2070 6172 616d 6574 6572 6573 2065 2e67   parameteres e.g
-0001eb20: 2e20 696e 7465 726d 6564 6961 7465 206f  . intermediate o
-0001eb30: 7574 7075 7473 0a20 2020 2072 6574 7572  utputs.    retur
-0001eb40: 6e5f 6f74 6865 725f 7061 7261 6d73 3a20  n_other_params: 
-0001eb50: 626f 6f6c 203d 2046 616c 7365 0a0a 2020  bool = False..  
-0001eb60: 2020 4e5f 7065 616b 733a 2069 6e74 3d20    N_peaks: int= 
-0001eb70: 310a 0a0a 0a0a 0a0a 6465 6620 6669 745f  1.......def fit_
-0001eb80: 6765 6e65 7269 635f 7065 616b 282a 2c20  generic_peak(*, 
-0001eb90: 636f 6e66 6967 3a20 6765 6e65 7269 635f  config: generic_
-0001eba0: 7065 616b 5f63 6f6e 6669 673d 6765 6e65  peak_config=gene
-0001ebb0: 7269 635f 7065 616b 5f63 6f6e 6669 6728  ric_peak_config(
-0001ebc0: 292c 0a70 6174 683d 4e6f 6e65 2c20 6669  ),.path=None, fi
-0001ebd0: 6c65 6e61 6d65 3d4e 6f6e 652c 2066 696c  lename=None, fil
-0001ebe0: 6574 7970 653d 4e6f 6e65 2c0a 2070 6c6f  etype=None,. plo
-0001ebf0: 745f 6669 6775 7265 3d54 7275 652c 2064  t_figure=True, d
-0001ec00: 7069 3d32 3030 293a 0a0a 2020 2020 2222  pi=200):..    ""
-0001ec10: 2220 5468 6973 2066 756e 6374 696f 6e20  " This function 
-0001ec20: 6669 7473 2061 2067 656e 6572 6963 2070  fits a generic p
-0001ec30: 6561 6b20 7769 7468 2061 2067 6175 7373  eak with a gauss
-0001ec40: 6961 6e2c 2061 6e64 2072 6574 7572 6e73  ian, and returns
-0001ec50: 2061 2070 6c6f 740a 0a20 2020 2063 6f6e   a plot..    con
-0001ec60: 6669 673a 2066 726f 6d20 6461 7461 636c  fig: from datacl
-0001ec70: 6173 7320 6765 6e65 7269 635f 7065 616b  ass generic_peak
-0001ec80: 5f63 6f6e 6669 670a 0a20 2020 2020 2020  _config..       
-0001ec90: 206d 6f64 656c 5f6e 616d 653a 2073 7472   model_name: str
-0001eca0: 2c20 2747 6175 7373 6961 6e4d 6f64 656c  , 'GaussianModel
-0001ecb0: 272c 2027 566f 6967 744d 6f64 656c 272c  ', 'VoigtModel',
-0001ecc0: 2027 5073 6575 646f 566f 6967 744d 6f64   'PseudoVoigtMod
-0001ecd0: 656c 272c 2027 5370 6c69 6e65 272c 2027  el', 'Spline', '
-0001ece0: 506f 6c79 272c 0a20 2020 2020 2020 2020  Poly',.         
-0001ecf0: 2020 2046 6974 7320 4761 7573 7369 616e     Fits Gaussian
-0001ed00: 2c20 566f 6967 742c 206f 7220 5073 6575  , Voigt, or Pseu
-0001ed10: 646f 566f 6967 742c 206f 7220 6669 7473  doVoigt, or fits
-0001ed20: 2061 2073 706c 696e 6520 6f72 2070 6f6c   a spline or pol
-0001ed30: 796e 6f6d 6169 6c20 616e 6420 6765 7473  ynomail and gets
-0001ed40: 2061 7265 6120 756e 6465 726e 6561 7468   area underneath
-0001ed50: 0a0a 2020 2020 2020 2020 6e61 6d65 3a20  ..        name: 
-0001ed60: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-0001ed70: 4e61 6d65 206f 6620 6665 6174 7572 6520  Name of feature 
-0001ed80: 796f 7520 6172 6520 6669 7474 696e 672e  you are fitting.
-0001ed90: 2055 7365 6420 746f 206d 616b 6520 636f   Used to make co
-0001eda0: 6c75 6d6e 2068 6561 6469 6e67 7320 696e  lumn headings in
-0001edb0: 206f 7574 7075 7420 2865 2e67 2e2c 2069   output (e.g., i
-0001edc0: 6620 534f 322c 206f 7574 7075 7473 2061  f SO2, outputs a
-0001edd0: 7265 2050 6561 6b5f 4365 6e74 5f53 4f32  re Peak_Cent_SO2
-0001ede0: 2c20 5065 616b 5f41 7265 615f 534f 3229  , Peak_Area_SO2)
-0001edf0: 0a0a 2020 2020 2020 2020 6c6f 7765 725f  ..        lower_
-0001ee00: 626b 633a 2054 7570 6c65 5b66 6c6f 6174  bkc: Tuple[float
-0001ee10: 2c20 666c 6f61 745d 0a20 2020 2020 2020  , float].       
-0001ee20: 2020 2020 2055 7070 6572 2061 6e64 206c       Upper and l
-0001ee30: 6f77 6572 2078 2063 6f6f 7264 696e 6174  ower x coordinat
-0001ee40: 6520 666f 7220 6261 636b 6772 6f75 6e64  e for background
-0001ee50: 2074 6f20 6c65 6674 206f 6620 7065 616b   to left of peak
-0001ee60: 0a0a 2020 2020 2020 2020 7570 7065 725f  ..        upper_
-0001ee70: 626b 633a 2054 7570 6c65 5b66 6c6f 6174  bkc: Tuple[float
-0001ee80: 2c20 666c 6f61 745d 0a20 2020 2020 2020  , float].       
-0001ee90: 2020 2020 2055 7070 6572 2061 6e64 206c       Upper and l
-0001eea0: 6f77 6572 2078 2063 6f6f 7264 696e 6174  ower x coordinat
-0001eeb0: 6520 666f 7220 6261 636b 6772 6f75 6e64  e for background
-0001eec0: 2074 6f20 7269 6768 7420 6f66 2070 6561   to right of pea
-0001eed0: 6b0a 0a20 2020 2020 2020 2078 5f72 616e  k..        x_ran
-0001eee0: 6765 5f62 636b 3a20 666c 6f61 740a 2020  ge_bck: float.  
-0001eef0: 2020 2020 2020 2020 2020 7365 7473 2078            sets x
-0001ef00: 6c69 6d20 6f66 2066 6967 7572 652c 2061  lim of figure, a
-0001ef10: 7320 7468 6520 7065 616b 2063 656e 7465  s the peak cente
-0001ef20: 7220 2b20 785f 7261 6e67 655f 6263 6b2c  r + x_range_bck,
-0001ef30: 2061 6e64 2070 6561 6b20 6365 6e74 202d   and peak cent -
-0001ef40: 2078 5f72 616e 6765 5f62 636b 0a0a 2020   x_range_bck..  
-0001ef50: 2020 2020 2020 4e5f 706f 6c79 5f63 6172        N_poly_car
-0001ef60: 625f 6263 6b3a 2069 6e74 0a20 2020 2020  b_bck: int.     
-0001ef70: 2020 2020 2020 2044 6567 7265 6520 6f66         Degree of
-0001ef80: 2070 6f6c 796e 6f6d 6961 6c20 746f 2066   polynomial to f
-0001ef90: 6974 2074 6f20 7468 6520 6261 636b 6772  it to the backgr
-0001efa0: 6f75 6e64 2070 6f73 6974 696f 6e73 0a0a  ound positions..
-0001efb0: 2020 2020 2020 2020 616d 706c 6974 7564          amplitud
-0001efc0: 653a 2066 6c6f 6174 0a20 2020 2020 2020  e: float.       
-0001efd0: 2020 2020 2041 7070 726f 7820 616d 706c       Approx ampl
-0001efe0: 6974 7564 6520 6f66 2070 6561 6b2e 0a0a  itude of peak...
-0001eff0: 2020 2020 2020 2020 6365 6e74 3a20 666c          cent: fl
-0001f000: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-0001f010: 4170 7072 6f78 2063 656e 7420 6f66 2070  Approx cent of p
-0001f020: 6561 6b0a 0a20 2020 2020 2020 206f 7574  eak..        out
-0001f030: 6c69 6572 5f73 6967 6d61 3a20 666c 6f61  lier_sigma: floa
-0001f040: 740a 2020 2020 2020 2020 2020 2020 4469  t.            Di
-0001f050: 7363 6172 6473 2070 6f69 6e74 7320 6f6e  scards points on
-0001f060: 2074 6865 2062 6163 6b67 726f 756e 6420   the background 
-0001f070: 6f75 7473 6964 6520 6f75 746c 6965 725f  outside outlier_
-0001f080: 7369 676d 6120 6f66 2074 6865 206d 6564  sigma of the med
-0001f090: 6961 6e20 7661 6c75 650a 0a20 2020 2020  ian value..     
-0001f0a0: 2020 2064 6973 7461 6e63 652c 2070 726f     distance, pro
-0001f0b0: 6d69 6e65 6e63 652c 2074 6872 6573 686f  minence, thresho
-0001f0c0: 6c64 2c20 6865 6967 6874 3a20 666c 6f61  ld, height: floa
-0001f0d0: 7473 0a20 2020 2020 2020 2020 2020 2070  ts.            p
-0001f0e0: 6172 616d 6574 6572 7320 666f 7220 7363  arameters for sc
-0001f0f0: 6970 7920 6669 6e64 5f70 6561 6b73 0a0a  ipy find_peaks..
-0001f100: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-0001f110: 7261 6e67 653a 204f 7074 696f 6e61 6c20  range: Optional 
-0001f120: 5b54 7570 6c65 5b66 6c6f 6174 2c20 666c  [Tuple[float, fl
-0001f130: 6f61 745d 5d0a 2020 2020 2020 2020 2020  oat]].          
-0001f140: 2020 4578 636c 7564 6573 2072 6567 696f    Excludes regio
-0001f150: 6e20 6f66 2073 7065 6374 7261 2062 6574  n of spectra bet
-0001f160: 7765 656e 2074 6865 7365 2076 616c 7565  ween these value
-0001f170: 730a 0a20 2020 2020 2020 2064 7069 3a20  s..        dpi: 
-0001f180: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-0001f190: 2020 6470 6920 746f 2073 6176 6520 6669    dpi to save fi
-0001f1a0: 6775 7265 2061 740a 0a20 2020 2020 2020  gure at..       
-0001f1b0: 2072 6574 7572 6e5f 6f74 6865 725f 7061   return_other_pa
-0001f1c0: 7261 6d73 3a20 626f 6f6c 0a20 2020 2020  rams: bool.     
-0001f1d0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
-0001f1e0: 7265 7475 726e 7320 6f74 6865 7220 7065  returns other pe
-0001f1f0: 616b 2066 6974 2070 6172 616d 6574 6572  ak fit parameter
-0001f200: 7320 616e 6420 6669 7473 2028 6466 2c20  s and fits (df, 
-0001f210: 7878 5f63 6172 622c 2079 5f63 6172 622c  xx_carb, y_carb,
-0001f220: 2072 6573 756c 7430 292c 0a20 2020 2020   result0),.     
-0001f230: 2020 2020 2020 2065 6c73 6520 6a75 7374         else just
-0001f240: 2072 6574 7572 6e73 2064 6620 6f66 2070   returns df of p
-0001f250: 6561 6b20 706f 7369 7469 6f6e 732c 2068  eak positions, h
-0001f260: 6569 6768 7473 2065 7463 0a0a 0a20 2020  eights etc...   
-0001f270: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
-0001f280: 2020 2050 6174 6820 746f 2066 696c 650a     Path to file.
-0001f290: 0a20 2020 2066 696c 656e 616d 653a 2073  .    filename: s
-0001f2a0: 7472 0a20 2020 2020 2020 2066 696c 656e  tr.        filen
-0001f2b0: 616d 6520 7769 7468 2066 696c 6520 6578  ame with file ex
-0001f2c0: 7465 6e73 696f 6e0a 0a20 2020 2066 696c  tension..    fil
-0001f2d0: 6574 7970 653a 2073 7472 0a20 2020 2020  etype: str.     
-0001f2e0: 2020 2063 686f 6f73 6520 6672 6f6d 2027     choose from '
-0001f2f0: 5769 7465 635f 4153 4349 4927 2c20 2768  Witec_ASCII', 'h
-0001f300: 6561 646c 6573 735f 7478 7427 2c20 2768  eadless_txt', 'h
-0001f310: 6561 646c 6573 735f 6373 7627 2c20 2768  eadless_csv', 'h
-0001f320: 6561 645f 6373 7627 2c20 2757 6974 6563  ead_csv', 'Witec
-0001f330: 5f41 5343 4949 272c 0a20 2020 2020 2020  _ASCII',.       
-0001f340: 2027 484f 5249 4241 5f74 7874 272c 2027   'HORIBA_txt', '
-0001f350: 5265 6e69 7368 6177 5f74 7874 270a 0a0a  Renishaw_txt'...
-0001f360: 2020 2020 706c 6f74 5f66 6967 7572 653a      plot_figure:
-0001f370: 2062 6f6f 6c0a 2020 2020 2020 2020 4966   bool.        If
-0001f380: 2074 7275 652c 2070 6c6f 7473 2066 6967   true, plots fig
-0001f390: 7572 6520 616e 6420 7361 7665 7320 6974  ure and saves it
-0001f3a0: 2069 6e20 6120 7375 6266 6f6c 6465 7220   in a subfolder 
-0001f3b0: 696e 2074 6865 2073 616d 6520 6469 7265  in the same dire
-0001f3c0: 6374 6f72 7920 6173 2074 6865 2066 696c  ctory as the fil
-0001f3d0: 6570 6174 6820 7370 6563 6966 6965 640a  epath specified.
-0001f3e0: 0a20 2020 2064 7069 3a20 696e 740a 2020  .    dpi: int.  
-0001f3f0: 2020 2020 2020 6470 6920 746f 2073 6176        dpi to sav
-0001f400: 6520 6669 6775 7265 2061 740a 0a20 2020  e figure at..   
-0001f410: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-0001f420: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6620  --------.    df 
-0001f430: 6f66 2070 6561 6b20 6669 7473 2c20 756e  of peak fits, un
-0001f440: 6c65 7373 2072 6574 7572 6e5f 6f74 6865  less return_othe
-0001f450: 725f 7061 7261 6d73 2069 7320 5472 7565  r_params is True
-0001f460: 2c20 7468 656e 2061 6c73 6f20 7265 7475  , then also retu
-0001f470: 726e 7320 7820 616e 6420 7920 636f 6f72  rns x and y coor
-0001f480: 6469 6e61 7465 206f 6620 6669 742c 2061  dinate of fit, a
-0001f490: 6e64 2066 6974 2070 6172 616d 730a 0a20  nd fit params.. 
-0001f4a0: 2020 2022 2222 0a0a 0a20 2020 2053 7065     """...    Spe
-0001f4b0: 6374 7261 5f69 6e3d 6765 745f 6461 7461  ctra_in=get_data
-0001f4c0: 2870 6174 683d 7061 7468 2c20 6669 6c65  (path=path, file
-0001f4d0: 6e61 6d65 3d66 696c 656e 616d 652c 2066  name=filename, f
-0001f4e0: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-0001f4f0: 290a 0a20 2020 206e 616d 653d 636f 6e66  )..    name=conf
-0001f500: 6967 2e6e 616d 650a 0a20 2020 2023 2049  ig.name..    # I
-0001f510: 6620 6578 636c 7564 6520 7261 6e67 652c  f exclude range,
-0001f520: 2074 7269 6d20 7468 6174 2068 6572 650a   trim that here.
-0001f530: 2020 2020 6966 2063 6f6e 6669 672e 6578      if config.ex
-0001f540: 636c 7564 655f 7261 6e67 6520 6973 206e  clude_range is n
-0001f550: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0001f560: 2020 2020 2053 7065 6374 7261 3d53 7065       Spectra=Spe
-0001f570: 6374 7261 5f69 6e5b 2028 5370 6563 7472  ctra_in[ (Spectr
-0001f580: 615f 696e 5b3a 2c20 305d 3c63 6f6e 6669  a_in[:, 0]<confi
-0001f590: 672e 6578 636c 7564 655f 7261 6e67 655b  g.exclude_range[
-0001f5a0: 305d 2920 7c20 2853 7065 6374 7261 5f69  0]) | (Spectra_i
-0001f5b0: 6e5b 3a2c 2030 5d3e 636f 6e66 6967 2e65  n[:, 0]>config.e
-0001f5c0: 7863 6c75 6465 5f72 616e 6765 5b31 5d29  xclude_range[1])
-0001f5d0: 205d 0a20 2020 2065 6c73 653a 0a20 2020   ].    else:.   
-0001f5e0: 2020 2020 2053 7065 6374 7261 3d53 7065       Spectra=Spe
-0001f5f0: 6374 7261 5f69 6e0a 0a0a 0a20 2020 206c  ctra_in....    l
-0001f600: 6f77 6572 5f30 6261 7365 6c69 6e65 3d63  ower_0baseline=c
-0001f610: 6f6e 6669 672e 6c6f 7765 725f 6263 6b5b  onfig.lower_bck[
-0001f620: 305d 0a20 2020 2075 7070 6572 5f30 6261  0].    upper_0ba
-0001f630: 7365 6c69 6e65 3d63 6f6e 6669 672e 6c6f  seline=config.lo
-0001f640: 7765 725f 6263 6b5b 315d 0a20 2020 206c  wer_bck[1].    l
-0001f650: 6f77 6572 5f31 6261 7365 6c69 6e65 3d63  ower_1baseline=c
-0001f660: 6f6e 6669 672e 7570 7065 725f 6263 6b5b  onfig.upper_bck[
-0001f670: 305d 0a20 2020 2075 7070 6572 5f31 6261  0].    upper_1ba
-0001f680: 7365 6c69 6e65 3d63 6f6e 6669 672e 7570  seline=config.up
-0001f690: 7065 725f 6263 6b5b 315d 0a0a 2020 2020  per_bck[1]..    
-0001f6a0: 2320 4669 6c74 6572 206f 7574 2073 7065  # Filter out spe
-0001f6b0: 6374 7261 206f 7574 7369 6465 2074 6865  ctra outside the
-0001f6c0: 7365 2062 6173 656c 696e 6573 0a20 2020  se baselines.   
-0001f6d0: 2053 7065 6374 7261 5f73 686f 7274 3d53   Spectra_short=S
-0001f6e0: 7065 6374 7261 5b20 2853 7065 6374 7261  pectra[ (Spectra
-0001f6f0: 5b3a 2c30 5d3e 6c6f 7765 725f 3062 6173  [:,0]>lower_0bas
-0001f700: 656c 696e 6529 2026 2028 5370 6563 7472  eline) & (Spectr
-0001f710: 615b 3a2c 305d 3c75 7070 6572 5f31 6261  a[:,0]<upper_1ba
-0001f720: 7365 6c69 6e65 2920 5d0a 2020 2020 5370  seline) ].    Sp
-0001f730: 6563 7472 615f 6669 743d 5370 6563 7472  ectra_fit=Spectr
-0001f740: 615b 2028 5370 6563 7472 615b 3a2c 305d  a[ (Spectra[:,0]
-0001f750: 3e75 7070 6572 5f30 6261 7365 6c69 6e65  >upper_0baseline
-0001f760: 2920 2620 2853 7065 6374 7261 5b3a 2c30  ) & (Spectra[:,0
-0001f770: 5d3c 6c6f 7765 725f 3162 6173 656c 696e  ]<lower_1baselin
-0001f780: 6529 205d 0a0a 2020 2020 2320 546f 206d  e) ]..    # To m
-0001f790: 616b 6520 6120 6e69 6365 2070 6c6f 742c  ake a nice plot,
-0001f7a0: 2067 6976 6520 3530 2077 6176 656e 756d   give 50 wavenum
-0001f7b0: 6265 7220 756e 6974 7320 6f6e 2065 6974  ber units on eit
-0001f7c0: 6865 7220 7369 6465 2061 7320 6120 6275  her side as a bu
-0001f7d0: 6666 6572 0a20 2020 2053 7065 6374 7261  ffer.    Spectra
-0001f7e0: 5f70 6c6f 743d 5370 6563 7472 615b 2028  _plot=Spectra[ (
-0001f7f0: 5370 6563 7472 615b 3a2c 305d 3e6c 6f77  Spectra[:,0]>low
-0001f800: 6572 5f30 6261 7365 6c69 6e65 2d35 3029  er_0baseline-50)
-0001f810: 2026 2028 5370 6563 7472 615b 3a2c 305d   & (Spectra[:,0]
-0001f820: 3c75 7070 6572 5f31 6261 7365 6c69 6e65  <upper_1baseline
-0001f830: 2b35 3029 205d 0a0a 2020 2020 2320 4669  +50) ]..    # Fi
-0001f840: 6e64 2070 6561 6b73 2075 7369 6e67 2053  nd peaks using S
-0001f850: 6369 7079 2066 696e 6420 7065 616b 730a  cipy find peaks.
-0001f860: 2020 2020 793d 5370 6563 7472 615f 6669      y=Spectra_fi
-0001f870: 745b 3a2c 2031 5d0a 2020 2020 783d 5370  t[:, 1].    x=Sp
-0001f880: 6563 7472 615f 6669 745b 3a2c 2030 5d0a  ectra_fit[:, 0].
-0001f890: 2020 2020 7370 6563 5f72 6573 3d6e 702e      spec_res=np.
-0001f8a0: 6162 7328 785b 305d 2d78 5b31 5d29 0a0a  abs(x[0]-x[1])..
-0001f8b0: 0a20 2020 2070 6561 6b73 203d 2066 696e  .    peaks = fin
-0001f8c0: 645f 7065 616b 7328 792c 6865 6967 6874  d_peaks(y,height
-0001f8d0: 203d 2063 6f6e 6669 672e 6865 6967 6874   = config.height
-0001f8e0: 2c20 7468 7265 7368 6f6c 6420 3d20 636f  , threshold = co
-0001f8f0: 6e66 6967 2e74 6872 6573 686f 6c64 2c0a  nfig.threshold,.
-0001f900: 2020 2020 6469 7374 616e 6365 203d 2063      distance = c
-0001f910: 6f6e 6669 672e 6469 7374 616e 6365 2c20  onfig.distance, 
-0001f920: 7072 6f6d 696e 656e 6365 3d63 6f6e 6669  prominence=confi
-0001f930: 672e 7072 6f6d 696e 656e 6365 2c20 7769  g.prominence, wi
-0001f940: 6474 683d 636f 6e66 6967 2e77 6964 7468  dth=config.width
-0001f950: 290a 0a20 2020 2068 6569 6768 7420 3d20  )..    height = 
-0001f960: 7065 616b 735b 315d 5b27 7065 616b 5f68  peaks[1]['peak_h
-0001f970: 6569 6768 7473 275d 2023 6c69 7374 206f  eights'] #list o
-0001f980: 6620 7468 6520 6865 6967 6874 7320 6f66  f the heights of
-0001f990: 2074 6865 2070 6561 6b73 0a20 2020 2070   the peaks.    p
-0001f9a0: 6561 6b5f 706f 7320 3d20 785b 7065 616b  eak_pos = x[peak
-0001f9b0: 735b 305d 5d20 236c 6973 7420 6f66 2074  s[0]] #list of t
-0001f9c0: 6865 2070 6561 6b73 2070 6f73 6974 696f  he peaks positio
-0001f9d0: 6e73 0a20 2020 2064 665f 736f 7274 3d70  ns.    df_sort=p
-0001f9e0: 642e 4461 7461 4672 616d 6528 6461 7461  d.DataFrame(data
-0001f9f0: 3d7b 2770 6f73 273a 2070 6561 6b5f 706f  ={'pos': peak_po
-0001fa00: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001fa10: 2020 2020 2020 2020 2020 2027 6865 6967             'heig
-0001fa20: 6874 273a 2068 6569 6768 747d 290a 0a20  ht': height}).. 
-0001fa30: 2020 2064 665f 7065 616b 5f73 6f72 743d     df_peak_sort=
-0001fa40: 6466 5f73 6f72 742e 736f 7274 5f76 616c  df_sort.sort_val
-0001fa50: 7565 7328 2768 6569 6768 7427 2c20 6178  ues('height', ax
-0001fa60: 6973 3d30 2c20 6173 6365 6e64 696e 673d  is=0, ascending=
-0001fa70: 4661 6c73 6529 0a0a 2020 2020 2320 5472  False)..    # Tr
-0001fa80: 696d 206e 756d 6265 7220 6f66 2070 6561  im number of pea
-0001fa90: 6b73 2062 6173 6564 206f 6e20 7573 6572  ks based on user
-0001faa0: 2d64 6566 696e 6564 204e 2070 6561 6b73  -defined N peaks
-0001fab0: 0a20 2020 2064 665f 7065 616b 5f73 6f72  .    df_peak_sor
-0001fac0: 745f 7368 6f72 743d 6466 5f70 6561 6b5f  t_short=df_peak_
-0001fad0: 736f 7274 5b30 3a63 6f6e 6669 672e 4e5f  sort[0:config.N_
-0001fae0: 7065 616b 735d 0a0a 0a20 2020 2023 2047  peaks]...    # G
-0001faf0: 6574 2061 6374 7561 6c20 6261 7365 6c69  et actual baseli
-0001fb00: 6e65 0a20 2020 2042 6173 656c 696e 655f  ne.    Baseline_
-0001fb10: 7769 7468 5f6f 7574 6c3d 5370 6563 7472  with_outl=Spectr
-0001fb20: 615f 7368 6f72 745b 0a20 2020 2028 2853  a_short[.    ((S
-0001fb30: 7065 6374 7261 5f73 686f 7274 5b3a 2c20  pectra_short[:, 
-0001fb40: 305d 3c75 7070 6572 5f30 6261 7365 6c69  0]<upper_0baseli
-0001fb50: 6e65 2920 2628 5370 6563 7472 615f 7368  ne) &(Spectra_sh
-0001fb60: 6f72 745b 3a2c 2030 5d3e 6c6f 7765 725f  ort[:, 0]>lower_
-0001fb70: 3062 6173 656c 696e 6529 290a 2020 2020  0baseline)).    
-0001fb80: 2020 2020 7c0a 2020 2020 2828 5370 6563      |.    ((Spec
-0001fb90: 7472 615f 7368 6f72 745b 3a2c 2030 5d3c  tra_short[:, 0]<
-0001fba0: 7570 7065 725f 3162 6173 656c 696e 6529  upper_1baseline)
-0001fbb0: 2026 2853 7065 6374 7261 5f73 686f 7274   &(Spectra_short
-0001fbc0: 5b3a 2c20 305d 3e6c 6f77 6572 5f31 6261  [:, 0]>lower_1ba
-0001fbd0: 7365 6c69 6e65 2929 5d0a 0a20 2020 2023  seline))]..    #
-0001fbe0: 2043 616c 6375 6c61 7465 7320 7468 6520   Calculates the 
-0001fbf0: 4c48 2062 6173 656c 696e 650a 2020 2020  LH baseline.    
-0001fc00: 4c48 5f62 6173 656c 696e 653d 5370 6563  LH_baseline=Spec
-0001fc10: 7472 615f 7368 6f72 745b 0a20 2020 2028  tra_short[.    (
-0001fc20: 2853 7065 6374 7261 5f73 686f 7274 5b3a  (Spectra_short[:
-0001fc30: 2c20 305d 3c75 7070 6572 5f30 6261 7365  , 0]<upper_0base
-0001fc40: 6c69 6e65 2920 2628 5370 6563 7472 615f  line) &(Spectra_
-0001fc50: 7368 6f72 745b 3a2c 2030 5d3e 6c6f 7765  short[:, 0]>lowe
-0001fc60: 725f 3062 6173 656c 696e 6529 295d 0a0a  r_0baseline))]..
-0001fc70: 2020 2020 4d65 616e 5f4c 485f 6261 7365      Mean_LH_base
-0001fc80: 6c69 6e65 3d6e 702e 6e61 6e6d 6561 6e28  line=np.nanmean(
-0001fc90: 4c48 5f62 6173 656c 696e 655b 3a2c 2031  LH_baseline[:, 1
-0001fca0: 5d29 0a20 2020 2053 7464 5f4c 485f 6261  ]).    Std_LH_ba
-0001fcb0: 7365 6c69 6e65 3d6e 702e 6e61 6e73 7464  seline=np.nanstd
-0001fcc0: 284c 485f 6261 7365 6c69 6e65 5b3a 2c20  (LH_baseline[:, 
-0001fcd0: 315d 290a 0a20 2020 2023 2043 616c 6375  1])..    # Calcu
-0001fce0: 6c61 7465 7320 7468 6520 5248 2062 6173  lates the RH bas
-0001fcf0: 656c 696e 650a 2020 2020 5248 5f62 6173  eline.    RH_bas
-0001fd00: 656c 696e 653d 5370 6563 7472 615f 7368  eline=Spectra_sh
-0001fd10: 6f72 745b 2828 5370 6563 7472 615f 7368  ort[((Spectra_sh
-0001fd20: 6f72 745b 3a2c 2030 5d3c 7570 7065 725f  ort[:, 0]<upper_
-0001fd30: 3162 6173 656c 696e 6529 0a20 2020 2026  1baseline).    &
-0001fd40: 2853 7065 6374 7261 5f73 686f 7274 5b3a  (Spectra_short[:
-0001fd50: 2c20 305d 3e6c 6f77 6572 5f31 6261 7365  , 0]>lower_1base
-0001fd60: 6c69 6e65 2929 5d0a 2020 2020 4d65 616e  line))].    Mean
-0001fd70: 5f52 485f 6261 7365 6c69 6e65 3d6e 702e  _RH_baseline=np.
-0001fd80: 6e61 6e6d 6561 6e28 5248 5f62 6173 656c  nanmean(RH_basel
-0001fd90: 696e 655b 3a2c 2031 5d29 0a20 2020 2053  ine[:, 1]).    S
-0001fda0: 7464 5f52 485f 6261 7365 6c69 6e65 3d6e  td_RH_baseline=n
-0001fdb0: 702e 6e61 6e73 7464 2852 485f 6261 7365  p.nanstd(RH_base
-0001fdc0: 6c69 6e65 5b3a 2c20 315d 290a 0a20 2020  line[:, 1])..   
-0001fdd0: 2023 2052 656d 6f76 6573 2070 6f69 6e74   # Removes point
-0001fde0: 7320 6f75 7473 6964 6520 6261 7365 6c69  s outside baseli
-0001fdf0: 6e65 0a0a 2020 2020 4c48 5f62 6173 656c  ne..    LH_basel
-0001fe00: 696e 655f 6669 6c74 3d4c 485f 6261 7365  ine_filt=LH_base
-0001fe10: 6c69 6e65 5b28 4c48 5f62 6173 656c 696e  line[(LH_baselin
-0001fe20: 655b 3a2c 2031 5d3c 4d65 616e 5f4c 485f  e[:, 1]<Mean_LH_
-0001fe30: 6261 7365 6c69 6e65 2b63 6f6e 6669 672e  baseline+config.
-0001fe40: 6f75 746c 6965 725f 7369 676d 612a 5374  outlier_sigma*St
-0001fe50: 645f 4c48 5f62 6173 656c 696e 6529 0a20  d_LH_baseline). 
-0001fe60: 2020 2026 284c 485f 6261 7365 6c69 6e65     &(LH_baseline
-0001fe70: 5b3a 2c20 315d 3e4d 6561 6e5f 4c48 5f62  [:, 1]>Mean_LH_b
-0001fe80: 6173 656c 696e 652d 636f 6e66 6967 2e6f  aseline-config.o
-0001fe90: 7574 6c69 6572 5f73 6967 6d61 2a53 7464  utlier_sigma*Std
-0001fea0: 5f4c 485f 6261 7365 6c69 6e65 2920 5d0a  _LH_baseline) ].
-0001feb0: 0a20 2020 2052 485f 6261 7365 6c69 6e65  .    RH_baseline
-0001fec0: 5f66 696c 743d 5248 5f62 6173 656c 696e  _filt=RH_baselin
-0001fed0: 655b 2852 485f 6261 7365 6c69 6e65 5b3a  e[(RH_baseline[:
-0001fee0: 2c20 315d 3c4d 6561 6e5f 5248 5f62 6173  , 1]<Mean_RH_bas
-0001fef0: 656c 696e 652b 636f 6e66 6967 2e6f 7574  eline+config.out
-0001ff00: 6c69 6572 5f73 6967 6d61 2a53 7464 5f52  lier_sigma*Std_R
-0001ff10: 485f 6261 7365 6c69 6e65 290a 2020 2020  H_baseline).    
-0001ff20: 2628 5248 5f62 6173 656c 696e 655b 3a2c  &(RH_baseline[:,
-0001ff30: 2031 5d3e 4d65 616e 5f52 485f 6261 7365   1]>Mean_RH_base
-0001ff40: 6c69 6e65 2d63 6f6e 6669 672e 6f75 746c  line-config.outl
-0001ff50: 6965 725f 7369 676d 612a 5374 645f 5248  ier_sigma*Std_RH
-0001ff60: 5f62 6173 656c 696e 6529 205d 0a0a 2020  _baseline) ]..  
-0001ff70: 2020 4261 7365 6c69 6e65 3d6e 702e 636f    Baseline=np.co
-0001ff80: 6e63 6174 656e 6174 6528 284c 485f 6261  ncatenate((LH_ba
-0001ff90: 7365 6c69 6e65 5f66 696c 742c 2052 485f  seline_filt, RH_
-0001ffa0: 6261 7365 6c69 6e65 5f66 696c 7429 2c20  baseline_filt), 
-0001ffb0: 6178 6973 3d30 290a 0a0a 0a0a 0a20 2020  axis=0)......   
-0001ffc0: 2023 2046 6974 7320 6120 706f 6c79 6e6f   # Fits a polyno
-0001ffd0: 6d69 616c 2074 6f20 7468 6520 6261 7365  mial to the base
-0001ffe0: 6c69 6e65 206f 6620 6465 6772 6565 0a20  line of degree. 
-0001fff0: 2020 2050 665f 6261 7365 6c69 6e65 203d     Pf_baseline =
-00020000: 206e 702e 706f 6c79 3164 286e 702e 706f   np.poly1d(np.po
-00020010: 6c79 6669 7428 4261 7365 6c69 6e65 5b3a  lyfit(Baseline[:
-00020020: 2c20 305d 2c20 4261 7365 6c69 6e65 5b3a  , 0], Baseline[:
-00020030: 2c20 315d 2c20 636f 6e66 6967 2e4e 5f70  , 1], config.N_p
-00020040: 6f6c 795f 6361 7262 5f62 636b 2929 0a20  oly_carb_bck)). 
-00020050: 2020 2050 795f 6261 7365 203d 5066 5f62     Py_base =Pf_b
-00020060: 6173 656c 696e 6528 5370 6563 7472 615f  aseline(Spectra_
-00020070: 7368 6f72 745b 3a2c 2030 5d29 0a20 2020  short[:, 0]).   
-00020080: 2050 795f 6261 7365 5f66 6974 203d 5066   Py_base_fit =Pf
-00020090: 5f62 6173 656c 696e 6528 5370 6563 7472  _baseline(Spectr
-000200a0: 615f 6669 745b 3a2c 2030 5d29 0a0a 0a0a  a_fit[:, 0])....
-000200b0: 2020 2020 4261 7365 6c69 6e65 5f79 7375      Baseline_ysu
-000200c0: 623d 5066 5f62 6173 656c 696e 6528 4261  b=Pf_baseline(Ba
-000200d0: 7365 6c69 6e65 5b3a 2c20 305d 290a 2020  seline[:, 0]).  
-000200e0: 2020 4261 7365 6c69 6e65 5f78 3d42 6173    Baseline_x=Bas
-000200f0: 656c 696e 655b 3a2c 2030 5d0a 2020 2020  eline[:, 0].    
-00020100: 795f 636f 7272 3d20 5370 6563 7472 615f  y_corr= Spectra_
-00020110: 7368 6f72 745b 3a2c 2031 5d2d 5079 5f62  short[:, 1]-Py_b
-00020120: 6173 650a 2020 2020 795f 636f 7272 5f66  ase.    y_corr_f
-00020130: 6974 3d53 7065 6374 7261 5f66 6974 5b3a  it=Spectra_fit[:
-00020140: 2c20 315d 2d50 795f 6261 7365 5f66 6974  , 1]-Py_base_fit
-00020150: 0a20 2020 2078 5f66 6974 3d53 7065 6374  .    x_fit=Spect
-00020160: 7261 5f66 6974 5b3a 2c20 305d 0a20 2020  ra_fit[:, 0].   
-00020170: 2078 5f63 6f72 723d 5370 6563 7472 615f   x_corr=Spectra_
-00020180: 7368 6f72 745b 3a2c 2030 5d0a 0a0a 0a20  short[:, 0].... 
-00020190: 2020 2069 6620 636f 6e66 6967 2e6d 6f64     if config.mod
-000201a0: 656c 5f6e 616d 6520 6e6f 7420 696e 205b  el_name not in [
-000201b0: 2747 6175 7373 6961 6e4d 6f64 656c 272c  'GaussianModel',
-000201c0: 2027 566f 6967 744d 6f64 656c 272c 2027   'VoigtModel', '
-000201d0: 5073 6575 646f 566f 6967 744d 6f64 656c  PseudoVoigtModel
-000201e0: 272c 2027 5370 6c69 6e65 272c 2027 506f  ', 'Spline', 'Po
-000201f0: 6c79 275d 3a0a 2020 2020 2020 2020 7261  ly']:.        ra
-00020200: 6973 6520 5479 7065 4572 726f 7228 276d  ise TypeError('m
-00020210: 6f64 656c 5f6e 616d 6520 6e6f 7420 6120  odel_name not a 
-00020220: 7065 726d 6974 7465 6420 696e 7075 742c  permitted input,
-00020230: 2050 6c65 6173 6520 7365 6c65 6374 2065   Please select e
-00020240: 6974 6865 7220 4761 7573 7369 616e 4d6f  ither GaussianMo
-00020250: 6465 6c2c 2056 6f69 6774 4d6f 6465 6c2c  del, VoigtModel,
-00020260: 2050 7365 7564 6f56 6f69 6774 4d6f 6465   PseudoVoigtMode
-00020270: 6c2c 206f 7220 5370 6c69 6e65 206f 7220  l, or Spline or 
-00020280: 506f 6c79 2729 0a0a 0a20 2020 2069 6620  Poly')...    if 
-00020290: 636f 6e66 6967 2e6d 6f64 656c 5f6e 616d  config.model_nam
-000202a0: 6520 696e 205b 2747 6175 7373 6961 6e4d  e in ['GaussianM
-000202b0: 6f64 656c 272c 2027 566f 6967 744d 6f64  odel', 'VoigtMod
-000202c0: 656c 272c 2027 5073 6575 646f 566f 6967  el', 'PseudoVoig
-000202d0: 744d 6f64 656c 275d 3a0a 0a0a 2020 2020  tModel']:...    
-000202e0: 2020 2020 2320 4e4f 7720 696e 746f 2074      # NOw into t
-000202f0: 6865 2076 6f69 6774 2066 6974 7469 6e67  he voigt fitting
-00020300: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
-00020310: 6967 2e6d 6f64 656c 5f6e 616d 653d 3d27  ig.model_name=='
-00020320: 566f 6967 744d 6f64 656c 273a 0a20 2020  VoigtModel':.   
-00020330: 2020 2020 2020 2020 206d 6f64 656c 3020           model0 
-00020340: 3d20 566f 6967 744d 6f64 656c 2829 232b  = VoigtModel()#+
-00020350: 2043 6f6e 7374 616e 744d 6f64 656c 2829   ConstantModel()
-00020360: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
-00020370: 6967 2e6d 6f64 656c 5f6e 616d 6520 3d3d  ig.model_name ==
-00020380: 2027 5073 6575 646f 566f 6967 744d 6f64   'PseudoVoigtMod
-00020390: 656c 273a 0a20 2020 2020 2020 2020 2020  el':.           
-000203a0: 206d 6f64 656c 3020 3d20 5073 6575 646f   model0 = Pseudo
-000203b0: 566f 6967 744d 6f64 656c 2829 0a20 2020  VoigtModel().   
-000203c0: 2020 2020 2069 6620 636f 6e66 6967 2e6d       if config.m
-000203d0: 6f64 656c 5f6e 616d 653d 3d27 4761 7573  odel_name=='Gaus
-000203e0: 7369 616e 4d6f 6465 6c27 3a0a 2020 2020  sianModel':.    
-000203f0: 2020 2020 2020 2020 6d6f 6465 6c30 3d47          model0=G
-00020400: 6175 7373 6961 6e4d 6f64 656c 2829 0a0a  aussianModel()..
-00020410: 2020 2020 2020 2020 2320 6372 6561 7465          # create
-00020420: 2070 6172 616d 6574 6572 7320 7769 7468   parameters with
-00020430: 2069 6e69 7469 616c 2076 616c 7565 730a   initial values.
-00020440: 2020 2020 2020 2020 7061 7273 3020 3d20          pars0 = 
-00020450: 6d6f 6465 6c30 2e6d 616b 655f 7061 7261  model0.make_para
-00020460: 6d73 2829 0a20 2020 2020 2020 2070 6172  ms().        par
-00020470: 7330 5b27 6365 6e74 6572 275d 2e73 6574  s0['center'].set
-00020480: 2863 6f6e 6669 672e 6365 6e74 2c20 6d69  (config.cent, mi
-00020490: 6e3d 636f 6e66 6967 2e63 656e 742d 3330  n=config.cent-30
-000204a0: 2c20 6d61 783d 636f 6e66 6967 2e63 656e  , max=config.cen
-000204b0: 742b 3330 290a 2020 2020 2020 2020 7061  t+30).        pa
-000204c0: 7273 305b 2761 6d70 6c69 7475 6465 275d  rs0['amplitude']
-000204d0: 2e73 6574 2863 6f6e 6669 672e 616d 706c  .set(config.ampl
-000204e0: 6974 7564 652c 206d 696e 3d30 290a 0a0a  itude, min=0)...
-000204f0: 2020 2020 2020 2020 696e 6974 3020 3d20          init0 = 
-00020500: 6d6f 6465 6c30 2e65 7661 6c28 7061 7273  model0.eval(pars
-00020510: 302c 2078 3d78 290a 2020 2020 2020 2020  0, x=x).        
-00020520: 7265 7375 6c74 3020 3d20 6d6f 6465 6c30  result0 = model0
-00020530: 2e66 6974 2879 5f63 6f72 725f 6669 742c  .fit(y_corr_fit,
-00020540: 2070 6172 7330 2c20 783d 7829 0a20 2020   pars0, x=x).   
-00020550: 2020 2020 2043 656e 7465 725f 7030 3d72       Center_p0=r
-00020560: 6573 756c 7430 2e62 6573 745f 7661 6c75  esult0.best_valu
-00020570: 6573 2e67 6574 2827 6365 6e74 6572 2729  es.get('center')
-00020580: 0a20 2020 2020 2020 2061 7265 615f 7030  .        area_p0
-00020590: 3d72 6573 756c 7430 2e62 6573 745f 7661  =result0.best_va
-000205a0: 6c75 6573 2e67 6574 2827 616d 706c 6974  lues.get('amplit
-000205b0: 7564 6527 290a 0a0a 0a20 2020 2020 2020  ude')....       
-000205c0: 2023 204d 616b 6520 6120 6e69 6365 206c   # Make a nice l
-000205d0: 696e 7370 6163 6520 666f 7220 706c 6f74  inspace for plot
-000205e0: 7469 6e67 2077 6974 6820 736d 6f6f 7468  ting with smooth
-000205f0: 2063 7572 7665 732e 0a20 2020 2020 2020   curves..       
-00020600: 2078 785f 6361 7262 3d6e 702e 6c69 6e73   xx_carb=np.lins
-00020610: 7061 6365 286d 696e 2878 292c 206d 6178  pace(min(x), max
-00020620: 2878 292c 2032 3030 3029 0a20 2020 2020  (x), 2000).     
-00020630: 2020 2079 5f63 6172 623d 7265 7375 6c74     y_carb=result
-00020640: 302e 6576 616c 2878 3d78 785f 6361 7262  0.eval(x=xx_carb
-00020650: 290a 2020 2020 2020 2020 6865 6967 6874  ).        height
-00020660: 3d6e 702e 6d61 7828 795f 6361 7262 290a  =np.max(y_carb).
-00020670: 0a20 2020 2020 2020 2023 204d 6f76 6564  .        # Moved
-00020680: 2074 6869 7320 666f 726d 2064 6f77 6e20   this form down 
-00020690: 6265 6c6f 772c 2074 6869 6e6b 2069 7420  below, think it 
-000206a0: 6265 6c6f 6e67 7320 6865 7265 0a20 2020  belongs here.   
-000206b0: 2020 2020 2069 6620 6172 6561 5f70 3020       if area_p0 
-000206c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000206d0: 2020 2020 2061 7265 615f 7030 3d6e 702e       area_p0=np.
-000206e0: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-000206f0: 6966 2061 7265 615f 7030 2069 7320 6e6f  if area_p0 is no
-00020700: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00020710: 2020 2020 2020 2020 6966 2061 7265 615f          if area_
-00020720: 7030 3c30 3a0a 2020 2020 2020 2020 2020  p0<0:.          
-00020730: 2020 2020 2020 2020 2020 6172 6561 5f70            area_p
-00020740: 303d 6e70 2e6e 616e 0a0a 0a20 2020 2020  0=np.nan...     
-00020750: 2020 2064 663d 7064 2e44 6174 6146 7261     df=pd.DataFra
-00020760: 6d65 2864 6174 613d 7b27 6669 6c65 6e61  me(data={'filena
-00020770: 6d65 273a 2066 696c 656e 616d 652c 0a20  me': filename,. 
-00020780: 2020 2027 5065 616b 5f43 656e 745f 7b7d     'Peak_Cent_{}
-00020790: 272e 666f 726d 6174 286e 616d 6529 3a20  '.format(name): 
-000207a0: 4365 6e74 6572 5f70 302c 0a20 2020 2027  Center_p0,.    '
-000207b0: 5065 616b 5f41 7265 615f 7b7d 272e 666f  Peak_Area_{}'.fo
-000207c0: 726d 6174 286e 616d 6529 3a20 6172 6561  rmat(name): area
-000207d0: 5f70 302c 0a20 2020 2027 5065 616b 5f48  _p0,.    'Peak_H
-000207e0: 6569 6768 745f 7b7d 272e 666f 726d 6174  eight_{}'.format
-000207f0: 286e 616d 6529 3a20 6865 6967 6874 2c0a  (name): height,.
-00020800: 2020 2020 274d 6f64 656c 5f6e 616d 6527      'Model_name'
-00020810: 3a20 636f 6e66 6967 2e6d 6f64 656c 5f6e  : config.model_n
-00020820: 616d 657d 2c20 696e 6465 783d 5b30 5d29  ame}, index=[0])
-00020830: 0a0a 2020 2020 656c 7365 3a0a 0a20 2020  ..    else:..   
-00020840: 2020 2020 2069 6620 2063 6f6e 6669 672e       if  config.
-00020850: 6d6f 6465 6c5f 6e61 6d65 203d 3d20 2753  model_name == 'S
-00020860: 706c 696e 6527 3a0a 2020 2020 2020 2020  pline':.        
-00020870: 2020 2020 6672 6f6d 2073 6369 7079 2e69      from scipy.i
-00020880: 6e74 6572 706f 6c61 7465 2069 6d70 6f72  nterpolate impor
-00020890: 7420 4375 6269 6353 706c 696e 650a 2020  t CubicSpline.  
-000208a0: 2020 2020 2020 2020 2020 2320 6669 7420            # fit 
-000208b0: 6120 7370 6c69 6e65 2066 6972 7374 2074  a spline first t
-000208c0: 6f20 6669 6e64 2069 6e74 656e 7369 7479  o find intensity
-000208d0: 2063 7574 206f 6666 0a20 2020 2020 2020   cut off.       
-000208e0: 2020 2020 206d 6978 5f73 706c 696e 655f       mix_spline_
-000208f0: 7369 6c20 3d20 696e 7465 7270 3164 2878  sil = interp1d(x
-00020900: 5f66 6974 2c20 795f 636f 7272 5f66 6974  _fit, y_corr_fit
-00020910: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020930: 2020 2020 2020 6b69 6e64 3d27 6375 6269        kind='cubi
-00020940: 6327 290a 2020 2020 2020 2020 2020 2020  c').            
-00020950: 785f 6e65 773d 6e70 2e6c 696e 7370 6163  x_new=np.linspac
-00020960: 6528 6e70 2e6d 696e 2878 5f66 6974 292c  e(np.min(x_fit),
-00020970: 206e 702e 6d61 7828 785f 6669 7429 2c20   np.max(x_fit), 
-00020980: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
-00020990: 2020 4261 7365 6c69 6e65 5f79 7375 625f    Baseline_ysub_
-000209a0: 7369 6c3d 6d69 785f 7370 6c69 6e65 5f73  sil=mix_spline_s
-000209b0: 696c 2878 5f6e 6577 290a 0a20 2020 2020  il(x_new)..     
-000209c0: 2020 2020 2020 2078 5f6d 6178 203d 2078         x_max = x
-000209d0: 5f6e 6577 5b6e 702e 6172 676d 6178 2842  _new[np.argmax(B
-000209e0: 6173 656c 696e 655f 7973 7562 5f73 696c  aseline_ysub_sil
-000209f0: 295d 0a20 2020 2020 2020 2020 2020 2063  )].            c
-00020a00: 656e 743d 785f 6d61 780a 2020 2020 2020  ent=x_max.      
-00020a10: 2020 2020 2020 5065 616b 5f43 656e 7465        Peak_Cente
-00020a20: 723d 785f 6d61 780a 0a20 2020 2020 2020  r=x_max..       
-00020a30: 2020 2020 206d 6178 5f79 3d6e 702e 6d61       max_y=np.ma
-00020a40: 7828 795f 636f 7272 5f66 6974 290a 0a20  x(y_corr_fit).. 
-00020a50: 2020 2020 2020 2020 2020 2023 204c 6574             # Let
-00020a60: 7320 7472 696d 2078 2061 6e64 2079 2062  s trim x and y b
-00020a70: 6173 6564 206f 6e20 696e 7465 6e73 6974  ased on intensit
-00020a80: 7920 7661 6c75 6573 0a20 2020 2020 2020  y values.       
-00020a90: 2023 2046 696e 6420 696e 7465 6e73 6974   # Find intensit
-00020aa0: 7920 6375 7420 6f66 660a 2020 2020 2020  y cut off.      
-00020ab0: 2020 2020 2020 696e 745f 6375 745f 6f66        int_cut_of
-00020ac0: 663d 302e 310a 2020 2020 2020 2020 2020  f=0.1.          
-00020ad0: 2020 795f 696e 745f 6375 743d 6d61 785f    y_int_cut=max_
-00020ae0: 792a 696e 745f 6375 745f 6f66 660a 0a20  y*int_cut_off.. 
-00020af0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00020b00: 636b 2070 6561 6b20 6973 6e74 2061 7420  ck peak isnt at 
-00020b10: 6564 6765 206f 6620 7769 6e64 6f77 2c20  edge of window, 
-00020b20: 656c 7365 2077 6f6e 7420 776f 726b 0a0a  else wont work..
-00020b30: 2020 2020 2020 2020 2020 2020 6966 2050              if P
-00020b40: 6561 6b5f 4365 6e74 6572 3d3d 6e70 2e6d  eak_Center==np.m
-00020b50: 6178 2878 5f66 6974 2920 6f72 2050 6561  ax(x_fit) or Pea
-00020b60: 6b5f 4365 6e74 6572 3d3d 6e70 2e6d 696e  k_Center==np.min
-00020b70: 2878 5f66 6974 293a 0a20 2020 2020 2020  (x_fit):.       
-00020b80: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00020b90: 7065 616b 2061 7420 6564 6765 206f 6620  peak at edge of 
-00020ba0: 7769 6e64 6f77 2c20 7365 7474 696e 6720  window, setting 
-00020bb0: 7061 7261 6d73 2074 6f20 6e61 6e73 2729  params to nans')
-00020bc0: 0a0a 0a0a 2020 2020 2020 2020 2020 2020  ....            
-00020bd0: 2020 2020 6466 3d70 642e 4461 7461 4672      df=pd.DataFr
-00020be0: 616d 6528 6461 7461 3d7b 2766 696c 656e  ame(data={'filen
-00020bf0: 616d 6527 3a20 6669 6c65 6e61 6d65 2c0a  ame': filename,.
-00020c00: 2020 2020 2020 2020 2020 2020 2750 6561              'Pea
-00020c10: 6b5f 4365 6e74 5f7b 7d27 2e66 6f72 6d61  k_Cent_{}'.forma
-00020c20: 7428 6e61 6d65 293a 206e 702e 6e61 6e2c  t(name): np.nan,
-00020c30: 0a20 2020 2020 2020 2020 2020 2027 5065  .            'Pe
-00020c40: 616b 5f41 7265 615f 7b7d 272e 666f 726d  ak_Area_{}'.form
-00020c50: 6174 286e 616d 6529 3a20 6e70 2e6e 616e  at(name): np.nan
-00020c60: 2c0a 2020 2020 2020 2020 2020 2020 2750  ,.            'P
-00020c70: 6561 6b5f 4865 6967 6874 5f7b 7d27 2e66  eak_Height_{}'.f
-00020c80: 6f72 6d61 7428 6e61 6d65 293a 206e 702e  ormat(name): np.
-00020c90: 6e61 6e2c 0a20 2020 2020 2020 2020 2020  nan,.           
-00020ca0: 2027 4d6f 6465 6c5f 6e61 6d65 273a 2063   'Model_name': c
-00020cb0: 6f6e 6669 672e 6d6f 6465 6c5f 6e61 6d65  onfig.model_name
-00020cc0: 7d2c 2069 6e64 6578 3d5b 305d 290a 0a20  }, index=[0]).. 
-00020cd0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00020ce0: 0a0a 0a0a 2020 2020 2020 2020 2020 2020  ....            
-00020cf0: 2320 5370 6c69 7420 7468 6520 6172 7261  # Split the arra
-00020d00: 7920 696e 746f 2061 204c 4853 2061 6e64  y into a LHS and
-00020d10: 2061 2052 4853 0a0a 2020 2020 2020 2020   a RHS..        
-00020d20: 2020 2020 2020 2020 4c48 535f 793d 4261          LHS_y=Ba
-00020d30: 7365 6c69 6e65 5f79 7375 625f 7369 6c5b  seline_ysub_sil[
-00020d40: 785f 6e65 773c 3d50 6561 6b5f 4365 6e74  x_new<=Peak_Cent
-00020d50: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
-00020d60: 2020 2020 5248 535f 793d 4261 7365 6c69      RHS_y=Baseli
-00020d70: 6e65 5f79 7375 625f 7369 6c5b 785f 6e65  ne_ysub_sil[x_ne
-00020d80: 773e 5065 616b 5f43 656e 7465 725d 0a0a  w>Peak_Center]..
-00020d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020da0: 4c48 535f 783d 785f 6e65 775b 785f 6e65  LHS_x=x_new[x_ne
-00020db0: 773c 3d50 6561 6b5f 4365 6e74 6572 5d0a  w<=Peak_Center].
-00020dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020dd0: 5248 535f 783d 785f 6e65 775b 785f 6e65  RHS_x=x_new[x_ne
-00020de0: 773e 5065 616b 5f43 656e 7465 725d 0a0a  w>Peak_Center]..
-00020df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e00: 2320 4e65 6564 2074 6f20 666c 6970 204c  # Need to flip L
-00020e10: 4853 2074 6f20 7075 7420 696e 746f 2074  HS to put into t
-00020e20: 6865 2066 696e 6420 636c 6f73 6573 7420  he find closest 
-00020e30: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00020e40: 2020 2020 2020 2020 204c 4853 5f79 5f66           LHS_y_f
-00020e50: 6c69 703d 6e70 2e66 6c69 7028 4c48 535f  lip=np.flip(LHS_
-00020e60: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-00020e70: 2020 204c 4853 5f78 5f66 6c69 703d 6e70     LHS_x_flip=np
-00020e80: 2e66 6c69 7028 4c48 535f 7829 0a0a 0a20  .flip(LHS_x)... 
-00020e90: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00020ea0: 616c 3d6e 702e 6172 676d 6178 284c 4853  al=np.argmax(LHS
-00020eb0: 5f79 5f66 6c69 703c 795f 696e 745f 6375  _y_flip<y_int_cu
-00020ec0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
-00020ed0: 2020 2020 7661 6c32 3d6e 702e 6172 676d      val2=np.argm
-00020ee0: 6178 2852 4853 5f79 3c79 5f69 6e74 5f63  ax(RHS_y<y_int_c
-00020ef0: 7574 290a 0a20 2020 2020 2020 2020 2020  ut)..           
-00020f00: 2020 2020 2023 2046 696e 6420 6e65 6172       # Find near
-00020f10: 6573 7420 7820 756e 6974 2074 6f20 7468  est x unit to th
-00020f20: 6973 2076 616c 7565 0a20 2020 2020 2020  is value.       
-00020f30: 2020 2020 2020 2020 2079 5f6e 6561 7265           y_neare
-00020f40: 7374 5f4c 4853 3d4c 4853 5f79 5f66 6c69  st_LHS=LHS_y_fli
-00020f50: 705b 7661 6c5d 0a20 2020 2020 2020 2020  p[val].         
-00020f60: 2020 2020 2020 2078 5f6e 6561 7265 7374         x_nearest
-00020f70: 5f4c 4853 3d4c 4853 5f78 5f66 6c69 705b  _LHS=LHS_x_flip[
-00020f80: 7661 6c5d 0a0a 2020 2020 2020 2020 2020  val]..          
-00020f90: 2020 2020 2020 795f 6e65 6172 6573 745f        y_nearest_
-00020fa0: 5248 533d 5248 535f 795b 7661 6c32 5d0a  RHS=RHS_y[val2].
-00020fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fc0: 785f 6e65 6172 6573 745f 5248 533d 5248  x_nearest_RHS=RH
-00020fd0: 535f 785b 7661 6c32 5d0a 0a20 2020 2020  S_x[val2]..     
-00020fe0: 2020 2020 2020 2020 2020 2064 6966 665f             diff_
-00020ff0: 4c48 533d 5065 616b 5f43 656e 7465 722d  LHS=Peak_Center-
-00021000: 785f 6e65 6172 6573 745f 4c48 530a 2020  x_nearest_LHS.  
-00021010: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00021020: 6666 5f52 4853 3d78 5f6e 6561 7265 7374  ff_RHS=x_nearest
-00021030: 5f52 4853 2d50 6561 6b5f 4365 6e74 6572  _RHS-Peak_Center
-00021040: 0a0a 0a0a 2020 2020 2020 2020 2020 2020  ....            
-00021050: 2020 2020 6e5f 7265 733d 330a 2020 2020      n_res=3.    
-00021060: 2020 2020 2020 2020 2020 2020 785f 6e65              x_ne
-00021070: 775f 736b 6577 6e65 7373 3d6e 702e 6c69  w_skewness=np.li
-00021080: 6e73 7061 6365 2878 5f6e 6561 7265 7374  nspace(x_nearest
-00021090: 5f4c 4853 2d73 7065 635f 7265 732a 6e5f  _LHS-spec_res*n_
-000210a0: 7265 732c 2078 5f6e 6561 7265 7374 5f52  res, x_nearest_R
-000210b0: 4853 2b73 7065 635f 7265 732a 6e5f 7265  HS+spec_res*n_re
-000210c0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-000210d0: 2020 2020 785f 6e65 773d 785f 6e65 775f      x_new=x_new_
-000210e0: 736b 6577 6e65 7373 0a0a 0a20 2020 2020  skewness...     
-000210f0: 2020 2020 2020 2020 2020 2042 6173 656c             Basel
-00021100: 696e 655f 7973 7562 5f73 696c 3d6d 6978  ine_ysub_sil=mix
-00021110: 5f73 706c 696e 655f 7369 6c28 785f 6e65  _spline_sil(x_ne
-00021120: 775f 736b 6577 6e65 7373 290a 0a0a 0a0a  w_skewness).....
-00021130: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00021140: 2020 4e5f 706f 6c79 5f73 696c 3d27 5370    N_poly_sil='Sp
-00021150: 6c69 6e65 270a 0a0a 2020 2020 2020 2020  line'...        
-00021160: 2020 2020 2020 2020 7873 7061 6365 5f73          xspace_s
-00021170: 696c 3d78 5f6e 6577 5b31 5d2d 785f 6e65  il=x_new[1]-x_ne
-00021180: 775b 305d 0a20 2020 2020 2020 2020 2020  w[0].           
-00021190: 2020 2020 2061 7265 615f 7472 6170 203d       area_trap =
-000211a0: 2074 7261 707a 2842 6173 656c 696e 655f   trapz(Baseline_
-000211b0: 7973 7562 5f73 696c 2c20 6478 3d78 7370  ysub_sil, dx=xsp
-000211c0: 6163 655f 7369 6c29 0a20 2020 2020 2020  ace_sil).       
-000211d0: 2020 2020 2020 2020 2061 7265 615f 7369           area_si
-000211e0: 6d70 7320 3d20 7369 6d70 7328 4261 7365  mps = simps(Base
-000211f0: 6c69 6e65 5f79 7375 625f 7369 6c2c 2064  line_ysub_sil, d
-00021200: 783d 7873 7061 6365 5f73 696c 290a 0a0a  x=xspace_sil)...
-00021210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021220: 2061 7265 615f 7030 3d61 7265 615f 7472   area_p0=area_tr
-00021230: 6170 0a0a 0a0a 0a20 2020 2020 2020 2020  ap.....         
-00021240: 2020 2020 2020 2064 663d 7064 2e44 6174         df=pd.Dat
-00021250: 6146 7261 6d65 2864 6174 613d 7b27 6669  aFrame(data={'fi
-00021260: 6c65 6e61 6d65 273a 2066 696c 656e 616d  lename': filenam
-00021270: 652c 0a20 2020 2020 2020 2020 2020 2027  e,.            '
-00021280: 5065 616b 5f43 656e 745f 7b7d 272e 666f  Peak_Cent_{}'.fo
-00021290: 726d 6174 286e 616d 6529 3a20 785f 6d61  rmat(name): x_ma
-000212a0: 782c 0a20 2020 2020 2020 2020 2020 2027  x,.            '
-000212b0: 5065 616b 5f41 7265 615f 7b7d 272e 666f  Peak_Area_{}'.fo
-000212c0: 726d 6174 286e 616d 6529 3a20 6172 6561  rmat(name): area
-000212d0: 5f70 302c 0a20 2020 2020 2020 2020 2020  _p0,.           
-000212e0: 2027 5065 616b 5f48 6569 6768 745f 7b7d   'Peak_Height_{}
-000212f0: 272e 666f 726d 6174 286e 616d 6529 3a20  '.format(name): 
-00021300: 6d61 785f 792c 0a20 2020 2020 2020 2020  max_y,.         
-00021310: 2020 2027 4d6f 6465 6c5f 6e61 6d65 273a     'Model_name':
-00021320: 2063 6f6e 6669 672e 6d6f 6465 6c5f 6e61   config.model_na
-00021330: 6d65 7d2c 2069 6e64 6578 3d5b 305d 290a  me}, index=[0]).
-00021340: 0a0a 0a0a 0a0a 2020 2020 2320 506c 6f74  ......    # Plot
-00021350: 7469 6e67 2077 6861 7420 6974 7320 646f  ting what its do
-00021360: 696e 670a 0a20 2020 2069 6620 706c 6f74  ing..    if plot
-00021370: 5f66 6967 7572 6520 6973 2054 7275 653a  _figure is True:
-00021380: 0a20 2020 2020 2020 2066 6967 2c20 2861  .        fig, (a
-00021390: 7831 2c20 6178 3229 203d 2070 6c74 2e73  x1, ax2) = plt.s
-000213a0: 7562 706c 6f74 7328 312c 2032 2c20 6669  ubplots(1, 2, fi
-000213b0: 6773 697a 653d 2831 302c 3529 290a 2020  gsize=(10,5)).  
-000213c0: 2020 2020 2020 6669 672e 7375 7074 6974        fig.suptit
-000213d0: 6c65 2827 5365 636f 6e64 6172 7920 5068  le('Secondary Ph
-000213e0: 6173 652c 2066 696c 653d 2027 2b20 7374  ase, file= '+ st
-000213f0: 7228 6669 6c65 6e61 6d65 292c 2066 6f6e  r(filename), fon
-00021400: 7473 697a 653d 3132 2c20 783d 302e 352c  tsize=12, x=0.5,
-00021410: 2079 3d31 2e30 290a 0a20 2020 2020 2020   y=1.0)..       
-00021420: 2023 2050 6c6f 7420 7468 6520 7065 616b   # Plot the peak
-00021430: 2070 6f73 6974 696f 6e73 2061 6e64 2068   positions and h
-00021440: 6569 6768 7473 0a0a 0a0a 2020 2020 2020  eights....      
-00021450: 2020 6178 312e 7365 745f 7469 746c 6528    ax1.set_title(
-00021460: 2742 6163 6b67 726f 756e 6420 6669 7427  'Background fit'
-00021470: 290a 0a20 2020 2020 2020 2061 7831 2e70  )..        ax1.p
-00021480: 6c6f 7428 5370 6563 7472 615f 706c 6f74  lot(Spectra_plot
-00021490: 5b3a 2c20 305d 2c20 5370 6563 7472 615f  [:, 0], Spectra_
-000214a0: 706c 6f74 5b3a 2c20 315d 2c20 272d 7227  plot[:, 1], '-r'
-000214b0: 2c20 6c61 6265 6c3d 2753 7065 6374 7261  , label='Spectra
-000214c0: 2729 0a20 2020 2020 2020 2061 7831 2e70  ').        ax1.p
-000214d0: 6c6f 7428 5248 5f62 6173 656c 696e 655f  lot(RH_baseline_
-000214e0: 6669 6c74 5b3a 2c20 305d 2c20 5248 5f62  filt[:, 0], RH_b
-000214f0: 6173 656c 696e 655f 6669 6c74 5b3a 2c20  aseline_filt[:, 
-00021500: 315d 2c20 272e 6227 2c0a 2020 2020 2020  1], '.b',.      
-00021510: 2020 6c61 6265 6c3d 2762 636b 2070 6f69    label='bck poi
-00021520: 6e74 7327 290a 2020 2020 2020 2020 6178  nts').        ax
-00021530: 312e 706c 6f74 284c 485f 6261 7365 6c69  1.plot(LH_baseli
-00021540: 6e65 5f66 696c 745b 3a2c 2030 5d2c 204c  ne_filt[:, 0], L
-00021550: 485f 6261 7365 6c69 6e65 5f66 696c 745b  H_baseline_filt[
-00021560: 3a2c 2031 5d2c 2027 2d62 272c 0a20 2020  :, 1], '-b',.   
-00021570: 2020 2020 206c 773d 332c 206c 6162 656c       lw=3, label
-00021580: 3d27 5f62 636b 2070 6f69 6e74 7327 290a  ='_bck points').
-00021590: 0a20 2020 2020 2020 2023 6178 322e 706c  .        #ax2.pl
-000215a0: 6f74 2878 2c20 795f 636f 7272 5f66 6974  ot(x, y_corr_fit
-000215b0: 2c20 272d 7227 2c20 6c61 6265 6c3d 2742  , '-r', label='B
-000215c0: 636b 2d73 7562 2064 6174 6127 2c20 6c77  ck-sub data', lw
-000215d0: 3d30 2e35 290a 2020 2020 2020 2020 6178  =0.5).        ax
-000215e0: 322e 706c 6f74 2878 2c20 795f 636f 7272  2.plot(x, y_corr
-000215f0: 5f66 6974 2c20 272e 7227 2c20 6c61 6265  _fit, '.r', labe
-00021600: 6c3d 2742 636b 2d73 7562 2064 6174 6127  l='Bck-sub data'
-00021610: 290a 2020 2020 2020 2020 6178 312e 706c  ).        ax1.pl
-00021620: 6f74 2853 7065 6374 7261 5f73 686f 7274  ot(Spectra_short
-00021630: 5b3a 2c20 305d 2c20 5079 5f62 6173 652c  [:, 0], Py_base,
-00021640: 2027 2d6b 272c 206c 6162 656c 3d27 4263   '-k', label='Bc
-00021650: 6b20 506f 6c79 2729 0a0a 0a20 2020 2020  k Poly')...     
-00021660: 2020 2069 6620 636f 6e66 6967 2e6d 6f64     if config.mod
-00021670: 656c 5f6e 616d 6520 213d 2027 5370 6c69  el_name != 'Spli
-00021680: 6e65 2720 616e 6420 636f 6e66 6967 2e6d  ne' and config.m
-00021690: 6f64 656c 5f6e 616d 6520 213d 2027 506f  odel_name != 'Po
-000216a0: 6c79 273a 0a20 2020 2020 2020 2020 2020  ly':.           
-000216b0: 2061 7832 2e70 6c6f 7428 7878 5f63 6172   ax2.plot(xx_car
-000216c0: 622c 2079 5f63 6172 622c 2027 2d6b 272c  b, y_carb, '-k',
-000216d0: 206c 6162 656c 3d27 5065 616b 2066 6974   label='Peak fit
-000216e0: 2729 0a20 2020 2020 2020 2020 2020 2063  ').            c
-000216f0: 656e 743d 6466 5b27 5065 616b 5f43 656e  ent=df['Peak_Cen
-00021700: 745f 7b7d 272e 666f 726d 6174 286e 616d  t_{}'.format(nam
-00021710: 6529 5d2e 696c 6f63 5b30 5d0a 2020 2020  e)].iloc[0].    
-00021720: 2020 2020 2020 2020 6178 322e 7365 745f          ax2.set_
-00021730: 786c 696d 285b 6365 6e74 2d63 6f6e 6669  xlim([cent-confi
-00021740: 672e 785f 7261 6e67 655f 6263 6b2c 2063  g.x_range_bck, c
-00021750: 656e 742b 636f 6e66 6967 2e78 5f72 616e  ent+config.x_ran
-00021760: 6765 5f62 636b 5d29 0a20 2020 2020 2020  ge_bck]).       
-00021770: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00021780: 2020 2061 7832 2e70 6c6f 7428 785f 6e65     ax2.plot(x_ne
-00021790: 772c 2042 6173 656c 696e 655f 7973 7562  w, Baseline_ysub
-000217a0: 5f73 696c 2c20 272d 6b27 290a 2020 2020  _sil, '-k').    
-000217b0: 2020 2020 2020 2020 6178 322e 6669 6c6c          ax2.fill
-000217c0: 5f62 6574 7765 656e 2878 5f6e 6577 2c20  _between(x_new, 
-000217d0: 4261 7365 6c69 6e65 5f79 7375 625f 7369  Baseline_ysub_si
-000217e0: 6c2c 2063 6f6c 6f72 3d27 7965 6c6c 6f77  l, color='yellow
-000217f0: 272c 206c 6162 656c 3d27 6669 7427 2c20  ', label='fit', 
-00021800: 616c 7068 613d 302e 3529 0a0a 0a20 2020  alpha=0.5)...   
-00021810: 2020 2020 2061 7832 2e73 6574 5f74 6974       ax2.set_tit
-00021820: 6c65 2827 426b 672d 7375 6274 7261 6374  le('Bkg-subtract
-00021830: 6564 2c20 2720 2b20 6e61 6d65 202b 2027  ed, ' + name + '
-00021840: 2070 6561 6b20 6669 7427 290a 0a0a 0a0a   peak fit').....
-00021850: 0a0a 0a0a 2020 2020 2320 6178 322e 7365  ....    # ax2.se
-00021860: 745f 796c 696d 285b 6d69 6e28 795f 6361  t_ylim([min(y_ca
-00021870: 7262 292d 302e 352a 286d 6178 2879 5f63  rb)-0.5*(max(y_c
-00021880: 6172 6229 2d6d 696e 2879 5f63 6172 6229  arb)-min(y_carb)
-00021890: 292c 0a20 2020 2023 2020 2020 2020 2020  ),.    #        
-000218a0: 2020 2020 206d 6178 2879 5f63 6172 6229       max(y_carb)
-000218b0: 2b30 2e31 2a6d 6178 2879 5f63 6172 6229  +0.1*max(y_carb)
-000218c0: 2c0a 2020 2020 2320 5d29 0a0a 0a0a 2020  ,.    # ])....  
-000218d0: 2020 2020 2020 6966 2066 696e 645f 7065        if find_pe
-000218e0: 616b 7320 6973 2054 7275 653a 0a0a 2020  aks is True:..  
-000218f0: 2020 2020 2020 2020 2020 6178 312e 706c            ax1.pl
-00021900: 6f74 2864 665f 7065 616b 5f73 6f72 745f  ot(df_peak_sort_
-00021910: 7368 6f72 745b 2770 6f73 275d 2c20 6466  short['pos'], df
-00021920: 5f70 6561 6b5f 736f 7274 5f73 686f 7274  _peak_sort_short
-00021930: 5b27 6865 6967 6874 275d 2c20 272a 6b27  ['height'], '*k'
-00021940: 2c20 6d66 633d 2779 656c 6c6f 7727 2c20  , mfc='yellow', 
-00021950: 6c61 6265 6c3d 2753 6369 5079 2050 6561  label='SciPy Pea
-00021960: 6b73 2729 0a20 2020 2020 2020 2020 2020  ks').           
-00021970: 2061 7831 2e70 6c6f 7428 5370 6563 7472   ax1.plot(Spectr
-00021980: 615f 7368 6f72 745b 3a2c 2030 5d2c 2050  a_short[:, 0], P
-00021990: 795f 6261 7365 2c20 272d 6b27 290a 0a20  y_base, '-k').. 
-000219a0: 2020 2020 2020 2061 7831 2e73 6574 5f79         ax1.set_y
-000219b0: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-000219c0: 2729 0a20 2020 2020 2020 2061 7831 2e73  ').        ax1.s
-000219d0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
-000219e0: 756d 6265 7220 2863 6d24 5e7b 2d31 7d24  umber (cm$^{-1}$
-000219f0: 2927 290a 2020 2020 2020 2020 6178 322e  )').        ax2.
-00021a00: 7365 745f 796c 6162 656c 2827 4263 6b2d  set_ylabel('Bck-
-00021a10: 636f 7272 6563 7465 6420 496e 7465 6e73  corrected Intens
-00021a20: 6974 7927 290a 2020 2020 2020 2020 6178  ity').        ax
-00021a30: 322e 7365 745f 786c 6162 656c 2827 5761  2.set_xlabel('Wa
-00021a40: 7665 6e75 6d62 6572 2028 636d 245e 7b2d  venumber (cm$^{-
-00021a50: 317d 2429 2729 0a0a 2020 2020 2020 2020  1}$)')..        
-00021a60: 6178 312e 6c65 6765 6e64 2829 0a20 2020  ax1.legend().   
-00021a70: 2020 2020 2061 7832 2e6c 6567 656e 6428       ax2.legend(
-00021a80: 290a 0a20 2020 2020 2020 2061 7831 2e73  )..        ax1.s
-00021a90: 6574 5f79 6c69 6d28 5b0a 2020 2020 2020  et_ylim([.      
-00021aa0: 2020 6e70 2e6d 696e 2853 7065 6374 7261    np.min(Spectra
-00021ab0: 5f70 6c6f 745b 3a2c 2031 5d29 2d35 302c  _plot[:, 1])-50,
-00021ac0: 0a20 2020 2020 2020 206e 702e 6d61 7828  .        np.max(
-00021ad0: 5370 6563 7472 615f 706c 6f74 5b3a 2c20  Spectra_plot[:, 
-00021ae0: 315d 292b 3530 0a20 2020 2020 2020 205d  1])+50.        ]
-00021af0: 290a 0a0a 0a0a 0a0a 2020 2020 2020 2020  ).......        
-00021b00: 6669 6c65 3d66 696c 656e 616d 652e 7273  file=filename.rs
-00021b10: 706c 6974 2827 2e74 7874 272c 2031 295b  plit('.txt', 1)[
-00021b20: 305d 0a20 2020 2020 2020 2069 6620 706c  0].        if pl
-00021b30: 6f74 5f66 6967 7572 6520 6973 2054 7275  ot_figure is Tru
-00021b40: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00021b50: 6174 6833 3d70 6174 682b 272f 272b 2753  ath3=path+'/'+'S
-00021b60: 6563 6f6e 6461 7279 5f66 6974 5f49 6d61  econdary_fit_Ima
-00021b70: 6765 7327 0a0a 2020 2020 2020 2020 2020  ges'..          
-00021b80: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00021b90: 7374 7328 7061 7468 3329 3a0a 2020 2020  sts(path3):.    
-00021ba0: 2020 2020 2020 2020 2020 2020 6f75 743d              out=
-00021bb0: 2770 6174 6820 6578 6973 7473 270a 2020  'path exists'.  
-00021bc0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00021bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021be0: 6f73 2e6d 616b 6564 6972 7328 7061 7468  os.makedirs(path
-00021bf0: 332c 2065 7869 7374 5f6f 6b3d 4661 6c73  3, exist_ok=Fals
-00021c00: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00021c10: 6669 6c65 3d66 696c 656e 616d 652e 7273  file=filename.rs
-00021c20: 706c 6974 2827 2e74 7874 272c 2031 295b  plit('.txt', 1)[
-00021c30: 305d 0a20 2020 2020 2020 2020 2020 2066  0].            f
-00021c40: 6967 2e73 6176 6566 6967 2870 6174 6833  ig.savefig(path3
-00021c50: 2b27 2f27 2b20 6e61 6d65 202b 275f 4669  +'/'+ name +'_Fi
-00021c60: 745f 7b7d 2e70 6e67 272e 666f 726d 6174  t_{}.png'.format
-00021c70: 2866 696c 6529 2c20 6470 693d 6470 6929  (file), dpi=dpi)
-00021c80: 0a0a 0a0a 2020 2020 6966 2063 6f6e 6669  ....    if confi
-00021c90: 672e 7265 7475 726e 5f6f 7468 6572 5f70  g.return_other_p
-00021ca0: 6172 616d 7320 6973 2054 7275 653a 0a20  arams is True:. 
-00021cb0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-00021cc0: 2c20 7878 5f63 6172 622c 2079 5f63 6172  , xx_carb, y_car
-00021cd0: 622c 2072 6573 756c 7430 0a20 2020 2065  b, result0.    e
-00021ce0: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-00021cf0: 7572 6e20 6466 0a0a 0a0a 0a23 2050 6c6f  urn df.....# Plo
-00021d00: 7474 696e 6720 7570 2073 6563 6f6e 6461  tting up seconda
-00021d10: 7279 2070 6561 6b73 0a0a 6672 6f6d 2073  ry peaks..from s
-00021d20: 6369 7079 2e73 6967 6e61 6c20 696d 706f  cipy.signal impo
-00021d30: 7274 2066 696e 645f 7065 616b 730a 6465  rt find_peaks.de
-00021d40: 6620 706c 6f74 5f73 6563 6f6e 6461 7279  f plot_secondary
-00021d50: 5f70 6561 6b73 282a 2c20 4469 6164 5f46  _peaks(*, Diad_F
-00021d60: 696c 6573 2c20 7061 7468 2c20 6669 6c65  iles, path, file
-00021d70: 7479 7065 2c0a 2020 2020 2020 2020 786c  type,.        xl
-00021d80: 696d 5f70 6c6f 743d 5b31 3034 302c 2031  im_plot=[1040, 1
-00021d90: 3230 305d 2c20 786c 696d 5f70 6561 6b73  200], xlim_peaks
-00021da0: 3d5b 3130 3630 2c20 3131 3030 5d2c 0a20  =[1060, 1100],. 
-00021db0: 2020 2020 2020 2068 6569 6768 743d 3130         height=10
-00021dc0: 302c 2074 6872 6573 686f 6c64 3d30 2e31  0, threshold=0.1
-00021dd0: 2c20 6469 7374 616e 6365 3d31 302c 2070  , distance=10, p
-00021de0: 726f 6d69 6e65 6e63 653d 352c 2077 6964  rominence=5, wid
-00021df0: 7468 3d36 2c0a 2020 2020 2020 2020 2073  th=6,.         s
-00021e00: 6967 6d61 5f66 696c 7465 723d 4661 6c73  igma_filter=Fals
-00021e10: 652c 2073 6967 6d61 3d33 2c20 6669 6e64  e, sigma=3, find
-00021e20: 5f70 6561 6b73 5f66 696c 7465 723d 4661  _peaks_filter=Fa
-00021e30: 6c73 652c 206a 7573 745f 706c 6f74 3d46  lse, just_plot=F
-00021e40: 616c 7365 2c20 7973 6361 6c65 3d30 2e32  alse, yscale=0.2
-00021e50: 293a 0a0a 2020 2020 2222 2220 5468 6973  ):..    """ This
-00021e60: 2066 756e 6374 696f 6e20 706c 6f74 7320   function plots 
-00021e70: 7370 6563 7472 6120 7374 6163 6b65 6420  spectra stacked 
-00021e80: 7665 7274 6963 616c 6c79 206f 6e74 6f70  vertically ontop
-00021e90: 206f 6620 6561 6368 206f 7468 6572 2c20   of each other, 
-00021ea0: 696e 2061 2073 7065 6369 6669 6320 7265  in a specific re
-00021eb0: 6769 6f6e 2e0a 2020 2020 4974 2061 6c73  gion..    It als
-00021ec0: 6f20 6964 656e 7469 6669 6573 2070 6561  o identifies pea
-00021ed0: 6b20 706f 7369 7469 6f6e 730a 0a20 2020  k positions..   
-00021ee0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00021ef0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00021f00: 2020 2020 4469 6164 5f46 696c 6573 3a20      Diad_Files: 
-00021f10: 6c69 7374 0a20 2020 2020 2020 204c 6973  list.        Lis
-00021f20: 7420 6f66 2066 696c 656e 616d 6573 2074  t of filenames t
-00021f30: 6f20 706c 6f74 0a0a 2020 2020 7061 7468  o plot..    path
-00021f40: 3a20 7374 720a 2020 2020 2020 2020 5061  : str.        Pa
-00021f50: 7468 2077 6865 7265 2073 7065 6374 7261  th where spectra
-00021f60: 2061 7265 2073 746f 7265 640a 0a20 2020   are stored..   
-00021f70: 2066 696c 6574 7970 653a 2073 7472 0a20   filetype: str. 
-00021f80: 2020 2020 2020 2043 686f 6f73 6520 6672         Choose fr
-00021f90: 6f6d 2027 5769 7465 635f 4153 4349 4927  om 'Witec_ASCII'
-00021fa0: 2c20 2768 6561 646c 6573 735f 7478 7427  , 'headless_txt'
-00021fb0: 2c20 2768 6561 646c 6573 735f 6373 7627  , 'headless_csv'
-00021fc0: 2c20 2768 6561 645f 6373 7627 2c20 2757  , 'head_csv', 'W
-00021fd0: 6974 6563 5f41 5343 4949 272c 0a20 2020  itec_ASCII',.   
-00021fe0: 2020 2020 2027 484f 5249 4241 5f74 7874       'HORIBA_txt
-00021ff0: 272c 2027 5265 6e69 7368 6177 5f74 7874  ', 'Renishaw_txt
-00022000: 270a 0a20 2020 2078 6c69 6d5f 706c 6f74  '..    xlim_plot
-00022010: 3a20 5475 706c 655b 666c 6f61 742c 2066  : Tuple[float, f
-00022020: 6c6f 6174 5d0a 2020 2020 2020 2020 5261  loat].        Ra
-00022030: 6e67 6520 6f66 2078 2063 6f6f 7264 696e  nge of x coordin
-00022040: 6174 6573 2074 6f20 6d61 6b65 2070 6c6f  ates to make plo
-00022050: 7420 6f76 6572 0a0a 2020 2020 786c 696d  t over..    xlim
-00022060: 5f70 6561 6b73 3a20 5475 706c 655b 666c  _peaks: Tuple[fl
-00022070: 6f61 742c 2066 6c6f 6174 5d0a 2020 2020  oat, float].    
-00022080: 2020 2020 5261 6e67 6520 6f66 2078 2063      Range of x c
-00022090: 6f6f 7264 696e 6174 6573 2074 6f20 7365  oordinates to se
-000220a0: 6172 6368 2066 6f72 2070 6561 6b73 206f  arch for peaks o
-000220b0: 7665 720a 0a20 2020 2043 686f 6f73 6520  ver..    Choose 
-000220c0: 6f6e 6520 746f 2062 6520 5472 7565 2066  one to be True f
-000220d0: 726f 6d3a 0a0a 2020 2020 7369 676d 615f  rom:..    sigma_
-000220e0: 6669 6c74 6572 3a20 626f 6f6c 0a20 2020  filter: bool.   
-000220f0: 2020 2020 2069 6620 5472 7565 2c20 6669       if True, fi
-00022100: 6e64 7320 6d61 7820 7920 636f 6f72 6469  nds max y coordi
-00022110: 6e61 7465 2069 6e20 7370 6563 7472 612e  nate in spectra.
-00022120: 2049 6620 6974 7320 6d6f 7265 2074 6861   If its more tha
-00022130: 6e20 7369 676d 612a 7374 616e 6461 7264  n sigma*standard
-00022140: 2064 6576 6961 7469 6f6e 7320 6162 6f76   deviations abov
-00022150: 6520 7468 650a 2020 2020 2020 2020 6d65  e the.        me
-00022160: 6469 616e 2c20 6974 2069 7320 636c 6173  dian, it is clas
-00022170: 7369 6669 6564 2061 7320 6120 7065 616b  sified as a peak
-00022180: 2e0a 0a20 2020 2066 696e 645f 7065 616b  ...    find_peak
-00022190: 735f 6669 6c74 6572 3a20 626f 6f6c 0a0a  s_filter: bool..
-000221a0: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
-000221b0: 2075 7365 7320 7363 6970 7920 6669 6e64   uses scipy find
-000221c0: 2070 6561 6b73 2074 6f20 6669 6e64 2070   peaks to find p
-000221d0: 6561 6b73 2e20 4361 6e20 7477 6561 6b20  eaks. Can tweak 
-000221e0: 6469 7374 616e 6365 2c20 7072 6f6d 696e  distance, promin
-000221f0: 656e 6365 2c20 7769 6474 682c 0a20 2020  ence, width,.   
-00022200: 2020 2020 2074 6872 6573 686f 6c64 2c20       threshold, 
-00022210: 616e 6420 6865 6967 6874 2e0a 0a20 2020  and height...   
-00022220: 206a 7573 745f 706c 6f74 3a20 626f 6f6c   just_plot: bool
-00022230: 0a20 2020 2020 2020 2069 6620 5472 7565  .        if True
-00022240: 2c20 6a75 7374 2070 6c6f 7473 2073 7065  , just plots spe
-00022250: 6374 7261 2c20 646f 6573 6e74 2074 7279  ctra, doesnt try
-00022260: 2074 6f20 6669 6e64 2070 6561 6b73 0a0a   to find peaks..
-00022270: 2020 2020 795f 7363 616c 653a 2066 6c6f      y_scale: flo
-00022280: 6174 0a20 2020 2020 2020 2046 6967 7572  at.        Figur
-00022290: 6520 7369 7a65 2069 7320 322b 795f 7363  e size is 2+y_sc
-000222a0: 616c 6520 2a20 6e75 6d62 6572 206f 6620  ale * number of 
-000222b0: 7370 6563 7472 610a 0a20 2020 2052 6574  spectra..    Ret
-000222c0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-000222d0: 2d2d 2d2d 2d2d 0a20 2020 2064 665f 7065  ------.    df_pe
-000222e0: 616b 732c 2078 5f64 6174 612c 2079 5f64  aks, x_data, y_d
-000222f0: 6174 612c 2066 6967 0a0a 2020 2020 6466  ata, fig..    df
-00022300: 5f70 6561 6b73 3a20 7064 2e44 6174 6146  _peaks: pd.DataF
-00022310: 7261 6d65 2066 6f72 2065 6163 6820 6669  rame for each fi
-00022320: 6c65 206f 6620 7065 616b 2070 6f73 6974  le of peak posit
-00022330: 696f 6e2c 2068 6569 6768 742c 2070 726f  ion, height, pro
-00022340: 6d69 6e65 6e63 6520 616e 6420 6669 6c65  minence and file
-00022350: 206e 616d 652e 2046 696c 6c65 6420 7769   name. Filled wi
-00022360: 7468 204e 616e 7320 6966 2064 6964 6e74  th Nans if didnt
-00022370: 2066 696e 6420 6120 7065 616b 0a20 2020   find a peak.   
-00022380: 2078 5f64 6174 613a 206e 702e 6172 7261   x_data: np.arra
-00022390: 7920 6f66 2078 2063 6f6f 7264 696e 6174  y of x coordinat
-000223a0: 6573 2028 4173 7375 6d65 7320 7468 6520  es (Assumes the 
-000223b0: 7361 6d65 2066 6f72 2061 6c6c 2066 696c  same for all fil
-000223c0: 6573 290a 2020 2020 795f 6461 7461 3a20  es).    y_data: 
-000223d0: 6e70 2e61 7272 6179 206f 6620 7920 636f  np.array of y co
-000223e0: 6f72 6469 6e61 7465 7320 6f66 2065 6163  ordinates of eac
-000223f0: 6820 7370 6563 7472 610a 2020 2020 6669  h spectra.    fi
-00022400: 673a 2066 6967 7572 6520 6974 2068 6173  g: figure it has
-00022410: 2070 6c6f 7474 6564 0a0a 0a20 2020 2022   plotted...    "
-00022420: 2222 0a20 2020 2069 6620 7369 676d 615f  "".    if sigma_
-00022430: 6669 6c74 6572 2069 7320 5472 7565 2061  filter is True a
-00022440: 6e64 2028 6669 6e64 5f70 6561 6b73 5f66  nd (find_peaks_f
-00022450: 696c 7465 7220 6973 2054 7275 6520 6f72  ilter is True or
-00022460: 206a 7573 745f 706c 6f74 2069 7320 5472   just_plot is Tr
-00022470: 7565 293a 0a20 2020 2020 2020 2072 6169  ue):.        rai
-00022480: 7365 2054 7970 6545 7272 6f72 2827 4f6e  se TypeError('On
-00022490: 6c79 206f 6e65 206f 6620 7369 676d 615f  ly one of sigma_
-000224a0: 6669 6c74 6572 2c20 696e 645f 7065 616b  filter, ind_peak
-000224b0: 735f 6669 6c74 6572 2061 6e64 206a 7573  s_filter and jus
-000224c0: 745f 706c 6f74 2063 616e 2062 6520 5472  t_plot can be Tr
-000224d0: 7565 2729 0a20 2020 2066 6967 2c20 2861  ue').    fig, (a
-000224e0: 7831 2920 3d20 706c 742e 7375 6270 6c6f  x1) = plt.subplo
-000224f0: 7473 2831 2c20 312c 2066 6967 7369 7a65  ts(1, 1, figsize
-00022500: 3d28 3130 2c32 2b79 7363 616c 652a 6c65  =(10,2+yscale*le
-00022510: 6e28 4469 6164 5f46 696c 6573 2929 290a  n(Diad_Files))).
-00022520: 0a20 2020 2069 3d30 0a20 2020 2059 3d30  .    i=0.    Y=0
-00022530: 0a20 2020 2070 6561 6b5f 706f 735f 7361  .    peak_pos_sa
-00022540: 7665 643d 6e70 2e65 6d70 7479 286c 656e  ved=np.empty(len
-00022550: 2844 6961 645f 4669 6c65 7329 2c20 6474  (Diad_Files), dt
-00022560: 7970 653d 666c 6f61 7429 0a0a 2020 2020  ype=float)..    
-00022570: 7065 616b 5f68 6569 6768 745f 7361 7665  peak_height_save
-00022580: 643d 6e70 2e65 6d70 7479 286c 656e 2844  d=np.empty(len(D
-00022590: 6961 645f 4669 6c65 7329 2c20 6474 7970  iad_Files), dtyp
-000225a0: 653d 666c 6f61 7429 0a20 2020 2070 6561  e=float).    pea
-000225b0: 6b5f 6263 6b3d 6e70 2e65 6d70 7479 286c  k_bck=np.empty(l
-000225c0: 656e 2844 6961 645f 4669 6c65 7329 2c20  en(Diad_Files), 
-000225d0: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
-000225e0: 2079 5f73 7461 723d 6e70 2e65 6d70 7479   y_star=np.empty
-000225f0: 286c 656e 2844 6961 645f 4669 6c65 7329  (len(Diad_Files)
-00022600: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-00022610: 2020 2079 706c 6f74 3d6e 702e 656d 7074     yplot=np.empt
-00022620: 7928 6c65 6e28 4469 6164 5f46 696c 6573  y(len(Diad_Files
-00022630: 292c 2064 7479 7065 3d66 6c6f 6174 290a  ), dtype=float).
-00022640: 2020 2020 4469 6164 5f64 663d 6765 745f      Diad_df=get_
-00022650: 6461 7461 2870 6174 683d 7061 7468 2c20  data(path=path, 
-00022660: 6669 6c65 6e61 6d65 3d44 6961 645f 4669  filename=Diad_Fi
-00022670: 6c65 735b 305d 2c20 6669 6c65 7479 7065  les[0], filetype
-00022680: 3d66 696c 6574 7970 6529 0a20 2020 2078  =filetype).    x
-00022690: 5f64 6174 613d 4469 6164 5f64 665b 3a2c  _data=Diad_df[:,
-000226a0: 2030 5d0a 2020 2020 795f 6461 7461 3d6e   0].    y_data=n
-000226b0: 702e 656d 7074 7928 5b20 206c 656e 2878  p.empty([  len(x
-000226c0: 5f64 6174 6129 2c20 6c65 6e28 4469 6164  _data), len(Diad
-000226d0: 5f46 696c 6573 295d 2c20 666c 6f61 7429  _Files)], float)
-000226e0: 0a0a 0a20 2020 2066 6f72 2066 696c 6520  ...    for file 
-000226f0: 696e 2044 6961 645f 4669 6c65 733a 0a0a  in Diad_Files:..
-00022700: 0a0a 0a20 2020 2020 2020 2044 6961 645f  ...        Diad_
-00022710: 6466 3d67 6574 5f64 6174 6128 7061 7468  df=get_data(path
-00022720: 3d70 6174 682c 2066 696c 656e 616d 653d  =path, filename=
-00022730: 6669 6c65 2c20 6669 6c65 7479 7065 3d66  file, filetype=f
-00022740: 696c 6574 7970 6529 0a20 2020 2020 2020  iletype).       
-00022750: 2044 6961 643d 6e70 2e61 7272 6179 2844   Diad=np.array(D
-00022760: 6961 645f 6466 290a 0a0a 2020 2020 2020  iad_df)...      
-00022770: 2020 2320 4669 7273 7420 6c65 7473 2075    # First lets u
-00022780: 7365 2066 696e 6420 7065 616b 730a 2020  se find peaks.  
-00022790: 2020 2020 2020 793d 4469 6164 5b3a 2c20        y=Diad[:, 
-000227a0: 315d 0a20 2020 2020 2020 2078 3d44 6961  1].        x=Dia
-000227b0: 645b 3a2c 2030 5d0a 0a0a 2020 2020 2020  d[:, 0]...      
-000227c0: 2020 2320 5265 6769 6f6e 206f 6620 696e    # Region of in
-000227d0: 7465 7265 7374 0a20 2020 2020 2020 2052  terest.        R
-000227e0: 6567 696f 6e5f 7065 616b 7320 3d20 2828  egion_peaks = ((
-000227f0: 783e 786c 696d 5f70 6561 6b73 5b30 5d29  x>xlim_peaks[0])
-00022800: 2620 2878 3c78 6c69 6d5f 7065 616b 735b  & (x<xlim_peaks[
-00022810: 315d 2929 0a20 2020 2020 2020 2052 6567  1])).        Reg
-00022820: 696f 6e5f 706c 6f74 3d28 2878 3e78 6c69  ion_plot=((x>xli
-00022830: 6d5f 706c 6f74 5b30 5d29 2620 2878 3c78  m_plot[0])& (x<x
-00022840: 6c69 6d5f 706c 6f74 5b31 5d29 290a 2020  lim_plot[1])).  
-00022850: 2020 2020 2020 785f 7472 696d 3d78 5b52        x_trim=x[R
-00022860: 6567 696f 6e5f 7065 616b 735d 0a20 2020  egion_peaks].   
-00022870: 2020 2020 2079 5f74 7269 6d3d 795b 5265       y_trim=y[Re
-00022880: 6769 6f6e 5f70 6561 6b73 5d0a 2020 2020  gion_peaks].    
-00022890: 2020 2020 785f 706c 6f74 3d78 5b52 6567      x_plot=x[Reg
-000228a0: 696f 6e5f 706c 6f74 5d0a 2020 2020 2020  ion_plot].      
-000228b0: 2020 795f 706c 6f74 3d79 5b52 6567 696f    y_plot=y[Regio
-000228c0: 6e5f 706c 6f74 5d0a 2020 2020 2020 2020  n_plot].        
-000228d0: 795f 6461 7461 5b3a 2c20 695d 3d79 0a0a  y_data[:, i]=y..
-000228e0: 0a0a 2020 2020 2020 2020 2320 4946 2075  ..        # IF u
-000228f0: 7369 6e67 2073 6369 7079 2066 696e 6420  sing scipy find 
-00022900: 7065 616b 730a 2020 2020 2020 2020 6966  peaks.        if
-00022910: 2066 696e 645f 7065 616b 735f 6669 6c74   find_peaks_filt
-00022920: 6572 2069 7320 5472 7565 3a0a 2020 2020  er is True:.    
-00022930: 2020 2020 2020 2020 2320 4669 6e64 2070          # Find p
-00022940: 6561 6b73 2066 6f72 2074 7269 6d6d 6564  eaks for trimmed
-00022950: 2073 7065 6374 7261 2028 652e 672e 2069   spectra (e.g. i
-00022960: 6e20 7265 6769 6f6e 2070 6561 6b73 2068  n region peaks h
-00022970: 6176 6520 6265 656e 2061 736b 6564 2066  ave been asked f
-00022980: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
-00022990: 7065 616b 7320 3d20 6669 6e64 5f70 6561  peaks = find_pea
-000229a0: 6b73 2879 5f74 7269 6d2c 6865 6967 6874  ks(y_trim,height
-000229b0: 203d 2068 6569 6768 742c 2074 6872 6573   = height, thres
-000229c0: 686f 6c64 203d 2074 6872 6573 686f 6c64  hold = threshold
-000229d0: 2c0a 2020 2020 2020 2020 2020 2020 6469  ,.            di
-000229e0: 7374 616e 6365 203d 2064 6973 7461 6e63  stance = distanc
-000229f0: 652c 2070 726f 6d69 6e65 6e63 653d 7072  e, prominence=pr
-00022a00: 6f6d 696e 656e 6365 2c20 7769 6474 683d  ominence, width=
-00022a10: 7769 6474 6829 0a0a 0a20 2020 2020 2020  width)...       
-00022a20: 2020 2020 2068 6569 6768 745f 5045 414b       height_PEAK
-00022a30: 203d 2070 6561 6b73 5b31 5d5b 2770 6561   = peaks[1]['pea
-00022a40: 6b5f 6865 6967 6874 7327 5d20 236c 6973  k_heights'] #lis
-00022a50: 7420 6f66 2074 6865 2068 6569 6768 7473  t of the heights
-00022a60: 206f 6620 7468 6520 7065 616b 730a 2020   of the peaks.  
-00022a70: 2020 2020 2020 2020 2020 7065 616b 5f70            peak_p
-00022a80: 6f73 203d 2078 5f74 7269 6d5b 7065 616b  os = x_trim[peak
-00022a90: 735b 305d 5d20 236c 6973 7420 6f66 2074  s[0]] #list of t
-00022aa0: 6865 2070 6561 6b73 2070 6f73 6974 696f  he peaks positio
-00022ab0: 6e73 0a0a 2020 2020 2020 2020 2020 2020  ns..            
-00022ac0: 6466 5f73 6f72 743d 7064 2e44 6174 6146  df_sort=pd.DataF
-00022ad0: 7261 6d65 2864 6174 613d 7b27 706f 7327  rame(data={'pos'
-00022ae0: 3a20 7065 616b 5f70 6f73 2c0a 2020 2020  : peak_pos,.    
-00022af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b00: 2020 2020 2020 2020 2020 2020 2768 6569              'hei
-00022b10: 6768 7427 3a20 6865 6967 6874 5f50 4541  ght': height_PEA
-00022b20: 4b7d 290a 0a20 2020 2020 2020 2020 2020  K})..           
-00022b30: 2064 665f 7065 616b 5f73 6f72 743d 6466   df_peak_sort=df
-00022b40: 5f73 6f72 742e 736f 7274 5f76 616c 7565  _sort.sort_value
-00022b50: 7328 2768 6569 6768 7427 2c20 6178 6973  s('height', axis
-00022b60: 3d30 2c20 6173 6365 6e64 696e 673d 4661  =0, ascending=Fa
-00022b70: 6c73 6529 0a0a 2020 2020 2020 2020 2020  lse)..          
-00022b80: 2020 2320 5472 696d 206e 756d 6265 7220    # Trim number 
-00022b90: 6f66 2070 6561 6b73 2062 6173 6564 206f  of peaks based o
-00022ba0: 6e20 7573 6572 2d64 6566 696e 6564 204e  n user-defined N
-00022bb0: 2070 6561 6b73 0a0a 0a0a 2020 2020 2020   peaks....      
-00022bc0: 2020 2020 2020 2370 7269 6e74 2864 665f        #print(df_
-00022bd0: 7065 616b 5f73 6f72 745f 7368 6f72 7429  peak_sort_short)
-00022be0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022bf0: 6c65 6e28 6466 5f70 6561 6b5f 736f 7274  len(df_peak_sort
-00022c00: 3e3d 3129 3a0a 0a20 2020 2020 2020 2020  >=1):..         
-00022c10: 2020 2020 2020 2064 665f 7065 616b 5f73         df_peak_s
-00022c20: 6f72 745f 7368 6f72 743d 6466 5f70 6561  ort_short=df_pea
-00022c30: 6b5f 736f 7274 5b30 3a31 5d0a 2020 2020  k_sort[0:1].    
-00022c40: 2020 2020 2020 2020 2020 2020 7065 616b              peak
-00022c50: 5f70 6f73 5f73 6176 6564 5b69 5d3d 6466  _pos_saved[i]=df
-00022c60: 5f70 6561 6b5f 736f 7274 5f73 686f 7274  _peak_sort_short
-00022c70: 5b27 706f 7327 5d2e 7661 6c75 6573 0a20  ['pos'].values. 
-00022c80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00022c90: 6561 6b5f 6865 6967 6874 5f73 6176 6564  eak_height_saved
-00022ca0: 5b69 5d3d 6466 5f70 6561 6b5f 736f 7274  [i]=df_peak_sort
-00022cb0: 5f73 686f 7274 5b27 6865 6967 6874 275d  _short['height']
-00022cc0: 2e76 616c 7565 730a 2020 2020 2020 2020  .values.        
-00022cd0: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
-00022ce0: 2020 2020 2020 2020 2020 2070 6561 6b5f             peak_
-00022cf0: 706f 735f 7361 7665 645b 695d 3d6e 702e  pos_saved[i]=np.
-00022d00: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-00022d10: 2020 2020 7065 616b 5f68 6569 6768 745f      peak_height_
-00022d20: 7361 7665 645b 695d 3d6e 702e 6e61 6e0a  saved[i]=np.nan.
-00022d30: 0a20 2020 2020 2020 2020 2020 2070 6561  .            pea
-00022d40: 6b5f 6263 6b5b 695d 3d6e 702e 7175 616e  k_bck[i]=np.quan
-00022d50: 7469 6c65 2879 5f70 6c6f 742c 2030 2e32  tile(y_plot, 0.2
-00022d60: 290a 2020 2020 2020 2020 2020 2020 6176  ).            av
-00022d70: 5f79 3d6e 702e 7175 616e 7469 6c65 2879  _y=np.quantile(y
-00022d80: 5f70 6c6f 742c 2030 2e35 290a 2020 2020  _plot, 0.5).    
-00022d90: 2020 2020 2020 2020 4469 6666 3d6e 702e          Diff=np.
-00022da0: 6d61 7828 795f 706c 6f74 292d 6e70 2e6d  max(y_plot)-np.m
-00022db0: 696e 2879 5f70 6c6f 7429 0a20 2020 2020  in(y_plot).     
-00022dc0: 2020 2020 2020 2059 5f73 756d 3d6e 702e         Y_sum=np.
-00022dd0: 6d61 7828 795f 706c 6f74 292f 4469 6666  max(y_plot)/Diff
-00022de0: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00022df0: 312e 706c 6f74 2878 5f70 6c6f 742c 2028  1.plot(x_plot, (
-00022e00: 2879 5f70 6c6f 742d 6e70 2e6d 696e 2879  (y_plot-np.min(y
-00022e10: 5f70 6c6f 7429 292f 4469 6666 292b 692c  _plot))/Diff)+i,
-00022e20: 2027 2d72 2729 0a20 2020 2020 2020 2020   '-r').         
-00022e30: 2020 2061 7831 2e70 6c6f 7428 785f 706c     ax1.plot(x_pl
-00022e40: 6f74 2c20 2828 795f 706c 6f74 2d6e 702e  ot, ((y_plot-np.
-00022e50: 6d69 6e28 795f 706c 6f74 2929 2f44 6966  min(y_plot))/Dif
-00022e60: 6629 2b69 2c20 272e 6b27 2c20 6d73 3d31  f)+i, '.k', ms=1
-00022e70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00022e80: 206c 656e 2868 6569 6768 745f 5045 414b   len(height_PEAK
-00022e90: 293e 303a 0a0a 0a20 2020 2020 2020 2020  )>0:...         
-00022ea0: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
-00022eb0: 6466 5f70 6561 6b5f 736f 7274 5f73 686f  df_peak_sort_sho
-00022ec0: 7274 5b27 706f 7327 5d2c 2028 6466 5f70  rt['pos'], (df_p
-00022ed0: 6561 6b5f 736f 7274 5f73 686f 7274 5b27  eak_sort_short['
-00022ee0: 6865 6967 6874 275d 2d6e 702e 6d69 6e28  height']-np.min(
-00022ef0: 795f 706c 6f74 2929 2f44 6966 662b 692c  y_plot))/Diff+i,
-00022f00: 2027 2a6b 272c 206d 6663 3d27 7965 6c6c   '*k', mfc='yell
-00022f10: 6f77 272c 206d 733d 3130 290a 0a20 2020  ow', ms=10)..   
-00022f20: 2020 2020 2020 2020 2079 706c 6f74 5b69           yplot[i
-00022f30: 5d3d 6e70 2e6d 696e 2828 2879 5f70 6c6f  ]=np.min(((y_plo
-00022f40: 742d 6e70 2e6d 696e 2879 5f70 6c6f 7429  t-np.min(y_plot)
-00022f50: 292f 4469 6666 292b 6929 0a0a 2020 2020  )/Diff)+i)..    
-00022f60: 2020 2020 2020 2020 6178 312e 616e 6e6f          ax1.anno
-00022f70: 7461 7465 2873 7472 2866 696c 6529 2c20  tate(str(file), 
-00022f80: 7879 3d28 786c 696d 5f70 6c6f 745b 315d  xy=(xlim_plot[1]
-00022f90: 2b30 2e35 2c20 7970 6c6f 745b 695d 292c  +0.5, yplot[i]),
-00022fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022fb0: 2020 2020 2020 2020 2020 7879 636f 6f72            xycoor
-00022fc0: 6473 3d22 6461 7461 222c 2066 6f6e 7473  ds="data", fonts
-00022fd0: 697a 653d 3829 0a20 2020 2020 2020 2020  ize=8).         
-00022fe0: 2020 2023 6178 312e 7365 745f 786c 696d     #ax1.set_xlim
-00022ff0: 2878 6c69 6d29 0a20 2020 2020 2020 2020  (xlim).         
-00023000: 2020 2059 3d59 2b59 5f73 756d 0a20 2020     Y=Y+Y_sum.   
-00023010: 2020 2020 2020 2020 2069 3d69 2b31 0a0a           i=i+1..
-00023020: 2020 2020 2020 2020 656c 6966 2073 6967          elif sig
-00023030: 6d61 5f66 696c 7465 7220 6973 2054 7275  ma_filter is Tru
-00023040: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00023050: 2020 2023 2046 696e 6420 6d61 7820 7661     # Find max va
-00023060: 6c75 6520 696e 2072 6567 696f 6e0a 0a20  lue in region.. 
-00023070: 2020 2020 2020 2020 2020 206d 6178 793d             maxy=
-00023080: 6e70 2e6d 6178 2879 5f74 7269 6d29 0a20  np.max(y_trim). 
-00023090: 2020 2020 2020 2020 2020 2078 706f 733d             xpos=
-000230a0: 785f 7472 696d 5b79 5f74 7269 6d3d 3d6d  x_trim[y_trim==m
-000230b0: 6178 795d 5b30 5d0a 2020 2020 2020 2020  axy][0].        
-000230c0: 2020 2020 2370 7269 6e74 2878 706f 7329      #print(xpos)
-000230d0: 0a20 2020 2020 2020 2020 2020 2079 5f61  .            y_a
-000230e0: 726f 756e 645f 6d61 783d 795f 7472 696d  round_max=y_trim
-000230f0: 5b28 785f 7472 696d 3c28 7870 6f73 2b31  [(x_trim<(xpos+1
-00023100: 3029 2926 2878 5f74 7269 6d3e 2878 706f  0))&(x_trim>(xpo
-00023110: 732d 3130 2929 5d0a 2020 2020 2020 2020  s-10))].        
-00023120: 2020 2020 7374 6479 3d6e 702e 6e61 6e73      stdy=np.nans
-00023130: 7464 2879 5f61 726f 756e 645f 6d61 7829  td(y_around_max)
-00023140: 0a20 2020 2020 2020 2020 2020 206d 6564  .            med
-00023150: 6961 6e79 3d6e 702e 6e61 6e6d 6564 6961  iany=np.nanmedia
-00023160: 6e28 795f 6172 6f75 6e64 5f6d 6178 290a  n(y_around_max).
-00023170: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00023180: 6178 793e 6d65 6469 616e 792b 7374 6479  axy>mediany+stdy
-00023190: 2a73 6967 6d61 3a0a 2020 2020 2020 2020  *sigma:.        
-000231a0: 2020 2020 2020 2020 706f 735f 783d 785f          pos_x=x_
-000231b0: 7472 696d 5b79 5f74 7269 6d3d 3d6d 6178  trim[y_trim==max
-000231c0: 795d 5b30 5d0a 2020 2020 2020 2020 2020  y][0].          
-000231d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000231e0: 2020 2020 2020 2020 706f 735f 783d 6e70          pos_x=np
-000231f0: 2e6e 616e 0a0a 0a0a 2020 2020 2020 2020  .nan....        
-00023200: 2020 2020 6966 2070 6f73 5f78 3e30 3a0a      if pos_x>0:.
-00023210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023220: 7065 616b 5f70 6f73 5f73 6176 6564 5b69  peak_pos_saved[i
-00023230: 5d3d 706f 735f 780a 2020 2020 2020 2020  ]=pos_x.        
-00023240: 2020 2020 2020 2020 7065 616b 5f68 6569          peak_hei
-00023250: 6768 745f 7361 7665 645b 695d 3d6d 6178  ght_saved[i]=max
-00023260: 790a 0a20 2020 2020 2020 2020 2020 2065  y..            e
-00023270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00023280: 2020 2020 2070 6561 6b5f 706f 735f 7361       peak_pos_sa
-00023290: 7665 645b 695d 3d6e 702e 6e61 6e0a 2020  ved[i]=np.nan.  
-000232a0: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-000232b0: 616b 5f68 6569 6768 745f 7361 7665 645b  ak_height_saved[
-000232c0: 695d 3d6e 702e 6e61 6e0a 0a20 2020 2020  i]=np.nan..     
-000232d0: 2020 2020 2020 2070 6561 6b5f 6263 6b5b         peak_bck[
-000232e0: 695d 3d6e 702e 7175 616e 7469 6c65 2879  i]=np.quantile(y
-000232f0: 5f70 6c6f 742c 2030 2e32 290a 2020 2020  _plot, 0.2).    
-00023300: 2020 2020 2020 2020 6176 5f79 3d6e 702e          av_y=np.
-00023310: 7175 616e 7469 6c65 2879 5f70 6c6f 742c  quantile(y_plot,
-00023320: 2030 2e35 290a 2020 2020 2020 2020 2020   0.5).          
-00023330: 2020 4469 6666 3d6e 702e 6d61 7828 795f    Diff=np.max(y_
-00023340: 706c 6f74 292d 6e70 2e6d 696e 2879 5f70  plot)-np.min(y_p
-00023350: 6c6f 7429 0a20 2020 2020 2020 2020 2020  lot).           
-00023360: 2059 5f73 756d 3d6e 702e 6d61 7828 795f   Y_sum=np.max(y_
-00023370: 706c 6f74 292f 4469 6666 0a20 2020 2020  plot)/Diff.     
-00023380: 2020 2020 2020 2023 2049 4620 7468 6572         # IF ther
-00023390: 6520 6973 2073 6f6d 6574 6869 6e67 2074  e is something t
-000233a0: 6861 7420 7061 7373 6573 2074 6865 2066  hat passes the f
-000233b0: 696c 7465 720a 2020 2020 2020 2020 2020  ilter.          
-000233c0: 2020 6966 2070 6f73 5f78 3e30 3a0a 2020    if pos_x>0:.  
-000233d0: 2020 2020 2020 2020 2020 2020 2020 795f                y_
-000233e0: 7374 6172 5b69 5d3d 2870 6561 6b5f 6865  star[i]=(peak_he
-000233f0: 6967 6874 5f73 6176 6564 5b69 5d2d 6e70  ight_saved[i]-np
-00023400: 2e6d 696e 2879 5f70 6c6f 7429 292f 4469  .min(y_plot))/Di
-00023410: 6666 2b69 0a20 2020 2020 2020 2020 2020  ff+i.           
-00023420: 2020 2020 2061 7831 2e70 6c6f 7428 706f       ax1.plot(po
-00023430: 735f 782c 2079 5f73 7461 725b 695d 2c20  s_x, y_star[i], 
-00023440: 272a 6b27 2c20 6d66 633d 2779 656c 6c6f  '*k', mfc='yello
-00023450: 7727 2c20 6d73 3d31 3029 0a20 2020 2020  w', ms=10).     
-00023460: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00023470: 2020 2020 2020 2020 2020 2020 2079 5f73               y_s
-00023480: 7461 725b 695d 3d6e 702e 6e61 6e0a 0a20  tar[i]=np.nan.. 
-00023490: 2020 2020 2020 2020 2020 2061 7831 2e70             ax1.p
-000234a0: 6c6f 7428 785f 706c 6f74 2c20 2828 795f  lot(x_plot, ((y_
-000234b0: 706c 6f74 2d6e 702e 6d69 6e28 795f 706c  plot-np.min(y_pl
-000234c0: 6f74 2929 2f44 6966 6629 2b69 2c20 272d  ot))/Diff)+i, '-
-000234d0: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-000234e0: 6178 312e 706c 6f74 2878 5f70 6c6f 742c  ax1.plot(x_plot,
-000234f0: 2028 2879 5f70 6c6f 742d 6e70 2e6d 696e   ((y_plot-np.min
-00023500: 2879 5f70 6c6f 7429 292f 4469 6666 292b  (y_plot))/Diff)+
-00023510: 692c 2027 2e6b 272c 206d 733d 3129 0a20  i, '.k', ms=1). 
-00023520: 2020 2020 2020 2020 2020 2079 706c 6f74             yplot
-00023530: 5b69 5d3d 6e70 2e6d 696e 2828 2879 5f70  [i]=np.min(((y_p
-00023540: 6c6f 742d 6e70 2e6d 696e 2879 5f70 6c6f  lot-np.min(y_plo
-00023550: 7429 292f 4469 6666 292b 6929 0a20 2020  t))/Diff)+i).   
-00023560: 2020 2020 2020 2020 2061 7831 2e61 6e6e           ax1.ann
-00023570: 6f74 6174 6528 7374 7228 6669 6c65 292c  otate(str(file),
-00023580: 2078 793d 2878 6c69 6d5f 706c 6f74 5b31   xy=(xlim_plot[1
-00023590: 5d2b 302e 352c 2079 706c 6f74 5b69 5d29  ]+0.5, yplot[i])
-000235a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000235b0: 2020 2020 2020 2020 2020 2078 7963 6f6f             xycoo
-000235c0: 7264 733d 2264 6174 6122 2c20 666f 6e74  rds="data", font
-000235d0: 7369 7a65 3d38 290a 2020 2020 2020 2020  size=8).        
-000235e0: 2020 2020 593d 592b 595f 7375 6d0a 2020      Y=Y+Y_sum.  
-000235f0: 2020 2020 2020 2020 2020 693d 692b 310a            i=i+1.
-00023600: 0a20 2020 2020 2020 2065 6c69 6620 6a75  .        elif ju
-00023610: 7374 5f70 6c6f 7420 6973 2054 7275 653a  st_plot is True:
-00023620: 0a20 2020 2020 2020 2020 2020 2044 6966  .            Dif
-00023630: 663d 6e70 2e6d 6178 2879 5f70 6c6f 7429  f=np.max(y_plot)
-00023640: 2d6e 702e 6d69 6e28 795f 706c 6f74 290a  -np.min(y_plot).
-00023650: 2020 2020 2020 2020 2020 2020 595f 7375              Y_su
-00023660: 6d3d 6e70 2e6d 6178 2879 5f70 6c6f 7429  m=np.max(y_plot)
-00023670: 2f44 6966 660a 2020 2020 2020 2020 2020  /Diff.          
-00023680: 2020 6178 312e 706c 6f74 2878 5f70 6c6f    ax1.plot(x_plo
-00023690: 742c 2028 2879 5f70 6c6f 742d 6e70 2e6d  t, ((y_plot-np.m
-000236a0: 696e 2879 5f70 6c6f 7429 292f 4469 6666  in(y_plot))/Diff
-000236b0: 292b 692c 2027 2d72 2729 0a20 2020 2020  )+i, '-r').     
-000236c0: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
-000236d0: 785f 706c 6f74 2c20 2828 795f 706c 6f74  x_plot, ((y_plot
-000236e0: 2d6e 702e 6d69 6e28 795f 706c 6f74 2929  -np.min(y_plot))
-000236f0: 2f44 6966 6629 2b69 2c20 272e 6b27 2c20  /Diff)+i, '.k', 
-00023700: 6d73 3d31 290a 2020 2020 2020 2020 2020  ms=1).          
-00023710: 2020 7970 6c6f 745b 695d 3d6e 702e 6d69    yplot[i]=np.mi
-00023720: 6e28 2828 795f 706c 6f74 2d6e 702e 6d69  n(((y_plot-np.mi
-00023730: 6e28 795f 706c 6f74 2929 2f44 6966 6629  n(y_plot))/Diff)
-00023740: 2b69 290a 2020 2020 2020 2020 2020 2020  +i).            
-00023750: 6178 312e 616e 6e6f 7461 7465 2873 7472  ax1.annotate(str
-00023760: 2866 696c 6529 2c20 7879 3d28 786c 696d  (file), xy=(xlim
-00023770: 5f70 6c6f 745b 315d 2b30 2e35 2c20 7970  _plot[1]+0.5, yp
-00023780: 6c6f 745b 695d 292c 0a20 2020 2020 2020  lot[i]),.       
-00023790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000237a0: 2020 7879 636f 6f72 6473 3d22 6461 7461    xycoords="data
-000237b0: 222c 2066 6f6e 7473 697a 653d 3829 0a20  ", fontsize=8). 
-000237c0: 2020 2020 2020 2020 2020 2059 3d59 2b59             Y=Y+Y
-000237d0: 5f73 756d 0a20 2020 2020 2020 2020 2020  _sum.           
-000237e0: 2069 3d69 2b31 0a0a 0a20 2020 2064 665f   i=i+1...    df_
-000237f0: 7065 616b 733d 7064 2e44 6174 6146 7261  peaks=pd.DataFra
-00023800: 6d65 2864 6174 613d 7b27 706f 7327 3a20  me(data={'pos': 
-00023810: 7065 616b 5f70 6f73 5f73 6176 6564 2c0a  peak_pos_saved,.
+0001e510: 2020 2020 2020 2020 2020 2020 2743 3133              'C13
+0001e520: 5f43 656e 7427 3a20 6e70 2e6e 616e 2c0a  _Cent': np.nan,.
+0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e560: 2020 2020 2020 2020 2743 3133 5f41 7265          'C13_Are
+0001e570: 6127 3a20 6e70 2e6e 616e 2c0a 2020 2020  a': np.nan,.    
+0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5b0: 2020 2020 7d29 0a20 2020 2020 2020 2063      }).        c
+0001e5c0: 6f6d 626f 5f66 3d70 642e 636f 6e63 6174  ombo_f=pd.concat
+0001e5d0: 285b 6466 2c20 4361 7262 5f66 6974 5d2c  ([df, Carb_fit],
+0001e5e0: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
+0001e5f0: 2069 6620 746f 5f63 6c69 7062 6f61 7264   if to_clipboard
+0001e600: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+0001e610: 2020 2020 2020 6466 2e74 6f5f 636c 6970        df.to_clip
+0001e620: 626f 6172 6428 6578 6365 6c3d 5472 7565  board(excel=True
+0001e630: 2c20 6865 6164 6572 3d46 616c 7365 2c20  , header=False, 
+0001e640: 696e 6465 783d 4661 6c73 6529 0a20 2020  index=False).   
+0001e650: 2020 2020 2063 6f6d 626f 5f66 3d64 660a       combo_f=df.
+0001e660: 0a20 2020 2069 6620 746f 5f63 7376 2069  .    if to_csv i
+0001e670: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+0001e680: 6966 2070 6174 6820 6973 204e 6f6e 653a  if path is None:
+0001e690: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001e6a0: 7365 2045 7863 6570 7469 6f6e 2827 596f  se Exception('Yo
+0001e6b0: 7520 6e65 6564 2074 6f20 7370 6563 6966  u need to specif
+0001e6c0: 7920 7061 7468 3d20 666f 7220 7768 6572  y path= for wher
+0001e6d0: 6576 6572 2079 6f75 2077 616e 7420 7468  ever you want th
+0001e6e0: 6973 2073 6176 6564 2729 0a20 2020 2020  is saved').     
+0001e6f0: 2020 2070 6174 685f 6669 7473 3d70 6174     path_fits=pat
+0001e700: 682b 272f 272b 2744 6961 645f 4669 7473  h+'/'+'Diad_Fits
+0001e710: 270a 2020 2020 2020 2020 6966 206f 732e  '.        if os.
+0001e720: 7061 7468 2e65 7869 7374 7328 7061 7468  path.exists(path
+0001e730: 5f66 6974 7329 3a0a 2020 2020 2020 2020  _fits):.        
+0001e740: 2020 2020 6f75 743d 2770 6174 6820 6578      out='path ex
+0001e750: 6973 7473 270a 2020 2020 2020 2020 656c  ists'.        el
+0001e760: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001e770: 6469 7232 3d6f 732e 6d61 6b65 6469 7273  dir2=os.makedirs
+0001e780: 2870 6174 682b 272f 272b 2027 4469 6164  (path+'/'+ 'Diad
+0001e790: 5f46 6974 7327 2c20 6578 6973 745f 6f6b  _Fits', exist_ok
+0001e7a0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001e7b0: 2366 696c 6570 6174 683d 5061 7468 2870  #filepath=Path(p
+0001e7c0: 6174 682b 272f 272b 2027 5065 616b 5f46  ath+'/'+ 'Peak_F
+0001e7d0: 6974 7327 2b27 2f27 2b66 696c 656e 616d  its'+'/'+filenam
+0001e7e0: 6529 0a20 2020 2020 2020 2063 6f6d 626f  e).        combo
+0001e7f0: 5f66 2e74 6f5f 6373 7628 7061 7468 2b27  _f.to_csv(path+'
+0001e800: 2f27 2b27 4469 6164 5f46 6974 7327 2b27  /'+'Diad_Fits'+'
+0001e810: 2f27 2b27 6669 7473 5f27 2b66 696c 656e  /'+'fits_'+filen
+0001e820: 616d 6529 0a20 2020 2072 6574 7572 6e20  ame).    return 
+0001e830: 636f 6d62 6f5f 660a 0a0a 0a0a 0a0a 0a0a  combo_f.........
+0001e840: 0a23 2320 4669 7420 6765 6e65 7269 6320  .## Fit generic 
+0001e850: 7065 616b 0a0a 4064 6174 6163 6c61 7373  peak..@dataclass
+0001e860: 0a63 6c61 7373 2067 656e 6572 6963 5f70  .class generic_p
+0001e870: 6561 6b5f 636f 6e66 6967 3a0a 0a20 2020  eak_config:..   
+0001e880: 2023 204e 616d 6520 7468 6174 2067 6574   # Name that get
+0001e890: 7320 7374 616d 7065 6420 6f6e 746f 2066  s stamped onto f
+0001e8a0: 6974 730a 2020 2020 6e61 6d65 3a20 7374  its.    name: st
+0001e8b0: 723d 2027 6765 6e65 7269 6327 0a20 2020  r= 'generic'.   
+0001e8c0: 2023 2053 656c 6563 7469 6e67 2074 6865   # Selecting the
+0001e8d0: 2074 776f 2062 6163 6b67 726f 756e 6420   two background 
+0001e8e0: 706f 7369 7469 6f6e 730a 2020 2020 6c6f  positions.    lo
+0001e8f0: 7765 725f 6263 6b3a 2054 7570 6c65 5b66  wer_bck: Tuple[f
+0001e900: 6c6f 6174 2c20 666c 6f61 745d 3d28 3130  loat, float]=(10
+0001e910: 3630 2c20 3130 3635 290a 2020 2020 7570  60, 1065).    up
+0001e920: 7065 725f 6263 6b3a 2054 7570 6c65 5b66  per_bck: Tuple[f
+0001e930: 6c6f 6174 2c20 666c 6f61 745d 3d28 3131  loat, float]=(11
+0001e940: 3230 2c20 3131 3330 290a 0a20 2020 2023  20, 1130)..    #
+0001e950: 0a20 2020 206d 6f64 656c 5f6e 616d 653a  .    model_name:
+0001e960: 2073 7472 3d27 5073 6575 646f 566f 6967   str='PseudoVoig
+0001e970: 744d 6f64 656c 270a 2020 2020 785f 7261  tModel'.    x_ra
+0001e980: 6e67 655f 6263 6b3a 2066 6c6f 6174 3d31  nge_bck: float=1
+0001e990: 300a 0a20 2020 2023 2042 6163 6b67 726f  0..    # Backgro
+0001e9a0: 756e 6420 6465 6772 6565 206f 6620 706f  und degree of po
+0001e9b0: 6c79 6e6f 6d69 616c 0a20 2020 204e 5f70  lynomial.    N_p
+0001e9c0: 6f6c 795f 6361 7262 5f62 636b 3a20 666c  oly_carb_bck: fl
+0001e9d0: 6f61 7420 3d31 0a20 2020 2023 2053 656c  oat =1.    # Sel
+0001e9e0: 6574 6374 696e 6720 7468 6520 616d 706c  etcting the ampl
+0001e9f0: 6974 7564 650a 2020 2020 616d 706c 6974  itude.    amplit
+0001ea00: 7564 653a 2066 6c6f 6174 203d 3130 3030  ude: float =1000
+0001ea10: 0a0a 2020 2020 2320 5365 6c65 6374 696e  ..    # Selectin
+0001ea20: 6720 7468 6520 7065 616b 2063 656e 7465  g the peak cente
+0001ea30: 720a 2020 2020 6365 6e74 3a20 666c 6f61  r.    cent: floa
+0001ea40: 7420 3d31 3039 300a 0a20 2020 2023 206f  t =1090..    # o
+0001ea50: 7574 6c69 6572 2073 6967 6d61 2074 6f20  utlier sigma to 
+0001ea60: 6469 7363 6172 6420 6261 636b 6772 6f75  discard backgrou
+0001ea70: 6e64 2061 740a 2020 2020 6f75 746c 6965  nd at.    outlie
+0001ea80: 725f 7369 676d 613a 2066 6c6f 6174 203d  r_sigma: float =
+0001ea90: 3132 0a0a 0a0a 2020 2020 2320 5061 7261  12....    # Para
+0001eaa0: 6d65 7465 7273 2066 6f72 2053 6369 7079  meters for Scipy
+0001eab0: 2066 696e 6420 7065 616b 730a 2020 2020   find peaks.    
+0001eac0: 6469 7374 616e 6365 3a20 666c 6f61 743d  distance: float=
+0001ead0: 3130 0a20 2020 2070 726f 6d69 6e65 6e63  10.    prominenc
+0001eae0: 653a 2066 6c6f 6174 3d35 0a20 2020 2077  e: float=5.    w
+0001eaf0: 6964 7468 3a20 666c 6f61 743d 360a 2020  idth: float=6.  
+0001eb00: 2020 7468 7265 7368 6f6c 643a 2066 6c6f    threshold: flo
+0001eb10: 6174 3d30 2e31 0a20 2020 2068 6569 6768  at=0.1.    heigh
+0001eb20: 743a 666c 6f61 7420 3d31 3030 0a0a 2020  t:float =100..  
+0001eb30: 2020 2320 4578 636c 7564 696e 6720 6120    # Excluding a 
+0001eb40: 7261 6e67 6520 666f 7220 636f 736d 6963  range for cosmic
+0001eb50: 2072 6179 7320 6574 632e 0a20 2020 2065   rays etc..    e
+0001eb60: 7863 6c75 6465 5f72 616e 6765 3a20 4f70  xclude_range: Op
+0001eb70: 7469 6f6e 616c 205b 5475 706c 655b 666c  tional [Tuple[fl
+0001eb80: 6f61 742c 2066 6c6f 6174 5d5d 3d4e 6f6e  oat, float]]=Non
+0001eb90: 650a 0a0a 2020 2020 2320 5265 7475 726e  e...    # Return
+0001eba0: 206f 7468 6572 2070 6172 616d 6574 6572   other parameter
+0001ebb0: 6573 2065 2e67 2e20 696e 7465 726d 6564  es e.g. intermed
+0001ebc0: 6961 7465 206f 7574 7075 7473 0a20 2020  iate outputs.   
+0001ebd0: 2072 6574 7572 6e5f 6f74 6865 725f 7061   return_other_pa
+0001ebe0: 7261 6d73 3a20 626f 6f6c 203d 2046 616c  rams: bool = Fal
+0001ebf0: 7365 0a0a 2020 2020 4e5f 7065 616b 733a  se..    N_peaks:
+0001ec00: 2069 6e74 3d20 310a 0a0a 0a0a 0a0a 6465   int= 1.......de
+0001ec10: 6620 6669 745f 6765 6e65 7269 635f 7065  f fit_generic_pe
+0001ec20: 616b 282a 2c20 636f 6e66 6967 3a20 6765  ak(*, config: ge
+0001ec30: 6e65 7269 635f 7065 616b 5f63 6f6e 6669  neric_peak_confi
+0001ec40: 673d 6765 6e65 7269 635f 7065 616b 5f63  g=generic_peak_c
+0001ec50: 6f6e 6669 6728 292c 0a70 6174 683d 4e6f  onfig(),.path=No
+0001ec60: 6e65 2c20 6669 6c65 6e61 6d65 3d4e 6f6e  ne, filename=Non
+0001ec70: 652c 2066 696c 6574 7970 653d 4e6f 6e65  e, filetype=None
+0001ec80: 2c0a 2070 6c6f 745f 6669 6775 7265 3d54  ,. plot_figure=T
+0001ec90: 7275 652c 2064 7069 3d32 3030 293a 0a0a  rue, dpi=200):..
+0001eca0: 2020 2020 2222 2220 5468 6973 2066 756e      """ This fun
+0001ecb0: 6374 696f 6e20 6669 7473 2061 2067 656e  ction fits a gen
+0001ecc0: 6572 6963 2070 6561 6b20 7769 7468 2061  eric peak with a
+0001ecd0: 2067 6175 7373 6961 6e2c 2061 6e64 2072   gaussian, and r
+0001ece0: 6574 7572 6e73 2061 2070 6c6f 740a 0a20  eturns a plot.. 
+0001ecf0: 2020 2063 6f6e 6669 673a 2066 726f 6d20     config: from 
+0001ed00: 6461 7461 636c 6173 7320 6765 6e65 7269  dataclass generi
+0001ed10: 635f 7065 616b 5f63 6f6e 6669 670a 0a20  c_peak_config.. 
+0001ed20: 2020 2020 2020 206d 6f64 656c 5f6e 616d         model_nam
+0001ed30: 653a 2073 7472 2c20 2747 6175 7373 6961  e: str, 'Gaussia
+0001ed40: 6e4d 6f64 656c 272c 2027 566f 6967 744d  nModel', 'VoigtM
+0001ed50: 6f64 656c 272c 2027 5073 6575 646f 566f  odel', 'PseudoVo
+0001ed60: 6967 744d 6f64 656c 272c 2027 5370 6c69  igtModel', 'Spli
+0001ed70: 6e65 272c 2027 506f 6c79 272c 0a20 2020  ne', 'Poly',.   
+0001ed80: 2020 2020 2020 2020 2046 6974 7320 4761           Fits Ga
+0001ed90: 7573 7369 616e 2c20 566f 6967 742c 206f  ussian, Voigt, o
+0001eda0: 7220 5073 6575 646f 566f 6967 742c 206f  r PseudoVoigt, o
+0001edb0: 7220 6669 7473 2061 2073 706c 696e 6520  r fits a spline 
+0001edc0: 6f72 2070 6f6c 796e 6f6d 6169 6c20 616e  or polynomail an
+0001edd0: 6420 6765 7473 2061 7265 6120 756e 6465  d gets area unde
+0001ede0: 726e 6561 7468 0a0a 2020 2020 2020 2020  rneath..        
+0001edf0: 6e61 6d65 3a20 7374 720a 2020 2020 2020  name: str.      
+0001ee00: 2020 2020 2020 4e61 6d65 206f 6620 6665        Name of fe
+0001ee10: 6174 7572 6520 796f 7520 6172 6520 6669  ature you are fi
+0001ee20: 7474 696e 672e 2055 7365 6420 746f 206d  tting. Used to m
+0001ee30: 616b 6520 636f 6c75 6d6e 2068 6561 6469  ake column headi
+0001ee40: 6e67 7320 696e 206f 7574 7075 7420 2865  ngs in output (e
+0001ee50: 2e67 2e2c 2069 6620 534f 322c 206f 7574  .g., if SO2, out
+0001ee60: 7075 7473 2061 7265 2050 6561 6b5f 4365  puts are Peak_Ce
+0001ee70: 6e74 5f53 4f32 2c20 5065 616b 5f41 7265  nt_SO2, Peak_Are
+0001ee80: 615f 534f 3229 0a0a 2020 2020 2020 2020  a_SO2)..        
+0001ee90: 6c6f 7765 725f 626b 633a 2054 7570 6c65  lower_bkc: Tuple
+0001eea0: 5b66 6c6f 6174 2c20 666c 6f61 745d 0a20  [float, float]. 
+0001eeb0: 2020 2020 2020 2020 2020 2055 7070 6572             Upper
+0001eec0: 2061 6e64 206c 6f77 6572 2078 2063 6f6f   and lower x coo
+0001eed0: 7264 696e 6174 6520 666f 7220 6261 636b  rdinate for back
+0001eee0: 6772 6f75 6e64 2074 6f20 6c65 6674 206f  ground to left o
+0001eef0: 6620 7065 616b 0a0a 2020 2020 2020 2020  f peak..        
+0001ef00: 7570 7065 725f 626b 633a 2054 7570 6c65  upper_bkc: Tuple
+0001ef10: 5b66 6c6f 6174 2c20 666c 6f61 745d 0a20  [float, float]. 
+0001ef20: 2020 2020 2020 2020 2020 2055 7070 6572             Upper
+0001ef30: 2061 6e64 206c 6f77 6572 2078 2063 6f6f   and lower x coo
+0001ef40: 7264 696e 6174 6520 666f 7220 6261 636b  rdinate for back
+0001ef50: 6772 6f75 6e64 2074 6f20 7269 6768 7420  ground to right 
+0001ef60: 6f66 2070 6561 6b0a 0a20 2020 2020 2020  of peak..       
+0001ef70: 2078 5f72 616e 6765 5f62 636b 3a20 666c   x_range_bck: fl
+0001ef80: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+0001ef90: 7365 7473 2078 6c69 6d20 6f66 2066 6967  sets xlim of fig
+0001efa0: 7572 652c 2061 7320 7468 6520 7065 616b  ure, as the peak
+0001efb0: 2063 656e 7465 7220 2b20 785f 7261 6e67   center + x_rang
+0001efc0: 655f 6263 6b2c 2061 6e64 2070 6561 6b20  e_bck, and peak 
+0001efd0: 6365 6e74 202d 2078 5f72 616e 6765 5f62  cent - x_range_b
+0001efe0: 636b 0a0a 2020 2020 2020 2020 4e5f 706f  ck..        N_po
+0001eff0: 6c79 5f63 6172 625f 6263 6b3a 2069 6e74  ly_carb_bck: int
+0001f000: 0a20 2020 2020 2020 2020 2020 2044 6567  .            Deg
+0001f010: 7265 6520 6f66 2070 6f6c 796e 6f6d 6961  ree of polynomia
+0001f020: 6c20 746f 2066 6974 2074 6f20 7468 6520  l to fit to the 
+0001f030: 6261 636b 6772 6f75 6e64 2070 6f73 6974  background posit
+0001f040: 696f 6e73 0a0a 2020 2020 2020 2020 616d  ions..        am
+0001f050: 706c 6974 7564 653a 2066 6c6f 6174 0a20  plitude: float. 
+0001f060: 2020 2020 2020 2020 2020 2041 7070 726f             Appro
+0001f070: 7820 616d 706c 6974 7564 6520 6f66 2070  x amplitude of p
+0001f080: 6561 6b2e 0a0a 2020 2020 2020 2020 6365  eak...        ce
+0001f090: 6e74 3a20 666c 6f61 740a 2020 2020 2020  nt: float.      
+0001f0a0: 2020 2020 2020 4170 7072 6f78 2063 656e        Approx cen
+0001f0b0: 7420 6f66 2070 6561 6b0a 0a20 2020 2020  t of peak..     
+0001f0c0: 2020 206f 7574 6c69 6572 5f73 6967 6d61     outlier_sigma
+0001f0d0: 3a20 666c 6f61 740a 2020 2020 2020 2020  : float.        
+0001f0e0: 2020 2020 4469 7363 6172 6473 2070 6f69      Discards poi
+0001f0f0: 6e74 7320 6f6e 2074 6865 2062 6163 6b67  nts on the backg
+0001f100: 726f 756e 6420 6f75 7473 6964 6520 6f75  round outside ou
+0001f110: 746c 6965 725f 7369 676d 6120 6f66 2074  tlier_sigma of t
+0001f120: 6865 206d 6564 6961 6e20 7661 6c75 650a  he median value.
+0001f130: 0a20 2020 2020 2020 2064 6973 7461 6e63  .        distanc
+0001f140: 652c 2070 726f 6d69 6e65 6e63 652c 2074  e, prominence, t
+0001f150: 6872 6573 686f 6c64 2c20 6865 6967 6874  hreshold, height
+0001f160: 3a20 666c 6f61 7473 0a20 2020 2020 2020  : floats.       
+0001f170: 2020 2020 2070 6172 616d 6574 6572 7320       parameters 
+0001f180: 666f 7220 7363 6970 7920 6669 6e64 5f70  for scipy find_p
+0001f190: 6561 6b73 0a0a 2020 2020 2020 2020 6578  eaks..        ex
+0001f1a0: 636c 7564 655f 7261 6e67 653a 204f 7074  clude_range: Opt
+0001f1b0: 696f 6e61 6c20 5b54 7570 6c65 5b66 6c6f  ional [Tuple[flo
+0001f1c0: 6174 2c20 666c 6f61 745d 5d0a 2020 2020  at, float]].    
+0001f1d0: 2020 2020 2020 2020 4578 636c 7564 6573          Excludes
+0001f1e0: 2072 6567 696f 6e20 6f66 2073 7065 6374   region of spect
+0001f1f0: 7261 2062 6574 7765 656e 2074 6865 7365  ra between these
+0001f200: 2076 616c 7565 730a 0a20 2020 2020 2020   values..       
+0001f210: 2064 7069 3a20 666c 6f61 740a 2020 2020   dpi: float.    
+0001f220: 2020 2020 2020 2020 6470 6920 746f 2073          dpi to s
+0001f230: 6176 6520 6669 6775 7265 2061 740a 0a20  ave figure at.. 
+0001f240: 2020 2020 2020 2072 6574 7572 6e5f 6f74         return_ot
+0001f250: 6865 725f 7061 7261 6d73 3a20 626f 6f6c  her_params: bool
+0001f260: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001f270: 5472 7565 2c20 7265 7475 726e 7320 6f74  True, returns ot
+0001f280: 6865 7220 7065 616b 2066 6974 2070 6172  her peak fit par
+0001f290: 616d 6574 6572 7320 616e 6420 6669 7473  ameters and fits
+0001f2a0: 2028 6466 2c20 7878 5f63 6172 622c 2079   (df, xx_carb, y
+0001f2b0: 5f63 6172 622c 2072 6573 756c 7430 292c  _carb, result0),
+0001f2c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0001f2d0: 6520 6a75 7374 2072 6574 7572 6e73 2064  e just returns d
+0001f2e0: 6620 6f66 2070 6561 6b20 706f 7369 7469  f of peak positi
+0001f2f0: 6f6e 732c 2068 6569 6768 7473 2065 7463  ons, heights etc
+0001f300: 0a0a 0a20 2020 2070 6174 683a 2073 7472  ...    path: str
+0001f310: 0a20 2020 2020 2020 2050 6174 6820 746f  .        Path to
+0001f320: 2066 696c 650a 0a20 2020 2066 696c 656e   file..    filen
+0001f330: 616d 653a 2073 7472 0a20 2020 2020 2020  ame: str.       
+0001f340: 2066 696c 656e 616d 6520 7769 7468 2066   filename with f
+0001f350: 696c 6520 6578 7465 6e73 696f 6e0a 0a20  ile extension.. 
+0001f360: 2020 2066 696c 6574 7970 653a 2073 7472     filetype: str
+0001f370: 0a20 2020 2020 2020 2063 686f 6f73 6520  .        choose 
+0001f380: 6672 6f6d 2027 5769 7465 635f 4153 4349  from 'Witec_ASCI
+0001f390: 4927 2c20 2768 6561 646c 6573 735f 7478  I', 'headless_tx
+0001f3a0: 7427 2c20 2768 6561 646c 6573 735f 6373  t', 'headless_cs
+0001f3b0: 7627 2c20 2768 6561 645f 6373 7627 2c20  v', 'head_csv', 
+0001f3c0: 2757 6974 6563 5f41 5343 4949 272c 0a20  'Witec_ASCII',. 
+0001f3d0: 2020 2020 2020 2027 484f 5249 4241 5f74         'HORIBA_t
+0001f3e0: 7874 272c 2027 5265 6e69 7368 6177 5f74  xt', 'Renishaw_t
+0001f3f0: 7874 270a 0a0a 2020 2020 706c 6f74 5f66  xt'...    plot_f
+0001f400: 6967 7572 653a 2062 6f6f 6c0a 2020 2020  igure: bool.    
+0001f410: 2020 2020 4966 2074 7275 652c 2070 6c6f      If true, plo
+0001f420: 7473 2066 6967 7572 6520 616e 6420 7361  ts figure and sa
+0001f430: 7665 7320 6974 2069 6e20 6120 7375 6266  ves it in a subf
+0001f440: 6f6c 6465 7220 696e 2074 6865 2073 616d  older in the sam
+0001f450: 6520 6469 7265 6374 6f72 7920 6173 2074  e directory as t
+0001f460: 6865 2066 696c 6570 6174 6820 7370 6563  he filepath spec
+0001f470: 6966 6965 640a 0a20 2020 2064 7069 3a20  ified..    dpi: 
+0001f480: 696e 740a 2020 2020 2020 2020 6470 6920  int.        dpi 
+0001f490: 746f 2073 6176 6520 6669 6775 7265 2061  to save figure a
+0001f4a0: 740a 0a20 2020 2052 6574 7572 6e73 0a20  t..    Returns. 
+0001f4b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20     -----------. 
+0001f4c0: 2020 2064 6620 6f66 2070 6561 6b20 6669     df of peak fi
+0001f4d0: 7473 2c20 756e 6c65 7373 2072 6574 7572  ts, unless retur
+0001f4e0: 6e5f 6f74 6865 725f 7061 7261 6d73 2069  n_other_params i
+0001f4f0: 7320 5472 7565 2c20 7468 656e 2061 6c73  s True, then als
+0001f500: 6f20 7265 7475 726e 7320 7820 616e 6420  o returns x and 
+0001f510: 7920 636f 6f72 6469 6e61 7465 206f 6620  y coordinate of 
+0001f520: 6669 742c 2061 6e64 2066 6974 2070 6172  fit, and fit par
+0001f530: 616d 730a 0a20 2020 2022 2222 0a0a 0a20  ams..    """... 
+0001f540: 2020 2053 7065 6374 7261 5f69 6e3d 6765     Spectra_in=ge
+0001f550: 745f 6461 7461 2870 6174 683d 7061 7468  t_data(path=path
+0001f560: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+0001f570: 616d 652c 2066 696c 6574 7970 653d 6669  ame, filetype=fi
+0001f580: 6c65 7479 7065 290a 0a20 2020 206e 616d  letype)..    nam
+0001f590: 653d 636f 6e66 6967 2e6e 616d 650a 0a20  e=config.name.. 
+0001f5a0: 2020 2023 2049 6620 6578 636c 7564 6520     # If exclude 
+0001f5b0: 7261 6e67 652c 2074 7269 6d20 7468 6174  range, trim that
+0001f5c0: 2068 6572 650a 2020 2020 6966 2063 6f6e   here.    if con
+0001f5d0: 6669 672e 6578 636c 7564 655f 7261 6e67  fig.exclude_rang
+0001f5e0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0001f5f0: 2020 2020 2020 2020 2020 2053 7065 6374             Spect
+0001f600: 7261 3d53 7065 6374 7261 5f69 6e5b 2028  ra=Spectra_in[ (
+0001f610: 5370 6563 7472 615f 696e 5b3a 2c20 305d  Spectra_in[:, 0]
+0001f620: 3c63 6f6e 6669 672e 6578 636c 7564 655f  <config.exclude_
+0001f630: 7261 6e67 655b 305d 2920 7c20 2853 7065  range[0]) | (Spe
+0001f640: 6374 7261 5f69 6e5b 3a2c 2030 5d3e 636f  ctra_in[:, 0]>co
+0001f650: 6e66 6967 2e65 7863 6c75 6465 5f72 616e  nfig.exclude_ran
+0001f660: 6765 5b31 5d29 205d 0a20 2020 2065 6c73  ge[1]) ].    els
+0001f670: 653a 0a20 2020 2020 2020 2053 7065 6374  e:.        Spect
+0001f680: 7261 3d53 7065 6374 7261 5f69 6e0a 0a0a  ra=Spectra_in...
+0001f690: 0a20 2020 206c 6f77 6572 5f30 6261 7365  .    lower_0base
+0001f6a0: 6c69 6e65 3d63 6f6e 6669 672e 6c6f 7765  line=config.lowe
+0001f6b0: 725f 6263 6b5b 305d 0a20 2020 2075 7070  r_bck[0].    upp
+0001f6c0: 6572 5f30 6261 7365 6c69 6e65 3d63 6f6e  er_0baseline=con
+0001f6d0: 6669 672e 6c6f 7765 725f 6263 6b5b 315d  fig.lower_bck[1]
+0001f6e0: 0a20 2020 206c 6f77 6572 5f31 6261 7365  .    lower_1base
+0001f6f0: 6c69 6e65 3d63 6f6e 6669 672e 7570 7065  line=config.uppe
+0001f700: 725f 6263 6b5b 305d 0a20 2020 2075 7070  r_bck[0].    upp
+0001f710: 6572 5f31 6261 7365 6c69 6e65 3d63 6f6e  er_1baseline=con
+0001f720: 6669 672e 7570 7065 725f 6263 6b5b 315d  fig.upper_bck[1]
+0001f730: 0a0a 2020 2020 2320 4669 6c74 6572 206f  ..    # Filter o
+0001f740: 7574 2073 7065 6374 7261 206f 7574 7369  ut spectra outsi
+0001f750: 6465 2074 6865 7365 2062 6173 656c 696e  de these baselin
+0001f760: 6573 0a20 2020 2053 7065 6374 7261 5f73  es.    Spectra_s
+0001f770: 686f 7274 3d53 7065 6374 7261 5b20 2853  hort=Spectra[ (S
+0001f780: 7065 6374 7261 5b3a 2c30 5d3e 6c6f 7765  pectra[:,0]>lowe
+0001f790: 725f 3062 6173 656c 696e 6529 2026 2028  r_0baseline) & (
+0001f7a0: 5370 6563 7472 615b 3a2c 305d 3c75 7070  Spectra[:,0]<upp
+0001f7b0: 6572 5f31 6261 7365 6c69 6e65 2920 5d0a  er_1baseline) ].
+0001f7c0: 2020 2020 5370 6563 7472 615f 6669 743d      Spectra_fit=
+0001f7d0: 5370 6563 7472 615b 2028 5370 6563 7472  Spectra[ (Spectr
+0001f7e0: 615b 3a2c 305d 3e75 7070 6572 5f30 6261  a[:,0]>upper_0ba
+0001f7f0: 7365 6c69 6e65 2920 2620 2853 7065 6374  seline) & (Spect
+0001f800: 7261 5b3a 2c30 5d3c 6c6f 7765 725f 3162  ra[:,0]<lower_1b
+0001f810: 6173 656c 696e 6529 205d 0a0a 2020 2020  aseline) ]..    
+0001f820: 2320 546f 206d 616b 6520 6120 6e69 6365  # To make a nice
+0001f830: 2070 6c6f 742c 2067 6976 6520 3530 2077   plot, give 50 w
+0001f840: 6176 656e 756d 6265 7220 756e 6974 7320  avenumber units 
+0001f850: 6f6e 2065 6974 6865 7220 7369 6465 2061  on either side a
+0001f860: 7320 6120 6275 6666 6572 0a20 2020 2053  s a buffer.    S
+0001f870: 7065 6374 7261 5f70 6c6f 743d 5370 6563  pectra_plot=Spec
+0001f880: 7472 615b 2028 5370 6563 7472 615b 3a2c  tra[ (Spectra[:,
+0001f890: 305d 3e6c 6f77 6572 5f30 6261 7365 6c69  0]>lower_0baseli
+0001f8a0: 6e65 2d35 3029 2026 2028 5370 6563 7472  ne-50) & (Spectr
+0001f8b0: 615b 3a2c 305d 3c75 7070 6572 5f31 6261  a[:,0]<upper_1ba
+0001f8c0: 7365 6c69 6e65 2b35 3029 205d 0a0a 2020  seline+50) ]..  
+0001f8d0: 2020 2320 4669 6e64 2070 6561 6b73 2075    # Find peaks u
+0001f8e0: 7369 6e67 2053 6369 7079 2066 696e 6420  sing Scipy find 
+0001f8f0: 7065 616b 730a 2020 2020 793d 5370 6563  peaks.    y=Spec
+0001f900: 7472 615f 6669 745b 3a2c 2031 5d0a 2020  tra_fit[:, 1].  
+0001f910: 2020 783d 5370 6563 7472 615f 6669 745b    x=Spectra_fit[
+0001f920: 3a2c 2030 5d0a 2020 2020 7370 6563 5f72  :, 0].    spec_r
+0001f930: 6573 3d6e 702e 6162 7328 785b 305d 2d78  es=np.abs(x[0]-x
+0001f940: 5b31 5d29 0a0a 0a20 2020 2070 6561 6b73  [1])...    peaks
+0001f950: 203d 2066 696e 645f 7065 616b 7328 792c   = find_peaks(y,
+0001f960: 6865 6967 6874 203d 2063 6f6e 6669 672e  height = config.
+0001f970: 6865 6967 6874 2c20 7468 7265 7368 6f6c  height, threshol
+0001f980: 6420 3d20 636f 6e66 6967 2e74 6872 6573  d = config.thres
+0001f990: 686f 6c64 2c0a 2020 2020 6469 7374 616e  hold,.    distan
+0001f9a0: 6365 203d 2063 6f6e 6669 672e 6469 7374  ce = config.dist
+0001f9b0: 616e 6365 2c20 7072 6f6d 696e 656e 6365  ance, prominence
+0001f9c0: 3d63 6f6e 6669 672e 7072 6f6d 696e 656e  =config.prominen
+0001f9d0: 6365 2c20 7769 6474 683d 636f 6e66 6967  ce, width=config
+0001f9e0: 2e77 6964 7468 290a 0a20 2020 2068 6569  .width)..    hei
+0001f9f0: 6768 7420 3d20 7065 616b 735b 315d 5b27  ght = peaks[1]['
+0001fa00: 7065 616b 5f68 6569 6768 7473 275d 2023  peak_heights'] #
+0001fa10: 6c69 7374 206f 6620 7468 6520 6865 6967  list of the heig
+0001fa20: 6874 7320 6f66 2074 6865 2070 6561 6b73  hts of the peaks
+0001fa30: 0a20 2020 2070 6561 6b5f 706f 7320 3d20  .    peak_pos = 
+0001fa40: 785b 7065 616b 735b 305d 5d20 236c 6973  x[peaks[0]] #lis
+0001fa50: 7420 6f66 2074 6865 2070 6561 6b73 2070  t of the peaks p
+0001fa60: 6f73 6974 696f 6e73 0a20 2020 2064 665f  ositions.    df_
+0001fa70: 736f 7274 3d70 642e 4461 7461 4672 616d  sort=pd.DataFram
+0001fa80: 6528 6461 7461 3d7b 2770 6f73 273a 2070  e(data={'pos': p
+0001fa90: 6561 6b5f 706f 732c 0a20 2020 2020 2020  eak_pos,.       
+0001faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fab0: 2027 6865 6967 6874 273a 2068 6569 6768   'height': heigh
+0001fac0: 747d 290a 0a20 2020 2064 665f 7065 616b  t})..    df_peak
+0001fad0: 5f73 6f72 743d 6466 5f73 6f72 742e 736f  _sort=df_sort.so
+0001fae0: 7274 5f76 616c 7565 7328 2768 6569 6768  rt_values('heigh
+0001faf0: 7427 2c20 6178 6973 3d30 2c20 6173 6365  t', axis=0, asce
+0001fb00: 6e64 696e 673d 4661 6c73 6529 0a0a 2020  nding=False)..  
+0001fb10: 2020 2320 5472 696d 206e 756d 6265 7220    # Trim number 
+0001fb20: 6f66 2070 6561 6b73 2062 6173 6564 206f  of peaks based o
+0001fb30: 6e20 7573 6572 2d64 6566 696e 6564 204e  n user-defined N
+0001fb40: 2070 6561 6b73 0a20 2020 2064 665f 7065   peaks.    df_pe
+0001fb50: 616b 5f73 6f72 745f 7368 6f72 743d 6466  ak_sort_short=df
+0001fb60: 5f70 6561 6b5f 736f 7274 5b30 3a63 6f6e  _peak_sort[0:con
+0001fb70: 6669 672e 4e5f 7065 616b 735d 0a0a 0a20  fig.N_peaks]... 
+0001fb80: 2020 2023 2047 6574 2061 6374 7561 6c20     # Get actual 
+0001fb90: 6261 7365 6c69 6e65 0a20 2020 2042 6173  baseline.    Bas
+0001fba0: 656c 696e 655f 7769 7468 5f6f 7574 6c3d  eline_with_outl=
+0001fbb0: 5370 6563 7472 615f 7368 6f72 745b 0a20  Spectra_short[. 
+0001fbc0: 2020 2028 2853 7065 6374 7261 5f73 686f     ((Spectra_sho
+0001fbd0: 7274 5b3a 2c20 305d 3c75 7070 6572 5f30  rt[:, 0]<upper_0
+0001fbe0: 6261 7365 6c69 6e65 2920 2628 5370 6563  baseline) &(Spec
+0001fbf0: 7472 615f 7368 6f72 745b 3a2c 2030 5d3e  tra_short[:, 0]>
+0001fc00: 6c6f 7765 725f 3062 6173 656c 696e 6529  lower_0baseline)
+0001fc10: 290a 2020 2020 2020 2020 7c0a 2020 2020  ).        |.    
+0001fc20: 2828 5370 6563 7472 615f 7368 6f72 745b  ((Spectra_short[
+0001fc30: 3a2c 2030 5d3c 7570 7065 725f 3162 6173  :, 0]<upper_1bas
+0001fc40: 656c 696e 6529 2026 2853 7065 6374 7261  eline) &(Spectra
+0001fc50: 5f73 686f 7274 5b3a 2c20 305d 3e6c 6f77  _short[:, 0]>low
+0001fc60: 6572 5f31 6261 7365 6c69 6e65 2929 5d0a  er_1baseline))].
+0001fc70: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
+0001fc80: 7320 7468 6520 4c48 2062 6173 656c 696e  s the LH baselin
+0001fc90: 650a 2020 2020 4c48 5f62 6173 656c 696e  e.    LH_baselin
+0001fca0: 653d 5370 6563 7472 615f 7368 6f72 745b  e=Spectra_short[
+0001fcb0: 0a20 2020 2028 2853 7065 6374 7261 5f73  .    ((Spectra_s
+0001fcc0: 686f 7274 5b3a 2c20 305d 3c75 7070 6572  hort[:, 0]<upper
+0001fcd0: 5f30 6261 7365 6c69 6e65 2920 2628 5370  _0baseline) &(Sp
+0001fce0: 6563 7472 615f 7368 6f72 745b 3a2c 2030  ectra_short[:, 0
+0001fcf0: 5d3e 6c6f 7765 725f 3062 6173 656c 696e  ]>lower_0baselin
+0001fd00: 6529 295d 0a0a 2020 2020 4d65 616e 5f4c  e))]..    Mean_L
+0001fd10: 485f 6261 7365 6c69 6e65 3d6e 702e 6e61  H_baseline=np.na
+0001fd20: 6e6d 6561 6e28 4c48 5f62 6173 656c 696e  nmean(LH_baselin
+0001fd30: 655b 3a2c 2031 5d29 0a20 2020 2053 7464  e[:, 1]).    Std
+0001fd40: 5f4c 485f 6261 7365 6c69 6e65 3d6e 702e  _LH_baseline=np.
+0001fd50: 6e61 6e73 7464 284c 485f 6261 7365 6c69  nanstd(LH_baseli
+0001fd60: 6e65 5b3a 2c20 315d 290a 0a20 2020 2023  ne[:, 1])..    #
+0001fd70: 2043 616c 6375 6c61 7465 7320 7468 6520   Calculates the 
+0001fd80: 5248 2062 6173 656c 696e 650a 2020 2020  RH baseline.    
+0001fd90: 5248 5f62 6173 656c 696e 653d 5370 6563  RH_baseline=Spec
+0001fda0: 7472 615f 7368 6f72 745b 2828 5370 6563  tra_short[((Spec
+0001fdb0: 7472 615f 7368 6f72 745b 3a2c 2030 5d3c  tra_short[:, 0]<
+0001fdc0: 7570 7065 725f 3162 6173 656c 696e 6529  upper_1baseline)
+0001fdd0: 0a20 2020 2026 2853 7065 6374 7261 5f73  .    &(Spectra_s
+0001fde0: 686f 7274 5b3a 2c20 305d 3e6c 6f77 6572  hort[:, 0]>lower
+0001fdf0: 5f31 6261 7365 6c69 6e65 2929 5d0a 2020  _1baseline))].  
+0001fe00: 2020 4d65 616e 5f52 485f 6261 7365 6c69    Mean_RH_baseli
+0001fe10: 6e65 3d6e 702e 6e61 6e6d 6561 6e28 5248  ne=np.nanmean(RH
+0001fe20: 5f62 6173 656c 696e 655b 3a2c 2031 5d29  _baseline[:, 1])
+0001fe30: 0a20 2020 2053 7464 5f52 485f 6261 7365  .    Std_RH_base
+0001fe40: 6c69 6e65 3d6e 702e 6e61 6e73 7464 2852  line=np.nanstd(R
+0001fe50: 485f 6261 7365 6c69 6e65 5b3a 2c20 315d  H_baseline[:, 1]
+0001fe60: 290a 0a20 2020 2023 2052 656d 6f76 6573  )..    # Removes
+0001fe70: 2070 6f69 6e74 7320 6f75 7473 6964 6520   points outside 
+0001fe80: 6261 7365 6c69 6e65 0a0a 2020 2020 4c48  baseline..    LH
+0001fe90: 5f62 6173 656c 696e 655f 6669 6c74 3d4c  _baseline_filt=L
+0001fea0: 485f 6261 7365 6c69 6e65 5b28 4c48 5f62  H_baseline[(LH_b
+0001feb0: 6173 656c 696e 655b 3a2c 2031 5d3c 4d65  aseline[:, 1]<Me
+0001fec0: 616e 5f4c 485f 6261 7365 6c69 6e65 2b63  an_LH_baseline+c
+0001fed0: 6f6e 6669 672e 6f75 746c 6965 725f 7369  onfig.outlier_si
+0001fee0: 676d 612a 5374 645f 4c48 5f62 6173 656c  gma*Std_LH_basel
+0001fef0: 696e 6529 0a20 2020 2026 284c 485f 6261  ine).    &(LH_ba
+0001ff00: 7365 6c69 6e65 5b3a 2c20 315d 3e4d 6561  seline[:, 1]>Mea
+0001ff10: 6e5f 4c48 5f62 6173 656c 696e 652d 636f  n_LH_baseline-co
+0001ff20: 6e66 6967 2e6f 7574 6c69 6572 5f73 6967  nfig.outlier_sig
+0001ff30: 6d61 2a53 7464 5f4c 485f 6261 7365 6c69  ma*Std_LH_baseli
+0001ff40: 6e65 2920 5d0a 0a20 2020 2052 485f 6261  ne) ]..    RH_ba
+0001ff50: 7365 6c69 6e65 5f66 696c 743d 5248 5f62  seline_filt=RH_b
+0001ff60: 6173 656c 696e 655b 2852 485f 6261 7365  aseline[(RH_base
+0001ff70: 6c69 6e65 5b3a 2c20 315d 3c4d 6561 6e5f  line[:, 1]<Mean_
+0001ff80: 5248 5f62 6173 656c 696e 652b 636f 6e66  RH_baseline+conf
+0001ff90: 6967 2e6f 7574 6c69 6572 5f73 6967 6d61  ig.outlier_sigma
+0001ffa0: 2a53 7464 5f52 485f 6261 7365 6c69 6e65  *Std_RH_baseline
+0001ffb0: 290a 2020 2020 2628 5248 5f62 6173 656c  ).    &(RH_basel
+0001ffc0: 696e 655b 3a2c 2031 5d3e 4d65 616e 5f52  ine[:, 1]>Mean_R
+0001ffd0: 485f 6261 7365 6c69 6e65 2d63 6f6e 6669  H_baseline-confi
+0001ffe0: 672e 6f75 746c 6965 725f 7369 676d 612a  g.outlier_sigma*
+0001fff0: 5374 645f 5248 5f62 6173 656c 696e 6529  Std_RH_baseline)
+00020000: 205d 0a0a 2020 2020 4261 7365 6c69 6e65   ]..    Baseline
+00020010: 3d6e 702e 636f 6e63 6174 656e 6174 6528  =np.concatenate(
+00020020: 284c 485f 6261 7365 6c69 6e65 5f66 696c  (LH_baseline_fil
+00020030: 742c 2052 485f 6261 7365 6c69 6e65 5f66  t, RH_baseline_f
+00020040: 696c 7429 2c20 6178 6973 3d30 290a 0a0a  ilt), axis=0)...
+00020050: 0a0a 0a20 2020 2023 2046 6974 7320 6120  ...    # Fits a 
+00020060: 706f 6c79 6e6f 6d69 616c 2074 6f20 7468  polynomial to th
+00020070: 6520 6261 7365 6c69 6e65 206f 6620 6465  e baseline of de
+00020080: 6772 6565 0a20 2020 2050 665f 6261 7365  gree.    Pf_base
+00020090: 6c69 6e65 203d 206e 702e 706f 6c79 3164  line = np.poly1d
+000200a0: 286e 702e 706f 6c79 6669 7428 4261 7365  (np.polyfit(Base
+000200b0: 6c69 6e65 5b3a 2c20 305d 2c20 4261 7365  line[:, 0], Base
+000200c0: 6c69 6e65 5b3a 2c20 315d 2c20 636f 6e66  line[:, 1], conf
+000200d0: 6967 2e4e 5f70 6f6c 795f 6361 7262 5f62  ig.N_poly_carb_b
+000200e0: 636b 2929 0a20 2020 2050 795f 6261 7365  ck)).    Py_base
+000200f0: 203d 5066 5f62 6173 656c 696e 6528 5370   =Pf_baseline(Sp
+00020100: 6563 7472 615f 7368 6f72 745b 3a2c 2030  ectra_short[:, 0
+00020110: 5d29 0a20 2020 2050 795f 6261 7365 5f66  ]).    Py_base_f
+00020120: 6974 203d 5066 5f62 6173 656c 696e 6528  it =Pf_baseline(
+00020130: 5370 6563 7472 615f 6669 745b 3a2c 2030  Spectra_fit[:, 0
+00020140: 5d29 0a0a 0a0a 2020 2020 4261 7365 6c69  ])....    Baseli
+00020150: 6e65 5f79 7375 623d 5066 5f62 6173 656c  ne_ysub=Pf_basel
+00020160: 696e 6528 4261 7365 6c69 6e65 5b3a 2c20  ine(Baseline[:, 
+00020170: 305d 290a 2020 2020 4261 7365 6c69 6e65  0]).    Baseline
+00020180: 5f78 3d42 6173 656c 696e 655b 3a2c 2030  _x=Baseline[:, 0
+00020190: 5d0a 2020 2020 795f 636f 7272 3d20 5370  ].    y_corr= Sp
+000201a0: 6563 7472 615f 7368 6f72 745b 3a2c 2031  ectra_short[:, 1
+000201b0: 5d2d 5079 5f62 6173 650a 2020 2020 795f  ]-Py_base.    y_
+000201c0: 636f 7272 5f66 6974 3d53 7065 6374 7261  corr_fit=Spectra
+000201d0: 5f66 6974 5b3a 2c20 315d 2d50 795f 6261  _fit[:, 1]-Py_ba
+000201e0: 7365 5f66 6974 0a20 2020 2078 5f66 6974  se_fit.    x_fit
+000201f0: 3d53 7065 6374 7261 5f66 6974 5b3a 2c20  =Spectra_fit[:, 
+00020200: 305d 0a20 2020 2078 5f63 6f72 723d 5370  0].    x_corr=Sp
+00020210: 6563 7472 615f 7368 6f72 745b 3a2c 2030  ectra_short[:, 0
+00020220: 5d0a 0a0a 0a20 2020 2069 6620 636f 6e66  ]....    if conf
+00020230: 6967 2e6d 6f64 656c 5f6e 616d 6520 6e6f  ig.model_name no
+00020240: 7420 696e 205b 2747 6175 7373 6961 6e4d  t in ['GaussianM
+00020250: 6f64 656c 272c 2027 566f 6967 744d 6f64  odel', 'VoigtMod
+00020260: 656c 272c 2027 5073 6575 646f 566f 6967  el', 'PseudoVoig
+00020270: 744d 6f64 656c 272c 2027 5370 6c69 6e65  tModel', 'Spline
+00020280: 272c 2027 506f 6c79 275d 3a0a 2020 2020  ', 'Poly']:.    
+00020290: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+000202a0: 726f 7228 276d 6f64 656c 5f6e 616d 6520  ror('model_name 
+000202b0: 6e6f 7420 6120 7065 726d 6974 7465 6420  not a permitted 
+000202c0: 696e 7075 742c 2050 6c65 6173 6520 7365  input, Please se
+000202d0: 6c65 6374 2065 6974 6865 7220 4761 7573  lect either Gaus
+000202e0: 7369 616e 4d6f 6465 6c2c 2056 6f69 6774  sianModel, Voigt
+000202f0: 4d6f 6465 6c2c 2050 7365 7564 6f56 6f69  Model, PseudoVoi
+00020300: 6774 4d6f 6465 6c2c 206f 7220 5370 6c69  gtModel, or Spli
+00020310: 6e65 206f 7220 506f 6c79 2729 0a0a 0a20  ne or Poly')... 
+00020320: 2020 2069 6620 636f 6e66 6967 2e6d 6f64     if config.mod
+00020330: 656c 5f6e 616d 6520 696e 205b 2747 6175  el_name in ['Gau
+00020340: 7373 6961 6e4d 6f64 656c 272c 2027 566f  ssianModel', 'Vo
+00020350: 6967 744d 6f64 656c 272c 2027 5073 6575  igtModel', 'Pseu
+00020360: 646f 566f 6967 744d 6f64 656c 275d 3a0a  doVoigtModel']:.
+00020370: 0a0a 2020 2020 2020 2020 2320 4e4f 7720  ..        # NOw 
+00020380: 696e 746f 2074 6865 2076 6f69 6774 2066  into the voigt f
+00020390: 6974 7469 6e67 0a20 2020 2020 2020 2069  itting.        i
+000203a0: 6620 636f 6e66 6967 2e6d 6f64 656c 5f6e  f config.model_n
+000203b0: 616d 653d 3d27 566f 6967 744d 6f64 656c  ame=='VoigtModel
+000203c0: 273a 0a20 2020 2020 2020 2020 2020 206d  ':.            m
+000203d0: 6f64 656c 3020 3d20 566f 6967 744d 6f64  odel0 = VoigtMod
+000203e0: 656c 2829 232b 2043 6f6e 7374 616e 744d  el()#+ ConstantM
+000203f0: 6f64 656c 2829 0a20 2020 2020 2020 2069  odel().        i
+00020400: 6620 636f 6e66 6967 2e6d 6f64 656c 5f6e  f config.model_n
+00020410: 616d 6520 3d3d 2027 5073 6575 646f 566f  ame == 'PseudoVo
+00020420: 6967 744d 6f64 656c 273a 0a20 2020 2020  igtModel':.     
+00020430: 2020 2020 2020 206d 6f64 656c 3020 3d20         model0 = 
+00020440: 5073 6575 646f 566f 6967 744d 6f64 656c  PseudoVoigtModel
+00020450: 2829 0a20 2020 2020 2020 2069 6620 636f  ().        if co
+00020460: 6e66 6967 2e6d 6f64 656c 5f6e 616d 653d  nfig.model_name=
+00020470: 3d27 4761 7573 7369 616e 4d6f 6465 6c27  ='GaussianModel'
+00020480: 3a0a 2020 2020 2020 2020 2020 2020 6d6f  :.            mo
+00020490: 6465 6c30 3d47 6175 7373 6961 6e4d 6f64  del0=GaussianMod
+000204a0: 656c 2829 0a0a 2020 2020 2020 2020 2320  el()..        # 
+000204b0: 6372 6561 7465 2070 6172 616d 6574 6572  create parameter
+000204c0: 7320 7769 7468 2069 6e69 7469 616c 2076  s with initial v
+000204d0: 616c 7565 730a 2020 2020 2020 2020 7061  alues.        pa
+000204e0: 7273 3020 3d20 6d6f 6465 6c30 2e6d 616b  rs0 = model0.mak
+000204f0: 655f 7061 7261 6d73 2829 0a20 2020 2020  e_params().     
+00020500: 2020 2070 6172 7330 5b27 6365 6e74 6572     pars0['center
+00020510: 275d 2e73 6574 2863 6f6e 6669 672e 6365  '].set(config.ce
+00020520: 6e74 2c20 6d69 6e3d 636f 6e66 6967 2e63  nt, min=config.c
+00020530: 656e 742d 3330 2c20 6d61 783d 636f 6e66  ent-30, max=conf
+00020540: 6967 2e63 656e 742b 3330 290a 2020 2020  ig.cent+30).    
+00020550: 2020 2020 7061 7273 305b 2761 6d70 6c69      pars0['ampli
+00020560: 7475 6465 275d 2e73 6574 2863 6f6e 6669  tude'].set(confi
+00020570: 672e 616d 706c 6974 7564 652c 206d 696e  g.amplitude, min
+00020580: 3d30 290a 0a0a 2020 2020 2020 2020 696e  =0)...        in
+00020590: 6974 3020 3d20 6d6f 6465 6c30 2e65 7661  it0 = model0.eva
+000205a0: 6c28 7061 7273 302c 2078 3d78 290a 2020  l(pars0, x=x).  
+000205b0: 2020 2020 2020 7265 7375 6c74 3020 3d20        result0 = 
+000205c0: 6d6f 6465 6c30 2e66 6974 2879 5f63 6f72  model0.fit(y_cor
+000205d0: 725f 6669 742c 2070 6172 7330 2c20 783d  r_fit, pars0, x=
+000205e0: 7829 0a20 2020 2020 2020 2043 656e 7465  x).        Cente
+000205f0: 725f 7030 3d72 6573 756c 7430 2e62 6573  r_p0=result0.bes
+00020600: 745f 7661 6c75 6573 2e67 6574 2827 6365  t_values.get('ce
+00020610: 6e74 6572 2729 0a20 2020 2020 2020 2061  nter').        a
+00020620: 7265 615f 7030 3d72 6573 756c 7430 2e62  rea_p0=result0.b
+00020630: 6573 745f 7661 6c75 6573 2e67 6574 2827  est_values.get('
+00020640: 616d 706c 6974 7564 6527 290a 0a0a 0a20  amplitude').... 
+00020650: 2020 2020 2020 2023 204d 616b 6520 6120         # Make a 
+00020660: 6e69 6365 206c 696e 7370 6163 6520 666f  nice linspace fo
+00020670: 7220 706c 6f74 7469 6e67 2077 6974 6820  r plotting with 
+00020680: 736d 6f6f 7468 2063 7572 7665 732e 0a20  smooth curves.. 
+00020690: 2020 2020 2020 2078 785f 6361 7262 3d6e         xx_carb=n
+000206a0: 702e 6c69 6e73 7061 6365 286d 696e 2878  p.linspace(min(x
+000206b0: 292c 206d 6178 2878 292c 2032 3030 3029  ), max(x), 2000)
+000206c0: 0a20 2020 2020 2020 2079 5f63 6172 623d  .        y_carb=
+000206d0: 7265 7375 6c74 302e 6576 616c 2878 3d78  result0.eval(x=x
+000206e0: 785f 6361 7262 290a 2020 2020 2020 2020  x_carb).        
+000206f0: 6865 6967 6874 3d6e 702e 6d61 7828 795f  height=np.max(y_
+00020700: 6361 7262 290a 0a20 2020 2020 2020 2023  carb)..        #
+00020710: 204d 6f76 6564 2074 6869 7320 666f 726d   Moved this form
+00020720: 2064 6f77 6e20 6265 6c6f 772c 2074 6869   down below, thi
+00020730: 6e6b 2069 7420 6265 6c6f 6e67 7320 6865  nk it belongs he
+00020740: 7265 0a20 2020 2020 2020 2069 6620 6172  re.        if ar
+00020750: 6561 5f70 3020 6973 204e 6f6e 653a 0a20  ea_p0 is None:. 
+00020760: 2020 2020 2020 2020 2020 2061 7265 615f             area_
+00020770: 7030 3d6e 702e 6e61 6e0a 2020 2020 2020  p0=np.nan.      
+00020780: 2020 2020 2020 6966 2061 7265 615f 7030        if area_p0
+00020790: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000207a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000207b0: 2061 7265 615f 7030 3c30 3a0a 2020 2020   area_p0<0:.    
+000207c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207d0: 6172 6561 5f70 303d 6e70 2e6e 616e 0a0a  area_p0=np.nan..
+000207e0: 0a20 2020 2020 2020 2064 663d 7064 2e44  .        df=pd.D
+000207f0: 6174 6146 7261 6d65 2864 6174 613d 7b27  ataFrame(data={'
+00020800: 6669 6c65 6e61 6d65 273a 2066 696c 656e  filename': filen
+00020810: 616d 652c 0a20 2020 2027 5065 616b 5f43  ame,.    'Peak_C
+00020820: 656e 745f 7b7d 272e 666f 726d 6174 286e  ent_{}'.format(n
+00020830: 616d 6529 3a20 4365 6e74 6572 5f70 302c  ame): Center_p0,
+00020840: 0a20 2020 2027 5065 616b 5f41 7265 615f  .    'Peak_Area_
+00020850: 7b7d 272e 666f 726d 6174 286e 616d 6529  {}'.format(name)
+00020860: 3a20 6172 6561 5f70 302c 0a20 2020 2027  : area_p0,.    '
+00020870: 5065 616b 5f48 6569 6768 745f 7b7d 272e  Peak_Height_{}'.
+00020880: 666f 726d 6174 286e 616d 6529 3a20 6865  format(name): he
+00020890: 6967 6874 2c0a 2020 2020 274d 6f64 656c  ight,.    'Model
+000208a0: 5f6e 616d 6527 3a20 636f 6e66 6967 2e6d  _name': config.m
+000208b0: 6f64 656c 5f6e 616d 657d 2c20 696e 6465  odel_name}, inde
+000208c0: 783d 5b30 5d29 0a0a 2020 2020 656c 7365  x=[0])..    else
+000208d0: 3a0a 0a20 2020 2020 2020 2069 6620 2063  :..        if  c
+000208e0: 6f6e 6669 672e 6d6f 6465 6c5f 6e61 6d65  onfig.model_name
+000208f0: 203d 3d20 2753 706c 696e 6527 3a0a 2020   == 'Spline':.  
+00020900: 2020 2020 2020 2020 2020 6672 6f6d 2073            from s
+00020910: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+00020920: 2069 6d70 6f72 7420 4375 6269 6353 706c   import CubicSpl
+00020930: 696e 650a 2020 2020 2020 2020 2020 2020  ine.            
+00020940: 2320 6669 7420 6120 7370 6c69 6e65 2066  # fit a spline f
+00020950: 6972 7374 2074 6f20 6669 6e64 2069 6e74  irst to find int
+00020960: 656e 7369 7479 2063 7574 206f 6666 0a20  ensity cut off. 
+00020970: 2020 2020 2020 2020 2020 206d 6978 5f73             mix_s
+00020980: 706c 696e 655f 7369 6c20 3d20 696e 7465  pline_sil = inte
+00020990: 7270 3164 2878 5f66 6974 2c20 795f 636f  rp1d(x_fit, y_co
+000209a0: 7272 5f66 6974 2c0a 2020 2020 2020 2020  rr_fit,.        
+000209b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000209c0: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
+000209d0: 3d27 6375 6269 6327 290a 2020 2020 2020  ='cubic').      
+000209e0: 2020 2020 2020 785f 6e65 773d 6e70 2e6c        x_new=np.l
+000209f0: 696e 7370 6163 6528 6e70 2e6d 696e 2878  inspace(np.min(x
+00020a00: 5f66 6974 292c 206e 702e 6d61 7828 785f  _fit), np.max(x_
+00020a10: 6669 7429 2c20 3130 3030 290a 2020 2020  fit), 1000).    
+00020a20: 2020 2020 2020 2020 4261 7365 6c69 6e65          Baseline
+00020a30: 5f79 7375 625f 7369 6c3d 6d69 785f 7370  _ysub_sil=mix_sp
+00020a40: 6c69 6e65 5f73 696c 2878 5f6e 6577 290a  line_sil(x_new).
+00020a50: 0a20 2020 2020 2020 2020 2020 2078 5f6d  .            x_m
+00020a60: 6178 203d 2078 5f6e 6577 5b6e 702e 6172  ax = x_new[np.ar
+00020a70: 676d 6178 2842 6173 656c 696e 655f 7973  gmax(Baseline_ys
+00020a80: 7562 5f73 696c 295d 0a20 2020 2020 2020  ub_sil)].       
+00020a90: 2020 2020 2063 656e 743d 785f 6d61 780a       cent=x_max.
+00020aa0: 2020 2020 2020 2020 2020 2020 5065 616b              Peak
+00020ab0: 5f43 656e 7465 723d 785f 6d61 780a 0a20  _Center=x_max.. 
+00020ac0: 2020 2020 2020 2020 2020 206d 6178 5f79             max_y
+00020ad0: 3d6e 702e 6d61 7828 795f 636f 7272 5f66  =np.max(y_corr_f
+00020ae0: 6974 290a 0a20 2020 2020 2020 2020 2020  it)..           
+00020af0: 2023 204c 6574 7320 7472 696d 2078 2061   # Lets trim x a
+00020b00: 6e64 2079 2062 6173 6564 206f 6e20 696e  nd y based on in
+00020b10: 7465 6e73 6974 7920 7661 6c75 6573 0a20  tensity values. 
+00020b20: 2020 2020 2020 2023 2046 696e 6420 696e         # Find in
+00020b30: 7465 6e73 6974 7920 6375 7420 6f66 660a  tensity cut off.
+00020b40: 2020 2020 2020 2020 2020 2020 696e 745f              int_
+00020b50: 6375 745f 6f66 663d 302e 310a 2020 2020  cut_off=0.1.    
+00020b60: 2020 2020 2020 2020 795f 696e 745f 6375          y_int_cu
+00020b70: 743d 6d61 785f 792a 696e 745f 6375 745f  t=max_y*int_cut_
+00020b80: 6f66 660a 0a20 2020 2020 2020 2020 2020  off..           
+00020b90: 2023 2043 6865 636b 2070 6561 6b20 6973   # Check peak is
+00020ba0: 6e74 2061 7420 6564 6765 206f 6620 7769  nt at edge of wi
+00020bb0: 6e64 6f77 2c20 656c 7365 2077 6f6e 7420  ndow, else wont 
+00020bc0: 776f 726b 0a0a 2020 2020 2020 2020 2020  work..          
+00020bd0: 2020 6966 2050 6561 6b5f 4365 6e74 6572    if Peak_Center
+00020be0: 3d3d 6e70 2e6d 6178 2878 5f66 6974 2920  ==np.max(x_fit) 
+00020bf0: 6f72 2050 6561 6b5f 4365 6e74 6572 3d3d  or Peak_Center==
+00020c00: 6e70 2e6d 696e 2878 5f66 6974 293a 0a20  np.min(x_fit):. 
+00020c10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00020c20: 7269 6e74 2827 7065 616b 2061 7420 6564  rint('peak at ed
+00020c30: 6765 206f 6620 7769 6e64 6f77 2c20 7365  ge of window, se
+00020c40: 7474 696e 6720 7061 7261 6d73 2074 6f20  tting params to 
+00020c50: 6e61 6e73 2729 0a0a 0a0a 2020 2020 2020  nans')....      
+00020c60: 2020 2020 2020 2020 2020 6466 3d70 642e            df=pd.
+00020c70: 4461 7461 4672 616d 6528 6461 7461 3d7b  DataFrame(data={
+00020c80: 2766 696c 656e 616d 6527 3a20 6669 6c65  'filename': file
+00020c90: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+00020ca0: 2020 2750 6561 6b5f 4365 6e74 5f7b 7d27    'Peak_Cent_{}'
+00020cb0: 2e66 6f72 6d61 7428 6e61 6d65 293a 206e  .format(name): n
+00020cc0: 702e 6e61 6e2c 0a20 2020 2020 2020 2020  p.nan,.         
+00020cd0: 2020 2027 5065 616b 5f41 7265 615f 7b7d     'Peak_Area_{}
+00020ce0: 272e 666f 726d 6174 286e 616d 6529 3a20  '.format(name): 
+00020cf0: 6e70 2e6e 616e 2c0a 2020 2020 2020 2020  np.nan,.        
+00020d00: 2020 2020 2750 6561 6b5f 4865 6967 6874      'Peak_Height
+00020d10: 5f7b 7d27 2e66 6f72 6d61 7428 6e61 6d65  _{}'.format(name
+00020d20: 293a 206e 702e 6e61 6e2c 0a20 2020 2020  ): np.nan,.     
+00020d30: 2020 2020 2020 2027 4d6f 6465 6c5f 6e61         'Model_na
+00020d40: 6d65 273a 2063 6f6e 6669 672e 6d6f 6465  me': config.mode
+00020d50: 6c5f 6e61 6d65 7d2c 2069 6e64 6578 3d5b  l_name}, index=[
+00020d60: 305d 290a 0a20 2020 2020 2020 2020 2020  0])..           
+00020d70: 2065 6c73 653a 0a0a 0a0a 2020 2020 2020   else:....      
+00020d80: 2020 2020 2020 2320 5370 6c69 7420 7468        # Split th
+00020d90: 6520 6172 7261 7920 696e 746f 2061 204c  e array into a L
+00020da0: 4853 2061 6e64 2061 2052 4853 0a0a 2020  HS and a RHS..  
+00020db0: 2020 2020 2020 2020 2020 2020 2020 4c48                LH
+00020dc0: 535f 793d 4261 7365 6c69 6e65 5f79 7375  S_y=Baseline_ysu
+00020dd0: 625f 7369 6c5b 785f 6e65 773c 3d50 6561  b_sil[x_new<=Pea
+00020de0: 6b5f 4365 6e74 6572 5d0a 2020 2020 2020  k_Center].      
+00020df0: 2020 2020 2020 2020 2020 5248 535f 793d            RHS_y=
+00020e00: 4261 7365 6c69 6e65 5f79 7375 625f 7369  Baseline_ysub_si
+00020e10: 6c5b 785f 6e65 773e 5065 616b 5f43 656e  l[x_new>Peak_Cen
+00020e20: 7465 725d 0a0a 2020 2020 2020 2020 2020  ter]..          
+00020e30: 2020 2020 2020 4c48 535f 783d 785f 6e65        LHS_x=x_ne
+00020e40: 775b 785f 6e65 773c 3d50 6561 6b5f 4365  w[x_new<=Peak_Ce
+00020e50: 6e74 6572 5d0a 2020 2020 2020 2020 2020  nter].          
+00020e60: 2020 2020 2020 5248 535f 783d 785f 6e65        RHS_x=x_ne
+00020e70: 775b 785f 6e65 773e 5065 616b 5f43 656e  w[x_new>Peak_Cen
+00020e80: 7465 725d 0a0a 2020 2020 2020 2020 2020  ter]..          
+00020e90: 2020 2020 2020 2320 4e65 6564 2074 6f20        # Need to 
+00020ea0: 666c 6970 204c 4853 2074 6f20 7075 7420  flip LHS to put 
+00020eb0: 696e 746f 2074 6865 2066 696e 6420 636c  into the find cl
+00020ec0: 6f73 6573 7420 6675 6e63 7469 6f6e 0a20  osest function. 
+00020ed0: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+00020ee0: 4853 5f79 5f66 6c69 703d 6e70 2e66 6c69  HS_y_flip=np.fli
+00020ef0: 7028 4c48 535f 7929 0a20 2020 2020 2020  p(LHS_y).       
+00020f00: 2020 2020 2020 2020 204c 4853 5f78 5f66           LHS_x_f
+00020f10: 6c69 703d 6e70 2e66 6c69 7028 4c48 535f  lip=np.flip(LHS_
+00020f20: 7829 0a0a 0a20 2020 2020 2020 2020 2020  x)...           
+00020f30: 2020 2020 2076 616c 3d6e 702e 6172 676d       val=np.argm
+00020f40: 6178 284c 4853 5f79 5f66 6c69 703c 795f  ax(LHS_y_flip<y_
+00020f50: 696e 745f 6375 7429 0a0a 2020 2020 2020  int_cut)..      
+00020f60: 2020 2020 2020 2020 2020 7661 6c32 3d6e            val2=n
+00020f70: 702e 6172 676d 6178 2852 4853 5f79 3c79  p.argmax(RHS_y<y
+00020f80: 5f69 6e74 5f63 7574 290a 0a20 2020 2020  _int_cut)..     
+00020f90: 2020 2020 2020 2020 2020 2023 2046 696e             # Fin
+00020fa0: 6420 6e65 6172 6573 7420 7820 756e 6974  d nearest x unit
+00020fb0: 2074 6f20 7468 6973 2076 616c 7565 0a20   to this value. 
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00020fd0: 5f6e 6561 7265 7374 5f4c 4853 3d4c 4853  _nearest_LHS=LHS
+00020fe0: 5f79 5f66 6c69 705b 7661 6c5d 0a20 2020  _y_flip[val].   
+00020ff0: 2020 2020 2020 2020 2020 2020 2078 5f6e               x_n
+00021000: 6561 7265 7374 5f4c 4853 3d4c 4853 5f78  earest_LHS=LHS_x
+00021010: 5f66 6c69 705b 7661 6c5d 0a0a 2020 2020  _flip[val]..    
+00021020: 2020 2020 2020 2020 2020 2020 795f 6e65              y_ne
+00021030: 6172 6573 745f 5248 533d 5248 535f 795b  arest_RHS=RHS_y[
+00021040: 7661 6c32 5d0a 2020 2020 2020 2020 2020  val2].          
+00021050: 2020 2020 2020 785f 6e65 6172 6573 745f        x_nearest_
+00021060: 5248 533d 5248 535f 785b 7661 6c32 5d0a  RHS=RHS_x[val2].
+00021070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021080: 2064 6966 665f 4c48 533d 5065 616b 5f43   diff_LHS=Peak_C
+00021090: 656e 7465 722d 785f 6e65 6172 6573 745f  enter-x_nearest_
+000210a0: 4c48 530a 2020 2020 2020 2020 2020 2020  LHS.            
+000210b0: 2020 2020 6469 6666 5f52 4853 3d78 5f6e      diff_RHS=x_n
+000210c0: 6561 7265 7374 5f52 4853 2d50 6561 6b5f  earest_RHS-Peak_
+000210d0: 4365 6e74 6572 0a0a 0a0a 2020 2020 2020  Center....      
+000210e0: 2020 2020 2020 2020 2020 6e5f 7265 733d            n_res=
+000210f0: 330a 2020 2020 2020 2020 2020 2020 2020  3.              
+00021100: 2020 785f 6e65 775f 736b 6577 6e65 7373    x_new_skewness
+00021110: 3d6e 702e 6c69 6e73 7061 6365 2878 5f6e  =np.linspace(x_n
+00021120: 6561 7265 7374 5f4c 4853 2d73 7065 635f  earest_LHS-spec_
+00021130: 7265 732a 6e5f 7265 732c 2078 5f6e 6561  res*n_res, x_nea
+00021140: 7265 7374 5f52 4853 2b73 7065 635f 7265  rest_RHS+spec_re
+00021150: 732a 6e5f 7265 7329 0a0a 2020 2020 2020  s*n_res)..      
+00021160: 2020 2020 2020 2020 2020 785f 6e65 773d            x_new=
+00021170: 785f 6e65 775f 736b 6577 6e65 7373 0a0a  x_new_skewness..
+00021180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021190: 2042 6173 656c 696e 655f 7973 7562 5f73   Baseline_ysub_s
+000211a0: 696c 3d6d 6978 5f73 706c 696e 655f 7369  il=mix_spline_si
+000211b0: 6c28 785f 6e65 775f 736b 6577 6e65 7373  l(x_new_skewness
+000211c0: 290a 0a0a 0a0a 0a0a 2020 2020 2020 2020  ).......        
+000211d0: 2020 2020 2020 2020 4e5f 706f 6c79 5f73          N_poly_s
+000211e0: 696c 3d27 5370 6c69 6e65 270a 0a0a 2020  il='Spline'...  
+000211f0: 2020 2020 2020 2020 2020 2020 2020 7873                xs
+00021200: 7061 6365 5f73 696c 3d78 5f6e 6577 5b31  pace_sil=x_new[1
+00021210: 5d2d 785f 6e65 775b 305d 0a20 2020 2020  ]-x_new[0].     
+00021220: 2020 2020 2020 2020 2020 2061 7265 615f             area_
+00021230: 7472 6170 203d 2074 7261 707a 2842 6173  trap = trapz(Bas
+00021240: 656c 696e 655f 7973 7562 5f73 696c 2c20  eline_ysub_sil, 
+00021250: 6478 3d78 7370 6163 655f 7369 6c29 0a20  dx=xspace_sil). 
+00021260: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00021270: 7265 615f 7369 6d70 7320 3d20 7369 6d70  rea_simps = simp
+00021280: 7328 4261 7365 6c69 6e65 5f79 7375 625f  s(Baseline_ysub_
+00021290: 7369 6c2c 2064 783d 7873 7061 6365 5f73  sil, dx=xspace_s
+000212a0: 696c 290a 0a0a 0a20 2020 2020 2020 2020  il)....         
+000212b0: 2020 2020 2020 2061 7265 615f 7030 3d61         area_p0=a
+000212c0: 7265 615f 7472 6170 0a0a 0a0a 0a20 2020  rea_trap.....   
+000212d0: 2020 2020 2020 2020 2020 2020 2064 663d               df=
+000212e0: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+000212f0: 613d 7b27 6669 6c65 6e61 6d65 273a 2066  a={'filename': f
+00021300: 696c 656e 616d 652c 0a20 2020 2020 2020  ilename,.       
+00021310: 2020 2020 2027 5065 616b 5f43 656e 745f       'Peak_Cent_
+00021320: 7b7d 272e 666f 726d 6174 286e 616d 6529  {}'.format(name)
+00021330: 3a20 785f 6d61 782c 0a20 2020 2020 2020  : x_max,.       
+00021340: 2020 2020 2027 5065 616b 5f41 7265 615f       'Peak_Area_
+00021350: 7b7d 272e 666f 726d 6174 286e 616d 6529  {}'.format(name)
+00021360: 3a20 6172 6561 5f70 302c 0a20 2020 2020  : area_p0,.     
+00021370: 2020 2020 2020 2027 5065 616b 5f48 6569         'Peak_Hei
+00021380: 6768 745f 7b7d 272e 666f 726d 6174 286e  ght_{}'.format(n
+00021390: 616d 6529 3a20 6d61 785f 792c 0a20 2020  ame): max_y,.   
+000213a0: 2020 2020 2020 2020 2027 4d6f 6465 6c5f           'Model_
+000213b0: 6e61 6d65 273a 2063 6f6e 6669 672e 6d6f  name': config.mo
+000213c0: 6465 6c5f 6e61 6d65 7d2c 2069 6e64 6578  del_name}, index
+000213d0: 3d5b 305d 290a 0a0a 0a0a 0a0a 2020 2020  =[0]).......    
+000213e0: 2320 506c 6f74 7469 6e67 2077 6861 7420  # Plotting what 
+000213f0: 6974 7320 646f 696e 670a 0a20 2020 2069  its doing..    i
+00021400: 6620 706c 6f74 5f66 6967 7572 6520 6973  f plot_figure is
+00021410: 2054 7275 653a 0a20 2020 2020 2020 2066   True:.        f
+00021420: 6967 2c20 2861 7831 2c20 6178 3229 203d  ig, (ax1, ax2) =
+00021430: 2070 6c74 2e73 7562 706c 6f74 7328 312c   plt.subplots(1,
+00021440: 2032 2c20 6669 6773 697a 653d 2831 302c   2, figsize=(10,
+00021450: 3529 290a 2020 2020 2020 2020 6669 672e  5)).        fig.
+00021460: 7375 7074 6974 6c65 2827 5365 636f 6e64  suptitle('Second
+00021470: 6172 7920 5068 6173 652c 2066 696c 653d  ary Phase, file=
+00021480: 2027 2b20 7374 7228 6669 6c65 6e61 6d65   '+ str(filename
+00021490: 292c 2066 6f6e 7473 697a 653d 3132 2c20  ), fontsize=12, 
+000214a0: 783d 302e 352c 2079 3d31 2e30 290a 0a20  x=0.5, y=1.0).. 
+000214b0: 2020 2020 2020 2023 2050 6c6f 7420 7468         # Plot th
+000214c0: 6520 7065 616b 2070 6f73 6974 696f 6e73  e peak positions
+000214d0: 2061 6e64 2068 6569 6768 7473 0a0a 0a0a   and heights....
+000214e0: 2020 2020 2020 2020 6178 312e 7365 745f          ax1.set_
+000214f0: 7469 746c 6528 2742 6163 6b67 726f 756e  title('Backgroun
+00021500: 6420 6669 7427 290a 0a20 2020 2020 2020  d fit')..       
+00021510: 2061 7831 2e70 6c6f 7428 5370 6563 7472   ax1.plot(Spectr
+00021520: 615f 706c 6f74 5b3a 2c20 305d 2c20 5370  a_plot[:, 0], Sp
+00021530: 6563 7472 615f 706c 6f74 5b3a 2c20 315d  ectra_plot[:, 1]
+00021540: 2c20 272d 7227 2c20 6c61 6265 6c3d 2753  , '-r', label='S
+00021550: 7065 6374 7261 2729 0a20 2020 2020 2020  pectra').       
+00021560: 2061 7831 2e70 6c6f 7428 5248 5f62 6173   ax1.plot(RH_bas
+00021570: 656c 696e 655f 6669 6c74 5b3a 2c20 305d  eline_filt[:, 0]
+00021580: 2c20 5248 5f62 6173 656c 696e 655f 6669  , RH_baseline_fi
+00021590: 6c74 5b3a 2c20 315d 2c20 272e 6227 2c0a  lt[:, 1], '.b',.
+000215a0: 2020 2020 2020 2020 6c61 6265 6c3d 2762          label='b
+000215b0: 636b 2070 6f69 6e74 7327 290a 2020 2020  ck points').    
+000215c0: 2020 2020 6178 312e 706c 6f74 284c 485f      ax1.plot(LH_
+000215d0: 6261 7365 6c69 6e65 5f66 696c 745b 3a2c  baseline_filt[:,
+000215e0: 2030 5d2c 204c 485f 6261 7365 6c69 6e65   0], LH_baseline
+000215f0: 5f66 696c 745b 3a2c 2031 5d2c 2027 2d62  _filt[:, 1], '-b
+00021600: 272c 0a20 2020 2020 2020 206c 773d 332c  ',.        lw=3,
+00021610: 206c 6162 656c 3d27 5f62 636b 2070 6f69   label='_bck poi
+00021620: 6e74 7327 290a 0a20 2020 2020 2020 2023  nts')..        #
+00021630: 6178 322e 706c 6f74 2878 2c20 795f 636f  ax2.plot(x, y_co
+00021640: 7272 5f66 6974 2c20 272d 7227 2c20 6c61  rr_fit, '-r', la
+00021650: 6265 6c3d 2742 636b 2d73 7562 2064 6174  bel='Bck-sub dat
+00021660: 6127 2c20 6c77 3d30 2e35 290a 2020 2020  a', lw=0.5).    
+00021670: 2020 2020 6178 322e 706c 6f74 2878 2c20      ax2.plot(x, 
+00021680: 795f 636f 7272 5f66 6974 2c20 272e 7227  y_corr_fit, '.r'
+00021690: 2c20 6c61 6265 6c3d 2742 636b 2d73 7562  , label='Bck-sub
+000216a0: 2064 6174 6127 290a 2020 2020 2020 2020   data').        
+000216b0: 6178 312e 706c 6f74 2853 7065 6374 7261  ax1.plot(Spectra
+000216c0: 5f73 686f 7274 5b3a 2c20 305d 2c20 5079  _short[:, 0], Py
+000216d0: 5f62 6173 652c 2027 2d6b 272c 206c 6162  _base, '-k', lab
+000216e0: 656c 3d27 4263 6b20 506f 6c79 2729 0a0a  el='Bck Poly')..
+000216f0: 0a20 2020 2020 2020 2069 6620 636f 6e66  .        if conf
+00021700: 6967 2e6d 6f64 656c 5f6e 616d 6520 213d  ig.model_name !=
+00021710: 2027 5370 6c69 6e65 2720 616e 6420 636f   'Spline' and co
+00021720: 6e66 6967 2e6d 6f64 656c 5f6e 616d 6520  nfig.model_name 
+00021730: 213d 2027 506f 6c79 273a 0a20 2020 2020  != 'Poly':.     
+00021740: 2020 2020 2020 2061 7832 2e70 6c6f 7428         ax2.plot(
+00021750: 7878 5f63 6172 622c 2079 5f63 6172 622c  xx_carb, y_carb,
+00021760: 2027 2d6b 272c 206c 6162 656c 3d27 5065   '-k', label='Pe
+00021770: 616b 2066 6974 2729 0a20 2020 2020 2020  ak fit').       
+00021780: 2020 2020 2063 656e 743d 6466 5b27 5065       cent=df['Pe
+00021790: 616b 5f43 656e 745f 7b7d 272e 666f 726d  ak_Cent_{}'.form
+000217a0: 6174 286e 616d 6529 5d2e 696c 6f63 5b30  at(name)].iloc[0
+000217b0: 5d0a 2020 2020 2020 2020 2020 2020 6178  ].            ax
+000217c0: 322e 7365 745f 786c 696d 285b 6365 6e74  2.set_xlim([cent
+000217d0: 2d63 6f6e 6669 672e 785f 7261 6e67 655f  -config.x_range_
+000217e0: 6263 6b2c 2063 656e 742b 636f 6e66 6967  bck, cent+config
+000217f0: 2e78 5f72 616e 6765 5f62 636b 5d29 0a20  .x_range_bck]). 
+00021800: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00021810: 2020 2020 2020 2020 2061 7832 2e70 6c6f           ax2.plo
+00021820: 7428 785f 6e65 772c 2042 6173 656c 696e  t(x_new, Baselin
+00021830: 655f 7973 7562 5f73 696c 2c20 272d 6b27  e_ysub_sil, '-k'
+00021840: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
+00021850: 322e 6669 6c6c 5f62 6574 7765 656e 2878  2.fill_between(x
+00021860: 5f6e 6577 2c20 4261 7365 6c69 6e65 5f79  _new, Baseline_y
+00021870: 7375 625f 7369 6c2c 2063 6f6c 6f72 3d27  sub_sil, color='
+00021880: 7965 6c6c 6f77 272c 206c 6162 656c 3d27  yellow', label='
+00021890: 6669 7427 2c20 616c 7068 613d 302e 3529  fit', alpha=0.5)
+000218a0: 0a0a 0a20 2020 2020 2020 2061 7832 2e73  ...        ax2.s
+000218b0: 6574 5f74 6974 6c65 2827 426b 672d 7375  et_title('Bkg-su
+000218c0: 6274 7261 6374 6564 2c20 2720 2b20 6e61  btracted, ' + na
+000218d0: 6d65 202b 2027 2070 6561 6b20 6669 7427  me + ' peak fit'
+000218e0: 290a 0a0a 0a0a 0a0a 0a0a 2020 2020 2320  ).........    # 
+000218f0: 6178 322e 7365 745f 796c 696d 285b 6d69  ax2.set_ylim([mi
+00021900: 6e28 795f 6361 7262 292d 302e 352a 286d  n(y_carb)-0.5*(m
+00021910: 6178 2879 5f63 6172 6229 2d6d 696e 2879  ax(y_carb)-min(y
+00021920: 5f63 6172 6229 292c 0a20 2020 2023 2020  _carb)),.    #  
+00021930: 2020 2020 2020 2020 2020 206d 6178 2879             max(y
+00021940: 5f63 6172 6229 2b30 2e31 2a6d 6178 2879  _carb)+0.1*max(y
+00021950: 5f63 6172 6229 2c0a 2020 2020 2320 5d29  _carb),.    # ])
+00021960: 0a0a 0a0a 2020 2020 2020 2020 6966 2066  ....        if f
+00021970: 696e 645f 7065 616b 7320 6973 2054 7275  ind_peaks is Tru
+00021980: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00021990: 6178 312e 706c 6f74 2864 665f 7065 616b  ax1.plot(df_peak
+000219a0: 5f73 6f72 745f 7368 6f72 745b 2770 6f73  _sort_short['pos
+000219b0: 275d 2c20 6466 5f70 6561 6b5f 736f 7274  '], df_peak_sort
+000219c0: 5f73 686f 7274 5b27 6865 6967 6874 275d  _short['height']
+000219d0: 2c20 272a 6b27 2c20 6d66 633d 2779 656c  , '*k', mfc='yel
+000219e0: 6c6f 7727 2c20 6c61 6265 6c3d 2753 6369  low', label='Sci
+000219f0: 5079 2050 6561 6b73 2729 0a20 2020 2020  Py Peaks').     
+00021a00: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
+00021a10: 5370 6563 7472 615f 7368 6f72 745b 3a2c  Spectra_short[:,
+00021a20: 2030 5d2c 2050 795f 6261 7365 2c20 272d   0], Py_base, '-
+00021a30: 6b27 290a 0a20 2020 2020 2020 2061 7831  k')..        ax1
+00021a40: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+00021a50: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+00021a60: 2061 7831 2e73 6574 5f78 6c61 6265 6c28   ax1.set_xlabel(
+00021a70: 2757 6176 656e 756d 6265 7220 2863 6d24  'Wavenumber (cm$
+00021a80: 5e7b 2d31 7d24 2927 290a 2020 2020 2020  ^{-1}$)').      
+00021a90: 2020 6178 322e 7365 745f 796c 6162 656c    ax2.set_ylabel
+00021aa0: 2827 4263 6b2d 636f 7272 6563 7465 6420  ('Bck-corrected 
+00021ab0: 496e 7465 6e73 6974 7927 290a 2020 2020  Intensity').    
+00021ac0: 2020 2020 6178 322e 7365 745f 786c 6162      ax2.set_xlab
+00021ad0: 656c 2827 5761 7665 6e75 6d62 6572 2028  el('Wavenumber (
+00021ae0: 636d 245e 7b2d 317d 2429 2729 0a0a 2020  cm$^{-1}$)')..  
+00021af0: 2020 2020 2020 6178 312e 6c65 6765 6e64        ax1.legend
+00021b00: 2829 0a20 2020 2020 2020 2061 7832 2e6c  ().        ax2.l
+00021b10: 6567 656e 6428 290a 0a20 2020 2020 2020  egend()..       
+00021b20: 2061 7831 2e73 6574 5f79 6c69 6d28 5b0a   ax1.set_ylim([.
+00021b30: 2020 2020 2020 2020 6e70 2e6d 696e 2853          np.min(S
+00021b40: 7065 6374 7261 5f70 6c6f 745b 3a2c 2031  pectra_plot[:, 1
+00021b50: 5d29 2d35 302c 0a20 2020 2020 2020 206e  ])-50,.        n
+00021b60: 702e 6d61 7828 5370 6563 7472 615f 706c  p.max(Spectra_pl
+00021b70: 6f74 5b3a 2c20 315d 292b 3530 0a20 2020  ot[:, 1])+50.   
+00021b80: 2020 2020 205d 290a 0a0a 0a0a 0a0a 2020       ]).......  
+00021b90: 2020 2020 2020 6669 6c65 3d66 696c 656e        file=filen
+00021ba0: 616d 652e 7273 706c 6974 2827 2e74 7874  ame.rsplit('.txt
+00021bb0: 272c 2031 295b 305d 0a20 2020 2020 2020  ', 1)[0].       
+00021bc0: 2069 6620 706c 6f74 5f66 6967 7572 6520   if plot_figure 
+00021bd0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+00021be0: 2020 2020 2070 6174 6833 3d70 6174 682b       path3=path+
+00021bf0: 272f 272b 2753 6563 6f6e 6461 7279 5f66  '/'+'Secondary_f
+00021c00: 6974 5f49 6d61 6765 7327 0a0a 2020 2020  it_Images'..    
+00021c10: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00021c20: 7468 2e65 7869 7374 7328 7061 7468 3329  th.exists(path3)
+00021c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021c40: 2020 6f75 743d 2770 6174 6820 6578 6973    out='path exis
+00021c50: 7473 270a 2020 2020 2020 2020 2020 2020  ts'.            
+00021c60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021c70: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00021c80: 7328 7061 7468 332c 2065 7869 7374 5f6f  s(path3, exist_o
+00021c90: 6b3d 4661 6c73 6529 0a0a 2020 2020 2020  k=False)..      
+00021ca0: 2020 2020 2020 6669 6c65 3d66 696c 656e        file=filen
+00021cb0: 616d 652e 7273 706c 6974 2827 2e74 7874  ame.rsplit('.txt
+00021cc0: 272c 2031 295b 305d 0a20 2020 2020 2020  ', 1)[0].       
+00021cd0: 2020 2020 2066 6967 2e73 6176 6566 6967       fig.savefig
+00021ce0: 2870 6174 6833 2b27 2f27 2b20 6e61 6d65  (path3+'/'+ name
+00021cf0: 202b 275f 4669 745f 7b7d 2e70 6e67 272e   +'_Fit_{}.png'.
+00021d00: 666f 726d 6174 2866 696c 6529 2c20 6470  format(file), dp
+00021d10: 693d 6470 6929 0a0a 0a0a 2020 2020 6966  i=dpi)....    if
+00021d20: 2063 6f6e 6669 672e 7265 7475 726e 5f6f   config.return_o
+00021d30: 7468 6572 5f70 6172 616d 7320 6973 2054  ther_params is T
+00021d40: 7275 653a 0a20 2020 2020 2020 2072 6574  rue:.        ret
+00021d50: 7572 6e20 6466 2c20 7878 5f63 6172 622c  urn df, xx_carb,
+00021d60: 2079 5f63 6172 622c 2072 6573 756c 7430   y_carb, result0
+00021d70: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00021d80: 2020 2072 6574 7572 6e20 6466 0a0a 0a0a     return df....
+00021d90: 0a23 2050 6c6f 7474 696e 6720 7570 2073  .# Plotting up s
+00021da0: 6563 6f6e 6461 7279 2070 6561 6b73 0a0a  econdary peaks..
+00021db0: 6672 6f6d 2073 6369 7079 2e73 6967 6e61  from scipy.signa
+00021dc0: 6c20 696d 706f 7274 2066 696e 645f 7065  l import find_pe
+00021dd0: 616b 730a 6465 6620 706c 6f74 5f73 6563  aks.def plot_sec
+00021de0: 6f6e 6461 7279 5f70 6561 6b73 282a 2c20  ondary_peaks(*, 
+00021df0: 4469 6164 5f46 696c 6573 2c20 7061 7468  Diad_Files, path
+00021e00: 2c20 6669 6c65 7479 7065 2c0a 2020 2020  , filetype,.    
+00021e10: 2020 2020 786c 696d 5f70 6c6f 743d 5b31      xlim_plot=[1
+00021e20: 3034 302c 2031 3230 305d 2c20 786c 696d  040, 1200], xlim
+00021e30: 5f70 6561 6b73 3d5b 3130 3630 2c20 3131  _peaks=[1060, 11
+00021e40: 3030 5d2c 0a20 2020 2020 2020 2068 6569  00],.        hei
+00021e50: 6768 743d 3130 302c 2074 6872 6573 686f  ght=100, thresho
+00021e60: 6c64 3d30 2e31 2c20 6469 7374 616e 6365  ld=0.1, distance
+00021e70: 3d31 302c 2070 726f 6d69 6e65 6e63 653d  =10, prominence=
+00021e80: 352c 2077 6964 7468 3d36 2c0a 2020 2020  5, width=6,.    
+00021e90: 2020 2020 2073 6967 6d61 5f66 696c 7465       sigma_filte
+00021ea0: 723d 4661 6c73 652c 2073 6967 6d61 3d33  r=False, sigma=3
+00021eb0: 2c20 6669 6e64 5f70 6561 6b73 5f66 696c  , find_peaks_fil
+00021ec0: 7465 723d 4661 6c73 652c 206a 7573 745f  ter=False, just_
+00021ed0: 706c 6f74 3d46 616c 7365 2c20 7973 6361  plot=False, ysca
+00021ee0: 6c65 3d30 2e32 293a 0a0a 2020 2020 2222  le=0.2):..    ""
+00021ef0: 2220 5468 6973 2066 756e 6374 696f 6e20  " This function 
+00021f00: 706c 6f74 7320 7370 6563 7472 6120 7374  plots spectra st
+00021f10: 6163 6b65 6420 7665 7274 6963 616c 6c79  acked vertically
+00021f20: 206f 6e74 6f70 206f 6620 6561 6368 206f   ontop of each o
+00021f30: 7468 6572 2c20 696e 2061 2073 7065 6369  ther, in a speci
+00021f40: 6669 6320 7265 6769 6f6e 2e0a 2020 2020  fic region..    
+00021f50: 4974 2061 6c73 6f20 6964 656e 7469 6669  It also identifi
+00021f60: 6573 2070 6561 6b20 706f 7369 7469 6f6e  es peak position
+00021f70: 730a 0a20 2020 2050 6172 616d 6574 6572  s..    Parameter
+00021f80: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00021f90: 2d2d 2d2d 2d0a 2020 2020 4469 6164 5f46  -----.    Diad_F
+00021fa0: 696c 6573 3a20 6c69 7374 0a20 2020 2020  iles: list.     
+00021fb0: 2020 204c 6973 7420 6f66 2066 696c 656e     List of filen
+00021fc0: 616d 6573 2074 6f20 706c 6f74 0a0a 2020  ames to plot..  
+00021fd0: 2020 7061 7468 3a20 7374 720a 2020 2020    path: str.    
+00021fe0: 2020 2020 5061 7468 2077 6865 7265 2073      Path where s
+00021ff0: 7065 6374 7261 2061 7265 2073 746f 7265  pectra are store
+00022000: 640a 0a20 2020 2066 696c 6574 7970 653a  d..    filetype:
+00022010: 2073 7472 0a20 2020 2020 2020 2043 686f   str.        Cho
+00022020: 6f73 6520 6672 6f6d 2027 5769 7465 635f  ose from 'Witec_
+00022030: 4153 4349 4927 2c20 2768 6561 646c 6573  ASCII', 'headles
+00022040: 735f 7478 7427 2c20 2768 6561 646c 6573  s_txt', 'headles
+00022050: 735f 6373 7627 2c20 2768 6561 645f 6373  s_csv', 'head_cs
+00022060: 7627 2c20 2757 6974 6563 5f41 5343 4949  v', 'Witec_ASCII
+00022070: 272c 0a20 2020 2020 2020 2027 484f 5249  ',.        'HORI
+00022080: 4241 5f74 7874 272c 2027 5265 6e69 7368  BA_txt', 'Renish
+00022090: 6177 5f74 7874 270a 0a20 2020 2078 6c69  aw_txt'..    xli
+000220a0: 6d5f 706c 6f74 3a20 5475 706c 655b 666c  m_plot: Tuple[fl
+000220b0: 6f61 742c 2066 6c6f 6174 5d0a 2020 2020  oat, float].    
+000220c0: 2020 2020 5261 6e67 6520 6f66 2078 2063      Range of x c
+000220d0: 6f6f 7264 696e 6174 6573 2074 6f20 6d61  oordinates to ma
+000220e0: 6b65 2070 6c6f 7420 6f76 6572 0a0a 2020  ke plot over..  
+000220f0: 2020 786c 696d 5f70 6561 6b73 3a20 5475    xlim_peaks: Tu
+00022100: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
+00022110: 5d0a 2020 2020 2020 2020 5261 6e67 6520  ].        Range 
+00022120: 6f66 2078 2063 6f6f 7264 696e 6174 6573  of x coordinates
+00022130: 2074 6f20 7365 6172 6368 2066 6f72 2070   to search for p
+00022140: 6561 6b73 206f 7665 720a 0a20 2020 2043  eaks over..    C
+00022150: 686f 6f73 6520 6f6e 6520 746f 2062 6520  hoose one to be 
+00022160: 5472 7565 2066 726f 6d3a 0a0a 2020 2020  True from:..    
+00022170: 7369 676d 615f 6669 6c74 6572 3a20 626f  sigma_filter: bo
+00022180: 6f6c 0a20 2020 2020 2020 2069 6620 5472  ol.        if Tr
+00022190: 7565 2c20 6669 6e64 7320 6d61 7820 7920  ue, finds max y 
+000221a0: 636f 6f72 6469 6e61 7465 2069 6e20 7370  coordinate in sp
+000221b0: 6563 7472 612e 2049 6620 6974 7320 6d6f  ectra. If its mo
+000221c0: 7265 2074 6861 6e20 7369 676d 612a 7374  re than sigma*st
+000221d0: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
+000221e0: 7320 6162 6f76 6520 7468 650a 2020 2020  s above the.    
+000221f0: 2020 2020 6d65 6469 616e 2c20 6974 2069      median, it i
+00022200: 7320 636c 6173 7369 6669 6564 2061 7320  s classified as 
+00022210: 6120 7065 616b 2e0a 0a20 2020 2066 696e  a peak...    fin
+00022220: 645f 7065 616b 735f 6669 6c74 6572 3a20  d_peaks_filter: 
+00022230: 626f 6f6c 0a0a 2020 2020 2020 2020 6966  bool..        if
+00022240: 2054 7275 652c 2075 7365 7320 7363 6970   True, uses scip
+00022250: 7920 6669 6e64 2070 6561 6b73 2074 6f20  y find peaks to 
+00022260: 6669 6e64 2070 6561 6b73 2e20 4361 6e20  find peaks. Can 
+00022270: 7477 6561 6b20 6469 7374 616e 6365 2c20  tweak distance, 
+00022280: 7072 6f6d 696e 656e 6365 2c20 7769 6474  prominence, widt
+00022290: 682c 0a20 2020 2020 2020 2074 6872 6573  h,.        thres
+000222a0: 686f 6c64 2c20 616e 6420 6865 6967 6874  hold, and height
+000222b0: 2e0a 0a20 2020 206a 7573 745f 706c 6f74  ...    just_plot
+000222c0: 3a20 626f 6f6c 0a20 2020 2020 2020 2069  : bool.        i
+000222d0: 6620 5472 7565 2c20 6a75 7374 2070 6c6f  f True, just plo
+000222e0: 7473 2073 7065 6374 7261 2c20 646f 6573  ts spectra, does
+000222f0: 6e74 2074 7279 2074 6f20 6669 6e64 2070  nt try to find p
+00022300: 6561 6b73 0a0a 2020 2020 795f 7363 616c  eaks..    y_scal
+00022310: 653a 2066 6c6f 6174 0a20 2020 2020 2020  e: float.       
+00022320: 2046 6967 7572 6520 7369 7a65 2069 7320   Figure size is 
+00022330: 322b 795f 7363 616c 6520 2a20 6e75 6d62  2+y_scale * numb
+00022340: 6572 206f 6620 7370 6563 7472 610a 0a20  er of spectra.. 
+00022350: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+00022360: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+00022370: 2064 665f 7065 616b 732c 2078 5f64 6174   df_peaks, x_dat
+00022380: 612c 2079 5f64 6174 612c 2066 6967 0a0a  a, y_data, fig..
+00022390: 2020 2020 6466 5f70 6561 6b73 3a20 7064      df_peaks: pd
+000223a0: 2e44 6174 6146 7261 6d65 2066 6f72 2065  .DataFrame for e
+000223b0: 6163 6820 6669 6c65 206f 6620 7065 616b  ach file of peak
+000223c0: 2070 6f73 6974 696f 6e2c 2068 6569 6768   position, heigh
+000223d0: 742c 2070 726f 6d69 6e65 6e63 6520 616e  t, prominence an
+000223e0: 6420 6669 6c65 206e 616d 652e 2046 696c  d file name. Fil
+000223f0: 6c65 6420 7769 7468 204e 616e 7320 6966  led with Nans if
+00022400: 2064 6964 6e74 2066 696e 6420 6120 7065   didnt find a pe
+00022410: 616b 0a20 2020 2078 5f64 6174 613a 206e  ak.    x_data: n
+00022420: 702e 6172 7261 7920 6f66 2078 2063 6f6f  p.array of x coo
+00022430: 7264 696e 6174 6573 2028 4173 7375 6d65  rdinates (Assume
+00022440: 7320 7468 6520 7361 6d65 2066 6f72 2061  s the same for a
+00022450: 6c6c 2066 696c 6573 290a 2020 2020 795f  ll files).    y_
+00022460: 6461 7461 3a20 6e70 2e61 7272 6179 206f  data: np.array o
+00022470: 6620 7920 636f 6f72 6469 6e61 7465 7320  f y coordinates 
+00022480: 6f66 2065 6163 6820 7370 6563 7472 610a  of each spectra.
+00022490: 2020 2020 6669 673a 2066 6967 7572 6520      fig: figure 
+000224a0: 6974 2068 6173 2070 6c6f 7474 6564 0a0a  it has plotted..
+000224b0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+000224c0: 7369 676d 615f 6669 6c74 6572 2069 7320  sigma_filter is 
+000224d0: 5472 7565 2061 6e64 2028 6669 6e64 5f70  True and (find_p
+000224e0: 6561 6b73 5f66 696c 7465 7220 6973 2054  eaks_filter is T
+000224f0: 7275 6520 6f72 206a 7573 745f 706c 6f74  rue or just_plot
+00022500: 2069 7320 5472 7565 293a 0a20 2020 2020   is True):.     
+00022510: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00022520: 6f72 2827 4f6e 6c79 206f 6e65 206f 6620  or('Only one of 
+00022530: 7369 676d 615f 6669 6c74 6572 2c20 696e  sigma_filter, in
+00022540: 645f 7065 616b 735f 6669 6c74 6572 2061  d_peaks_filter a
+00022550: 6e64 206a 7573 745f 706c 6f74 2063 616e  nd just_plot can
+00022560: 2062 6520 5472 7565 2729 0a20 2020 2066   be True').    f
+00022570: 6967 2c20 2861 7831 2920 3d20 706c 742e  ig, (ax1) = plt.
+00022580: 7375 6270 6c6f 7473 2831 2c20 312c 2066  subplots(1, 1, f
+00022590: 6967 7369 7a65 3d28 3130 2c32 2b79 7363  igsize=(10,2+ysc
+000225a0: 616c 652a 6c65 6e28 4469 6164 5f46 696c  ale*len(Diad_Fil
+000225b0: 6573 2929 290a 0a20 2020 2069 3d30 0a20  es)))..    i=0. 
+000225c0: 2020 2059 3d30 0a20 2020 2070 6561 6b5f     Y=0.    peak_
+000225d0: 706f 735f 7361 7665 643d 6e70 2e65 6d70  pos_saved=np.emp
+000225e0: 7479 286c 656e 2844 6961 645f 4669 6c65  ty(len(Diad_File
+000225f0: 7329 2c20 6474 7970 653d 666c 6f61 7429  s), dtype=float)
+00022600: 0a0a 2020 2020 7065 616b 5f68 6569 6768  ..    peak_heigh
+00022610: 745f 7361 7665 643d 6e70 2e65 6d70 7479  t_saved=np.empty
+00022620: 286c 656e 2844 6961 645f 4669 6c65 7329  (len(Diad_Files)
+00022630: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
+00022640: 2020 2070 6561 6b5f 6263 6b3d 6e70 2e65     peak_bck=np.e
+00022650: 6d70 7479 286c 656e 2844 6961 645f 4669  mpty(len(Diad_Fi
+00022660: 6c65 7329 2c20 6474 7970 653d 666c 6f61  les), dtype=floa
+00022670: 7429 0a20 2020 2079 5f73 7461 723d 6e70  t).    y_star=np
+00022680: 2e65 6d70 7479 286c 656e 2844 6961 645f  .empty(len(Diad_
+00022690: 4669 6c65 7329 2c20 6474 7970 653d 666c  Files), dtype=fl
+000226a0: 6f61 7429 0a20 2020 2079 706c 6f74 3d6e  oat).    yplot=n
+000226b0: 702e 656d 7074 7928 6c65 6e28 4469 6164  p.empty(len(Diad
+000226c0: 5f46 696c 6573 292c 2064 7479 7065 3d66  _Files), dtype=f
+000226d0: 6c6f 6174 290a 2020 2020 4469 6164 5f64  loat).    Diad_d
+000226e0: 663d 6765 745f 6461 7461 2870 6174 683d  f=get_data(path=
+000226f0: 7061 7468 2c20 6669 6c65 6e61 6d65 3d44  path, filename=D
+00022700: 6961 645f 4669 6c65 735b 305d 2c20 6669  iad_Files[0], fi
+00022710: 6c65 7479 7065 3d66 696c 6574 7970 6529  letype=filetype)
+00022720: 0a20 2020 2078 5f64 6174 613d 4469 6164  .    x_data=Diad
+00022730: 5f64 665b 3a2c 2030 5d0a 2020 2020 795f  _df[:, 0].    y_
+00022740: 6461 7461 3d6e 702e 656d 7074 7928 5b20  data=np.empty([ 
+00022750: 206c 656e 2878 5f64 6174 6129 2c20 6c65   len(x_data), le
+00022760: 6e28 4469 6164 5f46 696c 6573 295d 2c20  n(Diad_Files)], 
+00022770: 666c 6f61 7429 0a0a 0a20 2020 2066 6f72  float)...    for
+00022780: 2066 696c 6520 696e 2044 6961 645f 4669   file in Diad_Fi
+00022790: 6c65 733a 0a0a 0a0a 0a20 2020 2020 2020  les:.....       
+000227a0: 2044 6961 645f 6466 3d67 6574 5f64 6174   Diad_df=get_dat
+000227b0: 6128 7061 7468 3d70 6174 682c 2066 696c  a(path=path, fil
+000227c0: 656e 616d 653d 6669 6c65 2c20 6669 6c65  ename=file, file
+000227d0: 7479 7065 3d66 696c 6574 7970 6529 0a20  type=filetype). 
+000227e0: 2020 2020 2020 2044 6961 643d 6e70 2e61         Diad=np.a
+000227f0: 7272 6179 2844 6961 645f 6466 290a 0a0a  rray(Diad_df)...
+00022800: 2020 2020 2020 2020 2320 4669 7273 7420          # First 
+00022810: 6c65 7473 2075 7365 2066 696e 6420 7065  lets use find pe
+00022820: 616b 730a 2020 2020 2020 2020 793d 4469  aks.        y=Di
+00022830: 6164 5b3a 2c20 315d 0a20 2020 2020 2020  ad[:, 1].       
+00022840: 2078 3d44 6961 645b 3a2c 2030 5d0a 0a0a   x=Diad[:, 0]...
+00022850: 2020 2020 2020 2020 2320 5265 6769 6f6e          # Region
+00022860: 206f 6620 696e 7465 7265 7374 0a20 2020   of interest.   
+00022870: 2020 2020 2052 6567 696f 6e5f 7065 616b       Region_peak
+00022880: 7320 3d20 2828 783e 786c 696d 5f70 6561  s = ((x>xlim_pea
+00022890: 6b73 5b30 5d29 2620 2878 3c78 6c69 6d5f  ks[0])& (x<xlim_
+000228a0: 7065 616b 735b 315d 2929 0a20 2020 2020  peaks[1])).     
+000228b0: 2020 2052 6567 696f 6e5f 706c 6f74 3d28     Region_plot=(
+000228c0: 2878 3e78 6c69 6d5f 706c 6f74 5b30 5d29  (x>xlim_plot[0])
+000228d0: 2620 2878 3c78 6c69 6d5f 706c 6f74 5b31  & (x<xlim_plot[1
+000228e0: 5d29 290a 2020 2020 2020 2020 785f 7472  ])).        x_tr
+000228f0: 696d 3d78 5b52 6567 696f 6e5f 7065 616b  im=x[Region_peak
+00022900: 735d 0a20 2020 2020 2020 2079 5f74 7269  s].        y_tri
+00022910: 6d3d 795b 5265 6769 6f6e 5f70 6561 6b73  m=y[Region_peaks
+00022920: 5d0a 2020 2020 2020 2020 785f 706c 6f74  ].        x_plot
+00022930: 3d78 5b52 6567 696f 6e5f 706c 6f74 5d0a  =x[Region_plot].
+00022940: 2020 2020 2020 2020 795f 706c 6f74 3d79          y_plot=y
+00022950: 5b52 6567 696f 6e5f 706c 6f74 5d0a 2020  [Region_plot].  
+00022960: 2020 2020 2020 795f 6461 7461 5b3a 2c20        y_data[:, 
+00022970: 695d 3d79 0a0a 0a0a 2020 2020 2020 2020  i]=y....        
+00022980: 2320 4946 2075 7369 6e67 2073 6369 7079  # IF using scipy
+00022990: 2066 696e 6420 7065 616b 730a 2020 2020   find peaks.    
+000229a0: 2020 2020 6966 2066 696e 645f 7065 616b      if find_peak
+000229b0: 735f 6669 6c74 6572 2069 7320 5472 7565  s_filter is True
+000229c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000229d0: 4669 6e64 2070 6561 6b73 2066 6f72 2074  Find peaks for t
+000229e0: 7269 6d6d 6564 2073 7065 6374 7261 2028  rimmed spectra (
+000229f0: 652e 672e 2069 6e20 7265 6769 6f6e 2070  e.g. in region p
+00022a00: 6561 6b73 2068 6176 6520 6265 656e 2061  eaks have been a
+00022a10: 736b 6564 2066 6f72 290a 2020 2020 2020  sked for).      
+00022a20: 2020 2020 2020 7065 616b 7320 3d20 6669        peaks = fi
+00022a30: 6e64 5f70 6561 6b73 2879 5f74 7269 6d2c  nd_peaks(y_trim,
+00022a40: 6865 6967 6874 203d 2068 6569 6768 742c  height = height,
+00022a50: 2074 6872 6573 686f 6c64 203d 2074 6872   threshold = thr
+00022a60: 6573 686f 6c64 2c0a 2020 2020 2020 2020  eshold,.        
+00022a70: 2020 2020 6469 7374 616e 6365 203d 2064      distance = d
+00022a80: 6973 7461 6e63 652c 2070 726f 6d69 6e65  istance, promine
+00022a90: 6e63 653d 7072 6f6d 696e 656e 6365 2c20  nce=prominence, 
+00022aa0: 7769 6474 683d 7769 6474 6829 0a0a 0a20  width=width)... 
+00022ab0: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+00022ac0: 745f 5045 414b 203d 2070 6561 6b73 5b31  t_PEAK = peaks[1
+00022ad0: 5d5b 2770 6561 6b5f 6865 6967 6874 7327  ]['peak_heights'
+00022ae0: 5d20 236c 6973 7420 6f66 2074 6865 2068  ] #list of the h
+00022af0: 6569 6768 7473 206f 6620 7468 6520 7065  eights of the pe
+00022b00: 616b 730a 2020 2020 2020 2020 2020 2020  aks.            
+00022b10: 7065 616b 5f70 6f73 203d 2078 5f74 7269  peak_pos = x_tri
+00022b20: 6d5b 7065 616b 735b 305d 5d20 236c 6973  m[peaks[0]] #lis
+00022b30: 7420 6f66 2074 6865 2070 6561 6b73 2070  t of the peaks p
+00022b40: 6f73 6974 696f 6e73 0a0a 2020 2020 2020  ositions..      
+00022b50: 2020 2020 2020 6466 5f73 6f72 743d 7064        df_sort=pd
+00022b60: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
+00022b70: 7b27 706f 7327 3a20 7065 616b 5f70 6f73  {'pos': peak_pos
+00022b80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ba0: 2020 2768 6569 6768 7427 3a20 6865 6967    'height': heig
+00022bb0: 6874 5f50 4541 4b7d 290a 0a20 2020 2020  ht_PEAK})..     
+00022bc0: 2020 2020 2020 2064 665f 7065 616b 5f73         df_peak_s
+00022bd0: 6f72 743d 6466 5f73 6f72 742e 736f 7274  ort=df_sort.sort
+00022be0: 5f76 616c 7565 7328 2768 6569 6768 7427  _values('height'
+00022bf0: 2c20 6178 6973 3d30 2c20 6173 6365 6e64  , axis=0, ascend
+00022c00: 696e 673d 4661 6c73 6529 0a0a 2020 2020  ing=False)..    
+00022c10: 2020 2020 2020 2020 2320 5472 696d 206e          # Trim n
+00022c20: 756d 6265 7220 6f66 2070 6561 6b73 2062  umber of peaks b
+00022c30: 6173 6564 206f 6e20 7573 6572 2d64 6566  ased on user-def
+00022c40: 696e 6564 204e 2070 6561 6b73 0a0a 0a0a  ined N peaks....
+00022c50: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00022c60: 6e74 2864 665f 7065 616b 5f73 6f72 745f  nt(df_peak_sort_
+00022c70: 7368 6f72 7429 0a20 2020 2020 2020 2020  short).         
+00022c80: 2020 2069 6620 6c65 6e28 6466 5f70 6561     if len(df_pea
+00022c90: 6b5f 736f 7274 3e3d 3129 3a0a 0a20 2020  k_sort>=1):..   
+00022ca0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00022cb0: 7065 616b 5f73 6f72 745f 7368 6f72 743d  peak_sort_short=
+00022cc0: 6466 5f70 6561 6b5f 736f 7274 5b30 3a31  df_peak_sort[0:1
+00022cd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00022ce0: 2020 7065 616b 5f70 6f73 5f73 6176 6564    peak_pos_saved
+00022cf0: 5b69 5d3d 6466 5f70 6561 6b5f 736f 7274  [i]=df_peak_sort
+00022d00: 5f73 686f 7274 5b27 706f 7327 5d2e 7661  _short['pos'].va
+00022d10: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+00022d20: 2020 2020 2070 6561 6b5f 6865 6967 6874       peak_height
+00022d30: 5f73 6176 6564 5b69 5d3d 6466 5f70 6561  _saved[i]=df_pea
+00022d40: 6b5f 736f 7274 5f73 686f 7274 5b27 6865  k_sort_short['he
+00022d50: 6967 6874 275d 2e76 616c 7565 730a 2020  ight'].values.  
+00022d60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00022d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d80: 2070 6561 6b5f 706f 735f 7361 7665 645b   peak_pos_saved[
+00022d90: 695d 3d6e 702e 6e61 6e0a 2020 2020 2020  i]=np.nan.      
+00022da0: 2020 2020 2020 2020 2020 7065 616b 5f68            peak_h
+00022db0: 6569 6768 745f 7361 7665 645b 695d 3d6e  eight_saved[i]=n
+00022dc0: 702e 6e61 6e0a 0a20 2020 2020 2020 2020  p.nan..         
+00022dd0: 2020 2070 6561 6b5f 6263 6b5b 695d 3d6e     peak_bck[i]=n
+00022de0: 702e 7175 616e 7469 6c65 2879 5f70 6c6f  p.quantile(y_plo
+00022df0: 742c 2030 2e32 290a 2020 2020 2020 2020  t, 0.2).        
+00022e00: 2020 2020 6176 5f79 3d6e 702e 7175 616e      av_y=np.quan
+00022e10: 7469 6c65 2879 5f70 6c6f 742c 2030 2e35  tile(y_plot, 0.5
+00022e20: 290a 2020 2020 2020 2020 2020 2020 4469  ).            Di
+00022e30: 6666 3d6e 702e 6d61 7828 795f 706c 6f74  ff=np.max(y_plot
+00022e40: 292d 6e70 2e6d 696e 2879 5f70 6c6f 7429  )-np.min(y_plot)
+00022e50: 0a20 2020 2020 2020 2020 2020 2059 5f73  .            Y_s
+00022e60: 756d 3d6e 702e 6d61 7828 795f 706c 6f74  um=np.max(y_plot
+00022e70: 292f 4469 6666 0a0a 2020 2020 2020 2020  )/Diff..        
+00022e80: 2020 2020 6178 312e 706c 6f74 2878 5f70      ax1.plot(x_p
+00022e90: 6c6f 742c 2028 2879 5f70 6c6f 742d 6e70  lot, ((y_plot-np
+00022ea0: 2e6d 696e 2879 5f70 6c6f 7429 292f 4469  .min(y_plot))/Di
+00022eb0: 6666 292b 692c 2027 2d72 2729 0a20 2020  ff)+i, '-r').   
+00022ec0: 2020 2020 2020 2020 2061 7831 2e70 6c6f           ax1.plo
+00022ed0: 7428 785f 706c 6f74 2c20 2828 795f 706c  t(x_plot, ((y_pl
+00022ee0: 6f74 2d6e 702e 6d69 6e28 795f 706c 6f74  ot-np.min(y_plot
+00022ef0: 2929 2f44 6966 6629 2b69 2c20 272e 6b27  ))/Diff)+i, '.k'
+00022f00: 2c20 6d73 3d31 290a 2020 2020 2020 2020  , ms=1).        
+00022f10: 2020 2020 6966 206c 656e 2868 6569 6768      if len(heigh
+00022f20: 745f 5045 414b 293e 303a 0a0a 0a20 2020  t_PEAK)>0:...   
+00022f30: 2020 2020 2020 2020 2020 2020 2061 7831               ax1
+00022f40: 2e70 6c6f 7428 6466 5f70 6561 6b5f 736f  .plot(df_peak_so
+00022f50: 7274 5f73 686f 7274 5b27 706f 7327 5d2c  rt_short['pos'],
+00022f60: 2028 6466 5f70 6561 6b5f 736f 7274 5f73   (df_peak_sort_s
+00022f70: 686f 7274 5b27 6865 6967 6874 275d 2d6e  hort['height']-n
+00022f80: 702e 6d69 6e28 795f 706c 6f74 2929 2f44  p.min(y_plot))/D
+00022f90: 6966 662b 692c 2027 2a6b 272c 206d 6663  iff+i, '*k', mfc
+00022fa0: 3d27 7965 6c6c 6f77 272c 206d 733d 3130  ='yellow', ms=10
+00022fb0: 290a 0a20 2020 2020 2020 2020 2020 2079  )..            y
+00022fc0: 706c 6f74 5b69 5d3d 6e70 2e6d 696e 2828  plot[i]=np.min((
+00022fd0: 2879 5f70 6c6f 742d 6e70 2e6d 696e 2879  (y_plot-np.min(y
+00022fe0: 5f70 6c6f 7429 292f 4469 6666 292b 6929  _plot))/Diff)+i)
+00022ff0: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00023000: 312e 616e 6e6f 7461 7465 2873 7472 2866  1.annotate(str(f
+00023010: 696c 6529 2c20 7879 3d28 786c 696d 5f70  ile), xy=(xlim_p
+00023020: 6c6f 745b 315d 2b30 2e35 2c20 7970 6c6f  lot[1]+0.5, yplo
+00023030: 745b 695d 292c 0a20 2020 2020 2020 2020  t[i]),.         
+00023040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023050: 7879 636f 6f72 6473 3d22 6461 7461 222c  xycoords="data",
+00023060: 2066 6f6e 7473 697a 653d 3829 0a20 2020   fontsize=8).   
+00023070: 2020 2020 2020 2020 2023 6178 312e 7365           #ax1.se
+00023080: 745f 786c 696d 2878 6c69 6d29 0a20 2020  t_xlim(xlim).   
+00023090: 2020 2020 2020 2020 2059 3d59 2b59 5f73           Y=Y+Y_s
+000230a0: 756d 0a20 2020 2020 2020 2020 2020 2069  um.            i
+000230b0: 3d69 2b31 0a0a 2020 2020 2020 2020 656c  =i+1..        el
+000230c0: 6966 2073 6967 6d61 5f66 696c 7465 7220  if sigma_filter 
+000230d0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+000230e0: 2020 2020 2020 2020 2023 2046 696e 6420           # Find 
+000230f0: 6d61 7820 7661 6c75 6520 696e 2072 6567  max value in reg
+00023100: 696f 6e0a 0a20 2020 2020 2020 2020 2020  ion..           
+00023110: 206d 6178 793d 6e70 2e6d 6178 2879 5f74   maxy=np.max(y_t
+00023120: 7269 6d29 0a20 2020 2020 2020 2020 2020  rim).           
+00023130: 2078 706f 733d 785f 7472 696d 5b79 5f74   xpos=x_trim[y_t
+00023140: 7269 6d3d 3d6d 6178 795d 5b30 5d0a 2020  rim==maxy][0].  
+00023150: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
+00023160: 2878 706f 7329 0a20 2020 2020 2020 2020  (xpos).         
+00023170: 2020 2079 5f61 726f 756e 645f 6d61 783d     y_around_max=
+00023180: 795f 7472 696d 5b28 785f 7472 696d 3c28  y_trim[(x_trim<(
+00023190: 7870 6f73 2b31 3029 2926 2878 5f74 7269  xpos+10))&(x_tri
+000231a0: 6d3e 2878 706f 732d 3130 2929 5d0a 2020  m>(xpos-10))].  
+000231b0: 2020 2020 2020 2020 2020 7374 6479 3d6e            stdy=n
+000231c0: 702e 6e61 6e73 7464 2879 5f61 726f 756e  p.nanstd(y_aroun
+000231d0: 645f 6d61 7829 0a20 2020 2020 2020 2020  d_max).         
+000231e0: 2020 206d 6564 6961 6e79 3d6e 702e 6e61     mediany=np.na
+000231f0: 6e6d 6564 6961 6e28 795f 6172 6f75 6e64  nmedian(y_around
+00023200: 5f6d 6178 290a 2020 2020 2020 2020 2020  _max).          
+00023210: 2020 6966 206d 6178 793e 6d65 6469 616e    if maxy>median
+00023220: 792b 7374 6479 2a73 6967 6d61 3a0a 2020  y+stdy*sigma:.  
+00023230: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00023240: 735f 783d 785f 7472 696d 5b79 5f74 7269  s_x=x_trim[y_tri
+00023250: 6d3d 3d6d 6178 795d 5b30 5d0a 2020 2020  m==maxy][0].    
+00023260: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00023270: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00023280: 735f 783d 6e70 2e6e 616e 0a0a 0a0a 2020  s_x=np.nan....  
+00023290: 2020 2020 2020 2020 2020 6966 2070 6f73            if pos
+000232a0: 5f78 3e30 3a0a 2020 2020 2020 2020 2020  _x>0:.          
+000232b0: 2020 2020 2020 7065 616b 5f70 6f73 5f73        peak_pos_s
+000232c0: 6176 6564 5b69 5d3d 706f 735f 780a 2020  aved[i]=pos_x.  
+000232d0: 2020 2020 2020 2020 2020 2020 2020 7065                pe
+000232e0: 616b 5f68 6569 6768 745f 7361 7665 645b  ak_height_saved[
+000232f0: 695d 3d6d 6178 790a 0a20 2020 2020 2020  i]=maxy..       
+00023300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00023310: 2020 2020 2020 2020 2020 2070 6561 6b5f             peak_
+00023320: 706f 735f 7361 7665 645b 695d 3d6e 702e  pos_saved[i]=np.
+00023330: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
+00023340: 2020 2020 7065 616b 5f68 6569 6768 745f      peak_height_
+00023350: 7361 7665 645b 695d 3d6e 702e 6e61 6e0a  saved[i]=np.nan.
+00023360: 0a20 2020 2020 2020 2020 2020 2070 6561  .            pea
+00023370: 6b5f 6263 6b5b 695d 3d6e 702e 7175 616e  k_bck[i]=np.quan
+00023380: 7469 6c65 2879 5f70 6c6f 742c 2030 2e32  tile(y_plot, 0.2
+00023390: 290a 2020 2020 2020 2020 2020 2020 6176  ).            av
+000233a0: 5f79 3d6e 702e 7175 616e 7469 6c65 2879  _y=np.quantile(y
+000233b0: 5f70 6c6f 742c 2030 2e35 290a 2020 2020  _plot, 0.5).    
+000233c0: 2020 2020 2020 2020 4469 6666 3d6e 702e          Diff=np.
+000233d0: 6d61 7828 795f 706c 6f74 292d 6e70 2e6d  max(y_plot)-np.m
+000233e0: 696e 2879 5f70 6c6f 7429 0a20 2020 2020  in(y_plot).     
+000233f0: 2020 2020 2020 2059 5f73 756d 3d6e 702e         Y_sum=np.
+00023400: 6d61 7828 795f 706c 6f74 292f 4469 6666  max(y_plot)/Diff
+00023410: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00023420: 4620 7468 6572 6520 6973 2073 6f6d 6574  F there is somet
+00023430: 6869 6e67 2074 6861 7420 7061 7373 6573  hing that passes
+00023440: 2074 6865 2066 696c 7465 720a 2020 2020   the filter.    
+00023450: 2020 2020 2020 2020 6966 2070 6f73 5f78          if pos_x
+00023460: 3e30 3a0a 2020 2020 2020 2020 2020 2020  >0:.            
+00023470: 2020 2020 795f 7374 6172 5b69 5d3d 2870      y_star[i]=(p
+00023480: 6561 6b5f 6865 6967 6874 5f73 6176 6564  eak_height_saved
+00023490: 5b69 5d2d 6e70 2e6d 696e 2879 5f70 6c6f  [i]-np.min(y_plo
+000234a0: 7429 292f 4469 6666 2b69 0a20 2020 2020  t))/Diff+i.     
+000234b0: 2020 2020 2020 2020 2020 2061 7831 2e70             ax1.p
+000234c0: 6c6f 7428 706f 735f 782c 2079 5f73 7461  lot(pos_x, y_sta
+000234d0: 725b 695d 2c20 272a 6b27 2c20 6d66 633d  r[i], '*k', mfc=
+000234e0: 2779 656c 6c6f 7727 2c20 6d73 3d31 3029  'yellow', ms=10)
+000234f0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00023500: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00023510: 2020 2079 5f73 7461 725b 695d 3d6e 702e     y_star[i]=np.
+00023520: 6e61 6e0a 0a20 2020 2020 2020 2020 2020  nan..           
+00023530: 2061 7831 2e70 6c6f 7428 785f 706c 6f74   ax1.plot(x_plot
+00023540: 2c20 2828 795f 706c 6f74 2d6e 702e 6d69  , ((y_plot-np.mi
+00023550: 6e28 795f 706c 6f74 2929 2f44 6966 6629  n(y_plot))/Diff)
+00023560: 2b69 2c20 272d 7227 290a 2020 2020 2020  +i, '-r').      
+00023570: 2020 2020 2020 6178 312e 706c 6f74 2878        ax1.plot(x
+00023580: 5f70 6c6f 742c 2028 2879 5f70 6c6f 742d  _plot, ((y_plot-
+00023590: 6e70 2e6d 696e 2879 5f70 6c6f 7429 292f  np.min(y_plot))/
+000235a0: 4469 6666 292b 692c 2027 2e6b 272c 206d  Diff)+i, '.k', m
+000235b0: 733d 3129 0a20 2020 2020 2020 2020 2020  s=1).           
+000235c0: 2079 706c 6f74 5b69 5d3d 6e70 2e6d 696e   yplot[i]=np.min
+000235d0: 2828 2879 5f70 6c6f 742d 6e70 2e6d 696e  (((y_plot-np.min
+000235e0: 2879 5f70 6c6f 7429 292f 4469 6666 292b  (y_plot))/Diff)+
+000235f0: 6929 0a20 2020 2020 2020 2020 2020 2061  i).            a
+00023600: 7831 2e61 6e6e 6f74 6174 6528 7374 7228  x1.annotate(str(
+00023610: 6669 6c65 292c 2078 793d 2878 6c69 6d5f  file), xy=(xlim_
+00023620: 706c 6f74 5b31 5d2b 302e 352c 2079 706c  plot[1]+0.5, ypl
+00023630: 6f74 5b69 5d29 2c0a 2020 2020 2020 2020  ot[i]),.        
+00023640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023650: 2078 7963 6f6f 7264 733d 2264 6174 6122   xycoords="data"
+00023660: 2c20 666f 6e74 7369 7a65 3d38 290a 2020  , fontsize=8).  
+00023670: 2020 2020 2020 2020 2020 593d 592b 595f            Y=Y+Y_
+00023680: 7375 6d0a 2020 2020 2020 2020 2020 2020  sum.            
+00023690: 693d 692b 310a 0a20 2020 2020 2020 2065  i=i+1..        e
+000236a0: 6c69 6620 6a75 7374 5f70 6c6f 7420 6973  lif just_plot is
+000236b0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+000236c0: 2020 2044 6966 663d 6e70 2e6d 6178 2879     Diff=np.max(y
+000236d0: 5f70 6c6f 7429 2d6e 702e 6d69 6e28 795f  _plot)-np.min(y_
+000236e0: 706c 6f74 290a 2020 2020 2020 2020 2020  plot).          
+000236f0: 2020 595f 7375 6d3d 6e70 2e6d 6178 2879    Y_sum=np.max(y
+00023700: 5f70 6c6f 7429 2f44 6966 660a 2020 2020  _plot)/Diff.    
+00023710: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00023720: 2878 5f70 6c6f 742c 2028 2879 5f70 6c6f  (x_plot, ((y_plo
+00023730: 742d 6e70 2e6d 696e 2879 5f70 6c6f 7429  t-np.min(y_plot)
+00023740: 292f 4469 6666 292b 692c 2027 2d72 2729  )/Diff)+i, '-r')
+00023750: 0a20 2020 2020 2020 2020 2020 2061 7831  .            ax1
+00023760: 2e70 6c6f 7428 785f 706c 6f74 2c20 2828  .plot(x_plot, ((
+00023770: 795f 706c 6f74 2d6e 702e 6d69 6e28 795f  y_plot-np.min(y_
+00023780: 706c 6f74 2929 2f44 6966 6629 2b69 2c20  plot))/Diff)+i, 
+00023790: 272e 6b27 2c20 6d73 3d31 290a 2020 2020  '.k', ms=1).    
+000237a0: 2020 2020 2020 2020 7970 6c6f 745b 695d          yplot[i]
+000237b0: 3d6e 702e 6d69 6e28 2828 795f 706c 6f74  =np.min(((y_plot
+000237c0: 2d6e 702e 6d69 6e28 795f 706c 6f74 2929  -np.min(y_plot))
+000237d0: 2f44 6966 6629 2b69 290a 2020 2020 2020  /Diff)+i).      
+000237e0: 2020 2020 2020 6178 312e 616e 6e6f 7461        ax1.annota
+000237f0: 7465 2873 7472 2866 696c 6529 2c20 7879  te(str(file), xy
+00023800: 3d28 786c 696d 5f70 6c6f 745b 315d 2b30  =(xlim_plot[1]+0
+00023810: 2e35 2c20 7970 6c6f 745b 695d 292c 0a20  .5, yplot[i]),. 
 00023820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023840: 2020 2020 2020 2020 2768 6569 6768 7427          'height'
-00023850: 3a20 7065 616b 5f68 6569 6768 745f 7361  : peak_height_sa
-00023860: 7665 642c 0a20 2020 2020 2020 2020 2020  ved,.           
-00023870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023890: 2027 7072 6f6d 273a 2070 6561 6b5f 6865   'prom': peak_he
-000238a0: 6967 6874 5f73 6176 6564 2d70 6561 6b5f  ight_saved-peak_
-000238b0: 6263 6b7d 290a 0a20 2020 2023 6966 2073  bck})..    #if s
-000238c0: 6967 6d61 5f66 696c 7465 7220 6973 2054  igma_filter is T
-000238d0: 7275 653a 0a20 2020 2020 2020 2023 6178  rue:.        #ax
-000238e0: 312e 706c 6f74 2864 665f 7065 616b 735b  1.plot(df_peaks[
-000238f0: 2770 6f73 275d 5b79 5f73 7461 723e 305d  'pos'][y_star>0]
-00023900: 2c20 795f 7374 6172 5b79 5f73 7461 723e  , y_star[y_star>
-00023910: 305d 2c20 272a 6b27 2c20 6d66 633d 2779  0], '*k', mfc='y
-00023920: 656c 6c6f 7727 2c20 6d73 3d31 3029 0a0a  ellow', ms=10)..
-00023930: 0a0a 0a0a 0a0a 0a0a 0a20 2020 2061 7831  .........    ax1
-00023940: 2e70 6c6f 7428 5b31 3037 382c 2031 3037  .plot([1078, 107
-00023950: 385d 2c20 5b30 2c20 7970 6c6f 745b 2d31  8], [0, yplot[-1
-00023960: 5d2b 325d 2c20 272d 6727 2c20 6c77 3d31  ]+2], '-g', lw=1
-00023970: 2c20 6c61 6265 6c3d 274e 6124 5f32 2443  , label='Na$_2$C
-00023980: 4f24 5f33 2427 290a 2020 2020 6178 312e  O$_3$').    ax1.
-00023990: 706c 6f74 285b 3130 3835 2c20 3130 3835  plot([1085, 1085
-000239a0: 5d2c 205b 302c 2079 706c 6f74 5b2d 315d  ], [0, yplot[-1]
-000239b0: 2b32 5d2c 2027 2d27 2c20 636f 6c6f 723d  +2], '-', color=
-000239c0: 2763 6f72 6e66 6c6f 7765 7262 6c75 6527  'cornflowerblue'
-000239d0: 2c20 6c77 3d31 2c20 6c61 6265 6c3d 2743  , lw=1, label='C
-000239e0: 6143 4f24 5f33 2427 290a 0a20 2020 2061  aCO$_3$')..    a
-000239f0: 7831 2e70 6c6f 7428 5b31 3039 342c 2031  x1.plot([1094, 1
-00023a00: 3039 345d 2c20 5b30 2c20 7970 6c6f 745b  094], [0, yplot[
-00023a10: 2d31 5d2b 325d 2c20 272d 6327 2c20 6c77  -1]+2], '-c', lw
-00023a20: 3d31 2c20 6c61 6265 6c3d 274d 6743 4f24  =1, label='MgCO$
-00023a30: 5f33 2427 290a 2020 2020 6178 312e 706c  _3$').    ax1.pl
-00023a40: 6f74 285b 3130 3937 2c20 3130 3937 5d2c  ot([1097, 1097],
-00023a50: 205b 302c 2079 706c 6f74 5b2d 315d 2b32   [0, yplot[-1]+2
-00023a60: 5d2c 2027 2d62 272c 206c 773d 312c 206c  ], '-b', lw=1, l
-00023a70: 6162 656c 3d27 446f 6c6f 6d69 7465 2729  abel='Dolomite')
+00023830: 2020 2020 2020 2020 7879 636f 6f72 6473          xycoords
+00023840: 3d22 6461 7461 222c 2066 6f6e 7473 697a  ="data", fontsiz
+00023850: 653d 3829 0a20 2020 2020 2020 2020 2020  e=8).           
+00023860: 2059 3d59 2b59 5f73 756d 0a20 2020 2020   Y=Y+Y_sum.     
+00023870: 2020 2020 2020 2069 3d69 2b31 0a0a 0a20         i=i+1... 
+00023880: 2020 2064 665f 7065 616b 733d 7064 2e44     df_peaks=pd.D
+00023890: 6174 6146 7261 6d65 2864 6174 613d 7b27  ataFrame(data={'
+000238a0: 706f 7327 3a20 7065 616b 5f70 6f73 5f73  pos': peak_pos_s
+000238b0: 6176 6564 2c0a 2020 2020 2020 2020 2020  aved,.          
+000238c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000238d0: 2020 2020 2020 2020 2020 2020 2020 2768                'h
+000238e0: 6569 6768 7427 3a20 7065 616b 5f68 6569  eight': peak_hei
+000238f0: 6768 745f 7361 7665 642c 0a20 2020 2020  ght_saved,.     
+00023900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023920: 2020 2020 2020 2027 7072 6f6d 273a 2070         'prom': p
+00023930: 6561 6b5f 6865 6967 6874 5f73 6176 6564  eak_height_saved
+00023940: 2d70 6561 6b5f 6263 6b7d 290a 0a20 2020  -peak_bck})..   
+00023950: 2023 6966 2073 6967 6d61 5f66 696c 7465   #if sigma_filte
+00023960: 7220 6973 2054 7275 653a 0a20 2020 2020  r is True:.     
+00023970: 2020 2023 6178 312e 706c 6f74 2864 665f     #ax1.plot(df_
+00023980: 7065 616b 735b 2770 6f73 275d 5b79 5f73  peaks['pos'][y_s
+00023990: 7461 723e 305d 2c20 795f 7374 6172 5b79  tar>0], y_star[y
+000239a0: 5f73 7461 723e 305d 2c20 272a 6b27 2c20  _star>0], '*k', 
+000239b0: 6d66 633d 2779 656c 6c6f 7727 2c20 6d73  mfc='yellow', ms
+000239c0: 3d31 3029 0a0a 0a0a 0a0a 0a0a 0a0a 0a20  =10)........... 
+000239d0: 2020 2061 7831 2e70 6c6f 7428 5b31 3037     ax1.plot([107
+000239e0: 382c 2031 3037 385d 2c20 5b30 2c20 7970  8, 1078], [0, yp
+000239f0: 6c6f 745b 2d31 5d2b 325d 2c20 272d 6727  lot[-1]+2], '-g'
+00023a00: 2c20 6c77 3d31 2c20 6c61 6265 6c3d 274e  , lw=1, label='N
+00023a10: 6124 5f32 2443 4f24 5f33 2427 290a 2020  a$_2$CO$_3$').  
+00023a20: 2020 6178 312e 706c 6f74 285b 3130 3835    ax1.plot([1085
+00023a30: 2c20 3130 3835 5d2c 205b 302c 2079 706c  , 1085], [0, ypl
+00023a40: 6f74 5b2d 315d 2b32 5d2c 2027 2d27 2c20  ot[-1]+2], '-', 
+00023a50: 636f 6c6f 723d 2763 6f72 6e66 6c6f 7765  color='cornflowe
+00023a60: 7262 6c75 6527 2c20 6c77 3d31 2c20 6c61  rblue', lw=1, la
+00023a70: 6265 6c3d 2743 6143 4f24 5f33 2427 290a  bel='CaCO$_3$').
 00023a80: 0a20 2020 2061 7831 2e70 6c6f 7428 5b31  .    ax1.plot([1
-00023a90: 3133 312c 2031 3133 315d 2c20 5b30 2c20  131, 1131], [0, 
+00023a90: 3039 342c 2031 3039 345d 2c20 5b30 2c20  094, 1094], [0, 
 00023aa0: 7970 6c6f 745b 2d31 5d2b 325d 2c20 272d  yplot[-1]+2], '-
-00023ab0: 272c 2063 6f6c 6f72 3d27 6772 6579 272c  ', color='grey',
-00023ac0: 206c 773d 312c 206c 6162 656c 3d27 4361   lw=1, label='Ca
-00023ad0: 534f 245f 3424 2729 0a20 2020 2061 7831  SO$_4$').    ax1
-00023ae0: 2e70 6c6f 7428 5b31 3133 362c 2031 3133  .plot([1136, 113
-00023af0: 365d 2c20 5b30 2c20 7970 6c6f 745b 2d31  6], [0, yplot[-1
-00023b00: 5d2b 325d 2c20 272d 2d27 2c20 636f 6c6f  ]+2], '--', colo
-00023b10: 723d 2772 6f73 7962 726f 776e 272c 206c  r='rosybrown', l
-00023b20: 773d 312c 206c 6162 656c 3d27 4d67 534f  w=1, label='MgSO
-00023b30: 245f 3424 2729 0a20 2020 2061 7831 2e70  $_4$').    ax1.p
-00023b40: 6c6f 7428 5b31 3135 312c 2031 3135 315d  lot([1151, 1151]
-00023b50: 2c20 5b30 2c20 7970 6c6f 745b 2d31 5d2b  , [0, yplot[-1]+
-00023b60: 325d 2c20 272d 6b27 2c20 6c77 3d31 2c20  2], '-k', lw=1, 
-00023b70: 6c61 6265 6c3d 2753 4f24 5f32 2427 290a  label='SO$_2$').
-00023b80: 0a0a 2020 2020 6178 312e 6669 6c6c 5f62  ..    ax1.fill_b
-00023b90: 6574 7765 656e 2878 6c69 6d5f 7065 616b  etween(xlim_peak
-00023ba0: 732c 202d 302e 352c 2079 706c 6f74 5b2d  s, -0.5, yplot[-
-00023bb0: 315d 2b33 2c20 636f 6c6f 723d 2762 6c75  1]+3, color='blu
-00023bc0: 6527 2c20 616c 7068 613d 302e 3129 0a0a  e', alpha=0.1)..
-00023bd0: 0a20 2020 2061 7831 2e6c 6567 656e 6428  .    ax1.legend(
-00023be0: 6e63 6f6c 3d37 2c6c 6f63 3d27 7570 7065  ncol=7,loc='uppe
-00023bf0: 7220 6365 6e74 6572 272c 2066 6f6e 7473  r center', fonts
-00023c00: 697a 653d 3130 2c20 2062 626f 785f 746f  ize=10,  bbox_to
-00023c10: 5f61 6e63 686f 723d 5b30 2e35 2c20 312e  _anchor=[0.5, 1.
-00023c20: 3035 5d29 0a20 2020 2061 7831 2e73 6574  05]).    ax1.set
-00023c30: 5f79 6c69 6d28 5b2d 302e 352c 2079 706c  _ylim([-0.5, ypl
-00023c40: 6f74 5b2d 315d 2b33 5d29 0a20 2020 2061  ot[-1]+3]).    a
-00023c50: 7831 2e73 6574 5f78 6c69 6d28 5b78 6c69  x1.set_xlim([xli
-00023c60: 6d5f 706c 6f74 5b30 5d2c 2078 6c69 6d5f  m_plot[0], xlim_
-00023c70: 706c 6f74 5b31 5d2b 302e 355d 290a 0a20  plot[1]+0.5]).. 
-00023c80: 2020 2023 2064 665f 7065 616b 733d 7064     # df_peaks=pd
-00023c90: 2e44 6174 6146 7261 6d65 2864 6174 613d  .DataFrame(data=
-00023ca0: 7b27 6669 6c65 6e61 6d65 273a 2044 6961  {'filename': Dia
-00023cb0: 645f 4669 6c65 732c 0a20 2020 2023 2020  d_Files,.    #  
-00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cd0: 2020 2020 2020 2027 706f 7327 3a20 7065         'pos': pe
-00023ce0: 616b 5f70 6f73 5f73 6176 6564 2c0a 2020  ak_pos_saved,.  
-00023cf0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00023d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d10: 2770 726f 6d27 3a20 7065 616b 5f68 6569  'prom': peak_hei
-00023d20: 6768 745f 7361 7665 642d 7065 616b 5f62  ght_saved-peak_b
-00023d30: 636b 7d29 0a0a 0a0a 2020 2020 6178 312e  ck})....    ax1.
-00023d40: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
-00023d50: 6e75 6d62 6572 2028 636d 245e 7b2d 317d  number (cm$^{-1}
-00023d60: 2429 2729 0a20 2020 2061 7831 2e73 6574  $)').    ax1.set
-00023d70: 5f79 7469 636b 7328 5b5d 290a 0a20 2020  _yticks([])..   
-00023d80: 2078 5f64 6174 613d 785f 7472 696d 0a0a   x_data=x_trim..
-00023d90: 2020 2020 6466 5f70 6561 6b73 5b27 6669      df_peaks['fi
-00023da0: 6c65 5f6e 616d 6573 275d 3d44 6961 645f  le_names']=Diad_
-00023db0: 4669 6c65 730a 0a20 2020 2072 6574 7572  Files..    retur
-00023dc0: 6e20 6466 5f70 6561 6b73 2c20 785f 6461  n df_peaks, x_da
-00023dd0: 7461 2c20 795f 6461 7461 2c20 6669 670a  ta, y_data, fig.
-00023de0: 0a0a 2323 2044 6961 6420 536b 6577 6e65  ..## Diad Skewne
-00023df0: 7373 2066 726f 6d20 4465 5669 7472 6520  ss from DeVitre 
-00023e00: 6574 2061 6c2e 0a0a 696d 706f 7274 2070  et al...import p
-00023e10: 616e 6461 7320 6173 2070 640a 696d 706f  andas as pd.impo
-00023e20: 7274 206e 756d 7079 2061 7320 6e70 0a69  rt numpy as np.i
-00023e30: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
-00023e40: 2e70 7970 6c6f 7420 6173 2070 6c74 0a66  .pyplot as plt.f
-00023e50: 726f 6d20 7363 6970 792e 7369 676e 616c  rom scipy.signal
-00023e60: 2069 6d70 6f72 7420 6669 6e64 5f70 6561   import find_pea
-00023e70: 6b73 0a23 204e 6577 2074 6869 6e67 7320  ks.# New things 
-00023e80: 6e65 6564 6564 2068 6572 650a 6672 6f6d  needed here.from
-00023e90: 2073 6369 7079 2e69 6e74 6572 706f 6c61   scipy.interpola
-00023ea0: 7465 2069 6d70 6f72 7420 696e 7465 7270  te import interp
-00023eb0: 3164 0a66 726f 6d20 7363 6970 792e 7369  1d.from scipy.si
-00023ec0: 676e 616c 2069 6d70 6f72 7420 6669 6e64  gnal import find
-00023ed0: 5f70 6561 6b73 0a69 6d70 6f72 7420 6f73  _peaks.import os
-00023ee0: 0a66 726f 6d20 6f73 2069 6d70 6f72 7420  .from os import 
-00023ef0: 6c69 7374 6469 720a 6672 6f6d 206f 732e  listdir.from os.
-00023f00: 7061 7468 2069 6d70 6f72 7420 6973 6669  path import isfi
-00023f10: 6c65 2c20 6a6f 696e 0a66 726f 6d20 4469  le, join.from Di
-00023f20: 6164 4669 742e 696d 706f 7274 696e 675f  adFit.importing_
-00023f30: 6461 7461 5f66 696c 6573 2069 6d70 6f72  data_files impor
-00023f40: 7420 2a0a 6672 6f6d 2044 6961 6446 6974  t *.from DiadFit
-00023f50: 2e64 6961 6473 2069 6d70 6f72 7420 2a0a  .diads import *.
-00023f60: 0a6e 702e 7365 7465 7272 2028 696e 7661  .np.seterr (inva
-00023f70: 6c69 643d 2772 6169 7365 2729 0a0a 656e  lid='raise')..en
-00023f80: 636f 6465 3d22 4953 4f2d 3838 3539 2d31  code="ISO-8859-1
-00023f90: 220a 0a0a 0a0a 0a0a 6465 6620 6173 7365  ".......def asse
-00023fa0: 7373 5f64 6961 6431 5f73 6b65 776e 6573  ss_diad1_skewnes
-00023fb0: 7328 2a2c 2020 636f 6e66 6967 313a 2064  s(*,  config1: d
-00023fc0: 6961 6431 5f66 6974 5f63 6f6e 6669 673d  iad1_fit_config=
-00023fd0: 6469 6164 315f 6669 745f 636f 6e66 6967  diad1_fit_config
-00023fe0: 2829 2c20 696e 745f 6375 745f 6f66 663d  (), int_cut_off=
-00023ff0: 302e 332c 2070 6174 683d 4e6f 6e65 2c20  0.3, path=None, 
-00024000: 6669 6c65 6e61 6d65 3d4e 6f6e 652c 2066  filename=None, f
-00024010: 696c 6574 7970 653d 4e6f 6e65 2c0a 736b  iletype=None,.sk
-00024020: 6577 6e65 7373 3d27 6162 7327 2c20 6865  ewness='abs', he
-00024030: 6967 6874 3d31 2c20 7072 6f6d 696e 656e  ight=1, prominen
-00024040: 6365 3d35 2c20 7769 6474 683d 302e 352c  ce=5, width=0.5,
-00024050: 2070 6c6f 745f 6669 6775 7265 3d54 7275   plot_figure=Tru
-00024060: 652c 2064 7069 3d32 3030 293a 0a20 2020  e, dpi=200):.   
-00024070: 2022 2222 2041 7373 6573 7365 7320 536b   """ Assesses Sk
-00024080: 6577 6e65 7373 206f 6620 4469 6164 2070  ewness of Diad p
-00024090: 6561 6b73 2e20 5573 6566 756c 2066 6f72  eaks. Useful for
-000240a0: 2069 6465 6e74 6966 7969 6e67 206d 6978   identifying mix
-000240b0: 6564 204c 202b 2056 2070 6861 7365 730a  ed L + V phases.
-000240c0: 2020 2020 2873 6565 2044 6556 6974 7265      (see DeVitre
-000240d0: 2065 7420 616c 2e20 696e 2072 6576 6965   et al. in revie
-000240e0: 7729 0a0a 0a20 2020 2050 6172 616d 6574  w)...    Paramet
-000240f0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00024100: 2d2d 2d0a 2020 2020 636f 6e66 6967 313a  ---.    config1:
-00024110: 2064 6961 6431 5f66 6974 5f63 6f6e 6669   diad1_fit_confi
-00024120: 6728 2920 6461 7461 636c 6173 732e 2049  g() dataclass. I
-00024130: 6d70 6f72 7420 7061 7261 6d65 7465 7273  mport parameters
-00024140: 2066 6f72 2074 6869 7320 6675 6e63 7469   for this functi
-00024150: 6f6e 2061 7265 2e0a 0a20 2020 2020 2020  on are...       
-00024160: 206c 6f77 6572 5f62 636b 5f64 6961 6431   lower_bck_diad1
-00024170: 2c20 7570 7065 725f 6263 6b5f 6469 6164  , upper_bck_diad
-00024180: 313a 205b 666c 6f61 742c 2066 6c6f 6174  1: [float, float
-00024190: 5d0a 2020 2020 2020 2020 2020 2020 6261  ].            ba
-000241a0: 636b 6772 6f75 6e64 2070 6f73 6974 696f  ckground positio
-000241b0: 6e20 746f 206c 6566 7420 616e 6420 7269  n to left and ri
-000241c0: 6768 7420 6f66 206f 7665 7261 6c20 6469  ght of overal di
-000241d0: 6164 2072 6567 696f 6e20 2869 6e63 2064  ad region (inc d
-000241e0: 6961 642b 2d48 422b 2d43 3133 290a 0a20  iad+-HB+-C13).. 
-000241f0: 2020 2020 2020 204e 5f70 6f6c 795f 6263         N_poly_bc
-00024200: 6b5f 6469 6164 313a 2069 6e74 0a20 2020  k_diad1: int.   
-00024210: 2020 2020 2020 2020 2064 6567 7265 6520           degree 
-00024220: 6f66 2070 6f6c 796e 6f6d 6961 6c20 746f  of polynomial to
-00024230: 2066 6974 2074 6f20 7468 6520 6261 636b   fit to the back
-00024240: 6772 6f75 6e64 2e0a 0a20 2020 2020 2020  ground...       
-00024250: 2065 7863 6c75 6465 5f72 616e 6765 312c   exclude_range1,
-00024260: 2065 7863 6c75 6465 5f72 616e 6765 323a   exclude_range2:
-00024270: 2054 7570 6c65 5b66 6c6f 6174 2c20 666c   Tuple[float, fl
-00024280: 6f61 745d 0a20 2020 2020 2020 2020 2020  oat].           
-00024290: 2052 616e 6765 2074 6f20 6578 636c 7564   Range to exclud
-000242a0: 650a 0a20 2020 2069 6e74 5f63 7574 5f6f  e..    int_cut_o
-000242b0: 6666 3a20 666c 6f61 740a 2020 2020 2020  ff: float.      
-000242c0: 2020 5661 6c75 6520 6f66 2069 6e74 656e    Value of inten
-000242d0: 7369 7479 2061 7420 7768 6963 6820 746f  sity at which to
-000242e0: 2063 616c 6375 6c61 7465 2074 6865 2073   calculate the s
-000242f0: 6b65 776e 6573 7320 2865 2e67 2e20 302e  kewness (e.g. 0.
-00024300: 3135 5820 7468 6520 7065 616b 2068 6569  15X the peak hei
-00024310: 6768 7429 2e0a 0a20 2020 2070 6174 683a  ght)...    path:
-00024320: 2073 7472 0a20 2020 2020 2020 2046 6f6c   str.        Fol
-00024330: 6465 7220 7573 6572 2077 6973 6865 7320  der user wishes 
-00024340: 746f 2072 6561 6420 6461 7461 2066 726f  to read data fro
-00024350: 6d0a 0a20 2020 2066 696c 656e 616d 653a  m..    filename:
-00024360: 2073 7472 0a20 2020 2020 2020 2053 7065   str.        Spe
-00024370: 6369 6669 6320 6669 6c65 2062 6569 6e67  cific file being
-00024380: 2072 6561 640a 0a0a 2020 2020 6669 6c65   read...    file
-00024390: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
-000243a0: 2020 4964 656e 7469 6669 6573 2074 7970    Identifies typ
-000243b0: 6520 6f66 2066 696c 650a 2020 2020 2020  e of file.      
-000243c0: 2020 6368 6f6f 7365 2066 726f 6d20 2757    choose from 'W
-000243d0: 6974 6563 5f41 5343 4949 272c 2027 6865  itec_ASCII', 'he
-000243e0: 6164 6c65 7373 5f74 7874 272c 2027 6865  adless_txt', 'he
-000243f0: 6164 6c65 7373 5f63 7376 272c 2027 6865  adless_csv', 'he
-00024400: 6164 5f63 7376 272c 2027 5769 7465 635f  ad_csv', 'Witec_
-00024410: 4153 4349 4927 2c0a 2020 2020 2020 2020  ASCII',.        
-00024420: 2748 4f52 4942 415f 7478 7427 2c20 2752  'HORIBA_txt', 'R
-00024430: 656e 6973 6861 775f 7478 7427 0a0a 2020  enishaw_txt'..  
-00024440: 2020 736b 6577 6e65 7373 3a20 2761 6273    skewness: 'abs
-00024450: 2720 6f72 2027 6469 7227 0a20 2020 2020  ' or 'dir'.     
-00024460: 2020 2049 6620 2761 6273 272c 2067 6976     If 'abs', giv
-00024470: 6573 2061 6273 6f6c 7574 6520 736b 6577  es absolute skew
-00024480: 6e65 7373 2028 652e 672e 2c20 6c61 7267  ness (e.g., larg
-00024490: 6573 7420 706f 7373 6962 6c65 206e 756d  est possible num
-000244a0: 6265 7220 7265 6761 7264 6c65 7373 206f  ber regardless o
-000244b0: 6620 6469 7265 6374 696f 6e29 0a20 2020  f direction).   
-000244c0: 2020 2020 2069 6620 2764 6972 2720 646f       if 'dir' do
-000244d0: 6573 2073 6b65 776e 6573 7320 6173 206f  es skewness as o
-000244e0: 6e65 2073 6964 6520 6f76 6572 2074 6865  ne side over the
-000244f0: 206f 7468 6572 0a0a 0a20 2020 2068 6569   other...    hei
-00024500: 6768 742c 2070 726f 6d69 6e65 6e63 652c  ght, prominence,
-00024510: 2077 6964 7468 3a20 666c 6f61 740a 2020   width: float.  
-00024520: 2020 2020 2020 5363 6970 7920 6669 6e64        Scipy find
-00024530: 2070 6561 6b20 7061 7261 6d65 7465 7273   peak parameters
-00024540: 0a0a 2020 2020 706c 6f74 5f66 6967 7572  ..    plot_figur
-00024550: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
-00024560: 6966 2054 7275 652c 2070 6c6f 7473 2061  if True, plots a
-00024570: 6e64 2073 6176 6573 2061 2066 6967 7572  nd saves a figur
-00024580: 652e 0a0a 2020 2020 6470 693a 2069 6e74  e...    dpi: int
-00024590: 0a20 2020 2020 2020 2064 7069 2074 6f20  .        dpi to 
-000245a0: 7361 7665 2069 6d61 6765 2061 740a 0a0a  save image at...
-000245b0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-000245c0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020   -----------.   
-000245d0: 2070 642e 4461 7461 4672 616d 6520 7769   pd.DataFrame wi
-000245e0: 7468 2069 6e66 6f72 6d61 7469 6f6e 2061  th information a
-000245f0: 626f 7574 2066 696c 6520 616e 6420 736b  bout file and sk
-00024600: 6577 6e65 7373 2070 6172 616d 6574 6572  ewness parameter
-00024610: 732e 0a0a 2020 2020 2222 220a 0a0a 0a20  s...    """.... 
-00024620: 2020 2079 5f63 6f72 725f 6469 6164 312c     y_corr_diad1,
-00024630: 2050 795f 6261 7365 5f64 6961 6431 2c20   Py_base_diad1, 
-00024640: 785f 6469 6164 312c 2020 4469 6164 5f73  x_diad1,  Diad_s
-00024650: 686f 7274 2c20 5079 5f62 6173 655f 6469  hort, Py_base_di
-00024660: 6164 312c 2050 665f 6261 7365 6c69 6e65  ad1, Pf_baseline
-00024670: 2c20 2042 6173 656c 696e 655f 7973 7562  ,  Baseline_ysub
-00024680: 5f64 6961 6431 2c20 4261 7365 6c69 6e65  _diad1, Baseline
-00024690: 5f78 5f64 6961 6431 2c20 4261 7365 6c69  _x_diad1, Baseli
-000246a0: 6e65 2c20 7370 616e 3d72 656d 6f76 655f  ne, span=remove_
-000246b0: 6469 6164 5f62 6173 656c 696e 6528 0a20  diad_baseline(. 
-000246c0: 2020 2070 6174 683d 7061 7468 2c20 6669     path=path, fi
-000246d0: 6c65 6e61 6d65 3d66 696c 656e 616d 652c  lename=filename,
-000246e0: 2066 696c 6574 7970 653d 6669 6c65 7479   filetype=filety
-000246f0: 7065 2c20 4e5f 706f 6c79 3d63 6f6e 6669  pe, N_poly=confi
-00024700: 6731 2e4e 5f70 6f6c 795f 6263 6b5f 6469  g1.N_poly_bck_di
-00024710: 6164 312c 0a20 2020 206c 6f77 6572 5f62  ad1,.    lower_b
-00024720: 636b 3d63 6f6e 6669 6731 2e6c 6f77 6572  ck=config1.lower
-00024730: 5f62 636b 5f64 6961 6431 2c20 7570 7065  _bck_diad1, uppe
-00024740: 725f 6263 6b3d 636f 6e66 6967 312e 7570  r_bck=config1.up
-00024750: 7065 725f 6263 6b5f 6469 6164 312c 2070  per_bck_diad1, p
-00024760: 6c6f 745f 6669 6775 7265 3d46 616c 7365  lot_figure=False
-00024770: 290a 0a0a 0a20 2020 2078 5f6c 696e 5f62  )....    x_lin_b
-00024780: 6173 656c 696e 653d 6e70 2e6c 696e 7370  aseline=np.linsp
-00024790: 6163 6528 636f 6e66 6967 312e 6c6f 7765  ace(config1.lowe
-000247a0: 725f 6263 6b5f 6469 6164 315b 305d 2c20  r_bck_diad1[0], 
-000247b0: 636f 6e66 6967 312e 7570 7065 725f 6263  config1.upper_bc
-000247c0: 6b5f 6469 6164 315b 315d 2c20 3130 3030  k_diad1[1], 1000
-000247d0: 3030 290a 2020 2020 7962 6173 655f 786c  00).    ybase_xl
-000247e0: 696e 3d50 665f 6261 7365 6c69 6e65 2878  in=Pf_baseline(x
-000247f0: 5f6c 696e 5f62 6173 656c 696e 6529 0a0a  _lin_baseline)..
-00024800: 0a0a 2020 2020 2320 4765 7420 7820 616e  ..    # Get x an
-00024810: 6420 7920 7265 6164 7920 746f 206d 616b  d y ready to mak
-00024820: 6520 6120 6375 6269 6320 7370 6c69 6e65  e a cubic spline
-00024830: 2074 6872 6f75 6768 2064 6174 610a 2020   through data.  
-00024840: 2020 783d 785f 6469 6164 310a 2020 2020    x=x_diad1.    
-00024850: 793d 795f 636f 7272 5f64 6961 6431 0a0a  y=y_corr_diad1..
-00024860: 2020 2020 2320 4669 7420 6120 2063 7562      # Fit a  cub
-00024870: 6963 2073 706c 696e 650a 2020 2020 6632  ic spline.    f2
-00024880: 203d 2069 6e74 6572 7031 6428 782c 2079   = interp1d(x, y
-00024890: 2c20 6b69 6e64 3d27 6375 6269 6327 290a  , kind='cubic').
-000248a0: 2020 2020 785f 6e65 773d 6e70 2e6c 696e      x_new=np.lin
-000248b0: 7370 6163 6528 6e70 2e6d 696e 2878 292c  space(np.min(x),
-000248c0: 206e 702e 6d61 7828 7829 2c20 3130 3030   np.max(x), 1000
-000248d0: 3030 290a 0a20 2020 2079 5f63 7562 3d66  00)..    y_cub=f
-000248e0: 3228 785f 6e65 7729 0a0a 0a0a 2020 2020  2(x_new)....    
-000248f0: 2320 5573 6520 5363 6970 7920 6669 6e64  # Use Scipy find
-00024900: 2070 6561 6b73 2074 6f20 6765 7420 7468   peaks to get th
-00024910: 6520 6269 6767 6573 7420 7065 616b 0a20  e biggest peak. 
-00024920: 2020 2068 6569 6768 743d 6865 6967 6874     height=height
-00024930: 0a20 2020 2070 6561 6b73 203d 2066 696e  .    peaks = fin
-00024940: 645f 7065 616b 7328 795f 6375 622c 2068  d_peaks(y_cub, h
-00024950: 6569 6768 743d 6865 6967 6874 2c20 7072  eight=height, pr
-00024960: 6f6d 696e 656e 6365 3d70 726f 6d69 6e65  ominence=promine
-00024970: 6e63 652c 2077 6964 7468 3d77 6964 7468  nce, width=width
-00024980: 290a 2020 2020 7065 616b 5f68 6569 6768  ).    peak_heigh
-00024990: 743d 7065 616b 735b 315d 5b27 7065 616b  t=peaks[1]['peak
-000249a0: 5f68 6569 6768 7473 275d 0a20 2020 2070  _heights'].    p
-000249b0: 6561 6b5f 706f 7320 3d20 785f 6e65 775b  eak_pos = x_new[
-000249c0: 7065 616b 735b 305d 5d0a 0a20 2020 2023  peaks[0]]..    #
-000249d0: 2066 696e 6420 6d61 7820 7065 616b 2e20   find max peak. 
-000249e0: 2070 7574 2069 6e74 6f20 6466 2062 6563   put into df bec
-000249f0: 6175 7365 2069 276d 206c 617a 790a 2020  ause i'm lazy.  
-00024a00: 2020 7065 616b 5f64 663d 7064 2e44 6174    peak_df=pd.Dat
-00024a10: 6146 7261 6d65 2864 6174 613d 7b27 706f  aFrame(data={'po
-00024a20: 7327 3a20 7065 616b 5f70 6f73 2c0a 2020  s': peak_pos,.  
-00024a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024a40: 2020 2020 2020 2768 6569 6768 7427 3a20        'height': 
-00024a50: 7065 616b 5f68 6569 6768 747d 290a 0a20  peak_height}).. 
-00024a60: 2020 2023 2046 696e 6420 6269 6765 7374     # Find bigest
-00024a70: 2070 6561 6b73 2c0a 2020 2020 6466 5f70   peaks,.    df_p
-00024a80: 6561 6b5f 736f 7274 3d70 6561 6b5f 6466  eak_sort=peak_df
-00024a90: 2e73 6f72 745f 7661 6c75 6573 2827 6865  .sort_values('he
-00024aa0: 6967 6874 272c 2061 7869 733d 302c 2061  ight', axis=0, a
-00024ab0: 7363 656e 6469 6e67 3d46 616c 7365 290a  scending=False).
-00024ac0: 2020 2020 6466 5f70 6561 6b5f 736f 7274      df_peak_sort
-00024ad0: 5f74 7269 6d3d 6466 5f70 6561 6b5f 736f  _trim=df_peak_so
-00024ae0: 7274 5b30 3a31 5d0a 2020 2020 5065 616b  rt[0:1].    Peak
-00024af0: 5f43 656e 7465 723d 6466 5f70 6561 6b5f  _Center=df_peak_
-00024b00: 736f 7274 5f74 7269 6d5b 2770 6f73 275d  sort_trim['pos']
-00024b10: 0a20 2020 2050 6561 6b5f 4865 6967 6874  .    Peak_Height
-00024b20: 3d64 665f 7065 616b 5f73 6f72 745f 7472  =df_peak_sort_tr
-00024b30: 696d 5b27 6865 6967 6874 275d 0a0a 0a20  im['height']... 
-00024b40: 2020 2023 2046 696e 6420 696e 7465 6e73     # Find intens
-00024b50: 6974 7920 6375 7420 6f66 660a 2020 2020  ity cut off.    
-00024b60: 795f 696e 745f 6375 743d 5065 616b 5f48  y_int_cut=Peak_H
-00024b70: 6569 6768 742e 696c 6f63 5b30 5d2a 696e  eight.iloc[0]*in
-00024b80: 745f 6375 745f 6f66 660a 0a20 2020 2023  t_cut_off..    #
-00024b90: 2053 706c 6974 2074 6865 2061 7272 6179   Split the array
-00024ba0: 2069 6e74 6f20 6120 4c48 5320 616e 6420   into a LHS and 
-00024bb0: 6120 5248 530a 0a20 2020 204c 4853 5f79  a RHS..    LHS_y
-00024bc0: 3d79 5f63 7562 5b78 5f6e 6577 3c3d 5065  =y_cub[x_new<=Pe
-00024bd0: 616b 5f43 656e 7465 722e 7661 6c75 6573  ak_Center.values
-00024be0: 5d0a 2020 2020 5248 535f 793d 795f 6375  ].    RHS_y=y_cu
-00024bf0: 625b 785f 6e65 773e 5065 616b 5f43 656e  b[x_new>Peak_Cen
-00024c00: 7465 722e 7661 6c75 6573 5d0a 0a20 2020  ter.values]..   
-00024c10: 204c 4853 5f78 3d78 5f6e 6577 5b78 5f6e   LHS_x=x_new[x_n
-00024c20: 6577 3c3d 5065 616b 5f43 656e 7465 722e  ew<=Peak_Center.
-00024c30: 7661 6c75 6573 5d0a 2020 2020 5248 535f  values].    RHS_
-00024c40: 783d 785f 6e65 775b 785f 6e65 773e 5065  x=x_new[x_new>Pe
-00024c50: 616b 5f43 656e 7465 722e 7661 6c75 6573  ak_Center.values
-00024c60: 5d0a 0a20 2020 2023 204e 6565 6420 746f  ]..    # Need to
-00024c70: 2066 6c69 7020 4c48 5320 746f 2070 7574   flip LHS to put
-00024c80: 2069 6e74 6f20 7468 6520 6669 6e64 2063   into the find c
-00024c90: 6c6f 7365 7374 2066 756e 6374 696f 6e0a  losest function.
-00024ca0: 2020 2020 4c48 535f 795f 666c 6970 3d6e      LHS_y_flip=n
-00024cb0: 702e 666c 6970 284c 4853 5f79 290a 2020  p.flip(LHS_y).  
-00024cc0: 2020 4c48 535f 785f 666c 6970 3d6e 702e    LHS_x_flip=np.
-00024cd0: 666c 6970 284c 4853 5f78 290a 0a20 2020  flip(LHS_x)..   
-00024ce0: 2076 616c 3d6e 702e 6172 676d 6178 284c   val=np.argmax(L
-00024cf0: 4853 5f79 5f66 6c69 703c 795f 696e 745f  HS_y_flip<y_int_
-00024d00: 6375 7429 0a0a 2020 2020 7661 6c32 3d6e  cut)..    val2=n
-00024d10: 702e 6172 676d 6178 2852 4853 5f79 3c79  p.argmax(RHS_y<y
-00024d20: 5f69 6e74 5f63 7574 290a 0a0a 2020 2020  _int_cut)...    
-00024d30: 2320 4669 6e64 206e 6561 7265 7374 2078  # Find nearest x
-00024d40: 2075 6e69 7420 746f 2074 6869 7320 7661   unit to this va
-00024d50: 6c75 650a 2020 2020 795f 6e65 6172 6573  lue.    y_neares
-00024d60: 745f 4c48 533d 4c48 535f 795f 666c 6970  t_LHS=LHS_y_flip
-00024d70: 5b76 616c 5d0a 2020 2020 785f 6e65 6172  [val].    x_near
-00024d80: 6573 745f 4c48 533d 4c48 535f 785f 666c  est_LHS=LHS_x_fl
-00024d90: 6970 5b76 616c 5d0a 0a20 2020 2079 5f6e  ip[val]..    y_n
-00024da0: 6561 7265 7374 5f52 4853 3d52 4853 5f79  earest_RHS=RHS_y
-00024db0: 5b76 616c 325d 0a20 2020 2078 5f6e 6561  [val2].    x_nea
-00024dc0: 7265 7374 5f52 4853 3d52 4853 5f78 5b76  rest_RHS=RHS_x[v
-00024dd0: 616c 325d 0a0a 0a20 2020 2023 2052 6574  al2]...    # Ret
-00024de0: 7572 6e20 536b 6577 6e65 7373 0a20 2020  urn Skewness.   
-00024df0: 204c 4853 5f43 656e 7465 723d 6162 7328   LHS_Center=abs(
-00024e00: 785f 6e65 6172 6573 745f 4c48 532d 5065  x_nearest_LHS-Pe
-00024e10: 616b 5f43 656e 7465 7229 0a20 2020 2052  ak_Center).    R
-00024e20: 4853 5f43 656e 7465 723d 6162 7328 785f  HS_Center=abs(x_
-00024e30: 6e65 6172 6573 745f 5248 532d 5065 616b  nearest_RHS-Peak
-00024e40: 5f43 656e 7465 7229 0a0a 0a20 2020 2341  _Center)...   #A
-00024e50: 6c73 6f20 6765 7420 6f70 7469 6f6e 2074  lso get option t
-00024e60: 6f20 616c 7761 7973 2074 616b 6520 6269  o always take bi
-00024e70: 6767 6573 7420 7661 6c75 6520 6f66 2073  ggest value of s
-00024e80: 6b65 776e 6573 730a 2020 2020 6966 2073  kewness.    if s
-00024e90: 6b65 776e 6573 733d 3d27 6162 7327 3a0a  kewness=='abs':.
-00024ea0: 2020 2020 2020 2020 6966 204c 4853 5f43          if LHS_C
-00024eb0: 656e 7465 722e 7661 6c75 6573 3e52 4853  enter.values>RHS
-00024ec0: 5f43 656e 7465 722e 7661 6c75 6573 3a0a  _Center.values:.
-00024ed0: 2020 2020 2020 2020 2020 2020 4153 3d4c              AS=L
-00024ee0: 4853 5f43 656e 7465 722e 7661 6c75 6573  HS_Center.values
-00024ef0: 2f52 4853 5f43 656e 7465 722e 7661 6c75  /RHS_Center.valu
-00024f00: 6573 0a20 2020 2020 2020 2065 6c73 653a  es.        else:
-00024f10: 0a20 2020 2020 2020 2020 2020 2041 533d  .            AS=
-00024f20: 5248 535f 4365 6e74 6572 2e76 616c 7565  RHS_Center.value
-00024f30: 732f 4c48 535f 4365 6e74 6572 2e76 616c  s/LHS_Center.val
-00024f40: 7565 730a 2020 2020 656c 6966 2073 6b65  ues.    elif ske
-00024f50: 776e 6573 733d 3d27 6469 7227 3a0a 2020  wness=='dir':.  
-00024f60: 2020 2020 2020 4153 3d52 4853 5f43 656e        AS=RHS_Cen
-00024f70: 7465 722e 7661 6c75 6573 2f4c 4853 5f43  ter.values/LHS_C
-00024f80: 656e 7465 722e 7661 6c75 6573 0a0a 0a20  enter.values... 
-00024f90: 2020 2069 6620 706c 6f74 5f66 6967 7572     if plot_figur
-00024fa0: 6520 6973 2054 7275 653a 0a0a 2020 2020  e is True:..    
-00024fb0: 2020 2020 2320 4d61 6b65 2070 7265 7474      # Make prett
-00024fc0: 7920 6669 6775 7265 2073 686f 7769 6e67  y figure showing
-00024fd0: 2062 6163 6b67 726f 756e 6420 7375 6274   background subt
-00024fe0: 7261 6374 6f69 6e20 726f 7574 696e 650a  ractoin routine.
-00024ff0: 2020 2020 2020 2020 6669 672c 2028 2861          fig, ((a
-00025000: 7832 2c20 6178 3129 2c20 2861 7833 2c20  x2, ax1), (ax3, 
-00025010: 6178 3429 2920 3d20 706c 742e 7375 6270  ax4)) = plt.subp
-00025020: 6c6f 7473 2832 2c20 322c 2066 6967 7369  lots(2, 2, figsi
-00025030: 7a65 3d28 3130 2c31 3029 290a 2020 2020  ze=(10,10)).    
-00025040: 2020 2020 6669 672e 7375 7074 6974 6c65      fig.suptitle
-00025050: 2827 4469 6164 2031 2053 6b65 776e 6573  ('Diad 1 Skewnes
-00025060: 7320 6669 6c65 3d20 272b 2073 7472 2866  s file= '+ str(f
-00025070: 696c 656e 616d 6529 2c20 666f 6e74 7369  ilename), fontsi
-00025080: 7a65 3d31 362c 2078 3d30 2e35 2c20 793d  ze=16, x=0.5, y=
-00025090: 312e 3029 0a0a 2020 2020 2020 2020 6178  1.0)..        ax
-000250a0: 322e 7365 745f 7469 746c 6528 2761 2920  2.set_title('a) 
-000250b0: 5370 6563 7472 6127 290a 2020 2020 2020  Spectra').      
-000250c0: 2020 6178 322e 706c 6f74 2844 6961 645f    ax2.plot(Diad_
-000250d0: 7368 6f72 745b 3a2c 2030 5d2c 2044 6961  short[:, 0], Dia
-000250e0: 645f 7368 6f72 745b 3a2c 2031 5d2c 2027  d_short[:, 1], '
-000250f0: 2d72 272c 206c 6162 656c 3d27 4461 7461  -r', label='Data
-00025100: 2729 0a20 2020 2020 2020 2061 7832 2e73  ').        ax2.s
-00025110: 6574 5f78 6c69 6d28 5b63 6f6e 6669 6731  et_xlim([config1
-00025120: 2e6c 6f77 6572 5f62 636b 5f64 6961 6431  .lower_bck_diad1
-00025130: 5b30 5d2b 3430 2c20 636f 6e66 6967 312e  [0]+40, config1.
-00025140: 7570 7065 725f 6263 6b5f 6469 6164 315b  upper_bck_diad1[
-00025150: 315d 2d34 305d 290a 2020 2020 2020 2020  1]-40]).        
-00025160: 6178 312e 7365 745f 7469 746c 6528 2762  ax1.set_title('b
-00025170: 2920 4261 636b 6772 6f75 6e64 2066 6974  ) Background fit
-00025180: 2729 0a20 2020 2020 2020 2061 7831 2e70  ').        ax1.p
-00025190: 6c6f 7428 4469 6164 5f73 686f 7274 5b3a  lot(Diad_short[:
-000251a0: 2c20 305d 2c20 4469 6164 5f73 686f 7274  , 0], Diad_short
-000251b0: 5b3a 2c20 315d 2c20 272e 2d63 272c 206c  [:, 1], '.-c', l
-000251c0: 6162 656c 3d27 4461 7461 2729 0a0a 2020  abel='Data')..  
-000251d0: 2020 2020 2020 6178 312e 706c 6f74 2842        ax1.plot(B
-000251e0: 6173 656c 696e 655b 3a2c 2030 5d2c 2042  aseline[:, 0], B
-000251f0: 6173 656c 696e 655b 3a2c 2031 5d2c 2027  aseline[:, 1], '
-00025200: 2e62 272c 206c 6162 656c 3d27 6263 6b27  .b', label='bck'
-00025210: 290a 2020 2020 2020 2020 6178 312e 706c  ).        ax1.pl
-00025220: 6f74 2844 6961 645f 7368 6f72 745b 3a2c  ot(Diad_short[:,
-00025230: 2030 5d2c 2050 795f 6261 7365 5f64 6961   0], Py_base_dia
-00025240: 6431 2c20 272d 6b27 2c20 6c61 6265 6c3d  d1, '-k', label=
-00025250: 2762 636b 2066 6974 2729 0a20 2020 2020  'bck fit').     
-00025260: 2020 2061 7833 2e73 6574 5f74 6974 6c65     ax3.set_title
-00025270: 2827 6329 2042 6163 6b67 726f 756e 6420  ('c) Background 
-00025280: 7375 6274 7261 6374 6564 2729 0a20 2020  subtracted').   
-00025290: 2020 2020 2061 7833 2e70 6c6f 7428 785f       ax3.plot(x_
-000252a0: 6469 6164 312c 795f 636f 7272 5f64 6961  diad1,y_corr_dia
-000252b0: 6431 2c20 272d 7227 2c20 6c61 6265 6c3d  d1, '-r', label=
-000252c0: 2742 636b 2073 7562 2729 0a0a 2020 2020  'Bck sub')..    
-000252d0: 2320 4164 6473 2063 7562 6963 2069 6e74  # Adds cubic int
-000252e0: 6572 706f 6c6f 6174 696f 6e20 666f 7220  erpoloation for 
-000252f0: 696e 7370 6563 7469 6f6e 0a0a 2020 2020  inspection..    
-00025300: 2020 2020 6178 342e 7365 745f 7469 746c      ax4.set_titl
-00025310: 6528 2764 2920 4375 6269 6320 5370 6c69  e('d) Cubic Spli
-00025320: 6e65 2729 0a0a 0a0a 0a20 2020 2020 2020  ne').....       
-00025330: 2061 7834 2e70 6c6f 7428 5b78 5f6e 6561   ax4.plot([x_nea
-00025340: 7265 7374 5f4c 4853 2c20 5065 616b 5f43  rest_LHS, Peak_C
-00025350: 656e 7465 722e 696c 6f63 5b30 5d5d 2c20  enter.iloc[0]], 
-00025360: 5b79 5f69 6e74 5f63 7574 2c20 795f 696e  [y_int_cut, y_in
-00025370: 745f 6375 745d 2c20 272d 6727 290a 0a20  t_cut], '-g').. 
-00025380: 2020 2020 2020 2061 7834 2e61 6e6e 6f74         ax4.annot
-00025390: 6174 6528 7374 7228 6e70 2e72 6f75 6e64  ate(str(np.round
-000253a0: 284c 4853 5f43 656e 7465 722e 7661 6c75  (LHS_Center.valu
-000253b0: 6573 5b30 5d2c 2032 2929 2c0a 2020 2020  es[0], 2)),.    
-000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000253d0: 2078 793d 2878 5f6e 6561 7265 7374 5f4c   xy=(x_nearest_L
-000253e0: 4853 2d33 2c20 795f 696e 745f 6375 742b  HS-3, y_int_cut+
-000253f0: 2850 6561 6b5f 4865 6967 6874 2d79 5f69  (Peak_Height-y_i
-00025400: 6e74 5f63 7574 292f 3130 292c 2078 7963  nt_cut)/10), xyc
-00025410: 6f6f 7264 733d 2264 6174 6122 2c0a 2020  oords="data",.  
-00025420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025430: 2020 2066 6f6e 7473 697a 653d 3132 2c20     fontsize=12, 
-00025440: 636f 6c6f 723d 2767 7265 656e 2729 0a20  color='green'). 
-00025450: 2020 2020 2020 2061 7834 2e70 6c6f 7428         ax4.plot(
-00025460: 785f 6e65 6172 6573 745f 4c48 532c 2079  x_nearest_LHS, y
-00025470: 5f6e 6561 7265 7374 5f4c 4853 2c20 272a  _nearest_LHS, '*
-00025480: 6b27 2c20 6d66 633d 2767 7265 656e 272c  k', mfc='green',
-00025490: 6d73 3d31 352c 206c 6162 656c 3d27 5248  ms=15, label='RH
-000254a0: 2074 6965 2729 0a0a 0a0a 2020 2020 2020   tie')....      
-000254b0: 2020 6178 342e 706c 6f74 285b 5065 616b    ax4.plot([Peak
-000254c0: 5f43 656e 7465 722e 696c 6f63 5b30 5d2c  _Center.iloc[0],
-000254d0: 2078 5f6e 6561 7265 7374 5f52 4853 5d2c   x_nearest_RHS],
-000254e0: 205b 795f 696e 745f 6375 742c 2079 5f69   [y_int_cut, y_i
-000254f0: 6e74 5f63 7574 5d2c 2027 2d27 2c20 636f  nt_cut], '-', co
-00025500: 6c6f 723d 2767 7265 7927 290a 2020 2020  lor='grey').    
-00025510: 2020 2020 6178 342e 616e 6e6f 7461 7465      ax4.annotate
-00025520: 2873 7472 286e 702e 726f 756e 6428 5248  (str(np.round(RH
-00025530: 535f 4365 6e74 6572 2e76 616c 7565 735b  S_Center.values[
-00025540: 305d 2c20 3229 292c 0a20 2020 2020 2020  0], 2)),.       
-00025550: 2020 2020 2020 2020 2020 2020 2020 7879                xy
-00025560: 3d28 785f 6e65 6172 6573 745f 5248 532b  =(x_nearest_RHS+
-00025570: 332c 2079 5f69 6e74 5f63 7574 2b28 5065  3, y_int_cut+(Pe
-00025580: 616b 5f48 6569 6768 742e 696c 6f63 5b30  ak_Height.iloc[0
-00025590: 5d2d 795f 696e 745f 6375 7429 2f31 3029  ]-y_int_cut)/10)
-000255a0: 2c20 7879 636f 6f72 6473 3d22 6461 7461  , xycoords="data
-000255b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000255c0: 2020 2020 2020 2020 2066 6f6e 7473 697a           fontsiz
-000255d0: 653d 3132 2c20 636f 6c6f 723d 2767 7265  e=12, color='gre
-000255e0: 7927 290a 2020 2020 2020 2020 6178 342e  y').        ax4.
-000255f0: 706c 6f74 2878 5f6e 6561 7265 7374 5f52  plot(x_nearest_R
-00025600: 4853 2c20 795f 6e65 6172 6573 745f 5248  HS, y_nearest_RH
-00025610: 532c 2027 2a6b 272c 206d 6663 3d27 6772  S, '*k', mfc='gr
-00025620: 6579 272c 206d 733d 3135 2c20 6c61 6265  ey', ms=15, labe
-00025630: 6c3d 274c 4820 7469 6527 290a 0a0a 0a0a  l='LH tie').....
-00025640: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
-00025650: 2878 2c20 792c 2027 2e72 2729 0a20 2020  (x, y, '.r').   
-00025660: 2020 2020 2061 7834 2e70 6c6f 7428 785f       ax4.plot(x_
-00025670: 6e65 772c 2079 5f63 7562 2c20 272d 6b27  new, y_cub, '-k'
-00025680: 290a 0a20 2020 2020 2020 2061 7834 2e70  )..        ax4.p
-00025690: 6c6f 7428 5b50 6561 6b5f 4365 6e74 6572  lot([Peak_Center
-000256a0: 2e69 6c6f 635b 305d 2c20 5065 616b 5f43  .iloc[0], Peak_C
-000256b0: 656e 7465 722e 696c 6f63 5b30 5d5d 2c20  enter.iloc[0]], 
-000256c0: 5b50 6561 6b5f 4865 6967 6874 2e69 6c6f  [Peak_Height.ilo
-000256d0: 635b 305d 2c20 5065 616b 5f48 6569 6768  c[0], Peak_Heigh
-000256e0: 742e 696c 6f63 5b30 5d5d 2c0a 2020 2020  t.iloc[0]],.    
-000256f0: 2020 2020 2020 2020 2027 2a6b 272c 206d           '*k', m
-00025700: 6663 3d27 626c 7565 272c 206d 733d 3135  fc='blue', ms=15
-00025710: 2c20 6c61 6265 6c3d 2753 6369 7079 2043  , label='Scipy C
-00025720: 656e 7465 7227 290a 0a0a 2020 2020 2020  enter')...      
-00025730: 2020 2320 4164 6420 746f 2070 6c6f 740a    # Add to plot.
-00025740: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
-00025750: 7428 636f 6e66 6967 312e 6c6f 7765 725f  t(config1.lower_
-00025760: 6263 6b5f 6469 6164 315b 305d 2c20 636f  bck_diad1[0], co
-00025770: 6e66 6967 312e 7570 7065 725f 6263 6b5f  nfig1.upper_bck_
-00025780: 6469 6164 315b 315d 2c20 5b79 5f69 6e74  diad1[1], [y_int
-00025790: 5f63 7574 2c20 795f 696e 745f 6375 745d  _cut, y_int_cut]
-000257a0: 2c20 273a 7227 290a 0a0a 0a0a 2020 2020  , ':r').....    
-000257b0: 2020 2020 6178 342e 7365 745f 786c 696d      ax4.set_xlim
-000257c0: 285b 785f 6e65 6172 6573 745f 4c48 532d  ([x_nearest_LHS-
-000257d0: 3130 2c20 785f 6e65 6172 6573 745f 5248  10, x_nearest_RH
-000257e0: 532b 3130 5d29 0a20 2020 2020 2020 2061  S+10]).        a
-000257f0: 7834 2e73 6574 5f79 6c69 6d28 5b30 2d31  x4.set_ylim([0-1
-00025800: 302c 2050 6561 6b5f 4865 6967 6874 2e69  0, Peak_Height.i
-00025810: 6c6f 635b 305d 2a31 2e32 5d29 0a20 2020  loc[0]*1.2]).   
-00025820: 2020 2020 2061 7834 2e70 6c6f 7428 5b50       ax4.plot([P
-00025830: 6561 6b5f 4365 6e74 6572 2e69 6c6f 635b  eak_Center.iloc[
-00025840: 305d 2c20 5065 616b 5f43 656e 7465 722e  0], Peak_Center.
-00025850: 696c 6f63 5b30 5d5d 2c20 5b30 2c20 5065  iloc[0]], [0, Pe
-00025860: 616b 5f48 6569 6768 742e 696c 6f63 5b30  ak_Height.iloc[0
-00025870: 5d5d 2c20 273a 6227 290a 0a0a 0a20 2020  ]], ':b')....   
-00025880: 2020 2020 2061 7834 2e61 6e6e 6f74 6174       ax4.annotat
-00025890: 6528 2753 6b65 776e 6573 733d 272b 7374  e('Skewness='+st
-000258a0: 7228 6e70 2e72 6f75 6e64 2841 535b 305d  r(np.round(AS[0]
-000258b0: 2c20 3229 292c 0a20 2020 2020 2020 2020  , 2)),.         
-000258c0: 2020 2020 2020 2020 2020 2020 7879 3d28              xy=(
-000258d0: 785f 6e65 6172 6573 745f 5248 532b 322c  x_nearest_RHS+2,
-000258e0: 2079 5f69 6e74 5f63 7574 2b79 5f69 6e74   y_int_cut+y_int
-000258f0: 5f63 7574 2b28 5065 616b 5f48 6569 6768  _cut+(Peak_Heigh
-00025900: 742e 696c 6f63 5b30 5d2d 795f 696e 745f  t.iloc[0]-y_int_
-00025910: 6375 7429 2f31 3029 2c20 7879 636f 6f72  cut)/10), xycoor
-00025920: 6473 3d22 6461 7461 222c 0a20 2020 2020  ds="data",.     
-00025930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025940: 2066 6f6e 7473 697a 653d 3132 290a 0a20   fontsize=12).. 
-00025950: 2020 2020 2020 2061 7832 2e6c 6567 656e         ax2.legen
-00025960: 6428 290a 2020 2020 2020 2020 6178 312e  d().        ax1.
-00025970: 6c65 6765 6e64 2829 0a20 2020 2020 2020  legend().       
-00025980: 2061 7833 2e6c 6567 656e 6428 290a 2020   ax3.legend().  
-00025990: 2020 2020 2020 6178 342e 6c65 6765 6e64        ax4.legend
-000259a0: 2829 0a20 2020 2020 2020 2061 7831 2e73  ().        ax1.s
-000259b0: 6574 5f78 6c61 6265 6c28 2757 6176 656e  et_xlabel('Waven
-000259c0: 756d 6265 7220 2863 6d24 5e7b 2d31 7d24  umber (cm$^{-1}$
-000259d0: 2927 290a 2020 2020 2020 2020 6178 322e  )').        ax2.
-000259e0: 7365 745f 786c 6162 656c 2827 5761 7665  set_xlabel('Wave
-000259f0: 6e75 6d62 6572 2028 636d 245e 7b2d 317d  number (cm$^{-1}
-00025a00: 2429 2729 0a20 2020 2020 2020 2061 7833  $)').        ax3
-00025a10: 2e73 6574 5f78 6c61 6265 6c28 2757 6176  .set_xlabel('Wav
-00025a20: 656e 756d 6265 7220 2863 6d24 5e7b 2d31  enumber (cm$^{-1
-00025a30: 7d24 2927 290a 2020 2020 2020 2020 6178  }$)').        ax
-00025a40: 342e 7365 745f 786c 6162 656c 2827 5761  4.set_xlabel('Wa
-00025a50: 7665 6e75 6d62 6572 2028 636d 245e 7b2d  venumber (cm$^{-
-00025a60: 317d 2429 2729 0a20 2020 2020 2020 2061  1}$)').        a
-00025a70: 7831 2e73 6574 5f79 6c61 6265 6c28 2749  x1.set_ylabel('I
-00025a80: 6e74 656e 7369 7479 2729 0a20 2020 2020  ntensity').     
-00025a90: 2020 2061 7832 2e73 6574 5f79 6c61 6265     ax2.set_ylabe
-00025aa0: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-00025ab0: 2020 2020 2020 2061 7833 2e73 6574 5f79         ax3.set_y
-00025ac0: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-00025ad0: 2729 0a20 2020 2020 2020 2061 7834 2e73  ').        ax4.s
-00025ae0: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-00025af0: 7369 7479 2729 0a20 2020 2020 2020 2066  sity').        f
-00025b00: 6967 2e74 6967 6874 5f6c 6179 6f75 7428  ig.tight_layout(
-00025b10: 290a 0a0a 0a20 2020 2020 2020 2070 6174  )....        pat
-00025b20: 6833 3d70 6174 682b 272f 272b 2753 6b65  h3=path+'/'+'Ske
-00025b30: 776e 6573 735f 696d 6167 6573 270a 2020  wness_images'.  
-00025b40: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00025b50: 2e65 7869 7374 7328 7061 7468 3329 3a0a  .exists(path3):.
-00025b60: 2020 2020 2020 2020 2020 2020 6f75 743d              out=
-00025b70: 2770 6174 6820 6578 6973 7473 270a 2020  'path exists'.  
-00025b80: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025b90: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00025ba0: 6972 7328 7061 7468 2b27 2f27 2b20 2753  irs(path+'/'+ 'S
-00025bb0: 6b65 776e 6573 735f 696d 6167 6573 272c  kewness_images',
-00025bc0: 2065 7869 7374 5f6f 6b3d 4661 6c73 6529   exist_ok=False)
-00025bd0: 0a0a 0a20 2020 2020 2020 2066 696c 653d  ...        file=
-00025be0: 6669 6c65 6e61 6d65 2e72 7370 6c69 7428  filename.rsplit(
-00025bf0: 272e 7478 7427 2c20 3129 5b30 5d0a 2020  '.txt', 1)[0].  
-00025c00: 2020 2020 2020 6669 672e 7361 7665 6669        fig.savefi
-00025c10: 6728 7061 7468 332b 272f 272b 2744 6961  g(path3+'/'+'Dia
-00025c20: 6431 5f73 6b65 776e 6573 735f 7b7d 2e70  d1_skewness_{}.p
-00025c30: 6e67 272e 666f 726d 6174 2866 696c 6529  ng'.format(file)
-00025c40: 2c20 6470 693d 6470 6929 0a0a 2020 2020  , dpi=dpi)..    
-00025c50: 6466 5f6f 7574 3d70 642e 4461 7461 4672  df_out=pd.DataFr
-00025c60: 616d 6528 6461 7461 3d7b 2766 696c 656e  ame(data={'filen
-00025c70: 616d 6527 3a66 696c 656e 616d 652c 0a20  ame':filename,. 
-00025c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c90: 2020 2020 2020 2020 2020 2020 2027 536b               'Sk
-00025ca0: 6577 6e65 7373 5f64 6961 6431 273a 2041  ewness_diad1': A
-00025cb0: 532c 0a20 2020 2020 2020 2020 2020 2020  S,.             
-00025cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025cd0: 2027 4c48 535f 7469 655f 6469 6164 3127   'LHS_tie_diad1'
-00025ce0: 3a20 785f 6e65 6172 6573 745f 4c48 532c  : x_nearest_LHS,
-00025cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025d00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00025d10: 5248 535f 7469 655f 6469 6164 3127 3a20  RHS_tie_diad1': 
-00025d20: 785f 6e65 6172 6573 745f 5248 537d 290a  x_nearest_RHS}).
-00025d30: 0a20 2020 2072 6574 7572 6e20 6466 5f6f  .    return df_o
-00025d40: 7574 0a0a 0a0a 0a64 6566 2061 7373 6573  ut.....def asses
-00025d50: 735f 6469 6164 325f 736b 6577 6e65 7373  s_diad2_skewness
-00025d60: 282a 2c20 2063 6f6e 6669 6731 3a20 6469  (*,  config1: di
-00025d70: 6164 325f 6669 745f 636f 6e66 6967 3d64  ad2_fit_config=d
-00025d80: 6961 6431 5f66 6974 5f63 6f6e 6669 6728  iad1_fit_config(
-00025d90: 292c 2069 6e74 5f63 7574 5f6f 6666 3d30  ), int_cut_off=0
-00025da0: 2e33 2c20 7061 7468 3d4e 6f6e 652c 2066  .3, path=None, f
-00025db0: 696c 656e 616d 653d 4e6f 6e65 2c20 6669  ilename=None, fi
-00025dc0: 6c65 7479 7065 3d4e 6f6e 652c 0a73 6b65  letype=None,.ske
-00025dd0: 776e 6573 733d 2761 6273 272c 2068 6569  wness='abs', hei
-00025de0: 6768 743d 312c 2070 726f 6d69 6e65 6e63  ght=1, prominenc
-00025df0: 653d 352c 2077 6964 7468 3d30 2e35 2c20  e=5, width=0.5, 
-00025e00: 706c 6f74 5f66 6967 7572 653d 5472 7565  plot_figure=True
-00025e10: 2c20 6470 693d 3230 3029 3a0a 0a20 2020  , dpi=200):..   
-00025e20: 2022 2222 2041 7373 6573 7365 7320 536b   """ Assesses Sk
-00025e30: 6577 6e65 7373 206f 6620 4469 6164 2070  ewness of Diad p
-00025e40: 6561 6b73 2e20 5573 6566 756c 2066 6f72  eaks. Useful for
-00025e50: 2069 6465 6e74 6966 7969 6e67 206d 6978   identifying mix
-00025e60: 6564 204c 202b 2056 2070 6861 7365 730a  ed L + V phases.
-00025e70: 2020 2020 2873 6565 2044 6556 6974 7265      (see DeVitre
-00025e80: 2065 7420 616c 2e20 696e 2072 6576 6965   et al. in revie
-00025e90: 7729 0a0a 0a20 2020 2050 6172 616d 6574  w)...    Paramet
-00025ea0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00025eb0: 2d2d 2d0a 2020 2020 636f 6e66 6967 313a  ---.    config1:
-00025ec0: 2064 6961 6432 5f66 6974 5f63 6f6e 6669   diad2_fit_confi
-00025ed0: 6728 2920 6461 7461 636c 6173 732e 2049  g() dataclass. I
-00025ee0: 6d70 6f72 7420 7061 7261 6d65 7465 7273  mport parameters
-00025ef0: 2066 6f72 2074 6869 7320 6675 6e63 7469   for this functi
-00025f00: 6f6e 2061 7265 2e0a 0a20 2020 2020 2020  on are...       
-00025f10: 206c 6f77 6572 5f62 636b 5f64 6961 6432   lower_bck_diad2
-00025f20: 2c20 7570 7065 725f 6263 6b5f 6469 6164  , upper_bck_diad
-00025f30: 323a 205b 666c 6f61 742c 2066 6c6f 6174  2: [float, float
-00025f40: 5d0a 2020 2020 2020 2020 2020 2020 6261  ].            ba
-00025f50: 636b 6772 6f75 6e64 2070 6f73 6974 696f  ckground positio
-00025f60: 6e20 746f 206c 6566 7420 616e 6420 7269  n to left and ri
-00025f70: 6768 7420 6f66 206f 7665 7261 6c20 6469  ght of overal di
-00025f80: 6164 2072 6567 696f 6e20 2869 6e63 2064  ad region (inc d
-00025f90: 6961 642b 2d48 422b 2d43 3133 290a 0a20  iad+-HB+-C13).. 
-00025fa0: 2020 2020 2020 204e 5f70 6f6c 795f 6263         N_poly_bc
-00025fb0: 6b5f 6469 6164 313a 2069 6e74 0a20 2020  k_diad1: int.   
-00025fc0: 2020 2020 2020 2020 2064 6567 7265 6520           degree 
-00025fd0: 6f66 2070 6f6c 796e 6f6d 6961 6c20 746f  of polynomial to
-00025fe0: 2066 6974 2074 6f20 7468 6520 6261 636b   fit to the back
-00025ff0: 6772 6f75 6e64 2e0a 0a20 2020 2020 2020  ground...       
-00026000: 2065 7863 6c75 6465 5f72 616e 6765 312c   exclude_range1,
-00026010: 2065 7863 6c75 6465 5f72 616e 6765 323a   exclude_range2:
-00026020: 2054 7570 6c65 5b66 6c6f 6174 2c20 666c   Tuple[float, fl
-00026030: 6f61 745d 0a20 2020 2020 2020 2020 2020  oat].           
-00026040: 2052 616e 6765 2074 6f20 6578 636c 7564   Range to exclud
-00026050: 650a 0a20 2020 2069 6e74 5f63 7574 5f6f  e..    int_cut_o
-00026060: 6666 3a20 666c 6f61 740a 2020 2020 2020  ff: float.      
-00026070: 2020 5661 6c75 6520 6f66 2069 6e74 656e    Value of inten
-00026080: 7369 7479 2061 7420 7768 6963 6820 746f  sity at which to
-00026090: 2063 616c 6375 6c61 7465 2074 6865 2073   calculate the s
-000260a0: 6b65 776e 6573 7320 2865 2e67 2e20 302e  kewness (e.g. 0.
-000260b0: 3135 5820 7468 6520 7065 616b 2068 6569  15X the peak hei
-000260c0: 6768 7429 2e0a 0a20 2020 2070 6174 683a  ght)...    path:
-000260d0: 2073 7472 0a20 2020 2020 2020 2046 6f6c   str.        Fol
-000260e0: 6465 7220 7573 6572 2077 6973 6865 7320  der user wishes 
-000260f0: 746f 2072 6561 6420 6461 7461 2066 726f  to read data fro
-00026100: 6d0a 0a20 2020 2066 696c 656e 616d 653a  m..    filename:
-00026110: 2073 7472 0a20 2020 2020 2020 2053 7065   str.        Spe
-00026120: 6369 6669 6320 6669 6c65 2062 6569 6e67  cific file being
-00026130: 2072 6561 640a 0a0a 2020 2020 6669 6c65   read...    file
-00026140: 7479 7065 3a20 7374 720a 2020 2020 2020  type: str.      
-00026150: 2020 4964 656e 7469 6669 6573 2074 7970    Identifies typ
-00026160: 6520 6f66 2066 696c 650a 2020 2020 2020  e of file.      
-00026170: 2020 6368 6f6f 7365 2066 726f 6d20 2757    choose from 'W
-00026180: 6974 6563 5f41 5343 4949 272c 2027 6865  itec_ASCII', 'he
-00026190: 6164 6c65 7373 5f74 7874 272c 2027 6865  adless_txt', 'he
-000261a0: 6164 6c65 7373 5f63 7376 272c 2027 6865  adless_csv', 'he
-000261b0: 6164 5f63 7376 272c 2027 5769 7465 635f  ad_csv', 'Witec_
-000261c0: 4153 4349 4927 2c0a 2020 2020 2020 2020  ASCII',.        
-000261d0: 2748 4f52 4942 415f 7478 7427 2c20 2752  'HORIBA_txt', 'R
-000261e0: 656e 6973 6861 775f 7478 7427 0a0a 2020  enishaw_txt'..  
-000261f0: 2020 736b 6577 6e65 7373 3a20 2761 6273    skewness: 'abs
-00026200: 2720 6f72 2027 6469 7227 0a20 2020 2020  ' or 'dir'.     
-00026210: 2020 2049 6620 2761 6273 272c 2067 6976     If 'abs', giv
-00026220: 6573 2061 6273 6f6c 7574 6520 736b 6577  es absolute skew
-00026230: 6e65 7373 2028 652e 672e 2c20 6c61 7267  ness (e.g., larg
-00026240: 6573 7420 706f 7373 6962 6c65 206e 756d  est possible num
-00026250: 6265 7220 7265 6761 7264 6c65 7373 206f  ber regardless o
-00026260: 6620 6469 7265 6374 696f 6e29 0a20 2020  f direction).   
-00026270: 2020 2020 2069 6620 2764 6972 2720 646f       if 'dir' do
-00026280: 6573 2073 6b65 776e 6573 7320 6173 206f  es skewness as o
-00026290: 6e65 2073 6964 6520 6f76 6572 2074 6865  ne side over the
-000262a0: 206f 7468 6572 0a0a 0a20 2020 2068 6569   other...    hei
-000262b0: 6768 742c 2070 726f 6d69 6e65 6e63 652c  ght, prominence,
-000262c0: 2077 6964 7468 3a20 666c 6f61 740a 2020   width: float.  
-000262d0: 2020 2020 2020 5363 6970 7920 6669 6e64        Scipy find
-000262e0: 2070 6561 6b20 7061 7261 6d65 7465 7273   peak parameters
-000262f0: 0a0a 2020 2020 706c 6f74 5f66 6967 7572  ..    plot_figur
-00026300: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
-00026310: 6966 2054 7275 652c 2070 6c6f 7473 2061  if True, plots a
-00026320: 6e64 2073 6176 6573 2061 2066 6967 7572  nd saves a figur
-00026330: 652e 0a0a 2020 2020 6470 693a 2069 6e74  e...    dpi: int
-00026340: 0a20 2020 2020 2020 2064 7069 2074 6f20  .        dpi to 
-00026350: 7361 7665 2069 6d61 6765 2061 740a 0a0a  save image at...
-00026360: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00026370: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020   -----------.   
-00026380: 2070 642e 4461 7461 4672 616d 6520 7769   pd.DataFrame wi
-00026390: 7468 2069 6e66 6f72 6d61 7469 6f6e 2061  th information a
-000263a0: 626f 7574 2066 696c 6520 616e 6420 736b  bout file and sk
-000263b0: 6577 6e65 7373 2070 6172 616d 6574 6572  ewness parameter
-000263c0: 732e 0a0a 2020 2020 2222 220a 0a0a 2320  s...    """...# 
-000263d0: 4669 7273 742c 2064 6f20 7468 6520 6261  First, do the ba
-000263e0: 636b 6772 6f75 6e64 2073 7562 7472 6163  ckground subtrac
-000263f0: 7469 6f6e 0a20 2020 2079 5f63 6f72 725f  tion.    y_corr_
-00026400: 6469 6164 322c 2050 795f 6261 7365 5f64  diad2, Py_base_d
-00026410: 6961 6432 2c20 785f 6469 6164 322c 2020  iad2, x_diad2,  
-00026420: 4469 6164 5f73 686f 7274 2c20 5079 5f62  Diad_short, Py_b
-00026430: 6173 655f 6469 6164 322c 2050 665f 6261  ase_diad2, Pf_ba
-00026440: 7365 6c69 6e65 2c20 2042 6173 656c 696e  seline,  Baselin
-00026450: 655f 7973 7562 5f64 6961 6432 2c20 4261  e_ysub_diad2, Ba
-00026460: 7365 6c69 6e65 5f78 5f64 6961 6432 2c20  seline_x_diad2, 
-00026470: 4261 7365 6c69 6e65 2c20 7370 616e 3d72  Baseline, span=r
-00026480: 656d 6f76 655f 6469 6164 5f62 6173 656c  emove_diad_basel
-00026490: 696e 6528 0a20 2020 2070 6174 683d 7061  ine(.    path=pa
-000264a0: 7468 2c20 6669 6c65 6e61 6d65 3d66 696c  th, filename=fil
-000264b0: 656e 616d 652c 2066 696c 6574 7970 653d  ename, filetype=
-000264c0: 6669 6c65 7479 7065 2c20 4e5f 706f 6c79  filetype, N_poly
-000264d0: 3d63 6f6e 6669 6731 2e4e 5f70 6f6c 795f  =config1.N_poly_
-000264e0: 6263 6b5f 6469 6164 322c 0a20 2020 206c  bck_diad2,.    l
-000264f0: 6f77 6572 5f62 636b 3d63 6f6e 6669 6731  ower_bck=config1
-00026500: 2e6c 6f77 6572 5f62 636b 5f64 6961 6432  .lower_bck_diad2
-00026510: 2c20 7570 7065 725f 6263 6b3d 636f 6e66  , upper_bck=conf
-00026520: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
-00026530: 6164 322c 2070 6c6f 745f 6669 6775 7265  ad2, plot_figure
-00026540: 3d46 616c 7365 290a 0a0a 0a20 2020 2078  =False)....    x
-00026550: 5f6c 696e 5f62 6173 656c 696e 653d 6e70  _lin_baseline=np
-00026560: 2e6c 696e 7370 6163 6528 636f 6e66 6967  .linspace(config
-00026570: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
-00026580: 325b 305d 2c20 636f 6e66 6967 312e 7570  2[0], config1.up
-00026590: 7065 725f 6263 6b5f 6469 6164 325b 315d  per_bck_diad2[1]
-000265a0: 2c20 3130 3030 3030 290a 2020 2020 7962  , 100000).    yb
-000265b0: 6173 655f 786c 696e 3d50 665f 6261 7365  ase_xlin=Pf_base
-000265c0: 6c69 6e65 2878 5f6c 696e 5f62 6173 656c  line(x_lin_basel
-000265d0: 696e 6529 0a0a 0a0a 2320 4765 7420 7820  ine)....# Get x 
-000265e0: 616e 6420 7920 666f 7220 6375 6269 6320  and y for cubic 
-000265f0: 7370 6c69 6e65 0a20 2020 2078 3d78 5f64  spline.    x=x_d
-00026600: 6961 6432 0a20 2020 2079 3d79 5f63 6f72  iad2.    y=y_cor
-00026610: 725f 6469 6164 320a 0a23 2046 6974 7320  r_diad2..# Fits 
-00026620: 6120 2063 7562 6963 2073 706c 696e 650a  a  cubic spline.
-00026630: 2020 2020 6632 203d 2069 6e74 6572 7031      f2 = interp1
-00026640: 6428 782c 2079 2c20 6b69 6e64 3d27 6375  d(x, y, kind='cu
-00026650: 6269 6327 290a 2020 2020 785f 6e65 773d  bic').    x_new=
-00026660: 6e70 2e6c 696e 7370 6163 6528 6e70 2e6d  np.linspace(np.m
-00026670: 696e 2878 292c 206e 702e 6d61 7828 7829  in(x), np.max(x)
-00026680: 2c20 3130 3030 3030 290a 0a20 2020 2079  , 100000)..    y
-00026690: 5f63 7562 3d66 3228 785f 6e65 7729 0a0a  _cub=f2(x_new)..
-000266a0: 0a0a 2320 5573 6520 5363 6970 7920 6669  ..# Use Scipy fi
-000266b0: 6e64 2070 6561 6b73 2074 6f20 6765 7420  nd peaks to get 
-000266c0: 7468 6174 2063 7562 6963 2070 6561 6b0a  that cubic peak.
-000266d0: 2020 2020 7065 616b 7320 3d20 6669 6e64      peaks = find
-000266e0: 5f70 6561 6b73 2879 5f63 7562 2c20 6865  _peaks(y_cub, he
-000266f0: 6967 6874 3d68 6569 6768 742c 2070 726f  ight=height, pro
-00026700: 6d69 6e65 6e63 653d 7072 6f6d 696e 656e  minence=prominen
-00026710: 6365 2c20 7769 6474 683d 7769 6474 6829  ce, width=width)
-00026720: 0a20 2020 2070 6561 6b5f 6865 6967 6874  .    peak_height
-00026730: 3d70 6561 6b73 5b31 5d5b 2770 6561 6b5f  =peaks[1]['peak_
-00026740: 6865 6967 6874 7327 5d0a 2020 2020 7065  heights'].    pe
-00026750: 616b 5f70 6f73 203d 2078 5f6e 6577 5b70  ak_pos = x_new[p
-00026760: 6561 6b73 5b30 5d5d 0a0a 2020 2020 2320  eaks[0]]..    # 
-00026770: 6669 6e64 206d 6178 2070 6561 6b2e 2020  find max peak.  
-00026780: 7075 7420 696e 746f 2064 6620 6265 6361  put into df beca
-00026790: 7573 6520 6927 6d20 6c61 7a79 0a20 2020  use i'm lazy.   
-000267a0: 2070 6561 6b5f 6466 3d70 642e 4461 7461   peak_df=pd.Data
-000267b0: 4672 616d 6528 6461 7461 3d7b 2770 6f73  Frame(data={'pos
-000267c0: 273a 2070 6561 6b5f 706f 732c 0a20 2020  ': peak_pos,.   
-000267d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267e0: 2020 2020 2027 6865 6967 6874 273a 2070       'height': p
-000267f0: 6561 6b5f 6865 6967 6874 7d29 0a0a 2020  eak_height})..  
-00026800: 2020 6466 5f70 6561 6b5f 736f 7274 3d70    df_peak_sort=p
-00026810: 6561 6b5f 6466 2e73 6f72 745f 7661 6c75  eak_df.sort_valu
-00026820: 6573 2827 6865 6967 6874 272c 2061 7869  es('height', axi
-00026830: 733d 302c 2061 7363 656e 6469 6e67 3d46  s=0, ascending=F
-00026840: 616c 7365 290a 2020 2020 6466 5f70 6561  alse).    df_pea
-00026850: 6b5f 736f 7274 5f74 7269 6d3d 6466 5f70  k_sort_trim=df_p
-00026860: 6561 6b5f 736f 7274 5b30 3a31 5d0a 2020  eak_sort[0:1].  
-00026870: 2020 5065 616b 5f43 656e 7465 723d 6466    Peak_Center=df
-00026880: 5f70 6561 6b5f 736f 7274 5f74 7269 6d5b  _peak_sort_trim[
-00026890: 2770 6f73 275d 2e69 6c6f 635b 305d 0a20  'pos'].iloc[0]. 
-000268a0: 2020 2050 6561 6b5f 4865 6967 6874 3d64     Peak_Height=d
-000268b0: 665f 7065 616b 5f73 6f72 745f 7472 696d  f_peak_sort_trim
-000268c0: 5b27 6865 6967 6874 275d 2e69 6c6f 635b  ['height'].iloc[
-000268d0: 305d 0a0a 0a0a 0a0a 2320 4669 6e64 2069  0]......# Find i
-000268e0: 6e74 656e 7369 7479 2063 7574 206f 6666  ntensity cut off
-000268f0: 0a20 2020 2079 5f69 6e74 5f63 7574 3d50  .    y_int_cut=P
-00026900: 6561 6b5f 4865 6967 6874 2a69 6e74 5f63  eak_Height*int_c
-00026910: 7574 5f6f 6666 0a0a 2020 2020 2320 5370  ut_off..    # Sp
-00026920: 6c69 7420 7468 6520 6172 7261 7920 696e  lit the array in
-00026930: 746f 2061 204c 4853 2061 6e64 2061 2052  to a LHS and a R
-00026940: 4853 0a20 2020 204c 4853 5f79 3d79 5f63  HS.    LHS_y=y_c
-00026950: 7562 5b78 5f6e 6577 3c3d 5065 616b 5f43  ub[x_new<=Peak_C
-00026960: 656e 7465 725d 0a20 2020 2052 4853 5f79  enter].    RHS_y
-00026970: 3d79 5f63 7562 5b78 5f6e 6577 3e50 6561  =y_cub[x_new>Pea
-00026980: 6b5f 4365 6e74 6572 5d0a 0a20 2020 204c  k_Center]..    L
-00026990: 4853 5f78 3d78 5f6e 6577 5b78 5f6e 6577  HS_x=x_new[x_new
-000269a0: 3c3d 5065 616b 5f43 656e 7465 725d 0a20  <=Peak_Center]. 
-000269b0: 2020 2052 4853 5f78 3d78 5f6e 6577 5b78     RHS_x=x_new[x
-000269c0: 5f6e 6577 3e50 6561 6b5f 4365 6e74 6572  _new>Peak_Center
-000269d0: 5d0a 0a20 2020 2023 204e 6565 6420 746f  ]..    # Need to
-000269e0: 2066 6c69 7020 4c48 5320 746f 2070 7574   flip LHS to put
-000269f0: 2069 6e74 6f20 7468 6520 6669 6e64 2063   into the find c
-00026a00: 6c6f 7365 7374 2066 756e 6374 696f 6e0a  losest function.
-00026a10: 2020 2020 4c48 535f 795f 666c 6970 3d6e      LHS_y_flip=n
-00026a20: 702e 666c 6970 284c 4853 5f79 290a 2020  p.flip(LHS_y).  
-00026a30: 2020 4c48 535f 785f 666c 6970 3d6e 702e    LHS_x_flip=np.
-00026a40: 666c 6970 284c 4853 5f78 290a 0a20 2020  flip(LHS_x)..   
-00026a50: 2076 616c 3d6e 702e 6172 676d 6178 284c   val=np.argmax(L
-00026a60: 4853 5f79 5f66 6c69 703c 795f 696e 745f  HS_y_flip<y_int_
-00026a70: 6375 7429 0a0a 2020 2020 7661 6c32 3d6e  cut)..    val2=n
-00026a80: 702e 6172 676d 6178 2852 4853 5f79 3c79  p.argmax(RHS_y<y
-00026a90: 5f69 6e74 5f63 7574 290a 0a0a 2020 2020  _int_cut)...    
-00026aa0: 2320 4669 6e64 206e 6561 7265 7374 2078  # Find nearest x
-00026ab0: 2075 6e69 7420 746f 2074 6869 7320 7661   unit to this va
-00026ac0: 6c75 650a 2020 2020 795f 6e65 6172 6573  lue.    y_neares
-00026ad0: 745f 4c48 533d 4c48 535f 795f 666c 6970  t_LHS=LHS_y_flip
-00026ae0: 5b76 616c 5d0a 2020 2020 785f 6e65 6172  [val].    x_near
-00026af0: 6573 745f 4c48 533d 4c48 535f 785f 666c  est_LHS=LHS_x_fl
-00026b00: 6970 5b76 616c 5d0a 0a20 2020 2079 5f6e  ip[val]..    y_n
-00026b10: 6561 7265 7374 5f52 4853 3d52 4853 5f79  earest_RHS=RHS_y
-00026b20: 5b76 616c 325d 0a20 2020 2078 5f6e 6561  [val2].    x_nea
-00026b30: 7265 7374 5f52 4853 3d52 4853 5f78 5b76  rest_RHS=RHS_x[v
-00026b40: 616c 325d 0a0a 2020 2020 2320 5265 7475  al2]..    # Retu
-00026b50: 726e 2053 6b65 776e 6573 730a 2020 2020  rn Skewness.    
-00026b60: 4c48 535f 4365 6e74 6572 3d61 6273 2878  LHS_Center=abs(x
-00026b70: 5f6e 6561 7265 7374 5f4c 4853 2d50 6561  _nearest_LHS-Pea
-00026b80: 6b5f 4365 6e74 6572 290a 2020 2020 5248  k_Center).    RH
-00026b90: 535f 4365 6e74 6572 3d61 6273 2878 5f6e  S_Center=abs(x_n
-00026ba0: 6561 7265 7374 5f52 4853 2d50 6561 6b5f  earest_RHS-Peak_
-00026bb0: 4365 6e74 6572 290a 0a20 2020 2023 4164  Center)..    #Ad
-00026bc0: 6465 6420 636f 6e64 6974 696f 6e61 6c20  ded conditional 
-00026bd0: 746f 2061 6c77 6179 7320 6861 7665 2061  to always have a
-00026be0: 2072 6174 696f 206f 6620 7468 6520 6869   ratio of the hi
-00026bf0: 6768 2f6c 6f77 0a20 2020 2069 6620 736b  gh/low.    if sk
-00026c00: 6577 6e65 7373 3d3d 2761 6273 273a 0a20  ewness=='abs':. 
-00026c10: 2020 2020 2020 2069 6620 4c48 535f 4365         if LHS_Ce
-00026c20: 6e74 6572 3e52 4853 5f43 656e 7465 723a  nter>RHS_Center:
-00026c30: 0a20 2020 2020 2020 2020 2020 2041 533d  .            AS=
-00026c40: 4c48 535f 4365 6e74 6572 2f52 4853 5f43  LHS_Center/RHS_C
-00026c50: 656e 7465 720a 2020 2020 2020 2020 656c  enter.        el
-00026c60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00026c70: 4153 3d52 4853 5f43 656e 7465 722f 4c48  AS=RHS_Center/LH
-00026c80: 535f 4365 6e74 6572 0a20 2020 2065 6c69  S_Center.    eli
-00026c90: 6620 736b 6577 6e65 7373 3d3d 2764 6972  f skewness=='dir
-00026ca0: 273a 0a20 2020 2020 2020 2041 533d 5248  ':.        AS=RH
-00026cb0: 535f 4365 6e74 6572 2f4c 4853 5f43 656e  S_Center/LHS_Cen
-00026cc0: 7465 720a 0a0a 2020 2020 6966 2070 6c6f  ter...    if plo
-00026cd0: 745f 6669 6775 7265 2069 7320 5472 7565  t_figure is True
-00026ce0: 3a0a 0a20 2020 2020 2020 2023 204d 616b  :..        # Mak
-00026cf0: 6520 7072 6574 7479 2066 6967 7572 6520  e pretty figure 
-00026d00: 7368 6f77 696e 6720 6261 636b 6772 6f75  showing backgrou
-00026d10: 6e64 2073 7562 7472 6163 746f 696e 2072  nd subtractoin r
-00026d20: 6f75 7469 6e65 0a20 2020 2020 2020 2066  outine.        f
-00026d30: 6967 2c20 2828 6178 322c 2061 7831 292c  ig, ((ax2, ax1),
-00026d40: 2028 6178 332c 2061 7834 2929 203d 2070   (ax3, ax4)) = p
-00026d50: 6c74 2e73 7562 706c 6f74 7328 322c 2032  lt.subplots(2, 2
-00026d60: 2c20 6669 6773 697a 653d 2831 302c 3130  , figsize=(10,10
-00026d70: 2929 0a20 2020 2020 2020 2066 6967 2e73  )).        fig.s
-00026d80: 7570 7469 746c 6528 2744 6961 6420 3220  uptitle('Diad 2 
-00026d90: 536b 6577 6e65 7373 2066 696c 653d 2027  Skewness file= '
-00026da0: 2b20 7374 7228 6669 6c65 6e61 6d65 292c  + str(filename),
-00026db0: 2066 6f6e 7473 697a 653d 3136 2c20 783d   fontsize=16, x=
-00026dc0: 302e 352c 2079 3d31 2e30 290a 0a20 2020  0.5, y=1.0)..   
-00026dd0: 2020 2020 2061 7832 2e73 6574 5f74 6974       ax2.set_tit
-00026de0: 6c65 2827 6129 2053 7065 6374 7261 2729  le('a) Spectra')
-00026df0: 0a20 2020 2020 2020 2061 7832 2e70 6c6f  .        ax2.plo
-00026e00: 7428 4469 6164 5f73 686f 7274 5b3a 2c20  t(Diad_short[:, 
-00026e10: 305d 2c20 4469 6164 5f73 686f 7274 5b3a  0], Diad_short[:
-00026e20: 2c20 315d 2c20 272d 7227 2c20 6c61 6265  , 1], '-r', labe
-00026e30: 6c3d 2744 6174 6127 290a 2020 2020 2020  l='Data').      
-00026e40: 2020 6178 322e 7365 745f 786c 696d 285b    ax2.set_xlim([
-00026e50: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
-00026e60: 6b5f 6469 6164 325b 305d 2b34 302c 2063  k_diad2[0]+40, c
-00026e70: 6f6e 6669 6731 2e75 7070 6572 5f62 636b  onfig1.upper_bck
-00026e80: 5f64 6961 6432 5b31 5d2d 3430 5d29 0a20  _diad2[1]-40]). 
-00026e90: 2020 2020 2020 2061 7831 2e73 6574 5f74         ax1.set_t
-00026ea0: 6974 6c65 2827 6229 2042 6163 6b67 726f  itle('b) Backgro
-00026eb0: 756e 6420 6669 7427 290a 2020 2020 2020  und fit').      
-00026ec0: 2020 6178 312e 706c 6f74 2844 6961 645f    ax1.plot(Diad_
-00026ed0: 7368 6f72 745b 3a2c 2030 5d2c 2044 6961  short[:, 0], Dia
-00026ee0: 645f 7368 6f72 745b 3a2c 2031 5d2c 2027  d_short[:, 1], '
-00026ef0: 2e2d 7227 2c20 6c61 6265 6c3d 2744 6174  .-r', label='Dat
-00026f00: 6127 290a 0a20 2020 2020 2020 2061 7831  a')..        ax1
-00026f10: 2e70 6c6f 7428 4261 7365 6c69 6e65 5b3a  .plot(Baseline[:
-00026f20: 2c20 305d 2c20 4261 7365 6c69 6e65 5b3a  , 0], Baseline[:
-00026f30: 2c20 315d 2c20 272e 6227 2c20 6c61 6265  , 1], '.b', labe
-00026f40: 6c3d 2762 636b 2729 0a20 2020 2020 2020  l='bck').       
-00026f50: 2061 7831 2e70 6c6f 7428 4469 6164 5f73   ax1.plot(Diad_s
-00026f60: 686f 7274 5b3a 2c20 305d 2c20 5079 5f62  hort[:, 0], Py_b
-00026f70: 6173 655f 6469 6164 322c 2027 2d6b 272c  ase_diad2, '-k',
-00026f80: 206c 6162 656c 3d27 6263 6b20 6669 7427   label='bck fit'
-00026f90: 290a 2020 2020 2020 2020 6178 332e 7365  ).        ax3.se
-00026fa0: 745f 7469 746c 6528 2763 2920 4261 636b  t_title('c) Back
-00026fb0: 6772 6f75 6e64 2073 7562 7472 6163 7465  ground subtracte
-00026fc0: 6427 290a 2020 2020 2020 2020 6178 332e  d').        ax3.
-00026fd0: 706c 6f74 2820 785f 6469 6164 322c 795f  plot( x_diad2,y_
-00026fe0: 636f 7272 5f64 6961 6432 2c20 272d 7227  corr_diad2, '-r'
-00026ff0: 2c20 6c61 6265 6c3d 2742 636b 2073 7562  , label='Bck sub
-00027000: 2729 0a0a 2020 2020 2320 4164 6473 2063  ')..    # Adds c
-00027010: 7562 6963 2069 6e74 6572 706f 6c6f 6174  ubic interpoloat
-00027020: 696f 6e20 666f 7220 696e 7370 6563 7469  ion for inspecti
-00027030: 6f6e 0a0a 2020 2020 2020 2020 6178 342e  on..        ax4.
-00027040: 7365 745f 7469 746c 6528 2764 2920 4375  set_title('d) Cu
-00027050: 6269 6320 5370 6c69 6e65 2729 0a20 2020  bic Spline').   
-00027060: 2020 2020 2061 7834 2e70 6c6f 7428 5b78       ax4.plot([x
-00027070: 5f6e 6561 7265 7374 5f4c 4853 2c20 5065  _nearest_LHS, Pe
-00027080: 616b 5f43 656e 7465 725d 2c20 5b79 5f69  ak_Center], [y_i
-00027090: 6e74 5f63 7574 2c20 795f 696e 745f 6375  nt_cut, y_int_cu
-000270a0: 745d 2c20 272d 6727 290a 2020 2020 2020  t], '-g').      
-000270b0: 2020 6178 342e 616e 6e6f 7461 7465 2873    ax4.annotate(s
-000270c0: 7472 286e 702e 726f 756e 6428 4c48 535f  tr(np.round(LHS_
-000270d0: 4365 6e74 6572 2c20 3229 292c 0a20 2020  Center, 2)),.   
-000270e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270f0: 2020 7879 3d28 785f 6e65 6172 6573 745f    xy=(x_nearest_
-00027100: 4c48 532d 332c 2079 5f69 6e74 5f63 7574  LHS-3, y_int_cut
-00027110: 2b28 5065 616b 5f48 6569 6768 742d 795f  +(Peak_Height-y_
-00027120: 696e 745f 6375 7429 2f31 3029 2c20 7879  int_cut)/10), xy
-00027130: 636f 6f72 6473 3d22 6461 7461 222c 0a20  coords="data",. 
-00027140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027150: 2020 2020 666f 6e74 7369 7a65 3d31 322c      fontsize=12,
-00027160: 2063 6f6c 6f72 3d27 6772 6565 6e27 290a   color='green').
-00027170: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
-00027180: 2878 5f6e 6561 7265 7374 5f4c 4853 2c20  (x_nearest_LHS, 
-00027190: 795f 6e65 6172 6573 745f 4c48 532c 2027  y_nearest_LHS, '
-000271a0: 2a6b 272c 206d 6663 3d27 6772 6565 6e27  *k', mfc='green'
-000271b0: 2c6d 733d 3135 2c20 6c61 6265 6c3d 2752  ,ms=15, label='R
-000271c0: 4820 7469 6527 290a 0a0a 0a20 2020 2020  H tie')....     
-000271d0: 2020 2061 7834 2e70 6c6f 7428 5b50 6561     ax4.plot([Pea
-000271e0: 6b5f 4365 6e74 6572 2c20 785f 6e65 6172  k_Center, x_near
-000271f0: 6573 745f 5248 535d 2c20 5b79 5f69 6e74  est_RHS], [y_int
-00027200: 5f63 7574 2c20 795f 696e 745f 6375 745d  _cut, y_int_cut]
-00027210: 2c20 272d 272c 2063 6f6c 6f72 3d27 6772  , '-', color='gr
-00027220: 6579 2729 0a20 2020 2020 2020 2061 7834  ey').        ax4
-00027230: 2e61 6e6e 6f74 6174 6528 7374 7228 6e70  .annotate(str(np
-00027240: 2e72 6f75 6e64 2852 4853 5f43 656e 7465  .round(RHS_Cente
-00027250: 722c 2032 2929 2c0a 2020 2020 2020 2020  r, 2)),.        
-00027260: 2020 2020 2020 2020 2020 2020 2078 793d               xy=
-00027270: 2878 5f6e 6561 7265 7374 5f52 4853 2b33  (x_nearest_RHS+3
-00027280: 2c20 795f 696e 745f 6375 742b 2850 6561  , y_int_cut+(Pea
-00027290: 6b5f 4865 6967 6874 2d79 5f69 6e74 5f63  k_Height-y_int_c
-000272a0: 7574 292f 3130 292c 2078 7963 6f6f 7264  ut)/10), xycoord
-000272b0: 733d 2264 6174 6122 2c0a 2020 2020 2020  s="data",.      
-000272c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000272d0: 666f 6e74 7369 7a65 3d31 322c 2063 6f6c  fontsize=12, col
-000272e0: 6f72 3d27 6772 6579 2729 0a20 2020 2020  or='grey').     
-000272f0: 2020 2061 7834 2e70 6c6f 7428 785f 6e65     ax4.plot(x_ne
-00027300: 6172 6573 745f 5248 532c 2079 5f6e 6561  arest_RHS, y_nea
-00027310: 7265 7374 5f52 4853 2c20 272a 6b27 2c20  rest_RHS, '*k', 
-00027320: 6d66 633d 2767 7265 7927 2c20 6d73 3d31  mfc='grey', ms=1
-00027330: 352c 206c 6162 656c 3d27 4c48 2074 6965  5, label='LH tie
-00027340: 2729 0a0a 0a0a 0a20 2020 2020 2020 2061  ').....        a
-00027350: 7834 2e70 6c6f 7428 782c 2079 2c20 272e  x4.plot(x, y, '.
-00027360: 7227 290a 2020 2020 2020 2020 6178 342e  r').        ax4.
-00027370: 706c 6f74 2878 5f6e 6577 2c20 795f 6375  plot(x_new, y_cu
-00027380: 622c 2027 2d6b 2729 0a0a 2020 2020 2020  b, '-k')..      
-00027390: 2020 6178 342e 706c 6f74 285b 5065 616b    ax4.plot([Peak
-000273a0: 5f43 656e 7465 722c 2050 6561 6b5f 4365  _Center, Peak_Ce
-000273b0: 6e74 6572 5d2c 205b 5065 616b 5f48 6569  nter], [Peak_Hei
-000273c0: 6768 742c 2050 6561 6b5f 4865 6967 6874  ght, Peak_Height
-000273d0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-000273e0: 272a 6b27 2c20 6d66 633d 2762 6c75 6527  '*k', mfc='blue'
-000273f0: 2c20 6d73 3d31 352c 206c 6162 656c 3d27  , ms=15, label='
-00027400: 5363 6970 7920 4365 6e74 6572 2729 0a0a  Scipy Center')..
-00027410: 0a20 2020 2020 2020 2023 2041 6464 2074  .        # Add t
-00027420: 6f20 706c 6f74 0a0a 2020 2020 2020 2020  o plot..        
-00027430: 6178 342e 706c 6f74 2863 6f6e 6669 6731  ax4.plot(config1
-00027440: 2e6c 6f77 6572 5f62 636b 5f64 6961 6432  .lower_bck_diad2
-00027450: 5b30 5d2c 2063 6f6e 6669 6731 2e75 7070  [0], config1.upp
-00027460: 6572 5f62 636b 5f64 6961 6432 5b31 5d2c  er_bck_diad2[1],
-00027470: 205b 795f 696e 745f 6375 742c 2079 5f69   [y_int_cut, y_i
-00027480: 6e74 5f63 7574 5d2c 2027 3a72 2729 0a0a  nt_cut], ':r')..
-00027490: 0a0a 0a20 2020 2020 2020 2061 7834 2e73  ...        ax4.s
-000274a0: 6574 5f78 6c69 6d28 5b78 5f6e 6561 7265  et_xlim([x_neare
-000274b0: 7374 5f4c 4853 2d31 302c 2078 5f6e 6561  st_LHS-10, x_nea
-000274c0: 7265 7374 5f52 4853 2b31 305d 290a 2020  rest_RHS+10]).  
-000274d0: 2020 2020 2020 6178 342e 7365 745f 796c        ax4.set_yl
-000274e0: 696d 285b 302d 3130 2c20 5065 616b 5f48  im([0-10, Peak_H
-000274f0: 6569 6768 742a 312e 325d 290a 2020 2020  eight*1.2]).    
-00027500: 2020 2020 6178 342e 706c 6f74 285b 5065      ax4.plot([Pe
-00027510: 616b 5f43 656e 7465 722c 2050 6561 6b5f  ak_Center, Peak_
-00027520: 4365 6e74 6572 5d2c 205b 302c 2050 6561  Center], [0, Pea
-00027530: 6b5f 4865 6967 6874 5d2c 2027 3a62 2729  k_Height], ':b')
-00027540: 0a0a 0a0a 2020 2020 2020 2020 6178 342e  ....        ax4.
-00027550: 616e 6e6f 7461 7465 2827 536b 6577 6e65  annotate('Skewne
-00027560: 7373 3d27 2b73 7472 286e 702e 726f 756e  ss='+str(np.roun
-00027570: 6428 4153 2c20 3229 292c 0a20 2020 2020  d(AS, 2)),.     
-00027580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027590: 7879 3d28 785f 6e65 6172 6573 745f 5248  xy=(x_nearest_RH
-000275a0: 532b 322c 2079 5f69 6e74 5f63 7574 2b79  S+2, y_int_cut+y
-000275b0: 5f69 6e74 5f63 7574 2b28 5065 616b 5f48  _int_cut+(Peak_H
-000275c0: 6569 6768 742d 795f 696e 745f 6375 7429  eight-y_int_cut)
-000275d0: 2f31 3029 2c20 7879 636f 6f72 6473 3d22  /10), xycoords="
-000275e0: 6461 7461 222c 0a20 2020 2020 2020 2020  data",.         
-000275f0: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
-00027600: 7473 697a 653d 3130 290a 0a20 2020 2020  tsize=10)..     
-00027610: 2020 2061 7832 2e6c 6567 656e 6428 290a     ax2.legend().
-00027620: 2020 2020 2020 2020 6178 312e 6c65 6765          ax1.lege
-00027630: 6e64 2829 0a20 2020 2020 2020 2061 7833  nd().        ax3
-00027640: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
-00027650: 2020 6178 342e 6c65 6765 6e64 2829 0a20    ax4.legend(). 
-00027660: 2020 2020 2020 2061 7831 2e73 6574 5f78         ax1.set_x
-00027670: 6c61 6265 6c28 2757 6176 656e 756d 6265  label('Wavenumbe
-00027680: 7220 2863 6d24 5e7b 2d31 7d24 2927 290a  r (cm$^{-1}$)').
-00027690: 2020 2020 2020 2020 6178 322e 7365 745f          ax2.set_
-000276a0: 786c 6162 656c 2827 5761 7665 6e75 6d62  xlabel('Wavenumb
-000276b0: 6572 2028 636d 245e 7b2d 317d 2429 2729  er (cm$^{-1}$)')
-000276c0: 0a20 2020 2020 2020 2061 7833 2e73 6574  .        ax3.set
-000276d0: 5f78 6c61 6265 6c28 2757 6176 656e 756d  _xlabel('Wavenum
-000276e0: 6265 7220 2863 6d24 5e7b 2d31 7d24 2927  ber (cm$^{-1}$)'
-000276f0: 290a 2020 2020 2020 2020 6178 342e 7365  ).        ax4.se
-00027700: 745f 786c 6162 656c 2827 5761 7665 6e75  t_xlabel('Wavenu
-00027710: 6d62 6572 2028 636d 245e 7b2d 317d 2429  mber (cm$^{-1}$)
-00027720: 2729 0a20 2020 2020 2020 2061 7831 2e73  ').        ax1.s
-00027730: 6574 5f79 6c61 6265 6c28 2749 6e74 656e  et_ylabel('Inten
-00027740: 7369 7479 2729 0a20 2020 2020 2020 2061  sity').        a
-00027750: 7832 2e73 6574 5f79 6c61 6265 6c28 2749  x2.set_ylabel('I
-00027760: 6e74 656e 7369 7479 2729 0a20 2020 2020  ntensity').     
-00027770: 2020 2061 7833 2e73 6574 5f79 6c61 6265     ax3.set_ylabe
-00027780: 6c28 2749 6e74 656e 7369 7479 2729 0a20  l('Intensity'). 
-00027790: 2020 2020 2020 2061 7834 2e73 6574 5f79         ax4.set_y
-000277a0: 6c61 6265 6c28 2749 6e74 656e 7369 7479  label('Intensity
-000277b0: 2729 0a20 2020 2020 2020 2066 6967 2e74  ').        fig.t
-000277c0: 6967 6874 5f6c 6179 6f75 7428 290a 0a0a  ight_layout()...
-000277d0: 2020 2020 2020 2020 7061 7468 333d 7061          path3=pa
-000277e0: 7468 2b27 2f27 2b27 536b 6577 6e65 7373  th+'/'+'Skewness
-000277f0: 5f69 6d61 6765 7327 0a20 2020 2020 2020  _images'.       
-00027800: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00027810: 7473 2870 6174 6833 293a 0a20 2020 2020  ts(path3):.     
-00027820: 2020 2020 2020 206f 7574 3d27 7061 7468         out='path
-00027830: 2065 7869 7374 7327 0a20 2020 2020 2020   exists'.       
-00027840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00027850: 2020 206f 732e 6d61 6b65 6469 7273 2870     os.makedirs(p
-00027860: 6174 682b 272f 272b 2027 536b 6577 6e65  ath+'/'+ 'Skewne
-00027870: 7373 5f69 6d61 6765 7327 2c20 6578 6973  ss_images', exis
-00027880: 745f 6f6b 3d46 616c 7365 290a 0a0a 2020  t_ok=False)...  
-00027890: 2020 2020 2020 6669 6c65 3d66 696c 656e        file=filen
-000278a0: 616d 652e 7273 706c 6974 2827 2e74 7874  ame.rsplit('.txt
-000278b0: 272c 2031 295b 305d 0a20 2020 2020 2020  ', 1)[0].       
-000278c0: 2066 6967 2e73 6176 6566 6967 2870 6174   fig.savefig(pat
-000278d0: 6833 2b27 2f27 2b27 4469 6164 325f 736b  h3+'/'+'Diad2_sk
-000278e0: 6577 6e65 7373 5f7b 7d2e 706e 6727 2e66  ewness_{}.png'.f
-000278f0: 6f72 6d61 7428 6669 6c65 292c 2064 7069  ormat(file), dpi
-00027900: 3d64 7069 290a 0a0a 2020 2020 6466 5f6f  =dpi)...    df_o
-00027910: 7574 3d70 642e 4461 7461 4672 616d 6528  ut=pd.DataFrame(
-00027920: 6461 7461 3d7b 0a20 2020 2020 2020 2020  data={.         
-00027930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027940: 2020 2020 2027 536b 6577 6e65 7373 5f64       'Skewness_d
-00027950: 6961 6432 273a 2041 532c 0a20 2020 2020  iad2': AS,.     
-00027960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027970: 2020 2020 2020 2020 2027 4c48 535f 7469           'LHS_ti
-00027980: 655f 6469 6164 3227 3a20 785f 6e65 6172  e_diad2': x_near
-00027990: 6573 745f 4c48 532c 0a20 2020 2020 2020  est_LHS,.       
-000279a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279b0: 2020 2020 2020 2027 5248 535f 7469 655f         'RHS_tie_
-000279c0: 6469 6164 3227 3a20 785f 6e65 6172 6573  diad2': x_neares
-000279d0: 745f 5248 537d 2c20 696e 6465 783d 5b30  t_RHS}, index=[0
-000279e0: 5d29 0a0a 2020 2020 7265 7475 726e 2064  ])..    return d
-000279f0: 665f 6f75 740a 0a0a 6465 6620 6c6f 6f70  f_out...def loop
-00027a00: 5f64 6961 645f 736b 6577 6e65 7373 282a  _diad_skewness(*
-00027a10: 2c20 4469 6164 5f66 696c 6573 2c20 7061  , Diad_files, pa
-00027a20: 7468 3d4e 6f6e 652c 2066 696c 6574 7970  th=None, filetyp
-00027a30: 653d 4e6f 6e65 2c20 2073 6b65 776e 6573  e=None,  skewnes
-00027a40: 733d 2761 6273 272c 2073 6f72 743d 4661  s='abs', sort=Fa
-00027a50: 6c73 652c 2069 6e74 5f63 7574 5f6f 6666  lse, int_cut_off
-00027a60: 3d30 2e31 352c 0a63 6f6e 6669 675f 6469  =0.15,.config_di
-00027a70: 6164 313a 2064 6961 6431 5f66 6974 5f63  ad1: diad1_fit_c
-00027a80: 6f6e 6669 673d 6469 6164 315f 6669 745f  onfig=diad1_fit_
-00027a90: 636f 6e66 6967 2829 2c20 636f 6e66 6967  config(), config
-00027aa0: 5f64 6961 6432 3a20 6469 6164 325f 6669  _diad2: diad2_fi
-00027ab0: 745f 636f 6e66 6967 3d64 6961 6432 5f66  t_config=diad2_f
-00027ac0: 6974 5f63 6f6e 6669 6728 292c 2070 726f  it_config(), pro
-00027ad0: 6d69 6e65 6e63 653d 3130 2c20 7769 6474  minence=10, widt
-00027ae0: 683d 312c 2068 6569 6768 743d 3129 3a0a  h=1, height=1):.
-00027af0: 2020 2020 2222 2220 4c6f 6f70 7320 6f76      """ Loops ov
-00027b00: 6572 2061 6c6c 2073 7570 706c 6965 6420  er all supplied 
-00027b10: 6669 6c65 7320 746f 2063 616c 6375 6c61  files to calcula
-00027b20: 7465 2073 6b65 776e 6573 7320 666f 7220  te skewness for 
-00027b30: 6d75 6c74 6970 6c65 2073 7065 6374 7261  multiple spectra
-00027b40: 2075 7369 6e67 2074 6865 2066 756e 6374   using the funct
-00027b50: 696f 6e73 2061 7373 6573 735f 6469 6164  ions assess_diad
-00027b60: 315f 736b 6577 6e65 7373 2829 2061 6e64  1_skewness() and
-00027b70: 2061 7373 6573 735f 6469 6164 325f 736b   assess_diad2_sk
-00027b80: 6577 6e65 7373 2829 0a0a 0a20 2020 2050  ewness()...    P
-00027b90: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00027ba0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 4469  ---------.    Di
-00027bb0: 6164 5f46 696c 6573 3a20 6c69 7374 0a20  ad_Files: list. 
-00027bc0: 2020 2020 2020 204c 6973 7420 6f66 2066         List of f
-00027bd0: 696c 656e 616d 6573 2074 6f20 6c6f 6f70  ilenames to loop
-00027be0: 2074 6872 6f75 6768 0a0a 2020 2020 7061   through..    pa
-00027bf0: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
-00027c00: 466f 6c64 6572 2075 7365 7220 7769 7368  Folder user wish
-00027c10: 6573 2074 6f20 7265 6164 2064 6174 6120  es to read data 
-00027c20: 6672 6f6d 0a0a 2020 2020 6669 6c65 7479  from..    filety
-00027c30: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
-00027c40: 4964 656e 7469 6669 6573 2074 7970 6520  Identifies type 
-00027c50: 6f66 2066 696c 650a 2020 2020 2020 2020  of file.        
-00027c60: 6368 6f6f 7365 2066 726f 6d20 2757 6974  choose from 'Wit
-00027c70: 6563 5f41 5343 4949 272c 2027 6865 6164  ec_ASCII', 'head
-00027c80: 6c65 7373 5f74 7874 272c 2027 6865 6164  less_txt', 'head
-00027c90: 6c65 7373 5f63 7376 272c 2027 6865 6164  less_csv', 'head
-00027ca0: 5f63 7376 272c 2027 5769 7465 635f 4153  _csv', 'Witec_AS
-00027cb0: 4349 4927 2c0a 2020 2020 2020 2020 2748  CII',.        'H
-00027cc0: 4f52 4942 415f 7478 7427 2c20 2752 656e  ORIBA_txt', 'Ren
-00027cd0: 6973 6861 775f 7478 7427 0a0a 2020 2020  ishaw_txt'..    
-00027ce0: 736b 6577 6e65 7373 3a20 2761 6273 2720  skewness: 'abs' 
-00027cf0: 6f72 2027 6469 7227 0a20 2020 2020 2020  or 'dir'.       
-00027d00: 2049 6620 2761 6273 272c 2067 6976 6573   If 'abs', gives
-00027d10: 2061 6273 6f6c 7574 6520 736b 6577 6e65   absolute skewne
-00027d20: 7373 2028 652e 672e 2c20 6c61 7267 6573  ss (e.g., larges
-00027d30: 7420 706f 7373 6962 6c65 206e 756d 6265  t possible numbe
-00027d40: 7220 7265 6761 7264 6c65 7373 206f 6620  r regardless of 
-00027d50: 6469 7265 6374 696f 6e29 0a20 2020 2020  direction).     
-00027d60: 2020 2069 6620 2764 6972 2720 646f 6573     if 'dir' does
-00027d70: 2073 6b65 776e 6573 7320 6173 206f 6e65   skewness as one
-00027d80: 2073 6964 6520 6f76 6572 2074 6865 206f   side over the o
-00027d90: 7468 6572 0a0a 0a0a 2020 2020 736f 7274  ther....    sort
-00027da0: 3a20 626f 6f6c 0a20 2020 2020 2020 2049  : bool.        I
-00027db0: 6620 7472 7565 2c20 736f 7274 7320 6669  f true, sorts fi
-00027dc0: 6c65 7320 616c 7068 6162 6574 6963 616c  les alphabetical
-00027dd0: 6c79 0a20 2020 2066 696c 655f 6578 743a  ly.    file_ext:
-00027de0: 2073 7472 0a20 2020 2020 2020 2046 696c   str.        Fil
-00027df0: 6520 666f 726d 6174 2e20 4465 6661 756c  e format. Defaul
-00027e00: 7420 7478 742c 2063 6f75 6c64 2061 6c73  t txt, could als
-00027e10: 6f20 656e 7465 7220 6373 7620 6574 632e  o enter csv etc.
-00027e20: 0a20 2020 2065 7863 6c75 6465 5f73 7472  .    exclude_str
-00027e30: 3a20 7374 720a 2020 2020 2020 2020 4578  : str.        Ex
-00027e40: 636c 7564 6573 2066 696c 6573 2077 6974  cludes files wit
-00027e50: 6820 7468 6973 2073 7472 696e 6720 696e  h this string in
-00027e60: 2074 6865 6972 206e 616d 652e 2045 2e67   their name. E.g
-00027e70: 2e20 6966 2065 7863 6c75 6465 5f73 7472  . if exclude_str
-00027e80: 3d27 4e65 2720 6974 2077 696c 6c20 6578  ='Ne' it will ex
-00027e90: 636c 7564 6520 4e65 206c 696e 6573 0a20  clude Ne lines. 
-00027ea0: 2020 2065 7863 6c75 6465 5f74 7970 653a     exclude_type:
-00027eb0: 2073 7472 0a20 2020 2020 2020 2045 7863   str.        Exc
-00027ec0: 6c75 6465 7320 6669 6c65 7320 6f66 2074  ludes files of t
-00027ed0: 6869 7320 7479 7065 2c20 652e 672e 2065  his type, e.g. e
-00027ee0: 7863 6c75 6465 5f74 7970 653d 2770 6e67  xclude_type='png
-00027ef0: 2720 6765 7473 2072 6964 206f 6620 696d  ' gets rid of im
-00027f00: 6167 6520 6669 6c65 732e 0a0a 0a20 2020  age files....   
-00027f10: 206c 6f77 6572 5f62 6173 656c 696e 655f   lower_baseline_
-00027f20: 6469 6164 312c 206c 6f77 6572 5f62 6173  diad1, lower_bas
-00027f30: 656c 696e 655f 6469 6164 323a 206c 6973  eline_diad2: lis
-00027f40: 740a 2020 2020 2020 2020 5265 6769 6f6e  t.        Region
-00027f50: 206f 6620 7370 6563 7472 6120 746f 2075   of spectra to u
-00027f60: 7365 2061 2062 6173 656c 696e 6520 284c  se a baseline (L
-00027f70: 4853 2920 666f 7220 6469 6164 2031 2061  HS) for diad 1 a
-00027f80: 6e64 2064 6961 6432 0a0a 2020 2020 7570  nd diad2..    up
-00027f90: 7065 725f 6261 7365 6c69 6e65 5f64 6961  per_baseline_dia
-00027fa0: 6431 2c20 7570 7065 725f 6261 7365 6c69  d1, upper_baseli
-00027fb0: 6e65 5f64 6961 6432 3a20 6c69 7374 0a20  ne_diad2: list. 
-00027fc0: 2020 2020 2020 2052 6567 696f 6e20 6f66         Region of
-00027fd0: 2073 7065 6374 7261 2074 6f20 7573 6520   spectra to use 
-00027fe0: 6120 6261 7365 6c69 6e65 2028 5248 5329  a baseline (RHS)
-00027ff0: 2066 6f72 2064 6961 6420 3120 616e 6420   for diad 1 and 
-00028000: 6469 6164 2032 0a0a 2020 2020 4e5f 706f  diad 2..    N_po
-00028010: 6c79 5f62 636b 5f64 6961 6431 2c20 4e5f  ly_bck_diad1, N_
-00028020: 706f 6c79 5f62 636b 5f64 6961 6432 3a20  poly_bck_diad2: 
-00028030: 696e 740a 2020 2020 2020 2020 4465 6772  int.        Degr
-00028040: 6565 206f 6620 706f 6c79 6e6f 6d69 616c  ee of polynomial
-00028050: 2066 6f72 2062 6163 6b67 726f 756e 6420   for background 
-00028060: 6669 7474 696e 670a 0a20 2020 2073 6b65  fitting..    ske
-00028070: 776e 6573 733a 2027 6162 7327 206f 7220  wness: 'abs' or 
-00028080: 2764 6972 270a 2020 2020 2020 2020 4966  'dir'.        If
-00028090: 2027 6162 7327 2c20 6769 7665 7320 6162   'abs', gives ab
-000280a0: 736f 6c75 7465 2073 6b65 776e 6573 7320  solute skewness 
-000280b0: 2865 2e67 2e2c 206c 6172 6765 7374 2070  (e.g., largest p
-000280c0: 6f73 7369 626c 6520 6e75 6d62 6572 2072  ossible number r
-000280d0: 6567 6172 646c 6573 7320 6f66 2064 6972  egardless of dir
-000280e0: 6563 7469 6f6e 290a 2020 2020 2020 2020  ection).        
-000280f0: 6966 2027 6469 7227 2064 6f65 7320 736b  if 'dir' does sk
-00028100: 6577 6e65 7373 2061 7320 6f6e 6520 7369  ewness as one si
-00028110: 6465 206f 7665 7220 7468 6520 6f74 6865  de over the othe
-00028120: 720a 0a20 2020 2069 6e74 5f63 7574 5f6f  r..    int_cut_o
-00028130: 6666 3a20 666c 6f61 740a 2020 2020 2020  ff: float.      
-00028140: 2020 5661 6c75 6520 6f66 2069 6e74 656e    Value of inten
-00028150: 7369 7479 2061 7420 7768 6963 6820 746f  sity at which to
-00028160: 2063 616c 6375 6c61 7465 2074 6865 2073   calculate the s
-00028170: 6b65 776e 6573 7320 2865 2e67 2e20 302e  kewness (e.g. 0.
-00028180: 3135 5820 7468 6520 7065 616b 2068 6569  15X the peak hei
-00028190: 6768 7429 2e0a 0a0a 2020 2020 5265 7475  ght)....    Retu
-000281a0: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  rns.    --------
-000281b0: 2d2d 2d0a 2020 2020 7064 2e44 6174 6146  ---.    pd.DataF
-000281c0: 7261 6d65 2077 7469 6820 6669 6c65 6e61  rame wtih filena
-000281d0: 6d65 2c20 736b 6577 6e65 7373 206f 6620  me, skewness of 
-000281e0: 4469 6164 2031 2c0a 2020 2020 7468 6520  Diad 1,.    the 
-000281f0: 7820 706f 7369 7469 6f6e 206f 6620 7468  x position of th
-00028200: 6520 4c48 2061 6e64 2052 4820 7469 6520  e LH and RH tie 
-00028210: 706f 696e 7420 6174 2069 6e74 656e 7369  point at intensi
-00028220: 7479 3d69 6e74 5f69 6e74 5f63 7574 5f6f  ty=int_int_cut_o
-00028230: 6666 0a0a 0a0a 2020 2020 2222 220a 0a0a  ff....    """...
-00028240: 0a20 2020 2064 665f 6469 6164 3120 3d20  .    df_diad1 = 
-00028250: 7064 2e44 6174 6146 7261 6d65 285b 5d29  pd.DataFrame([])
-00028260: 0a20 2020 2064 665f 6469 6164 3220 3d20  .    df_diad2 = 
-00028270: 7064 2e44 6174 6146 7261 6d65 285b 5d29  pd.DataFrame([])
-00028280: 0a20 2020 2064 665f 6d65 7267 6564 3d70  .    df_merged=p
-00028290: 642e 4461 7461 4672 616d 6528 5b5d 290a  d.DataFrame([]).
-000282a0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-000282b0: 6765 2830 2c20 6c65 6e28 4469 6164 5f66  ge(0, len(Diad_f
-000282c0: 696c 6573 2929 3a0a 0a20 2020 2020 2020  iles)):..       
-000282d0: 2066 696c 656e 616d 653d 4469 6164 5f66   filename=Diad_f
-000282e0: 696c 6573 5b69 5d0a 2020 2020 2020 2020  iles[i].        
-000282f0: 7072 696e 7428 2777 6f72 6b69 6e67 206f  print('working o
-00028300: 6e20 6669 6c65 2023 272b 7374 7228 6929  n file #'+str(i)
-00028310: 290a 0a20 2020 2020 2020 2064 6174 615f  )..        data_
-00028320: 6469 6164 313d 6173 7365 7373 5f64 6961  diad1=assess_dia
-00028330: 6431 5f73 6b65 776e 6573 7328 636f 6e66  d1_skewness(conf
-00028340: 6967 313d 636f 6e66 6967 5f64 6961 6431  ig1=config_diad1
-00028350: 2c0a 2020 2020 2020 2020 696e 745f 6375  ,.        int_cu
-00028360: 745f 6f66 663d 696e 745f 6375 745f 6f66  t_off=int_cut_of
-00028370: 662c 2070 726f 6d69 6e65 6e63 653d 7072  f, prominence=pr
-00028380: 6f6d 696e 656e 6365 2c20 6865 6967 6874  ominence, height
-00028390: 3d68 6569 6768 742c 2077 6964 7468 3d77  =height, width=w
-000283a0: 6964 7468 2c0a 2020 2020 2020 2020 736b  idth,.        sk
-000283b0: 6577 6e65 7373 3d73 6b65 776e 6573 732c  ewness=skewness,
-000283c0: 2070 6174 683d 7061 7468 2c20 6669 6c65   path=path, file
-000283d0: 6e61 6d65 3d66 696c 656e 616d 652c 0a20  name=filename,. 
-000283e0: 2020 2020 2020 2066 696c 6574 7970 653d         filetype=
-000283f0: 6669 6c65 7479 7065 290a 0a20 2020 2020  filetype)..     
-00028400: 2020 2064 6174 615f 6469 6164 323d 6173     data_diad2=as
-00028410: 7365 7373 5f64 6961 6432 5f73 6b65 776e  sess_diad2_skewn
-00028420: 6573 7328 636f 6e66 6967 313d 636f 6e66  ess(config1=conf
-00028430: 6967 5f64 6961 6432 2c0a 2020 2020 2020  ig_diad2,.      
-00028440: 2020 696e 745f 6375 745f 6f66 663d 696e    int_cut_off=in
-00028450: 745f 6375 745f 6f66 662c 2070 726f 6d69  t_cut_off, promi
-00028460: 6e65 6e63 653d 7072 6f6d 696e 656e 6365  nence=prominence
-00028470: 2c20 6865 6967 6874 3d68 6569 6768 742c  , height=height,
-00028480: 2077 6964 7468 3d77 6964 7468 2c0a 2020   width=width,.  
-00028490: 2020 2020 2020 736b 6577 6e65 7373 3d73        skewness=s
-000284a0: 6b65 776e 6573 732c 2070 6174 683d 7061  kewness, path=pa
-000284b0: 7468 2c20 6669 6c65 6e61 6d65 3d66 696c  th, filename=fil
-000284c0: 656e 616d 652c 0a20 2020 2020 2020 2066  ename,.        f
-000284d0: 696c 6574 7970 653d 6669 6c65 7479 7065  iletype=filetype
-000284e0: 290a 0a0a 2020 2020 2020 2020 6466 5f64  )...        df_d
-000284f0: 6961 6431 203d 2070 642e 636f 6e63 6174  iad1 = pd.concat
-00028500: 285b 6466 5f64 6961 6431 2c20 6461 7461  ([df_diad1, data
-00028510: 5f64 6961 6431 5d2c 2061 7869 733d 3029  _diad1], axis=0)
-00028520: 0a20 2020 2020 2020 2064 665f 6469 6164  .        df_diad
-00028530: 3220 3d20 2070 642e 636f 6e63 6174 285b  2 =  pd.concat([
-00028540: 6466 5f64 6961 6432 2c20 6461 7461 5f64  df_diad2, data_d
-00028550: 6961 6432 5d2c 2061 7869 733d 3029 0a0a  iad2], axis=0)..
-00028560: 0a0a 2020 2020 6466 5f63 6f6d 626f 3d70  ..    df_combo=p
-00028570: 642e 636f 6e63 6174 285b 6466 5f64 6961  d.concat([df_dia
-00028580: 6431 2c20 6466 5f64 6961 6432 5d2c 2061  d1, df_diad2], a
-00028590: 7869 733d 3129 0a0a 2020 2020 636f 6c73  xis=1)..    cols
-000285a0: 5f74 6f5f 6d6f 7665 3d5b 2766 696c 656e  _to_move=['filen
-000285b0: 616d 6527 2c20 2753 6b65 776e 6573 735f  ame', 'Skewness_
-000285c0: 6469 6164 3127 2c20 2753 6b65 776e 6573  diad1', 'Skewnes
-000285d0: 735f 6469 6164 3227 5d0a 0a20 2020 2064  s_diad2']..    d
-000285e0: 665f 636f 6d62 6f20 3d20 6466 5f63 6f6d  f_combo = df_com
-000285f0: 626f 5b63 6f6c 735f 746f 5f6d 6f76 6520  bo[cols_to_move 
-00028600: 2b20 5b0a 2020 2020 2020 2020 636f 6c20  + [.        col 
-00028610: 666f 7220 636f 6c20 696e 2064 665f 636f  for col in df_co
-00028620: 6d62 6f2e 636f 6c75 6d6e 7320 6966 2063  mbo.columns if c
-00028630: 6f6c 206e 6f74 2069 6e20 636f 6c73 5f74  ol not in cols_t
-00028640: 6f5f 6d6f 7665 5d5d 0a0a 0a0a 0a20 2020  o_move]].....   
-00028650: 2072 6574 7572 6e20 6466 5f63 6f6d 626f   return df_combo
-00028660: 0a0a 0a0a 0a0a 0a                        .......
+00023ab0: 6327 2c20 6c77 3d31 2c20 6c61 6265 6c3d  c', lw=1, label=
+00023ac0: 274d 6743 4f24 5f33 2427 290a 2020 2020  'MgCO$_3$').    
+00023ad0: 6178 312e 706c 6f74 285b 3130 3937 2c20  ax1.plot([1097, 
+00023ae0: 3130 3937 5d2c 205b 302c 2079 706c 6f74  1097], [0, yplot
+00023af0: 5b2d 315d 2b32 5d2c 2027 2d62 272c 206c  [-1]+2], '-b', l
+00023b00: 773d 312c 206c 6162 656c 3d27 446f 6c6f  w=1, label='Dolo
+00023b10: 6d69 7465 2729 0a20 2020 2061 7831 2e70  mite').    ax1.p
+00023b20: 6c6f 7428 5b31 3133 312c 2031 3133 315d  lot([1131, 1131]
+00023b30: 2c20 5b30 2c20 7970 6c6f 745b 2d31 5d2b  , [0, yplot[-1]+
+00023b40: 325d 2c20 272d 272c 2063 6f6c 6f72 3d27  2], '-', color='
+00023b50: 6772 6579 272c 206c 773d 312c 206c 6162  grey', lw=1, lab
+00023b60: 656c 3d27 4361 534f 245f 3424 2729 0a20  el='CaSO$_4$'). 
+00023b70: 2020 2061 7831 2e70 6c6f 7428 5b31 3133     ax1.plot([113
+00023b80: 362c 2031 3133 365d 2c20 5b30 2c20 7970  6, 1136], [0, yp
+00023b90: 6c6f 745b 2d31 5d2b 325d 2c20 272d 2d27  lot[-1]+2], '--'
+00023ba0: 2c20 636f 6c6f 723d 2772 6f73 7962 726f  , color='rosybro
+00023bb0: 776e 272c 206c 773d 312c 206c 6162 656c  wn', lw=1, label
+00023bc0: 3d27 4d67 534f 245f 3424 2729 0a20 2020  ='MgSO$_4$').   
+00023bd0: 2061 7831 2e70 6c6f 7428 5b31 3135 312c   ax1.plot([1151,
+00023be0: 2031 3135 315d 2c20 5b30 2c20 7970 6c6f   1151], [0, yplo
+00023bf0: 745b 2d31 5d2b 325d 2c20 272d 6b27 2c20  t[-1]+2], '-k', 
+00023c00: 6c77 3d31 2c20 6c61 6265 6c3d 2753 4f24  lw=1, label='SO$
+00023c10: 5f32 2427 290a 0a0a 2020 2020 6178 312e  _2$')...    ax1.
+00023c20: 6669 6c6c 5f62 6574 7765 656e 2878 6c69  fill_between(xli
+00023c30: 6d5f 7065 616b 732c 202d 302e 352c 2079  m_peaks, -0.5, y
+00023c40: 706c 6f74 5b2d 315d 2b33 2c20 636f 6c6f  plot[-1]+3, colo
+00023c50: 723d 2762 6c75 6527 2c20 616c 7068 613d  r='blue', alpha=
+00023c60: 302e 3129 0a0a 0a20 2020 2061 7831 2e6c  0.1)...    ax1.l
+00023c70: 6567 656e 6428 6e63 6f6c 3d37 2c6c 6f63  egend(ncol=7,loc
+00023c80: 3d27 7570 7065 7220 6365 6e74 6572 272c  ='upper center',
+00023c90: 2066 6f6e 7473 697a 653d 3130 2c20 2062   fontsize=10,  b
+00023ca0: 626f 785f 746f 5f61 6e63 686f 723d 5b30  box_to_anchor=[0
+00023cb0: 2e35 2c20 312e 3035 5d29 0a20 2020 2061  .5, 1.05]).    a
+00023cc0: 7831 2e73 6574 5f79 6c69 6d28 5b2d 302e  x1.set_ylim([-0.
+00023cd0: 352c 2079 706c 6f74 5b2d 315d 2b33 5d29  5, yplot[-1]+3])
+00023ce0: 0a20 2020 2061 7831 2e73 6574 5f78 6c69  .    ax1.set_xli
+00023cf0: 6d28 5b78 6c69 6d5f 706c 6f74 5b30 5d2c  m([xlim_plot[0],
+00023d00: 2078 6c69 6d5f 706c 6f74 5b31 5d2b 302e   xlim_plot[1]+0.
+00023d10: 355d 290a 0a20 2020 2023 2064 665f 7065  5])..    # df_pe
+00023d20: 616b 733d 7064 2e44 6174 6146 7261 6d65  aks=pd.DataFrame
+00023d30: 2864 6174 613d 7b27 6669 6c65 6e61 6d65  (data={'filename
+00023d40: 273a 2044 6961 645f 4669 6c65 732c 0a20  ': Diad_Files,. 
+00023d50: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+00023d60: 2020 2020 2020 2020 2020 2020 2027 706f               'po
+00023d70: 7327 3a20 7065 616b 5f70 6f73 5f73 6176  s': peak_pos_sav
+00023d80: 6564 2c0a 2020 2020 2320 2020 2020 2020  ed,.    #       
+00023d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023da0: 2020 2020 2020 2770 726f 6d27 3a20 7065        'prom': pe
+00023db0: 616b 5f68 6569 6768 745f 7361 7665 642d  ak_height_saved-
+00023dc0: 7065 616b 5f62 636b 7d29 0a0a 0a0a 2020  peak_bck})....  
+00023dd0: 2020 6178 312e 7365 745f 786c 6162 656c    ax1.set_xlabel
+00023de0: 2827 5761 7665 6e75 6d62 6572 2028 636d  ('Wavenumber (cm
+00023df0: 245e 7b2d 317d 2429 2729 0a20 2020 2061  $^{-1}$)').    a
+00023e00: 7831 2e73 6574 5f79 7469 636b 7328 5b5d  x1.set_yticks([]
+00023e10: 290a 0a20 2020 2078 5f64 6174 613d 785f  )..    x_data=x_
+00023e20: 7472 696d 0a0a 2020 2020 6466 5f70 6561  trim..    df_pea
+00023e30: 6b73 5b27 6669 6c65 5f6e 616d 6573 275d  ks['file_names']
+00023e40: 3d44 6961 645f 4669 6c65 730a 0a20 2020  =Diad_Files..   
+00023e50: 2072 6574 7572 6e20 6466 5f70 6561 6b73   return df_peaks
+00023e60: 2c20 785f 6461 7461 2c20 795f 6461 7461  , x_data, y_data
+00023e70: 2c20 6669 670a 0a0a 2323 2044 6961 6420  , fig...## Diad 
+00023e80: 536b 6577 6e65 7373 2066 726f 6d20 4465  Skewness from De
+00023e90: 5669 7472 6520 6574 2061 6c2e 0a0a 696d  Vitre et al...im
+00023ea0: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+00023eb0: 640a 696d 706f 7274 206e 756d 7079 2061  d.import numpy a
+00023ec0: 7320 6e70 0a69 6d70 6f72 7420 6d61 7470  s np.import matp
+00023ed0: 6c6f 746c 6962 2e70 7970 6c6f 7420 6173  lotlib.pyplot as
+00023ee0: 2070 6c74 0a66 726f 6d20 7363 6970 792e   plt.from scipy.
+00023ef0: 7369 676e 616c 2069 6d70 6f72 7420 6669  signal import fi
+00023f00: 6e64 5f70 6561 6b73 0a23 204e 6577 2074  nd_peaks.# New t
+00023f10: 6869 6e67 7320 6e65 6564 6564 2068 6572  hings needed her
+00023f20: 650a 6672 6f6d 2073 6369 7079 2e69 6e74  e.from scipy.int
+00023f30: 6572 706f 6c61 7465 2069 6d70 6f72 7420  erpolate import 
+00023f40: 696e 7465 7270 3164 0a66 726f 6d20 7363  interp1d.from sc
+00023f50: 6970 792e 7369 676e 616c 2069 6d70 6f72  ipy.signal impor
+00023f60: 7420 6669 6e64 5f70 6561 6b73 0a69 6d70  t find_peaks.imp
+00023f70: 6f72 7420 6f73 0a66 726f 6d20 6f73 2069  ort os.from os i
+00023f80: 6d70 6f72 7420 6c69 7374 6469 720a 6672  mport listdir.fr
+00023f90: 6f6d 206f 732e 7061 7468 2069 6d70 6f72  om os.path impor
+00023fa0: 7420 6973 6669 6c65 2c20 6a6f 696e 0a66  t isfile, join.f
+00023fb0: 726f 6d20 4469 6164 4669 742e 696d 706f  rom DiadFit.impo
+00023fc0: 7274 696e 675f 6461 7461 5f66 696c 6573  rting_data_files
+00023fd0: 2069 6d70 6f72 7420 2a0a 6672 6f6d 2044   import *.from D
+00023fe0: 6961 6446 6974 2e64 6961 6473 2069 6d70  iadFit.diads imp
+00023ff0: 6f72 7420 2a0a 0a6e 702e 7365 7465 7272  ort *..np.seterr
+00024000: 2028 696e 7661 6c69 643d 2772 6169 7365   (invalid='raise
+00024010: 2729 0a0a 656e 636f 6465 3d22 4953 4f2d  ')..encode="ISO-
+00024020: 3838 3539 2d31 220a 0a0a 0a0a 0a0a 6465  8859-1".......de
+00024030: 6620 6173 7365 7373 5f64 6961 6431 5f73  f assess_diad1_s
+00024040: 6b65 776e 6573 7328 2a2c 2020 636f 6e66  kewness(*,  conf
+00024050: 6967 313a 2064 6961 6431 5f66 6974 5f63  ig1: diad1_fit_c
+00024060: 6f6e 6669 673d 6469 6164 315f 6669 745f  onfig=diad1_fit_
+00024070: 636f 6e66 6967 2829 2c20 696e 745f 6375  config(), int_cu
+00024080: 745f 6f66 663d 302e 332c 2070 6174 683d  t_off=0.3, path=
+00024090: 4e6f 6e65 2c20 6669 6c65 6e61 6d65 3d4e  None, filename=N
+000240a0: 6f6e 652c 2066 696c 6574 7970 653d 4e6f  one, filetype=No
+000240b0: 6e65 2c0a 736b 6577 6e65 7373 3d27 6162  ne,.skewness='ab
+000240c0: 7327 2c20 6865 6967 6874 3d31 2c20 7072  s', height=1, pr
+000240d0: 6f6d 696e 656e 6365 3d35 2c20 7769 6474  ominence=5, widt
+000240e0: 683d 302e 352c 2070 6c6f 745f 6669 6775  h=0.5, plot_figu
+000240f0: 7265 3d54 7275 652c 2064 7069 3d32 3030  re=True, dpi=200
+00024100: 293a 0a20 2020 2022 2222 2041 7373 6573  ):.    """ Asses
+00024110: 7365 7320 536b 6577 6e65 7373 206f 6620  ses Skewness of 
+00024120: 4469 6164 2070 6561 6b73 2e20 5573 6566  Diad peaks. Usef
+00024130: 756c 2066 6f72 2069 6465 6e74 6966 7969  ul for identifyi
+00024140: 6e67 206d 6978 6564 204c 202b 2056 2070  ng mixed L + V p
+00024150: 6861 7365 730a 2020 2020 2873 6565 2044  hases.    (see D
+00024160: 6556 6974 7265 2065 7420 616c 2e20 696e  eVitre et al. in
+00024170: 2072 6576 6965 7729 0a0a 0a20 2020 2050   review)...    P
+00024180: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00024190: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
+000241a0: 6e66 6967 313a 2064 6961 6431 5f66 6974  nfig1: diad1_fit
+000241b0: 5f63 6f6e 6669 6728 2920 6461 7461 636c  _config() datacl
+000241c0: 6173 732e 2049 6d70 6f72 7420 7061 7261  ass. Import para
+000241d0: 6d65 7465 7273 2066 6f72 2074 6869 7320  meters for this 
+000241e0: 6675 6e63 7469 6f6e 2061 7265 2e0a 0a20  function are... 
+000241f0: 2020 2020 2020 206c 6f77 6572 5f62 636b         lower_bck
+00024200: 5f64 6961 6431 2c20 7570 7065 725f 6263  _diad1, upper_bc
+00024210: 6b5f 6469 6164 313a 205b 666c 6f61 742c  k_diad1: [float,
+00024220: 2066 6c6f 6174 5d0a 2020 2020 2020 2020   float].        
+00024230: 2020 2020 6261 636b 6772 6f75 6e64 2070      background p
+00024240: 6f73 6974 696f 6e20 746f 206c 6566 7420  osition to left 
+00024250: 616e 6420 7269 6768 7420 6f66 206f 7665  and right of ove
+00024260: 7261 6c20 6469 6164 2072 6567 696f 6e20  ral diad region 
+00024270: 2869 6e63 2064 6961 642b 2d48 422b 2d43  (inc diad+-HB+-C
+00024280: 3133 290a 0a20 2020 2020 2020 204e 5f70  13)..        N_p
+00024290: 6f6c 795f 6263 6b5f 6469 6164 313a 2069  oly_bck_diad1: i
+000242a0: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
+000242b0: 6567 7265 6520 6f66 2070 6f6c 796e 6f6d  egree of polynom
+000242c0: 6961 6c20 746f 2066 6974 2074 6f20 7468  ial to fit to th
+000242d0: 6520 6261 636b 6772 6f75 6e64 2e0a 0a20  e background... 
+000242e0: 2020 2020 2020 2065 7863 6c75 6465 5f72         exclude_r
+000242f0: 616e 6765 312c 2065 7863 6c75 6465 5f72  ange1, exclude_r
+00024300: 616e 6765 323a 2054 7570 6c65 5b66 6c6f  ange2: Tuple[flo
+00024310: 6174 2c20 666c 6f61 745d 0a20 2020 2020  at, float].     
+00024320: 2020 2020 2020 2052 616e 6765 2074 6f20         Range to 
+00024330: 6578 636c 7564 650a 0a20 2020 2069 6e74  exclude..    int
+00024340: 5f63 7574 5f6f 6666 3a20 666c 6f61 740a  _cut_off: float.
+00024350: 2020 2020 2020 2020 5661 6c75 6520 6f66          Value of
+00024360: 2069 6e74 656e 7369 7479 2061 7420 7768   intensity at wh
+00024370: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
+00024380: 2074 6865 2073 6b65 776e 6573 7320 2865   the skewness (e
+00024390: 2e67 2e20 302e 3135 5820 7468 6520 7065  .g. 0.15X the pe
+000243a0: 616b 2068 6569 6768 7429 2e0a 0a20 2020  ak height)...   
+000243b0: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
+000243c0: 2020 2046 6f6c 6465 7220 7573 6572 2077     Folder user w
+000243d0: 6973 6865 7320 746f 2072 6561 6420 6461  ishes to read da
+000243e0: 7461 2066 726f 6d0a 0a20 2020 2066 696c  ta from..    fil
+000243f0: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
+00024400: 2020 2053 7065 6369 6669 6320 6669 6c65     Specific file
+00024410: 2062 6569 6e67 2072 6561 640a 0a0a 2020   being read...  
+00024420: 2020 6669 6c65 7479 7065 3a20 7374 720a    filetype: str.
+00024430: 2020 2020 2020 2020 4964 656e 7469 6669          Identifi
+00024440: 6573 2074 7970 6520 6f66 2066 696c 650a  es type of file.
+00024450: 2020 2020 2020 2020 6368 6f6f 7365 2066          choose f
+00024460: 726f 6d20 2757 6974 6563 5f41 5343 4949  rom 'Witec_ASCII
+00024470: 272c 2027 6865 6164 6c65 7373 5f74 7874  ', 'headless_txt
+00024480: 272c 2027 6865 6164 6c65 7373 5f63 7376  ', 'headless_csv
+00024490: 272c 2027 6865 6164 5f63 7376 272c 2027  ', 'head_csv', '
+000244a0: 5769 7465 635f 4153 4349 4927 2c0a 2020  Witec_ASCII',.  
+000244b0: 2020 2020 2020 2748 4f52 4942 415f 7478        'HORIBA_tx
+000244c0: 7427 2c20 2752 656e 6973 6861 775f 7478  t', 'Renishaw_tx
+000244d0: 7427 0a0a 2020 2020 736b 6577 6e65 7373  t'..    skewness
+000244e0: 3a20 2761 6273 2720 6f72 2027 6469 7227  : 'abs' or 'dir'
+000244f0: 0a20 2020 2020 2020 2049 6620 2761 6273  .        If 'abs
+00024500: 272c 2067 6976 6573 2061 6273 6f6c 7574  ', gives absolut
+00024510: 6520 736b 6577 6e65 7373 2028 652e 672e  e skewness (e.g.
+00024520: 2c20 6c61 7267 6573 7420 706f 7373 6962  , largest possib
+00024530: 6c65 206e 756d 6265 7220 7265 6761 7264  le number regard
+00024540: 6c65 7373 206f 6620 6469 7265 6374 696f  less of directio
+00024550: 6e29 0a20 2020 2020 2020 2069 6620 2764  n).        if 'd
+00024560: 6972 2720 646f 6573 2073 6b65 776e 6573  ir' does skewnes
+00024570: 7320 6173 206f 6e65 2073 6964 6520 6f76  s as one side ov
+00024580: 6572 2074 6865 206f 7468 6572 0a0a 0a20  er the other... 
+00024590: 2020 2068 6569 6768 742c 2070 726f 6d69     height, promi
+000245a0: 6e65 6e63 652c 2077 6964 7468 3a20 666c  nence, width: fl
+000245b0: 6f61 740a 2020 2020 2020 2020 5363 6970  oat.        Scip
+000245c0: 7920 6669 6e64 2070 6561 6b20 7061 7261  y find peak para
+000245d0: 6d65 7465 7273 0a0a 2020 2020 706c 6f74  meters..    plot
+000245e0: 5f66 6967 7572 653a 2062 6f6f 6c0a 2020  _figure: bool.  
+000245f0: 2020 2020 2020 6966 2054 7275 652c 2070        if True, p
+00024600: 6c6f 7473 2061 6e64 2073 6176 6573 2061  lots and saves a
+00024610: 2066 6967 7572 652e 0a0a 2020 2020 6470   figure...    dp
+00024620: 693a 2069 6e74 0a20 2020 2020 2020 2064  i: int.        d
+00024630: 7069 2074 6f20 7361 7665 2069 6d61 6765  pi to save image
+00024640: 2061 740a 0a0a 0a20 2020 2052 6574 7572   at....    Retur
+00024650: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  ns.    ---------
+00024660: 2d2d 0a20 2020 2070 642e 4461 7461 4672  --.    pd.DataFr
+00024670: 616d 6520 7769 7468 2069 6e66 6f72 6d61  ame with informa
+00024680: 7469 6f6e 2061 626f 7574 2066 696c 6520  tion about file 
+00024690: 616e 6420 736b 6577 6e65 7373 2070 6172  and skewness par
+000246a0: 616d 6574 6572 732e 0a0a 2020 2020 2222  ameters...    ""
+000246b0: 220a 0a0a 0a20 2020 2079 5f63 6f72 725f  "....    y_corr_
+000246c0: 6469 6164 312c 2050 795f 6261 7365 5f64  diad1, Py_base_d
+000246d0: 6961 6431 2c20 785f 6469 6164 312c 2020  iad1, x_diad1,  
+000246e0: 4469 6164 5f73 686f 7274 2c20 5079 5f62  Diad_short, Py_b
+000246f0: 6173 655f 6469 6164 312c 2050 665f 6261  ase_diad1, Pf_ba
+00024700: 7365 6c69 6e65 2c20 2042 6173 656c 696e  seline,  Baselin
+00024710: 655f 7973 7562 5f64 6961 6431 2c20 4261  e_ysub_diad1, Ba
+00024720: 7365 6c69 6e65 5f78 5f64 6961 6431 2c20  seline_x_diad1, 
+00024730: 4261 7365 6c69 6e65 2c20 7370 616e 3d72  Baseline, span=r
+00024740: 656d 6f76 655f 6469 6164 5f62 6173 656c  emove_diad_basel
+00024750: 696e 6528 0a20 2020 2070 6174 683d 7061  ine(.    path=pa
+00024760: 7468 2c20 6669 6c65 6e61 6d65 3d66 696c  th, filename=fil
+00024770: 656e 616d 652c 2066 696c 6574 7970 653d  ename, filetype=
+00024780: 6669 6c65 7479 7065 2c20 4e5f 706f 6c79  filetype, N_poly
+00024790: 3d63 6f6e 6669 6731 2e4e 5f70 6f6c 795f  =config1.N_poly_
+000247a0: 6263 6b5f 6469 6164 312c 0a20 2020 206c  bck_diad1,.    l
+000247b0: 6f77 6572 5f62 636b 3d63 6f6e 6669 6731  ower_bck=config1
+000247c0: 2e6c 6f77 6572 5f62 636b 5f64 6961 6431  .lower_bck_diad1
+000247d0: 2c20 7570 7065 725f 6263 6b3d 636f 6e66  , upper_bck=conf
+000247e0: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
+000247f0: 6164 312c 2070 6c6f 745f 6669 6775 7265  ad1, plot_figure
+00024800: 3d46 616c 7365 290a 0a0a 0a20 2020 2078  =False)....    x
+00024810: 5f6c 696e 5f62 6173 656c 696e 653d 6e70  _lin_baseline=np
+00024820: 2e6c 696e 7370 6163 6528 636f 6e66 6967  .linspace(config
+00024830: 312e 6c6f 7765 725f 6263 6b5f 6469 6164  1.lower_bck_diad
+00024840: 315b 305d 2c20 636f 6e66 6967 312e 7570  1[0], config1.up
+00024850: 7065 725f 6263 6b5f 6469 6164 315b 315d  per_bck_diad1[1]
+00024860: 2c20 3130 3030 3030 290a 2020 2020 7962  , 100000).    yb
+00024870: 6173 655f 786c 696e 3d50 665f 6261 7365  ase_xlin=Pf_base
+00024880: 6c69 6e65 2878 5f6c 696e 5f62 6173 656c  line(x_lin_basel
+00024890: 696e 6529 0a0a 0a0a 2020 2020 2320 4765  ine)....    # Ge
+000248a0: 7420 7820 616e 6420 7920 7265 6164 7920  t x and y ready 
+000248b0: 746f 206d 616b 6520 6120 6375 6269 6320  to make a cubic 
+000248c0: 7370 6c69 6e65 2074 6872 6f75 6768 2064  spline through d
+000248d0: 6174 610a 2020 2020 783d 785f 6469 6164  ata.    x=x_diad
+000248e0: 310a 2020 2020 793d 795f 636f 7272 5f64  1.    y=y_corr_d
+000248f0: 6961 6431 0a0a 2020 2020 2320 4669 7420  iad1..    # Fit 
+00024900: 6120 2063 7562 6963 2073 706c 696e 650a  a  cubic spline.
+00024910: 2020 2020 6632 203d 2069 6e74 6572 7031      f2 = interp1
+00024920: 6428 782c 2079 2c20 6b69 6e64 3d27 6375  d(x, y, kind='cu
+00024930: 6269 6327 290a 2020 2020 785f 6e65 773d  bic').    x_new=
+00024940: 6e70 2e6c 696e 7370 6163 6528 6e70 2e6d  np.linspace(np.m
+00024950: 696e 2878 292c 206e 702e 6d61 7828 7829  in(x), np.max(x)
+00024960: 2c20 3130 3030 3030 290a 0a20 2020 2079  , 100000)..    y
+00024970: 5f63 7562 3d66 3228 785f 6e65 7729 0a0a  _cub=f2(x_new)..
+00024980: 0a0a 2020 2020 2320 5573 6520 5363 6970  ..    # Use Scip
+00024990: 7920 6669 6e64 2070 6561 6b73 2074 6f20  y find peaks to 
+000249a0: 6765 7420 7468 6520 6269 6767 6573 7420  get the biggest 
+000249b0: 7065 616b 0a20 2020 2068 6569 6768 743d  peak.    height=
+000249c0: 6865 6967 6874 0a20 2020 2070 6561 6b73  height.    peaks
+000249d0: 203d 2066 696e 645f 7065 616b 7328 795f   = find_peaks(y_
+000249e0: 6375 622c 2068 6569 6768 743d 6865 6967  cub, height=heig
+000249f0: 6874 2c20 7072 6f6d 696e 656e 6365 3d70  ht, prominence=p
+00024a00: 726f 6d69 6e65 6e63 652c 2077 6964 7468  rominence, width
+00024a10: 3d77 6964 7468 290a 2020 2020 7065 616b  =width).    peak
+00024a20: 5f68 6569 6768 743d 7065 616b 735b 315d  _height=peaks[1]
+00024a30: 5b27 7065 616b 5f68 6569 6768 7473 275d  ['peak_heights']
+00024a40: 0a20 2020 2070 6561 6b5f 706f 7320 3d20  .    peak_pos = 
+00024a50: 785f 6e65 775b 7065 616b 735b 305d 5d0a  x_new[peaks[0]].
+00024a60: 0a20 2020 2023 2066 696e 6420 6d61 7820  .    # find max 
+00024a70: 7065 616b 2e20 2070 7574 2069 6e74 6f20  peak.  put into 
+00024a80: 6466 2062 6563 6175 7365 2069 276d 206c  df because i'm l
+00024a90: 617a 790a 2020 2020 7065 616b 5f64 663d  azy.    peak_df=
+00024aa0: 7064 2e44 6174 6146 7261 6d65 2864 6174  pd.DataFrame(dat
+00024ab0: 613d 7b27 706f 7327 3a20 7065 616b 5f70  a={'pos': peak_p
+00024ac0: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
+00024ad0: 2020 2020 2020 2020 2020 2020 2768 6569              'hei
+00024ae0: 6768 7427 3a20 7065 616b 5f68 6569 6768  ght': peak_heigh
+00024af0: 747d 290a 0a20 2020 2023 2046 696e 6420  t})..    # Find 
+00024b00: 6269 6765 7374 2070 6561 6b73 2c0a 2020  bigest peaks,.  
+00024b10: 2020 6466 5f70 6561 6b5f 736f 7274 3d70    df_peak_sort=p
+00024b20: 6561 6b5f 6466 2e73 6f72 745f 7661 6c75  eak_df.sort_valu
+00024b30: 6573 2827 6865 6967 6874 272c 2061 7869  es('height', axi
+00024b40: 733d 302c 2061 7363 656e 6469 6e67 3d46  s=0, ascending=F
+00024b50: 616c 7365 290a 2020 2020 6466 5f70 6561  alse).    df_pea
+00024b60: 6b5f 736f 7274 5f74 7269 6d3d 6466 5f70  k_sort_trim=df_p
+00024b70: 6561 6b5f 736f 7274 5b30 3a31 5d0a 2020  eak_sort[0:1].  
+00024b80: 2020 5065 616b 5f43 656e 7465 723d 6466    Peak_Center=df
+00024b90: 5f70 6561 6b5f 736f 7274 5f74 7269 6d5b  _peak_sort_trim[
+00024ba0: 2770 6f73 275d 0a20 2020 2050 6561 6b5f  'pos'].    Peak_
+00024bb0: 4865 6967 6874 3d64 665f 7065 616b 5f73  Height=df_peak_s
+00024bc0: 6f72 745f 7472 696d 5b27 6865 6967 6874  ort_trim['height
+00024bd0: 275d 0a0a 0a20 2020 2023 2046 696e 6420  ']...    # Find 
+00024be0: 696e 7465 6e73 6974 7920 6375 7420 6f66  intensity cut of
+00024bf0: 660a 2020 2020 795f 696e 745f 6375 743d  f.    y_int_cut=
+00024c00: 5065 616b 5f48 6569 6768 742e 696c 6f63  Peak_Height.iloc
+00024c10: 5b30 5d2a 696e 745f 6375 745f 6f66 660a  [0]*int_cut_off.
+00024c20: 0a20 2020 2023 2053 706c 6974 2074 6865  .    # Split the
+00024c30: 2061 7272 6179 2069 6e74 6f20 6120 4c48   array into a LH
+00024c40: 5320 616e 6420 6120 5248 530a 0a20 2020  S and a RHS..   
+00024c50: 204c 4853 5f79 3d79 5f63 7562 5b78 5f6e   LHS_y=y_cub[x_n
+00024c60: 6577 3c3d 5065 616b 5f43 656e 7465 722e  ew<=Peak_Center.
+00024c70: 7661 6c75 6573 5d0a 2020 2020 5248 535f  values].    RHS_
+00024c80: 793d 795f 6375 625b 785f 6e65 773e 5065  y=y_cub[x_new>Pe
+00024c90: 616b 5f43 656e 7465 722e 7661 6c75 6573  ak_Center.values
+00024ca0: 5d0a 0a20 2020 204c 4853 5f78 3d78 5f6e  ]..    LHS_x=x_n
+00024cb0: 6577 5b78 5f6e 6577 3c3d 5065 616b 5f43  ew[x_new<=Peak_C
+00024cc0: 656e 7465 722e 7661 6c75 6573 5d0a 2020  enter.values].  
+00024cd0: 2020 5248 535f 783d 785f 6e65 775b 785f    RHS_x=x_new[x_
+00024ce0: 6e65 773e 5065 616b 5f43 656e 7465 722e  new>Peak_Center.
+00024cf0: 7661 6c75 6573 5d0a 0a20 2020 2023 204e  values]..    # N
+00024d00: 6565 6420 746f 2066 6c69 7020 4c48 5320  eed to flip LHS 
+00024d10: 746f 2070 7574 2069 6e74 6f20 7468 6520  to put into the 
+00024d20: 6669 6e64 2063 6c6f 7365 7374 2066 756e  find closest fun
+00024d30: 6374 696f 6e0a 2020 2020 4c48 535f 795f  ction.    LHS_y_
+00024d40: 666c 6970 3d6e 702e 666c 6970 284c 4853  flip=np.flip(LHS
+00024d50: 5f79 290a 2020 2020 4c48 535f 785f 666c  _y).    LHS_x_fl
+00024d60: 6970 3d6e 702e 666c 6970 284c 4853 5f78  ip=np.flip(LHS_x
+00024d70: 290a 0a20 2020 2076 616c 3d6e 702e 6172  )..    val=np.ar
+00024d80: 676d 6178 284c 4853 5f79 5f66 6c69 703c  gmax(LHS_y_flip<
+00024d90: 795f 696e 745f 6375 7429 0a0a 2020 2020  y_int_cut)..    
+00024da0: 7661 6c32 3d6e 702e 6172 676d 6178 2852  val2=np.argmax(R
+00024db0: 4853 5f79 3c79 5f69 6e74 5f63 7574 290a  HS_y<y_int_cut).
+00024dc0: 0a0a 2020 2020 2320 4669 6e64 206e 6561  ..    # Find nea
+00024dd0: 7265 7374 2078 2075 6e69 7420 746f 2074  rest x unit to t
+00024de0: 6869 7320 7661 6c75 650a 2020 2020 795f  his value.    y_
+00024df0: 6e65 6172 6573 745f 4c48 533d 4c48 535f  nearest_LHS=LHS_
+00024e00: 795f 666c 6970 5b76 616c 5d0a 2020 2020  y_flip[val].    
+00024e10: 785f 6e65 6172 6573 745f 4c48 533d 4c48  x_nearest_LHS=LH
+00024e20: 535f 785f 666c 6970 5b76 616c 5d0a 0a20  S_x_flip[val].. 
+00024e30: 2020 2079 5f6e 6561 7265 7374 5f52 4853     y_nearest_RHS
+00024e40: 3d52 4853 5f79 5b76 616c 325d 0a20 2020  =RHS_y[val2].   
+00024e50: 2078 5f6e 6561 7265 7374 5f52 4853 3d52   x_nearest_RHS=R
+00024e60: 4853 5f78 5b76 616c 325d 0a0a 0a20 2020  HS_x[val2]...   
+00024e70: 2023 2052 6574 7572 6e20 536b 6577 6e65   # Return Skewne
+00024e80: 7373 0a20 2020 204c 4853 5f43 656e 7465  ss.    LHS_Cente
+00024e90: 723d 6162 7328 785f 6e65 6172 6573 745f  r=abs(x_nearest_
+00024ea0: 4c48 532d 5065 616b 5f43 656e 7465 7229  LHS-Peak_Center)
+00024eb0: 0a20 2020 2052 4853 5f43 656e 7465 723d  .    RHS_Center=
+00024ec0: 6162 7328 785f 6e65 6172 6573 745f 5248  abs(x_nearest_RH
+00024ed0: 532d 5065 616b 5f43 656e 7465 7229 0a0a  S-Peak_Center)..
+00024ee0: 0a20 2020 2341 6c73 6f20 6765 7420 6f70  .   #Also get op
+00024ef0: 7469 6f6e 2074 6f20 616c 7761 7973 2074  tion to always t
+00024f00: 616b 6520 6269 6767 6573 7420 7661 6c75  ake biggest valu
+00024f10: 6520 6f66 2073 6b65 776e 6573 730a 2020  e of skewness.  
+00024f20: 2020 6966 2073 6b65 776e 6573 733d 3d27    if skewness=='
+00024f30: 6162 7327 3a0a 2020 2020 2020 2020 6966  abs':.        if
+00024f40: 204c 4853 5f43 656e 7465 722e 7661 6c75   LHS_Center.valu
+00024f50: 6573 3e52 4853 5f43 656e 7465 722e 7661  es>RHS_Center.va
+00024f60: 6c75 6573 3a0a 2020 2020 2020 2020 2020  lues:.          
+00024f70: 2020 4153 3d4c 4853 5f43 656e 7465 722e    AS=LHS_Center.
+00024f80: 7661 6c75 6573 2f52 4853 5f43 656e 7465  values/RHS_Cente
+00024f90: 722e 7661 6c75 6573 0a20 2020 2020 2020  r.values.       
+00024fa0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00024fb0: 2020 2041 533d 5248 535f 4365 6e74 6572     AS=RHS_Center
+00024fc0: 2e76 616c 7565 732f 4c48 535f 4365 6e74  .values/LHS_Cent
+00024fd0: 6572 2e76 616c 7565 730a 2020 2020 656c  er.values.    el
+00024fe0: 6966 2073 6b65 776e 6573 733d 3d27 6469  if skewness=='di
+00024ff0: 7227 3a0a 2020 2020 2020 2020 4153 3d52  r':.        AS=R
+00025000: 4853 5f43 656e 7465 722e 7661 6c75 6573  HS_Center.values
+00025010: 2f4c 4853 5f43 656e 7465 722e 7661 6c75  /LHS_Center.valu
+00025020: 6573 0a0a 0a20 2020 2069 6620 706c 6f74  es...    if plot
+00025030: 5f66 6967 7572 6520 6973 2054 7275 653a  _figure is True:
+00025040: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
+00025050: 2070 7265 7474 7920 6669 6775 7265 2073   pretty figure s
+00025060: 686f 7769 6e67 2062 6163 6b67 726f 756e  howing backgroun
+00025070: 6420 7375 6274 7261 6374 6f69 6e20 726f  d subtractoin ro
+00025080: 7574 696e 650a 2020 2020 2020 2020 6669  utine.        fi
+00025090: 672c 2028 2861 7832 2c20 6178 3129 2c20  g, ((ax2, ax1), 
+000250a0: 2861 7833 2c20 6178 3429 2920 3d20 706c  (ax3, ax4)) = pl
+000250b0: 742e 7375 6270 6c6f 7473 2832 2c20 322c  t.subplots(2, 2,
+000250c0: 2066 6967 7369 7a65 3d28 3130 2c31 3029   figsize=(10,10)
+000250d0: 290a 2020 2020 2020 2020 6669 672e 7375  ).        fig.su
+000250e0: 7074 6974 6c65 2827 4469 6164 2031 2053  ptitle('Diad 1 S
+000250f0: 6b65 776e 6573 7320 6669 6c65 3d20 272b  kewness file= '+
+00025100: 2073 7472 2866 696c 656e 616d 6529 2c20   str(filename), 
+00025110: 666f 6e74 7369 7a65 3d31 362c 2078 3d30  fontsize=16, x=0
+00025120: 2e35 2c20 793d 312e 3029 0a0a 2020 2020  .5, y=1.0)..    
+00025130: 2020 2020 6178 322e 7365 745f 7469 746c      ax2.set_titl
+00025140: 6528 2761 2920 5370 6563 7472 6127 290a  e('a) Spectra').
+00025150: 2020 2020 2020 2020 6178 322e 706c 6f74          ax2.plot
+00025160: 2844 6961 645f 7368 6f72 745b 3a2c 2030  (Diad_short[:, 0
+00025170: 5d2c 2044 6961 645f 7368 6f72 745b 3a2c  ], Diad_short[:,
+00025180: 2031 5d2c 2027 2d72 272c 206c 6162 656c   1], '-r', label
+00025190: 3d27 4461 7461 2729 0a20 2020 2020 2020  ='Data').       
+000251a0: 2061 7832 2e73 6574 5f78 6c69 6d28 5b63   ax2.set_xlim([c
+000251b0: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
+000251c0: 5f64 6961 6431 5b30 5d2b 3430 2c20 636f  _diad1[0]+40, co
+000251d0: 6e66 6967 312e 7570 7065 725f 6263 6b5f  nfig1.upper_bck_
+000251e0: 6469 6164 315b 315d 2d34 305d 290a 2020  diad1[1]-40]).  
+000251f0: 2020 2020 2020 6178 312e 7365 745f 7469        ax1.set_ti
+00025200: 746c 6528 2762 2920 4261 636b 6772 6f75  tle('b) Backgrou
+00025210: 6e64 2066 6974 2729 0a20 2020 2020 2020  nd fit').       
+00025220: 2061 7831 2e70 6c6f 7428 4469 6164 5f73   ax1.plot(Diad_s
+00025230: 686f 7274 5b3a 2c20 305d 2c20 4469 6164  hort[:, 0], Diad
+00025240: 5f73 686f 7274 5b3a 2c20 315d 2c20 272e  _short[:, 1], '.
+00025250: 2d63 272c 206c 6162 656c 3d27 4461 7461  -c', label='Data
+00025260: 2729 0a0a 2020 2020 2020 2020 6178 312e  ')..        ax1.
+00025270: 706c 6f74 2842 6173 656c 696e 655b 3a2c  plot(Baseline[:,
+00025280: 2030 5d2c 2042 6173 656c 696e 655b 3a2c   0], Baseline[:,
+00025290: 2031 5d2c 2027 2e62 272c 206c 6162 656c   1], '.b', label
+000252a0: 3d27 6263 6b27 290a 2020 2020 2020 2020  ='bck').        
+000252b0: 6178 312e 706c 6f74 2844 6961 645f 7368  ax1.plot(Diad_sh
+000252c0: 6f72 745b 3a2c 2030 5d2c 2050 795f 6261  ort[:, 0], Py_ba
+000252d0: 7365 5f64 6961 6431 2c20 272d 6b27 2c20  se_diad1, '-k', 
+000252e0: 6c61 6265 6c3d 2762 636b 2066 6974 2729  label='bck fit')
+000252f0: 0a20 2020 2020 2020 2061 7833 2e73 6574  .        ax3.set
+00025300: 5f74 6974 6c65 2827 6329 2042 6163 6b67  _title('c) Backg
+00025310: 726f 756e 6420 7375 6274 7261 6374 6564  round subtracted
+00025320: 2729 0a20 2020 2020 2020 2061 7833 2e70  ').        ax3.p
+00025330: 6c6f 7428 785f 6469 6164 312c 795f 636f  lot(x_diad1,y_co
+00025340: 7272 5f64 6961 6431 2c20 272d 7227 2c20  rr_diad1, '-r', 
+00025350: 6c61 6265 6c3d 2742 636b 2073 7562 2729  label='Bck sub')
+00025360: 0a0a 2020 2020 2320 4164 6473 2063 7562  ..    # Adds cub
+00025370: 6963 2069 6e74 6572 706f 6c6f 6174 696f  ic interpoloatio
+00025380: 6e20 666f 7220 696e 7370 6563 7469 6f6e  n for inspection
+00025390: 0a0a 2020 2020 2020 2020 6178 342e 7365  ..        ax4.se
+000253a0: 745f 7469 746c 6528 2764 2920 4375 6269  t_title('d) Cubi
+000253b0: 6320 5370 6c69 6e65 2729 0a0a 0a0a 0a20  c Spline')..... 
+000253c0: 2020 2020 2020 2061 7834 2e70 6c6f 7428         ax4.plot(
+000253d0: 5b78 5f6e 6561 7265 7374 5f4c 4853 2c20  [x_nearest_LHS, 
+000253e0: 5065 616b 5f43 656e 7465 722e 696c 6f63  Peak_Center.iloc
+000253f0: 5b30 5d5d 2c20 5b79 5f69 6e74 5f63 7574  [0]], [y_int_cut
+00025400: 2c20 795f 696e 745f 6375 745d 2c20 272d  , y_int_cut], '-
+00025410: 6727 290a 0a20 2020 2020 2020 2061 7834  g')..        ax4
+00025420: 2e61 6e6e 6f74 6174 6528 7374 7228 6e70  .annotate(str(np
+00025430: 2e72 6f75 6e64 284c 4853 5f43 656e 7465  .round(LHS_Cente
+00025440: 722e 7661 6c75 6573 5b30 5d2c 2032 2929  r.values[0], 2))
+00025450: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00025460: 2020 2020 2020 2078 793d 2878 5f6e 6561         xy=(x_nea
+00025470: 7265 7374 5f4c 4853 2d33 2c20 795f 696e  rest_LHS-3, y_in
+00025480: 745f 6375 742b 2850 6561 6b5f 4865 6967  t_cut+(Peak_Heig
+00025490: 6874 2d79 5f69 6e74 5f63 7574 292f 3130  ht-y_int_cut)/10
+000254a0: 292c 2078 7963 6f6f 7264 733d 2264 6174  ), xycoords="dat
+000254b0: 6122 2c0a 2020 2020 2020 2020 2020 2020  a",.            
+000254c0: 2020 2020 2020 2020 2066 6f6e 7473 697a           fontsiz
+000254d0: 653d 3132 2c20 636f 6c6f 723d 2767 7265  e=12, color='gre
+000254e0: 656e 2729 0a20 2020 2020 2020 2061 7834  en').        ax4
+000254f0: 2e70 6c6f 7428 785f 6e65 6172 6573 745f  .plot(x_nearest_
+00025500: 4c48 532c 2079 5f6e 6561 7265 7374 5f4c  LHS, y_nearest_L
+00025510: 4853 2c20 272a 6b27 2c20 6d66 633d 2767  HS, '*k', mfc='g
+00025520: 7265 656e 272c 6d73 3d31 352c 206c 6162  reen',ms=15, lab
+00025530: 656c 3d27 5248 2074 6965 2729 0a0a 0a0a  el='RH tie')....
+00025540: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
+00025550: 285b 5065 616b 5f43 656e 7465 722e 696c  ([Peak_Center.il
+00025560: 6f63 5b30 5d2c 2078 5f6e 6561 7265 7374  oc[0], x_nearest
+00025570: 5f52 4853 5d2c 205b 795f 696e 745f 6375  _RHS], [y_int_cu
+00025580: 742c 2079 5f69 6e74 5f63 7574 5d2c 2027  t, y_int_cut], '
+00025590: 2d27 2c20 636f 6c6f 723d 2767 7265 7927  -', color='grey'
+000255a0: 290a 2020 2020 2020 2020 6178 342e 616e  ).        ax4.an
+000255b0: 6e6f 7461 7465 2873 7472 286e 702e 726f  notate(str(np.ro
+000255c0: 756e 6428 5248 535f 4365 6e74 6572 2e76  und(RHS_Center.v
+000255d0: 616c 7565 735b 305d 2c20 3229 292c 0a20  alues[0], 2)),. 
+000255e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000255f0: 2020 2020 7879 3d28 785f 6e65 6172 6573      xy=(x_neares
+00025600: 745f 5248 532b 332c 2079 5f69 6e74 5f63  t_RHS+3, y_int_c
+00025610: 7574 2b28 5065 616b 5f48 6569 6768 742e  ut+(Peak_Height.
+00025620: 696c 6f63 5b30 5d2d 795f 696e 745f 6375  iloc[0]-y_int_cu
+00025630: 7429 2f31 3029 2c20 7879 636f 6f72 6473  t)/10), xycoords
+00025640: 3d22 6461 7461 222c 0a20 2020 2020 2020  ="data",.       
+00025650: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00025660: 6f6e 7473 697a 653d 3132 2c20 636f 6c6f  ontsize=12, colo
+00025670: 723d 2767 7265 7927 290a 2020 2020 2020  r='grey').      
+00025680: 2020 6178 342e 706c 6f74 2878 5f6e 6561    ax4.plot(x_nea
+00025690: 7265 7374 5f52 4853 2c20 795f 6e65 6172  rest_RHS, y_near
+000256a0: 6573 745f 5248 532c 2027 2a6b 272c 206d  est_RHS, '*k', m
+000256b0: 6663 3d27 6772 6579 272c 206d 733d 3135  fc='grey', ms=15
+000256c0: 2c20 6c61 6265 6c3d 274c 4820 7469 6527  , label='LH tie'
+000256d0: 290a 0a0a 0a0a 2020 2020 2020 2020 6178  ).....        ax
+000256e0: 342e 706c 6f74 2878 2c20 792c 2027 2e72  4.plot(x, y, '.r
+000256f0: 2729 0a20 2020 2020 2020 2061 7834 2e70  ').        ax4.p
+00025700: 6c6f 7428 785f 6e65 772c 2079 5f63 7562  lot(x_new, y_cub
+00025710: 2c20 272d 6b27 290a 0a20 2020 2020 2020  , '-k')..       
+00025720: 2061 7834 2e70 6c6f 7428 5b50 6561 6b5f   ax4.plot([Peak_
+00025730: 4365 6e74 6572 2e69 6c6f 635b 305d 2c20  Center.iloc[0], 
+00025740: 5065 616b 5f43 656e 7465 722e 696c 6f63  Peak_Center.iloc
+00025750: 5b30 5d5d 2c20 5b50 6561 6b5f 4865 6967  [0]], [Peak_Heig
+00025760: 6874 2e69 6c6f 635b 305d 2c20 5065 616b  ht.iloc[0], Peak
+00025770: 5f48 6569 6768 742e 696c 6f63 5b30 5d5d  _Height.iloc[0]]
+00025780: 2c0a 2020 2020 2020 2020 2020 2020 2027  ,.             '
+00025790: 2a6b 272c 206d 6663 3d27 626c 7565 272c  *k', mfc='blue',
+000257a0: 206d 733d 3135 2c20 6c61 6265 6c3d 2753   ms=15, label='S
+000257b0: 6369 7079 2043 656e 7465 7227 290a 0a0a  cipy Center')...
+000257c0: 2020 2020 2020 2020 2320 4164 6420 746f          # Add to
+000257d0: 2070 6c6f 740a 0a20 2020 2020 2020 2061   plot..        a
+000257e0: 7834 2e70 6c6f 7428 636f 6e66 6967 312e  x4.plot(config1.
+000257f0: 6c6f 7765 725f 6263 6b5f 6469 6164 315b  lower_bck_diad1[
+00025800: 305d 2c20 636f 6e66 6967 312e 7570 7065  0], config1.uppe
+00025810: 725f 6263 6b5f 6469 6164 315b 315d 2c20  r_bck_diad1[1], 
+00025820: 5b79 5f69 6e74 5f63 7574 2c20 795f 696e  [y_int_cut, y_in
+00025830: 745f 6375 745d 2c20 273a 7227 290a 0a0a  t_cut], ':r')...
+00025840: 0a0a 2020 2020 2020 2020 6178 342e 7365  ..        ax4.se
+00025850: 745f 786c 696d 285b 785f 6e65 6172 6573  t_xlim([x_neares
+00025860: 745f 4c48 532d 3130 2c20 785f 6e65 6172  t_LHS-10, x_near
+00025870: 6573 745f 5248 532b 3130 5d29 0a20 2020  est_RHS+10]).   
+00025880: 2020 2020 2061 7834 2e73 6574 5f79 6c69       ax4.set_yli
+00025890: 6d28 5b30 2d31 302c 2050 6561 6b5f 4865  m([0-10, Peak_He
+000258a0: 6967 6874 2e69 6c6f 635b 305d 2a31 2e32  ight.iloc[0]*1.2
+000258b0: 5d29 0a20 2020 2020 2020 2061 7834 2e70  ]).        ax4.p
+000258c0: 6c6f 7428 5b50 6561 6b5f 4365 6e74 6572  lot([Peak_Center
+000258d0: 2e69 6c6f 635b 305d 2c20 5065 616b 5f43  .iloc[0], Peak_C
+000258e0: 656e 7465 722e 696c 6f63 5b30 5d5d 2c20  enter.iloc[0]], 
+000258f0: 5b30 2c20 5065 616b 5f48 6569 6768 742e  [0, Peak_Height.
+00025900: 696c 6f63 5b30 5d5d 2c20 273a 6227 290a  iloc[0]], ':b').
+00025910: 0a0a 0a20 2020 2020 2020 2061 7834 2e61  ...        ax4.a
+00025920: 6e6e 6f74 6174 6528 2753 6b65 776e 6573  nnotate('Skewnes
+00025930: 733d 272b 7374 7228 6e70 2e72 6f75 6e64  s='+str(np.round
+00025940: 2841 535b 305d 2c20 3229 292c 0a20 2020  (AS[0], 2)),.   
+00025950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025960: 2020 7879 3d28 785f 6e65 6172 6573 745f    xy=(x_nearest_
+00025970: 5248 532b 322c 2079 5f69 6e74 5f63 7574  RHS+2, y_int_cut
+00025980: 2b79 5f69 6e74 5f63 7574 2b28 5065 616b  +y_int_cut+(Peak
+00025990: 5f48 6569 6768 742e 696c 6f63 5b30 5d2d  _Height.iloc[0]-
+000259a0: 795f 696e 745f 6375 7429 2f31 3029 2c20  y_int_cut)/10), 
+000259b0: 7879 636f 6f72 6473 3d22 6461 7461 222c  xycoords="data",
+000259c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000259d0: 2020 2020 2020 2066 6f6e 7473 697a 653d         fontsize=
+000259e0: 3132 290a 0a20 2020 2020 2020 2061 7832  12)..        ax2
+000259f0: 2e6c 6567 656e 6428 290a 2020 2020 2020  .legend().      
+00025a00: 2020 6178 312e 6c65 6765 6e64 2829 0a20    ax1.legend(). 
+00025a10: 2020 2020 2020 2061 7833 2e6c 6567 656e         ax3.legen
+00025a20: 6428 290a 2020 2020 2020 2020 6178 342e  d().        ax4.
+00025a30: 6c65 6765 6e64 2829 0a20 2020 2020 2020  legend().       
+00025a40: 2061 7831 2e73 6574 5f78 6c61 6265 6c28   ax1.set_xlabel(
+00025a50: 2757 6176 656e 756d 6265 7220 2863 6d24  'Wavenumber (cm$
+00025a60: 5e7b 2d31 7d24 2927 290a 2020 2020 2020  ^{-1}$)').      
+00025a70: 2020 6178 322e 7365 745f 786c 6162 656c    ax2.set_xlabel
+00025a80: 2827 5761 7665 6e75 6d62 6572 2028 636d  ('Wavenumber (cm
+00025a90: 245e 7b2d 317d 2429 2729 0a20 2020 2020  $^{-1}$)').     
+00025aa0: 2020 2061 7833 2e73 6574 5f78 6c61 6265     ax3.set_xlabe
+00025ab0: 6c28 2757 6176 656e 756d 6265 7220 2863  l('Wavenumber (c
+00025ac0: 6d24 5e7b 2d31 7d24 2927 290a 2020 2020  m$^{-1}$)').    
+00025ad0: 2020 2020 6178 342e 7365 745f 786c 6162      ax4.set_xlab
+00025ae0: 656c 2827 5761 7665 6e75 6d62 6572 2028  el('Wavenumber (
+00025af0: 636d 245e 7b2d 317d 2429 2729 0a20 2020  cm$^{-1}$)').   
+00025b00: 2020 2020 2061 7831 2e73 6574 5f79 6c61       ax1.set_yla
+00025b10: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
+00025b20: 0a20 2020 2020 2020 2061 7832 2e73 6574  .        ax2.set
+00025b30: 5f79 6c61 6265 6c28 2749 6e74 656e 7369  _ylabel('Intensi
+00025b40: 7479 2729 0a20 2020 2020 2020 2061 7833  ty').        ax3
+00025b50: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+00025b60: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+00025b70: 2061 7834 2e73 6574 5f79 6c61 6265 6c28   ax4.set_ylabel(
+00025b80: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
+00025b90: 2020 2020 2066 6967 2e74 6967 6874 5f6c       fig.tight_l
+00025ba0: 6179 6f75 7428 290a 0a0a 0a20 2020 2020  ayout()....     
+00025bb0: 2020 2070 6174 6833 3d70 6174 682b 272f     path3=path+'/
+00025bc0: 272b 2753 6b65 776e 6573 735f 696d 6167  '+'Skewness_imag
+00025bd0: 6573 270a 2020 2020 2020 2020 6966 206f  es'.        if o
+00025be0: 732e 7061 7468 2e65 7869 7374 7328 7061  s.path.exists(pa
+00025bf0: 7468 3329 3a0a 2020 2020 2020 2020 2020  th3):.          
+00025c00: 2020 6f75 743d 2770 6174 6820 6578 6973    out='path exis
+00025c10: 7473 270a 2020 2020 2020 2020 656c 7365  ts'.        else
+00025c20: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00025c30: 2e6d 616b 6564 6972 7328 7061 7468 2b27  .makedirs(path+'
+00025c40: 2f27 2b20 2753 6b65 776e 6573 735f 696d  /'+ 'Skewness_im
+00025c50: 6167 6573 272c 2065 7869 7374 5f6f 6b3d  ages', exist_ok=
+00025c60: 4661 6c73 6529 0a0a 0a20 2020 2020 2020  False)...       
+00025c70: 2066 696c 653d 6669 6c65 6e61 6d65 2e72   file=filename.r
+00025c80: 7370 6c69 7428 272e 7478 7427 2c20 3129  split('.txt', 1)
+00025c90: 5b30 5d0a 2020 2020 2020 2020 6669 672e  [0].        fig.
+00025ca0: 7361 7665 6669 6728 7061 7468 332b 272f  savefig(path3+'/
+00025cb0: 272b 2744 6961 6431 5f73 6b65 776e 6573  '+'Diad1_skewnes
+00025cc0: 735f 7b7d 2e70 6e67 272e 666f 726d 6174  s_{}.png'.format
+00025cd0: 2866 696c 6529 2c20 6470 693d 6470 6929  (file), dpi=dpi)
+00025ce0: 0a0a 2020 2020 6466 5f6f 7574 3d70 642e  ..    df_out=pd.
+00025cf0: 4461 7461 4672 616d 6528 6461 7461 3d7b  DataFrame(data={
+00025d00: 2766 696c 656e 616d 6527 3a66 696c 656e  'filename':filen
+00025d10: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00025d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d30: 2020 2027 536b 6577 6e65 7373 5f64 6961     'Skewness_dia
+00025d40: 6431 273a 2041 532c 0a20 2020 2020 2020  d1': AS,.       
+00025d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d60: 2020 2020 2020 2027 4c48 535f 7469 655f         'LHS_tie_
+00025d70: 6469 6164 3127 3a20 785f 6e65 6172 6573  diad1': x_neares
+00025d80: 745f 4c48 532c 0a20 2020 2020 2020 2020  t_LHS,.         
+00025d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025da0: 2020 2020 2027 5248 535f 7469 655f 6469       'RHS_tie_di
+00025db0: 6164 3127 3a20 785f 6e65 6172 6573 745f  ad1': x_nearest_
+00025dc0: 5248 537d 290a 0a20 2020 2072 6574 7572  RHS})..    retur
+00025dd0: 6e20 6466 5f6f 7574 0a0a 0a0a 0a64 6566  n df_out.....def
+00025de0: 2061 7373 6573 735f 6469 6164 325f 736b   assess_diad2_sk
+00025df0: 6577 6e65 7373 282a 2c20 2063 6f6e 6669  ewness(*,  confi
+00025e00: 6731 3a20 6469 6164 325f 6669 745f 636f  g1: diad2_fit_co
+00025e10: 6e66 6967 3d64 6961 6431 5f66 6974 5f63  nfig=diad1_fit_c
+00025e20: 6f6e 6669 6728 292c 2069 6e74 5f63 7574  onfig(), int_cut
+00025e30: 5f6f 6666 3d30 2e33 2c20 7061 7468 3d4e  _off=0.3, path=N
+00025e40: 6f6e 652c 2066 696c 656e 616d 653d 4e6f  one, filename=No
+00025e50: 6e65 2c20 6669 6c65 7479 7065 3d4e 6f6e  ne, filetype=Non
+00025e60: 652c 0a73 6b65 776e 6573 733d 2761 6273  e,.skewness='abs
+00025e70: 272c 2068 6569 6768 743d 312c 2070 726f  ', height=1, pro
+00025e80: 6d69 6e65 6e63 653d 352c 2077 6964 7468  minence=5, width
+00025e90: 3d30 2e35 2c20 706c 6f74 5f66 6967 7572  =0.5, plot_figur
+00025ea0: 653d 5472 7565 2c20 6470 693d 3230 3029  e=True, dpi=200)
+00025eb0: 3a0a 0a20 2020 2022 2222 2041 7373 6573  :..    """ Asses
+00025ec0: 7365 7320 536b 6577 6e65 7373 206f 6620  ses Skewness of 
+00025ed0: 4469 6164 2070 6561 6b73 2e20 5573 6566  Diad peaks. Usef
+00025ee0: 756c 2066 6f72 2069 6465 6e74 6966 7969  ul for identifyi
+00025ef0: 6e67 206d 6978 6564 204c 202b 2056 2070  ng mixed L + V p
+00025f00: 6861 7365 730a 2020 2020 2873 6565 2044  hases.    (see D
+00025f10: 6556 6974 7265 2065 7420 616c 2e20 696e  eVitre et al. in
+00025f20: 2072 6576 6965 7729 0a0a 0a20 2020 2050   review)...    P
+00025f30: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00025f40: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f  ---------.    co
+00025f50: 6e66 6967 313a 2064 6961 6432 5f66 6974  nfig1: diad2_fit
+00025f60: 5f63 6f6e 6669 6728 2920 6461 7461 636c  _config() datacl
+00025f70: 6173 732e 2049 6d70 6f72 7420 7061 7261  ass. Import para
+00025f80: 6d65 7465 7273 2066 6f72 2074 6869 7320  meters for this 
+00025f90: 6675 6e63 7469 6f6e 2061 7265 2e0a 0a20  function are... 
+00025fa0: 2020 2020 2020 206c 6f77 6572 5f62 636b         lower_bck
+00025fb0: 5f64 6961 6432 2c20 7570 7065 725f 6263  _diad2, upper_bc
+00025fc0: 6b5f 6469 6164 323a 205b 666c 6f61 742c  k_diad2: [float,
+00025fd0: 2066 6c6f 6174 5d0a 2020 2020 2020 2020   float].        
+00025fe0: 2020 2020 6261 636b 6772 6f75 6e64 2070      background p
+00025ff0: 6f73 6974 696f 6e20 746f 206c 6566 7420  osition to left 
+00026000: 616e 6420 7269 6768 7420 6f66 206f 7665  and right of ove
+00026010: 7261 6c20 6469 6164 2072 6567 696f 6e20  ral diad region 
+00026020: 2869 6e63 2064 6961 642b 2d48 422b 2d43  (inc diad+-HB+-C
+00026030: 3133 290a 0a20 2020 2020 2020 204e 5f70  13)..        N_p
+00026040: 6f6c 795f 6263 6b5f 6469 6164 313a 2069  oly_bck_diad1: i
+00026050: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
+00026060: 6567 7265 6520 6f66 2070 6f6c 796e 6f6d  egree of polynom
+00026070: 6961 6c20 746f 2066 6974 2074 6f20 7468  ial to fit to th
+00026080: 6520 6261 636b 6772 6f75 6e64 2e0a 0a20  e background... 
+00026090: 2020 2020 2020 2065 7863 6c75 6465 5f72         exclude_r
+000260a0: 616e 6765 312c 2065 7863 6c75 6465 5f72  ange1, exclude_r
+000260b0: 616e 6765 323a 2054 7570 6c65 5b66 6c6f  ange2: Tuple[flo
+000260c0: 6174 2c20 666c 6f61 745d 0a20 2020 2020  at, float].     
+000260d0: 2020 2020 2020 2052 616e 6765 2074 6f20         Range to 
+000260e0: 6578 636c 7564 650a 0a20 2020 2069 6e74  exclude..    int
+000260f0: 5f63 7574 5f6f 6666 3a20 666c 6f61 740a  _cut_off: float.
+00026100: 2020 2020 2020 2020 5661 6c75 6520 6f66          Value of
+00026110: 2069 6e74 656e 7369 7479 2061 7420 7768   intensity at wh
+00026120: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
+00026130: 2074 6865 2073 6b65 776e 6573 7320 2865   the skewness (e
+00026140: 2e67 2e20 302e 3135 5820 7468 6520 7065  .g. 0.15X the pe
+00026150: 616b 2068 6569 6768 7429 2e0a 0a20 2020  ak height)...   
+00026160: 2070 6174 683a 2073 7472 0a20 2020 2020   path: str.     
+00026170: 2020 2046 6f6c 6465 7220 7573 6572 2077     Folder user w
+00026180: 6973 6865 7320 746f 2072 6561 6420 6461  ishes to read da
+00026190: 7461 2066 726f 6d0a 0a20 2020 2066 696c  ta from..    fil
+000261a0: 656e 616d 653a 2073 7472 0a20 2020 2020  ename: str.     
+000261b0: 2020 2053 7065 6369 6669 6320 6669 6c65     Specific file
+000261c0: 2062 6569 6e67 2072 6561 640a 0a0a 2020   being read...  
+000261d0: 2020 6669 6c65 7479 7065 3a20 7374 720a    filetype: str.
+000261e0: 2020 2020 2020 2020 4964 656e 7469 6669          Identifi
+000261f0: 6573 2074 7970 6520 6f66 2066 696c 650a  es type of file.
+00026200: 2020 2020 2020 2020 6368 6f6f 7365 2066          choose f
+00026210: 726f 6d20 2757 6974 6563 5f41 5343 4949  rom 'Witec_ASCII
+00026220: 272c 2027 6865 6164 6c65 7373 5f74 7874  ', 'headless_txt
+00026230: 272c 2027 6865 6164 6c65 7373 5f63 7376  ', 'headless_csv
+00026240: 272c 2027 6865 6164 5f63 7376 272c 2027  ', 'head_csv', '
+00026250: 5769 7465 635f 4153 4349 4927 2c0a 2020  Witec_ASCII',.  
+00026260: 2020 2020 2020 2748 4f52 4942 415f 7478        'HORIBA_tx
+00026270: 7427 2c20 2752 656e 6973 6861 775f 7478  t', 'Renishaw_tx
+00026280: 7427 0a0a 2020 2020 736b 6577 6e65 7373  t'..    skewness
+00026290: 3a20 2761 6273 2720 6f72 2027 6469 7227  : 'abs' or 'dir'
+000262a0: 0a20 2020 2020 2020 2049 6620 2761 6273  .        If 'abs
+000262b0: 272c 2067 6976 6573 2061 6273 6f6c 7574  ', gives absolut
+000262c0: 6520 736b 6577 6e65 7373 2028 652e 672e  e skewness (e.g.
+000262d0: 2c20 6c61 7267 6573 7420 706f 7373 6962  , largest possib
+000262e0: 6c65 206e 756d 6265 7220 7265 6761 7264  le number regard
+000262f0: 6c65 7373 206f 6620 6469 7265 6374 696f  less of directio
+00026300: 6e29 0a20 2020 2020 2020 2069 6620 2764  n).        if 'd
+00026310: 6972 2720 646f 6573 2073 6b65 776e 6573  ir' does skewnes
+00026320: 7320 6173 206f 6e65 2073 6964 6520 6f76  s as one side ov
+00026330: 6572 2074 6865 206f 7468 6572 0a0a 0a20  er the other... 
+00026340: 2020 2068 6569 6768 742c 2070 726f 6d69     height, promi
+00026350: 6e65 6e63 652c 2077 6964 7468 3a20 666c  nence, width: fl
+00026360: 6f61 740a 2020 2020 2020 2020 5363 6970  oat.        Scip
+00026370: 7920 6669 6e64 2070 6561 6b20 7061 7261  y find peak para
+00026380: 6d65 7465 7273 0a0a 2020 2020 706c 6f74  meters..    plot
+00026390: 5f66 6967 7572 653a 2062 6f6f 6c0a 2020  _figure: bool.  
+000263a0: 2020 2020 2020 6966 2054 7275 652c 2070        if True, p
+000263b0: 6c6f 7473 2061 6e64 2073 6176 6573 2061  lots and saves a
+000263c0: 2066 6967 7572 652e 0a0a 2020 2020 6470   figure...    dp
+000263d0: 693a 2069 6e74 0a20 2020 2020 2020 2064  i: int.        d
+000263e0: 7069 2074 6f20 7361 7665 2069 6d61 6765  pi to save image
+000263f0: 2061 740a 0a0a 0a20 2020 2052 6574 7572   at....    Retur
+00026400: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  ns.    ---------
+00026410: 2d2d 0a20 2020 2070 642e 4461 7461 4672  --.    pd.DataFr
+00026420: 616d 6520 7769 7468 2069 6e66 6f72 6d61  ame with informa
+00026430: 7469 6f6e 2061 626f 7574 2066 696c 6520  tion about file 
+00026440: 616e 6420 736b 6577 6e65 7373 2070 6172  and skewness par
+00026450: 616d 6574 6572 732e 0a0a 2020 2020 2222  ameters...    ""
+00026460: 220a 0a0a 2320 4669 7273 742c 2064 6f20  "...# First, do 
+00026470: 7468 6520 6261 636b 6772 6f75 6e64 2073  the background s
+00026480: 7562 7472 6163 7469 6f6e 0a20 2020 2079  ubtraction.    y
+00026490: 5f63 6f72 725f 6469 6164 322c 2050 795f  _corr_diad2, Py_
+000264a0: 6261 7365 5f64 6961 6432 2c20 785f 6469  base_diad2, x_di
+000264b0: 6164 322c 2020 4469 6164 5f73 686f 7274  ad2,  Diad_short
+000264c0: 2c20 5079 5f62 6173 655f 6469 6164 322c  , Py_base_diad2,
+000264d0: 2050 665f 6261 7365 6c69 6e65 2c20 2042   Pf_baseline,  B
+000264e0: 6173 656c 696e 655f 7973 7562 5f64 6961  aseline_ysub_dia
+000264f0: 6432 2c20 4261 7365 6c69 6e65 5f78 5f64  d2, Baseline_x_d
+00026500: 6961 6432 2c20 4261 7365 6c69 6e65 2c20  iad2, Baseline, 
+00026510: 7370 616e 3d72 656d 6f76 655f 6469 6164  span=remove_diad
+00026520: 5f62 6173 656c 696e 6528 0a20 2020 2070  _baseline(.    p
+00026530: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+00026540: 6d65 3d66 696c 656e 616d 652c 2066 696c  me=filename, fil
+00026550: 6574 7970 653d 6669 6c65 7479 7065 2c20  etype=filetype, 
+00026560: 4e5f 706f 6c79 3d63 6f6e 6669 6731 2e4e  N_poly=config1.N
+00026570: 5f70 6f6c 795f 6263 6b5f 6469 6164 322c  _poly_bck_diad2,
+00026580: 0a20 2020 206c 6f77 6572 5f62 636b 3d63  .    lower_bck=c
+00026590: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
+000265a0: 5f64 6961 6432 2c20 7570 7065 725f 6263  _diad2, upper_bc
+000265b0: 6b3d 636f 6e66 6967 312e 7570 7065 725f  k=config1.upper_
+000265c0: 6263 6b5f 6469 6164 322c 2070 6c6f 745f  bck_diad2, plot_
+000265d0: 6669 6775 7265 3d46 616c 7365 290a 0a0a  figure=False)...
+000265e0: 0a20 2020 2078 5f6c 696e 5f62 6173 656c  .    x_lin_basel
+000265f0: 696e 653d 6e70 2e6c 696e 7370 6163 6528  ine=np.linspace(
+00026600: 636f 6e66 6967 312e 6c6f 7765 725f 6263  config1.lower_bc
+00026610: 6b5f 6469 6164 325b 305d 2c20 636f 6e66  k_diad2[0], conf
+00026620: 6967 312e 7570 7065 725f 6263 6b5f 6469  ig1.upper_bck_di
+00026630: 6164 325b 315d 2c20 3130 3030 3030 290a  ad2[1], 100000).
+00026640: 2020 2020 7962 6173 655f 786c 696e 3d50      ybase_xlin=P
+00026650: 665f 6261 7365 6c69 6e65 2878 5f6c 696e  f_baseline(x_lin
+00026660: 5f62 6173 656c 696e 6529 0a0a 0a0a 2320  _baseline)....# 
+00026670: 4765 7420 7820 616e 6420 7920 666f 7220  Get x and y for 
+00026680: 6375 6269 6320 7370 6c69 6e65 0a20 2020  cubic spline.   
+00026690: 2078 3d78 5f64 6961 6432 0a20 2020 2079   x=x_diad2.    y
+000266a0: 3d79 5f63 6f72 725f 6469 6164 320a 0a23  =y_corr_diad2..#
+000266b0: 2046 6974 7320 6120 2063 7562 6963 2073   Fits a  cubic s
+000266c0: 706c 696e 650a 2020 2020 6632 203d 2069  pline.    f2 = i
+000266d0: 6e74 6572 7031 6428 782c 2079 2c20 6b69  nterp1d(x, y, ki
+000266e0: 6e64 3d27 6375 6269 6327 290a 2020 2020  nd='cubic').    
+000266f0: 785f 6e65 773d 6e70 2e6c 696e 7370 6163  x_new=np.linspac
+00026700: 6528 6e70 2e6d 696e 2878 292c 206e 702e  e(np.min(x), np.
+00026710: 6d61 7828 7829 2c20 3130 3030 3030 290a  max(x), 100000).
+00026720: 0a20 2020 2079 5f63 7562 3d66 3228 785f  .    y_cub=f2(x_
+00026730: 6e65 7729 0a0a 0a0a 2320 5573 6520 5363  new)....# Use Sc
+00026740: 6970 7920 6669 6e64 2070 6561 6b73 2074  ipy find peaks t
+00026750: 6f20 6765 7420 7468 6174 2063 7562 6963  o get that cubic
+00026760: 2070 6561 6b0a 2020 2020 7065 616b 7320   peak.    peaks 
+00026770: 3d20 6669 6e64 5f70 6561 6b73 2879 5f63  = find_peaks(y_c
+00026780: 7562 2c20 6865 6967 6874 3d68 6569 6768  ub, height=heigh
+00026790: 742c 2070 726f 6d69 6e65 6e63 653d 7072  t, prominence=pr
+000267a0: 6f6d 696e 656e 6365 2c20 7769 6474 683d  ominence, width=
+000267b0: 7769 6474 6829 0a20 2020 2070 6561 6b5f  width).    peak_
+000267c0: 6865 6967 6874 3d70 6561 6b73 5b31 5d5b  height=peaks[1][
+000267d0: 2770 6561 6b5f 6865 6967 6874 7327 5d0a  'peak_heights'].
+000267e0: 2020 2020 7065 616b 5f70 6f73 203d 2078      peak_pos = x
+000267f0: 5f6e 6577 5b70 6561 6b73 5b30 5d5d 0a0a  _new[peaks[0]]..
+00026800: 2020 2020 2320 6669 6e64 206d 6178 2070      # find max p
+00026810: 6561 6b2e 2020 7075 7420 696e 746f 2064  eak.  put into d
+00026820: 6620 6265 6361 7573 6520 6927 6d20 6c61  f because i'm la
+00026830: 7a79 0a20 2020 2070 6561 6b5f 6466 3d70  zy.    peak_df=p
+00026840: 642e 4461 7461 4672 616d 6528 6461 7461  d.DataFrame(data
+00026850: 3d7b 2770 6f73 273a 2070 6561 6b5f 706f  ={'pos': peak_po
+00026860: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00026870: 2020 2020 2020 2020 2020 2027 6865 6967             'heig
+00026880: 6874 273a 2070 6561 6b5f 6865 6967 6874  ht': peak_height
+00026890: 7d29 0a0a 2020 2020 6466 5f70 6561 6b5f  })..    df_peak_
+000268a0: 736f 7274 3d70 6561 6b5f 6466 2e73 6f72  sort=peak_df.sor
+000268b0: 745f 7661 6c75 6573 2827 6865 6967 6874  t_values('height
+000268c0: 272c 2061 7869 733d 302c 2061 7363 656e  ', axis=0, ascen
+000268d0: 6469 6e67 3d46 616c 7365 290a 2020 2020  ding=False).    
+000268e0: 6466 5f70 6561 6b5f 736f 7274 5f74 7269  df_peak_sort_tri
+000268f0: 6d3d 6466 5f70 6561 6b5f 736f 7274 5b30  m=df_peak_sort[0
+00026900: 3a31 5d0a 2020 2020 5065 616b 5f43 656e  :1].    Peak_Cen
+00026910: 7465 723d 6466 5f70 6561 6b5f 736f 7274  ter=df_peak_sort
+00026920: 5f74 7269 6d5b 2770 6f73 275d 2e69 6c6f  _trim['pos'].ilo
+00026930: 635b 305d 0a20 2020 2050 6561 6b5f 4865  c[0].    Peak_He
+00026940: 6967 6874 3d64 665f 7065 616b 5f73 6f72  ight=df_peak_sor
+00026950: 745f 7472 696d 5b27 6865 6967 6874 275d  t_trim['height']
+00026960: 2e69 6c6f 635b 305d 0a0a 0a0a 0a0a 2320  .iloc[0]......# 
+00026970: 4669 6e64 2069 6e74 656e 7369 7479 2063  Find intensity c
+00026980: 7574 206f 6666 0a20 2020 2079 5f69 6e74  ut off.    y_int
+00026990: 5f63 7574 3d50 6561 6b5f 4865 6967 6874  _cut=Peak_Height
+000269a0: 2a69 6e74 5f63 7574 5f6f 6666 0a0a 2020  *int_cut_off..  
+000269b0: 2020 2320 5370 6c69 7420 7468 6520 6172    # Split the ar
+000269c0: 7261 7920 696e 746f 2061 204c 4853 2061  ray into a LHS a
+000269d0: 6e64 2061 2052 4853 0a20 2020 204c 4853  nd a RHS.    LHS
+000269e0: 5f79 3d79 5f63 7562 5b78 5f6e 6577 3c3d  _y=y_cub[x_new<=
+000269f0: 5065 616b 5f43 656e 7465 725d 0a20 2020  Peak_Center].   
+00026a00: 2052 4853 5f79 3d79 5f63 7562 5b78 5f6e   RHS_y=y_cub[x_n
+00026a10: 6577 3e50 6561 6b5f 4365 6e74 6572 5d0a  ew>Peak_Center].
+00026a20: 0a20 2020 204c 4853 5f78 3d78 5f6e 6577  .    LHS_x=x_new
+00026a30: 5b78 5f6e 6577 3c3d 5065 616b 5f43 656e  [x_new<=Peak_Cen
+00026a40: 7465 725d 0a20 2020 2052 4853 5f78 3d78  ter].    RHS_x=x
+00026a50: 5f6e 6577 5b78 5f6e 6577 3e50 6561 6b5f  _new[x_new>Peak_
+00026a60: 4365 6e74 6572 5d0a 0a20 2020 2023 204e  Center]..    # N
+00026a70: 6565 6420 746f 2066 6c69 7020 4c48 5320  eed to flip LHS 
+00026a80: 746f 2070 7574 2069 6e74 6f20 7468 6520  to put into the 
+00026a90: 6669 6e64 2063 6c6f 7365 7374 2066 756e  find closest fun
+00026aa0: 6374 696f 6e0a 2020 2020 4c48 535f 795f  ction.    LHS_y_
+00026ab0: 666c 6970 3d6e 702e 666c 6970 284c 4853  flip=np.flip(LHS
+00026ac0: 5f79 290a 2020 2020 4c48 535f 785f 666c  _y).    LHS_x_fl
+00026ad0: 6970 3d6e 702e 666c 6970 284c 4853 5f78  ip=np.flip(LHS_x
+00026ae0: 290a 0a20 2020 2076 616c 3d6e 702e 6172  )..    val=np.ar
+00026af0: 676d 6178 284c 4853 5f79 5f66 6c69 703c  gmax(LHS_y_flip<
+00026b00: 795f 696e 745f 6375 7429 0a0a 2020 2020  y_int_cut)..    
+00026b10: 7661 6c32 3d6e 702e 6172 676d 6178 2852  val2=np.argmax(R
+00026b20: 4853 5f79 3c79 5f69 6e74 5f63 7574 290a  HS_y<y_int_cut).
+00026b30: 0a0a 2020 2020 2320 4669 6e64 206e 6561  ..    # Find nea
+00026b40: 7265 7374 2078 2075 6e69 7420 746f 2074  rest x unit to t
+00026b50: 6869 7320 7661 6c75 650a 2020 2020 795f  his value.    y_
+00026b60: 6e65 6172 6573 745f 4c48 533d 4c48 535f  nearest_LHS=LHS_
+00026b70: 795f 666c 6970 5b76 616c 5d0a 2020 2020  y_flip[val].    
+00026b80: 785f 6e65 6172 6573 745f 4c48 533d 4c48  x_nearest_LHS=LH
+00026b90: 535f 785f 666c 6970 5b76 616c 5d0a 0a20  S_x_flip[val].. 
+00026ba0: 2020 2079 5f6e 6561 7265 7374 5f52 4853     y_nearest_RHS
+00026bb0: 3d52 4853 5f79 5b76 616c 325d 0a20 2020  =RHS_y[val2].   
+00026bc0: 2078 5f6e 6561 7265 7374 5f52 4853 3d52   x_nearest_RHS=R
+00026bd0: 4853 5f78 5b76 616c 325d 0a0a 2020 2020  HS_x[val2]..    
+00026be0: 2320 5265 7475 726e 2053 6b65 776e 6573  # Return Skewnes
+00026bf0: 730a 2020 2020 4c48 535f 4365 6e74 6572  s.    LHS_Center
+00026c00: 3d61 6273 2878 5f6e 6561 7265 7374 5f4c  =abs(x_nearest_L
+00026c10: 4853 2d50 6561 6b5f 4365 6e74 6572 290a  HS-Peak_Center).
+00026c20: 2020 2020 5248 535f 4365 6e74 6572 3d61      RHS_Center=a
+00026c30: 6273 2878 5f6e 6561 7265 7374 5f52 4853  bs(x_nearest_RHS
+00026c40: 2d50 6561 6b5f 4365 6e74 6572 290a 0a20  -Peak_Center).. 
+00026c50: 2020 2023 4164 6465 6420 636f 6e64 6974     #Added condit
+00026c60: 696f 6e61 6c20 746f 2061 6c77 6179 7320  ional to always 
+00026c70: 6861 7665 2061 2072 6174 696f 206f 6620  have a ratio of 
+00026c80: 7468 6520 6869 6768 2f6c 6f77 0a20 2020  the high/low.   
+00026c90: 2069 6620 736b 6577 6e65 7373 3d3d 2761   if skewness=='a
+00026ca0: 6273 273a 0a20 2020 2020 2020 2069 6620  bs':.        if 
+00026cb0: 4c48 535f 4365 6e74 6572 3e52 4853 5f43  LHS_Center>RHS_C
+00026cc0: 656e 7465 723a 0a20 2020 2020 2020 2020  enter:.         
+00026cd0: 2020 2041 533d 4c48 535f 4365 6e74 6572     AS=LHS_Center
+00026ce0: 2f52 4853 5f43 656e 7465 720a 2020 2020  /RHS_Center.    
+00026cf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00026d00: 2020 2020 2020 4153 3d52 4853 5f43 656e        AS=RHS_Cen
+00026d10: 7465 722f 4c48 535f 4365 6e74 6572 0a20  ter/LHS_Center. 
+00026d20: 2020 2065 6c69 6620 736b 6577 6e65 7373     elif skewness
+00026d30: 3d3d 2764 6972 273a 0a20 2020 2020 2020  =='dir':.       
+00026d40: 2041 533d 5248 535f 4365 6e74 6572 2f4c   AS=RHS_Center/L
+00026d50: 4853 5f43 656e 7465 720a 0a0a 2020 2020  HS_Center...    
+00026d60: 6966 2070 6c6f 745f 6669 6775 7265 2069  if plot_figure i
+00026d70: 7320 5472 7565 3a0a 0a20 2020 2020 2020  s True:..       
+00026d80: 2023 204d 616b 6520 7072 6574 7479 2066   # Make pretty f
+00026d90: 6967 7572 6520 7368 6f77 696e 6720 6261  igure showing ba
+00026da0: 636b 6772 6f75 6e64 2073 7562 7472 6163  ckground subtrac
+00026db0: 746f 696e 2072 6f75 7469 6e65 0a20 2020  toin routine.   
+00026dc0: 2020 2020 2066 6967 2c20 2828 6178 322c       fig, ((ax2,
+00026dd0: 2061 7831 292c 2028 6178 332c 2061 7834   ax1), (ax3, ax4
+00026de0: 2929 203d 2070 6c74 2e73 7562 706c 6f74  )) = plt.subplot
+00026df0: 7328 322c 2032 2c20 6669 6773 697a 653d  s(2, 2, figsize=
+00026e00: 2831 302c 3130 2929 0a20 2020 2020 2020  (10,10)).       
+00026e10: 2066 6967 2e73 7570 7469 746c 6528 2744   fig.suptitle('D
+00026e20: 6961 6420 3220 536b 6577 6e65 7373 2066  iad 2 Skewness f
+00026e30: 696c 653d 2027 2b20 7374 7228 6669 6c65  ile= '+ str(file
+00026e40: 6e61 6d65 292c 2066 6f6e 7473 697a 653d  name), fontsize=
+00026e50: 3136 2c20 783d 302e 352c 2079 3d31 2e30  16, x=0.5, y=1.0
+00026e60: 290a 0a20 2020 2020 2020 2061 7832 2e73  )..        ax2.s
+00026e70: 6574 5f74 6974 6c65 2827 6129 2053 7065  et_title('a) Spe
+00026e80: 6374 7261 2729 0a20 2020 2020 2020 2061  ctra').        a
+00026e90: 7832 2e70 6c6f 7428 4469 6164 5f73 686f  x2.plot(Diad_sho
+00026ea0: 7274 5b3a 2c20 305d 2c20 4469 6164 5f73  rt[:, 0], Diad_s
+00026eb0: 686f 7274 5b3a 2c20 315d 2c20 272d 7227  hort[:, 1], '-r'
+00026ec0: 2c20 6c61 6265 6c3d 2744 6174 6127 290a  , label='Data').
+00026ed0: 2020 2020 2020 2020 6178 322e 7365 745f          ax2.set_
+00026ee0: 786c 696d 285b 636f 6e66 6967 312e 6c6f  xlim([config1.lo
+00026ef0: 7765 725f 6263 6b5f 6469 6164 325b 305d  wer_bck_diad2[0]
+00026f00: 2b34 302c 2063 6f6e 6669 6731 2e75 7070  +40, config1.upp
+00026f10: 6572 5f62 636b 5f64 6961 6432 5b31 5d2d  er_bck_diad2[1]-
+00026f20: 3430 5d29 0a20 2020 2020 2020 2061 7831  40]).        ax1
+00026f30: 2e73 6574 5f74 6974 6c65 2827 6229 2042  .set_title('b) B
+00026f40: 6163 6b67 726f 756e 6420 6669 7427 290a  ackground fit').
+00026f50: 2020 2020 2020 2020 6178 312e 706c 6f74          ax1.plot
+00026f60: 2844 6961 645f 7368 6f72 745b 3a2c 2030  (Diad_short[:, 0
+00026f70: 5d2c 2044 6961 645f 7368 6f72 745b 3a2c  ], Diad_short[:,
+00026f80: 2031 5d2c 2027 2e2d 7227 2c20 6c61 6265   1], '.-r', labe
+00026f90: 6c3d 2744 6174 6127 290a 0a20 2020 2020  l='Data')..     
+00026fa0: 2020 2061 7831 2e70 6c6f 7428 4261 7365     ax1.plot(Base
+00026fb0: 6c69 6e65 5b3a 2c20 305d 2c20 4261 7365  line[:, 0], Base
+00026fc0: 6c69 6e65 5b3a 2c20 315d 2c20 272e 6227  line[:, 1], '.b'
+00026fd0: 2c20 6c61 6265 6c3d 2762 636b 2729 0a20  , label='bck'). 
+00026fe0: 2020 2020 2020 2061 7831 2e70 6c6f 7428         ax1.plot(
+00026ff0: 4469 6164 5f73 686f 7274 5b3a 2c20 305d  Diad_short[:, 0]
+00027000: 2c20 5079 5f62 6173 655f 6469 6164 322c  , Py_base_diad2,
+00027010: 2027 2d6b 272c 206c 6162 656c 3d27 6263   '-k', label='bc
+00027020: 6b20 6669 7427 290a 2020 2020 2020 2020  k fit').        
+00027030: 6178 332e 7365 745f 7469 746c 6528 2763  ax3.set_title('c
+00027040: 2920 4261 636b 6772 6f75 6e64 2073 7562  ) Background sub
+00027050: 7472 6163 7465 6427 290a 2020 2020 2020  tracted').      
+00027060: 2020 6178 332e 706c 6f74 2820 785f 6469    ax3.plot( x_di
+00027070: 6164 322c 795f 636f 7272 5f64 6961 6432  ad2,y_corr_diad2
+00027080: 2c20 272d 7227 2c20 6c61 6265 6c3d 2742  , '-r', label='B
+00027090: 636b 2073 7562 2729 0a0a 2020 2020 2320  ck sub')..    # 
+000270a0: 4164 6473 2063 7562 6963 2069 6e74 6572  Adds cubic inter
+000270b0: 706f 6c6f 6174 696f 6e20 666f 7220 696e  poloation for in
+000270c0: 7370 6563 7469 6f6e 0a0a 2020 2020 2020  spection..      
+000270d0: 2020 6178 342e 7365 745f 7469 746c 6528    ax4.set_title(
+000270e0: 2764 2920 4375 6269 6320 5370 6c69 6e65  'd) Cubic Spline
+000270f0: 2729 0a20 2020 2020 2020 2061 7834 2e70  ').        ax4.p
+00027100: 6c6f 7428 5b78 5f6e 6561 7265 7374 5f4c  lot([x_nearest_L
+00027110: 4853 2c20 5065 616b 5f43 656e 7465 725d  HS, Peak_Center]
+00027120: 2c20 5b79 5f69 6e74 5f63 7574 2c20 795f  , [y_int_cut, y_
+00027130: 696e 745f 6375 745d 2c20 272d 6727 290a  int_cut], '-g').
+00027140: 2020 2020 2020 2020 6178 342e 616e 6e6f          ax4.anno
+00027150: 7461 7465 2873 7472 286e 702e 726f 756e  tate(str(np.roun
+00027160: 6428 4c48 535f 4365 6e74 6572 2c20 3229  d(LHS_Center, 2)
+00027170: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00027180: 2020 2020 2020 2020 7879 3d28 785f 6e65          xy=(x_ne
+00027190: 6172 6573 745f 4c48 532d 332c 2079 5f69  arest_LHS-3, y_i
+000271a0: 6e74 5f63 7574 2b28 5065 616b 5f48 6569  nt_cut+(Peak_Hei
+000271b0: 6768 742d 795f 696e 745f 6375 7429 2f31  ght-y_int_cut)/1
+000271c0: 3029 2c20 7879 636f 6f72 6473 3d22 6461  0), xycoords="da
+000271d0: 7461 222c 0a20 2020 2020 2020 2020 2020  ta",.           
+000271e0: 2020 2020 2020 2020 2020 666f 6e74 7369            fontsi
+000271f0: 7a65 3d31 322c 2063 6f6c 6f72 3d27 6772  ze=12, color='gr
+00027200: 6565 6e27 290a 2020 2020 2020 2020 6178  een').        ax
+00027210: 342e 706c 6f74 2878 5f6e 6561 7265 7374  4.plot(x_nearest
+00027220: 5f4c 4853 2c20 795f 6e65 6172 6573 745f  _LHS, y_nearest_
+00027230: 4c48 532c 2027 2a6b 272c 206d 6663 3d27  LHS, '*k', mfc='
+00027240: 6772 6565 6e27 2c6d 733d 3135 2c20 6c61  green',ms=15, la
+00027250: 6265 6c3d 2752 4820 7469 6527 290a 0a0a  bel='RH tie')...
+00027260: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
+00027270: 7428 5b50 6561 6b5f 4365 6e74 6572 2c20  t([Peak_Center, 
+00027280: 785f 6e65 6172 6573 745f 5248 535d 2c20  x_nearest_RHS], 
+00027290: 5b79 5f69 6e74 5f63 7574 2c20 795f 696e  [y_int_cut, y_in
+000272a0: 745f 6375 745d 2c20 272d 272c 2063 6f6c  t_cut], '-', col
+000272b0: 6f72 3d27 6772 6579 2729 0a20 2020 2020  or='grey').     
+000272c0: 2020 2061 7834 2e61 6e6e 6f74 6174 6528     ax4.annotate(
+000272d0: 7374 7228 6e70 2e72 6f75 6e64 2852 4853  str(np.round(RHS
+000272e0: 5f43 656e 7465 722c 2032 2929 2c0a 2020  _Center, 2)),.  
+000272f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027300: 2020 2078 793d 2878 5f6e 6561 7265 7374     xy=(x_nearest
+00027310: 5f52 4853 2b33 2c20 795f 696e 745f 6375  _RHS+3, y_int_cu
+00027320: 742b 2850 6561 6b5f 4865 6967 6874 2d79  t+(Peak_Height-y
+00027330: 5f69 6e74 5f63 7574 292f 3130 292c 2078  _int_cut)/10), x
+00027340: 7963 6f6f 7264 733d 2264 6174 6122 2c0a  ycoords="data",.
+00027350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027360: 2020 2020 2020 666f 6e74 7369 7a65 3d31        fontsize=1
+00027370: 322c 2063 6f6c 6f72 3d27 6772 6579 2729  2, color='grey')
+00027380: 0a20 2020 2020 2020 2061 7834 2e70 6c6f  .        ax4.plo
+00027390: 7428 785f 6e65 6172 6573 745f 5248 532c  t(x_nearest_RHS,
+000273a0: 2079 5f6e 6561 7265 7374 5f52 4853 2c20   y_nearest_RHS, 
+000273b0: 272a 6b27 2c20 6d66 633d 2767 7265 7927  '*k', mfc='grey'
+000273c0: 2c20 6d73 3d31 352c 206c 6162 656c 3d27  , ms=15, label='
+000273d0: 4c48 2074 6965 2729 0a0a 0a0a 0a20 2020  LH tie').....   
+000273e0: 2020 2020 2061 7834 2e70 6c6f 7428 782c       ax4.plot(x,
+000273f0: 2079 2c20 272e 7227 290a 2020 2020 2020   y, '.r').      
+00027400: 2020 6178 342e 706c 6f74 2878 5f6e 6577    ax4.plot(x_new
+00027410: 2c20 795f 6375 622c 2027 2d6b 2729 0a0a  , y_cub, '-k')..
+00027420: 2020 2020 2020 2020 6178 342e 706c 6f74          ax4.plot
+00027430: 285b 5065 616b 5f43 656e 7465 722c 2050  ([Peak_Center, P
+00027440: 6561 6b5f 4365 6e74 6572 5d2c 205b 5065  eak_Center], [Pe
+00027450: 616b 5f48 6569 6768 742c 2050 6561 6b5f  ak_Height, Peak_
+00027460: 4865 6967 6874 5d2c 0a20 2020 2020 2020  Height],.       
+00027470: 2020 2020 2020 272a 6b27 2c20 6d66 633d        '*k', mfc=
+00027480: 2762 6c75 6527 2c20 6d73 3d31 352c 206c  'blue', ms=15, l
+00027490: 6162 656c 3d27 5363 6970 7920 4365 6e74  abel='Scipy Cent
+000274a0: 6572 2729 0a0a 0a20 2020 2020 2020 2023  er')...        #
+000274b0: 2041 6464 2074 6f20 706c 6f74 0a0a 2020   Add to plot..  
+000274c0: 2020 2020 2020 6178 342e 706c 6f74 2863        ax4.plot(c
+000274d0: 6f6e 6669 6731 2e6c 6f77 6572 5f62 636b  onfig1.lower_bck
+000274e0: 5f64 6961 6432 5b30 5d2c 2063 6f6e 6669  _diad2[0], confi
+000274f0: 6731 2e75 7070 6572 5f62 636b 5f64 6961  g1.upper_bck_dia
+00027500: 6432 5b31 5d2c 205b 795f 696e 745f 6375  d2[1], [y_int_cu
+00027510: 742c 2079 5f69 6e74 5f63 7574 5d2c 2027  t, y_int_cut], '
+00027520: 3a72 2729 0a0a 0a0a 0a20 2020 2020 2020  :r').....       
+00027530: 2061 7834 2e73 6574 5f78 6c69 6d28 5b78   ax4.set_xlim([x
+00027540: 5f6e 6561 7265 7374 5f4c 4853 2d31 302c  _nearest_LHS-10,
+00027550: 2078 5f6e 6561 7265 7374 5f52 4853 2b31   x_nearest_RHS+1
+00027560: 305d 290a 2020 2020 2020 2020 6178 342e  0]).        ax4.
+00027570: 7365 745f 796c 696d 285b 302d 3130 2c20  set_ylim([0-10, 
+00027580: 5065 616b 5f48 6569 6768 742a 312e 325d  Peak_Height*1.2]
+00027590: 290a 2020 2020 2020 2020 6178 342e 706c  ).        ax4.pl
+000275a0: 6f74 285b 5065 616b 5f43 656e 7465 722c  ot([Peak_Center,
+000275b0: 2050 6561 6b5f 4365 6e74 6572 5d2c 205b   Peak_Center], [
+000275c0: 302c 2050 6561 6b5f 4865 6967 6874 5d2c  0, Peak_Height],
+000275d0: 2027 3a62 2729 0a0a 0a0a 2020 2020 2020   ':b')....      
+000275e0: 2020 6178 342e 616e 6e6f 7461 7465 2827    ax4.annotate('
+000275f0: 536b 6577 6e65 7373 3d27 2b73 7472 286e  Skewness='+str(n
+00027600: 702e 726f 756e 6428 4153 2c20 3229 292c  p.round(AS, 2)),
+00027610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027620: 2020 2020 2020 7879 3d28 785f 6e65 6172        xy=(x_near
+00027630: 6573 745f 5248 532b 322c 2079 5f69 6e74  est_RHS+2, y_int
+00027640: 5f63 7574 2b79 5f69 6e74 5f63 7574 2b28  _cut+y_int_cut+(
+00027650: 5065 616b 5f48 6569 6768 742d 795f 696e  Peak_Height-y_in
+00027660: 745f 6375 7429 2f31 3029 2c20 7879 636f  t_cut)/10), xyco
+00027670: 6f72 6473 3d22 6461 7461 222c 0a20 2020  ords="data",.   
+00027680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027690: 2020 2066 6f6e 7473 697a 653d 3130 290a     fontsize=10).
+000276a0: 0a20 2020 2020 2020 2061 7832 2e6c 6567  .        ax2.leg
+000276b0: 656e 6428 290a 2020 2020 2020 2020 6178  end().        ax
+000276c0: 312e 6c65 6765 6e64 2829 0a20 2020 2020  1.legend().     
+000276d0: 2020 2061 7833 2e6c 6567 656e 6428 290a     ax3.legend().
+000276e0: 2020 2020 2020 2020 6178 342e 6c65 6765          ax4.lege
+000276f0: 6e64 2829 0a20 2020 2020 2020 2061 7831  nd().        ax1
+00027700: 2e73 6574 5f78 6c61 6265 6c28 2757 6176  .set_xlabel('Wav
+00027710: 656e 756d 6265 7220 2863 6d24 5e7b 2d31  enumber (cm$^{-1
+00027720: 7d24 2927 290a 2020 2020 2020 2020 6178  }$)').        ax
+00027730: 322e 7365 745f 786c 6162 656c 2827 5761  2.set_xlabel('Wa
+00027740: 7665 6e75 6d62 6572 2028 636d 245e 7b2d  venumber (cm$^{-
+00027750: 317d 2429 2729 0a20 2020 2020 2020 2061  1}$)').        a
+00027760: 7833 2e73 6574 5f78 6c61 6265 6c28 2757  x3.set_xlabel('W
+00027770: 6176 656e 756d 6265 7220 2863 6d24 5e7b  avenumber (cm$^{
+00027780: 2d31 7d24 2927 290a 2020 2020 2020 2020  -1}$)').        
+00027790: 6178 342e 7365 745f 786c 6162 656c 2827  ax4.set_xlabel('
+000277a0: 5761 7665 6e75 6d62 6572 2028 636d 245e  Wavenumber (cm$^
+000277b0: 7b2d 317d 2429 2729 0a20 2020 2020 2020  {-1}$)').       
+000277c0: 2061 7831 2e73 6574 5f79 6c61 6265 6c28   ax1.set_ylabel(
+000277d0: 2749 6e74 656e 7369 7479 2729 0a20 2020  'Intensity').   
+000277e0: 2020 2020 2061 7832 2e73 6574 5f79 6c61       ax2.set_yla
+000277f0: 6265 6c28 2749 6e74 656e 7369 7479 2729  bel('Intensity')
+00027800: 0a20 2020 2020 2020 2061 7833 2e73 6574  .        ax3.set
+00027810: 5f79 6c61 6265 6c28 2749 6e74 656e 7369  _ylabel('Intensi
+00027820: 7479 2729 0a20 2020 2020 2020 2061 7834  ty').        ax4
+00027830: 2e73 6574 5f79 6c61 6265 6c28 2749 6e74  .set_ylabel('Int
+00027840: 656e 7369 7479 2729 0a20 2020 2020 2020  ensity').       
+00027850: 2066 6967 2e74 6967 6874 5f6c 6179 6f75   fig.tight_layou
+00027860: 7428 290a 0a0a 2020 2020 2020 2020 7061  t()...        pa
+00027870: 7468 333d 7061 7468 2b27 2f27 2b27 536b  th3=path+'/'+'Sk
+00027880: 6577 6e65 7373 5f69 6d61 6765 7327 0a20  ewness_images'. 
+00027890: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+000278a0: 682e 6578 6973 7473 2870 6174 6833 293a  h.exists(path3):
+000278b0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+000278c0: 3d27 7061 7468 2065 7869 7374 7327 0a20  ='path exists'. 
+000278d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000278e0: 2020 2020 2020 2020 206f 732e 6d61 6b65           os.make
+000278f0: 6469 7273 2870 6174 682b 272f 272b 2027  dirs(path+'/'+ '
+00027900: 536b 6577 6e65 7373 5f69 6d61 6765 7327  Skewness_images'
+00027910: 2c20 6578 6973 745f 6f6b 3d46 616c 7365  , exist_ok=False
+00027920: 290a 0a0a 2020 2020 2020 2020 6669 6c65  )...        file
+00027930: 3d66 696c 656e 616d 652e 7273 706c 6974  =filename.rsplit
+00027940: 2827 2e74 7874 272c 2031 295b 305d 0a20  ('.txt', 1)[0]. 
+00027950: 2020 2020 2020 2066 6967 2e73 6176 6566         fig.savef
+00027960: 6967 2870 6174 6833 2b27 2f27 2b27 4469  ig(path3+'/'+'Di
+00027970: 6164 325f 736b 6577 6e65 7373 5f7b 7d2e  ad2_skewness_{}.
+00027980: 706e 6727 2e66 6f72 6d61 7428 6669 6c65  png'.format(file
+00027990: 292c 2064 7069 3d64 7069 290a 0a0a 2020  ), dpi=dpi)...  
+000279a0: 2020 6466 5f6f 7574 3d70 642e 4461 7461    df_out=pd.Data
+000279b0: 4672 616d 6528 6461 7461 3d7b 0a20 2020  Frame(data={.   
+000279c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000279d0: 2020 2020 2020 2020 2020 2027 536b 6577             'Skew
+000279e0: 6e65 7373 5f64 6961 6432 273a 2041 532c  ness_diad2': AS,
+000279f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027a00: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00027a10: 4c48 535f 7469 655f 6469 6164 3227 3a20  LHS_tie_diad2': 
+00027a20: 785f 6e65 6172 6573 745f 4c48 532c 0a20  x_nearest_LHS,. 
+00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a40: 2020 2020 2020 2020 2020 2020 2027 5248               'RH
+00027a50: 535f 7469 655f 6469 6164 3227 3a20 785f  S_tie_diad2': x_
+00027a60: 6e65 6172 6573 745f 5248 537d 2c20 696e  nearest_RHS}, in
+00027a70: 6465 783d 5b30 5d29 0a0a 2020 2020 7265  dex=[0])..    re
+00027a80: 7475 726e 2064 665f 6f75 740a 0a0a 6465  turn df_out...de
+00027a90: 6620 6c6f 6f70 5f64 6961 645f 736b 6577  f loop_diad_skew
+00027aa0: 6e65 7373 282a 2c20 4469 6164 5f66 696c  ness(*, Diad_fil
+00027ab0: 6573 2c20 7061 7468 3d4e 6f6e 652c 2066  es, path=None, f
+00027ac0: 696c 6574 7970 653d 4e6f 6e65 2c20 2073  iletype=None,  s
+00027ad0: 6b65 776e 6573 733d 2761 6273 272c 2073  kewness='abs', s
+00027ae0: 6f72 743d 4661 6c73 652c 2069 6e74 5f63  ort=False, int_c
+00027af0: 7574 5f6f 6666 3d30 2e31 352c 0a63 6f6e  ut_off=0.15,.con
+00027b00: 6669 675f 6469 6164 313a 2064 6961 6431  fig_diad1: diad1
+00027b10: 5f66 6974 5f63 6f6e 6669 673d 6469 6164  _fit_config=diad
+00027b20: 315f 6669 745f 636f 6e66 6967 2829 2c20  1_fit_config(), 
+00027b30: 636f 6e66 6967 5f64 6961 6432 3a20 6469  config_diad2: di
+00027b40: 6164 325f 6669 745f 636f 6e66 6967 3d64  ad2_fit_config=d
+00027b50: 6961 6432 5f66 6974 5f63 6f6e 6669 6728  iad2_fit_config(
+00027b60: 292c 2070 726f 6d69 6e65 6e63 653d 3130  ), prominence=10
+00027b70: 2c20 7769 6474 683d 312c 2068 6569 6768  , width=1, heigh
+00027b80: 743d 3129 3a0a 2020 2020 2222 2220 4c6f  t=1):.    """ Lo
+00027b90: 6f70 7320 6f76 6572 2061 6c6c 2073 7570  ops over all sup
+00027ba0: 706c 6965 6420 6669 6c65 7320 746f 2063  plied files to c
+00027bb0: 616c 6375 6c61 7465 2073 6b65 776e 6573  alculate skewnes
+00027bc0: 7320 666f 7220 6d75 6c74 6970 6c65 2073  s for multiple s
+00027bd0: 7065 6374 7261 2075 7369 6e67 2074 6865  pectra using the
+00027be0: 2066 756e 6374 696f 6e73 2061 7373 6573   functions asses
+00027bf0: 735f 6469 6164 315f 736b 6577 6e65 7373  s_diad1_skewness
+00027c00: 2829 2061 6e64 2061 7373 6573 735f 6469  () and assess_di
+00027c10: 6164 325f 736b 6577 6e65 7373 2829 0a0a  ad2_skewness()..
+00027c20: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00027c30: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a      -----------.
+00027c40: 2020 2020 4469 6164 5f46 696c 6573 3a20      Diad_Files: 
+00027c50: 6c69 7374 0a20 2020 2020 2020 204c 6973  list.        Lis
+00027c60: 7420 6f66 2066 696c 656e 616d 6573 2074  t of filenames t
+00027c70: 6f20 6c6f 6f70 2074 6872 6f75 6768 0a0a  o loop through..
+00027c80: 2020 2020 7061 7468 3a20 7374 720a 2020      path: str.  
+00027c90: 2020 2020 2020 466f 6c64 6572 2075 7365        Folder use
+00027ca0: 7220 7769 7368 6573 2074 6f20 7265 6164  r wishes to read
+00027cb0: 2064 6174 6120 6672 6f6d 0a0a 2020 2020   data from..    
+00027cc0: 6669 6c65 7479 7065 3a20 7374 720a 2020  filetype: str.  
+00027cd0: 2020 2020 2020 4964 656e 7469 6669 6573        Identifies
+00027ce0: 2074 7970 6520 6f66 2066 696c 650a 2020   type of file.  
+00027cf0: 2020 2020 2020 6368 6f6f 7365 2066 726f        choose fro
+00027d00: 6d20 2757 6974 6563 5f41 5343 4949 272c  m 'Witec_ASCII',
+00027d10: 2027 6865 6164 6c65 7373 5f74 7874 272c   'headless_txt',
+00027d20: 2027 6865 6164 6c65 7373 5f63 7376 272c   'headless_csv',
+00027d30: 2027 6865 6164 5f63 7376 272c 2027 5769   'head_csv', 'Wi
+00027d40: 7465 635f 4153 4349 4927 2c0a 2020 2020  tec_ASCII',.    
+00027d50: 2020 2020 2748 4f52 4942 415f 7478 7427      'HORIBA_txt'
+00027d60: 2c20 2752 656e 6973 6861 775f 7478 7427  , 'Renishaw_txt'
+00027d70: 0a0a 2020 2020 736b 6577 6e65 7373 3a20  ..    skewness: 
+00027d80: 2761 6273 2720 6f72 2027 6469 7227 0a20  'abs' or 'dir'. 
+00027d90: 2020 2020 2020 2049 6620 2761 6273 272c         If 'abs',
+00027da0: 2067 6976 6573 2061 6273 6f6c 7574 6520   gives absolute 
+00027db0: 736b 6577 6e65 7373 2028 652e 672e 2c20  skewness (e.g., 
+00027dc0: 6c61 7267 6573 7420 706f 7373 6962 6c65  largest possible
+00027dd0: 206e 756d 6265 7220 7265 6761 7264 6c65   number regardle
+00027de0: 7373 206f 6620 6469 7265 6374 696f 6e29  ss of direction)
+00027df0: 0a20 2020 2020 2020 2069 6620 2764 6972  .        if 'dir
+00027e00: 2720 646f 6573 2073 6b65 776e 6573 7320  ' does skewness 
+00027e10: 6173 206f 6e65 2073 6964 6520 6f76 6572  as one side over
+00027e20: 2074 6865 206f 7468 6572 0a0a 0a0a 2020   the other....  
+00027e30: 2020 736f 7274 3a20 626f 6f6c 0a20 2020    sort: bool.   
+00027e40: 2020 2020 2049 6620 7472 7565 2c20 736f       If true, so
+00027e50: 7274 7320 6669 6c65 7320 616c 7068 6162  rts files alphab
+00027e60: 6574 6963 616c 6c79 0a20 2020 2066 696c  etically.    fil
+00027e70: 655f 6578 743a 2073 7472 0a20 2020 2020  e_ext: str.     
+00027e80: 2020 2046 696c 6520 666f 726d 6174 2e20     File format. 
+00027e90: 4465 6661 756c 7420 7478 742c 2063 6f75  Default txt, cou
+00027ea0: 6c64 2061 6c73 6f20 656e 7465 7220 6373  ld also enter cs
+00027eb0: 7620 6574 632e 0a20 2020 2065 7863 6c75  v etc..    exclu
+00027ec0: 6465 5f73 7472 3a20 7374 720a 2020 2020  de_str: str.    
+00027ed0: 2020 2020 4578 636c 7564 6573 2066 696c      Excludes fil
+00027ee0: 6573 2077 6974 6820 7468 6973 2073 7472  es with this str
+00027ef0: 696e 6720 696e 2074 6865 6972 206e 616d  ing in their nam
+00027f00: 652e 2045 2e67 2e20 6966 2065 7863 6c75  e. E.g. if exclu
+00027f10: 6465 5f73 7472 3d27 4e65 2720 6974 2077  de_str='Ne' it w
+00027f20: 696c 6c20 6578 636c 7564 6520 4e65 206c  ill exclude Ne l
+00027f30: 696e 6573 0a20 2020 2065 7863 6c75 6465  ines.    exclude
+00027f40: 5f74 7970 653a 2073 7472 0a20 2020 2020  _type: str.     
+00027f50: 2020 2045 7863 6c75 6465 7320 6669 6c65     Excludes file
+00027f60: 7320 6f66 2074 6869 7320 7479 7065 2c20  s of this type, 
+00027f70: 652e 672e 2065 7863 6c75 6465 5f74 7970  e.g. exclude_typ
+00027f80: 653d 2770 6e67 2720 6765 7473 2072 6964  e='png' gets rid
+00027f90: 206f 6620 696d 6167 6520 6669 6c65 732e   of image files.
+00027fa0: 0a0a 0a20 2020 206c 6f77 6572 5f62 6173  ...    lower_bas
+00027fb0: 656c 696e 655f 6469 6164 312c 206c 6f77  eline_diad1, low
+00027fc0: 6572 5f62 6173 656c 696e 655f 6469 6164  er_baseline_diad
+00027fd0: 323a 206c 6973 740a 2020 2020 2020 2020  2: list.        
+00027fe0: 5265 6769 6f6e 206f 6620 7370 6563 7472  Region of spectr
+00027ff0: 6120 746f 2075 7365 2061 2062 6173 656c  a to use a basel
+00028000: 696e 6520 284c 4853 2920 666f 7220 6469  ine (LHS) for di
+00028010: 6164 2031 2061 6e64 2064 6961 6432 0a0a  ad 1 and diad2..
+00028020: 2020 2020 7570 7065 725f 6261 7365 6c69      upper_baseli
+00028030: 6e65 5f64 6961 6431 2c20 7570 7065 725f  ne_diad1, upper_
+00028040: 6261 7365 6c69 6e65 5f64 6961 6432 3a20  baseline_diad2: 
+00028050: 6c69 7374 0a20 2020 2020 2020 2052 6567  list.        Reg
+00028060: 696f 6e20 6f66 2073 7065 6374 7261 2074  ion of spectra t
+00028070: 6f20 7573 6520 6120 6261 7365 6c69 6e65  o use a baseline
+00028080: 2028 5248 5329 2066 6f72 2064 6961 6420   (RHS) for diad 
+00028090: 3120 616e 6420 6469 6164 2032 0a0a 2020  1 and diad 2..  
+000280a0: 2020 4e5f 706f 6c79 5f62 636b 5f64 6961    N_poly_bck_dia
+000280b0: 6431 2c20 4e5f 706f 6c79 5f62 636b 5f64  d1, N_poly_bck_d
+000280c0: 6961 6432 3a20 696e 740a 2020 2020 2020  iad2: int.      
+000280d0: 2020 4465 6772 6565 206f 6620 706f 6c79    Degree of poly
+000280e0: 6e6f 6d69 616c 2066 6f72 2062 6163 6b67  nomial for backg
+000280f0: 726f 756e 6420 6669 7474 696e 670a 0a20  round fitting.. 
+00028100: 2020 2073 6b65 776e 6573 733a 2027 6162     skewness: 'ab
+00028110: 7327 206f 7220 2764 6972 270a 2020 2020  s' or 'dir'.    
+00028120: 2020 2020 4966 2027 6162 7327 2c20 6769      If 'abs', gi
+00028130: 7665 7320 6162 736f 6c75 7465 2073 6b65  ves absolute ske
+00028140: 776e 6573 7320 2865 2e67 2e2c 206c 6172  wness (e.g., lar
+00028150: 6765 7374 2070 6f73 7369 626c 6520 6e75  gest possible nu
+00028160: 6d62 6572 2072 6567 6172 646c 6573 7320  mber regardless 
+00028170: 6f66 2064 6972 6563 7469 6f6e 290a 2020  of direction).  
+00028180: 2020 2020 2020 6966 2027 6469 7227 2064        if 'dir' d
+00028190: 6f65 7320 736b 6577 6e65 7373 2061 7320  oes skewness as 
+000281a0: 6f6e 6520 7369 6465 206f 7665 7220 7468  one side over th
+000281b0: 6520 6f74 6865 720a 0a20 2020 2069 6e74  e other..    int
+000281c0: 5f63 7574 5f6f 6666 3a20 666c 6f61 740a  _cut_off: float.
+000281d0: 2020 2020 2020 2020 5661 6c75 6520 6f66          Value of
+000281e0: 2069 6e74 656e 7369 7479 2061 7420 7768   intensity at wh
+000281f0: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
+00028200: 2074 6865 2073 6b65 776e 6573 7320 2865   the skewness (e
+00028210: 2e67 2e20 302e 3135 5820 7468 6520 7065  .g. 0.15X the pe
+00028220: 616b 2068 6569 6768 7429 2e0a 0a0a 2020  ak height)....  
+00028230: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00028240: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7064  ---------.    pd
+00028250: 2e44 6174 6146 7261 6d65 2077 7469 6820  .DataFrame wtih 
+00028260: 6669 6c65 6e61 6d65 2c20 736b 6577 6e65  filename, skewne
+00028270: 7373 206f 6620 4469 6164 2031 2c0a 2020  ss of Diad 1,.  
+00028280: 2020 7468 6520 7820 706f 7369 7469 6f6e    the x position
+00028290: 206f 6620 7468 6520 4c48 2061 6e64 2052   of the LH and R
+000282a0: 4820 7469 6520 706f 696e 7420 6174 2069  H tie point at i
+000282b0: 6e74 656e 7369 7479 3d69 6e74 5f69 6e74  ntensity=int_int
+000282c0: 5f63 7574 5f6f 6666 0a0a 0a0a 2020 2020  _cut_off....    
+000282d0: 2222 220a 0a0a 0a20 2020 2064 665f 6469  """....    df_di
+000282e0: 6164 3120 3d20 7064 2e44 6174 6146 7261  ad1 = pd.DataFra
+000282f0: 6d65 285b 5d29 0a20 2020 2064 665f 6469  me([]).    df_di
+00028300: 6164 3220 3d20 7064 2e44 6174 6146 7261  ad2 = pd.DataFra
+00028310: 6d65 285b 5d29 0a20 2020 2064 665f 6d65  me([]).    df_me
+00028320: 7267 6564 3d70 642e 4461 7461 4672 616d  rged=pd.DataFram
+00028330: 6528 5b5d 290a 2020 2020 666f 7220 6920  e([]).    for i 
+00028340: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+00028350: 4469 6164 5f66 696c 6573 2929 3a0a 0a20  Diad_files)):.. 
+00028360: 2020 2020 2020 2066 696c 656e 616d 653d         filename=
+00028370: 4469 6164 5f66 696c 6573 5b69 5d0a 2020  Diad_files[i].  
+00028380: 2020 2020 2020 7072 696e 7428 2777 6f72        print('wor
+00028390: 6b69 6e67 206f 6e20 6669 6c65 2023 272b  king on file #'+
+000283a0: 7374 7228 6929 290a 0a20 2020 2020 2020  str(i))..       
+000283b0: 2064 6174 615f 6469 6164 313d 6173 7365   data_diad1=asse
+000283c0: 7373 5f64 6961 6431 5f73 6b65 776e 6573  ss_diad1_skewnes
+000283d0: 7328 636f 6e66 6967 313d 636f 6e66 6967  s(config1=config
+000283e0: 5f64 6961 6431 2c0a 2020 2020 2020 2020  _diad1,.        
+000283f0: 696e 745f 6375 745f 6f66 663d 696e 745f  int_cut_off=int_
+00028400: 6375 745f 6f66 662c 2070 726f 6d69 6e65  cut_off, promine
+00028410: 6e63 653d 7072 6f6d 696e 656e 6365 2c20  nce=prominence, 
+00028420: 6865 6967 6874 3d68 6569 6768 742c 2077  height=height, w
+00028430: 6964 7468 3d77 6964 7468 2c0a 2020 2020  idth=width,.    
+00028440: 2020 2020 736b 6577 6e65 7373 3d73 6b65      skewness=ske
+00028450: 776e 6573 732c 2070 6174 683d 7061 7468  wness, path=path
+00028460: 2c20 6669 6c65 6e61 6d65 3d66 696c 656e  , filename=filen
+00028470: 616d 652c 0a20 2020 2020 2020 2066 696c  ame,.        fil
+00028480: 6574 7970 653d 6669 6c65 7479 7065 290a  etype=filetype).
+00028490: 0a20 2020 2020 2020 2064 6174 615f 6469  .        data_di
+000284a0: 6164 323d 6173 7365 7373 5f64 6961 6432  ad2=assess_diad2
+000284b0: 5f73 6b65 776e 6573 7328 636f 6e66 6967  _skewness(config
+000284c0: 313d 636f 6e66 6967 5f64 6961 6432 2c0a  1=config_diad2,.
+000284d0: 2020 2020 2020 2020 696e 745f 6375 745f          int_cut_
+000284e0: 6f66 663d 696e 745f 6375 745f 6f66 662c  off=int_cut_off,
+000284f0: 2070 726f 6d69 6e65 6e63 653d 7072 6f6d   prominence=prom
+00028500: 696e 656e 6365 2c20 6865 6967 6874 3d68  inence, height=h
+00028510: 6569 6768 742c 2077 6964 7468 3d77 6964  eight, width=wid
+00028520: 7468 2c0a 2020 2020 2020 2020 736b 6577  th,.        skew
+00028530: 6e65 7373 3d73 6b65 776e 6573 732c 2070  ness=skewness, p
+00028540: 6174 683d 7061 7468 2c20 6669 6c65 6e61  ath=path, filena
+00028550: 6d65 3d66 696c 656e 616d 652c 0a20 2020  me=filename,.   
+00028560: 2020 2020 2066 696c 6574 7970 653d 6669       filetype=fi
+00028570: 6c65 7479 7065 290a 0a0a 2020 2020 2020  letype)...      
+00028580: 2020 6466 5f64 6961 6431 203d 2070 642e    df_diad1 = pd.
+00028590: 636f 6e63 6174 285b 6466 5f64 6961 6431  concat([df_diad1
+000285a0: 2c20 6461 7461 5f64 6961 6431 5d2c 2061  , data_diad1], a
+000285b0: 7869 733d 3029 0a20 2020 2020 2020 2064  xis=0).        d
+000285c0: 665f 6469 6164 3220 3d20 2070 642e 636f  f_diad2 =  pd.co
+000285d0: 6e63 6174 285b 6466 5f64 6961 6432 2c20  ncat([df_diad2, 
+000285e0: 6461 7461 5f64 6961 6432 5d2c 2061 7869  data_diad2], axi
+000285f0: 733d 3029 0a0a 0a0a 2020 2020 6466 5f63  s=0)....    df_c
+00028600: 6f6d 626f 3d70 642e 636f 6e63 6174 285b  ombo=pd.concat([
+00028610: 6466 5f64 6961 6431 2c20 6466 5f64 6961  df_diad1, df_dia
+00028620: 6432 5d2c 2061 7869 733d 3129 0a0a 2020  d2], axis=1)..  
+00028630: 2020 636f 6c73 5f74 6f5f 6d6f 7665 3d5b    cols_to_move=[
+00028640: 2766 696c 656e 616d 6527 2c20 2753 6b65  'filename', 'Ske
+00028650: 776e 6573 735f 6469 6164 3127 2c20 2753  wness_diad1', 'S
+00028660: 6b65 776e 6573 735f 6469 6164 3227 5d0a  kewness_diad2'].
+00028670: 0a20 2020 2064 665f 636f 6d62 6f20 3d20  .    df_combo = 
+00028680: 6466 5f63 6f6d 626f 5b63 6f6c 735f 746f  df_combo[cols_to
+00028690: 5f6d 6f76 6520 2b20 5b0a 2020 2020 2020  _move + [.      
+000286a0: 2020 636f 6c20 666f 7220 636f 6c20 696e    col for col in
+000286b0: 2064 665f 636f 6d62 6f2e 636f 6c75 6d6e   df_combo.column
+000286c0: 7320 6966 2063 6f6c 206e 6f74 2069 6e20  s if col not in 
+000286d0: 636f 6c73 5f74 6f5f 6d6f 7665 5d5d 0a0a  cols_to_move]]..
+000286e0: 0a0a 0a20 2020 2072 6574 7572 6e20 6466  ...    return df
+000286f0: 5f63 6f6d 626f 0a0a 0a0a 0a0a 0a         _combo.......
```

### Comparing `DiadFit-0.0.69/src/DiadFit/error_propagation.py` & `DiadFit-0.0.70/src/DiadFit/error_propagation.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/importing_data_files.py` & `DiadFit-0.0.70/src/DiadFit/importing_data_files.py`

 * *Files identical despite different names*

### Comparing `DiadFit-0.0.69/src/DiadFit/ne_lines.py` & `DiadFit-0.0.70/src/DiadFit/ne_lines.py`

 * *Files 1% similar despite different names*

```diff
@@ -657,16 +657,16 @@
 
 
     """
     if const_params is True:
         min_off=0.8
         max_off=1.2
     if const_params is False:
-        min_off=0
-        max_off=100
+        min_off=0.3
+        max_off=3
 
     # Flatten x and y if needed
     xdat=x.flatten()
     ydat=y_corr.flatten()
     
     df=pd.DataFrame(data={'Xdata': xdat,
     'Ydata': ydat})
@@ -687,15 +687,15 @@
         # Setting up lmfit
         if model_name == 'PseudoVoigtModel':
             model0 = PseudoVoigtModel(prefix='p0_')#+ ConstantModel(prefix='c0')
         if model_name=="VoigtModel":
             model0 = VoigtModel(prefix='p0_')#+ ConstantModel(prefix='c0')
         
         pars0 = model0.make_params()
-        pars0['p0_center'].set(Ne_center)
+        pars0['p0_center'].set(Ne_center, min=Ne_center-2*spec_res, max=Ne_center+2*spec_res)
         pars0['p0_amplitude'].set(amplitude)
        
         
         
         init0 = model0.eval(pars0, x=xdat)
         result0 = model0.fit(ydat, pars0, x=xdat)
         Center_p0=result0.best_values.get('p0_center')
@@ -723,15 +723,15 @@
         #rough_peak_positions=Ne_center-2
         if model_name == 'PseudoVoigtModel':
             model1 = PseudoVoigtModel(prefix='p1_')#+ ConstantModel(prefix='c0')
         if model_name=="VoigtModel":
             model1 = VoigtModel(prefix='p1_')#+ ConstantModel(prefix='c0')
         pars1 = model1.make_params()
         pars1['p1_'+ 'amplitude'].set(Amp_p0, min=min_off*Amp_p0, max=max_off*Amp_p0)
-        pars1['p1_'+ 'center'].set(Center_p0, min=Center_p0-0.2, max=Center_p0+0.2)
+        pars1['p1_'+ 'center'].set(Center_p0, min=Center_p0-spec_res/2, max=Center_p0+spec_res/2)
         pars1['p1_'+ 'sigma'].set(pk1_sigma, min=pk1_sigma*min_off, max=pk1_sigma*max_off)
 
 
         # Second wee peak
         prefix='p2_'
         if model_name == 'PseudoVoigtModel':
             peak = PseudoVoigtModel(prefix='p2_')#+ ConstantModel(prefix='c0')
@@ -877,15 +877,15 @@
     Center_pk1=Center_p1
 
 
     return Center_pk1, Area_pk1, sigma_pk1, gamma_pk1, Ne_pk1_reg_x_plot, Ne_pk1_reg_y_plot, Ne_pk1_reg_x, Ne_pk1_reg_y, xx_pk1, result_pk1, error_pk1, result_pk1_origx, comps, Peak1_Prop_Lor
 
 
 def fit_pk2(x, y_corr, x_span=[-5, 5], Ne_center=1447.5, amplitude=1000, pk2_sigma=0.4,
-model_name='PseudoVoigtModel', print_report=False, const_params=True) :
+model_name='PseudoVoigtModel', print_report=False, const_params=True, spec_res=0.4) :
     """ This function fits the 1447 Ne line as a single Voigt
 
     Parameters
     -----------
 
     x: np.array
         x coordinate (wavenumber)
@@ -1187,15 +1187,15 @@
     # Fit the 1117 peak
     cent_pk1, Area_pk1, sigma_pk1, gamma_pk1, Ne_pk1_reg_x_plot, Ne_pk1_reg_y_plot, Ne_pk1_reg_x, Ne_pk1_reg_y, xx_pk1, result_pk1, error_pk1, result_pk1_origx, comps, Peak1_Prop_Lor = fit_pk1(x_pk1, y_corr_pk1, x_span=x_span_pk1, Ne_center=Ne_center_1,model_name=config.model_name,  LH_offset_mini=config.LH_offset_mini, peaks_pk1=peaks_1, amplitude=Pk1_Amp, pk1_sigma=config.pk1_sigma,
     const_params=const_params, spec_res=spec_res)
 
 
 
     # Fit the 1447 peak
-    cent_pk2,Area_pk2, sigma_pk2, gamma_pk2, Ne_pk2_reg_x_plot, Ne_pk2_reg_y_plot, Ne_pk2_reg_x, Ne_pk2_reg_y, xx_pk2, result_pk2, error_pk2, result_pk2_origx, Peak2_Prop_Lor = fit_pk2( x_pk2, y_corr_pk2, x_span=x_span_pk2,  Ne_center=Ne_center_2, model_name=config.model_name, amplitude=Pk2_Amp, pk2_sigma=config.pk2_sigma, const_params=const_params)
+    cent_pk2,Area_pk2, sigma_pk2, gamma_pk2, Ne_pk2_reg_x_plot, Ne_pk2_reg_y_plot, Ne_pk2_reg_x, Ne_pk2_reg_y, xx_pk2, result_pk2, error_pk2, result_pk2_origx, Peak2_Prop_Lor = fit_pk2( x_pk2, y_corr_pk2, x_span=x_span_pk2,  Ne_center=Ne_center_2, model_name=config.model_name, amplitude=Pk2_Amp, pk2_sigma=config.pk2_sigma, const_params=const_params,spec_res=spec_res)
 
 
     # Calculate difference between peak centers, and Delta Ne
     DeltaNe=cent_pk2-cent_pk1
 
 
     Ne_Corr=DeltaNe_ideal/DeltaNe
@@ -1500,15 +1500,15 @@
     ax4.ticklabel_format(useOffset=False)
     fig.tight_layout()
     return fig
 
 ## Looping Ne lines
 def loop_Ne_lines(*, files, spectra_path, filetype,
         config, config_ID_peaks, df_fit_params=None, prefix=False, print_df=False,
-                  plot_figure=True, single_acq=False):
+                  plot_figure=True, single_acq=False, const_params=True):
 
     df = pd.DataFrame([])
     # This is for repeated acquisition of Ne lines
     if single_acq is True:
 
         for i in tqdm(range(0, np.shape(files)[1]-2)):
             filename=str(i)
@@ -1521,15 +1521,15 @@
 
             data=fit_Ne_lines(Ne=Ne, path=spectra_path,
             config=config, prefix=prefix,
             Ne_center_1=df_fit_params['Peak1_cent'].iloc[0],
             Ne_center_2=df_fit_params['Peak2_cent'].iloc[0],
             Ne_prom_1=df_fit_params['Peak1_prom'].iloc[0],
             Ne_prom_2=df_fit_params['Peak2_prom'].iloc[0],
-            const_params=False,
+            const_params=const_params,
             plot_figure=plot_figure)
             df = pd.concat([df, data], axis=0)
 
     else:
         for i in tqdm(range(0, len(files))):
             filename=files[i]
 
@@ -1540,15 +1540,15 @@
             data=fit_Ne_lines(Ne=Ne, filename=filename,
             path=spectra_path, prefix=prefix,
             config=config,
             Ne_center_1=df_fit_params['Peak1_cent'].iloc[0],
             Ne_center_2=df_fit_params['Peak2_cent'].iloc[0],
             Ne_prom_1=df_fit_params['Peak1_prom'].iloc[0],
             Ne_prom_2=df_fit_params['Peak2_prom'].iloc[0],
-            const_params=False,
+            const_params=const_params,
             plot_figure=plot_figure)
             df = pd.concat([df, data], axis=0)
```

### Comparing `DiadFit-0.0.69/src/DiadFit.egg-info/PKG-INFO` & `DiadFit-0.0.70/src/DiadFit.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: DiadFit
-Version: 0.0.69
+Version: 0.0.70
 Summary: DiadFit
 Home-page: https://github.com/PennyWieser/DiadFit
 Author: Penny Wieser
 Author-email: penny.wieser@gmail.com
 License: UNKNOWN
 Description: [![PyPI](https://badgen.net/pypi/v/DiadFit)](https://pypi.org/project/DiadFit/)
         [![Build Status](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml/badge.svg?branch=main)](https://github.com/PennyWieser/DiadFit/actions/workflows/main.yml)
```

### Comparing `DiadFit-0.0.69/src/DiadFit.egg-info/SOURCES.txt` & `DiadFit-0.0.70/src/DiadFit.egg-info/SOURCES.txt`

 * *Files identical despite different names*


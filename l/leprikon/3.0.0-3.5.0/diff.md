# Comparing `tmp/leprikon-3.0.0.tar.gz` & `tmp/leprikon-3.5.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "leprikon-3.0.0.tar", last modified: Tue Dec 15 19:36:17 2020, max compression
+gzip compressed data, was "leprikon-3.5.0.tar", max compression
```

## Comparing `leprikon-3.0.0.tar` & `leprikon-3.5.0.tar`

### file list

```diff
@@ -1,371 +1,428 @@
--rw-r--r--   0        0        0     1483 2018-10-04 23:23:35.159299 leprikon-3.0.0/LICENSE
--rw-r--r--   0        0        0     6056 2020-12-15 19:04:59.318023 leprikon-3.0.0/leprikon/__init__.py
--rwxr-xr-x   0        0        0      325 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/__main__.py
--rw-r--r--   0        0        0     2249 2020-03-23 08:56:15.171849 leprikon-3.0.0/leprikon/admin/__init__.py
--rw-r--r--   0        0        0      194 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/admin/account.py
--rw-r--r--   0        0        0      287 2020-12-15 19:04:59.322023 leprikon-3.0.0/leprikon/admin/agegroup.py
--rw-r--r--   0        0        0     1174 2020-12-15 19:04:59.322023 leprikon-3.0.0/leprikon/admin/agreements.py
--rw-r--r--   0        0        0     3696 2020-12-15 19:04:59.322023 leprikon-3.0.0/leprikon/admin/bulkupdate.py
--rw-r--r--   0        0        0      261 2020-02-27 00:53:29.280624 leprikon-3.0.0/leprikon/admin/citizenship.py
--rw-r--r--   0        0        0    12889 2020-12-15 19:04:59.326023 leprikon-3.0.0/leprikon/admin/courses.py
--rw-r--r--   0        0        0      184 2019-09-16 07:23:11.199711 leprikon-3.0.0/leprikon/admin/department.py
--rw-r--r--   0        0        0     9231 2020-12-15 19:04:59.326023 leprikon-3.0.0/leprikon/admin/events.py
--rw-r--r--   0        0        0     4543 2019-09-23 18:40:32.469685 leprikon-3.0.0/leprikon/admin/export.py
--rw-r--r--   0        0        0     8101 2020-10-12 09:56:52.858057 leprikon-3.0.0/leprikon/admin/filters.py
--rw-r--r--   0        0        0     4303 2020-12-15 19:04:59.326023 leprikon-3.0.0/leprikon/admin/journals.py
--rw-r--r--   0        0        0      596 2019-09-16 07:23:11.195711 leprikon-3.0.0/leprikon/admin/leprikonsite.py
--rw-r--r--   0        0        0     8087 2020-12-15 19:04:59.326023 leprikon-3.0.0/leprikon/admin/messages.py
--rw-r--r--   0        0        0     9427 2020-12-15 19:04:59.330023 leprikon-3.0.0/leprikon/admin/orderables.py
--rw-r--r--   0        0        0      259 2020-01-12 06:54:55.400573 leprikon-3.0.0/leprikon/admin/organizations.py
--rw-r--r--   0        0        0     2176 2020-02-16 23:37:13.698129 leprikon-3.0.0/leprikon/admin/pdf.py
--rw-r--r--   0        0        0      165 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/admin/place.py
--rw-r--r--   0        0        0      190 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/admin/printsetup.py
--rw-r--r--   0        0        0      265 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/admin/question.py
--rw-r--r--   0        0        0     4945 2020-03-23 08:56:15.171849 leprikon-3.0.0/leprikon/admin/registrationlink.py
--rw-r--r--   0        0        0     5784 2020-12-15 19:04:59.330023 leprikon-3.0.0/leprikon/admin/roles.py
--rw-r--r--   0        0        0      171 2019-09-16 07:23:11.195711 leprikon-3.0.0/leprikon/admin/school.py
--rw-r--r--   0        0        0     3275 2020-12-15 19:04:59.330023 leprikon-3.0.0/leprikon/admin/schoolyear.py
--rw-r--r--   0        0        0    37592 2020-12-15 19:04:59.334023 leprikon-3.0.0/leprikon/admin/subjects.py
--rw-r--r--   0        0        0      255 2019-09-16 07:23:11.195711 leprikon-3.0.0/leprikon/admin/targetgroup.py
--rw-r--r--   0        0        0     4571 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/admin/timesheets.py
--rw-r--r--   0        0        0     7260 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/admin/user.py
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/api/__init__.py
--rw-r--r--   0        0        0      272 2020-03-17 06:19:27.902907 leprikon-3.0.0/leprikon/api/urls.py
--rw-r--r--   0        0        0     1238 2020-03-17 06:19:27.902907 leprikon-3.0.0/leprikon/api/views.py
--rw-r--r--   0        0        0     1231 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/apps.py
--rw-r--r--   0        0        0     1091 2020-01-12 06:54:55.404573 leprikon-3.0.0/leprikon/bankreaders.py
--rw-r--r--   0        0        0     1019 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/cms_apps.py
--rw-r--r--   0        0        0     7781 2020-01-30 01:10:32.823848 leprikon-3.0.0/leprikon/cms_menus.py
--rw-r--r--   0        0        0      150 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/cms_plugins/__init__.py
--rw-r--r--   0        0        0      465 2019-09-16 07:23:11.195711 leprikon-3.0.0/leprikon/cms_plugins/base.py
--rw-r--r--   0        0        0     1107 2020-03-22 09:26:17.046411 leprikon-3.0.0/leprikon/cms_plugins/courses.py
--rw-r--r--   0        0        0     1090 2020-03-22 09:26:17.046411 leprikon-3.0.0/leprikon/cms_plugins/events.py
--rw-r--r--   0        0        0     1028 2020-03-22 09:26:17.046411 leprikon-3.0.0/leprikon/cms_plugins/leaders.py
--rw-r--r--   0        0        0     1164 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/cms_plugins/orderables.py
--rw-r--r--   0        0        0      467 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/cms_plugins/schoolyears.py
--rw-r--r--   0        0        0      685 2020-01-27 10:37:44.714325 leprikon-3.0.0/leprikon/cms_toolbars.py
--rw-r--r--   0        0        0      486 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/conf/__init__.py
--rw-r--r--   0        0        0     3592 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/conf/default_settings.py
--rw-r--r--   0        0        0     2234 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/cronjobs.py
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/forms/__init__.py
--rw-r--r--   0        0        0      342 2020-01-30 01:10:32.823848 leprikon-3.0.0/leprikon/forms/billing_info.py
--rw-r--r--   0        0        0      336 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/forms/confirm.py
--rw-r--r--   0        0        0     2415 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/forms/courses.py
--rw-r--r--   0        0        0     1040 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/forms/fields.py
--rw-r--r--   0        0        0      625 2020-12-15 19:04:59.342023 leprikon-3.0.0/leprikon/forms/form.py
--rw-r--r--   0        0        0    13850 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/journals.py
--rw-r--r--   0        0        0      803 2019-09-16 07:23:11.203711 leprikon-3.0.0/leprikon/forms/leaders.py
--rw-r--r--   0        0        0     2294 2020-02-05 08:26:09.991520 leprikon-3.0.0/leprikon/forms/messages.py
--rw-r--r--   0        0        0      327 2020-01-30 00:34:59.468857 leprikon-3.0.0/leprikon/forms/parent.py
--rw-r--r--   0        0        0      597 2020-02-27 00:53:29.280624 leprikon-3.0.0/leprikon/forms/participant.py
--rw-r--r--   0        0        0      487 2020-02-09 09:09:10.675411 leprikon-3.0.0/leprikon/forms/registrationlink.py
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/forms/reports/__init__.py
--rw-r--r--   0        0        0      959 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/reports/courses.py
--rw-r--r--   0        0        0      210 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/reports/debtors.py
--rw-r--r--   0        0        0      949 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/reports/events.py
--rw-r--r--   0        0        0      989 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/reports/orderables.py
--rw-r--r--   0        0        0      582 2020-10-23 12:31:51.153628 leprikon-3.0.0/leprikon/forms/reports/subjects.py
--rw-r--r--   0        0        0      748 2020-02-11 08:51:22.141437 leprikon-3.0.0/leprikon/forms/schoolyear.py
--rw-r--r--   0        0        0    36971 2020-12-15 19:04:59.346023 leprikon-3.0.0/leprikon/forms/subjects.py
--rw-r--r--   0        0        0     3451 2019-09-16 07:24:35.976662 leprikon-3.0.0/leprikon/forms/timesheets.py
--rw-r--r--   0        0        0     4285 2020-01-16 21:00:22.809743 leprikon-3.0.0/leprikon/forms/user.py
--rw-r--r--   0        0        0      423 2019-09-17 07:31:14.369976 leprikon-3.0.0/leprikon/forms/widgets.py
--rw-r--r--   0        0        0      210 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/gettext_overrides.py
--rw-r--r--   0        0        0    67354 2020-12-15 19:04:59.350023 leprikon-3.0.0/leprikon/locale/cs/LC_MESSAGES/django.mo
--rw-r--r--   0        0        0   122459 2020-12-15 19:04:59.350023 leprikon-3.0.0/leprikon/locale/cs/LC_MESSAGES/django.po
--rw-r--r--   0        0        0      388 2020-12-14 14:23:08.459105 leprikon-3.0.0/leprikon/locale/en/LC_MESSAGES/django.mo
--rw-r--r--   0        0        0    74016 2020-10-18 07:45:53.851333 leprikon-3.0.0/leprikon/locale/en/LC_MESSAGES/django.po
--rw-r--r--   0        0        0        0 2020-03-17 06:19:27.902907 leprikon-3.0.0/leprikon/management/__init__.py
--rw-r--r--   0        0        0        0 2020-03-17 06:19:27.906907 leprikon-3.0.0/leprikon/management/commands/__init__.py
--rw-r--r--   0        0        0     1380 2020-03-17 06:19:27.906907 leprikon-3.0.0/leprikon/management/commands/rocketchatsync.py
--rw-r--r--   0        0        0     4594 2020-12-15 19:04:59.350023 leprikon-3.0.0/leprikon/middleware.py
--rw-r--r--   0        0        0    59599 2020-10-12 09:54:44.264974 leprikon-3.0.0/leprikon/migrations/0001_initial.py
--rw-r--r--   0        0        0     1851 2019-09-16 07:23:11.191711 leprikon-3.0.0/leprikon/migrations/0002_initial_data.py
--rw-r--r--   0        0        0     1954 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0003_managers.py
--rw-r--r--   0        0        0      345 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0004_multiple_registrations.py
--rw-r--r--   0        0        0      879 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0005_subjectregistration_variable_symbol.py
--rw-r--r--   0        0        0     1049 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0006_discount_periods.py
--rw-r--r--   0        0        0      864 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0007_bill_print_setup.py
--rw-r--r--   0        0        0      449 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0008_leprikonsite_company_name.py
--rw-r--r--   0        0        0      656 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0009_subjectpayment_received_by.py
--rw-r--r--   0        0        0      449 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0010_subject_code.py
--rw-r--r--   0        0        0      457 2020-10-10 19:49:01.236889 leprikon-3.0.0/leprikon/migrations/0011_subjectregistration_payment_requested.py
--rw-r--r--   0        0        0     1676 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0012_subject_variants.py
--rw-r--r--   0        0        0      549 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0013_drop_insurance.py
--rw-r--r--   0        0        0      472 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0014_variable_symbol.py
--rw-r--r--   0        0        0     4137 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0015_school_year_divisions.py
--rw-r--r--   0        0        0     1191 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0016_school_year_divisions_cleanup.py
--rw-r--r--   0        0        0     3846 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0017_citizenship.py
--rw-r--r--   0        0        0      475 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0018_citizenship_cleanup.py
--rw-r--r--   0        0        0     3040 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0019_department.py
--rw-r--r--   0        0        0     1377 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0020_agreements.py
--rw-r--r--   0        0        0     1532 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0021_user_agreement.py
--rw-r--r--   0        0        0      671 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0022_bankreader.py
--rw-r--r--   0        0        0     2506 2020-02-06 13:17:08.451860 leprikon-3.0.0/leprikon/migrations/0023_accountclosure.py
--rw-r--r--   0        0        0      504 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0024_subjectregistration_note.py
--rw-r--r--   0        0        0     5224 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0025_agreements.py
--rw-r--r--   0        0        0      942 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0026_online_payments.py
--rw-r--r--   0        0        0     2243 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0027_journals.py
--rw-r--r--   0        0        0      517 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0028_agegroups.py
--rw-r--r--   0        0        0      646 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0029_payment_restrictions.py
--rw-r--r--   0        0        0      716 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0030_agreements.py
--rw-r--r--   0        0        0     2208 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0031_registration_questions_agreements.py
--rw-r--r--   0        0        0    15532 2020-01-12 06:54:55.416573 leprikon-3.0.0/leprikon/migrations/0032_registration_participants_groups.py
--rw-r--r--   0        0        0     4196 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/0033_target_groups.py
--rw-r--r--   0        0        0     9591 2019-09-21 08:42:57.460442 leprikon-3.0.0/leprikon/migrations/0034_subject_registration_group.py
--rw-r--r--   0        0        0     1807 2020-01-12 06:54:55.416573 leprikon-3.0.0/leprikon/migrations/0035_on_delete.py
--rw-r--r--   0        0        0     1220 2020-01-12 06:54:55.416573 leprikon-3.0.0/leprikon/migrations/0036_participants_instructed.py
--rw-r--r--   0        0        0      703 2020-01-12 06:54:55.416573 leprikon-3.0.0/leprikon/migrations/0037_message_sender.py
--rw-r--r--   0        0        0     6559 2020-01-12 06:54:55.420573 leprikon-3.0.0/leprikon/migrations/0038_organizations.py
--rw-r--r--   0        0        0     4941 2020-10-12 09:54:44.384975 leprikon-3.0.0/leprikon/migrations/0039_editable_texts.py
--rw-r--r--   0        0        0     1827 2020-01-13 11:07:47.969871 leprikon-3.0.0/leprikon/migrations/0040_due_dates.py
--rw-r--r--   0        0        0     2946 2020-01-30 01:10:32.823848 leprikon-3.0.0/leprikon/migrations/0041_billing_info.py
--rw-r--r--   0        0        0     1207 2020-02-05 16:52:56.161027 leprikon-3.0.0/leprikon/migrations/0042_chat_group_types.py
--rw-r--r--   0        0        0     1960 2020-02-09 11:09:21.821789 leprikon-3.0.0/leprikon/migrations/0043_registration_links.py
--rw-r--r--   0        0        0     2153 2020-02-09 18:55:10.555863 leprikon-3.0.0/leprikon/migrations/0044_billinginfo_contacts.py
--rw-r--r--   0        0        0      527 2020-02-13 18:01:22.566789 leprikon-3.0.0/leprikon/migrations/0045_registration_slug.py
--rw-r--r--   0        0        0     3632 2020-10-12 09:56:52.866057 leprikon-3.0.0/leprikon/migrations/0046_attachment_events.py
--rw-r--r--   0        0        0     6061 2020-02-16 23:37:13.702129 leprikon-3.0.0/leprikon/migrations/0047_pr_print_setup.py
--rw-r--r--   0        0        0     2700 2020-02-27 00:53:29.288623 leprikon-3.0.0/leprikon/migrations/0048_birth_date.py
--rw-r--r--   0        0        0      999 2020-03-22 14:28:14.994416 leprikon-3.0.0/leprikon/migrations/0049_target_groups_fix.py
--rw-r--r--   0        0        0     8193 2020-12-15 19:04:59.350023 leprikon-3.0.0/leprikon/migrations/0050_orderables.py
--rw-r--r--   0        0        0      546 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0051_registration_group_name.py
--rw-r--r--   0        0        0      762 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0052_payment_notification_sent.py
--rw-r--r--   0        0        0     2528 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0053_registration_dates_by.py
--rw-r--r--   0        0        0      460 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0054_registration_dates_by_cleanup.py
--rw-r--r--   0        0        0     1020 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0055_schoolyearblockplugin.py
--rw-r--r--   0        0        0     4108 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0056_registration_period.py
--rw-r--r--   0        0        0      739 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0057_registration_period.py
--rw-r--r--   0        0        0     1229 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/migrations/0058_agegroup_min_max_age.py
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.460897 leprikon-3.0.0/leprikon/migrations/__init__.py
--rw-r--r--   0        0        0      325 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/models/__init__.py
--rw-r--r--   0        0        0      643 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/account.py
--rw-r--r--   0        0        0      794 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/models/agegroup.py
--rw-r--r--   0        0        0     1574 2019-10-03 04:00:57.199603 leprikon-3.0.0/leprikon/models/agreements.py
--rw-r--r--   0        0        0      541 2020-02-27 00:53:29.288623 leprikon-3.0.0/leprikon/models/citizenship.py
--rw-r--r--   0        0        0    19930 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/models/courses.py
--rw-r--r--   0        0        0      617 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/department.py
--rw-r--r--   0        0        0    11531 2020-12-15 19:04:59.354023 leprikon-3.0.0/leprikon/models/events.py
--rw-r--r--   0        0        0     4030 2020-02-27 12:38:29.086728 leprikon-3.0.0/leprikon/models/fields.py
--rw-r--r--   0        0        0     5633 2020-01-12 06:54:55.424573 leprikon-3.0.0/leprikon/models/journals.py
--rw-r--r--   0        0        0     3042 2020-02-16 23:37:13.702129 leprikon-3.0.0/leprikon/models/leprikonsite.py
--rw-r--r--   0        0        0     4390 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/models/messages.py
--rw-r--r--   0        0        0    11764 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/models/orderables.py
--rw-r--r--   0        0        0     1610 2020-02-16 23:37:13.702129 leprikon-3.0.0/leprikon/models/organizations.py
--rw-r--r--   0        0        0      592 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/place.py
--rw-r--r--   0        0        0     2339 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/printsetup.py
--rw-r--r--   0        0        0     2030 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/question.py
--rw-r--r--   0        0        0     1745 2020-02-09 11:09:21.821789 leprikon-3.0.0/leprikon/models/registrationlink.py
--rw-r--r--   0        0        0    12076 2020-02-27 12:38:29.090728 leprikon-3.0.0/leprikon/models/roles.py
--rw-r--r--   0        0        0      895 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/school.py
--rw-r--r--   0        0        0     4727 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/models/schoolyear.py
--rw-r--r--   0        0        0      636 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/models/startend.py
--rw-r--r--   0        0        0    68650 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/models/subjects.py
--rw-r--r--   0        0        0      627 2019-09-16 09:21:46.837776 leprikon-3.0.0/leprikon/models/targetgroup.py
--rw-r--r--   0        0        0     5594 2020-01-27 10:37:44.718325 leprikon-3.0.0/leprikon/models/timesheets.py
--rw-r--r--   0        0        0      425 2019-09-16 08:30:20.353824 leprikon-3.0.0/leprikon/models/useragreement.py
--rw-r--r--   0        0        0     6578 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/models/utils.py
--rw-r--r--   0        0        0    18768 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/rocketchat.py
--rw-r--r--   0        0        0      127 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/search_indexes/__init__.py
--rw-r--r--   0        0        0      682 2020-12-15 19:04:59.358023 leprikon-3.0.0/leprikon/search_indexes/base.py
--rw-r--r--   0        0        0      144 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/search_indexes/courses.py
--rw-r--r--   0        0        0      140 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/search_indexes/events.py
--rw-r--r--   0        0        0      142 2020-03-26 17:57:54.663118 leprikon-3.0.0/leprikon/search_indexes/leaders.py
--rw-r--r--   0        0        0      156 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/search_indexes/orderables.py
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/site/__init__.py
--rw-r--r--   0        0        0    15154 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/site/settings.py
--rw-r--r--   0        0        0     1594 2020-01-12 06:54:55.432573 leprikon-3.0.0/leprikon/site/urls.py
--rw-r--r--   0        0        0      458 2020-01-12 06:54:55.432573 leprikon-3.0.0/leprikon/site/wsgi.py
--rw-r--r--   0        0        0      176 2020-02-09 09:03:20.339222 leprikon-3.0.0/leprikon/static/admin/css/scrollbars.css
--rw-r--r--   0        0        0     6601 2019-09-15 21:19:39.984991 leprikon-3.0.0/leprikon/static/admin/js/admin/RelatedObjectLookups.js
--rw-r--r--   0        0        0    10366 2019-09-15 21:19:39.984991 leprikon-3.0.0/leprikon/static/favicon.ico
--rw-r--r--   0        0        0      984 2020-03-17 06:19:27.906907 leprikon-3.0.0/leprikon/static/leprikon/css/chat.css
--rw-r--r--   0        0        0     3153 2020-03-17 06:19:27.910907 leprikon-3.0.0/leprikon/static/leprikon/css/colors.css
--rw-r--r--   0        0        0     4472 2020-03-17 06:19:27.910907 leprikon-3.0.0/leprikon/static/leprikon/css/layout.css
--rw-r--r--   0        0        0     1138 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/static/leprikon/css/registrations.changelist.css
--rw-r--r--   0        0        0   705684 2019-09-15 21:19:39.992991 leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-Bold.ttf
--rw-r--r--   0        0        0   643292 2019-09-15 21:19:39.996991 leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-BoldOblique.ttf
--rw-r--r--   0        0        0   635416 2019-09-15 21:19:40.004991 leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-Oblique.ttf
--rw-r--r--   0        0        0   757076 2019-09-15 21:19:40.008991 leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans.ttf
--rw-r--r--   0        0        0    83151 2019-09-15 21:19:40.020991 leprikon-3.0.0/leprikon/static/leprikon/img/leprikon-kuk-l.png
--rw-r--r--   0        0        0    51531 2019-09-15 21:19:40.020991 leprikon-3.0.0/leprikon/static/leprikon/img/logo-horizontal.png
--rw-r--r--   0        0        0   200727 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/static/leprikon/img/logo.png
--rw-r--r--   0        0        0      522 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/static/leprikon/js/Popup.js
--rw-r--r--   0        0        0      727 2020-02-09 09:24:22.683273 leprikon-3.0.0/leprikon/templates/admin/base.html
--rw-r--r--   0        0        0     1175 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/admin/change_list.html
--rw-r--r--   0        0        0     1570 2020-02-09 18:55:10.555863 leprikon-3.0.0/leprikon/templates/admin/change_list_results.html
--rw-r--r--   0        0        0     1606 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/inc/branding.html
--rw-r--r--   0        0        0       96 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/inc/extrahead.html
--rw-r--r--   0        0        0      134 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/admin/leprikon/app_index.html
--rw-r--r--   0        0        0      207 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/coursediscount/popup_response.html
--rw-r--r--   0        0        0      207 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/eventdiscount/popup_response.html
--rw-r--r--   0        0        0      563 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/message/add_recipients.html
--rw-r--r--   0        0        0      460 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/messagerecipient/change_list.html
--rw-r--r--   0        0        0     2425 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/messagerecipient/send_mails.html
--rw-r--r--   0        0        0      207 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/admin/leprikon/orderablediscount/popup_response.html
--rw-r--r--   0        0        0      778 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/subjectpayment/change_form.html
--rw-r--r--   0        0        0      207 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/admin/leprikon/subjectpayment/popup_response.html
--rw-r--r--   0        0        0        0 2020-02-08 16:23:57.214839 leprikon-3.0.0/leprikon/templates/auth/widgets/read_only_password_hash.html
--rw-r--r--   0        0        0      262 2019-09-15 21:19:40.024991 leprikon-3.0.0/leprikon/templates/cms/toolbar/items/logo.html
--rw-r--r--   0        0        0     1180 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/admin/action_form.html
--rw-r--r--   0        0        0     1236 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/admin/bulk_update_form.html
--rw-r--r--   0        0        0     2414 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/admin/dashboard.html
--rw-r--r--   0        0        0     1235 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/admin/merge.html
--rw-r--r--   0        0        0     1077 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/admin/send_message.html
--rw-r--r--   0        0        0     1296 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/alternating.html
--rw-r--r--   0        0        0     3595 2020-10-12 14:37:24.126573 leprikon-3.0.0/leprikon/templates/leprikon/base.html
--rw-r--r--   0        0        0     1089 2020-01-30 01:28:40.658848 leprikon-3.0.0/leprikon/templates/leprikon/billing_info_preview.html
--rw-r--r--   0        0        0       73 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/course/default.html
--rw-r--r--   0        0        0      142 2020-02-13 17:11:16.256252 leprikon-3.0.0/leprikon/templates/leprikon/cms/course_list/default.html
--rw-r--r--   0        0        0      326 2020-02-13 17:11:16.256252 leprikon-3.0.0/leprikon/templates/leprikon/cms/course_list/grouped.html
--rw-r--r--   0        0        0     1373 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/course_list_filtered.html
--rw-r--r--   0        0        0       70 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/event/default.html
--rw-r--r--   0        0        0      139 2020-02-13 17:11:16.256252 leprikon-3.0.0/leprikon/templates/leprikon/cms/event_list/default.html
--rw-r--r--   0        0        0      324 2020-02-13 17:11:16.256252 leprikon-3.0.0/leprikon/templates/leprikon/cms/event_list/grouped.html
--rw-r--r--   0        0        0     1006 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/event_list_filtered.html
--rw-r--r--   0        0        0       73 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/leader/default.html
--rw-r--r--   0        0        0     1695 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/leader_list/default.html
--rw-r--r--   0        0        0     1091 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms/leader_list_filtered.html
--rw-r--r--   0        0        0       82 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/cms/orderable/default.html
--rw-r--r--   0        0        0      151 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/cms/orderable_list/default.html
--rw-r--r--   0        0        0      332 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/cms/orderable_list/grouped.html
--rw-r--r--   0        0        0     1018 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/cms/orderable_list_filtered.html
--rw-r--r--   0        0        0      206 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/cms/school_year_block.html
--rw-r--r--   0        0        0      199 2019-09-15 21:19:40.028991 leprikon-3.0.0/leprikon/templates/leprikon/cms.html
--rw-r--r--   0        0        0      769 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/confirm_form.html
--rw-r--r--   0        0        0      224 2019-09-15 21:19:40.032992 leprikon-3.0.0/leprikon/templates/leprikon/course_detail.html
--rw-r--r--   0        0        0       65 2019-09-15 21:19:40.032992 leprikon-3.0.0/leprikon/templates/leprikon/course_preview.html
--rw-r--r--   0        0        0     1198 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/course_registrations.html
--rw-r--r--   0        0        0       35 2019-09-15 21:19:40.032992 leprikon-3.0.0/leprikon/templates/leprikon/default.html
--rw-r--r--   0        0        0      223 2019-09-15 21:19:40.036991 leprikon-3.0.0/leprikon/templates/leprikon/event_detail.html
--rw-r--r--   0        0        0       64 2019-09-15 21:19:40.036991 leprikon-3.0.0/leprikon/templates/leprikon/event_preview.html
--rw-r--r--   0        0        0     1187 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/event_registrations.html
--rw-r--r--   0        0        0      732 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/filter_form.html
--rw-r--r--   0        0        0     1996 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/filtered_subject_list.html
--rw-r--r--   0        0        0     1626 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/form.html
--rw-r--r--   0        0        0      254 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/form_inline_item.html
--rw-r--r--   0        0        0      493 2020-10-18 07:59:19.570886 leprikon-3.0.0/leprikon/templates/leprikon/form_item.html
--rw-r--r--   0        0        0      604 2020-10-18 07:59:19.570886 leprikon-3.0.0/leprikon/templates/leprikon/form_item_checkbox.html
--rw-r--r--   0        0        0      368 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/form_item_fullwidth.html
--rw-r--r--   0        0        0     2280 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/journalentry_form.html
--rw-r--r--   0        0        0      194 2019-09-15 21:19:40.036991 leprikon-3.0.0/leprikon/templates/leprikon/journalleaderentry_form.html
--rw-r--r--   0        0        0     1011 2019-09-15 21:19:40.036991 leprikon-3.0.0/leprikon/templates/leprikon/leader_list.html
--rw-r--r--   0        0        0     2220 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/leader_preview.html
--rw-r--r--   0        0        0      553 2019-09-15 21:19:40.036991 leprikon-3.0.0/leprikon/templates/leprikon/leader_summary.html
--rw-r--r--   0        0        0      743 2020-01-12 06:54:55.436573 leprikon-3.0.0/leprikon/templates/leprikon/list.html
--rw-r--r--   0        0        0     4964 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/login.html
--rw-r--r--   0        0        0      543 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/menu.html
--rw-r--r--   0        0        0      222 2020-02-05 08:26:09.995520 leprikon-3.0.0/leprikon/templates/leprikon/message_list.html
--rw-r--r--   0        0        0      320 2020-01-31 13:15:12.831033 leprikon-3.0.0/leprikon/templates/leprikon/message_mail.html
--rw-r--r--   0        0        0      222 2020-01-31 13:15:12.831033 leprikon-3.0.0/leprikon/templates/leprikon/message_mail.txt
--rw-r--r--   0        0        0      735 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/messagerecipient_detail.html
--rw-r--r--   0        0        0      586 2020-02-05 08:26:09.995520 leprikon-3.0.0/leprikon/templates/leprikon/messages_table.html
--rw-r--r--   0        0        0     1021 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/modal_messages.html
--rw-r--r--   0        0        0      227 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/orderable_detail.html
--rw-r--r--   0        0        0       68 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/orderable_preview.html
--rw-r--r--   0        0        0     1231 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/orderable_registrations.html
--rw-r--r--   0        0        0      898 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/pagination.html
--rw-r--r--   0        0        0      915 2020-01-30 00:34:59.468857 leprikon-3.0.0/leprikon/templates/leprikon/parent_preview.html
--rw-r--r--   0        0        0     1747 2020-02-27 00:53:29.288623 leprikon-3.0.0/leprikon/templates/leprikon/participant_preview.html
--rw-r--r--   0        0        0      443 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/participants.html
--rw-r--r--   0        0        0       35 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password.html
--rw-r--r--   0        0        0      222 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password_change_done.html
--rw-r--r--   0        0        0       35 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password_reset.html
--rw-r--r--   0        0        0      368 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password_reset_complete.html
--rw-r--r--   0        0        0       35 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password_reset_confirm.html
--rw-r--r--   0        0        0      439 2019-09-15 21:19:40.040991 leprikon-3.0.0/leprikon/templates/leprikon/password_reset_done.html
--rw-r--r--   0        0        0      592 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/password_reset_email.html
--rw-r--r--   0        0        0     4016 2020-02-17 00:14:39.126447 leprikon-3.0.0/leprikon/templates/leprikon/payment_pdf/recipe.rml
--rw-r--r--   0        0        0     2468 2020-02-17 00:14:39.126447 leprikon-3.0.0/leprikon/templates/leprikon/payment_pdf/subject.rml
--rw-r--r--   0        0        0      136 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/payment_received/subject.html
--rw-r--r--   0        0        0      145 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/payment_received/subject.txt
--rw-r--r--   0        0        0     1357 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/payments.html
--rw-r--r--   0        0        0      153 2020-01-12 06:54:55.440573 leprikon-3.0.0/leprikon/templates/leprikon/registration_approved/subject.html
--rw-r--r--   0        0        0      161 2020-01-12 06:54:55.444573 leprikon-3.0.0/leprikon/templates/leprikon/registration_approved/subject.txt
--rw-r--r--   0        0        0      153 2020-10-12 09:56:52.866057 leprikon-3.0.0/leprikon/templates/leprikon/registration_canceled/subject.html
--rw-r--r--   0        0        0      161 2020-10-12 09:56:52.866057 leprikon-3.0.0/leprikon/templates/leprikon/registration_canceled/subject.txt
--rw-r--r--   0        0        0     6268 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/registration_details.html
--rw-r--r--   0        0        0     1277 2020-02-09 18:55:10.555863 leprikon-3.0.0/leprikon/templates/leprikon/registration_links.html
--rw-r--r--   0        0        0      860 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_details.html
--rw-r--r--   0        0        0      690 2020-03-23 08:56:15.175849 leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_details.txt
--rw-r--r--   0        0        0      300 2020-01-31 13:15:12.831033 leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_footer.html
--rw-r--r--   0        0        0      189 2020-01-31 13:15:12.831033 leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_footer.txt
--rw-r--r--   0        0        0     1091 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/registration_participant_presence.html
--rw-r--r--   0        0        0     1568 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.html
--rw-r--r--   0        0        0    12348 2020-12-15 19:04:59.362023 leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.rml
--rw-r--r--   0        0        0     1172 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.txt
--rw-r--r--   0        0        0     3607 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/registration_payments.html
--rw-r--r--   0        0        0    12699 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/registration_pdf/subject.rml
--rw-r--r--   0        0        0     4204 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/registration_preview.html
--rw-r--r--   0        0        0      428 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/registration_received/subject.html
--rw-r--r--   0        0        0      423 2020-02-13 18:13:09.680448 leprikon-3.0.0/leprikon/templates/leprikon/registration_received/subject.txt
--rw-r--r--   0        0        0      152 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/registration_refused/subject.html
--rw-r--r--   0        0        0      160 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/registration_refused/subject.txt
--rw-r--r--   0        0        0      873 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/templates/leprikon/registrations.html
--rw-r--r--   0        0        0      940 2019-09-15 21:19:40.048992 leprikon-3.0.0/leprikon/templates/leprikon/reports/course_payments.html
--rw-r--r--   0        0        0     4213 2020-01-13 12:06:35.722720 leprikon-3.0.0/leprikon/templates/leprikon/reports/course_payments_status.html
--rw-r--r--   0        0        0     2135 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/reports/course_stats.html
--rw-r--r--   0        0        0     1512 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/reports/debtors.html
--rw-r--r--   0        0        0      939 2019-09-15 21:19:40.048992 leprikon-3.0.0/leprikon/templates/leprikon/reports/event_payments.html
--rw-r--r--   0        0        0     4202 2020-01-13 12:06:35.722720 leprikon-3.0.0/leprikon/templates/leprikon/reports/event_payments_status.html
--rw-r--r--   0        0        0     2132 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/reports/event_stats.html
--rw-r--r--   0        0        0     1939 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/reports/index.html
--rw-r--r--   0        0        0      949 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/templates/leprikon/reports/orderable_payments.html
--rw-r--r--   0        0        0     4264 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/templates/leprikon/reports/orderable_payments_status.html
--rw-r--r--   0        0        0     2156 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/reports/orderable_stats.html
--rw-r--r--   0        0        0      669 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/schoolyear_form.html
--rw-r--r--   0        0        0       65 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/search.txt
--rw-r--r--   0        0        0      770 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/static/bootstrap-datetimepicker.html
--rw-r--r--   0        0        0      291 2020-10-12 14:32:30.310922 leprikon-3.0.0/leprikon/templates/leprikon/static/bootstrap-multiselect.html
--rw-r--r--   0        0        0      278 2020-01-12 06:54:55.452572 leprikon-3.0.0/leprikon/templates/leprikon/static/ekko-lightbox.html
--rw-r--r--   0        0        0       35 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/subject_form.html
--rw-r--r--   0        0        0    12104 2020-10-18 07:59:19.570886 leprikon-3.0.0/leprikon/templates/leprikon/subject_journal.html
--rw-r--r--   0        0        0     2280 2020-12-15 19:04:59.366023 leprikon-3.0.0/leprikon/templates/leprikon/subject_journal_pdf/subject.rml
--rw-r--r--   0        0        0     1375 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/subject_list.html
--rw-r--r--   0        0        0     5256 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/templates/leprikon/subject_preview.html
--rw-r--r--   0        0        0    29709 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/templates/leprikon/subject_registration_form.html
--rw-r--r--   0        0        0     1232 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/templates/leprikon/summary.html
--rw-r--r--   0        0        0      235 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/terms_conditions.html
--rw-r--r--   0        0        0     1959 2020-01-16 17:08:30.440809 leprikon-3.0.0/leprikon/templates/leprikon/timesheet_detail.html
--rw-r--r--   0        0        0      903 2020-01-12 06:54:55.456572 leprikon-3.0.0/leprikon/templates/leprikon/timesheet_preview.html
--rw-r--r--   0        0        0      194 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/timesheetentry_form.html
--rw-r--r--   0        0        0        0 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/title.txt
--rw-r--r--   0        0        0      134 2019-09-15 21:19:40.052992 leprikon-3.0.0/leprikon/templates/leprikon/user_create_form_item.html
--rw-r--r--   0        0        0      572 2020-03-17 06:19:27.910907 leprikon-3.0.0/leprikon/templates/leprikon/user_dropdown.html
--rw-r--r--   0        0        0      242 2019-09-15 21:19:40.068992 leprikon-3.0.0/leprikon/templates/leprikon/user_form.html
--rw-r--r--   0        0        0      813 2020-01-12 06:54:55.456572 leprikon-3.0.0/leprikon/templates/leprikon/user_menu.html
--rw-r--r--   0        0        0      283 2020-01-12 06:54:55.456572 leprikon-3.0.0/leprikon/templates/leprikon/widgets/input_option.html
--rw-r--r--   0        0        0      211 2019-09-15 21:19:40.072992 leprikon-3.0.0/leprikon/templates/leprikon/widgets/multiple_input.html
--rw-r--r--   0        0        0     5528 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/templates/rocketchat/chat.html
--rw-r--r--   0        0        0      127 2020-03-17 19:42:09.248314 leprikon-3.0.0/leprikon/templates/rocketchat/home.html
--rw-r--r--   0        0        0      836 2020-03-17 22:55:31.267475 leprikon-3.0.0/leprikon/templates/rocketchat/livechat.html
--rw-r--r--   0        0        0        0 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/templatetags/__init__.py
--rw-r--r--   0        0        0     7363 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/templatetags/leprikon_tags.py
--rw-r--r--   0        0        0      669 2020-03-17 06:19:27.914907 leprikon-3.0.0/leprikon/templatetags/rocketchat.py
--rw-r--r--   0        0        0     5383 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/urls.py
--rw-r--r--   0        0        0     8820 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/utils.py
--rw-r--r--   0        0        0     6430 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/views/__init__.py
--rw-r--r--   0        0        0     1682 2020-01-30 01:34:51.071658 leprikon-3.0.0/leprikon/views/billing_info.py
--rw-r--r--   0        0        0     5458 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/views/generic.py
--rw-r--r--   0        0        0     4199 2020-01-12 06:54:55.456572 leprikon-3.0.0/leprikon/views/journals.py
--rw-r--r--   0        0        0      782 2019-09-16 07:23:11.183711 leprikon-3.0.0/leprikon/views/leaders.py
--rw-r--r--   0        0        0     1181 2020-02-05 08:26:09.999520 leprikon-3.0.0/leprikon/views/messages.py
--rw-r--r--   0        0        0     1884 2020-01-30 00:34:59.468857 leprikon-3.0.0/leprikon/views/parents.py
--rw-r--r--   0        0        0     2466 2020-01-30 00:34:59.468857 leprikon-3.0.0/leprikon/views/participants.py
--rw-r--r--   0        0        0     2133 2020-02-09 15:11:57.577810 leprikon-3.0.0/leprikon/views/registrationlink.py
--rw-r--r--   0        0        0     1103 2020-03-23 08:56:15.179849 leprikon-3.0.0/leprikon/views/registrations.py
--rw-r--r--   0        0        0     3269 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/views/reports/__init__.py
--rw-r--r--   0        0        0     6135 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/views/reports/courses.py
--rw-r--r--   0        0        0     2103 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/views/reports/debtors.py
--rw-r--r--   0        0        0     6098 2020-12-15 19:04:59.370023 leprikon-3.0.0/leprikon/views/reports/events.py
--rw-r--r--   0        0        0     6240 2020-12-15 19:04:59.374023 leprikon-3.0.0/leprikon/views/reports/orderables.py
--rw-r--r--   0        0        0     5975 2020-10-10 19:24:37.697372 leprikon-3.0.0/leprikon/views/reports/subjects.py
--rw-r--r--   0        0        0      669 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/views/schoolyear.py
--rw-r--r--   0        0        0    10297 2020-12-15 19:04:59.374023 leprikon-3.0.0/leprikon/views/subjects.py
--rw-r--r--   0        0        0     1485 2020-12-15 19:04:59.374023 leprikon-3.0.0/leprikon/views/summaries.py
--rw-r--r--   0        0        0      130 2019-09-17 07:27:58.464897 leprikon-3.0.0/leprikon/views/terms_conditions.py
--rw-r--r--   0        0        0     3321 2020-01-27 10:37:44.726325 leprikon-3.0.0/leprikon/views/timesheets.py
--rw-r--r--   0        0        0     5274 2020-03-01 23:07:03.304654 leprikon-3.0.0/leprikon/views/user.py
--rw-r--r--   0        0        0      996 2020-12-15 19:36:13.768151 leprikon-3.0.0/pyproject.toml
--rw-r--r--   0        0        0     3858 2020-12-15 19:36:18.424368 leprikon-3.0.0/setup.py
--rw-r--r--   0        0        0     1464 2020-12-15 19:36:18.424825 leprikon-3.0.0/PKG-INFO
+-rw-r--r--   0        0        0     1483 2021-02-06 20:07:27.966856 leprikon-3.5.0/LICENSE
+-rw-r--r--   0        0        0      698 2021-02-06 20:07:27.966856 leprikon-3.5.0/README.rst
+-rw-r--r--   0        0        0     6359 2023-07-30 15:08:49.135948 leprikon-3.5.0/leprikon/__init__.py
+-rwxr-xr-x   0        0        0      326 2021-02-06 20:20:39.165125 leprikon-3.5.0/leprikon/__main__.py
+-rw-r--r--   0        0        0     2366 2022-09-11 22:24:07.292086 leprikon-3.5.0/leprikon/admin/__init__.py
+-rw-r--r--   0        0        0      194 2021-02-06 20:20:39.169125 leprikon-3.5.0/leprikon/admin/account.py
+-rw-r--r--   0        0        0      341 2023-07-13 19:03:27.661576 leprikon-3.5.0/leprikon/admin/agegroup.py
+-rw-r--r--   0        0        0     1215 2023-07-13 19:03:27.661576 leprikon-3.5.0/leprikon/admin/agreements.py
+-rw-r--r--   0        0        0     3866 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/admin/bulkupdate.py
+-rw-r--r--   0        0        0      316 2023-07-13 19:03:27.665576 leprikon-3.5.0/leprikon/admin/citizenship.py
+-rw-r--r--   0        0        0    13856 2023-07-30 15:02:55.324965 leprikon-3.5.0/leprikon/admin/courses.py
+-rw-r--r--   0        0        0      184 2021-02-06 20:20:39.169125 leprikon-3.5.0/leprikon/admin/department.py
+-rw-r--r--   0        0        0     1280 2021-06-01 08:37:09.562968 leprikon-3.5.0/leprikon/admin/donation.py
+-rw-r--r--   0        0        0     8904 2023-07-30 15:02:55.324965 leprikon-3.5.0/leprikon/admin/events.py
+-rw-r--r--   0        0        0     4695 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/admin/export.py
+-rw-r--r--   0        0        0     8990 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/admin/filters.py
+-rw-r--r--   0        0        0     9088 2023-01-09 01:29:06.992459 leprikon-3.5.0/leprikon/admin/journals.py
+-rw-r--r--   0        0        0      899 2023-01-20 02:25:46.109478 leprikon-3.5.0/leprikon/admin/leprikonsite.py
+-rw-r--r--   0        0        0     8213 2023-01-09 01:29:06.992459 leprikon-3.5.0/leprikon/admin/messages.py
+-rw-r--r--   0        0        0    10182 2023-07-30 15:02:55.324965 leprikon-3.5.0/leprikon/admin/orderables.py
+-rw-r--r--   0        0        0      259 2021-02-06 20:20:39.173125 leprikon-3.5.0/leprikon/admin/organizations.py
+-rw-r--r--   0        0        0     2469 2023-07-13 19:03:27.665576 leprikon-3.5.0/leprikon/admin/pdf.py
+-rw-r--r--   0        0        0      165 2021-02-06 20:20:39.173125 leprikon-3.5.0/leprikon/admin/place.py
+-rw-r--r--   0        0        0      190 2021-02-06 20:20:39.173125 leprikon-3.5.0/leprikon/admin/printsetup.py
+-rw-r--r--   0        0        0      311 2022-06-19 21:02:37.423258 leprikon-3.5.0/leprikon/admin/question.py
+-rw-r--r--   0        0        0     6405 2023-01-11 22:05:01.465080 leprikon-3.5.0/leprikon/admin/refundrequest.py
+-rw-r--r--   0        0        0     5217 2023-07-30 15:02:55.324965 leprikon-3.5.0/leprikon/admin/registrationlink.py
+-rw-r--r--   0        0        0     6294 2023-07-13 19:03:27.665576 leprikon-3.5.0/leprikon/admin/roles.py
+-rw-r--r--   0        0        0      171 2021-02-06 20:20:39.173125 leprikon-3.5.0/leprikon/admin/school.py
+-rw-r--r--   0        0        0     3454 2023-07-13 19:03:27.665576 leprikon-3.5.0/leprikon/admin/schoolyear.py
+-rw-r--r--   0        0        0      399 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/admin/sendmail.py
+-rw-r--r--   0        0        0    45734 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/admin/subjects.py
+-rw-r--r--   0        0        0      310 2023-07-13 19:03:27.665576 leprikon-3.5.0/leprikon/admin/targetgroup.py
+-rw-r--r--   0        0        0     4612 2023-07-13 19:26:09.899255 leprikon-3.5.0/leprikon/admin/timesheets.py
+-rw-r--r--   0        0        0     7470 2023-01-10 14:07:38.306536 leprikon-3.5.0/leprikon/admin/transaction.py
+-rw-r--r--   0        0        0     6951 2023-01-09 01:29:06.996459 leprikon-3.5.0/leprikon/admin/user.py
+-rw-r--r--   0        0        0      635 2022-06-19 21:02:37.423258 leprikon-3.5.0/leprikon/admin/utils.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:27.974856 leprikon-3.5.0/leprikon/api/__init__.py
+-rw-r--r--   0        0        0      165 2023-07-13 19:26:09.899255 leprikon-3.5.0/leprikon/api/openapi.py
+-rw-r--r--   0        0        0      948 2023-04-17 11:27:57.487276 leprikon-3.5.0/leprikon/api/serializers.py
+-rw-r--r--   0        0        0      778 2023-07-13 19:26:09.899255 leprikon-3.5.0/leprikon/api/urls.py
+-rw-r--r--   0        0        0     3857 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/api/views.py
+-rw-r--r--   0        0        0     1231 2023-04-17 11:27:57.487276 leprikon-3.5.0/leprikon/apps.py
+-rw-r--r--   0        0        0     1091 2021-02-06 20:20:39.177125 leprikon-3.5.0/leprikon/bankreaders.py
+-rw-r--r--   0        0        0     1263 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/cms_apps.py
+-rw-r--r--   0        0        0     9366 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_menus.py
+-rw-r--r--   0        0        0      150 2021-02-06 20:07:27.978855 leprikon-3.5.0/leprikon/cms_plugins/__init__.py
+-rw-r--r--   0        0        0      440 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/base.py
+-rw-r--r--   0        0        0     1097 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/courses.py
+-rw-r--r--   0        0        0     1080 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/events.py
+-rw-r--r--   0        0        0     1018 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/leaders.py
+-rw-r--r--   0        0        0     1154 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/orderables.py
+-rw-r--r--   0        0        0      466 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_plugins/schoolyears.py
+-rw-r--r--   0        0        0      683 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/cms_toolbars.py
+-rw-r--r--   0        0        0      485 2021-02-06 20:20:39.181125 leprikon-3.5.0/leprikon/conf/__init__.py
+-rw-r--r--   0        0        0     4015 2023-01-23 01:36:04.150478 leprikon-3.5.0/leprikon/conf/default_settings.py
+-rw-r--r--   0        0        0     2234 2021-02-06 20:20:39.181125 leprikon-3.5.0/leprikon/cronjobs.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:27.982856 leprikon-3.5.0/leprikon/forms/__init__.py
+-rw-r--r--   0        0        0      341 2021-02-06 20:20:39.181125 leprikon-3.5.0/leprikon/forms/billing_info.py
+-rw-r--r--   0        0        0      319 2021-02-15 21:00:52.270425 leprikon-3.5.0/leprikon/forms/confirm.py
+-rw-r--r--   0        0        0     2887 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/forms/courses.py
+-rw-r--r--   0        0        0     2846 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/fields.py
+-rw-r--r--   0        0        0      610 2021-02-15 21:00:52.270425 leprikon-3.5.0/leprikon/forms/form.py
+-rw-r--r--   0        0        0    18999 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/forms/journals.py
+-rw-r--r--   0        0        0      780 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/leaders.py
+-rw-r--r--   0        0        0     2232 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/messages.py
+-rw-r--r--   0        0        0      326 2021-02-06 20:20:39.185125 leprikon-3.5.0/leprikon/forms/parent.py
+-rw-r--r--   0        0        0      716 2021-02-06 20:20:39.185125 leprikon-3.5.0/leprikon/forms/participant.py
+-rw-r--r--   0        0        0     3827 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/refundrequest.py
+-rw-r--r--   0        0        0      446 2022-06-19 21:02:37.423258 leprikon-3.5.0/leprikon/forms/registrationlink.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.054856 leprikon-3.5.0/leprikon/forms/reports/__init__.py
+-rw-r--r--   0        0        0     1477 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/reports/courses.py
+-rw-r--r--   0        0        0      209 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/reports/debtors.py
+-rw-r--r--   0        0        0     1463 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/reports/events.py
+-rw-r--r--   0        0        0     1503 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/reports/orderables.py
+-rw-r--r--   0        0        0      715 2022-09-11 22:24:07.296086 leprikon-3.5.0/leprikon/forms/schoolyear.py
+-rw-r--r--   0        0        0    38900 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/forms/subjects.py
+-rw-r--r--   0        0        0     3521 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/forms/timesheets.py
+-rw-r--r--   0        0        0     4245 2023-04-17 11:27:57.487276 leprikon-3.5.0/leprikon/forms/user.py
+-rw-r--r--   0        0        0     1088 2022-06-19 21:02:37.427258 leprikon-3.5.0/leprikon/forms/widgets.py
+-rw-r--r--   0        0        0      209 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/gettext_overrides.py
+-rw-r--r--   0        0        0    77194 2023-01-20 02:22:52.895963 leprikon-3.5.0/leprikon/locale/cs/LC_MESSAGES/django.mo
+-rw-r--r--   0        0        0   141096 2023-01-20 02:22:52.895963 leprikon-3.5.0/leprikon/locale/cs/LC_MESSAGES/django.po
+-rw-r--r--   0        0        0      323 2022-09-04 23:40:36.644492 leprikon-3.5.0/leprikon/locale/en/LC_MESSAGES/django.mo
+-rw-r--r--   0        0        0   111732 2022-09-04 22:12:01.810032 leprikon-3.5.0/leprikon/locale/en/LC_MESSAGES/django.po
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/management/__init__.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/management/commands/__init__.py
+-rw-r--r--   0        0        0     4121 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/middleware.py
+-rw-r--r--   0        0        0    59583 2023-01-23 01:36:04.150478 leprikon-3.5.0/leprikon/migrations/0001_initial.py
+-rw-r--r--   0        0        0     1851 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0002_initial_data.py
+-rw-r--r--   0        0        0     1954 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0003_managers.py
+-rw-r--r--   0        0        0      345 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0004_multiple_registrations.py
+-rw-r--r--   0        0        0      879 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0005_subjectregistration_variable_symbol.py
+-rw-r--r--   0        0        0     1049 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0006_discount_periods.py
+-rw-r--r--   0        0        0      864 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0007_bill_print_setup.py
+-rw-r--r--   0        0        0      449 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0008_leprikonsite_company_name.py
+-rw-r--r--   0        0        0      656 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0009_subjectpayment_received_by.py
+-rw-r--r--   0        0        0      449 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0010_subject_code.py
+-rw-r--r--   0        0        0      457 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0011_subjectregistration_payment_requested.py
+-rw-r--r--   0        0        0     1676 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0012_subject_variants.py
+-rw-r--r--   0        0        0      549 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0013_drop_insurance.py
+-rw-r--r--   0        0        0      472 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0014_variable_symbol.py
+-rw-r--r--   0        0        0     4137 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0015_school_year_divisions.py
+-rw-r--r--   0        0        0     1191 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0016_school_year_divisions_cleanup.py
+-rw-r--r--   0        0        0     3919 2023-07-13 19:03:27.669576 leprikon-3.5.0/leprikon/migrations/0017_citizenship.py
+-rw-r--r--   0        0        0      475 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0018_citizenship_cleanup.py
+-rw-r--r--   0        0        0     3040 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0019_department.py
+-rw-r--r--   0        0        0     1377 2021-02-06 20:07:28.070855 leprikon-3.5.0/leprikon/migrations/0020_agreements.py
+-rw-r--r--   0        0        0     1532 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0021_user_agreement.py
+-rw-r--r--   0        0        0      671 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0022_bankreader.py
+-rw-r--r--   0        0        0     2506 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0023_accountclosure.py
+-rw-r--r--   0        0        0      504 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0024_subjectregistration_note.py
+-rw-r--r--   0        0        0     5224 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0025_agreements.py
+-rw-r--r--   0        0        0      942 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0026_online_payments.py
+-rw-r--r--   0        0        0     2243 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0027_journals.py
+-rw-r--r--   0        0        0      517 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0028_agegroups.py
+-rw-r--r--   0        0        0      646 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0029_payment_restrictions.py
+-rw-r--r--   0        0        0      716 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0030_agreements.py
+-rw-r--r--   0        0        0     2208 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0031_registration_questions_agreements.py
+-rw-r--r--   0        0        0    15532 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0032_registration_participants_groups.py
+-rw-r--r--   0        0        0     4196 2021-02-06 20:07:28.074856 leprikon-3.5.0/leprikon/migrations/0033_target_groups.py
+-rw-r--r--   0        0        0     9741 2022-09-11 14:45:14.421101 leprikon-3.5.0/leprikon/migrations/0034_subject_registration_group.py
+-rw-r--r--   0        0        0     1807 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0035_on_delete.py
+-rw-r--r--   0        0        0     1220 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0036_participants_instructed.py
+-rw-r--r--   0        0        0      703 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0037_message_sender.py
+-rw-r--r--   0        0        0     6559 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0038_organizations.py
+-rw-r--r--   0        0        0     4941 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0039_editable_texts.py
+-rw-r--r--   0        0        0     1827 2021-02-06 20:07:28.078856 leprikon-3.5.0/leprikon/migrations/0040_due_dates.py
+-rw-r--r--   0        0        0     2946 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0041_billing_info.py
+-rw-r--r--   0        0        0     1207 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0042_chat_group_types.py
+-rw-r--r--   0        0        0     1960 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0043_registration_links.py
+-rw-r--r--   0        0        0     2153 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0044_billinginfo_contacts.py
+-rw-r--r--   0        0        0      527 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0045_registration_slug.py
+-rw-r--r--   0        0        0     3632 2021-02-06 20:07:28.082856 leprikon-3.5.0/leprikon/migrations/0046_attachment_events.py
+-rw-r--r--   0        0        0     6061 2021-02-06 20:07:28.086856 leprikon-3.5.0/leprikon/migrations/0047_pr_print_setup.py
+-rw-r--r--   0        0        0     2700 2021-02-06 20:07:28.086856 leprikon-3.5.0/leprikon/migrations/0048_birth_date.py
+-rw-r--r--   0        0        0      999 2021-02-06 20:07:28.086856 leprikon-3.5.0/leprikon/migrations/0049_target_groups_fix.py
+-rw-r--r--   0        0        0    11512 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/migrations/0050_orderables.py
+-rw-r--r--   0        0        0      546 2021-02-06 20:07:28.086856 leprikon-3.5.0/leprikon/migrations/0051_registration_group_name.py
+-rw-r--r--   0        0        0      762 2021-02-06 20:07:28.086856 leprikon-3.5.0/leprikon/migrations/0052_payment_notification_sent.py
+-rw-r--r--   0        0        0     2528 2021-02-06 20:07:28.090856 leprikon-3.5.0/leprikon/migrations/0053_registration_dates_by.py
+-rw-r--r--   0        0        0      460 2021-02-06 20:07:28.090856 leprikon-3.5.0/leprikon/migrations/0054_registration_dates_by_cleanup.py
+-rw-r--r--   0        0        0     1020 2021-02-06 20:07:28.090856 leprikon-3.5.0/leprikon/migrations/0055_schoolyearblockplugin.py
+-rw-r--r--   0        0        0     4108 2021-02-06 20:07:28.090856 leprikon-3.5.0/leprikon/migrations/0056_registration_period.py
+-rw-r--r--   0        0        0      739 2021-02-06 20:07:28.094856 leprikon-3.5.0/leprikon/migrations/0057_registration_period.py
+-rw-r--r--   0        0        0     1229 2021-02-06 20:07:28.094856 leprikon-3.5.0/leprikon/migrations/0058_agegroup_min_max_age.py
+-rw-r--r--   0        0        0     5253 2021-07-30 12:23:56.621387 leprikon-3.5.0/leprikon/migrations/0059_transactions_data.py
+-rw-r--r--   0        0        0    12344 2021-06-03 01:45:58.168248 leprikon-3.5.0/leprikon/migrations/0060_transactions.py
+-rw-r--r--   0        0        0     2055 2021-06-03 02:51:13.941010 leprikon-3.5.0/leprikon/migrations/0061_refundrequest.py
+-rw-r--r--   0        0        0     4102 2021-06-08 21:18:56.417557 leprikon-3.5.0/leprikon/migrations/0062_refund_offers.py
+-rw-r--r--   0        0        0     7724 2021-08-31 21:32:49.271400 leprikon-3.5.0/leprikon/migrations/0063_journals.py
+-rw-r--r--   0        0        0     1127 2021-10-26 23:31:48.142344 leprikon-3.5.0/leprikon/migrations/0064_journals_cleanup.py
+-rw-r--r--   0        0        0     1600 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/migrations/0065_subject_type_page.py
+-rw-r--r--   0        0        0      453 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/migrations/0066_subject_type_slug_unique.py
+-rw-r--r--   0        0        0      528 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/migrations/0067_remove_rocketchat.py
+-rw-r--r--   0        0        0      518 2022-06-19 21:02:37.431258 leprikon-3.5.0/leprikon/migrations/0068_participant_answers.py
+-rw-r--r--   0        0        0     2329 2023-01-20 01:19:05.975668 leprikon-3.5.0/leprikon/migrations/0069_question_slug.py
+-rw-r--r--   0        0        0     1851 2023-01-20 01:19:05.975668 leprikon-3.5.0/leprikon/migrations/0070_decision_print_setup.py
+-rw-r--r--   0        0        0      746 2022-09-04 23:40:36.644492 leprikon-3.5.0/leprikon/migrations/0071_transaction_amount.py
+-rw-r--r--   0        0        0     9100 2022-09-11 15:35:00.764956 leprikon-3.5.0/leprikon/migrations/0072_prices.py
+-rw-r--r--   0        0        0     3555 2023-01-23 01:36:04.150478 leprikon-3.5.0/leprikon/migrations/0073_add_limit_choices_to.py
+-rw-r--r--   0        0        0     1311 2023-01-09 01:29:06.996459 leprikon-3.5.0/leprikon/migrations/0074_schoolyear_period_order.py
+-rw-r--r--   0        0        0     3311 2023-07-30 15:02:55.328965 leprikon-3.5.0/leprikon/migrations/0075_journal_school_year_division.py
+-rw-r--r--   0        0        0     1603 2023-01-09 01:29:06.996459 leprikon-3.5.0/leprikon/migrations/0076_journalentry_period.py
+-rw-r--r--   0        0        0      482 2023-01-23 01:36:04.150478 leprikon-3.5.0/leprikon/migrations/0077_place_description.py
+-rw-r--r--   0        0        0     1840 2023-07-13 19:03:27.669576 leprikon-3.5.0/leprikon/migrations/0078_delete_coursevariant.py
+-rw-r--r--   0        0        0     8503 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/migrations/0079_mandatory_subject_variants.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.094856 leprikon-3.5.0/leprikon/migrations/__init__.py
+-rw-r--r--   0        0        0      463 2021-06-03 02:51:13.941010 leprikon-3.5.0/leprikon/models/__init__.py
+-rw-r--r--   0        0        0      641 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/account.py
+-rw-r--r--   0        0        0      793 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/agegroup.py
+-rw-r--r--   0        0        0     1553 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/agreements.py
+-rw-r--r--   0        0        0      540 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/citizenship.py
+-rw-r--r--   0        0        0    17737 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/models/courses.py
+-rw-r--r--   0        0        0      616 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/department.py
+-rw-r--r--   0        0        0      704 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/donation.py
+-rw-r--r--   0        0        0    12356 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/models/events.py
+-rw-r--r--   0        0        0     5763 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/fields.py
+-rw-r--r--   0        0        0    10471 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/models/journals.py
+-rw-r--r--   0        0        0     3367 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/leprikonsite.py
+-rw-r--r--   0        0        0     4316 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/messages.py
+-rw-r--r--   0        0        0    12852 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/models/orderables.py
+-rw-r--r--   0        0        0     1896 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/organizations.py
+-rw-r--r--   0        0        0     4129 2023-07-13 19:03:27.669576 leprikon-3.5.0/leprikon/models/pdfmail.py
+-rw-r--r--   0        0        0      714 2023-01-23 01:36:04.150478 leprikon-3.5.0/leprikon/models/place.py
+-rw-r--r--   0        0        0     2183 2023-07-13 19:03:27.669576 leprikon-3.5.0/leprikon/models/printsetup.py
+-rw-r--r--   0        0        0     2093 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/question.py
+-rw-r--r--   0        0        0     1625 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/refundrequest.py
+-rw-r--r--   0        0        0     1730 2023-07-30 15:02:55.332965 leprikon-3.5.0/leprikon/models/registrationlink.py
+-rw-r--r--   0        0        0    12114 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/roles.py
+-rw-r--r--   0        0        0      894 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/school.py
+-rw-r--r--   0        0        0     5005 2023-01-09 01:29:06.996459 leprikon-3.5.0/leprikon/models/schoolyear.py
+-rw-r--r--   0        0        0      639 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/startend.py
+-rw-r--r--   0        0        0    68363 2023-07-30 15:04:20.768982 leprikon-3.5.0/leprikon/models/subjects.py
+-rw-r--r--   0        0        0      626 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/targetgroup.py
+-rw-r--r--   0        0        0     1482 2021-06-03 03:12:18.850194 leprikon-3.5.0/leprikon/models/test_utils.py
+-rw-r--r--   0        0        0     2787 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/times.py
+-rw-r--r--   0        0        0     5592 2023-01-20 01:19:05.979668 leprikon-3.5.0/leprikon/models/timesheets.py
+-rw-r--r--   0        0        0     9259 2023-01-20 01:19:05.979668 leprikon-3.5.0/leprikon/models/transaction.py
+-rw-r--r--   0        0        0      439 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/models/useragreement.py
+-rw-r--r--   0        0        0     9133 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/models/utils.py
+-rw-r--r--   0        0        0      127 2021-02-06 20:07:28.098856 leprikon-3.5.0/leprikon/search_indexes/__init__.py
+-rw-r--r--   0        0        0      682 2021-02-06 20:20:39.189125 leprikon-3.5.0/leprikon/search_indexes/base.py
+-rw-r--r--   0        0        0      143 2021-02-06 20:20:39.189125 leprikon-3.5.0/leprikon/search_indexes/courses.py
+-rw-r--r--   0        0        0      139 2021-02-06 20:20:39.189125 leprikon-3.5.0/leprikon/search_indexes/events.py
+-rw-r--r--   0        0        0      155 2021-02-06 20:20:39.189125 leprikon-3.5.0/leprikon/search_indexes/orderables.py
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.102856 leprikon-3.5.0/leprikon/site/__init__.py
+-rw-r--r--   0        0        0    16830 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/site/settings.py
+-rw-r--r--   0        0        0     1761 2023-07-17 19:51:19.009803 leprikon-3.5.0/leprikon/site/urls.py
+-rw-r--r--   0        0        0      458 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/site/wsgi.py
+-rw-r--r--   0        0        0      566 2023-01-20 01:19:05.979668 leprikon-3.5.0/leprikon/static/admin/css/scrollbars.css
+-rw-r--r--   0        0        0     5994 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/static/admin/js/admin/RelatedObjectLookups.js
+-rw-r--r--   0        0        0    10366 2021-02-06 20:07:28.102856 leprikon-3.5.0/leprikon/static/favicon.ico
+-rw-r--r--   0        0        0     3153 2021-02-06 20:07:28.102856 leprikon-3.5.0/leprikon/static/leprikon/css/colors.css
+-rw-r--r--   0        0        0     4472 2021-02-06 20:07:28.102856 leprikon-3.5.0/leprikon/static/leprikon/css/layout.css
+-rw-r--r--   0        0        0     1138 2021-02-06 20:07:28.102856 leprikon-3.5.0/leprikon/static/leprikon/css/registrations.changelist.css
+-rw-r--r--   0        0        0   705684 2021-02-06 20:07:28.118856 leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-Bold.ttf
+-rw-r--r--   0        0        0   643292 2021-02-06 20:07:28.126856 leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-BoldOblique.ttf
+-rw-r--r--   0        0        0   635416 2021-02-06 20:07:28.134856 leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-Oblique.ttf
+-rw-r--r--   0        0        0   757076 2021-02-06 20:07:28.138856 leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans.ttf
+-rw-r--r--   0        0        0    83151 2021-02-06 20:07:28.138856 leprikon-3.5.0/leprikon/static/leprikon/img/leprikon-kuk-l.png
+-rw-r--r--   0        0        0    51531 2021-02-06 20:07:28.138856 leprikon-3.5.0/leprikon/static/leprikon/img/logo-horizontal.png
+-rw-r--r--   0        0        0   200727 2021-02-06 20:07:28.138856 leprikon-3.5.0/leprikon/static/leprikon/img/logo.png
+-rw-r--r--   0        0        0      522 2021-02-06 20:07:28.138856 leprikon-3.5.0/leprikon/static/leprikon/js/Popup.js
+-rw-r--r--   0        0        0     1517 2022-06-19 21:02:37.435258 leprikon-3.5.0/leprikon/static/leprikon/js/required_optional_field.js
+-rw-r--r--   0        0        0      175 2023-01-09 01:29:07.000459 leprikon-3.5.0/leprikon/staticfiles.py
+-rw-r--r--   0        0        0      727 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/base.html
+-rw-r--r--   0        0        0     1175 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/change_list.html
+-rw-r--r--   0        0        0     1570 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/change_list_results.html
+-rw-r--r--   0        0        0     1589 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/admin/inc/branding.html
+-rw-r--r--   0        0        0       96 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/inc/extrahead.html
+-rw-r--r--   0        0        0      134 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/app_index.html
+-rw-r--r--   0        0        0      207 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/coursediscount/popup_response.html
+-rw-r--r--   0        0        0      561 2021-06-01 05:03:47.670256 leprikon-3.5.0/leprikon/templates/admin/leprikon/donation/change_form.html
+-rw-r--r--   0        0        0      207 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/eventdiscount/popup_response.html
+-rw-r--r--   0        0        0      563 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/message/add_recipients.html
+-rw-r--r--   0        0        0      460 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/messagerecipient/change_list.html
+-rw-r--r--   0        0        0     2425 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/messagerecipient/send_mails.html
+-rw-r--r--   0        0        0      207 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/admin/leprikon/orderablediscount/popup_response.html
+-rw-r--r--   0        0        0      560 2021-06-01 05:03:47.670256 leprikon-3.5.0/leprikon/templates/admin/leprikon/subjectreceivedpayment/change_form.html
+-rw-r--r--   0        0        0      207 2021-06-01 05:03:47.670256 leprikon-3.5.0/leprikon/templates/admin/leprikon/subjectreceivedpayment/popup_response.html
+-rw-r--r--   0        0        0      560 2021-06-01 05:03:47.670256 leprikon-3.5.0/leprikon/templates/admin/leprikon/subjectreturnedpayment/change_form.html
+-rw-r--r--   0        0        0      207 2021-05-31 17:36:24.566151 leprikon-3.5.0/leprikon/templates/admin/leprikon/subjectreturnedpayment/popup_response.html
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/auth/widgets/read_only_password_hash.html
+-rw-r--r--   0        0        0      257 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/cms/toolbar/items/logo.html
+-rw-r--r--   0        0        0     1180 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/leprikon/admin/action_form.html
+-rw-r--r--   0        0        0     1170 2023-01-09 01:29:07.000459 leprikon-3.5.0/leprikon/templates/leprikon/admin/bulk_update_form.html
+-rw-r--r--   0        0        0     2978 2021-08-16 07:31:28.779948 leprikon-3.5.0/leprikon/templates/leprikon/admin/dashboard.html
+-rw-r--r--   0        0        0     1235 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/leprikon/admin/merge.html
+-rw-r--r--   0        0        0     1077 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/leprikon/admin/send_message.html
+-rw-r--r--   0        0        0     1296 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/leprikon/alternating.html
+-rw-r--r--   0        0        0     3431 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/base.html
+-rw-r--r--   0        0        0     1089 2021-02-06 20:07:28.142856 leprikon-3.5.0/leprikon/templates/leprikon/billing_info_preview.html
+-rw-r--r--   0        0        0       73 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/course/default.html
+-rw-r--r--   0        0        0      142 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/course_list/default.html
+-rw-r--r--   0        0        0      326 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/course_list/grouped.html
+-rw-r--r--   0        0        0     1368 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/cms/course_list_filtered.html
+-rw-r--r--   0        0        0       70 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/event/default.html
+-rw-r--r--   0        0        0      139 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/event_list/default.html
+-rw-r--r--   0        0        0      324 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/event_list/grouped.html
+-rw-r--r--   0        0        0     1001 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/cms/event_list_filtered.html
+-rw-r--r--   0        0        0       73 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/leader/default.html
+-rw-r--r--   0        0        0     1695 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/leader_list/default.html
+-rw-r--r--   0        0        0     1086 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/cms/leader_list_filtered.html
+-rw-r--r--   0        0        0       82 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/orderable/default.html
+-rw-r--r--   0        0        0      151 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/orderable_list/default.html
+-rw-r--r--   0        0        0      332 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/orderable_list/grouped.html
+-rw-r--r--   0        0        0     1013 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/cms/orderable_list_filtered.html
+-rw-r--r--   0        0        0      206 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms/school_year_block.html
+-rw-r--r--   0        0        0      199 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/cms.html
+-rw-r--r--   0        0        0      769 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/confirm_form.html
+-rw-r--r--   0        0        0      224 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/course_detail.html
+-rw-r--r--   0        0        0       65 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/course_preview.html
+-rw-r--r--   0        0        0     1198 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/course_registrations.html
+-rw-r--r--   0        0        0       35 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/default.html
+-rw-r--r--   0        0        0     2470 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/donation_pdf/default.rml
+-rw-r--r--   0        0        0     2701 2021-06-01 05:24:24.368881 leprikon-3.5.0/leprikon/templates/leprikon/donation_pdf/recipe.rml
+-rw-r--r--   0        0        0      937 2021-06-01 09:11:38.676158 leprikon-3.5.0/leprikon/templates/leprikon/donations.html
+-rw-r--r--   0        0        0      223 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/event_detail.html
+-rw-r--r--   0        0        0       64 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/event_preview.html
+-rw-r--r--   0        0        0     1187 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/event_registrations.html
+-rw-r--r--   0        0        0      732 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/filter_form.html
+-rw-r--r--   0        0        0     1991 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/filtered_subject_list.html
+-rw-r--r--   0        0        0     2198 2021-08-31 20:34:46.158520 leprikon-3.5.0/leprikon/templates/leprikon/form.html
+-rw-r--r--   0        0        0      254 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/form_inline_item.html
+-rw-r--r--   0        0        0      493 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/form_item.html
+-rw-r--r--   0        0        0      604 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/form_item_checkbox.html
+-rw-r--r--   0        0        0      368 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/form_item_fullwidth.html
+-rw-r--r--   0        0        0     7105 2023-01-09 01:29:07.000459 leprikon-3.5.0/leprikon/templates/leprikon/invoices.xml
+-rw-r--r--   0        0        0      531 2022-09-11 22:24:07.300086 leprikon-3.5.0/leprikon/templates/leprikon/journal_form.html
+-rw-r--r--   0        0        0    12058 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/journal_journal.html
+-rw-r--r--   0        0        0     2271 2021-08-16 07:31:28.779948 leprikon-3.5.0/leprikon/templates/leprikon/journal_journal_pdf/default.rml
+-rw-r--r--   0        0        0     2023 2022-06-19 21:02:37.435258 leprikon-3.5.0/leprikon/templates/leprikon/journal_preview.html
+-rw-r--r--   0        0        0     2481 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/templates/leprikon/journalentry_form.html
+-rw-r--r--   0        0        0      189 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/journalleaderentry_form.html
+-rw-r--r--   0        0        0     1006 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/leader_list.html
+-rw-r--r--   0        0        0     2220 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/leader_preview.html
+-rw-r--r--   0        0        0      553 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/leader_summary.html
+-rw-r--r--   0        0        0      743 2021-02-06 20:07:28.146856 leprikon-3.5.0/leprikon/templates/leprikon/list.html
+-rw-r--r--   0        0        0     4959 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/login.html
+-rw-r--r--   0        0        0      543 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/menu.html
+-rw-r--r--   0        0        0      222 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/message_list.html
+-rw-r--r--   0        0        0      320 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/message_mail.html
+-rw-r--r--   0        0        0      222 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/message_mail.txt
+-rw-r--r--   0        0        0      735 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/messagerecipient_detail.html
+-rw-r--r--   0        0        0      586 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/messages_table.html
+-rw-r--r--   0        0        0     1021 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/modal_messages.html
+-rw-r--r--   0        0        0      227 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/orderable_detail.html
+-rw-r--r--   0        0        0       68 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/orderable_preview.html
+-rw-r--r--   0        0        0     1231 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/orderable_registrations.html
+-rw-r--r--   0        0        0      898 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/pagination.html
+-rw-r--r--   0        0        0      915 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/parent_preview.html
+-rw-r--r--   0        0        0     1742 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/participant_preview.html
+-rw-r--r--   0        0        0      443 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/participants.html
+-rw-r--r--   0        0        0       35 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password.html
+-rw-r--r--   0        0        0      222 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_change_done.html
+-rw-r--r--   0        0        0       35 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_reset.html
+-rw-r--r--   0        0        0      368 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_reset_complete.html
+-rw-r--r--   0        0        0       35 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_reset_confirm.html
+-rw-r--r--   0        0        0      439 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_reset_done.html
+-rw-r--r--   0        0        0      592 2021-02-06 20:07:28.150856 leprikon-3.5.0/leprikon/templates/leprikon/password_reset_email.html
+-rw-r--r--   0        0        0     1617 2021-06-01 22:52:10.045174 leprikon-3.5.0/leprikon/templates/leprikon/payments.html
+-rw-r--r--   0        0        0     2936 2021-06-01 08:37:09.562968 leprikon-3.5.0/leprikon/templates/leprikon/received_payment_pdf/recipe.rml
+-rw-r--r--   0        0        0     2486 2021-06-01 08:37:09.562968 leprikon-3.5.0/leprikon/templates/leprikon/received_payment_pdf/subject.rml
+-rw-r--r--   0        0        0      136 2021-06-01 08:37:09.566968 leprikon-3.5.0/leprikon/templates/leprikon/received_payment_received/subject.html
+-rw-r--r--   0        0        0      223 2021-06-01 08:37:09.566968 leprikon-3.5.0/leprikon/templates/leprikon/received_payment_received/subject.subject.txt
+-rw-r--r--   0        0        0      145 2021-06-01 08:37:09.566968 leprikon-3.5.0/leprikon/templates/leprikon/received_payment_received/subject.txt
+-rw-r--r--   0        0        0      153 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_approved/subject.html
+-rw-r--r--   0        0        0      178 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/registration_approved/subject.subject.txt
+-rw-r--r--   0        0        0      161 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_approved/subject.txt
+-rw-r--r--   0        0        0      153 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_canceled/subject.html
+-rw-r--r--   0        0        0      178 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/registration_canceled/subject.subject.txt
+-rw-r--r--   0        0        0      161 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_canceled/subject.txt
+-rw-r--r--   0        0        0     5431 2022-06-19 23:56:58.526604 leprikon-3.5.0/leprikon/templates/leprikon/registration_decision/subject.rml
+-rw-r--r--   0        0        0     6268 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_details.html
+-rw-r--r--   0        0        0     1209 2022-08-09 07:23:11.034741 leprikon-3.5.0/leprikon/templates/leprikon/registration_links.html
+-rw-r--r--   0        0        0      610 2021-06-08 20:34:42.425099 leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_details.html
+-rw-r--r--   0        0        0      534 2021-06-08 20:34:42.425099 leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_details.txt
+-rw-r--r--   0        0        0      300 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_footer.html
+-rw-r--r--   0        0        0      189 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_footer.txt
+-rw-r--r--   0        0        0      427 2021-08-16 07:31:28.779948 leprikon-3.5.0/leprikon/templates/leprikon/registration_participant_presence.html
+-rw-r--r--   0        0        0     1568 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.html
+-rw-r--r--   0        0        0    12348 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.rml
+-rw-r--r--   0        0        0      183 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.subject.txt
+-rw-r--r--   0        0        0     1172 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.txt
+-rw-r--r--   0        0        0     3830 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/templates/leprikon/registration_payments.html
+-rw-r--r--   0        0        0    12536 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/templates/leprikon/registration_pdf/subject.rml
+-rw-r--r--   0        0        0     4204 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_preview.html
+-rw-r--r--   0        0        0      438 2022-06-19 21:02:37.435258 leprikon-3.5.0/leprikon/templates/leprikon/registration_received/subject.html
+-rw-r--r--   0        0        0      165 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/registration_received/subject.subject.txt
+-rw-r--r--   0        0        0      433 2022-06-19 21:02:37.435258 leprikon-3.5.0/leprikon/templates/leprikon/registration_received/subject.txt
+-rw-r--r--   0        0        0     1031 2021-06-01 05:24:24.368881 leprikon-3.5.0/leprikon/templates/leprikon/registration_recipe.rml
+-rw-r--r--   0        0        0      712 2021-06-08 21:18:56.417557 leprikon-3.5.0/leprikon/templates/leprikon/registration_refund_offer/subject.html
+-rw-r--r--   0        0        0      180 2021-06-08 20:34:42.425099 leprikon-3.5.0/leprikon/templates/leprikon/registration_refund_offer/subject.subject.txt
+-rw-r--r--   0        0        0      575 2021-06-08 21:18:56.417557 leprikon-3.5.0/leprikon/templates/leprikon/registration_refund_offer/subject.txt
+-rw-r--r--   0        0        0      152 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_refused/subject.html
+-rw-r--r--   0        0        0      177 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/registration_refused/subject.subject.txt
+-rw-r--r--   0        0        0      160 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registration_refused/subject.txt
+-rw-r--r--   0        0        0      873 2021-02-06 20:07:28.154856 leprikon-3.5.0/leprikon/templates/leprikon/registrations.html
+-rw-r--r--   0        0        0     2387 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/course_payments.html
+-rw-r--r--   0        0        0     4667 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/course_payments_status.html
+-rw-r--r--   0        0        0     2263 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/course_stats.html
+-rw-r--r--   0        0        0     1513 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/debtors.html
+-rw-r--r--   0        0        0     2385 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/event_payments.html
+-rw-r--r--   0        0        0     4656 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/event_payments_status.html
+-rw-r--r--   0        0        0     2127 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/event_stats.html
+-rw-r--r--   0        0        0     1934 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/index.html
+-rw-r--r--   0        0        0     2405 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/orderable_payments.html
+-rw-r--r--   0        0        0     4718 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/orderable_payments_status.html
+-rw-r--r--   0        0        0     2151 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/reports/orderable_stats.html
+-rw-r--r--   0        0        0     2945 2021-06-01 08:37:09.566968 leprikon-3.5.0/leprikon/templates/leprikon/returned_payment_pdf/recipe.rml
+-rw-r--r--   0        0        0     2486 2021-05-31 10:12:28.917535 leprikon-3.5.0/leprikon/templates/leprikon/returned_payment_pdf/subject.rml
+-rw-r--r--   0        0        0      136 2021-05-31 12:22:27.052070 leprikon-3.5.0/leprikon/templates/leprikon/returned_payment_received/subject.html
+-rw-r--r--   0        0        0      223 2021-06-01 02:09:02.932873 leprikon-3.5.0/leprikon/templates/leprikon/returned_payment_received/subject.subject.txt
+-rw-r--r--   0        0        0      145 2021-05-31 12:22:27.052070 leprikon-3.5.0/leprikon/templates/leprikon/returned_payment_received/subject.txt
+-rw-r--r--   0        0        0      664 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/schoolyear_form.html
+-rw-r--r--   0        0        0       65 2021-02-06 20:07:28.158856 leprikon-3.5.0/leprikon/templates/leprikon/search.txt
+-rw-r--r--   0        0        0      765 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/static/bootstrap-datetimepicker.html
+-rw-r--r--   0        0        0      286 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/static/bootstrap-multiselect.html
+-rw-r--r--   0        0        0      273 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/static/ekko-lightbox.html
+-rw-r--r--   0        0        0       35 2021-02-06 20:07:28.158856 leprikon-3.5.0/leprikon/templates/leprikon/subject_form.html
+-rw-r--r--   0        0        0       72 2021-08-16 07:31:28.779948 leprikon-3.5.0/leprikon/templates/leprikon/subject_journals.html
+-rw-r--r--   0        0        0     1370 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/subject_list.html
+-rw-r--r--   0        0        0     4893 2022-09-11 14:45:14.421101 leprikon-3.5.0/leprikon/templates/leprikon/subject_preview.html
+-rw-r--r--   0        0        0    28074 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/templates/leprikon/subject_registration_form.html
+-rw-r--r--   0        0        0     3542 2021-06-03 02:51:13.941010 leprikon-3.5.0/leprikon/templates/leprikon/summary.html
+-rw-r--r--   0        0        0      235 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/terms_conditions.html
+-rw-r--r--   0        0        0     1959 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/timesheet_detail.html
+-rw-r--r--   0        0        0      898 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/timesheet_preview.html
+-rw-r--r--   0        0        0      189 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/templates/leprikon/timesheetentry_form.html
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/title.txt
+-rw-r--r--   0        0        0      134 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/user_create_form_item.html
+-rw-r--r--   0        0        0      572 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/user_dropdown.html
+-rw-r--r--   0        0        0      242 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/user_form.html
+-rw-r--r--   0        0        0      813 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/user_menu.html
+-rw-r--r--   0        0        0      283 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/widgets/input_option.html
+-rw-r--r--   0        0        0      211 2021-02-06 20:07:28.162856 leprikon-3.5.0/leprikon/templates/leprikon/widgets/multiple_input.html
+-rw-r--r--   0        0        0      554 2022-06-19 21:02:37.439258 leprikon-3.5.0/leprikon/templates/required_optional_field.html
+-rw-r--r--   0        0        0        0 2021-02-06 20:07:28.166856 leprikon-3.5.0/leprikon/templatetags/__init__.py
+-rw-r--r--   0        0        0     7364 2023-07-30 15:02:55.336964 leprikon-3.5.0/leprikon/templatetags/leprikon_tags.py
+-rw-r--r--   0        0        0      105 2023-01-01 16:24:39.600383 leprikon-3.5.0/leprikon/templatetags/staticfiles.py
+-rw-r--r--   0        0        0     5863 2023-07-30 15:02:55.340964 leprikon-3.5.0/leprikon/urls.py
+-rw-r--r--   0        0        0     9220 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/utils.py
+-rw-r--r--   0        0        0     7516 2021-08-16 07:31:28.779948 leprikon-3.5.0/leprikon/views/__init__.py
+-rw-r--r--   0        0        0     1659 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/billing_info.py
+-rw-r--r--   0        0        0      568 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/donation.py
+-rw-r--r--   0        0        0     5275 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/generic.py
+-rw-r--r--   0        0        0     5846 2023-01-09 01:29:07.000459 leprikon-3.5.0/leprikon/views/journals.py
+-rw-r--r--   0        0        0      706 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/leaders.py
+-rw-r--r--   0        0        0     1082 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/messages.py
+-rw-r--r--   0        0        0     1845 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/parents.py
+-rw-r--r--   0        0        0     2443 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/participants.py
+-rw-r--r--   0        0        0     2776 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/refundrequest.py
+-rw-r--r--   0        0        0     2150 2023-07-30 15:02:55.340964 leprikon-3.5.0/leprikon/views/registrationlink.py
+-rw-r--r--   0        0        0     1076 2021-02-15 21:00:52.274425 leprikon-3.5.0/leprikon/views/registrations.py
+-rw-r--r--   0        0        0     3486 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/reports/__init__.py
+-rw-r--r--   0        0        0     9337 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/reports/courses.py
+-rw-r--r--   0        0        0     2140 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/reports/debtors.py
+-rw-r--r--   0        0        0     7857 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/reports/events.py
+-rw-r--r--   0        0        0     8022 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/reports/orderables.py
+-rw-r--r--   0        0        0      628 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/schoolyear.py
+-rw-r--r--   0        0        0    12992 2023-07-30 15:02:55.340964 leprikon-3.5.0/leprikon/views/subjects.py
+-rw-r--r--   0        0        0     1845 2021-07-30 12:23:56.629387 leprikon-3.5.0/leprikon/views/summaries.py
+-rw-r--r--   0        0        0      130 2021-02-06 20:20:39.193125 leprikon-3.5.0/leprikon/views/terms_conditions.py
+-rw-r--r--   0        0        0     3175 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/timesheets.py
+-rw-r--r--   0        0        0     5378 2022-09-11 22:24:07.304086 leprikon-3.5.0/leprikon/views/user.py
+-rw-r--r--   0        0        0     2562 2023-07-30 15:08:49.135948 leprikon-3.5.0/pyproject.toml
+-rw-r--r--   0        0        0     3271 1970-01-01 00:00:00.000000 leprikon-3.5.0/PKG-INFO
```

### Comparing `leprikon-3.0.0/LICENSE` & `leprikon-3.5.0/LICENSE`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/__init__.py` & `leprikon-3.5.0/leprikon/__init__.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,39 +1,75 @@
-__version__ = '2.28.0'
-default_app_config = 'leprikon.apps.LeprikonConfig'
+__version__ = "3.5.0"
+default_app_config = "leprikon.apps.LeprikonConfig"
 
 staticfiles_urls = {
-    'leprikon/lib/bootstrap/css/bootstrap-theme.css': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap.min.css': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap-theme.css.map': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css.map', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap.min.css.map': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css.map', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap-theme.min.css': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap.css': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap-theme.min.css.map': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css.map', # NOQA
-    'leprikon/lib/bootstrap/css/bootstrap.css.map': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css.map', # NOQA
-    'leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.svg': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.svg', # NOQA
-    'leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.ttf': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.ttf', # NOQA
-    'leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.eot': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.eot', # NOQA
-    'leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.woff': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.woff', # NOQA
-    'leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.woff2', # NOQA
-    'leprikon/lib/bootstrap/js/bootstrap.min.js': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js', # NOQA
-    'leprikon/lib/bootstrap/js/npm.js': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/npm.js', # NOQA
-    'leprikon/lib/bootstrap/js/bootstrap.js': 'https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js', # NOQA
-    'leprikon/lib/bootstrap-datetimepicker.min.css': ('https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css', 'sha384', '/XmhRcB6e51B3NO1S5VVWnNKCDM74NlX0cmxZUwCJPg2P/0ECTkBKnjnzNnF7rX5'), # NOQA
-    'leprikon/lib/bootstrap-datetimepicker.min.js': ('https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js', 'sha384', 'V936AaxnYTkq53cO2z8e42PFtCCdZhbRttfhgX8U1K9weNYVdCMbDetUKTtllFdc'), # NOQA
-    'leprikon/lib/bootstrap-multiselect.css': ('https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css', 'sha384', 'l1tju+TyzPCuWXt+knuFYVhe2ZnnEm0/t9T8BmqNedtIBYj1fmsYrIAap4MU2amm'), # NOQA
-    'leprikon/lib/bootstrap-multiselect.min.js': ('https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.min.js', 'sha384', '2q+7Pk3OSOseTKfNi/t8mZzYRIovdg+nfXYeKmmnivkyD+nxosintmGKX7SWcrOG'), # NOQA
-    'leprikon/lib/ekko-lightbox.min.css': ('https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/4.0.1/ekko-lightbox.min.css', 'sha384', 'EsoR0pjPTZTUy5b8kJf6aTfA7quYluD5mNQ/Lz4hsxU2kXuuc6PlXVfBJCFdTXqD'), # NOQA
-    'leprikon/lib/ekko-lightbox.min.js': ('https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/4.0.1/ekko-lightbox.min.js', 'sha384', '2aVpK/uKiYlyFXHZ36wvxOPZyWeouEKvbSUlqCrkFhyT80n2aSYtT15Tgdn6g41M'), # NOQA
-    'leprikon/lib/jquery.min.js': ('https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js', 'sha256', 'ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ='), # NOQA
-    'leprikon/lib/moment-with-locales.min.js': ('https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment-with-locales.min.js', 'sha384', 'V0utPzNT28o7j37Ll4BIKqEVcL1yOE45HoCoaLu/CqF4nFaf2nAyZTHKJW1KdJMH'), # NOQA
-    'leprikon/lib/bootstrap-social.min.css': ('https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/5.1.1/bootstrap-social.min.css', 'sha384', 'N7gull5mxE2uLDqZ+kcZolhmuopwLtTcThUsVnUS2LVMQljojN9cfJ9A6fUA63zB'), # NOQA
-    'leprikon/lib/font-awesome/css/font-awesome.css': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css', # NOQA 
-    'leprikon/lib/font-awesome/css/font-awesome.css.map': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css.map', # NOQA 
-    'leprikon/lib/font-awesome/css/font-awesome.min.css': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css', # NOQA 
-    'leprikon/lib/font-awesome/fonts/FontAwesome.otf': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/FontAwesome.otf', # NOQA 
-    'leprikon/lib/font-awesome/fonts/fontawesome-webfont.eot': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.eot', # NOQA 
-    'leprikon/lib/font-awesome/fonts/fontawesome-webfont.svg': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.svg', # NOQA 
-    'leprikon/lib/font-awesome/fonts/fontawesome-webfont.ttf': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.ttf', # NOQA 
-    'leprikon/lib/font-awesome/fonts/fontawesome-webfont.woff': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff', # NOQA 
-    'leprikon/lib/font-awesome/fonts/fontawesome-webfont.woff2': 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2', # NOQA 
+    "leprikon/lib/bootstrap/css/bootstrap-theme.css": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap.min.css": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap-theme.css.map": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.css.map",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap.min.css.map": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css.map",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap-theme.min.css": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap.css": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap-theme.min.css.map": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap-theme.min.css.map",  # NOQA
+    "leprikon/lib/bootstrap/css/bootstrap.css.map": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css.map",  # NOQA
+    "leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.svg": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.svg",  # NOQA
+    "leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.ttf": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.ttf",  # NOQA
+    "leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.eot": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.eot",  # NOQA
+    "leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.woff": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.woff",  # NOQA
+    "leprikon/lib/bootstrap/fonts/glyphicons-halflings-regular.woff2": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/fonts/glyphicons-halflings-regular.woff2",  # NOQA
+    "leprikon/lib/bootstrap/js/bootstrap.min.js": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js",  # NOQA
+    "leprikon/lib/bootstrap/js/npm.js": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/npm.js",  # NOQA
+    "leprikon/lib/bootstrap/js/bootstrap.js": "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js",  # NOQA
+    "leprikon/lib/bootstrap-datetimepicker.min.css": (
+        "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css",
+        "sha384",
+        "/XmhRcB6e51B3NO1S5VVWnNKCDM74NlX0cmxZUwCJPg2P/0ECTkBKnjnzNnF7rX5",
+    ),  # NOQA
+    "leprikon/lib/bootstrap-datetimepicker.min.js": (
+        "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js",
+        "sha384",
+        "V936AaxnYTkq53cO2z8e42PFtCCdZhbRttfhgX8U1K9weNYVdCMbDetUKTtllFdc",
+    ),  # NOQA
+    "leprikon/lib/bootstrap-multiselect.css": (
+        "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css",
+        "sha384",
+        "l1tju+TyzPCuWXt+knuFYVhe2ZnnEm0/t9T8BmqNedtIBYj1fmsYrIAap4MU2amm",
+    ),  # NOQA
+    "leprikon/lib/bootstrap-multiselect.min.js": (
+        "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.min.js",
+        "sha384",
+        "2q+7Pk3OSOseTKfNi/t8mZzYRIovdg+nfXYeKmmnivkyD+nxosintmGKX7SWcrOG",
+    ),  # NOQA
+    "leprikon/lib/ekko-lightbox.min.css": (
+        "https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/4.0.1/ekko-lightbox.min.css",
+        "sha384",
+        "EsoR0pjPTZTUy5b8kJf6aTfA7quYluD5mNQ/Lz4hsxU2kXuuc6PlXVfBJCFdTXqD",
+    ),  # NOQA
+    "leprikon/lib/ekko-lightbox.min.js": (
+        "https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/4.0.1/ekko-lightbox.min.js",
+        "sha384",
+        "2aVpK/uKiYlyFXHZ36wvxOPZyWeouEKvbSUlqCrkFhyT80n2aSYtT15Tgdn6g41M",
+    ),  # NOQA
+    "leprikon/lib/jquery.min.js": (
+        "https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js",
+        "sha256",
+        "ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=",
+    ),  # NOQA
+    "leprikon/lib/moment-with-locales.min.js": (
+        "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment-with-locales.min.js",
+        "sha384",
+        "V0utPzNT28o7j37Ll4BIKqEVcL1yOE45HoCoaLu/CqF4nFaf2nAyZTHKJW1KdJMH",
+    ),  # NOQA
+    "leprikon/lib/bootstrap-social.min.css": (
+        "https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/5.1.1/bootstrap-social.min.css",
+        "sha384",
+        "N7gull5mxE2uLDqZ+kcZolhmuopwLtTcThUsVnUS2LVMQljojN9cfJ9A6fUA63zB",
+    ),  # NOQA
+    "leprikon/lib/font-awesome/css/font-awesome.css": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css",  # NOQA
+    "leprikon/lib/font-awesome/css/font-awesome.css.map": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css.map",  # NOQA
+    "leprikon/lib/font-awesome/css/font-awesome.min.css": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css",  # NOQA
+    "leprikon/lib/font-awesome/fonts/FontAwesome.otf": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/FontAwesome.otf",  # NOQA
+    "leprikon/lib/font-awesome/fonts/fontawesome-webfont.eot": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.eot",  # NOQA
+    "leprikon/lib/font-awesome/fonts/fontawesome-webfont.svg": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.svg",  # NOQA
+    "leprikon/lib/font-awesome/fonts/fontawesome-webfont.ttf": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.ttf",  # NOQA
+    "leprikon/lib/font-awesome/fonts/fontawesome-webfont.woff": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff",  # NOQA
+    "leprikon/lib/font-awesome/fonts/fontawesome-webfont.woff2": "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2",  # NOQA
 }
```

### Comparing `leprikon-3.0.0/leprikon/admin/__init__.py` & `leprikon-3.5.0/leprikon/admin/__init__.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,67 +1,88 @@
 import locale
 
 import icu
 from django.contrib import admin
 from django.contrib.auth import get_user_model
 from django.http import Http404
 from django.template.response import TemplateResponse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from . import (  # NOQA
-    account, agegroup, agreements, citizenship, courses, department, events,
-    journals, leprikonsite, messages, orderables, organizations, place,
-    printsetup, question, registrationlink, roles, school, schoolyear,
-    subjects, targetgroup, timesheets, user,
+    account,
+    agegroup,
+    agreements,
+    citizenship,
+    courses,
+    department,
+    donation,
+    events,
+    journals,
+    leprikonsite,
+    messages,
+    orderables,
+    organizations,
+    place,
+    printsetup,
+    question,
+    refundrequest,
+    registrationlink,
+    roles,
+    school,
+    schoolyear,
+    subjects,
+    targetgroup,
+    timesheets,
+    transaction,
+    user,
 )
 
 User = get_user_model()
 
-admin.site.site_header = _('Leprikon administration')
-admin.site.site_title = _('Leprikon administration')
+admin.site.site_header = _("Leprikon administration")
+admin.site.site_title = _("Leprikon administration")
 
 
 def app_index(self, request, app_label, extra_context=None):
     app_dict = self._build_app_dict(request, app_label)
     if not app_dict:
-        raise Http404('The requested admin page does not exist.')
+        raise Http404("The requested admin page does not exist.")
     # Sort the models alphabetically within each app.
-    collator = icu.Collator.createInstance(icu.Locale('.'.join(locale.getlocale())))
-    app_dict['models'].sort(key=lambda x: collator.getSortKey(x['name'].lower()))
+    collator = icu.Collator.createInstance(icu.Locale(".".join(locale.getlocale())))
+    app_dict["models"].sort(key=lambda x: collator.getSortKey(x["name"].lower()))
     context = dict(
         self.each_context(request),
-        title=_('Leprikon administration'),
+        title=_("Leprikon administration"),
         app_list=[app_dict],
         app_label=app_label,
     )
     context.update(extra_context or {})
 
     request.current_app = self.name
 
-    return TemplateResponse(request, self.app_index_template or [
-        'admin/%s/app_index.html' % app_label,
-        'admin/app_index.html'
-    ], context)
+    return TemplateResponse(
+        request, self.app_index_template or ["admin/%s/app_index.html" % app_label, "admin/app_index.html"], context
+    )
 
 
 def get_app_list(self, request):
     """
     Returns a sorted list of all the installed apps that have been
     registered in this site.
     """
-    collator = icu.Collator.createInstance(icu.Locale('.'.join(locale.getlocale())))
+    collator = icu.Collator.createInstance(icu.Locale(".".join(locale.getlocale())))
 
     app_dict = self._build_app_dict(request)
 
     # Sort the apps alphabetically.
-    app_list = sorted(app_dict.values(), key=lambda x: collator.getSortKey(x['name'].lower()))
+    app_list = sorted(app_dict.values(), key=lambda x: collator.getSortKey(x["name"].lower()))
 
     # Sort the models alphabetically within each app.
     for app in app_list:
-        app['models'].sort(key=lambda x: collator.getSortKey(x['name'].lower()))
+        app["models"].sort(key=lambda x: collator.getSortKey(x["name"].lower()))
 
     return app_list
 
 
 # override default Admin site's app_index and get_app_list
 admin.sites.AdminSite.app_index = app_index
 admin.sites.AdminSite.get_app_list = get_app_list
```

### Comparing `leprikon-3.0.0/leprikon/admin/agreements.py` & `leprikon-3.5.0/leprikon/admin/agreements.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,36 +1,35 @@
+from adminsortable2.admin import SortableAdminMixin, SortableInlineAdminMixin
 from django.contrib import admin
 
 from ..models.agreements import Agreement, AgreementOption
 from .filters import ActiveListFilter
 
 
-class AgreementOptionInlineAdmin(admin.TabularInline):
+class AgreementOptionInlineAdmin(SortableInlineAdminMixin, admin.TabularInline):
     model = AgreementOption
     extra = 0
     min_num = 1
 
 
 @admin.register(Agreement)
-class AgreementAdmin(admin.ModelAdmin):
+class AgreementAdmin(SortableAdminMixin, admin.ModelAdmin):
     inlines = (AgreementOptionInlineAdmin,)
-    list_display = ('name', 'order')
-    list_editable = ('order',)
+    list_display = ("name",)
     list_filter = (ActiveListFilter,)
 
     def has_delete_permission(self, request, obj=None):
         if obj and obj.registrations.exists():
             return False
         else:
             return super().has_delete_permission(request, obj)
 
     def get_actions(self, request):
         actions = super().get_actions(request)
-        if 'delete_selected' in actions:
+        if "delete_selected" in actions:
+
             def delete_selected(model_admin, request, queryset):
                 queryset = queryset.filter(registrations__id=None)
                 return admin.actions.delete_selected(model_admin, request, queryset)
-            actions['delete_selected'] = (
-                delete_selected,
-                *actions['delete_selected'][1:]
-            )
+
+            actions["delete_selected"] = (delete_selected, *actions["delete_selected"][1:])
         return actions
```

### Comparing `leprikon-3.0.0/leprikon/admin/bulkupdate.py` & `leprikon-3.5.0/leprikon/admin/bulkupdate.py`

 * *Files 22% similar despite different names*

```diff
@@ -2,90 +2,97 @@
 
 from django import forms
 from django.contrib import admin, messages
 from django.forms.models import modelform_factory
 from django.forms.widgets import CheckboxSelectMultiple
 from django.shortcuts import render
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from sentry_sdk import capture_exception
 
+from ..utils import attributes
+
 
 class BulkUpdateMixin:
-    actions = ('bulk_update',)
+    actions = ("bulk_update",)
 
     bulk_update_fields = None
     bulk_update_exclude = None
     bulk_update_form = None
 
     @cached_property
     def BulkUpdateFieldsForm(self):
-        return type('BulkUpdateFieldsForm', (forms.Form,), {
-            'fields': forms.MultipleChoiceField(
-                label=_('Fields to update'),
-                choices=[
-                    (field_name, field.label)
-                    for field_name, field in forms.models.fields_for_model(
-                        self.model,
-                        fields=self.bulk_update_fields,
-                        exclude=self.bulk_update_exclude,
-                    ).items()
-                ],
-                widget=CheckboxSelectMultiple,
-            ),
-        })
+        return type(
+            "BulkUpdateFieldsForm",
+            (forms.Form,),
+            {
+                "fields": forms.MultipleChoiceField(
+                    label=_("Fields to update"),
+                    choices=[
+                        (field_name, field.label)
+                        for field_name, field in forms.models.fields_for_model(
+                            self.model,
+                            fields=self.bulk_update_fields,
+                            exclude=self.bulk_update_exclude,
+                        ).items()
+                    ],
+                    widget=CheckboxSelectMultiple,
+                ),
+            },
+        )
 
+    @attributes(short_description=_("Bulk update selected items"))
     def bulk_update(self, request, queryset):
-        phase = request.POST.get('phase')
+        phase = request.POST.get("phase")
         hidden_fields = []
         # phases: None > 'fields' > 'update'
         if phase is not None:
             form = self.BulkUpdateFieldsForm(request.POST)
             if form.is_valid():
-                hidden_fields = [
-                    ('fields', field)
-                    for field in form.cleaned_data['fields']
-                ]
+                hidden_fields = [("fields", field) for field in form.cleaned_data["fields"]]
                 BulkUpdateForm = modelform_factory(
                     self.model,
                     form=self.bulk_update_form or self.form,
-                    fields=form.cleaned_data['fields'],
+                    fields=form.cleaned_data["fields"],
                     formfield_callback=partial(self.formfield_for_dbfield, request=request),
                 )
-                if phase == 'update':
+                if phase == "update":
                     form = BulkUpdateForm(request.POST)
                     if form.is_valid():
                         num_updated = 0
                         for instance in queryset.all():
                             try:
                                 instance_form = BulkUpdateForm(request.POST, request.FILES, instance=instance)
                                 assert instance_form.is_valid()
                                 instance_form.save()
                             except Exception:
                                 capture_exception()
                                 self.message_user(
                                     request,
-                                    _(f'Failed to update item {instance}.'),
+                                    _("Failed to update item {}.").format(instance),
                                     messages.ERROR,
                                 )
                             else:
                                 num_updated += 1
-                        self.message_user(request, _(f'{num_updated} items were updated.'))
+                        self.message_user(request, _("{} items were updated.").format(num_updated))
                         return
                 else:
                     form = BulkUpdateForm()
-                    phase = 'update'
+                    phase = "update"
         else:
             form = self.BulkUpdateFieldsForm()
-            phase = 'fields'
-        hidden_fields.append(('phase', phase))
-        return render(request, 'leprikon/admin/bulk_update_form.html', {
-            'title': _('Bulk update'),
-            'queryset': queryset,
-            'opts': self.model._meta,
-            'form': form,
-            'media': self.media + form.media,
-            'action': 'bulk_update',
-            'action_checkbox_name': admin.helpers.ACTION_CHECKBOX_NAME,
-            'hidden_fields': hidden_fields,
-        })
-    bulk_update.short_description = _('Bulk update selected items')
+            phase = "fields"
+        hidden_fields.append(("phase", phase))
+        return render(
+            request,
+            "leprikon/admin/bulk_update_form.html",
+            {
+                "title": _("Bulk update"),
+                "queryset": queryset,
+                "opts": self.model._meta,
+                "form": form,
+                "media": self.media + form.media,
+                "action": "bulk_update",
+                "action_checkbox_name": admin.helpers.ACTION_CHECKBOX_NAME,
+                "hidden_fields": hidden_fields,
+            },
+        )
```

### Comparing `leprikon-3.0.0/leprikon/admin/courses.py` & `leprikon-3.5.0/leprikon/admin/courses.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,299 +1,344 @@
 from django import forms
 from django.contrib import admin
-from django.contrib.admin.widgets import (
-    AdminRadioSelect, FilteredSelectMultiple,
-)
+from django.contrib.admin.widgets import AdminRadioSelect, FilteredSelectMultiple
 from django.contrib.auth import get_user_model
-from django.contrib.staticfiles.templatetags.staticfiles import static
-from django.db.models import F
 from django.shortcuts import render
+from django.templatetags.static import static
 from django.urls import reverse
 from django.utils.html import format_html
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
-from ..forms.courses import (
-    CourseDiscountAdminForm, CourseRegistrationAdminForm,
-)
-from ..models.courses import (
-    Course, CourseDiscount, CourseRegistration, CourseRegistrationHistory,
-    CourseTime,
-)
+from ..forms.courses import CourseDiscountAdminForm, CourseRegistrationAdminForm
+from ..models.courses import Course, CourseDiscount, CourseRegistration, CourseRegistrationHistory
 from ..models.schoolyear import SchoolYear, SchoolYearDivision
 from ..models.subjects import SubjectType
-from ..utils import currency
+from ..utils import attributes, currency
 from .pdf import PdfExportAdminMixin
-from .subjects import (
-    SubjectBaseAdmin, SubjectPaymentBaseAdmin, SubjectRegistrationBaseAdmin,
-)
-
-
-class CourseTimeInlineAdmin(admin.TabularInline):
-    model = CourseTime
-    extra = 0
+from .subjects import SubjectBaseAdmin, SubjectDiscountBaseAdmin, SubjectRegistrationBaseAdmin
 
 
 @admin.register(Course)
 class CourseAdmin(SubjectBaseAdmin):
     subject_type_type = SubjectType.COURSE
     registration_model = CourseRegistration
     list_display = (
-        'id', 'code', 'name', 'subject_type', 'get_groups_list', 'get_leaders_list',
-        'get_times_list',
-        'place', 'public', 'registration_allowed_icon',
-        'get_registrations_link',
-        'get_journal_link', 'icon', 'note',
+        "id",
+        "code",
+        "name",
+        "subject_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_times_list",
+        "place",
+        "public",
+        "registration_allowed_icon",
+        "get_registrations_link",
+        "journals_link",
+        "icon",
+        "note",
     )
     list_export = (
-        'id', 'school_year', 'code', 'name', 'department', 'subject_type', 'registration_type',
-        'get_groups_list', 'get_leaders_list', 'get_age_groups_list', 'get_target_groups_list',
-        'get_times_list', 'place', 'public', 'price',
-        'min_participants_count', 'max_participants_count', 'min_group_members_count', 'max_group_members_count',
-        'min_registrations_count', 'max_registrations_count',
-        'get_approved_registrations_count', 'get_unapproved_registrations_count', 'note',
+        "id",
+        "school_year",
+        "code",
+        "name",
+        "department",
+        "subject_type",
+        "registration_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_age_groups_list",
+        "get_target_groups_list",
+        "get_times_list",
+        "place",
+        "public",
+        "min_registrations_count",
+        "max_registrations_count",
+        "get_approved_registrations_count",
+        "get_unapproved_registrations_count",
+        "note",
     )
-    inlines = (
-        CourseTimeInlineAdmin,
-    ) + SubjectBaseAdmin.inlines
-    actions = (
-        'publish', 'unpublish',
-        'copy_to_school_year',
+    actions = SubjectBaseAdmin.actions + (
+        "publish",
+        "unpublish",
+        "copy_to_school_year",
     )
 
-    def get_form(self, request, obj=None, **kwargs):
-        form = super().get_form(request, obj, **kwargs)
-        if 'school_year_division' in form.base_fields:
-            # school year division choices
-            school_year_division_choices = form.base_fields['school_year_division'].widget.widget.choices
-            school_year_division_choices.queryset = SchoolYearDivision.objects.filter(
-                school_year=obj.school_year if obj else request.school_year,
-            )
-            form.base_fields['school_year_division'].choices = school_year_division_choices
-        return form
-
+    @attributes(short_description=_("Publish selected courses"))
     def publish(self, request, queryset):
-        Course.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=True)
-        self.message_user(request, _('Selected courses were published.'))
-    publish.short_description = _('Publish selected courses')
+        Course.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=True)
+        self.message_user(request, _("Selected courses were published."))
 
+    @attributes(short_description=_("Unpublish selected courses"))
     def unpublish(self, request, queryset):
-        Course.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=False)
-        self.message_user(request, _('Selected courses were unpublished.'))
-    unpublish.short_description = _('Unpublish selected courses')
+        Course.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=False)
+        self.message_user(request, _("Selected courses were unpublished."))
 
+    @attributes(short_description=_("Copy selected courses to another school year"))
     def copy_to_school_year(self, request, queryset):
         class SchoolYearForm(forms.Form):
             school_year = forms.ModelChoiceField(
-                label=_('Target school year'),
-                help_text=_('All selected courses will be copied to selected school year.'),
+                label=_("Target school year"),
+                help_text=_("All selected courses will be copied to selected school year."),
                 queryset=SchoolYear.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = SchoolYearForm(request.POST)
             if form.is_valid():
-                school_year = form.cleaned_data['school_year']
+                school_year = form.cleaned_data["school_year"]
                 for course in queryset.all():
                     course.copy_to_school_year(school_year)
-                self.message_user(request, _('Selected courses were copied to school year {}.').format(school_year))
+                self.message_user(request, _("Selected courses were copied to school year {}.").format(school_year))
                 return
         else:
             form = SchoolYearForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Select target school year'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='copy_to_school_year',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    copy_to_school_year.short_description = _('Copy selected courses to another school year')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Select target school year"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="copy_to_school_year",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
     def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(
-            leprikon_registrations__subject__in=queryset,
-        ).distinct()
+        return (
+            get_user_model()
+            .objects.filter(
+                leprikon_registrations__canceled=None,
+                leprikon_registrations__subject__in=queryset,
+            )
+            .distinct()
+        )
 
 
 class CourseRegistrationHistoryInlineAdmin(admin.TabularInline):
     model = CourseRegistrationHistory
     extra = 0
-    readonly_fields = ('course',)
+    readonly_fields = ("course",)
 
-    def has_add_permission(self, request):
+    def has_add_permission(self, request, obj=None):
         return False
 
     def has_delete_permission(self, request, obj=None):
         return False
 
 
 @admin.register(CourseRegistration)
 class CourseRegistrationAdmin(PdfExportAdminMixin, SubjectRegistrationBaseAdmin):
     form = CourseRegistrationAdminForm
     subject_type_type = SubjectType.COURSE
-    actions = ('add_discounts',)
+    actions = SubjectRegistrationBaseAdmin.actions + PdfExportAdminMixin.actions + ("add_discounts",)
     inlines = SubjectRegistrationBaseAdmin.inlines + (CourseRegistrationHistoryInlineAdmin,)
-    list_display = (
-        'variable_symbol', 'download_tag', 'subject_name', 'participants_list_html', 'price',
-        'course_discounts', 'course_payments',
-        'created_with_by', 'approved_with_by', 'payment_requested_with_by',
-        'cancelation_requested_with_by', 'canceled_with_by',
-        'note', 'random_number',
-    )
 
     def get_queryset(self, request):
-        return super().get_queryset(request).prefetch_related(
-            'course_registration_periods',
+        return (
+            super()
+            .get_queryset(request)
+            .prefetch_related(
+                "course_registration_periods",
+            )
         )
 
+    @attributes(short_description=_("Add discounts to selected registrations"))
     def add_discounts(self, request, queryset):
-        ABSOLUTE = 'A'
-        RELATIVE = 'R'
+        ABSOLUTE = "A"
+        RELATIVE = "R"
 
         class DiscountBaseForm(forms.Form):
             discount_type = forms.ChoiceField(
-                label=_('Discount type'),
-                choices=(
-                    (ABSOLUTE, _('absolute amount')),
-                    (RELATIVE, _('relative amount in percents'))
-                ),
+                label=_("Discount type"),
+                choices=((ABSOLUTE, _("absolute amount")), (RELATIVE, _("relative amount in percents"))),
                 widget=AdminRadioSelect(),
             )
-            amount = forms.DecimalField(label=_('Amount or number of percents'))
-            explanation = CourseDiscount._meta.get_field('explanation').formfield()
+            amount = forms.DecimalField(label=_("Amount or number of percents"))
+            explanation = CourseDiscount._meta.get_field("explanation").formfield()
 
         school_year_divisions = {
             school_year_division.id: school_year_division
             for school_year_division in SchoolYearDivision.objects.filter(
-                courses__registrations__in=queryset,
+                variants__subject__registrations__in=queryset,
             ).distinct()
         }
 
-        label = _('Periods of school year division: {school_year_division}')
-        DiscountForm = type('DiscountForm', (DiscountBaseForm,), {
-            f'periods_{school_year_division.id}': forms.ModelMultipleChoiceField(
-                label=label.format(
-                    school_year_division=school_year_division.name,
-                ),
-                queryset=school_year_division.periods.all(),
-                widget=FilteredSelectMultiple(
-                    verbose_name=label.format(
+        label = _("Periods of school year division: {school_year_division}")
+        DiscountForm = type(
+            "DiscountForm",
+            (DiscountBaseForm,),
+            {
+                f"periods_{school_year_division.id}": forms.ModelMultipleChoiceField(
+                    label=label.format(
                         school_year_division=school_year_division.name,
                     ),
-                    is_stacked=False,
-                ),
-            )
-            for school_year_division in school_year_divisions.values()
-        })
-        if request.POST.get('post', 'no') == 'yes':
+                    queryset=school_year_division.periods.all(),
+                    required=False,
+                    widget=FilteredSelectMultiple(
+                        verbose_name=label.format(
+                            school_year_division=school_year_division.name,
+                        ),
+                        is_stacked=False,
+                    ),
+                )
+                for school_year_division in school_year_divisions.values()
+            },
+        )
+        if request.POST.get("post", "no") == "yes":
             form = DiscountForm(request.POST)
             if form.is_valid():
                 CourseDiscount.objects.bulk_create(
                     CourseDiscount(
                         registration=registration,
                         registration_period=registration_period,
                         amount=(
-                            form.cleaned_data['amount']
-                            if form.cleaned_data['discount_type'] == ABSOLUTE
+                            form.cleaned_data["amount"]
+                            if form.cleaned_data["discount_type"] == ABSOLUTE
                             else (
-                                registration.price - sum(
+                                registration.price
+                                - sum(
                                     discount.amount
                                     for discount in registration.all_discounts
                                     if discount.registration_period_id == registration_period.id
                                 )
-                            ) * form.cleaned_data['amount'] / 100
+                            )
+                            * form.cleaned_data["amount"]
+                            / 100
                         ),
-                        explanation=form.cleaned_data['explanation'],
-                    )
-                    for registration in queryset.annotate(
-                        school_year_division_id=F('subject__course__school_year_division_id')
+                        explanation=form.cleaned_data["explanation"],
                     )
+                    for registration in queryset.all()
                     for registration_period in registration.course_registration_periods.filter(
-                        period__in=form.cleaned_data[f'periods_{registration.school_year_division_id}']
+                        period__in=form.cleaned_data[f"periods_{registration.subject_variant.school_year_division_id}"]
                     )
                 )
-                self.message_user(request, _(
-                    'The discounts have been created for selected registrations.'
-                ))
+                self.message_user(request, _("The discounts have been created for selected registrations."))
                 return
         else:
             form = DiscountForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Add discounts'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='add_discounts',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    add_discounts.short_description = _('Add discounts to selected registrations')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Add discounts"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="add_discounts",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
-    def course_discounts(self, obj):
+    @attributes(short_description=_("discounts"))
+    def discounts(self, obj: CourseRegistration):
         html = []
         for status in obj.period_payment_statuses:
-            query = f'?registration={obj.id}&registration_period={status.registration_period.id}'
-            html.append(format_html(
-                '{period}: <a href="{href}"><b>{amount}</b></a>',
-                period=status.registration_period.period.name,
-                href=reverse('admin:leprikon_coursediscount_changelist') + query,
-                amount=currency(status.status.discount),
-            ) + format_html(
-                '<a class="popup-link" href="{href}" style="background-position: 0 0" title="{title}">'
-                '<img src="{icon}" alt="+"/></a>',
-                href=reverse('admin:leprikon_coursediscount_add') + query,
-                title=_('add discount'),
-                icon=static('admin/img/icon-addlink.svg'),
-            ))
-        return '<br/>'.join(html)
-    course_discounts.allow_tags = True
-    course_discounts.short_description = _('course discounts')
+            query = f"?registration={obj.id}&registration_period={status.registration_period.id}"
+            html.append(
+                format_html(
+                    '{period}: <a href="{href}"><b>{amount}</b></a>',
+                    period=status.registration_period.period.name,
+                    href=reverse("admin:leprikon_coursediscount_changelist") + query,
+                    amount=currency(status.status.discount),
+                )
+                + format_html(
+                    '<a class="popup-link" href="{href}" style="background-position: 0 0" title="{title}">'
+                    '<img src="{icon}" alt="+"/></a>',
+                    href=reverse("admin:leprikon_coursediscount_add") + query,
+                    title=_("add discount"),
+                    icon=static("admin/img/icon-addlink.svg"),
+                )
+            )
+        return mark_safe("<br/>".join(html))
+
+    @attributes(short_description=_("total price"))
+    def total_price(self, obj: CourseRegistration):
+        html = []
+        for status in obj.period_payment_statuses:
+            html.append(
+                format_html(
+                    "{period}: <b>{amount}</b>",
+                    period=status.registration_period.period.name,
+                    amount=currency(status.status.receivable),
+                )
+            )
+        return mark_safe("<br/>".join(html))
 
-    def course_payments(self, obj):
+    @attributes(short_description=_("received payments"))
+    def received_payments(self, obj: CourseRegistration):
         html = []
         for period in obj.period_payment_statuses:
-            html.append(format_html(
-                '{period}: <a class="popup-link" style="color: {color}" href="{href}" title="{title}">'
-                '<b>{amount}</b></a>',
-                period=period.registration_period.period.name,
-                color=period.status.color,
-                href=reverse('admin:leprikon_subjectpayment_changelist') + '?registration={}'.format(obj.id),
-                title=period.status.title,
-                amount=currency(period.status.paid),
-            ) + format_html(
-                '<a class="popup-link" href="{href}" style="background-position: 0 0" title="{title}">'
-                '<img src="{icon}" alt="+"/></a>',
-                href=reverse('admin:leprikon_subjectpayment_add') + '?registration={}'.format(obj.id),
-                title=_('add payment'),
-                icon=static('admin/img/icon-addlink.svg'),
-            ))
-        return '<br/>'.join(html)
-    course_payments.allow_tags = True
-    course_payments.short_description = _('course payments')
+            html.append(
+                format_html(
+                    '{period}: <a style="color: {color}" href="{href}" title="{title}">' "<b>{amount}</b></a>",
+                    period=period.registration_period.period.name,
+                    color=period.status.color,
+                    href=reverse("admin:leprikon_subjectreceivedpayment_changelist") + f"?target_registration={obj.id}",
+                    title=period.status.title,
+                    amount=currency(period.status.received),
+                )
+                + format_html(
+                    '<a class="popup-link" href="{href}" style="background-position: 0 0" title="{title}">'
+                    '<img src="{icon}" alt="+"/></a>',
+                    href=reverse("admin:leprikon_subjectreceivedpayment_add") + f"?target_registration={obj.id}",
+                    title=_("add payment"),
+                    icon=static("admin/img/icon-addlink.svg"),
+                )
+            )
+        return mark_safe("<br/>".join(html))
+
+    @attributes(short_description=_("discounts"))
+    def discounts_export(self, obj: CourseRegistration):
+        return "\n".join(
+            f"{status.registration_period.period.name}: {currency(status.status.discount)}"
+            for status in obj.period_payment_statuses
+        )
+
+    @attributes(short_description=_("total price"))
+    def total_price_export(self, obj: CourseRegistration):
+        return "\n".join(
+            f"{status.registration_period.period.name}: {currency(status.status.receivable)}"
+            for status in obj.period_payment_statuses
+        )
+
+    @attributes(short_description=_("received payments"))
+    def received_payments_export(self, obj: CourseRegistration):
+        return "\n".join(
+            f"{status.registration_period.period.name}: {currency(status.status.received)}"
+            for status in obj.period_payment_statuses
+        )
 
 
 @admin.register(CourseDiscount)
-class CourseDiscountAdmin(PdfExportAdminMixin, SubjectPaymentBaseAdmin):
+class CourseDiscountAdmin(PdfExportAdminMixin, SubjectDiscountBaseAdmin):
+    actions = SubjectDiscountBaseAdmin.actions + PdfExportAdminMixin.actions
     form = CourseDiscountAdminForm
-    list_display = ('accounted', 'registration', 'subject', 'period', 'amount_html', 'explanation')
-    list_export = ('accounted', 'registration', 'subject', 'period', 'amount', 'explanation')
-    closed_fields = ('accounted', 'registration', 'period', 'amount')
+    list_display = ("accounted", "registration", "subject", "period", "amount_html", "explanation")
+    list_export = ("accounted", "registration", "subject", "period", "amount", "explanation")
+    closed_fields = ("accounted", "registration", "period", "amount")
```

### Comparing `leprikon-3.0.0/leprikon/admin/events.py` & `leprikon-3.5.0/leprikon/admin/events.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,210 +1,233 @@
 from django import forms
 from django.contrib import admin
 from django.contrib.admin.widgets import AdminRadioSelect
 from django.contrib.auth import get_user_model
-from django.contrib.staticfiles.templatetags.staticfiles import static
 from django.shortcuts import render
+from django.templatetags.static import static
 from django.urls import reverse
 from django.utils.html import format_html
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
 from ..models.events import Event, EventDiscount, EventRegistration
 from ..models.schoolyear import SchoolYear
 from ..models.subjects import SubjectType
-from ..utils import currency
+from ..utils import attributes, currency
 from .pdf import PdfExportAdminMixin
-from .subjects import (
-    SubjectBaseAdmin, SubjectPaymentBaseAdmin, SubjectRegistrationBaseAdmin,
-)
+from .subjects import SubjectBaseAdmin, SubjectDiscountBaseAdmin, SubjectRegistrationBaseAdmin
 
 
 @admin.register(Event)
 class EventAdmin(SubjectBaseAdmin):
     subject_type_type = SubjectType.EVENT
     registration_model = EventRegistration
+    actions = SubjectBaseAdmin.actions + (
+        "publish",
+        "unpublish",
+        "copy_to_school_year",
+    )
     list_display = (
-        'id', 'code', 'name', 'subject_type', 'get_groups_list', 'get_leaders_list',
-        'event_date',
-        'place', 'public', 'registration_allowed_icon',
-        'get_registrations_link',
-        'get_journal_link', 'icon', 'note',
+        "id",
+        "code",
+        "name",
+        "subject_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_times_list",
+        "event_date",
+        "place",
+        "public",
+        "registration_allowed_icon",
+        "get_registrations_link",
+        "journals_link",
+        "icon",
+        "note",
     )
     list_export = (
-        'id', 'school_year', 'code', 'name', 'department', 'subject_type', 'registration_type',
-        'get_groups_list', 'get_leaders_list', 'get_age_groups_list', 'get_target_groups_list',
-        'start_date', 'start_time', 'end_date', 'end_time',
-        'place', 'public', 'price',
-        'min_participants_count', 'max_participants_count', 'min_group_members_count', 'max_group_members_count',
-        'min_registrations_count', 'max_registrations_count',
-        'get_approved_registrations_count', 'get_unapproved_registrations_count', 'note',
-    )
-    date_hierarchy = 'start_date'
-    actions = (
-        'publish', 'unpublish',
-        'copy_to_school_year',
+        "id",
+        "school_year",
+        "code",
+        "name",
+        "department",
+        "subject_type",
+        "registration_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_age_groups_list",
+        "get_target_groups_list",
+        "get_times_list",
+        "start_date",
+        "start_time",
+        "end_date",
+        "end_time",
+        "place",
+        "public",
+        "min_registrations_count",
+        "max_registrations_count",
+        "get_approved_registrations_count",
+        "get_unapproved_registrations_count",
+        "note",
     )
+    date_hierarchy = "start_date"
 
+    @attributes(short_description=_("Publish selected events"))
     def publish(self, request, queryset):
-        Event.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=True)
-        self.message_user(request, _('Selected events were published.'))
-    publish.short_description = _('Publish selected events')
+        Event.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=True)
+        self.message_user(request, _("Selected events were published."))
 
+    @attributes(short_description=_("Unpublish selected events"))
     def unpublish(self, request, queryset):
-        Event.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=False)
-        self.message_user(request, _('Selected events were unpublished.'))
-    unpublish.short_description = _('Unpublish selected events')
+        Event.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=False)
+        self.message_user(request, _("Selected events were unpublished."))
 
+    @attributes(short_description=_("Copy selected events to another school year"))
     def copy_to_school_year(self, request, queryset):
         class SchoolYearForm(forms.Form):
             school_year = forms.ModelChoiceField(
-                label=_('Target school year'),
-                help_text=_('All selected events will be copied to selected school year.'),
+                label=_("Target school year"),
+                help_text=_("All selected events will be copied to selected school year."),
                 queryset=SchoolYear.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = SchoolYearForm(request.POST)
             if form.is_valid():
-                school_year = form.cleaned_data['school_year']
+                school_year = form.cleaned_data["school_year"]
                 for event in queryset.all():
                     event.copy_to_school_year(school_year)
-                self.message_user(request, _('Selected events were copied to school year {}.').format(school_year))
+                self.message_user(request, _("Selected events were copied to school year {}.").format(school_year))
                 return
         else:
             form = SchoolYearForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Select target school year'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='copy_to_school_year',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    copy_to_school_year.short_description = _('Copy selected events to another school year')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Select target school year"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="copy_to_school_year",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
     def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(
-            leprikon_registrations__subject__in=queryset,
-        ).distinct()
+        return (
+            get_user_model()
+            .objects.filter(
+                leprikon_registrations__canceled=None,
+                leprikon_registrations__subject__in=queryset,
+            )
+            .distinct()
+        )
 
 
 @admin.register(EventRegistration)
 class EventRegistrationAdmin(PdfExportAdminMixin, SubjectRegistrationBaseAdmin):
     subject_type_type = SubjectType.EVENT
-    actions = ('add_discounts',)
-    list_display = (
-        'variable_symbol', 'download_tag', 'subject_name', 'participants_list_html', 'price',
-        'event_discounts', 'event_payments',
-        'created_with_by', 'approved_with_by', 'payment_requested_with_by',
-        'cancelation_requested_with_by', 'canceled_with_by',
-        'note', 'random_number',
-    )
+    actions = SubjectRegistrationBaseAdmin.actions + PdfExportAdminMixin.actions + ("add_discounts",)
 
+    @attributes(short_description=_("Add discounts to selected registrations"))
     def add_discounts(self, request, queryset):
-        ABSOLUTE = 'A'
-        RELATIVE = 'R'
+        ABSOLUTE = "A"
+        RELATIVE = "R"
 
         class DiscountForm(forms.Form):
             discount_type = forms.ChoiceField(
-                label=_('Discount type'),
-                choices=(
-                    (ABSOLUTE, _('absolute amount')),
-                    (RELATIVE, _('relative amount in percents'))
-                ),
+                label=_("Discount type"),
+                choices=((ABSOLUTE, _("absolute amount")), (RELATIVE, _("relative amount in percents"))),
                 widget=AdminRadioSelect(),
             )
-            amount = forms.DecimalField(label=_('Amount or number of percents'))
-            explanation = EventDiscount._meta.get_field('explanation').formfield()
+            amount = forms.DecimalField(label=_("Amount or number of percents"))
+            explanation = EventDiscount._meta.get_field("explanation").formfield()
 
-        if request.POST.get('post', 'no') == 'yes':
+        if request.POST.get("post", "no") == "yes":
             form = DiscountForm(request.POST)
             if form.is_valid():
                 EventDiscount.objects.bulk_create(
                     EventDiscount(
                         registration=registration,
                         amount=(
-                            form.cleaned_data['amount']
-                            if form.cleaned_data['discount_type'] == ABSOLUTE
-                            else (
-                                registration.price - sum(
-                                    discount.amount
-                                    for discount in registration.all_discounts
-                                )
-                            ) * form.cleaned_data['amount'] / 100
+                            form.cleaned_data["amount"]
+                            if form.cleaned_data["discount_type"] == ABSOLUTE
+                            else (registration.price - sum(discount.amount for discount in registration.all_discounts))
+                            * form.cleaned_data["amount"]
+                            / 100
                         ),
-                        explanation=form.cleaned_data['explanation'],
+                        explanation=form.cleaned_data["explanation"],
                     )
                     for registration in queryset.all()
                 )
-                self.message_user(request, _(
-                    'The discounts have been created for selected registrations.'
-                ))
+                self.message_user(request, _("The discounts have been created for selected registrations."))
                 return
         else:
             form = DiscountForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Add discounts'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='add_discounts',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    add_discounts.short_description = _('Add discounts to selected registrations')
-
-    def event_discounts(self, obj):
-        return format_html(
-            '<a href="{href_list}"><b>{amount}</b></a>'
-            ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
-            '<img src="{icon_add}" alt="+"/></a>',
-            href_list=reverse('admin:leprikon_eventdiscount_changelist') + '?registration={}'.format(obj.id),
-            amount=currency(obj.payment_status.discount),
-            href_add=reverse('admin:leprikon_eventdiscount_add') + '?registration={}'.format(obj.id),
-            icon_add=static('admin/img/icon-addlink.svg'),
-            title_add=_('add discount'),
-        )
-    event_discounts.allow_tags = True
-    event_discounts.short_description = _('event discounts')
-
-    def event_payments(self, obj):
-        return format_html(
-            '<a class="popup-link" style="color: {color}" href="{href_list}" title="{title}"><b>{amount}</b></a>'
-            ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
-            '<img src="{icon_add}" alt="+"/></a>',
-            color=obj.payment_status.color,
-            href_list=reverse('admin:leprikon_subjectpayment_changelist') + '?registration={}'.format(obj.id),
-            title=obj.payment_status.title,
-            amount=currency(obj.payment_status.paid),
-            href_add=reverse('admin:leprikon_subjectpayment_add') + '?registration={}'.format(obj.id),
-            icon_add=static('admin/img/icon-addlink.svg'),
-            title_add=_('add payment'),
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Add discounts"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="add_discounts",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
+
+    @attributes(short_description=_("discounts"))
+    def discounts(self, obj: EventRegistration):
+        return mark_safe(
+            format_html(
+                '<a href="{href_list}"><b>{amount}</b></a>'
+                ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
+                '<img src="{icon_add}" alt="+"/></a>',
+                href_list=reverse("admin:leprikon_eventdiscount_changelist") + f"?registration={obj.id}",
+                amount=currency(obj.payment_status.discount),
+                href_add=reverse("admin:leprikon_eventdiscount_add") + f"?registration={obj.id}",
+                icon_add=static("admin/img/icon-addlink.svg"),
+                title_add=_("add discount"),
+            )
         )
-    event_payments.allow_tags = True
-    event_payments.short_description = _('event payments')
+
+    @attributes(short_description=_("discounts"))
+    def discounts_export(self, obj: EventRegistration):
+        return currency(obj.payment_status.discount)
+
+    @attributes(short_description=_("total price"))
+    def total_price_export(self, obj: EventRegistration):
+        return currency(obj.payment_status.receivable)
+
+    @attributes(short_description=_("received payments"))
+    def received_payments_export(self, obj: EventRegistration):
+        return currency(obj.payment_status.received)
 
 
 @admin.register(EventDiscount)
-class EventDiscountAdmin(PdfExportAdminMixin, SubjectPaymentBaseAdmin):
-    list_display = ('accounted', 'registration', 'subject', 'amount_html', 'explanation')
-    list_export = ('accounted', 'registration', 'subject', 'amount', 'explanation')
+class EventDiscountAdmin(PdfExportAdminMixin, SubjectDiscountBaseAdmin):
+    actions = SubjectDiscountBaseAdmin.actions + PdfExportAdminMixin.actions
+    list_display = ("accounted", "registration", "subject", "amount_html", "explanation")
+    list_export = ("accounted", "registration", "subject", "amount", "explanation")
```

### Comparing `leprikon-3.0.0/leprikon/admin/export.py` & `leprikon-3.5.0/leprikon/admin/export.py`

 * *Files 14% similar despite different names*

```diff
@@ -2,110 +2,116 @@
 from datetime import datetime
 from functools import partial
 
 import django_excel
 from django.core.exceptions import FieldDoesNotExist
 from django.db.models import F
 from django.http import HttpResponse
-from django.utils.encoding import force_text
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
+
+from ..utils import attributes
 
 
 def get_attr_value(obj, name):
     value = getattr(obj, name)
     if callable(value):
         value = value()
     return value
 
 
-def get_verbose_name(field):
+def get_verbose_name(field) -> str:
     try:
-        return force_text(field.verbose_name)
+        return str(field.verbose_name)
     except AttributeError:
-        return force_text(field.related_model._meta.verbose_name)
+        return str(field.related_model._meta.verbose_name)
 
 
 class AdminExportMixin:
-    actions = ('export_as_xlsx', 'export_as_csv')
+    actions = ("export_as_xlsx", "export_as_csv")
 
     def get_list_export(self, request):
         try:
             return self.list_export
         except AttributeError:
             return self.list_display
 
     def get_export_fields(self, request):
         fields = []
         for name in self.get_list_export(request):
             try:
-                names = name.split('__')
+                names = name.split("__")
                 field = self.model._meta.get_field(names[0])
                 verbose_names = [get_verbose_name(field)]
                 for n in names[1:]:
                     field = field.related_model._meta.get_field(n)
                     verbose_names.append(get_verbose_name(field))
-                fields.append({
-                    'annotate': name if len(names) > 1 else None,
-                    'verbose_name': ' / '.join(verbose_names),
-                    'get_value': partial(lambda name, obj: get_attr_value(obj, name), name),
-                })
+                fields.append(
+                    {
+                        "annotate": name if len(names) > 1 else None,
+                        "verbose_name": " / ".join(verbose_names),
+                        "get_value": partial(lambda name, obj: get_attr_value(obj, name), name),
+                    }
+                )
             except (AttributeError, FieldDoesNotExist):
                 if callable(name):
-                    fields.append({
-                        'verbose_name': getattr(name, 'short_description', name.__func__.__name__),
-                        'get_value': partial(lambda name, obj: name(obj), name),
-                    })
+                    fields.append(
+                        {
+                            "verbose_name": getattr(name, "short_description", name.__func__.__name__),
+                            "get_value": partial(lambda name, obj: name(obj), name),
+                        }
+                    )
                 elif hasattr(self, name):
                     attr = getattr(self, name)
-                    fields.append({
-                        'verbose_name': getattr(attr, 'short_description', name),
-                        'get_value': partial(lambda attr, obj: attr(obj), attr),
-                    })
+                    fields.append(
+                        {
+                            "verbose_name": getattr(attr, "short_description", name),
+                            "get_value": partial(lambda attr, obj: attr(obj), attr),
+                        }
+                    )
                 elif hasattr(self.model, name):
                     attr = getattr(self.model, name)
-                    fields.append({
-                        'verbose_name': getattr(attr, 'short_description', name),
-                        'get_value': partial(lambda name, obj: get_attr_value(obj, name), name),
-                    })
+                    fields.append(
+                        {
+                            "verbose_name": getattr(attr, "short_description", name),
+                            "get_value": partial(lambda name, obj: get_attr_value(obj, name), name),
+                        }
+                    )
                 else:
                     raise Exception('Can not resolve name "{}"'.format(name))
         return fields
 
     def get_export_data(self, request, queryset):
         fields = self.get_export_fields(request)
-        yield [force_text(f['verbose_name']) for f in fields]
-        annotations = {
-            field['annotate']: F(field['annotate'])
-            for field in fields if field.get('annotate')
-        }
+        yield [str(f["verbose_name"]) for f in fields]
+        annotations = {field["annotate"]: F(field["annotate"]) for field in fields if field.get("annotate")}
         for obj in queryset.annotate(**annotations):
             values = []
             for field in fields:
-                value = field['get_value'](obj)
+                value = field["get_value"](obj)
                 if value is None:
-                    value = ''
+                    value = ""
                 if isinstance(value, datetime):
                     value = value.replace(tzinfo=None)
                 else:
                     # what can not be converted to float, must be converted to string
                     try:
                         float(value)
                     except (TypeError, ValueError):
-                        value = force_text(value)
+                        value = str(value)
                 values.append(value)
             yield values
 
+    @attributes(short_description=_("Export selected records as CSV"))
     def export_as_csv(self, request, queryset):
-        response = HttpResponse(content_type='text/csv')
-        response['Content-Disposition'] = 'attachment; filename="{}.csv"'.format(self.model._meta.model_name)
+        response = HttpResponse(content_type="text/csv")
+        response["Content-Disposition"] = 'attachment; filename="{}.csv"'.format(self.model._meta.model_name)
         data = self.get_export_data(request, queryset)
         # write data to response (use all to evaluate the map generator)
         csv.writer(response).writerows(data)
         return response
-    export_as_csv.short_description = _('Export selected records as CSV')
 
+    @attributes(short_description=_("Export selected records as XLSX"))
     def export_as_xlsx(self, request, queryset):
         data = self.get_export_data(request, queryset)
-        response = django_excel.make_response(django_excel.pe.Sheet(data), 'xlsx')
-        response['Content-Disposition'] = 'attachment; filename="{}.xlsx"'.format(self.model._meta.model_name)
+        response = django_excel.make_response(django_excel.pe.Sheet(data), "xlsx")
+        response["Content-Disposition"] = 'attachment; filename="{}.xlsx"'.format(self.model._meta.model_name)
         return response
-    export_as_xlsx.short_description = _('Export selected records as XLSX')
```

### Comparing `leprikon-3.0.0/leprikon/admin/filters.py` & `leprikon-3.5.0/leprikon/admin/filters.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,201 +1,223 @@
 from django.contrib import admin
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
+from ..models.journals import Journal
 from ..models.roles import Leader
 from ..models.schoolyear import SchoolYear
 from ..models.subjects import Subject, SubjectGroup, SubjectType
 
 
 class SchoolYearListFilter(admin.FieldListFilter):
     def __init__(self, field, request, params, model, model_admin, field_path):
         try:
-            request.school_year = SchoolYear.objects.get(year=params['year'])
+            request.school_year = SchoolYear.objects.get(year=params["year"])
         except (SchoolYear.DoesNotExist, ValueError, KeyError):
             pass
         self.school_year = request.school_year
-        super(SchoolYearListFilter, self).__init__(field, request, params, model, model_admin, field_path)
+        super().__init__(field, request, params, model, model_admin, field_path)
 
     def expected_parameters(self):
-        return ['year']
+        return ["year"]
 
     def choices(self, cl):
         return [
             {
-                'selected': school_year == self.school_year,
-                'query_string': cl.get_query_string({'year': school_year.year}),
-                'display': school_year,
+                "selected": school_year == self.school_year,
+                "query_string": cl.get_query_string({"year": school_year.year}),
+                "display": school_year,
             }
             for school_year in SchoolYear.objects.all()
         ]
 
     def queryset(self, request, queryset):
         return queryset.filter(**{self.field_path: self.school_year})
 
 
 class ActiveListFilter(admin.SimpleListFilter):
-    title = _('status')
-    parameter_name = 'status'
+    title = _("status")
+    parameter_name = "status"
 
     def lookups(self, request, model_admin):
         return (
-            (None, _('active')),
-            ('inactive', _('inactive')),
+            (None, _("active")),
+            ("inactive", _("inactive")),
         )
 
     def queryset(self, request, queryset):
-        if self.value() == 'inactive':
+        if self.value() == "inactive":
             return queryset.filter(active=False)
         else:
             return queryset.filter(active=True)
 
     def choices(self, cl):
         value = self.value()
         return [
             {
-                'selected': value != 'inactive',
-                'query_string': cl.get_query_string({}, [self.parameter_name]),
-                'display': _('active'),
+                "selected": value != "inactive",
+                "query_string": cl.get_query_string({}, [self.parameter_name]),
+                "display": _("active"),
             },
             {
-                'selected': value == 'inactive',
-                'query_string': cl.get_query_string({self.parameter_name: 'inactive'}),
-                'display': _('inactive'),
+                "selected": value == "inactive",
+                "query_string": cl.get_query_string({self.parameter_name: "inactive"}),
+                "display": _("inactive"),
             },
         ]
 
 
 class ApprovedListFilter(admin.SimpleListFilter):
-    title = _('approval')
-    parameter_name = 'approved'
+    title = _("approval")
+    parameter_name = "approved"
 
     def lookups(self, request, model_admin):
         return (
-            ('yes', _('approved')),
-            ('no', _('unapproved')),
+            ("yes", _("approved")),
+            ("no", _("unapproved")),
         )
 
     def queryset(self, request, queryset):
-        if self.value() == 'yes':
+        if self.value() == "yes":
             return queryset.filter(approved__isnull=False)
-        if self.value() == 'no':
+        if self.value() == "no":
             return queryset.filter(approved__isnull=True)
 
 
 class CanceledListFilter(admin.SimpleListFilter):
-    title = _('cancelation')
-    parameter_name = 'canceled'
+    title = _("cancelation")
+    parameter_name = "canceled"
 
     def lookups(self, request, model_admin):
         return (
-            (None, _('not canceled')),
-            ('yes', _('canceled')),
+            (None, _("not canceled")),
+            ("yes", _("canceled")),
         )
 
     def queryset(self, request, queryset):
-        if self.value() == 'yes':
+        if self.value() == "yes":
             return queryset.filter(canceled__isnull=False)
         else:
             return queryset.filter(canceled__isnull=True)
 
     def choices(self, cl):
         value = self.value()
         return [
             {
-                'selected': value != 'yes',
-                'query_string': cl.get_query_string({}, [self.parameter_name]),
-                'display': _('active'),
+                "selected": value != "yes",
+                "query_string": cl.get_query_string({}, [self.parameter_name]),
+                "display": _("active"),
             },
             {
-                'selected': value == 'yes',
-                'query_string': cl.get_query_string({self.parameter_name: 'yes'}),
-                'display': _('canceled'),
+                "selected": value == "yes",
+                "query_string": cl.get_query_string({self.parameter_name: "yes"}),
+                "display": _("canceled"),
             },
         ]
 
 
 class SubjectTypeListFilter(admin.RelatedFieldListFilter):
     def __init__(self, field, request, params, model, model_admin, field_path):
         self.subject_types = SubjectType.objects.all()
-        subject_type_type = getattr(model_admin, 'subject_type_type', None)
+        subject_type_type = getattr(model_admin, "subject_type_type", None)
         if subject_type_type:
             self.subject_types = self.subject_types.filter(subject_type=subject_type_type)
-        super(SubjectTypeListFilter, self).__init__(field, request, params, model, model_admin, field_path)
+        super().__init__(field, request, params, model, model_admin, field_path)
         if subject_type_type:
             self.title = SubjectType.subject_type_type_labels[subject_type_type]
         request.leprikon_subject_type_id = self.lookup_val
 
     def field_choices(self, field, request, model_admin):
         return [(t.id, t.plural) for t in self.subject_types.all()]
 
 
 class SubjectGroupListFilter(admin.RelatedFieldListFilter):
     def __init__(self, field, request, params, model, model_admin, field_path):
-        subject_type_type = getattr(model_admin, 'subject_type_type', None)
-        if hasattr(request, 'leprikon_subject_type_id') and request.leprikon_subject_type_id:
+        subject_type_type = getattr(model_admin, "subject_type_type", None)
+        if hasattr(request, "leprikon_subject_type_id") and request.leprikon_subject_type_id:
             self.groups = SubjectGroup.objects.filter(subject_types__id=request.leprikon_subject_type_id)
         elif subject_type_type:
             self.groups = SubjectGroup.objects.filter(subject_types__subject_type=subject_type_type)
         else:
             self.groups = SubjectGroup.objects.all()
-        super(SubjectGroupListFilter, self).__init__(field, request, params, model, model_admin, field_path)
+        super().__init__(field, request, params, model, model_admin, field_path)
         request.leprikon_subject_group_id = self.lookup_val
 
     def field_choices(self, field, request, model_admin):
         return [(g.id, g.plural) for g in self.groups.distinct()]
 
 
 class SubjectListFilter(admin.RelatedFieldListFilter):
     model = Subject
 
     def __init__(self, field, request, params, model, model_admin, field_path):
         self.subjects = self.model.objects.filter(school_year=request.school_year)
-        subject_type_type = getattr(model_admin, 'subject_type_type', None)
-        if hasattr(request, 'leprikon_subject_type_id') and request.leprikon_subject_type_id:
+        subject_type_type = getattr(model_admin, "subject_type_type", None)
+        if hasattr(request, "leprikon_subject_type_id") and request.leprikon_subject_type_id:
             self.subjects = self.subjects.filter(subject_type__id=request.leprikon_subject_type_id)
         elif subject_type_type:
             self.subjects = self.subjects.filter(subject_type__subject_type=subject_type_type)
-        if hasattr(request, 'leprikon_subject_group_id') and request.leprikon_subject_group_id:
+        if hasattr(request, "leprikon_subject_group_id") and request.leprikon_subject_group_id:
             self.subjects = self.subjects.filter(subject_group__id=request.leprikon_subject_group_id)
-        super(SubjectListFilter, self).__init__(field, request, params, model, model_admin, field_path)
+        super().__init__(field, request, params, model, model_admin, field_path)
         if subject_type_type:
             self.title = SubjectType.subject_type_labels[subject_type_type]
 
     def field_choices(self, field, request, model_admin):
         return [(s.id, s.name) for s in self.subjects]
 
 
+class JournalListFilter(admin.RelatedFieldListFilter):
+    model = Journal
+
+    def __init__(self, field, request, params, model, model_admin, field_path):
+        self.journals = (
+            self.model.objects.filter(subject__school_year=request.school_year)
+            .select_related("subject")
+            .order_by("subject__name", "name")
+        )
+        if hasattr(request, "leprikon_subject_id") and request.leprikon_subject_id:
+            self.journals = self.journals.filter(subject_id=request.leprikon_subject_id)
+        elif hasattr(request, "leprikon_subject_type_id") and request.leprikon_subject_type_id:
+            self.journals = self.journals.filter(subject__subject_type__id=request.leprikon_subject_type_id)
+        super().__init__(field, request, params, model, model_admin, field_path)
+
+    def field_choices(self, field, request, model_admin):
+        return [(journal.id, str(journal)) for journal in self.journals]
+
+
 class LeaderListFilter(admin.RelatedFieldListFilter):
     def __init__(self, field, request, params, model, model_admin, field_path):
         self.leaders = Leader.objects.filter(school_years=request.school_year)
-        super(LeaderListFilter, self).__init__(field, request, params, model, model_admin, field_path)
+        super().__init__(field, request, params, model, model_admin, field_path)
 
     def field_choices(self, field, request, model_admin):
         return [(leader.id, leader) for leader in self.leaders]
 
 
 class IsNullFieldListFilter(admin.FieldListFilter):
     def __init__(self, field, request, params, model, model_admin, field_path):
-        self.lookup_kwarg = '%s__isnull' % field_path
+        self.lookup_kwarg = "%s__isnull" % field_path
         self.lookup_val = request.GET.get(self.lookup_kwarg)
-        if not hasattr(field, 'verbose_name') and hasattr(field, 'related_model'):
+        if not hasattr(field, "verbose_name") and hasattr(field, "related_model"):
             field.verbose_name = field.related_model._meta.verbose_name
         super().__init__(field, request, params, model, model_admin, field_path)
-        if (self.used_parameters and self.lookup_kwarg in self.used_parameters and
-                self.used_parameters[self.lookup_kwarg] in ('1', '0')):
+        if (
+            self.used_parameters
+            and self.lookup_kwarg in self.used_parameters
+            and self.used_parameters[self.lookup_kwarg] in ("1", "0")
+        ):
             self.used_parameters[self.lookup_kwarg] = bool(int(self.used_parameters[self.lookup_kwarg]))
 
     def expected_parameters(self):
         return [self.lookup_kwarg]
 
     def choices(self, changelist):
-        for lookup, title in (
-                (None, _('All')),
-                ('0', _('Set')),
-                ('1', _('Not set'))):
+        for lookup, title in ((None, _("All")), ("0", _("Set")), ("1", _("Not set"))):
             yield {
-                'selected': self.lookup_val == lookup,
-                'query_string': changelist.get_query_string({
-                    self.lookup_kwarg: lookup,
-                }),
-                'display': title,
+                "selected": self.lookup_val == lookup,
+                "query_string": changelist.get_query_string(
+                    {
+                        self.lookup_kwarg: lookup,
+                    }
+                ),
+                "display": title,
             }
```

### Comparing `leprikon-3.0.0/leprikon/admin/journals.py` & `leprikon-3.5.0/leprikon/admin/timesheets.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,117 +1,126 @@
+from adminsortable2.admin import SortableAdminMixin
 from django import forms
 from django.contrib import admin
 from django.urls import reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
-from ..forms.journals import JournalEntryAdminForm, JournalLeaderEntryAdminForm
-from ..models.journals import JournalEntry, JournalLeaderEntry
+from ..forms.timesheets import TimesheetEntryAdminForm
+from ..models.timesheets import Timesheet, TimesheetEntry, TimesheetEntryType
+from ..utils import attributes
 from .export import AdminExportMixin
-from .filters import LeaderListFilter, SchoolYearListFilter, SubjectListFilter
+from .filters import LeaderListFilter
+from .journals import JournalLeaderEntryInlineAdmin
 
 
-@admin.register(JournalLeaderEntry)
-class JournalLeaderEntryAdmin(AdminExportMixin, admin.ModelAdmin):
-    form = JournalLeaderEntryAdminForm
-    list_display = ('timesheet', 'date', 'start', 'end', 'duration', 'subject')
-    list_filter = (('timesheet__leader', LeaderListFilter),)
-    ordering = ('-journal_entry__date', '-start')
+@admin.register(TimesheetEntry)
+class TimesheetEntryAdmin(AdminExportMixin, admin.ModelAdmin):
+    form = TimesheetEntryAdminForm
+    date_hierarchy = "date"
+    list_display = ("timesheet", "date", "start", "end", "duration", "entry_type")
+    list_filter = ("entry_type", ("timesheet__leader", LeaderListFilter))
+    ordering = (
+        "-date",
+        "-start",
+    )
+
+    def get_readonly_fields(self, request, obj=None):
+        if obj and obj.timesheet.submitted:
+            return ("timesheet", "entry_type", "date", "start", "end")
+        return ()
 
-    def has_add_permission(self, request):
+    def has_add_permission(self, request, obj=None):
         return False
 
     def has_delete_permission(self, request, obj=None):
         if obj and obj.timesheet.submitted:
             return False
-        return super(JournalLeaderEntryAdmin, self).has_delete_permission(request, obj)
+        return super().has_delete_permission(request, obj)
 
-    def get_readonly_fields(self, request, obj=None):
-        if obj and obj.timesheet.submitted:
-            return ('start', 'end')
-        return self.readonly_fields
 
-
-class JournalLeaderEntryInlineAdmin(admin.TabularInline):
+class TimesheetEntryInlineAdmin(admin.TabularInline):
     class form(forms.ModelForm):
         class Meta:
-            model = JournalLeaderEntry
+            model = TimesheetEntry
             fields = []
-    model = JournalLeaderEntry
-    ordering = ('journal_entry__date', 'start')
-    readonly_fields = ('date', 'start', 'end', 'edit_link')
 
-    def has_add_permission(self, request):
+    model = TimesheetEntry
+    ordering = ("date", "start")
+    readonly_fields = ("date", "start", "end", "entry_type", "description_html", "edit_link")
+
+    def has_add_permission(self, request, obj=None):
         return False
 
     def has_delete_permission(self, request, obj=None):
-        if obj:
-            # obj may be Timesheet or JournalEntry
-            # this inline is used in both JournalEntryAdmin and TimesheetAdmin
-            try:
-                entries = obj.leader_entries
-            except AttributeError:
-                entries = obj.journal_entries
-            if entries.filter(timesheet__submitted=True).exists():
-                return False
-        return super(JournalLeaderEntryInlineAdmin, self).has_delete_permission(request, obj)
+        if obj and obj.submitted:
+            return False
+        return super().has_delete_permission(request, obj)
 
+    @attributes(admin_order_field="description", short_description=_("description"))
+    def description_html(self, obj):
+        return mark_safe(obj.description)
+
+    @attributes(short_description="")
     def edit_link(self, obj):
-        return '<a href="{url}" title="{title}" target="_blank">{edit}</a>'.format(
-            url=reverse('admin:leprikon_journalleaderentry_change', args=[obj.id]),
-            title=_('update entry'),
-            edit=_('edit'),
+        return mark_safe(
+            '<a href="{url}" title="{title}" target="_blank">{edit}</a>'.format(
+                url=reverse("admin:leprikon_timesheetentry_change", args=[obj.id]),
+                title=_("update entry"),
+                edit=_("edit"),
+            )
         )
-    edit_link.short_description = ''
-    edit_link.allow_tags = True
 
 
-@admin.register(JournalEntry)
-class JournalEntryAdmin(AdminExportMixin, admin.ModelAdmin):
-    form = JournalEntryAdminForm
-    date_hierarchy = 'date'
-    list_display = ('id', 'subject_name', 'date', 'start', 'end', 'duration', 'agenda_html')
-    list_filter = (
-        ('subject__school_year', SchoolYearListFilter),
-        ('subject', SubjectListFilter),
-    )
-    filter_horizontal = ('participants',)
-    inlines = (JournalLeaderEntryInlineAdmin,)
-    ordering = ('-date', '-start')
-    readonly_fields = ('subject_name', 'date',)
-
-    def has_add_permission(self, request):
+@admin.register(Timesheet)
+class TimesheetAdmin(AdminExportMixin, admin.ModelAdmin):
+    list_display = ("leader", "period", "group_durations", "submitted", "paid")
+    list_filter = (("leader", LeaderListFilter), "period")
+    inlines = (TimesheetEntryInlineAdmin, JournalLeaderEntryInlineAdmin)
+    actions = AdminExportMixin.actions + ("submit", "set_paid")
+
+    # do not allow to add timesheets in admin
+    # timesheets are created automatically
+    def has_add_permission(self, request, obj=None):
         return False
 
+    # do not allow to delete submitted timesheets
     def has_delete_permission(self, request, obj=None):
-        if obj:
-            if obj.affects_submitted_timesheets:
-                return False
-            else:
-                return super().has_delete_permission(request, obj)
-        return False
+        return super().has_delete_permission(request, obj) and (obj is None or not obj.submitted)
 
     def get_actions(self, request):
         actions = super().get_actions(request)
-        if 'delete_selected' in actions:
+        if "delete_selected" in actions:
+
             def delete_selected(model_admin, request, queryset):
-                objs = [
-                    journal_entry
-                    for journal_entry in queryset.all()
-                    if not journal_entry.affects_submitted_timesheets
-                ]
-                return admin.actions.delete_selected(model_admin, request, objs)
-            actions['delete_selected'] = (
-                delete_selected,
-                *actions['delete_selected'][1:]
-            )
+                queryset = queryset.filter(submitted=False)
+                return admin.actions.delete_selected(model_admin, request, queryset)
+
+            actions["delete_selected"] = (delete_selected, *actions["delete_selected"][1:])
         return actions
 
-    def subject_name(self, obj):
-        return obj.subject.name
-    subject_name.short_description = _('subject')
-    subject_name.admin_order_field = 'subject__name'
-
-    def agenda_html(self, obj):
-        return obj.agenda
-    agenda_html.short_description = _('agenda')
-    agenda_html.admin_order_field = 'agenda'
-    agenda_html.allow_tags = True
+    @attributes(short_description=_("group durations"))
+    def group_durations(self, obj):
+        return mark_safe(
+            "<br/>".join(
+                "<b>{name}</b>: {duration}".format(
+                    name=group.name,
+                    duration=group.duration,
+                )
+                for group in obj.groups
+            )
+        )
+
+    @attributes(short_description=_("Mark selected timesheets as paid"))
+    def set_paid(self, request, queryset):
+        queryset.update(submitted=True, paid=True)
+        self.message_user(request, _("Selected timesheets where marked as paid."))
+
+    @attributes(short_description=_("Submit selected timesheets"))
+    def submit(self, request, queryset):
+        queryset.update(submitted=True)
+        self.message_user(request, _("Selected timesheets where submitted."))
+
+
+@admin.register(TimesheetEntryType)
+class TimesheetEntryTypeAdmin(SortableAdminMixin, admin.ModelAdmin):
+    list_display = ("name",)
```

### Comparing `leprikon-3.0.0/leprikon/admin/leprikonsite.py` & `leprikon-3.5.0/leprikon/admin/leprikonsite.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,21 +1,27 @@
+from django.conf import settings
 from django.contrib import admin
+from django.http import HttpRequest, HttpResponseRedirect
+from django.shortcuts import redirect
 
 from ..models.leprikonsite import LeprikonSite
 
 
 @admin.register(LeprikonSite)
 class LeprikonSiteAdmin(admin.ModelAdmin):
-    list_display = ('name',)
-    filter_horizontal = ('registration_agreements',)
+    list_display = ("name",)
+    filter_horizontal = ("registration_agreements",)
 
-    def has_add_permission(self, request):
+    def changelist_view(self, request: HttpRequest, extra_context=None) -> HttpResponseRedirect:
+        return redirect("admin:leprikon_leprikonsite_change", object_id=settings.SITE_ID)
+
+    def has_add_permission(self, request, obj=None):
         return False
 
     def has_delete_permission(self, request, obj=None):
         return False
 
     def get_actions(self, request):
-        actions = super(LeprikonSiteAdmin, self).get_actions(request)
-        if 'delete_selected' in actions:
-            del(actions['delete_selected'])
+        actions = super().get_actions(request)
+        if "delete_selected" in actions:
+            del actions["delete_selected"]
         return actions
```

### Comparing `leprikon-3.0.0/leprikon/admin/messages.py` & `leprikon-3.5.0/leprikon/admin/messages.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,201 +1,206 @@
 from django import forms
-from django.conf.urls import url
 from django.contrib import admin
 from django.db import transaction
-from django.http import (
-    HttpResponse, HttpResponseBadRequest, HttpResponseRedirect,
-)
+from django.http import HttpResponse, HttpResponseBadRequest, HttpResponseRedirect
 from django.shortcuts import get_object_or_404, render
-from django.urls import reverse
-from django.utils.translation import ugettext_lazy as _
+from django.urls import path, reverse
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.messages import MessageAdminForm
 from ..models.messages import Message, MessageAttachment, MessageRecipient
+from ..utils import attributes
 
 
 def messagerecipient_send_mails(request, message, recipients, media):
     return render(
         request,
-        'admin/leprikon/messagerecipient/send_mails.html',
+        "admin/leprikon/messagerecipient/send_mails.html",
         {
-            'title': _('Sending emails'),
-            'message': message,
-            'recipients': recipients,
-            'media': media,
-            'message_opts': Message._meta,
-            'opts': MessageRecipient._meta,
+            "title": _("Sending emails"),
+            "message": message,
+            "recipients": recipients,
+            "media": media,
+            "message_opts": Message._meta,
+            "opts": MessageRecipient._meta,
         },
     )
 
 
-class SendMessageAdminMixin(object):
-    actions = ('send_message', 'add_to_message')
+class SendMessageAdminMixin:
+    actions = ("send_message", "add_to_message")
 
     def get_message_recipients(self, request, queryset):
-        raise NotImplementedError('{} must implement method get_message_recipients'.format(self.__class__.__name__))
+        raise NotImplementedError("{} must implement method get_message_recipients".format(self.__class__.__name__))
 
+    @attributes(short_description=_("Send message"))
     def send_message(self, request, queryset):
-        request.method = 'GET'
+        request.method = "GET"
         request.leprikon_message_recipients = [r.id for r in self.get_message_recipients(request, queryset)]
-        return admin.site._registry[Message].changeform_view(request, form_url=reverse('admin:leprikon_message_add'))
-    send_message.short_description = _('Send message')
+        return admin.site._registry[Message].changeform_view(request, form_url=reverse("admin:leprikon_message_add"))
 
+    @attributes(short_description=_("Add recipients to existing message"))
     def add_to_message(self, request, queryset):
-
         class MessageForm(forms.Form):
             message = forms.ModelChoiceField(
-                label=_('Target message'),
-                help_text=_('Recipients will be added to selected message.'),
+                label=_("Target message"),
+                help_text=_("Recipients will be added to selected message."),
                 queryset=Message.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = MessageForm(request.POST)
             if form.is_valid():
-                message = form.cleaned_data['message']
+                message = form.cleaned_data["message"]
                 for recipient in self.get_message_recipients(request, queryset):
                     MessageRecipient.objects.get_or_create(message=message, recipient=recipient)
                 return HttpResponseRedirect(
-                    reverse('admin:leprikon_messagerecipient_changelist') + '?message={}'.format(message.id)
+                    reverse("admin:leprikon_messagerecipient_changelist") + "?message={}".format(message.id)
                 )
         else:
             form = MessageForm()
         return render(
             request,
-            'admin/leprikon/message/add_recipients.html',
+            "admin/leprikon/message/add_recipients.html",
             {
-                'title': _('Select target message'),
-                'queryset': queryset,
-                'opts': self.model._meta,
-                'form': form,
-                'action_checkbox_name': admin.helpers.ACTION_CHECKBOX_NAME,
+                "title": _("Select target message"),
+                "queryset": queryset,
+                "opts": self.model._meta,
+                "form": form,
+                "action_checkbox_name": admin.helpers.ACTION_CHECKBOX_NAME,
             },
         )
-    add_to_message.short_description = _('Add recipients to existing message')
 
 
 class MessageAttachmentInlineAdmin(admin.TabularInline):
     model = MessageAttachment
     extra = 0
 
 
 @admin.register(Message)
 class MessageAdmin(admin.ModelAdmin):
     form = MessageAdminForm
     inlines = (MessageAttachmentInlineAdmin,)
-    list_display = ('subject', 'created', 'recipients', 'action_links')
-    search_fields = ('subject', 'text')
+    list_display = ("subject", "created", "recipients", "action_links")
+    search_fields = ("subject", "text")
 
     def get_changeform_initial_data(self, request):
-        initial = super(MessageAdmin, self).get_changeform_initial_data(request)
+        initial = super().get_changeform_initial_data(request)
         try:
-            initial['recipients'] = request.leprikon_message_recipients
+            initial["recipients"] = request.leprikon_message_recipients
         except Exception:
             pass
         return initial
 
+    @attributes(short_description=_("recipients"))
     def recipients(self, obj):
-        return (
-            '<a href="{recipients_url}">'
-            '    <span title="{all_title}">{all_count}</span>'
-            '  / <span title="{mails_title}">{mails_count}</span>'
-            '  / <span title="{viewed_title}">{viewed_count}</span>'
-            '</a> '
-        ).format(
-            recipients_url=reverse('admin:leprikon_messagerecipient_changelist') + '?message={}'.format(obj.id),
-            all_title=_('recipients count'),
-            mails_title=_('sent mail'),
-            viewed_title=_('viewed on site'),
-            all_count=obj.recipients.count(),
-            mails_count=obj.recipients.exclude(sent_mail=None).count(),
-            viewed_count=obj.recipients.exclude(viewed=None).count(),
+        return mark_safe(
+            (
+                '<a href="{recipients_url}">'
+                '    <span title="{all_title}">{all_count}</span>'
+                '  / <span title="{mails_title}">{mails_count}</span>'
+                '  / <span title="{viewed_title}">{viewed_count}</span>'
+                "</a> "
+            ).format(
+                recipients_url=reverse("admin:leprikon_messagerecipient_changelist") + "?message={}".format(obj.id),
+                all_title=_("recipients count"),
+                mails_title=_("sent mail"),
+                viewed_title=_("viewed on site"),
+                all_count=obj.recipients.count(),
+                mails_count=obj.recipients.exclude(sent_mail=None).count(),
+                viewed_count=obj.recipients.exclude(viewed=None).count(),
+            )
         )
-    recipients.allow_tags = True
-    recipients.short_description = _('recipients')
 
+    @attributes(short_description=_("actions"))
     def action_links(self, obj):
-        return (
-            '<a href="{recipients_url}" class="button" title="{recipients_title}">{recipients}</a> '
-            '<a href="{send_mails_all_url}" class="button" title="{send_mails_all_title}">{send_mails_all}</a> '
-            '<a href="{send_mails_new_url}" class="button" title="{send_mails_new_title}">{send_mails_new}</a> '
-        ).format(
-            recipients=_('recipients'),
-            recipients_title=_('show recipients details'),
-            recipients_url=(reverse('admin:leprikon_messagerecipient_changelist') + '?message={}'.format(obj.id)),
-            send_mails_all=_('send mails'),
-            send_mails_all_title=_('send mail to all recipients'),
-            send_mails_all_url=reverse('admin:leprikon_message_send_mails') + '?message={}'.format(obj.id),
-            send_mails_new=_('send unsent'),
-            send_mails_new_title=_('send mails to new recipients only'),
-            send_mails_new_url=reverse('admin:leprikon_message_send_mails') + '?message={}&new=1'.format(obj.id),
+        return mark_safe(
+            (
+                '<a href="{recipients_url}" class="button" title="{recipients_title}">{recipients}</a> '
+                '<a href="{send_mails_all_url}" class="button" title="{send_mails_all_title}">{send_mails_all}</a> '
+                '<a href="{send_mails_new_url}" class="button" title="{send_mails_new_title}">{send_mails_new}</a> '
+            ).format(
+                recipients=_("recipients"),
+                recipients_title=_("show recipients details"),
+                recipients_url=(reverse("admin:leprikon_messagerecipient_changelist") + "?message={}".format(obj.id)),
+                send_mails_all=_("send mails"),
+                send_mails_all_title=_("send mail to all recipients"),
+                send_mails_all_url=reverse("admin:leprikon_message_send_mails") + "?message={}".format(obj.id),
+                send_mails_new=_("send unsent"),
+                send_mails_new_title=_("send mails to new recipients only"),
+                send_mails_new_url=reverse("admin:leprikon_message_send_mails") + "?message={}&new=1".format(obj.id),
+            )
         )
-    action_links.allow_tags = True
-    action_links.short_description = _('actions')
 
     def get_urls(self):
         return [
-            url(r'^send-mails/$', self.admin_site.admin_view(self.send_mails), name='leprikon_message_send_mails'),
-        ] + super(MessageAdmin, self).get_urls()
+            path("send-mails/", self.admin_site.admin_view(self.send_mails), name="leprikon_message_send_mails"),
+        ] + super().get_urls()
 
     def send_mails(self, request):
         try:
-            message_id = int(request.GET['message'])
+            message_id = int(request.GET["message"])
         except (KeyError, ValueError):
             return HttpResponseBadRequest()
         message = get_object_or_404(Message, id=message_id)
         recipients = message.recipients.all()
-        if request.GET.get('new', False):
+        if request.GET.get("new", False):
             recipients = recipients.filter(sent_mail=None)
         return messagerecipient_send_mails(request, message, recipients, self.media)
 
 
 @admin.register(MessageRecipient)
 class MessageRecipientAdmin(admin.ModelAdmin):
-    list_display = ('recipient', 'sent', 'viewed', 'sent_mail')
-    actions = ('send_mails',)
+    list_display = ("recipient", "sent", "viewed", "sent_mail")
+    actions = ("send_mails",)
 
     # hide the model from admin index
     def get_model_perms(self, request):
         return {}
 
-    def has_add_permission(self, request):
+    def has_add_permission(self, request, obj=None):
         return False
 
     def has_delete_permission(self, request, obj=None):
         return False
 
+    @attributes(short_description=_("Send email to selected recipients"))
     def send_mails(self, request, queryset):
         return messagerecipient_send_mails(
             request,
-            message=get_object_or_404(Message, id=request.GET.get('message', 0)),
+            message=get_object_or_404(Message, id=request.GET.get("message", 0)),
             recipients=queryset,
             media=self.media,
         )
-    send_mails.short_description = _('Send email to selected recipients')
 
     def changelist_view(self, request, extra_context=None):
-        message = get_object_or_404(Message, id=request.GET.get('message', 0))
+        message = get_object_or_404(Message, id=request.GET.get("message", 0))
         if extra_context is None:
             extra_context = {}
-        extra_context.update({
-            'title': _('Recipients of message {}').format(message.subject),
-            'message': message,
-            'message_opts': Message._meta,
-        })
-        return super(MessageRecipientAdmin, self).changelist_view(request, extra_context)
+        extra_context.update(
+            {
+                "title": _("Recipients of message {}").format(message.subject),
+                "message": message,
+                "message_opts": Message._meta,
+            }
+        )
+        return super().changelist_view(request, extra_context)
 
     def get_urls(self):
-        return [url(
-            r'^send-mail/$',
-            self.admin_site.admin_view(self.send_mail),
-            name='leprikon_messagerecipient_send_mail',
-        )] + super(MessageRecipientAdmin, self).get_urls()
+        return [
+            path(
+                "send-mail/",
+                self.admin_site.admin_view(self.send_mail),
+                name="leprikon_messagerecipient_send_mail",
+            )
+        ] + super().get_urls()
 
     @transaction.atomic
     def send_mail(self, request):
         try:
-            recipient_id = int(request.GET['recipient_id'])
+            recipient_id = int(request.GET["recipient_id"])
         except (KeyError, ValueError):
             return HttpResponseBadRequest()
         recipient = get_object_or_404(MessageRecipient, id=recipient_id)
         recipient.send_mail()
-        return HttpResponse('0', content_type="text/json")
+        return HttpResponse("0", content_type="text/json")
```

### Comparing `leprikon-3.0.0/leprikon/admin/orderables.py` & `leprikon-3.5.0/leprikon/admin/orderables.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,213 +1,253 @@
 from django import forms
 from django.contrib import admin
 from django.contrib.admin.widgets import AdminRadioSelect
 from django.contrib.auth import get_user_model
-from django.contrib.staticfiles.templatetags.staticfiles import static
 from django.shortcuts import render
+from django.templatetags.static import static
 from django.urls import reverse
 from django.utils.html import format_html
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
-from ..models.orderables import (
-    Orderable, OrderableDiscount, OrderableRegistration,
-)
+from ..models.orderables import Orderable, OrderableDiscount, OrderableRegistration
 from ..models.schoolyear import SchoolYear
 from ..models.subjects import SubjectType
-from ..utils import currency
+from ..utils import attributes, currency
 from .pdf import PdfExportAdminMixin
-from .subjects import (
-    SubjectBaseAdmin, SubjectPaymentBaseAdmin, SubjectRegistrationBaseAdmin,
-)
+from .subjects import SubjectBaseAdmin, SubjectDiscountBaseAdmin, SubjectRegistrationBaseAdmin
 
 
 @admin.register(Orderable)
 class OrderableAdmin(SubjectBaseAdmin):
     subject_type_type = SubjectType.ORDERABLE
     registration_model = OrderableRegistration
     list_display = (
-        'id', 'code', 'name', 'subject_type', 'get_groups_list', 'get_leaders_list',
-        'duration',
-        'place', 'public', 'registration_allowed_icon',
-        'get_registrations_link',
-        'get_journal_link', 'icon', 'note',
+        "id",
+        "code",
+        "name",
+        "subject_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_times_list",
+        "duration",
+        "place",
+        "public",
+        "registration_allowed_icon",
+        "get_registrations_link",
+        "journals_link",
+        "icon",
+        "note",
     )
     list_export = (
-        'id', 'school_year', 'code', 'name', 'department', 'subject_type', 'registration_type',
-        'get_groups_list', 'get_leaders_list', 'get_age_groups_list', 'get_target_groups_list',
-        'place', 'public', 'price',
-        'min_participants_count', 'max_participants_count', 'min_group_members_count', 'max_group_members_count',
-        'min_registrations_count', 'max_registrations_count',
-        'get_approved_registrations_count', 'get_unapproved_registrations_count', 'note',
+        "id",
+        "school_year",
+        "code",
+        "name",
+        "department",
+        "subject_type",
+        "registration_type",
+        "get_groups_list",
+        "get_leaders_list",
+        "get_age_groups_list",
+        "get_target_groups_list",
+        "get_times_list",
+        "place",
+        "public",
+        "min_registrations_count",
+        "max_registrations_count",
+        "get_approved_registrations_count",
+        "get_unapproved_registrations_count",
+        "note",
     )
-    actions = (
-        'publish', 'unpublish',
-        'copy_to_school_year',
+    actions = SubjectBaseAdmin.actions + (
+        "publish",
+        "unpublish",
+        "copy_to_school_year",
     )
 
+    @attributes(short_description=_("Publish selected orderable events"))
     def publish(self, request, queryset):
-        Orderable.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=True)
-        self.message_user(request, _('Selected orderable events were published.'))
-    publish.short_description = _('Publish selected orderable events')
+        Orderable.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=True)
+        self.message_user(request, _("Selected orderable events were published."))
 
+    @attributes(short_description=_("Unpublish selected orderable events"))
     def unpublish(self, request, queryset):
-        Orderable.objects.filter(id__in=[reg['id'] for reg in queryset.values('id')]).update(public=False)
-        self.message_user(request, _('Selected orderable events were unpublished.'))
-    unpublish.short_description = _('Unpublish selected orderable events')
+        Orderable.objects.filter(id__in=[reg["id"] for reg in queryset.values("id")]).update(public=False)
+        self.message_user(request, _("Selected orderable events were unpublished."))
 
+    @attributes(short_description=_("Copy selected orderable events to another school year"))
     def copy_to_school_year(self, request, queryset):
         class SchoolYearForm(forms.Form):
             school_year = forms.ModelChoiceField(
-                label=_('Target school year'),
-                help_text=_('All selected orderable events will be copied to selected school year.'),
+                label=_("Target school year"),
+                help_text=_("All selected orderable events will be copied to selected school year."),
                 queryset=SchoolYear.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = SchoolYearForm(request.POST)
             if form.is_valid():
-                school_year = form.cleaned_data['school_year']
+                school_year = form.cleaned_data["school_year"]
                 for orderable in queryset.all():
                     orderable.copy_to_school_year(school_year)
                 self.message_user(
                     request,
-                    _('Selected orderable events were copied to school year {}.').format(school_year),
+                    _("Selected orderable events were copied to school year {}.").format(school_year),
                 )
                 return
         else:
             form = SchoolYearForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Select target school year'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='copy_to_school_year',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    copy_to_school_year.short_description = _('Copy selected orderable events to another school year')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Select target school year"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="copy_to_school_year",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
     def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(
-            leprikon_registrations__subject__in=queryset,
-        ).distinct()
+        return (
+            get_user_model()
+            .objects.filter(
+                leprikon_registrations__canceled=None,
+                leprikon_registrations__subject__in=queryset,
+            )
+            .distinct()
+        )
 
 
 @admin.register(OrderableRegistration)
 class OrderableRegistrationAdmin(PdfExportAdminMixin, SubjectRegistrationBaseAdmin):
     subject_type_type = SubjectType.ORDERABLE
-    actions = ('add_discounts',)
+    actions = SubjectRegistrationBaseAdmin.actions + PdfExportAdminMixin.actions + ("add_discounts",)
     list_display = (
-        'variable_symbol', 'download_tag', 'subject_name', 'event_date', 'participants_list_html', 'price',
-        'orderable_discounts', 'orderable_payments',
-        'created_with_by', 'approved_with_by', 'payment_requested_with_by',
-        'cancelation_requested_with_by', 'canceled_with_by',
-        'note', 'random_number',
+        SubjectRegistrationBaseAdmin.list_display[:3] + ("event_date",) + SubjectRegistrationBaseAdmin.list_display[3:]
     )
 
+    @attributes(short_description=_("Add discounts to selected registrations"))
     def add_discounts(self, request, queryset):
-        ABSOLUTE = 'A'
-        RELATIVE = 'R'
+        ABSOLUTE = "A"
+        RELATIVE = "R"
 
         class DiscountForm(forms.Form):
             discount_type = forms.ChoiceField(
-                label=_('Discount type'),
-                choices=(
-                    (ABSOLUTE, _('absolute amount')),
-                    (RELATIVE, _('relative amount in percents'))
-                ),
+                label=_("Discount type"),
+                choices=((ABSOLUTE, _("absolute amount")), (RELATIVE, _("relative amount in percents"))),
                 widget=AdminRadioSelect(),
             )
-            amount = forms.DecimalField(label=_('Amount or number of percents'))
-            explanation = OrderableDiscount._meta.get_field('explanation').formfield()
+            amount = forms.DecimalField(label=_("Amount or number of percents"))
+            explanation = OrderableDiscount._meta.get_field("explanation").formfield()
 
-        if request.POST.get('post', 'no') == 'yes':
+        if request.POST.get("post", "no") == "yes":
             form = DiscountForm(request.POST)
             if form.is_valid():
                 OrderableDiscount.objects.bulk_create(
                     OrderableDiscount(
                         registration=registration,
                         amount=(
-                            form.cleaned_data['amount']
-                            if form.cleaned_data['discount_type'] == ABSOLUTE
-                            else (
-                                registration.price - sum(
-                                    discount.amount
-                                    for discount in registration.all_discounts
-                                )
-                            ) * form.cleaned_data['amount'] / 100
+                            form.cleaned_data["amount"]
+                            if form.cleaned_data["discount_type"] == ABSOLUTE
+                            else (registration.price - sum(discount.amount for discount in registration.all_discounts))
+                            * form.cleaned_data["amount"]
+                            / 100
                         ),
-                        explanation=form.cleaned_data['explanation'],
+                        explanation=form.cleaned_data["explanation"],
                     )
                     for registration in queryset.all()
                 )
-                self.message_user(request, _(
-                    'The discounts have been created for selected registrations.'
-                ))
+                self.message_user(request, _("The discounts have been created for selected registrations."))
                 return
         else:
             form = DiscountForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Add discounts'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='add_discounts',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    add_discounts.short_description = _('Add discounts to selected registrations')
-
-    def orderable_discounts(self, obj):
-        return format_html(
-            '<a href="{href_list}"><b>{amount}</b></a>'
-            ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
-            '<img src="{icon_add}" alt="+"/></a>',
-            href_list=reverse('admin:leprikon_orderablediscount_changelist') + '?registration={}'.format(obj.id),
-            amount=currency(obj.payment_status.discount),
-            href_add=reverse('admin:leprikon_orderablediscount_add') + '?registration={}'.format(obj.id),
-            icon_add=static('admin/img/icon-addlink.svg'),
-            title_add=_('add discount'),
-        )
-    orderable_discounts.allow_tags = True
-    orderable_discounts.short_description = _('orderable event discounts')
-
-    def orderable_payments(self, obj):
-        return format_html(
-            '<a class="popup-link" style="color: {color}" href="{href_list}" title="{title}"><b>{amount}</b></a>'
-            ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
-            '<img src="{icon_add}" alt="+"/></a>',
-            color=obj.payment_status.color,
-            href_list=reverse('admin:leprikon_subjectpayment_changelist') + '?registration={}'.format(obj.id),
-            title=obj.payment_status.title,
-            amount=currency(obj.payment_status.paid),
-            href_add=reverse('admin:leprikon_subjectpayment_add') + '?registration={}'.format(obj.id),
-            icon_add=static('admin/img/icon-addlink.svg'),
-            title_add=_('add payment'),
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Add discounts"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="add_discounts",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
         )
-    orderable_payments.allow_tags = True
-    orderable_payments.short_description = _('orderable event payments')
+
+    @attributes(short_description=_("discounts"))
+    def discounts(self, obj: OrderableRegistration):
+        return mark_safe(
+            format_html(
+                '<a href="{href_list}"><b>{amount}</b></a>'
+                ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
+                '<img src="{icon_add}" alt="+"/></a>',
+                href_list=reverse("admin:leprikon_orderablediscount_changelist") + f"?registration={obj.id}",
+                amount=currency(obj.payment_status.discount),
+                href_add=reverse("admin:leprikon_orderablediscount_add") + f"?registration={obj.id}",
+                icon_add=static("admin/img/icon-addlink.svg"),
+                title_add=_("add discount"),
+            )
+        )
+
+    @attributes(short_description=_("received payments"))
+    def received_payments(self, obj: OrderableRegistration):
+        return mark_safe(
+            format_html(
+                '<a style="color: {color}" href="{href_list}" title="{title}"><b>{amount}</b></a>'
+                ' &nbsp; <a class="popup-link" href="{href_add}" style="background-position: 0 0" title="{title_add}">'
+                '<img src="{icon_add}" alt="+"/></a>',
+                color=obj.payment_status.color,
+                href_list=reverse("admin:leprikon_subjectreceivedpayment_changelist")
+                + "?target_registration={}".format(obj.id),
+                title=obj.payment_status.title,
+                amount=currency(obj.payment_status.received),
+                href_add=reverse("admin:leprikon_subjectreceivedpayment_add")
+                + "?target_registration={}".format(obj.id),
+                icon_add=static("admin/img/icon-addlink.svg"),
+                title_add=_("add payment"),
+            )
+        )
+
+    @attributes(short_description=_("discounts"))
+    def discounts_export(self, obj: OrderableRegistration):
+        return currency(obj.payment_status.discount)
+
+    @attributes(short_description=_("total price"))
+    def total_price_export(self, obj: OrderableRegistration):
+        return currency(obj.payment_status.receivable)
+
+    @attributes(short_description=_("received payments"))
+    def received_payments_export(self, obj: OrderableRegistration):
+        return currency(obj.payment_status.received)
 
 
 @admin.register(OrderableDiscount)
-class OrderableDiscountAdmin(PdfExportAdminMixin, SubjectPaymentBaseAdmin):
-    list_display = ('accounted', 'registration', 'subject', 'amount_html', 'explanation')
-    list_export = ('accounted', 'registration', 'subject', 'amount', 'explanation')
+class OrderableDiscountAdmin(PdfExportAdminMixin, SubjectDiscountBaseAdmin):
+    actions = SubjectDiscountBaseAdmin.actions + PdfExportAdminMixin.actions
+    list_display = ("accounted", "registration", "subject", "amount_html", "explanation")
+    list_export = ("accounted", "registration", "subject", "amount", "explanation")
```

### Comparing `leprikon-3.0.0/leprikon/admin/pdf.py` & `leprikon-3.5.0/leprikon/admin/pdf.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,62 +1,74 @@
 from io import BytesIO
 
-from django.conf.urls import url as urls_url
 from django.http import HttpResponse
-from django.urls import reverse
+from django.urls import path, reverse
+from django.utils.safestring import mark_safe
 from django.utils.text import slugify
-from django.utils.translation import ugettext_lazy as _
-from PyPDF2 import PdfFileReader, PdfFileWriter
+from django.utils.translation import gettext_lazy as _
+from pypdf import PdfReader, PdfWriter
+
+from ..utils import attributes
 
 
 class PdfExportAdminMixin:
-    actions = ('export_pdf',)
-    pdf_event = 'pdf'
+    actions = ("export_pdf",)
+    pdf_event = "pdf"
 
+    @attributes(short_description=_("Export selected items in single PDF"))
     def export_pdf(self, request, queryset):
         # create PDF
-        writer = PdfFileWriter()
+        writer = PdfWriter()
         for obj in queryset.iterator():
             pdf_data = BytesIO()
             obj.write_pdf(self.pdf_event, pdf_data)
             pdf_data.seek(0)
-            pdf = PdfFileReader(pdf_data)
-            for i in range(pdf.getNumPages()):
-                writer.addPage(pdf.getPage(i))
+            pdf = PdfReader(pdf_data)
+            for i in range(len(pdf.pages)):
+                writer.add_page(pdf.pages[i])
 
         # create PDF response object
-        response = HttpResponse(content_type='application/pdf')
-        response['Content-Disposition'] = 'attachment; filename="{}.pdf"'.format(
+        response = HttpResponse(content_type="application/pdf")
+        response["Content-Disposition"] = 'attachment; filename="{}.pdf"'.format(
             slugify(self.model._meta.verbose_name_plural),
         )
 
         # write PDF to response
         writer.write(response)
 
         return response
-    export_pdf.short_description = _('Export selected items in single PDF.')
 
     def get_urls(self):
-        urls = super(PdfExportAdminMixin, self).get_urls()
-        return [urls_url(
-            r'(?P<obj_id>\d+).pdf$',
-            self.admin_site.admin_view(self.pdf),
-            name='{}_{}_pdf'.format(self.model._meta.app_label, self.model._meta.model_name),
-        )] + urls
+        urls = super().get_urls()
+        return [
+            path(
+                "<int:obj_id>-<event>.pdf",
+                self.admin_site.admin_view(self.pdf),
+                name="{}_{}_event_pdf".format(self.model._meta.app_label, self.model._meta.model_name),
+            ),
+            path(
+                "<int:obj_id>.pdf",
+                self.admin_site.admin_view(self.pdf),
+                name="{}_{}_pdf".format(self.model._meta.app_label, self.model._meta.model_name),
+            ),
+        ] + urls
 
-    def pdf(self, request, obj_id):
+    def pdf(self, request, obj_id, event=pdf_event):
         obj = self.get_object(request, obj_id)
 
         # create PDF response object
-        response = HttpResponse(content_type='application/pdf')
-        response['Content-Disposition'] = 'attachment; filename="{}"'.format(obj.get_pdf_filename(self.pdf_event))
+        response = HttpResponse(content_type="application/pdf")
+        response["Content-Disposition"] = 'filename="{}"'.format(obj.get_pdf_filename(event))
 
         # write PDF to response
-        return obj.write_pdf(self.pdf_event, response)
+        return obj.write_pdf(event, response)
 
+    @attributes(short_description=_("download"))
     def download_tag(self, obj):
-        return '<a href="{}">PDF</a>'.format(reverse(
-            'admin:{}_{}_pdf'.format(self.model._meta.app_label, self.model._meta.model_name),
-            args=(obj.id,),
-        ))
-    download_tag.short_description = _('download')
-    download_tag.allow_tags = True
+        return mark_safe(
+            '<a href="{}">PDF</a>'.format(
+                reverse(
+                    "admin:{}_{}_pdf".format(self.model._meta.app_label, self.model._meta.model_name),
+                    args=(obj.id,),
+                )
+            )
+        )
```

### Comparing `leprikon-3.0.0/leprikon/admin/registrationlink.py` & `leprikon-3.5.0/leprikon/admin/registrationlink.py`

 * *Files 8% similar despite different names*

```diff
@@ -4,85 +4,95 @@
 from django.db import transaction
 from django.db.models import Count
 from django.db.utils import IntegrityError
 from django.http import HttpResponseRedirect
 from django.urls import reverse
 from django.utils.crypto import get_random_string
 from django.utils.html import format_html
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.registrationlink import RegistrationLinkAdminForm
 from ..models.courses import CourseRegistration
 from ..models.events import EventRegistration
 from ..models.orderables import OrderableRegistration
 from ..models.registrationlink import RegistrationLink
 from ..models.subjects import SubjectType
+from ..utils import attributes
 from .export import AdminExportMixin
 from .filters import SchoolYearListFilter, SubjectTypeListFilter
 
 
 @admin.register(RegistrationLink)
 class RegistrationLinkAdmin(AdminExportMixin, admin.ModelAdmin):
     _registration_models = {
         SubjectType.COURSE: CourseRegistration,
         SubjectType.EVENT: EventRegistration,
         SubjectType.ORDERABLE: OrderableRegistration,
     }
     list_display = (
-        'id', 'name', 'get_link', 'subject_type', 'reg_from', 'reg_to', 'get_registrations_link',
+        "id",
+        "name",
+        "get_link",
+        "subject_type",
+        "reg_from",
+        "reg_to",
+        "get_registrations_link",
     )
     list_filter = (
-        ('school_year', SchoolYearListFilter),
-        'subject_type__subject_type',
-        ('subject_type', SubjectTypeListFilter),
+        ("school_year", SchoolYearListFilter),
+        "subject_type__subject_type",
+        ("subject_type", SubjectTypeListFilter),
     )
-    filter_horizontal = ('subjects',)
+    filter_horizontal = ("subject_variants",)
 
-    def changeform_view(self, request, object_id=None, form_url='', extra_context=None):
-        if not object_id and request.method == 'POST' and len(request.POST) == 3:
-            return HttpResponseRedirect('{}?subject_type={}'.format(
-                request.path,
-                request.POST.get('subject_type', ''),
-            ))
+    def changeform_view(self, request, object_id=None, form_url="", extra_context=None):
+        if not object_id and request.method == "POST" and len(request.POST) == 3:
+            return HttpResponseRedirect(
+                "{}?subject_type={}".format(
+                    request.path,
+                    request.POST.get("subject_type", ""),
+                )
+            )
         else:
             return super().changeform_view(request, object_id, form_url, extra_context)
 
     def get_form(self, request, obj, **kwargs):
         # set school year
         if obj:
             request.school_year = obj.school_year
 
         # get subject type
         try:
             # first try request.POST (user may want to change subject type)
-            request.subject_type = SubjectType.objects.get(id=int(request.POST.get('subject_type')))
+            request.subject_type = SubjectType.objects.get(id=int(request.POST.get("subject_type")))
         except (SubjectType.DoesNotExist, TypeError, ValueError):
             if obj:
                 # use subject type from object
                 request.subject_type = obj.subject_type
             else:
                 # try to get subject type from request.GET
                 try:
                     request.subject_type = SubjectType.objects.get(
-                        id=int(request.GET.get('subject_type')),
+                        id=int(request.GET.get("subject_type")),
                     )
                 except (SubjectType.DoesNotExist, TypeError, ValueError):
                     request.subject_type = None
 
         if request.subject_type:
-            kwargs['form'] = type(
+            kwargs["form"] = type(
                 RegistrationLinkAdminForm.__name__,
-                (RegistrationLinkAdminForm, ),
+                (RegistrationLinkAdminForm,),
                 {
-                    'school_year': request.school_year,
-                    'subject_type': request.subject_type,
+                    "school_year": request.school_year,
+                    "subject_type": request.subject_type,
                 },
             )
         else:
-            kwargs['fields'] = ['subject_type']
+            kwargs["fields"] = ["subject_type"]
 
         return super().get_form(request, obj, **kwargs)
 
     def save_form(self, request, form, change):
         obj = super().save_form(request, form, change)
         obj.school_year = request.school_year
         return obj
@@ -96,34 +106,40 @@
                 try:
                     with transaction.atomic():
                         obj.slug = get_random_string(64, ascii_letters + digits)
                         obj.save()
                 except IntegrityError:
                     pass
 
+    @attributes(short_description=_("registration link"))
     def get_link(self, obj):
-        return '<a href="{url}" title="{title}" target="_blank">{url}</a>'.format(
-            url=obj.link,
-            title=_('registration link'),
+        return mark_safe(
+            '<a href="{url}" title="{title}" target="_blank">{url}</a>'.format(
+                url=obj.link,
+                title=_("registration link"),
+            )
         )
-    get_link.short_description = _('registration link')
-    get_link.allow_tags = True
 
     def get_queryset(self, request):
         return (
             super()
-            .get_queryset(request).select_related('subject_type')
-            .annotate(registrations_count=Count('registrations'))
+            .get_queryset(request)
+            .select_related("subject_type")
+            .annotate(registrations_count=Count("registrations"))
         )
 
+    @attributes(short_description=_("registrations"))
     def get_registrations_link(self, obj):
         registration_model = self._registration_models[obj.subject_type.subject_type]
-        return format_html(
-            '<a href="{url}">{count}</a>',
-            url=reverse('admin:{}_{}_changelist'.format(
-                registration_model._meta.app_label,
-                registration_model._meta.model_name,
-            )) + '?registration_link__id__exact={}'.format(obj.id),
-            count=obj.registrations_count,
+        return mark_safe(
+            format_html(
+                '<a href="{url}">{count}</a>',
+                url=reverse(
+                    "admin:{}_{}_changelist".format(
+                        registration_model._meta.app_label,
+                        registration_model._meta.model_name,
+                    )
+                )
+                + "?registration_link__id__exact={}".format(obj.id),
+                count=obj.registrations_count,
+            )
         )
-    get_registrations_link.short_description = _('registrations')
-    get_registrations_link.allow_tags = True
```

### Comparing `leprikon-3.0.0/leprikon/admin/roles.py` & `leprikon-3.5.0/leprikon/admin/roles.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,152 +1,182 @@
+from adminsortable2.admin import SortableInlineAdminMixin
 from django import forms
 from django.contrib import admin
 from django.contrib.auth import get_user_model
 from django.shortcuts import render
 from django.urls import reverse
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 
 from ..models.roles import Contact, Leader
 from ..models.schoolyear import SchoolYear
 from ..models.subjects import SubjectType
+from ..utils import attributes
 from .export import AdminExportMixin
 from .filters import SchoolYearListFilter
 from .messages import SendMessageAdminMixin
 
 
-class ContactInlineAdmin(admin.TabularInline):
+class ContactInlineAdmin(SortableInlineAdminMixin, admin.TabularInline):
     model = Contact
     extra = 0
 
 
 @admin.register(Leader)
 class LeaderAdmin(AdminExportMixin, SendMessageAdminMixin, admin.ModelAdmin):
-    filter_horizontal = ('school_years',)
+    actions = SendMessageAdminMixin.actions + AdminExportMixin.actions + ("add_school_year",)
+    filter_horizontal = ("school_years",)
     inlines = (ContactInlineAdmin,)
-    search_fields = ('user__first_name', 'user__last_name', 'contacts__contact')
-    list_display = ('id', 'first_name', 'last_name', 'email', 'courses_link',
-                    'events_link', 'orderables_link', 'contacts', 'user_link', 'icon')
-    list_export = ('id', 'user__first_name', 'user__last_name', 'user__email',
-                   'contacts__contact_type', 'contacts__contact', 'contacts__public')
-    ordering = ('user__first_name', 'user__last_name')
-    actions = ('add_school_year',)
-    list_filter = (('school_years', SchoolYearListFilter),)
-    raw_id_fields = ('user',)
+    search_fields = ("user__first_name", "user__last_name", "contacts__contact")
+    list_display = (
+        "id",
+        "first_name",
+        "last_name",
+        "email",
+        "courses_link",
+        "events_link",
+        "orderables_link",
+        "contacts",
+        "user_link",
+        "icon",
+    )
+    list_export = (
+        "id",
+        "user__first_name",
+        "user__last_name",
+        "user__email",
+        "contacts__contact_type",
+        "contacts__contact",
+        "contacts__public",
+    )
+    ordering = ("user__first_name", "user__last_name")
+    list_filter = (("school_years", SchoolYearListFilter),)
+    raw_id_fields = ("user",)
 
+    @attributes(short_description=_("Add selected leaders to another school year"))
     def add_school_year(self, request, queryset):
-
         class SchoolYearForm(forms.Form):
             school_year = forms.ModelChoiceField(
-                label=_('Target school year'),
-                help_text=_('All selected leaders will be added to selected school year.'),
+                label=_("Target school year"),
+                help_text=_("All selected leaders will be added to selected school year."),
                 queryset=SchoolYear.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = SchoolYearForm(request.POST)
             if form.is_valid():
-                school_year = form.cleaned_data['school_year']
+                school_year = form.cleaned_data["school_year"]
                 for leader in queryset.all():
                     leader.school_years.add(school_year)
-                self.message_user(request, _('Selected leaders were added to school year {}.').format(school_year))
+                self.message_user(request, _("Selected leaders were added to school year {}.").format(school_year))
                 return
         else:
             form = SchoolYearForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Select target school year'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='add_school_year',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    add_school_year.short_description = _('Add selected leaders to another school year')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Select target school year"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="add_school_year",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
+    @attributes(admin_order_field="user__first_name", short_description=_("first name"))
     def first_name(self, obj):
         return obj.user.first_name
-    first_name.short_description = _('first name')
-    first_name.admin_order_field = 'user__first_name'
 
+    @attributes(admin_order_field="user__last_name", short_description=_("last name"))
     def last_name(self, obj):
         return obj.user.last_name
-    last_name.short_description = _('last name')
-    last_name.admin_order_field = 'user__last_name'
 
+    @attributes(admin_order_field="user__email", short_description=_("email"))
     def email(self, obj):
         return obj.user.email
-    email.short_description = _('email')
-    email.admin_order_field = 'user__email'
 
+    @attributes(short_description=_("contacts"))
     def contacts(self, obj):
-        return ', '.join(c.contact for c in obj.all_contacts)
-    contacts.short_description = _('contacts')
+        return ", ".join(c.contact for c in obj.all_contacts)
 
+    @attributes(short_description=_("user"))
     def user_link(self, obj):
-        return '<a href="{url}">{user}</a>'.format(
-            url=reverse(f'admin:{obj.user._meta.app_label}_{obj.user._meta.model_name}_change', args=(obj.user.id,)),
-            user=obj.user,
+        return mark_safe(
+            '<a href="{url}">{user}</a>'.format(
+                url=reverse(
+                    f"admin:{obj.user._meta.app_label}_{obj.user._meta.model_name}_change", args=(obj.user.id,)
+                ),
+                user=obj.user,
+            )
         )
-    user_link.allow_tags = True
-    user_link.short_description = _('user')
 
     @cached_property
     def courses_url(self):
-        return reverse('admin:leprikon_course_changelist')
+        return reverse("admin:leprikon_course_changelist")
 
     @cached_property
     def events_url(self):
-        return reverse('admin:leprikon_event_changelist')
+        return reverse("admin:leprikon_event_changelist")
 
     @cached_property
     def orderables_url(self):
-        return reverse('admin:leprikon_orderable_changelist')
+        return reverse("admin:leprikon_orderable_changelist")
 
+    @attributes(short_description=_("courses"))
     def courses_link(self, obj):
-        return '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
-            url=self.courses_url,
-            leader=obj.id,
-            count=obj.subjects.filter(subject_type__subject_type=SubjectType.COURSE).count(),
+        return mark_safe(
+            '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
+                url=self.courses_url,
+                leader=obj.id,
+                count=obj.subjects.filter(subject_type__subject_type=SubjectType.COURSE).count(),
+            )
         )
-    courses_link.allow_tags = True
-    courses_link.short_description = _('courses')
 
+    @attributes(short_description=_("events"))
     def events_link(self, obj):
-        return '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
-            url=self.events_url,
-            leader=obj.id,
-            count=obj.subjects.filter(subject_type__subject_type=SubjectType.EVENT).count(),
+        return mark_safe(
+            '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
+                url=self.events_url,
+                leader=obj.id,
+                count=obj.subjects.filter(subject_type__subject_type=SubjectType.EVENT).count(),
+            )
         )
-    events_link.allow_tags = True
-    events_link.short_description = _('events')
 
+    @attributes(short_description=_("orderable events"))
     def orderables_link(self, obj):
-        return '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
-            url=self.orderables_url,
-            leader=obj.id,
-            count=obj.subjects.filter(subject_type__subject_type=SubjectType.EVENT).count(),
+        return mark_safe(
+            '<a href="{url}?leaders__id={leader}">{count}</a>'.format(
+                url=self.orderables_url,
+                leader=obj.id,
+                count=obj.subjects.filter(subject_type__subject_type=SubjectType.ORDERABLE).count(),
+            )
         )
-    orderables_link.allow_tags = True
-    orderables_link.short_description = _('orderable events')
 
+    @attributes(short_description=_("photo"))
     def icon(self, obj):
         try:
-            return '<img src="{}" alt="{}"/>'.format(obj.photo.icons['48'], obj.photo.label)
+            return mark_safe('<img src="{}" alt="{}"/>'.format(obj.photo.icons["48"], obj.photo.label))
         except (AttributeError, KeyError):
-            return ''
-    icon.allow_tags = True
-    icon.short_description = _('photo')
+            return ""
 
     def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(
-            leprikon_leader__in=queryset,
-        ).distinct()
+        return (
+            get_user_model()
+            .objects.filter(
+                leprikon_leader__in=queryset,
+            )
+            .distinct()
+        )
```

### Comparing `leprikon-3.0.0/leprikon/admin/schoolyear.py` & `leprikon-3.5.0/leprikon/admin/schoolyear.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,91 +1,96 @@
+from adminsortable2.admin import SortableInlineAdminMixin
 from django import forms
 from django.contrib import admin
 from django.db import IntegrityError
 from django.shortcuts import render
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from ..models.schoolyear import (
-    SchoolYear, SchoolYearDivision, SchoolYearPeriod,
-)
+from ..models.schoolyear import SchoolYear, SchoolYearDivision, SchoolYearPeriod
+from ..utils import attributes
 from .filters import SchoolYearListFilter
 
 
 @admin.register(SchoolYear)
 class SchoolYearAdmin(admin.ModelAdmin):
-    list_display = ('name', 'active')
-    list_editable = ('active',)
+    list_display = ("name", "active")
+    list_editable = ("active",)
 
     # do not allow to delete entries in admin
     def has_delete_permission(self, request, obj=None):
         return False
 
     def get_readonly_fields(self, request, obj=None):
-        return obj and ('year',) or ()
+        return obj and ("year",) or ()
 
     def get_actions(self, request):
         actions = super().get_actions(request)
-        if 'delete_selected' in actions:
-            del(actions['delete_selected'])
+        if "delete_selected" in actions:
+            del actions["delete_selected"]
         return actions
 
 
-class SchoolYearPeriodInlineAdmin(admin.TabularInline):
+class SchoolYearPeriodInlineAdmin(SortableInlineAdminMixin, admin.TabularInline):
     model = SchoolYearPeriod
     extra = 0
     min_num = 1
 
 
 @admin.register(SchoolYearDivision)
 class SchoolYearDivisionAdmin(admin.ModelAdmin):
-    actions = ('copy_to_school_year',)
+    actions = ("copy_to_school_year",)
     inlines = (SchoolYearPeriodInlineAdmin,)
-    list_display = ('name',)
-    list_filter = (('school_year', SchoolYearListFilter),)
+    list_display = ("name",)
+    list_filter = (("school_year", SchoolYearListFilter),)
 
+    @attributes(short_description=_("Copy selected school year divisions to another school year"))
     def copy_to_school_year(self, request, queryset):
         class SchoolYearForm(forms.Form):
             school_year = forms.ModelChoiceField(
-                label=_('Target school year'),
-                help_text=_('All selected school year divisions will be copied to selected school year.'),
+                label=_("Target school year"),
+                help_text=_("All selected school year divisions will be copied to selected school year."),
                 queryset=SchoolYear.objects.all(),
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = SchoolYearForm(request.POST)
             if form.is_valid():
-                school_year = form.cleaned_data['school_year']
+                school_year = form.cleaned_data["school_year"]
                 for school_year_division in queryset.all():
                     try:
                         school_year_division.copy_to_school_year(school_year)
                     except IntegrityError:
                         # division already exists for target year
                         pass
                 self.message_user(
                     request,
-                    _('Selected school year divisions were copied to school year {}.').format(school_year),
+                    _("Selected school year divisions were copied to school year {}.").format(school_year),
                 )
                 return
         else:
             form = SchoolYearForm()
 
         adminform = admin.helpers.AdminForm(
             form,
-            [(None, {'fields': list(form.base_fields)})],
+            [(None, {"fields": list(form.base_fields)})],
             {},
             None,
             model_admin=self,
         )
 
-        return render(request, 'leprikon/admin/action_form.html', dict(
-            title=_('Select target school year'),
-            opts=self.model._meta,
-            adminform=adminform,
-            media=self.media + adminform.media,
-            action='copy_to_school_year',
-            action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
-            select_across=request.POST['select_across'],
-            selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
-        ))
-    copy_to_school_year.short_description = _('Copy selected school year divisions to another school year')
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Select target school year"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="copy_to_school_year",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
 
     def get_readonly_fields(self, request, obj=None):
-        return ('school_year',) if obj else ()
+        return ("school_year",) if obj else ()
```

### Comparing `leprikon-3.0.0/leprikon/admin/subjects.py` & `leprikon-3.5.0/leprikon/forms/subjects.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,900 +1,1003 @@
-from bankreader.models import Transaction as BankreaderTransaction
+from datetime import date
+from json import dumps
+
 from django import forms
-from django.conf.urls import url as urls_url
-from django.contrib import admin, messages
-from django.contrib.admin.templatetags.admin_list import _boolean_icon
-from django.contrib.admin.utils import unquote
 from django.contrib.auth import get_user_model
-from django.contrib.auth.decorators import permission_required
-from django.contrib.staticfiles.templatetags.staticfiles import static
 from django.core.exceptions import ValidationError
-from django.db.models import BooleanField, Func
-from django.db.models.expressions import Random
-from django.http import (
-    HttpResponse, HttpResponseBadRequest, HttpResponseRedirect, JsonResponse,
-)
-from django.shortcuts import get_object_or_404, render
-from django.urls import reverse
-from django.utils.formats import date_format
-from django.utils.html import format_html
-from django.utils.safestring import mark_safe
-from django.utils.timezone import localtime
-from django.utils.translation import ugettext_lazy as _
-
-from ..forms.subjects import (
-    RegistrationAdminForm, RegistrationGroupAdminForm,
-    RegistrationParticipantAdminForm, SubjectAdminForm,
-)
+from django.db import transaction
+from django.db.models import Q
+from django.forms.models import inlineformset_factory
+from django.forms.widgets import Media
+from django.utils.functional import cached_property
+from django.utils.timezone import now
+from django.utils.translation import gettext_lazy as _
+from sentry_sdk import capture_message
+
+from ..models.agegroup import AgeGroup
+from ..models.citizenship import Citizenship
+from ..models.courses import Course, CourseRegistration, CourseRegistrationPeriod
+from ..models.department import Department
+from ..models.events import Event, EventRegistration
+from ..models.fields import DAY_OF_WEEK
+from ..models.leprikonsite import LeprikonSite
+from ..models.orderables import Orderable, OrderableRegistration
+from ..models.place import Place
+from ..models.roles import BillingInfo, Leader, Parent, Participant
+from ..models.school import School
+from ..models.schoolyear import SchoolYearPeriod
 from ..models.subjects import (
-    CHAT_GROUP_TYPE_LABELS, DEFAULT_TEXTS, Subject, SubjectAttachment,
-    SubjectGroup, SubjectPayment, SubjectRegistration,
-    SubjectRegistrationBillingInfo, SubjectRegistrationGroup,
-    SubjectRegistrationGroupMember, SubjectRegistrationParticipant,
-    SubjectType, SubjectTypeAttachment, SubjectVariant,
-)
-from ..models.utils import (
-    lazy_help_text_with_default, lazy_help_text_with_html_default,
+    Subject,
+    SubjectGroup,
+    SubjectRegistration,
+    SubjectRegistrationBillingInfo,
+    SubjectRegistrationGroup,
+    SubjectRegistrationGroupMember,
+    SubjectRegistrationParticipant,
+    SubjectType,
+    SubjectVariant,
 )
-from ..utils import amount_color, currency
-from .bulkupdate import BulkUpdateMixin
-from .export import AdminExportMixin
-from .filters import (
-    ApprovedListFilter, CanceledListFilter, IsNullFieldListFilter,
-    LeaderListFilter, SchoolYearListFilter, SubjectGroupListFilter,
-    SubjectListFilter, SubjectTypeListFilter,
-)
-from .messages import SendMessageAdminMixin
-from .pdf import PdfExportAdminMixin
-
-
-class IsNull(Func):
-    _output_field = BooleanField()
-    arity = 1
-    template = '%(expressions)s IS NULL'
-
-
-class SubjectTypeAttachmentInlineAdmin(admin.TabularInline):
-    model = SubjectTypeAttachment
-    extra = 0
+from ..models.targetgroup import TargetGroup
+from ..utils import get_age, get_birth_date, get_gender
+from .fields import AgreementBooleanField
+from .form import FormMixin
+from .widgets import CheckboxSelectMultipleBootstrap, RadioSelectBootstrap
+
+User = get_user_model()
+
+
+class SubjectFilterForm(FormMixin, forms.Form):
+    q = forms.CharField(label=_("Search term"), required=False)
+    course_types = forms.ModelMultipleChoiceField(queryset=None, label=_("Course type"), required=False)
+    event_types = forms.ModelMultipleChoiceField(queryset=None, label=_("Event type"), required=False)
+    orderable_types = forms.ModelMultipleChoiceField(queryset=None, label=_("Orderable event type"), required=False)
+    departments = forms.ModelMultipleChoiceField(queryset=None, label=_("Department"), required=False)
+    groups = forms.ModelMultipleChoiceField(queryset=None, label=_("Group"), required=False)
+    leaders = forms.ModelMultipleChoiceField(queryset=None, label=_("Leader"), required=False)
+    places = forms.ModelMultipleChoiceField(queryset=None, label=_("Place"), required=False)
+    age_groups = forms.ModelMultipleChoiceField(queryset=None, label=_("Age group"), required=False)
+    target_groups = forms.ModelMultipleChoiceField(queryset=None, label=_("Target group"), required=False)
+    days_of_week = forms.MultipleChoiceField(
+        label=_("Day of week"), choices=tuple(sorted(DAY_OF_WEEK.items())), required=False
+    )
+    past = forms.BooleanField(label=_("Show past"), required=False)
+    reg_active = forms.BooleanField(label=_("Available for registration"), required=False)
+    invisible = forms.BooleanField(label=_("Show invisible"), required=False)
+
+    _models = {
+        SubjectType.COURSE: Course,
+        SubjectType.EVENT: Event,
+        SubjectType.ORDERABLE: Orderable,
+    }
+
+    def __init__(self, subject_type_type, subject_types, school_year, is_staff, data, **kwargs):
+        super().__init__(data=data, **kwargs)
+        self.subject_type_type = subject_type_type
+
+        # pre filter subjects by initial params
+        qs = self._models[subject_type_type].objects
+        if subject_type_type != SubjectType.EVENT or data.get("past"):
+            qs = qs.filter(school_year=school_year)
+        if len(subject_types) == 1:
+            qs = qs.filter(subject_type=subject_types[0])
+        else:
+            qs = qs.filter(subject_type__in=subject_types)
+        if not is_staff or "invisible" not in data:
+            qs = qs.filter(public=True)
+        self.qs = qs
+
+        subject_ids = tuple(qs.order_by("id").values_list("id", flat=True).distinct())
+        if len(subject_types) == 1:
+            del self.fields["course_types"]
+            del self.fields["event_types"]
+            del self.fields["orderable_types"]
+        elif subject_type_type == SubjectType.COURSE:
+            del self.fields["event_types"]
+            del self.fields["orderable_types"]
+            self.fields["course_types"].queryset = SubjectType.objects.filter(id__in=(st.id for st in subject_types))
+        elif subject_type_type == SubjectType.EVENT:
+            del self.fields["course_types"]
+            del self.fields["orderable_types"]
+            self.fields["event_types"].queryset = SubjectType.objects.filter(id__in=(st.id for st in subject_types))
+        elif subject_type_type == SubjectType.ORDERABLE:
+            del self.fields["course_types"]
+            del self.fields["event_types"]
+            self.fields["orderable_types"].queryset = SubjectType.objects.filter(id__in=(st.id for st in subject_types))
+
+        self.fields["departments"].queryset = Department.objects.filter(subjects__id__in=subject_ids).distinct()
+        if self.fields["departments"].queryset.count() == 0:
+            del self.fields["departments"]
 
+        self.fields["groups"].queryset = SubjectGroup.objects.filter(
+            subject_types__in=subject_types, subjects__id__in=subject_ids
+        ).distinct()
+        if self.fields["groups"].queryset.count() == 0:
+            del self.fields["groups"]
 
-@admin.register(SubjectType)
-class SubjectTypeAdmin(BulkUpdateMixin, admin.ModelAdmin):
-    bulk_update_exclude = (
-        'subject_type', 'slug', 'order', 'name',
-        'plural', 'name_genitiv', 'name_akuzativ',
-    )
-    list_display = ('plural', 'order')
-    list_editable = ('order',)
-    exclude = ('order',)
-    filter_horizontal = ('questions', 'registration_agreements')
-    prepopulated_fields = {'slug': ('plural',)}
-    inlines = (SubjectTypeAttachmentInlineAdmin, )
+        self.fields["leaders"].queryset = (
+            Leader.objects.filter(subjects__id__in=subject_ids)
+            .distinct()
+            .order_by("user__first_name", "user__last_name")
+        )
+        if self.fields["leaders"].queryset.count() == 0:
+            del self.fields["leaders"]
 
-    def get_form(self, request, obj=None, **kwargs):
-        form = super(SubjectTypeAdmin, self).get_form(request, obj, **kwargs)
+        self.fields["places"].queryset = Place.objects.filter(subjects__id__in=subject_ids).distinct()
+        if self.fields["places"].queryset.count() == 0:
+            del self.fields["places"]
+
+        self.fields["age_groups"].queryset = AgeGroup.objects.filter(subjects__id__in=subject_ids).distinct()
+        if self.fields["age_groups"].queryset.count() <= 1:
+            del self.fields["age_groups"]
+
+        self.fields["target_groups"].queryset = TargetGroup.objects.filter(subjects__id__in=subject_ids).distinct()
+        if self.fields["target_groups"].queryset.count() <= 1:
+            del self.fields["target_groups"]
+
+        if subject_type_type != SubjectType.COURSE:
+            del self.fields["days_of_week"]
+        if subject_type_type != SubjectType.EVENT:
+            del self.fields["past"]
+        if not is_staff:
+            del self.fields["invisible"]
+
+        for f in self.fields:
+            self.fields[f].help_text = None
+
+    def get_queryset(self):
+        if not self.is_valid():
+            return self.qs
+        qs = self.qs
+        for word in self.cleaned_data["q"].split():
+            qs = qs.filter(Q(name__icontains=word) | Q(description__icontains=word))
+        if self.cleaned_data.get("course_types"):
+            qs = qs.filter(subject_type__in=self.cleaned_data["course_types"])
+        elif self.cleaned_data.get("event_types"):
+            qs = qs.filter(subject_type__in=self.cleaned_data["event_types"])
+        elif self.cleaned_data.get("orderable_types"):
+            qs = qs.filter(subject_type__in=self.cleaned_data["orderable_types"])
+        if self.cleaned_data.get("departments"):
+            qs = qs.filter(department__in=self.cleaned_data["departments"])
+        if self.cleaned_data.get("groups"):
+            qs = qs.filter(groups__in=self.cleaned_data["groups"])
+        if self.cleaned_data.get("places"):
+            qs = qs.filter(place__in=self.cleaned_data["places"])
+        if self.cleaned_data.get("leaders"):
+            qs = qs.filter(leaders__in=self.cleaned_data["leaders"])
+        if self.cleaned_data.get("age_groups"):
+            qs = qs.filter(age_groups__in=self.cleaned_data["age_groups"])
+        if self.cleaned_data.get("target_groups"):
+            qs = qs.filter(target_groups__in=self.cleaned_data["target_groups"])
+        if self.cleaned_data.get("days_of_week"):
+            qs = qs.filter(times__day_of_week__in=self.cleaned_data["days_of_week"])
+        if self.subject_type_type == SubjectType.EVENT:
+            if self.cleaned_data["past"]:
+                qs = qs.filter(end_date__lte=now()).order_by("-start_date", "-start_time")
+            else:
+                qs = qs.filter(end_date__gte=now())
+        if self.cleaned_data["reg_active"]:
+            qs = qs.filter(variants__reg_from__lte=now()).exclude(variants__reg_to__lte=now())
+        return qs.distinct()
+
+
+class SubjectForm(FormMixin, forms.ModelForm):
+    class Meta:
+        model = Subject
+        fields = ["description"]
+
+
+class SubjectAdminForm(forms.ModelForm):
+    def __init__(self, data=None, *args, **kwargs):
+        super().__init__(data, *args, **kwargs)
+        instance = kwargs.get("instance")
+        leprikon_site = LeprikonSite.objects.get_current()
+
+        # limit choices of groups
+        self.fields["groups"].widget.choices.queryset = self.subject_type.groups.all()
+
+        # limit choices of leaders
+        leaders_choices = self.fields["leaders"].widget.choices
+        leaders_choices.queryset = leaders_choices.queryset.filter(school_years=self.school_year)
+
+        # limit choices of questions
+        if instance:
+            questions_choices = self.fields["questions"].widget.choices
+            questions_choices.queryset = questions_choices.queryset.exclude(
+                id__in=instance.subject_type.questions.values("id")
+            )
 
         # limit choices of registration agreements
-        registration_agreements_choices = form.base_fields['registration_agreements'].widget.widget.choices
+        registration_agreements_choices = self.fields["registration_agreements"].widget.choices
         registration_agreements_choices.queryset = registration_agreements_choices.queryset.exclude(
-            id__in=request.leprikon_site.registration_agreements.values('id')
+            id__in=leprikon_site.registration_agreements.values("id")
         )
-        form.base_fields['registration_agreements'].choices = registration_agreements_choices
-
-        return form
-
-
-@admin.register(SubjectGroup)
-class SubjectGroupAdmin(admin.ModelAdmin):
-    list_display = ('name', 'color', 'order')
-    list_editable = ('color', 'order')
-    filter_horizontal = ('subject_types',)
-
-
-class SubjectAttachmentInlineAdmin(admin.TabularInline):
-    model = SubjectAttachment
-    extra = 0
-
-
-class SubjectVariantInlineAdmin(admin.TabularInline):
-    model = SubjectVariant
-    extra = 0
-
-
-class SubjectBaseAdmin(AdminExportMixin, BulkUpdateMixin, SendMessageAdminMixin, admin.ModelAdmin):
-    registration_model = None
-    list_editable = ('public', 'note')
-    list_filter = (
-        ('school_year', SchoolYearListFilter),
-        'department',
-        ('subject_type', SubjectTypeListFilter),
-        ('groups', SubjectGroupListFilter),
-        ('leaders', LeaderListFilter),
-        'place',
-    )
-    inlines = (
-        SubjectVariantInlineAdmin,
-        SubjectAttachmentInlineAdmin,
-    )
-    filter_horizontal = ('age_groups', 'target_groups', 'groups', 'leaders', 'questions', 'registration_agreements')
-    actions = ('set_registration_dates',)
-    search_fields = ('name', 'description')
-    save_as = True
+        if instance:
+            registration_agreements_choices.queryset = registration_agreements_choices.queryset.exclude(
+                id__in=instance.subject_type.registration_agreements.values("id")
+            )
 
-    @property
-    def media(self):
-        m = super().media
-        m.add_js(['leprikon/js/Popup.js'])
-        return m
-
-    def changeform_view(self, request, object_id=None, form_url='', extra_context=None):
-        if not object_id and request.method == 'POST' and len(request.POST) == 4:
-            return HttpResponseRedirect('{}?subject_type={}&registration_type={}'.format(
-                request.path,
-                request.POST.get('subject_type', ''),
-                request.POST.get('registration_type', ''),
-            ))
-        else:
-            return super().changeform_view(request, object_id, form_url, extra_context)
 
-    def get_exclude(self, request, obj=None):
-        if request.registration_type == Subject.PARTICIPANTS:
-            exclude = ['target_groups', 'min_group_members_count', 'max_group_members_count']
-        elif request.registration_type == Subject.GROUPS:
-            exclude = ['age_groups', 'min_participants_count', 'max_participants_count']
-        else:
-            exclude = []
-        if obj and obj.registrations.exists():
-            exclude.append('registration_type')
-        return exclude
-
-    def get_form(self, request, obj, **kwargs):
-        # set school year
-        if obj:
-            request.school_year = obj.school_year
+class SchoolMixin:
+    def _add_error_required(self, field_name):
+        self.add_error(
+            field_name,
+            ValidationError(
+                self.fields[field_name].error_messages["required"],
+                code="required",
+            ),
+        )
 
-        # get subject type
-        try:
-            # first try request.POST (user may want to change subject type)
-            request.subject_type = SubjectType.objects.get(id=int(request.POST.get('subject_type')))
-        except (SubjectType.DoesNotExist, TypeError, ValueError):
-            if obj:
-                # use subject type from object
-                request.subject_type = obj.subject_type
-            else:
-                # try to get subject type from request.GET
-                try:
-                    request.subject_type = SubjectType.objects.get(
-                        id=int(request.GET.get('subject_type')),
+    def clean(self):
+        # check required school and class
+        x_group = self.cleaned_data.get(self.x_group)
+        if x_group and x_group.require_school:
+            # require school
+            school = self.cleaned_data.get("school")
+            if school:
+                if school == "other":
+                    self.cleaned_data["school"] = None
+                    # require other school
+                    if not self.cleaned_data.get("school_other"):
+                        self._add_error_required("school_other")
+                else:
+                    self.cleaned_data["school"] = School.objects.get(
+                        id=int(self.cleaned_data["school"]),
                     )
-                except (SubjectType.DoesNotExist, TypeError, ValueError):
-                    request.subject_type = None
-
-        # get registration type
-        request.registration_type = request.POST.get('registration_type')
-        if request.registration_type not in Subject.REGISTRATION_TYPES:
-            if obj:
-                # use registration type from object
-                request.registration_type = obj.registration_type
             else:
-                # try to get registration type from request.GET
-                request.registration_type = request.GET.get('registration_type')
-                if request.registration_type not in Subject.REGISTRATION_TYPES:
-                    request.registration_type = None
-
-        if request.subject_type and request.registration_type:
-            kwargs['form'] = type(
-                SubjectAdminForm.__name__,
-                (SubjectAdminForm, ),
-                {
-                    'school_year': request.school_year,
-                    'subject_type': request.subject_type,
-                    'registration_type': request.registration_type,
-                },
+                self._add_error_required("school")
+            # require school class
+            if not self.cleaned_data.get("school_class"):
+                self._add_error_required("school_class")
+        else:
+            # delete school and class
+            self.cleaned_data["school"] = None
+            self.cleaned_data["school_other"] = ""
+            self.cleaned_data["school_class"] = ""
+        return self.cleaned_data
+
+
+class RegistrationParticipantFormMixin:
+    def clean_birth_num(self):
+        if self.cleaned_data["birth_num"]:
+            qs = SubjectRegistrationParticipant.objects.filter(
+                registration__subject_id=self.subject.id,
+                registration__canceled=None,
+                birth_num=self.cleaned_data["birth_num"],
             )
-        else:
-            kwargs['fields'] = ['subject_type', 'registration_type']
-            request.hide_inlines = True
+            if self.instance.pk:
+                qs = qs.exclude(pk=self.instance.pk)
+            if qs.exists():
+                raise ValidationError(_("Participant with this birth number has already been registered."))
+        return self.cleaned_data["birth_num"]
+
+    def _setup_required_fields(self):
+        self.all_citizenships = list(Citizenship.objects.all())
+
+        # set default values
+        created_date = date.today()
+        age = None
+        citizenship = self.all_citizenships[0]
 
-        form = super().get_form(request, obj, **kwargs)
+        # try to use values from existing object (update)
+        try:
+            created_date = self.obj.created.date()
+            age = get_age(self.instance.birth_date, created_date)
+            citizenship = self.instance.citizenship
+        except AttributeError:
+            pass
 
-        if request.subject_type and request.registration_type:
-            for field_name in [
-                'text_registration_received',
-                'text_registration_approved',
-                'text_registration_refused',
-                'text_registration_payment_request',
-                'text_registration_canceled',
-                'text_discount_granted',
-                'text_payment_received',
-            ]:
-                form.base_fields[field_name].help_text = lazy_help_text_with_html_default(
-                    form.base_fields[field_name].help_text,
-                    getattr(request.subject_type, field_name) or DEFAULT_TEXTS[field_name],
-                )
-            form.base_fields['chat_group_type'].help_text = lazy_help_text_with_default(
-                form.base_fields['chat_group_type'].help_text,
-                CHAT_GROUP_TYPE_LABELS[request.subject_type.chat_group_type],
-            )
-
-        return form
-
-    def get_inline_instances(self, request, obj=None):
-        return [] if hasattr(request, 'hide_inlines') else super().get_inline_instances(request, obj)
-
-    def formfield_for_foreignkey(self, db_field, request, **kwargs):
-        formfield = super().formfield_for_foreignkey(db_field, request, **kwargs)
-        if db_field.name == 'subject_type':
-            limit_choices_to = {'subject_type__exact': self.subject_type_type}
-            formfield.limit_choices_to = limit_choices_to
-        return formfield
-
-    def save_form(self, request, form, change):
-        obj = super().save_form(request, form, change)
-        obj.school_year = request.school_year
-        return obj
-
-    def get_journal_link(self, obj):
-        return '<br/>'.join((
-            format_html(
-                '<a href="{url}" title="{title}" target="_blank">{journal}</a>',
-                url=reverse('admin:leprikon_subject_journal', args=[obj.id]),
-                title=_('printable journal'),
-                journal=_('journal'),
-            ),
-            format_html(
-                '<a href="{url}" title="{title}" target="_blank">{participants}</a>',
-                url=reverse('admin:leprikon_subject_journal_pdf', args=[obj.id]),
-                title=_('printable list of participants'),
-                participants=_('participants'),
-            ),
-        ))
-    get_journal_link.short_description = _('journal')
-    get_journal_link.allow_tags = True
-
-    def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(
-            leprikon_subjectregistrations__subject__in=queryset
-        ).distinct()
+        prefix = self.prefix + "-"
+        data = {key[len(prefix) :]: value for key, value in self.data.items() if key.startswith(prefix)}
 
-    def get_registrations_link(self, obj):
-        icon = False
-        approved_registrations_count = obj.approved_registrations.count()
-        unapproved_registrations_count = obj.unapproved_registrations.count()
-
-        if approved_registrations_count == 0:
-            title = _('There are no approved registrations for this {}.').format(obj.subject_type.name_akuzativ)
-        elif obj.min_registrations_count is not None and approved_registrations_count < obj.min_registrations_count:
-            title = _('The number of approved registrations is lower than {}.').format(obj.min_registrations_count)
-        elif obj.max_registrations_count is not None and approved_registrations_count > obj.max_registrations_count:
-            title = _('The number of approved registrations is greater than {}.').format(obj.max_registrations_count)
-        else:
-            icon = True
-            title = ''
-        return format_html(
-            '<a href="{url}" title="{title}">{icon} {approved}{unapproved}</a>',
-            url=reverse('admin:{}_{}_changelist'.format(
-                self.registration_model._meta.app_label,
-                self.registration_model._meta.model_name,
-            )) + '?subject__id__exact={}'.format(obj.id),
-            title=title,
-            icon=_boolean_icon(icon),
-            approved=approved_registrations_count,
-            unapproved=' + {}'.format(unapproved_registrations_count) if unapproved_registrations_count else '',
-        ) + format_html(
-            '<a class="popup-link" href="{url}" style="background-position: 0 0" title="{title}">'
-            '<img src="{icon}" alt="+"/></a>',
-            url=reverse('admin:{}_{}_add'.format(
-                self.registration_model._meta.app_label,
-                self.registration_model._meta.model_name,
-            )) + '?subject={}'.format(obj.id),
-            title=_('add registration'),
-            icon=static('admin/img/icon-addlink.svg'),
-        )
-    get_registrations_link.short_description = _('registrations')
-    get_registrations_link.allow_tags = True
+        if data:
+            # try to use citizenship from request data (post)
+            try:
+                citizenship = self.fields["citizenship"].clean(data.get("citizenship"))
+            except ValidationError:
+                pass
+
+        # set required field based on citizenship
+        if citizenship.require_birth_num:
+            self.hide_birth_num = False
+            self.fields["birth_num"].required = True
+            self.fields["birth_date"].required = False
+            self.fields["gender"].required = False
+        else:
+            self.hide_birth_num = True
+            self.fields["birth_num"].required = False
+            self.fields["birth_date"].required = True
+            self.fields["gender"].required = True
 
-    def registration_allowed_icon(self, obj):
-        return _boolean_icon(obj.registration_allowed)
-    registration_allowed_icon.short_description = _('registration allowed')
-
-    def get_approved_registrations_count(self, obj):
-        return obj.registrations.filter(canceled=None).exclude(approved=None).count()
-    get_approved_registrations_count.short_description = _('approved registrations count')
-    get_approved_registrations_count.admin_order_field = 'approved registrations_count'
-
-    def get_unapproved_registrations_count(self, obj):
-        return obj.registrations.filter(canceled=None, approved=None).count()
-    get_unapproved_registrations_count.short_description = _('unapproved registrations count')
-    get_unapproved_registrations_count.admin_order_field = 'unapproved registrations_count'
+        if data:
+            # try to use age from request data (post)
+            try:
+                if citizenship.require_birth_num:
+                    age = get_age(
+                        get_birth_date(self.fields["birth_num"].clean(data.get("birth_num"))),
+                        created_date,
+                    )
+                else:
+                    age = get_age(self.fields["birth_date"].clean(data.get("birth_date")), created_date)
+            except ValidationError:
+                pass
+
+        # set required field based on age
+        if age is not None and age < 18:
+            self.hide_parents = False
+            self.fields["has_parent1"].required = True
+        else:
+            self.hide_parents = True
+            self.fields["phone"].required = True
+            self.fields["email"].required = True
+
+        # set required field based on has_parentX
+        if data:
+            has_parent = ["has_parent1" in data, "has_parent2" in data]
+        else:
+            has_parent = [self.instance.has_parent1, self.instance.has_parent2] if self.instance else [False, False]
+        for n in range(2):
+            if has_parent[n]:
+                for field in ["first_name", "last_name", "street", "city", "postal_code", "phone", "email"]:
+                    self.fields["parent{}_{}".format(n + 1, field)].required = True
+
+    def _set_birth_date_gender(self):
+        if self.instance.citizenship.require_birth_num:
+            self.instance.birth_date = get_birth_date(self.instance.birth_num)
+            self.instance.gender = get_gender(self.instance.birth_num)
+        else:
+            self.instance.birth_num = None
+
+
+class RegistrationParticipantForm(FormMixin, RegistrationParticipantFormMixin, SchoolMixin, forms.ModelForm):
+    x_group = "age_group"
+
+    school = forms.ChoiceField(
+        label=_("School"),
+        choices=lambda: (
+            [("", "---------")]
+            + [(school.id, school) for school in School.objects.all()]
+            + [("other", _("other school"))]
+        ),
+        required=False,
+    )
+
+    def __init__(self, **kwargs):
+        super().__init__(**kwargs)
+
+        # choices for age group
+        self.fields["age_group"].widget.choices.queryset = self.subject.age_groups.all()
+        if self.subject.age_groups.count() == 1:
+            self.fields["age_group"].initial = self.subject.age_groups.first()
+
+        # initial school
+        if School.objects.count() == 0:
+            self.fields["school"].initial = "other"
+
+        self._setup_required_fields()
+
+        class ParticipantSelectForm(FormMixin, forms.Form):
+            participant = forms.ChoiceField(
+                label=_("Choose"),
+                choices=[("new", _("new participant"))] + list((p.id, p) for p in self.user_participants),
+                initial="new",
+                widget=RadioSelectBootstrap(),
+            )
 
-    def icon(self, obj):
-        try:
-            return '<img src="{}" alt="{}"/>'.format(obj.photo.icons['48'], obj.photo.label)
-        except (AttributeError, KeyError):
-            return ''
-    icon.allow_tags = True
-    icon.short_description = _('photo')
-
-
-class ChangeformRedirectMixin:
-    def changeform_view(self, request, object_id=None, form_url='', extra_context=None):
-        if object_id:
-            obj = self.get_object(request, unquote(object_id))
-            if obj:
-                return HttpResponseRedirect(obj.get_edit_url())
-        return super(ChangeformRedirectMixin, self).changeform_view(request, object_id, form_url, extra_context)
-
-
-@admin.register(Subject)
-class SubjectAdmin(AdminExportMixin, SendMessageAdminMixin, ChangeformRedirectMixin, admin.ModelAdmin):
-    """ Hidden admin used for raw id fields """
-    list_display = (
-        'id', 'code', 'name', 'subject_type', 'get_groups_list', 'get_leaders_list', 'icon',
-    )
-    list_filter = (
-        ('school_year', SchoolYearListFilter),
-        'department',
-        'subject_type__subject_type',
-        ('subject_type', SubjectTypeListFilter),
-        'registration_type',
-        ('groups', SubjectGroupListFilter),
-        ('leaders', LeaderListFilter),
-    )
-    search_fields = ('name', 'description')
+        kwargs["prefix"] = self.prefix + "-participant_select"
+        self.participant_select_form = ParticipantSelectForm(**kwargs)
 
-    def get_model_perms(self, request):
-        return {}
+        class ParentSelectForm(FormMixin, forms.Form):
+            parent = forms.ChoiceField(
+                label=_("Choose"),
+                choices=[("new", _("new parent"))] + list((p.id, p) for p in self.user_parents),
+                initial="new",
+                widget=RadioSelectBootstrap(),
+            )
 
-    def has_add_permission(self, request):
-        return False
+        kwargs["prefix"] = self.prefix + "-parent1_select"
+        self.parent1_select_form = ParentSelectForm(**kwargs)
+        kwargs["prefix"] = self.prefix + "-parent2_select"
+        self.parent2_select_form = ParentSelectForm(**kwargs)
+
+        kwargs["prefix"] = self.prefix + "-questions"
+        self.questions_form = type(
+            str("QuestionsForm"),
+            (FormMixin, forms.Form),
+            dict((q.slug, q.get_field()) for q in self.subject.all_questions),
+        )(**kwargs)
 
-    def icon(self, obj):
-        try:
-            return '<img src="{}" alt="{}"/>'.format(obj.photo.icons['48'], obj.photo.label)
-        except (AttributeError, KeyError):
-            return ''
-    icon.allow_tags = True
-    icon.short_description = _('photo')
+    @cached_property
+    def media(self):
+        media = Media()
+        for form in self.required_forms:
+            media = media + form.media
+        return media
 
-    def get_urls(self):
+    @cached_property
+    def required_forms(self):
         return [
-            urls_url(
-                r'(?P<subject_id>\d+)/journal/$',
-                self.admin_site.admin_view(self.journal),
-                name='leprikon_subject_journal',
-            ),
-            urls_url(
-                r'(?P<subject_id>\d+)/journal-pdf/$',
-                self.admin_site.admin_view(self.journal_pdf),
-                name='leprikon_subject_journal_pdf',
-            ),
-        ] + super().get_urls()
-
-    def journal(self, request, subject_id):
-        return render(request, 'leprikon/subject_journal.html', {
-            'subject': get_object_or_404(Subject, id=subject_id),
-            'admin': True,
-        })
-
-    def journal_pdf(self, request, subject_id):
-        obj = self.get_object(request, subject_id)
-
-        # create PDF response object
-        response = HttpResponse(content_type='application/pdf')
-        response['Content-Disposition'] = 'attachment; filename="{}"'.format(obj.get_pdf_filename('journal_pdf'))
+            super(),
+            self.participant_select_form,
+            self.questions_form,
+            self.parent1_select_form,
+            self.parent2_select_form,
+        ]
+
+    def is_valid(self):
+        # validate all required forms
+        results = [form.is_valid() for form in self.required_forms]
+        return all(results)
+
+    @cached_property
+    def errors(self):
+        return {
+            (form.prefix + "-" + field_name if form.prefix else field_name): error
+            for form in self.required_forms
+            for field_name, error in form.errors.items()
+        }
+
+    def save(self, commit=True):
+        with transaction.atomic():
+            return self._save(commit)
+
+    def _save(self, commit):
+        # set answers
+        self.instance.answers = dumps(self.questions_form.cleaned_data)
+
+        # set birth date and gender
+        self._set_birth_date_gender()
+
+        # create
+        super().save(commit)
+
+        # save / update participant
+        if "participant" not in self.participant_select_form.cleaned_data:
+            capture_message(
+                "Invalid participant_select_form",
+                "warning",
+                extras={
+                    "participant_select_form_data": self.participant_select_form.data,
+                    "participant_select_form_is_valid": self.participant_select_form.is_valid(),
+                    "participant_select_form_cleaned_data": self.participant_select_form.cleaned_data,
+                },
+            )
+            self.participant_select_form.cleaned_data["participant"] = "new"
+        if self.participant_select_form.cleaned_data["participant"] == "new":
+            participant = Participant()
+            participant.user = self.instance.registration.user
+        else:
+            participant = Participant.objects.get(id=self.participant_select_form.cleaned_data["participant"])
+        for attr in [
+            "first_name",
+            "last_name",
+            "birth_num",
+            "birth_date",
+            "gender",
+            "age_group",
+            "street",
+            "city",
+            "postal_code",
+            "citizenship",
+            "phone",
+            "email",
+            "school",
+            "school_other",
+            "school_class",
+            "health",
+        ]:
+            setattr(participant, attr, getattr(self.instance, attr))
+        participant_answers = participant.get_answers()
+        participant_answers.update(self.instance.get_answers())
+        participant.answers = dumps(participant_answers)
+        participant.save()
+
+        # save / update first parent
+        if self.instance.parent1:
+            if self.parent1_select_form.cleaned_data["parent"] == "new":
+                parent = Parent()
+                parent.user = self.instance.registration.user
+            else:
+                parent = Parent.objects.get(id=self.parent1_select_form.cleaned_data["parent"])
+            for attr in ["first_name", "last_name", "street", "city", "postal_code", "phone", "email"]:
+                setattr(parent, attr, getattr(self.instance.parent1, attr))
+            parent.save()
+
+        # save / update second parent
+        if self.instance.parent2:
+            if self.parent2_select_form.cleaned_data["parent"] == "new":
+                parent = Parent()
+                parent.user = self.instance.registration.user
+            else:
+                parent = Parent.objects.get(id=self.parent2_select_form.cleaned_data["parent"])
+            for attr in ["first_name", "last_name", "street", "city", "postal_code", "phone", "email"]:
+                setattr(parent, attr, getattr(self.instance.parent2, attr))
+            parent.save()
+        return self.instance
+
+
+class RegistrationGroupForm(FormMixin, SchoolMixin, forms.ModelForm):
+    x_group = "target_group"
+
+    school = forms.ChoiceField(
+        label=_("School"),
+        choices=lambda: (
+            [("", "---------")]
+            + [(school.id, school) for school in School.objects.all()]
+            + [("other", _("other school"))]
+        ),
+        required=False,
+    )
+
+    def __init__(self, **kwargs):
+        super().__init__(**kwargs)
+
+        # choices for target group
+        self.fields["target_group"].widget.choices.queryset = self.subject.target_groups.all()
+        if self.subject.target_groups.count() == 1:
+            self.fields["target_group"].initial = self.subject.target_groups.first()
+
+        # initial school
+        self.fields["school"].initial = "other" if School.objects.count() == 0 else None
+
+        kwargs["prefix"] = self.prefix + "-questions"
+        self.questions_form = type(
+            str("QuestionsForm"),
+            (FormMixin, forms.Form),
+            dict((q.slug, q.get_field()) for q in self.subject.all_questions),
+        )(**kwargs)
 
-        # write PDF to response
-        return obj.write_pdf('journal_pdf', response)
+    @cached_property
+    def media(self):
+        media = Media()
+        for form in self.required_forms:
+            media = media + form.media
+        return media
 
+    @cached_property
+    def required_forms(self):
+        return [
+            super(),
+            self.questions_form,
+        ]
+
+    def is_valid(self):
+        # validate all required forms
+        results = [form.is_valid() for form in self.required_forms]
+        return all(results)
+
+    @cached_property
+    def errors(self):
+        return {
+            (form.prefix + "-" + field_name if form.prefix else field_name): error
+            for form in self.required_forms
+            for field_name, error in form.errors.items()
+        }
+
+    def save(self, commit=True):
+        # set answers
+        self.instance.answers = dumps(self.questions_form.cleaned_data)
+
+        # create
+        return super().save(commit)
+
+
+class RegistrationGroupMemberForm(FormMixin, forms.ModelForm):
+    pass
+
+
+class RegistrationBillingInfoForm(FormMixin, forms.ModelForm):
+    use_required_attribute = False
+
+    class Meta:
+        model = SubjectRegistrationBillingInfo
+        exclude = ["registration"]
+
+
+class RegistrationForm(FormMixin, forms.ModelForm):
+    instance: SubjectRegistration
+
+    def __init__(self, subject: Subject, subject_variant: SubjectVariant, user, **kwargs):
+        super().__init__(**kwargs)
+        self.user = user
+        self.instance.subject = subject
+        self.instance.subject_variant = subject_variant
+
+        # sub forms
+        if subject.registration_type_participants:
+            registered_birth_nums = list(
+                SubjectRegistrationParticipant.objects.filter(
+                    registration_id__in=self.instance.subject.active_registrations.values("id"),
+                    birth_num__isnull=False,
+                ).values_list("birth_num", flat=True)
+            )
 
-class SubjectRegistrationParticipantInlineAdmin(admin.StackedInline):
-    model = SubjectRegistrationParticipant
-    extra = 0
+            participant_form = type(
+                RegistrationParticipantForm.__name__,
+                (RegistrationParticipantForm,),
+                {
+                    "subject": subject,
+                    "user_participants": user.leprikon_participants.exclude(
+                        birth_num__in=registered_birth_nums,
+                    ),
+                    "user_parents": list(user.leprikon_parents.all()),
+                },
+            )
 
-    def get_min_num(self, request, obj=None, **kwargs):
-        return request.subject.min_participants_count
+            self.participants_formset = inlineformset_factory(
+                SubjectRegistration,
+                SubjectRegistrationParticipant,
+                form=participant_form,
+                fk_name="registration",
+                exclude=[],
+                extra=subject_variant.max_participants_count,
+                min_num=subject_variant.min_participants_count,
+                max_num=subject_variant.max_participants_count,
+                validate_min=True,
+                validate_max=True,
+            )(kwargs.get("data"), instance=self.instance)
+
+        elif subject.registration_type_groups:
+            group_form = type(RegistrationGroupForm.__name__, (RegistrationGroupForm,), {"subject": subject})
+
+            self.group_formset = inlineformset_factory(
+                SubjectRegistration,
+                SubjectRegistrationGroup,
+                form=group_form,
+                fk_name="registration",
+                exclude=[],
+                extra=1,
+                min_num=1,
+                max_num=1,
+                validate_min=True,
+                validate_max=True,
+            )(kwargs.get("data"), instance=self.instance)
+
+            self.group_members_formset = inlineformset_factory(
+                SubjectRegistration,
+                SubjectRegistrationGroupMember,
+                form=RegistrationGroupMemberForm,
+                fk_name="registration",
+                exclude=[],
+                extra=subject_variant.max_participants_count,
+                min_num=subject_variant.min_participants_count,
+                max_num=subject_variant.max_participants_count,
+                validate_min=True,
+                validate_max=True,
+            )(kwargs.get("data"), instance=self.instance)
+
+        del kwargs["instance"]
+
+        self.agreement_forms = []
+        for agreement in self.instance.subject.all_registration_agreements:
+            kwargs["prefix"] = "agreement_%s" % agreement.id
+            form_attributes = {
+                "agreement": agreement,
+                "options": {},
+            }
+            for option in agreement.all_options:
+                option_id = "option_%s" % option.id
+                form_attributes[option_id] = AgreementBooleanField(
+                    label=option.option,
+                    allow_disagree=not option.required,
+                )
+                form_attributes["options"][option_id] = option
+            AgreementForm = type(str("AgreementForm"), (FormMixin, forms.Form), form_attributes)
+            self.agreement_forms.append(AgreementForm(**kwargs))
+
+        self.user_billing_info = list(self.user.leprikon_billing_info.all())
+
+        class BillingInfoSelectForm(FormMixin, forms.Form):
+            billing_info = forms.ChoiceField(
+                label=_("Choose"),
+                choices=[
+                    ("none", _("no billing information")),
+                ]
+                + list((bi.id, bi) for bi in self.user_billing_info)
+                + [
+                    ("new", _("new billing information")),
+                ],
+                initial="none",
+                widget=RadioSelectBootstrap(),
+            )
 
-    def get_max_num(self, request, obj=None, **kwargs):
-        return request.subject.max_participants_count
+        kwargs["prefix"] = "billing_info_select"
+        self.billing_info_select_form = BillingInfoSelectForm(**kwargs)
 
-    def get_formset(self, request, obj, **kwargs):
-        questions = obj.all_questions if obj else request.subject.all_questions
-        fields = dict(
-            ('q_' + q.name, q.get_field())
-            for q in questions
-        )
-        fields['subject'] = request.subject
-        fields['obj'] = obj
-        kwargs['form'] = type(RegistrationParticipantAdminForm.__name__, (RegistrationParticipantAdminForm,), fields)
-        return super().get_formset(request, obj, **kwargs)
-
-
-class SubjectRegistrationGroupInlineAdmin(admin.StackedInline):
-    model = SubjectRegistrationGroup
-    extra = 1
-    min_num = 1
-    max_num = 1
-
-    def get_formset(self, request, obj, **kwargs):
-        questions = obj.all_questions if obj else request.subject.all_questions
-        fields = dict(
-            ('q_' + q.name, q.get_field())
-            for q in questions
-        )
-        fields['subject'] = request.subject
-        fields['obj'] = obj
-        kwargs['form'] = type(RegistrationGroupAdminForm.__name__, (RegistrationGroupAdminForm,), fields)
-        return super().get_formset(request, obj, **kwargs)
-
-
-class SubjectRegistrationGroupMemberInlineAdmin(admin.StackedInline):
-    model = SubjectRegistrationGroupMember
-    extra = 0
-
-    def get_min_num(self, request, obj=None, **kwargs):
-        return request.subject.min_group_members_count
-
-    def get_max_num(self, request, obj=None, **kwargs):
-        return request.subject.max_group_members_count
-
-
-class RegistrationBillingInfoInlineAdmin(admin.TabularInline):
-    model = SubjectRegistrationBillingInfo
-    max_num = 1
-    extra = 0
-
-
-class SubjectRegistrationBaseAdmin(AdminExportMixin, SendMessageAdminMixin, admin.ModelAdmin):
-    form = RegistrationAdminForm
-    inlines = (RegistrationBillingInfoInlineAdmin,)
-    list_editable = ('note',)
-    list_export = (
-        'id', 'variable_symbol', 'slug', 'user', 'subject', 'subject_variant', 'price', 'note',
-        'created', 'created_by',
-        'payment_requested', 'payment_requested_by',
-        'approved', 'approved_by',
-        'cancelation_requested', 'cancelation_requested_by',
-        'canceled', 'canceled_by',
-        'agreement_options_list', 'group_members_list',
-        'participants__gender', 'participants__first_name', 'participants__last_name',
-        'participants__birth_num', 'participants__birth_date', 'participants__gender',
-        'participants__age_group', 'participants__street', 'participants__city', 'participants__postal_code',
-        'participants__citizenship', 'participants__phone', 'participants__email',
-        'participants__school', 'participants__school_other', 'participants__school_class',
-        'participants__health', 'participants__answers',
-        'participants__has_parent1', 'participants__parent1_first_name', 'participants__parent1_last_name',
-        'participants__parent1_street', 'participants__parent1_city', 'participants__parent1_postal_code',
-        'participants__parent1_phone', 'participants__parent1_email',
-        'participants__has_parent2', 'participants__parent2_first_name', 'participants__parent2_last_name',
-        'participants__parent2_street', 'participants__parent2_city', 'participants__parent2_postal_code',
-        'participants__parent2_phone', 'participants__parent2_email',
-        'group__name', 'group__first_name', 'group__last_name',
-        'group__street', 'group__city', 'group__postal_code',
-        'group__phone', 'group__email',
-        'group__school__name', 'group__school_other', 'group__school_class',
-        'billing_info__name', 'billing_info__street', 'billing_info__city', 'billing_info__postal_code',
-        'billing_info__company_num', 'billing_info__vat_number', 'billing_info__contact_person',
-        'billing_info__phone', 'billing_info__email', 'billing_info__employee',
-    )
-    list_filter = (
-        ('subject__school_year', SchoolYearListFilter),
-        'subject__department',
-        ('subject__subject_type', SubjectTypeListFilter),
-        'subject__registration_type',
-        ApprovedListFilter,
-        CanceledListFilter,
-        'registration_link',
-        ('billing_info', IsNullFieldListFilter),
-        'subject__groups',
-        ('subject', SubjectListFilter),
-        ('subject__leaders', LeaderListFilter),
-        'subject__place',
-    )
-    actions = ('approve', 'refuse', 'request_payment', 'cancel')
-    search_fields = (
-        'variable_symbol', 'participants__birth_num',
-        'participants__first_name', 'participants__last_name',
-        'participants__parent1_first_name', 'participants__parent1_last_name',
-        'participants__parent2_first_name', 'participants__parent2_last_name',
-        'group_members__first_name', 'group_members__last_name',
-    )
-    ordering = ('-created',)
-    raw_id_fields = ('subject', 'user',)
+        kwargs["prefix"] = "billing_info"
+        self.billing_info_form = RegistrationBillingInfoForm(**kwargs)
 
-    @property
+    @cached_property
     def media(self):
-        m = super(SubjectRegistrationBaseAdmin, self).media
-        m.add_js(['leprikon/js/Popup.js'])
-        m.add_css({'all': ['leprikon/css/registrations.changelist.css']})
-        return m
-
-    def has_delete_permission(self, request, obj=None):
-        if obj and obj.approved is None and obj.payments.count() == 0:
-            return super(SubjectRegistrationBaseAdmin, self).has_delete_permission(request, obj)
-        else:
-            return False
-
-    def get_actions(self, request):
-        actions = super(SubjectRegistrationBaseAdmin, self).get_actions(request)
-        if 'delete_selected' in actions:
-            del(actions['delete_selected'])
-        return actions
-
-    def get_changelist(self, request, **kwargs):
-        class ChangeList(super().get_changelist(request, **kwargs)):
-            def get_ordering(self, request, queryset):
-                # Show registrations with cancelation request on the top
-                # if not showing canceled ones.
-                ordering = super().get_ordering(request, queryset)
-                return ordering if request.GET.get('canceled') == 'yes' else [
-                    IsNull('cancelation_requested'),
-                    *ordering,
-                ]
-        return ChangeList
+        media = Media()
+        for form in self.all_forms:
+            media = media + form.media
+        return media
 
-    def get_queryset(self, request):
-        return super().get_queryset(request).prefetch_related(
-            'discounts',
-            'payments',
-        ).select_related(
-            'subject',
-            'user',
-        ).annotate(random_number=Random())
-
-    def approve(self, request, queryset):
-        for registration in queryset.all():
-            try:
-                registration.approve(request.user)
-            except ValidationError as e:
-                self.message_user(request, e.message, messages.ERROR)
+    @cached_property
+    def required_forms(self):
+        return [
+            super(),
+            self.billing_info_select_form,
+        ] + self.agreement_forms
+
+    @cached_property
+    def all_forms(self):
+        all_forms = self.required_forms
+        if self.instance.subject.registration_type_participants:
+            all_forms += self.participants_formset.forms
+        elif self.instance.subject.registration_type_groups:
+            all_forms += self.group_formset.forms + self.group_members_formset.forms
+        if (
+            not self.billing_info_select_form.is_valid()
+            or self.billing_info_select_form.cleaned_data["billing_info"] != "none"
+        ):
+            all_forms.append(self.billing_info_form)
+        return all_forms
+
+    def is_valid(self):
+        # validate all required forms
+        results = [form.is_valid() for form in self.required_forms]
+        if self.instance.subject.registration_type_participants:
+            results.append(self.participants_formset.is_valid())
+        elif self.instance.subject.registration_type_groups:
+            results += [
+                self.group_formset.is_valid(),
+                self.group_members_formset.is_valid(),
+            ]
+        if (
+            not self.billing_info_select_form.is_valid()
+            or self.billing_info_select_form.cleaned_data["billing_info"] != "none"
+        ):
+            results.append(self.billing_info_form.is_valid())
+        return all(results)
+
+    @cached_property
+    def errors(self):
+        return {
+            (form.prefix + field_name if form.prefix else field_name): error
+            for form in self.all_forms
+            for field_name, error in form.errors.items()
+        }
+
+    @transaction.atomic
+    def save(self, commit=True):
+        # set user
+        self.instance.created_by = self.user
+        self.instance.user = self.user
+
+        if self.instance.subject.registration_type_participants:
+            participants_count = self.participants_formset.total_form_count()
+        elif self.instance.subject.registration_type_groups:
+            participants_count = self.group_members_formset.total_form_count()
+
+        # set price
+        self.instance.price = self.instance.subject_variant.get_price(participants_count)
+
+        # create
+        super().save(True)
+
+        if self.instance.subject.registration_type_participants:
+            # save participants
+            self.participants_formset.user = self.instance.user
+            self.participants_formset.save()
+
+        elif self.instance.subject.registration_type_groups:
+            # save group
+            self.group_formset.save()
+
+            # save group members
+            self.group_members_formset.save()
+
+        # save additional questions
+        self.instance.questions.set(self.instance.subject.all_questions)
+
+        # save legal agreements
+        self.instance.agreements.set(self.instance.subject.all_registration_agreements)
+
+        # save agreement options
+        for agreement_form in self.agreement_forms:
+            for option_id, checked in agreement_form.cleaned_data.items():
+                if checked:
+                    self.instance.agreement_options.add(agreement_form.options[option_id])
+
+        if self.billing_info_select_form.cleaned_data["billing_info"] != "none":
+            # save registration billing info
+            registration_billing_info = self.billing_info_form.save(commit=False)
+            registration_billing_info.registration = self.instance
+            registration_billing_info.save()
+
+            # save / update user billing info
+            if self.billing_info_select_form.cleaned_data["billing_info"] == "new":
+                billing_info = BillingInfo()
+                billing_info.user = self.instance.user
             else:
-                self.message_user(request, _(
-                    'The registration {r} has been approved and the user has been notified.'
-                ).format(r=registration))
-    approve.short_description = _('Approve selected registrations')
+                billing_info = BillingInfo.objects.get(id=self.billing_info_select_form.cleaned_data["billing_info"])
+            for attr in [
+                "name",
+                "street",
+                "city",
+                "postal_code",
+                "company_num",
+                "vat_number",
+                "contact_person",
+                "phone",
+                "email",
+                "employee",
+            ]:
+                setattr(billing_info, attr, getattr(registration_billing_info, attr))
+            billing_info.save()
 
-    def refuse(self, request, queryset):
-        for registration in queryset.all():
-            try:
-                registration.refuse(request.user)
-            except ValidationError as e:
-                self.message_user(request, e.message, messages.ERROR)
-            else:
-                self.message_user(request, _(
-                    'The registration {r} has been refused and the user has been notified.'
-                ).format(r=registration))
-    refuse.short_description = _('Refuse selected registrations')
-
-    def request_payment(self, request, queryset):
-        for registration in queryset.all():
-            registration.request_payment(request.user)
-        self.message_user(request, _('Payment was requested for selected registrations.'))
-    request_payment.short_description = _('Request payment for selected registrations')
+        self.instance.generate_variable_symbol_and_slug()
+        self.instance.send_mail()
+        return self.instance
 
-    def cancel(self, request, queryset):
-        for registration in queryset.all():
-            try:
-                registration.cancel(request.user)
-            except ValidationError as e:
-                self.message_user(request, e.message, messages.ERROR)
-            else:
-                self.message_user(request, _(
-                    'The registration {r} has been canceled and the user has been notified.'
-                ).format(r=registration))
-    cancel.short_description = _('Cancel selected registrations')
-
-    def formfield_for_foreignkey(self, db_field, request, **kwargs):
-        formfield = super().formfield_for_foreignkey(db_field, request, **kwargs)
-        if db_field.name == 'subject':
-            limit_choices_to = {'subject_type__subject_type__exact': self.model.subject_type}
-            formfield.limit_choices_to = limit_choices_to
-            formfield.widget.rel.limit_choices_to = limit_choices_to
-        return formfield
-
-    def changeform_view(self, request, object_id=None, form_url='', extra_context=None):
-        if not object_id and request.method == 'POST' and 'user' not in request.POST:
-            return HttpResponseRedirect('{}?subject={}'.format(request.path, request.POST.get('subject', '')))
-        else:
-            return super().changeform_view(request, object_id, form_url, extra_context)
 
-    def get_exclude(self, request, obj=None):
-        return [] if not request.subject or request.subject.variants.exists() else ['subject_variant']
+class CourseRegistrationForm(RegistrationForm):
+    periods = forms.ModelMultipleChoiceField(
+        queryset=SchoolYearPeriod.objects.all(),
+        widget=CheckboxSelectMultipleBootstrap(),
+    )
 
-    def get_form(self, request, obj, **kwargs):
-        try:
-            # first try request.POST (user may want to change the subject)
-            request.subject = Subject.objects.get(id=int(request.POST.get('subject')))
-        except (Subject.DoesNotExist, TypeError, ValueError):
-            if obj:
-                # use subject from object
-                request.subject = obj.subject
-            else:
-                # try to get subject from request.GET
-                try:
-                    request.subject = Subject.objects.get(id=int(request.GET.get('subject')))
-                except (Subject.DoesNotExist, TypeError, ValueError):
-                    request.subject = None
-
-        if request.subject:
-            kwargs['form'] = type(
-                self.form.__name__,
-                (self.form,),
-                {'subject': request.subject},
+    def __init__(self, *args, **kwargs):
+        super().__init__(*args, **kwargs)
+        if self.instance.subject_variant.school_year_division:
+            self.available_periods = self.instance.subject_variant.school_year_division.periods.exclude(
+                end__lt=date.today(),
             )
         else:
-            kwargs['form'] = forms.ModelForm
-            kwargs['fields'] = ['subject']
-        return super(SubjectRegistrationBaseAdmin, self).get_form(request, obj, **kwargs)
-
-    def get_inline_instances(self, request, obj=None):
-        if request.subject:
-            if request.subject.registration_type_participants:
-                inlines = (SubjectRegistrationParticipantInlineAdmin, )
-            elif request.subject.registration_type_groups:
-                inlines = (SubjectRegistrationGroupInlineAdmin, SubjectRegistrationGroupMemberInlineAdmin)
-            return [
-                inline(self.model, self.admin_site)
-                for inline in inlines
-            ] + super().get_inline_instances(request, obj)
-        else:
-            return []
+            self.available_periods = []
 
-    def save_model(self, request, obj, form, change):
-        if not change:
-            # set price
-            obj.price = (
-                obj.subject_variant.price
-                if obj.subject_variant
-                else obj.subject.price
-            )
-            obj.created_by = request.user
-        super().save_model(request, obj, form, change)
-
-    def save_related(self, request, form, formsets, change):
-        super().save_related(request, form, formsets, change)
-        if not change:
-            form.instance.questions.set(form.instance.subject.all_questions)
-            form.instance.agreements.set(form.instance.subject.all_registration_agreements)
-            form.instance.generate_variable_symbol_and_slug()
-            form.instance.send_mail()
-
-    def get_css(self, obj):
-        classes = []
-        if obj.cancelation_requested and not obj.canceled:
-            classes.append('reg-cancel-request')
-        if obj.approved:
-            classes.append('reg-approved')
+        if self.instance.subject_variant.school_year_division and self.instance.subject_variant.allow_period_selection:
+            self.fields["periods"].widget.choices.queryset = self.available_periods
         else:
-            classes.append('reg-new')
-            if obj.subject.full:
-                classes.append('reg-full')
-        if obj.canceled:
-            classes.append('reg-canceled')
-        else:
-            classes.append('reg-active')
-        return ' '.join(classes)
+            del self.fields["periods"]
 
-    legend = (
-        ('reg-cancel-request', _('cancelation requested')),
-        ('reg-new', _('new registration')),
-        ('reg-new reg-full', _('new registration, capacity full')),
-        ('reg-approved', _('approved registration')),
-    )
+    class Meta:
+        model = CourseRegistration
+        exclude = (
+            "subject",
+            "subject_variant",
+            "user",
+            "cancelation_requested",
+            "cancelation_requested_by",
+            "canceled",
+            "canceled_by",
+        )
 
-    def subject_name(self, obj):
-        return obj.subject.name
-    subject_name.short_description = _('subject')
-
-    def _datetime_with_by(self, obj, attr):
-        d = getattr(obj, attr)
-        if d:
-            d_formated = date_format(localtime(d), 'SHORT_DATETIME_FORMAT')
-            by = getattr(obj, attr + '_by')
-            return mark_safe(f'<span title="{by}">{d_formated}</span>') if by else d_formated
-        return '-'
-
-    def created_with_by(self, obj):
-        return self._datetime_with_by(obj, 'created')
-    created_with_by.admin_order_field = 'created'
-    created_with_by.short_description = _('time of registration')
-
-    def approved_with_by(self, obj):
-        return self._datetime_with_by(obj, 'approved')
-    approved_with_by.admin_order_field = 'approved'
-    approved_with_by.short_description = _('time of approval')
-
-    def payment_requested_with_by(self, obj):
-        return self._datetime_with_by(obj, 'payment_requested')
-    payment_requested_with_by.admin_order_field = 'payment_requested'
-    payment_requested_with_by.short_description = _('payment request time')
-
-    def cancelation_requested_with_by(self, obj):
-        return self._datetime_with_by(obj, 'cancelation_requested')
-    cancelation_requested_with_by.admin_order_field = 'cancelation_requested'
-    cancelation_requested_with_by.short_description = _('time of cancellation request')
-
-    def canceled_with_by(self, obj):
-        return self._datetime_with_by(obj, 'canceled')
-    canceled_with_by.admin_order_field = 'canceled'
-    canceled_with_by.short_description = _('time of cancellation')
-
-    def get_message_recipients(self, request, queryset):
-        return get_user_model().objects.filter(leprikon_registrations__in=queryset).distinct()
-
-    def random_number(self, obj):
-        return int(obj.random_number*1000000000000)
-    random_number.admin_order_field = 'random_number'
-    random_number.short_description = _('random number')
-
-
-@admin.register(SubjectRegistration)
-class SubjectRegistrationAdmin(AdminExportMixin, SendMessageAdminMixin, ChangeformRedirectMixin, admin.ModelAdmin):
-    """ Hidden admin used for raw id fields """
-    list_display = (
-        'id', 'variable_symbol', 'subject', 'participants_list_html', 'group', 'created', 'canceled',
-    )
-    list_filter = (
-        ('subject__school_year', SchoolYearListFilter),
-        'subject__department',
-        ('subject__subject_type', SubjectTypeListFilter),
-        ApprovedListFilter,
-        CanceledListFilter,
-        ('subject', SubjectListFilter),
-        ('subject__leaders', LeaderListFilter),
-    )
-    ordering = ('-created',)
-    search_fields = (
-        'variable_symbol', 'participants__birth_num',
-        'participants__first_name', 'participants__last_name',
-        'participants__parent1_first_name', 'participants__parent1_last_name',
-        'participants__parent2_first_name', 'participants__parent2_last_name',
-        'group_members__first_name', 'group_members__last_name',
-    )
+    @transaction.atomic
+    def save(self, commit=True):
+        super().save()
+        CourseRegistrationPeriod.objects.bulk_create(
+            CourseRegistrationPeriod(
+                registration=self.instance,
+                period=period,
+            )
+            for period in self.cleaned_data.get("periods", self.available_periods)
+        )
+        return self.instance
 
-    def get_model_perms(self, request):
-        return {}
 
-    def has_add_permission(self, request):
-        return False
+class EventRegistrationForm(RegistrationForm):
+    class Meta:
+        model = EventRegistration
+        exclude = (
+            "subject",
+            "subject_variant",
+            "user",
+            "cancelation_requested",
+            "cancelation_requested_by",
+            "canceled",
+            "canceled_by",
+        )
 
-    def has_delete_permission(self, request, obj=None):
-        return False
 
-    def get_actions(self, request):
-        return {}
-
-
-class SubjectPaymentBaseAdmin(AdminExportMixin, admin.ModelAdmin):
-    list_filter = (
-        ('registration__subject__school_year', SchoolYearListFilter),
-        'registration__subject__department',
-        ('registration__subject__subject_type', SubjectTypeListFilter),
-        ('registration__subject', SubjectListFilter),
-        ('registration__subject__leaders', LeaderListFilter),
-    )
-    search_fields = (
-        'registration__subject__name',
-        'registration__participants__first_name',
-        'registration__participants__last_name',
-        'registration__participants__birth_num',
-    )
-    date_hierarchy = 'accounted'
-    ordering = ('-accounted',)
-    raw_id_fields = ('registration',)
-    closed_fields = ('accounted', 'registration', 'amount')
-
-    def is_closed(self, request, obj):
-        return (
-            obj and request.leprikon_site.max_closure_date and
-            request.leprikon_site.max_closure_date > obj.accounted.date()
+class OrderableRegistrationForm(RegistrationForm):
+    class Meta:
+        model = OrderableRegistration
+        exclude = (
+            "subject",
+            "subject_variant",
+            "user",
+            "cancelation_requested",
+            "cancelation_requested_by",
+            "canceled",
+            "canceled_by",
         )
 
-    def has_delete_permission(self, request, obj=None):
-        if self.is_closed(request, obj):
-            return False
-        else:
-            return super().has_delete_permission(request, obj)
 
-    def get_readonly_fields(self, request, obj=None):
-        if obj:
-            # it is strange, but obj given to this method contains values from request.POST
-            # but we need to decide according to current state in database
-            obj = self.model.objects.get(pk=obj.pk)
-        if self.is_closed(request, obj):
-            return self.closed_fields
-        else:
-            return ()
+class RegistrationAdminForm(forms.ModelForm):
+    def __init__(self, data=None, *args, **kwargs):
+        super().__init__(data, *args, **kwargs)
+
+        if "subject_variant" in self.fields:
+            self.fields["subject_variant"].widget.choices.queryset = self.subject.variants.all()
+
+        # choices for agreement options
+        if "agreement_options" in self.fields:
+            instance = kwargs.get("instance")
+            self.fields["agreement_options"].widget.choices = tuple(
+                (agreement.name, tuple((option.id, option.name) for option in agreement.all_options))
+                for agreement in (instance.all_agreements if instance else self.subject.all_registration_agreements)
+            )
+
 
-    def get_actions(self, request):
-        actions = super().get_actions(request)
-        if 'delete_selected' in actions:
-            def delete_selected(model_admin, request, queryset):
-                if request.leprikon_site.max_closure_date:
-                    queryset = queryset.filter(accounted__date__gt=request.leprikon_site.max_closure_date)
-                return admin.actions.delete_selected(model_admin, request, queryset)
-            actions['delete_selected'] = (
-                delete_selected,
-                *actions['delete_selected'][1:]
-            )
-        return actions
-
-    def subject(self, obj):
-        return obj.registration.subject
-    subject.short_description = _('subject')
-
-    def amount_html(self, obj):
-        return format_html(
-            '<b style="color: {color}">{amount}</b>',
-            color=amount_color(obj.amount),
-            amount=currency(abs(obj.amount)),
+class SchoolAdminMixin:
+    def _add_error_required(self, field_name):
+        self.add_error(
+            field_name,
+            ValidationError(
+                self.fields[field_name].error_messages["required"],
+                code="required",
+            ),
         )
-    amount_html.short_description = _('amount')
-    amount_html.admin_order_field = 'amount'
-    amount_html.allow_tags = True
-
-
-@admin.register(SubjectPayment)
-class SubjectPaymentAdmin(PdfExportAdminMixin, SubjectPaymentBaseAdmin):
-    actions = ('send_mail',)
-    list_display = ('accounted', 'download_tag', 'registration', 'payment_type_label', 'amount_html',
-                    'received_by', 'mail_sent', 'note')
-    list_editable = ('note',)
-    list_export = ('accounted', 'registration', 'subject', 'payment_type_label', 'amount')
-    raw_id_fields = ('registration', 'related_payment', 'bankreader_transaction', 'pays_payment')
-    exclude = ('received_by',)
-
-    def get_urls(self):
-        urls = super(SubjectPaymentAdmin, self).get_urls()
-        populate_view = self.admin_site.admin_view(permission_required('leprikon.add_subjectpayment')(self.populate))
-        return [
-            urls_url(r'populate.json$', populate_view, name='leprikon_subjectpayment_populate')
-        ] + urls
 
-    def populate(self, request):
-        if 'related_payment' in request.GET:
-            try:
-                related_payment = get_object_or_404(
-                    SubjectPayment,
-                    id=int(request.GET['related_payment']),
-                    payment_type__in=(SubjectPayment.PAYMENT_TRANSFER, SubjectPayment.RETURN_TRANSFER),
-                )
-            except ValueError:
-                return HttpResponseBadRequest()
-            return JsonResponse({
-                'amount': - related_payment.amount,
-                'payment_type': (
-                    SubjectPayment.RETURN_TRANSFER
-                    if related_payment.payment_type == SubjectPayment.PAYMENT_TRANSFER
-                    else SubjectPayment.PAYMENT_TRANSFER
-                )
-            })
-        elif 'bankreader_transaction' in request.GET:
-            try:
-                bankreader_transaction = get_object_or_404(
-                    BankreaderTransaction,
-                    id=int(request.GET['bankreader_transaction']),
-                )
-            except ValueError:
-                return HttpResponseBadRequest()
-            return JsonResponse({
-                'amount': bankreader_transaction.amount,
-                'payment_type': (
-                    SubjectPayment.PAYMENT_BANK
-                    if bankreader_transaction.amount > 0
-                    else SubjectPayment.RETURN_BANK
-                )
-            })
-        else:
-            return HttpResponseBadRequest()
+    def clean(self):
+        # check required school and class
+        x_group = self.cleaned_data.get(self.x_group)
+        if x_group and x_group.require_school:
+            # require school
+            if self.cleaned_data.get("school"):
+                self.cleaned_data["school_other"] = ""
+            elif not self.cleaned_data.get("school_other"):
+                self._add_error_required("school_other")
+            # require school class
+            if not self.cleaned_data.get("school_class"):
+                self._add_error_required("school_class")
+        else:
+            # delete school and class
+            self.cleaned_data["school"] = None
+            self.cleaned_data["school_other"] = ""
+            self.cleaned_data["school_class"] = ""
+        return self.cleaned_data
+
+
+class RegistrationParticipantAdminForm(RegistrationParticipantFormMixin, SchoolAdminMixin, forms.ModelForm):
+    x_group = "age_group"
+
+    def __init__(self, data=None, *args, **kwargs):
+        super().__init__(data, *args, **kwargs)
+        instance = kwargs.get("instance")
+
+        self.fields["age_group"].widget.choices.queryset = self.subject.age_groups.all()
+        if self.subject.age_groups.count() == 1:
+            self.fields["age_group"].initial = self.subject.age_groups.first()
+
+        questions = self.obj.all_questions if self.obj else self.subject.all_questions
+        answers = instance.get_answers() if instance else {}
+        for q in questions:
+            self.fields["q_" + q.slug].initial = answers.get(q.slug)
+
+        self._setup_required_fields()
+
+    def save(self, commit=True):
+        self.instance.answers = dumps(
+            {
+                q.slug: self.cleaned_data["q_" + q.slug]
+                for q in (self.obj.all_questions if self.obj else self.subject.all_questions)
+            }
+        )
+        self._set_birth_date_gender()
+        return super().save(commit)
 
-    def save_model(self, request, obj, form, change):
-        if not change:
-            obj.received_by = request.user
-        super(SubjectPaymentAdmin, self).save_model(request, obj, form, change)
-
-    def send_mail(self, request, queryset):
-        for payment in queryset.all():
-            payment.send_mail()
-        self.message_user(request, _('Selected items were sent by e-mail.'))
-    send_mail.short_description = _('Send selected items by e-mail')
+
+class RegistrationGroupAdminForm(SchoolAdminMixin, forms.ModelForm):
+    x_group = "target_group"
+
+    def __init__(self, data=None, *args, **kwargs):
+        super().__init__(data, *args, **kwargs)
+        instance = kwargs.get("instance")
+
+        self.fields["target_group"].widget.choices.queryset = self.subject.target_groups.all()
+
+        questions = self.obj.all_questions if self.obj else self.subject.all_questions
+        answers = instance.get_answers() if instance else {}
+        for q in questions:
+            self.fields["q_" + q.slug].initial = answers.get(q.slug)
+
+    def save(self, commit=True):
+        self.instance.answers = dumps(
+            {
+                q.slug: self.cleaned_data["q_" + q.slug]
+                for q in (self.obj.all_questions if self.obj else self.subject.all_questions)
+            }
+        )
+        return super().save(commit)
```

### Comparing `leprikon-3.0.0/leprikon/admin/user.py` & `leprikon-3.5.0/leprikon/admin/user.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,178 +1,174 @@
 from django import forms
-from django.conf.urls import url as urls_url
 from django.contrib import admin
 from django.contrib.auth import get_user_model, login
 from django.contrib.auth.decorators import permission_required
 from django.contrib.messages import ERROR
 from django.http import HttpResponseRedirect
 from django.shortcuts import get_object_or_404, render
-from django.urls import reverse
-from django.utils.translation import ugettext_lazy as _
+from django.urls import path, reverse
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
 from sentry_sdk import capture_exception
 from user_unique_email.admin import UserAdmin as _UserAdmin
 
-from ..forms.user import (
-    PasswordResetForm, UserAdminChangeForm, UserAdminCreateForm,
-)
-from ..utils import merge_users
+from ..forms.user import PasswordResetForm, UserAdminChangeForm, UserAdminCreateForm
+from ..utils import attributes, merge_users
 from .export import AdminExportMixin
 from .messages import SendMessageAdminMixin
 
 User = get_user_model()
 admin.site.unregister(User)
 
 
 class IsLeaderListFilter(admin.SimpleListFilter):
-    parameter_name = 'leprikon_leader__school_years'
-    title = _('leader')
+    parameter_name = "leprikon_leader__school_years"
+    title = _("leader")
 
     def __init__(self, request, params, model, model_admin):
         self.school_year = request.school_year
         super().__init__(request, params, model, model_admin)
 
     def expected_parameters(self):
         return [self.parameter_name]
 
     def lookups(self, request, model_admin):
-        return ((self.school_year.id, _('Yes')),)
+        return ((self.school_year.id, _("Yes")),)
 
     def queryset(self, request, queryset):
         value = self.value()
         if not value:
             return queryset
         return queryset.filter(leprikon_leader__school_years__id__exact=value)
 
 
 @admin.register(User)
 class UserAdmin(AdminExportMixin, SendMessageAdminMixin, _UserAdmin):
-    actions = ('merge', 'reset_password')
+    actions = SendMessageAdminMixin.actions + AdminExportMixin.actions + ("merge", "reset_password")
     add_form = UserAdminCreateForm
     add_fieldsets = (
-        (None, {
-            'classes': ('wide',),
-            'fields': ('username', 'first_name', 'last_name', 'email'),
-        }),
+        (
+            None,
+            {
+                "classes": ("wide",),
+                "fields": ("username", "first_name", "last_name", "email"),
+            },
+        ),
     )
     form = UserAdminChangeForm
-    list_filter = _UserAdmin.list_filter + (
-        IsLeaderListFilter,
-    )
+    list_filter = _UserAdmin.list_filter + (IsLeaderListFilter,)
 
+    @attributes(short_description=_("Merge selected user accounts"))
     def merge(self, request, queryset):
         class MergeForm(forms.Form):
             target = forms.ModelChoiceField(
-                label=_('Target user'),
-                help_text=_('All information will be merged into selected account.'),
+                label=_("Target user"),
+                help_text=_("All information will be merged into selected account."),
                 queryset=queryset,
             )
-        if request.POST.get('post', 'no') == 'yes':
+
+        if request.POST.get("post", "no") == "yes":
             form = MergeForm(request.POST)
             if form.is_valid():
-                target = form.cleaned_data['target']
+                target = form.cleaned_data["target"]
                 for user in queryset.all():
                     if user != target:
                         try:
                             merge_users(user, target)
-                            self.message_user(request, _('User {} was merged into user {}.').format(user, target))
+                            self.message_user(request, _("User {} was merged into user {}.").format(user, target))
                         except Exception:
                             self.message_user(
-                                request, _('Can not merge user {} into user {}.').format(user, target),
-                                level=ERROR
+                                request, _("Can not merge user {} into user {}.").format(user, target), level=ERROR
                             )
                 return
         else:
             form = MergeForm()
-        return render(request, 'leprikon/admin/merge.html', {
-            'title': _('Select target user for merge'),
-            'question': _('Are you sure you want to merge selected users into one? '
-                          'All participants, parents, registrations and other related information '
-                          'will be added to the target user account and the remaining users will be deleted.'),
-            'queryset': queryset,
-            'objects_title': _('Users'),
-            'form_title': _('Select target account for merge'),
-            'opts': self.model._meta,
-            'form': form,
-            'action_checkbox_name': admin.helpers.ACTION_CHECKBOX_NAME,
-        })
-    merge.short_description = _('Merge selected user accounts')
+        return render(
+            request,
+            "leprikon/admin/merge.html",
+            {
+                "title": _("Select target user for merge"),
+                "question": _(
+                    "Are you sure you want to merge selected users into one? "
+                    "All participants, parents, registrations and other related information "
+                    "will be added to the target user account and the remaining users will be deleted."
+                ),
+                "queryset": queryset,
+                "objects_title": _("Users"),
+                "form_title": _("Select target account for merge"),
+                "opts": self.model._meta,
+                "form": form,
+                "action_checkbox_name": admin.helpers.ACTION_CHECKBOX_NAME,
+            },
+        )
 
+    @attributes(short_description=_("Send instructions to reset password to selected users"))
     def reset_password(self, request, queryset):
         form = PasswordResetForm()
         for user in queryset.all():
             try:
-                form.cleaned_data = {'email': user.email}
-                form.save(
-                    email_template_name='leprikon/password_reset_email.html'
-                )
-                self.message_user(request, _('Instructions were send to user {}.').format(user))
+                form.cleaned_data = {"email": user.email}
+                form.save(email_template_name="leprikon/password_reset_email.html")
+                self.message_user(request, _("Instructions were send to user {}.").format(user))
             except Exception:
                 capture_exception()
-                self.message_user(
-                    request, _('Can not send instructions to user {}.').format(user),
-                    level=ERROR
-                )
-    reset_password.short_description = _('Send instructions to reset password to selected users')
+                self.message_user(request, _("Can not send instructions to user {}.").format(user), level=ERROR)
 
     def get_list_display(self, request):
-        list_display = ['id'] + list(super(UserAdmin, self).get_list_display(request))
+        list_display = ["id"] + list(super().get_list_display(request))
         if request.user.is_superuser:
-            list_display += ['login_as_link_superuser']
-        elif request.user.has_perm('auth.change_user'):
-            list_display += ['login_as_link']
+            list_display += ["login_as_link_superuser"]
+        elif request.user.has_perm("auth.change_user"):
+            list_display += ["login_as_link"]
         return list_display
 
     def get_readonly_fields(self, request, obj=None):
-        readonly_fields = list(super(UserAdmin, self).get_readonly_fields(request, obj)) + [
-            'last_login',
-            'date_joined',
+        readonly_fields = list(super().get_readonly_fields(request, obj)) + [
+            "last_login",
+            "date_joined",
         ]
         if not request.user.is_superuser:
-            readonly_fields += ['is_staff', 'is_superuser', 'groups', 'user_permissions']
+            readonly_fields += ["is_staff", "is_superuser", "groups", "user_permissions"]
         return readonly_fields
 
-    def get_search_fields(self, request):
-        return list(super(UserAdmin, self).get_search_fields(request)) + [
-            'leprikon_parents__first_name',
-            'leprikon_parents__last_name',
-            'leprikon_parents__email',
-            'leprikon_participants__first_name',
-            'leprikon_participants__last_name',
-            'leprikon_participants__email',
-        ]
-
     def get_urls(self):
-        urls = super(UserAdmin, self).get_urls()
-        login_as_view = self.admin_site.admin_view(permission_required('auth.change_user')(self.login_as))
-        return [urls_url(
-            r'(?P<user_id>\d+)/login-as/$',
-            login_as_view,
-            name=f'{User._meta.app_label}_{User._meta.model_name}_login_as',
-        )] + urls
+        urls = super().get_urls()
+        login_as_view = self.admin_site.admin_view(permission_required("auth.change_user")(self.login_as))
+        return [
+            path(
+                "<int:user_id>/login-as/",
+                login_as_view,
+                name=f"{User._meta.app_label}_{User._meta.model_name}_login_as",
+            )
+        ] + urls
 
     def login_as(self, request, user_id):
         if request.user.is_superuser:
             user = get_object_or_404(get_user_model(), id=user_id)
         else:
             user = get_object_or_404(get_user_model(), id=user_id, is_staff=False, is_superuser=False)
-        user.backend = 'django.contrib.auth.backends.ModelBackend'
+        user.backend = "django.contrib.auth.backends.ModelBackend"
         login(request, user)
-        return HttpResponseRedirect(reverse('leprikon:summary'))
+        return HttpResponseRedirect(reverse("leprikon:summary"))
 
+    @attributes(short_description=_("login"))
     def login_as_link(self, obj):
-        return '<a href="{url}">{text}</a>'.format(
-            url=reverse(f'admin:{User._meta.app_label}_{User._meta.model_name}_login_as', args=[obj.id]),
-            text=_('login')
-        ) if not obj.is_staff and not obj.is_superuser else ''
-    login_as_link.allow_tags = True
-    login_as_link.short_description = _('login')
+        return mark_safe(
+            '<a href="{url}">{text}</a>'.format(
+                url=reverse(f"admin:{User._meta.app_label}_{User._meta.model_name}_login_as", args=[obj.id]),
+                text=_("login"),
+            )
+            if not obj.is_staff and not obj.is_superuser
+            else ""
+        )
 
+    @attributes(short_description=_("login"))
     def login_as_link_superuser(self, obj):
-        return '<a href="{url}">{text}</a>'.format(
-            url=reverse(f'admin:{User._meta.app_label}_{User._meta.model_name}_login_as', args=[obj.id]),
-            text=_('login')
+        return mark_safe(
+            '<a href="{url}">{text}</a>'.format(
+                url=reverse(f"admin:{User._meta.app_label}_{User._meta.model_name}_login_as", args=[obj.id]),
+                text=_("login"),
+            )
         )
-    login_as_link_superuser.allow_tags = True
-    login_as_link_superuser.short_description = _('login')
 
     def get_message_recipients(self, request, queryset):
         return queryset.all()
```

### Comparing `leprikon-3.0.0/leprikon/apps.py` & `leprikon-3.5.0/leprikon/apps.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,41 +1,42 @@
 from django.apps import AppConfig
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from . import bankreaders  # noqa
 
 
 class LeprikonConfig(AppConfig):
-    name = 'leprikon'
-    verbose_name = _('Leprikon')
+    name = "leprikon"
+    verbose_name = _("Leprikon")
 
     def ready(self):
-
         # ensure that current LeprikonSite exists
         from .models.leprikonsite import LeprikonSite
+
         try:
             LeprikonSite.objects.get_current()
         except Exception:
             pass
 
         # create leprikon page on first run
         from cms.api import create_page
         from cms.constants import TEMPLATE_INHERITANCE_MAGIC
         from menus.menu_pool import menu_pool
 
         from .conf import settings
+
         try:
             create_page(
-                title='Leprikón',
+                title="Leprikón",
                 template=TEMPLATE_INHERITANCE_MAGIC,
                 language=settings.LANGUAGE_CODE,
-                slug='leprikon',
-                apphook='LeprikonApp',
-                apphook_namespace='leprikon',
-                reverse_id='leprikon',
+                slug="leprikon",
+                apphook="LeprikonApp",
+                apphook_namespace="leprikon",
+                reverse_id="leprikon",
                 in_navigation=True,
-                navigation_extenders='LeprikonMenu',
+                navigation_extenders="LeprikonMenu",
                 published=True,
             ).set_as_homepage()
             menu_pool.clear()
         except Exception:
             pass
```

### Comparing `leprikon-3.0.0/leprikon/cms_menus.py` & `leprikon-3.5.0/leprikon/cms_menus.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,204 +1,264 @@
 from cms.menu_bases import CMSAttachMenu
 from django.db.models.signals import post_delete, post_save
 from django.urls import NoReverseMatch, reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from menus.base import Menu, Modifier, NavigationNode
 from menus.menu_pool import menu_pool
 from social_django.context_processors import backends
 
 from .models.subjects import SubjectType
 from .utils import current_url, first_upper, url_with_back
 
 
 @menu_pool.register_menu
 class LeprikonMenu(CMSAttachMenu):
-    name = _('Leprikon')
+    name = _("Leprikon")
 
     def get_nodes(self, request):
         """
         This method is used to build the menu tree.
         """
         try:
             nodes = []
-            nodes.append(NavigationNode(
-                _('Summary'),
-                reverse('leprikon:summary'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
-            nodes.append(NavigationNode(
-                _('Reports'),
-                reverse('leprikon:report_list'),
-                len(nodes),
-                attr={'require_staff': True},
-            ))
-            nodes.append(NavigationNode(
-                _('Leader'),
-                reverse('leprikon:leader_summary'),
-                len(nodes),
-                attr={'require_leader': True},
-            ))
+            nodes.append(
+                NavigationNode(
+                    _("Summary"),
+                    reverse("leprikon:summary"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Reports"),
+                    reverse("leprikon:report_list"),
+                    len(nodes),
+                    attr={"require_staff": True},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Leader"),
+                    reverse("leprikon:leader_summary"),
+                    len(nodes),
+                    attr={"require_leader": True},
+                )
+            )
             for subject_type in SubjectType.objects.all():
-                nodes.append(NavigationNode(
-                    first_upper(_('My {subject_type}').format(subject_type=subject_type.plural)),
-                    reverse('leprikon:subject_list_mine', kwargs={'subject_type': subject_type.slug}),
-                    len(nodes),
-                    attr={'require_leader': True},
-                ))
-            nodes.append(NavigationNode(
-                _('Alternating'),
-                reverse('leprikon:alternating'),
-                len(nodes),
-                attr={'require_leader': True},
-            ))
-            nodes.append(NavigationNode(
-                _('Timesheets'),
-                reverse('leprikon:timesheet_list'),
-                len(nodes),
-                attr={'require_leader': True},
-            ))
-            nodes.append(NavigationNode(
-                _('Messages'),
-                reverse('leprikon:message_list'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
-            nodes.append(NavigationNode(
-                _('Registrations'),
-                reverse('leprikon:registration_list'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
-            nodes.append(NavigationNode(
-                _('Payments'),
-                reverse('leprikon:payment_list'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
-            nodes.append(NavigationNode(
-                _('Participants'),
-                reverse('leprikon:participant_list'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
-            nodes.append(NavigationNode(
-                _('Billing information'),
-                reverse('leprikon:billing_info_list'),
-                len(nodes),
-                attr={'visible_for_anonymous': False},
-            ))
+                nodes.append(
+                    NavigationNode(
+                        first_upper(_("My {subject_type}").format(subject_type=subject_type.plural)),
+                        reverse("leprikon:subject_list_mine", kwargs={"subject_type": subject_type.slug}),
+                        len(nodes),
+                        attr={"require_leader": subject_type.slug},
+                    )
+                )
+            nodes.append(
+                NavigationNode(
+                    _("Alternating"),
+                    reverse("leprikon:alternating"),
+                    len(nodes),
+                    attr={"require_leader": True},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Timesheets"),
+                    reverse("leprikon:timesheet_list"),
+                    len(nodes),
+                    attr={"require_leader": True},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Messages"),
+                    reverse("leprikon:message_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Registrations"),
+                    reverse("leprikon:registration_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Payments"),
+                    reverse("leprikon:payment_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Donations"),
+                    reverse("leprikon:donation_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Participants"),
+                    reverse("leprikon:participant_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
+            nodes.append(
+                NavigationNode(
+                    _("Billing information"),
+                    reverse("leprikon:billing_info_list"),
+                    len(nodes),
+                    attr={"visible_for_anonymous": False},
+                )
+            )
             return nodes
         except NoReverseMatch:
             return []
 
 
 @menu_pool.register_menu
 class UserMenu(Menu):
     def get_nodes(self, request):
         """
         This method is used to build the menu tree.
         """
         nodes = []
 
         # anonymous user
-        nodes.append(NavigationNode(
-            _('Log in'),
-            reverse('leprikon:user_login'),
-            len(nodes),
-            attr={'visible_for_authenticated': False, 'add_url_back': True},
-        ))
-        nodes.append(NavigationNode(
-            _('Create account'),
-            reverse('leprikon:user_create'),
-            len(nodes),
-            attr={'visible_for_authenticated': False, 'add_url_back': True},
-        ))
-        nodes.append(NavigationNode(
-            _('Reset password'),
-            reverse('leprikon:password_reset'),
-            len(nodes),
-            attr={'visible_for_authenticated': False, 'add_url_back': True},
-        ))
+        nodes.append(
+            NavigationNode(
+                _("Log in"),
+                reverse("leprikon:user_login"),
+                len(nodes),
+                attr={"visible_for_authenticated": False, "add_url_back": True},
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Create account"),
+                reverse("leprikon:user_create"),
+                len(nodes),
+                attr={"visible_for_authenticated": False, "add_url_back": True},
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Reset password"),
+                reverse("leprikon:password_reset"),
+                len(nodes),
+                attr={"visible_for_authenticated": False, "add_url_back": True},
+            )
+        )
 
         # user settings
-        nodes.append(NavigationNode(
-            _('Change user details'),
-            reverse('leprikon:user_update'),
-            len(nodes),
-            attr={'visible_for_anonymous': False, 'add_url_back': True},
-        ))
-        nodes.append(NavigationNode(
-            _('Change e-mail'),
-            reverse('leprikon:user_email'),
-            len(nodes),
-            attr={'visible_for_anonymous': False, 'add_url_back': True},
-        ))
-        nodes.append(NavigationNode(
-            _('Change password'),
-            reverse('leprikon:user_password'),
-            len(nodes),
-            attr={'visible_for_anonymous': False, 'add_url_back': True},
-        ))
-        nodes.append(NavigationNode(
-            _('Link with Google account'),
-            reverse('social:begin', args=('google-oauth2',)),
-            len(nodes),
-            attr={'visible_for_anonymous': False, 'add_url_back': True,
-                  'social_backend': 'google-oauth2', 'social_btn': 'google'},
-        ))
-        nodes.append(NavigationNode(
-            _('Link with Facebook account'),
-            reverse('social:begin', args=('facebook',)),
-            len(nodes),
-            attr={'visible_for_anonymous': False, 'add_url_back': True,
-                  'social_backend': 'facebook', 'social_btn': 'facebook'},
-        ))
-        nodes.append(NavigationNode(
-            _('Log out'),
-            reverse('leprikon:user_logout'),
-            len(nodes),
-            attr={'visible_for_anonymous': False},
-        ))
+        nodes.append(
+            NavigationNode(
+                _("Change user details"),
+                reverse("leprikon:user_update"),
+                len(nodes),
+                attr={"visible_for_anonymous": False, "add_url_back": True},
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Change e-mail"),
+                reverse("leprikon:user_email"),
+                len(nodes),
+                attr={"visible_for_anonymous": False, "add_url_back": True},
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Change password"),
+                reverse("leprikon:user_password"),
+                len(nodes),
+                attr={"visible_for_anonymous": False, "add_url_back": True},
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Link with Google account"),
+                reverse("social:begin", args=("google-oauth2",)),
+                len(nodes),
+                attr={
+                    "visible_for_anonymous": False,
+                    "add_url_back": True,
+                    "social_backend": "google-oauth2",
+                    "social_btn": "google",
+                },
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Link with Facebook account"),
+                reverse("social:begin", args=("facebook",)),
+                len(nodes),
+                attr={
+                    "visible_for_anonymous": False,
+                    "add_url_back": True,
+                    "social_backend": "facebook",
+                    "social_btn": "facebook",
+                },
+            )
+        )
+        nodes.append(
+            NavigationNode(
+                _("Log out"),
+                reverse("leprikon:user_logout"),
+                len(nodes),
+                attr={"visible_for_anonymous": False},
+            )
+        )
         return nodes
 
 
 @menu_pool.register_modifier
 class LeprikonModifier(Modifier):
     def modify(self, request, nodes, namespace, root_id, post_cut, breadcrumb):
         if post_cut or breadcrumb:
             return nodes
         final = []
-        backends_not_associated = backends(request)['backends']['not_associated']
+        backends_not_associated = backends(request)["backends"]["not_associated"]
         for node in nodes:
             show = True
-            if node.attr.get('require_leader', False):
-                if not request.leader or not request.leader.school_years.filter(id=request.school_year.id).exists():
+            require_leader = node.attr.get("require_leader", False)
+            if require_leader:
+                kwargs = {"school_year": request.school_year}
+                if isinstance(require_leader, str):
+                    kwargs["subject_type__slug"] = require_leader
+                if not request.leader or not request.leader.subjects.filter(**kwargs).exists():
                     show = False
-            if node.attr.get('require_staff', False) and not request.user.is_staff:
+            if node.attr.get("require_staff", False) and not request.user.is_staff:
                 show = False
-            if node.attr.get('social_backend') and (node.attr.get('social_backend') not in backends_not_associated):
+            if node.attr.get("social_backend") and (node.attr.get("social_backend") not in backends_not_associated):
                 show = False
             if show:
-                if node.attr.get('add_url_back', False):
+                if node.attr.get("add_url_back", False):
                     node.url = url_with_back(node.url, current_url(request))
                 final.append(node)
             else:
                 if node.parent and node in node.parent.children:
                     node.parent.children.remove(node)
                 continue
         return final
 
 
 @menu_pool.register_modifier
 class NamespaceModifier(Modifier):
     def modify(self, request, nodes, namespace, root_id, post_cut, breadcrumb):
         if namespace and not (post_cut or breadcrumb):
-            namespaces = namespace.split(',')
-            return [node for node in nodes if node.namespace.split(':')[0] in namespaces]
+            namespaces = namespace.split(",")
+            return [node for node in nodes if node.namespace.split(":")[0] in namespaces]
         else:
             return nodes
 
 
 # clear menu cache with each reload
 try:
     menu_pool.clear()
```

### Comparing `leprikon-3.0.0/leprikon/cms_plugins/events.py` & `leprikon-3.5.0/leprikon/cms_plugins/orderables.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,34 +1,32 @@
 from cms.plugin_pool import plugin_pool
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
-from ..models.events import (
-    EventListPlugin, EventPlugin, FilteredEventListPlugin,
-)
+from ..models.orderables import FilteredOrderableListPlugin, OrderableListPlugin, OrderablePlugin
 from .base import LeprikonPluginBase
 
 
 @plugin_pool.register_plugin
-class LeprikonEventPlugin(LeprikonPluginBase):
-    name = _('Event')
-    model = EventPlugin
-    raw_id_fields = ('event',)
+class LeprikonOrderablePlugin(LeprikonPluginBase):
+    name = _("Orderable event")
+    model = OrderablePlugin
+    raw_id_fields = ("orderable",)
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/event/%s.html' % instance.template
+        return "leprikon/cms/orderable/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
-class LeprikonEventListPlugin(LeprikonPluginBase):
-    name = _('Event list')
-    model = EventListPlugin
-    filter_horizontal = ('age_groups', 'target_groups', 'groups', 'leaders')
+class LeprikonOrderableListPlugin(LeprikonPluginBase):
+    name = _("Orderable list")
+    model = OrderableListPlugin
+    filter_horizontal = ("age_groups", "target_groups", "groups", "leaders")
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/event_list/%s.html' % instance.template
+        return "leprikon/cms/orderable_list/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
-class LeprikonFilteredEventListPlugin(LeprikonPluginBase):
-    name = _('Event list with search form')
-    model = FilteredEventListPlugin
-    render_template = 'leprikon/cms/event_list_filtered.html'
+class LeprikonFilteredOrderableListPlugin(LeprikonPluginBase):
+    name = _("Orderable list with search form")
+    model = FilteredOrderableListPlugin
+    render_template = "leprikon/cms/orderable_list_filtered.html"
```

### Comparing `leprikon-3.0.0/leprikon/cms_plugins/leaders.py` & `leprikon-3.5.0/leprikon/cms_plugins/leaders.py`

 * *Files 7% similar despite different names*

```diff
@@ -1,33 +1,31 @@
 from cms.plugin_pool import plugin_pool
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
-from ..models.roles import (
-    FilteredLeaderListPlugin, LeaderListPlugin, LeaderPlugin,
-)
+from ..models.roles import FilteredLeaderListPlugin, LeaderListPlugin, LeaderPlugin
 from .base import LeprikonPluginBase
 
 
 @plugin_pool.register_plugin
 class LeprikonLeaderPlugin(LeprikonPluginBase):
-    name = _('Leader')
+    name = _("Leader")
     model = LeaderPlugin
-    raw_id_fields = ('leader',)
+    raw_id_fields = ("leader",)
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/leader/%s.html' % instance.template
+        return "leprikon/cms/leader/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
 class LeprikonLeaderListPlugin(LeprikonPluginBase):
-    name = _('Leader list')
+    name = _("Leader list")
     model = LeaderListPlugin
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/leader_list/%s.html' % instance.template
+        return "leprikon/cms/leader_list/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
 class LeprikonFilteredLeaderListPlugin(LeprikonPluginBase):
-    name = _('Leader list with search form')
+    name = _("Leader list with search form")
     model = FilteredLeaderListPlugin
-    render_template = 'leprikon/cms/leader_list_filtered.html'
+    render_template = "leprikon/cms/leader_list_filtered.html"
```

### Comparing `leprikon-3.0.0/leprikon/cms_plugins/orderables.py` & `leprikon-3.5.0/leprikon/cms_plugins/courses.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,34 +1,32 @@
 from cms.plugin_pool import plugin_pool
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 
-from ..models.orderables import (
-    FilteredOrderableListPlugin, OrderableListPlugin, OrderablePlugin,
-)
+from ..models.courses import CourseListPlugin, CoursePlugin, FilteredCourseListPlugin
 from .base import LeprikonPluginBase
 
 
 @plugin_pool.register_plugin
-class LeprikonOrderablePlugin(LeprikonPluginBase):
-    name = _('Orderable event')
-    model = OrderablePlugin
-    raw_id_fields = ('orderable',)
+class LeprikonCoursePlugin(LeprikonPluginBase):
+    name = _("Course")
+    model = CoursePlugin
+    raw_id_fields = ("course",)
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/orderable/%s.html' % instance.template
+        return "leprikon/cms/course/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
-class LeprikonOrderableListPlugin(LeprikonPluginBase):
-    name = _('Orderable list')
-    model = OrderableListPlugin
-    filter_horizontal = ('age_groups', 'target_groups', 'groups', 'leaders')
+class LeprikonCourseListPlugin(LeprikonPluginBase):
+    name = _("Course list")
+    model = CourseListPlugin
+    filter_horizontal = ("age_groups", "target_groups", "groups", "leaders")
 
     def get_render_template(self, context, instance, placeholder):
-        return 'leprikon/cms/orderable_list/%s.html' % instance.template
+        return "leprikon/cms/course_list/%s.html" % instance.template
 
 
 @plugin_pool.register_plugin
-class LeprikonFilteredOrderableListPlugin(LeprikonPluginBase):
-    name = _('Orderable list with search form')
-    model = FilteredOrderableListPlugin
-    render_template = 'leprikon/cms/orderable_list_filtered.html'
+class LeprikonFilteredCourseListPlugin(LeprikonPluginBase):
+    name = _("Course list with search form")
+    model = FilteredCourseListPlugin
+    render_template = "leprikon/cms/course_list_filtered.html"
```

### Comparing `leprikon-3.0.0/leprikon/cms_toolbars.py` & `leprikon-3.5.0/leprikon/cms_toolbars.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,17 +1,16 @@
 from cms.cms_toolbars import ADMIN_MENU_IDENTIFIER
 from cms.toolbar.items import SubMenu
 from cms.toolbar_base import CMSToolbar
 from cms.toolbar_pool import toolbar_pool
 from django.urls import reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 
 @toolbar_pool.register
 class LeprikonToolbar(CMSToolbar):
-
     def populate(self):
         # Articles item in main menu
         admin_menu = self.toolbar.get_or_create_menu(ADMIN_MENU_IDENTIFIER)
-        position = admin_menu.get_alphabetical_insert_position(_('Leprikon'), SubMenu)
-        url = reverse('admin:app_list', args=('leprikon',))
-        admin_menu.add_sideframe_item(_('Leprikon'), url=url, position=position)
+        position = admin_menu.get_alphabetical_insert_position(_("Leprikon"), SubMenu)
+        url = reverse("admin:app_list", args=("leprikon",))
+        admin_menu.add_sideframe_item(_("Leprikon"), url=url, position=position)
```

### Comparing `leprikon-3.0.0/leprikon/cronjobs.py` & `leprikon-3.5.0/leprikon/cronjobs.py`

 * *Files 4% similar despite different names*

```diff
@@ -10,54 +10,54 @@
 from .models.courses import CourseRegistrationPeriod
 from .models.events import EventRegistration
 from .models.orderables import OrderableRegistration
 
 
 class SentryCronJobBase(CronJobBase):
     def dojob(self):
-        raise NotImplementedError(f'{self.__class__.__name__}.dojob must be implemented.')
+        raise NotImplementedError(f"{self.__class__.__name__}.dojob must be implemented.")
 
     def do(self):
         try:
             with override(settings.LANGUAGE_CODE):
                 return self.dojob()
         except Exception:
             capture_exception()
             raise
 
 
 class SendPaymentRequest(SentryCronJobBase):
     schedule = Schedule(run_at_times=[settings.CRON_SEND_PAYMENT_REQUEST_TIME])
-    code = 'leprikon.cronjobs.SendPaymentRequest'
+    code = "leprikon.cronjobs.SendPaymentRequest"
 
     def dojob(self):
         today = date.today()
         for registration in chain(
             set(
                 registration_period.registration
                 for registration_period in CourseRegistrationPeriod.objects.filter(
                     registration__approved__isnull=False,
                     registration__canceled__isnull=True,
                     payment_requested=False,
                     period__due_from__lte=today,
-                ).select_related('registration')
+                ).select_related("registration")
             ),
             EventRegistration.objects.filter(
                 approved__isnull=False,
                 canceled__isnull=True,
                 payment_requested__isnull=True,
                 subject__event__due_from__lte=today,
             ),
             (
                 registration
                 for registration in OrderableRegistration.objects.filter(
                     approved__isnull=False,
                     canceled__isnull=True,
                     payment_requested__isnull=True,
-                ).select_related('subject__orderable')
+                ).select_related("subject__orderable")
                 if registration.get_due_from() <= today
             ),
         ):
             try:
                 registration.request_payment(None)
             except Exception:
                 print_exc()
```

### Comparing `leprikon-3.0.0/leprikon/forms/courses.py` & `leprikon-3.5.0/leprikon/forms/courses.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,65 +1,69 @@
 from django import forms
 from django.contrib.admin.widgets import FilteredSelectMultiple
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from ..models.courses import CourseDiscount, CourseRegistrationPeriod
-from ..models.schoolyear import SchoolYearPeriod
+from ..models.courses import CourseDiscount, CourseRegistration, CourseRegistrationPeriod
+from ..models.schoolyear import SchoolYearDivision, SchoolYearPeriod
+from ..models.subjects import Subject
 from .subjects import RegistrationAdminForm
 
 
 class CourseRegistrationAdminForm(RegistrationAdminForm):
+    subject: Subject
+    instance: CourseRegistration
     periods = forms.ModelMultipleChoiceField(
         queryset=SchoolYearPeriod.objects.all(),
         widget=FilteredSelectMultiple(
-            verbose_name=_('Periods'),
+            verbose_name=_("Periods"),
             is_stacked=False,
         ),
     )
 
     def __init__(self, *args, **kwargs):
         super().__init__(*args, **kwargs)
-        self.available_periods = self.subject.course.school_year_division.periods.all()
-        self.fields['periods'].widget.choices.queryset = self.available_periods
-        if self.instance:
-            self.fields['periods'].initial = self.available_periods.filter(
-                course_registration_periods__registration=self.instance,
-            )
+        try:
+            self.school_year_division = SchoolYearDivision.objects.get(pk=int(self.data["school_year_division"]))
+        except (KeyError, TypeError, ValueError, SchoolYearDivision.DoesNotExist):
+            if self.instance.school_year_division_id:
+                self.school_year_division = self.instance.school_year_division
+            else:
+                self.school_year_division = self.subject_variant.school_year_division
+        self.available_periods = self.school_year_division.periods.all()
+        self.fields["periods"].widget.choices.queryset = self.available_periods
+        self.fields["periods"].initial = self.available_periods.filter(
+            course_registration_periods__registration=self.instance,
+        )
 
     def _save_m2m(self):
         super()._save_m2m()
-        for period in self.cleaned_data['periods']:
+        for period in self.cleaned_data["periods"]:
             CourseRegistrationPeriod.objects.get_or_create(
                 registration=self.instance,
                 period=period,
             )
-        self.instance.course_registration_periods.exclude(
-            period__in=self.cleaned_data['periods']
-        ).delete()
+        self.instance.course_registration_periods.exclude(period__in=self.cleaned_data["periods"]).delete()
         return self.instance
 
 
 class CourseDiscountAdminForm(forms.ModelForm):
-
     class Meta:
         model = CourseDiscount
-        fields = ['registration', 'registration_period', 'accounted', 'amount', 'explanation']
+        fields = ["registration", "registration_period", "accounted", "amount", "explanation"]
 
     def __init__(self, *args, **kwargs):
         super().__init__(*args, **kwargs)
-        if 'registration_period' in self.fields:
+        if "registration_period" in self.fields:
             try:
                 if self.data:
-                    registration_id = int(self.data['registration'])
+                    registration_id = int(self.data["registration"])
                 elif self.initial:
-                    registration_id = int(self.initial['registration'])
+                    registration_id = int(self.initial["registration"])
                 else:
                     registration_id = self.instance.registration_id
             except Exception:
                 registration_id = None
-            self.fields[
-                'registration_period'
-            ].widget.choices.queryset = self.fields[
-                'registration_period'
+            self.fields["registration_period"].widget.choices.queryset = self.fields[
+                "registration_period"
             ].widget.choices.queryset.filter(
                 registration_id=registration_id,
             )
```

### Comparing `leprikon-3.0.0/leprikon/forms/form.py` & `leprikon-3.5.0/leprikon/forms/form.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 class FormMixin(object):
-    required_css_class = 'required'
+    required_css_class = "required"
     use_get = False
 
     def __init__(self, *args, **kwargs):
-        super(FormMixin, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         for f in self.fields:
             # add form-control to classes
-            classes = set(self.fields[f].widget.attrs.get('class', '').split())
-            classes.add('form-control')
-            self.fields[f].widget.attrs['class'] = ' '.join(classes)
+            classes = set(self.fields[f].widget.attrs.get("class", "").split())
+            classes.add("form-control")
+            self.fields[f].widget.attrs["class"] = " ".join(classes)
             # add data-type
-            if 'data-type' not in self.fields[f].widget.attrs:
-                self.fields[f].widget.attrs['data-type'] = self.fields[f].__class__.__name__
+            if "data-type" not in self.fields[f].widget.attrs:
+                self.fields[f].widget.attrs["data-type"] = self.fields[f].__class__.__name__
```

### Comparing `leprikon-3.0.0/leprikon/forms/messages.py` & `leprikon-3.5.0/leprikon/forms/messages.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,66 +1,64 @@
 from django import forms
 from django.contrib.admin import widgets
 from django.contrib.auth import get_user_model
 from django.db.models import Q
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..models.messages import Message, MessageRecipient
 from .form import FormMixin
 
 
 class MessageFilterForm(FormMixin, forms.Form):
-    q = forms.CharField(label=_('Search term'), required=False)
+    q = forms.CharField(label=_("Search term"), required=False)
 
     def __init__(self, user, *args, **kwargs):
-        super(MessageFilterForm, self).__init__(*args, **kwargs)
+        super().__init__(*args, **kwargs)
         self.qs = user.leprikon_messages.all()
 
     def get_queryset(self):
         if not self.is_valid():
             return self.qs
         qs = self.qs
-        for word in self.cleaned_data['q'].split():
-            qs = qs.filter(
-                Q(message__subject__icontains=word) |
-                Q(message__text__icontains=word)
-            )
+        for word in self.cleaned_data["q"].split():
+            qs = qs.filter(Q(message__subject__icontains=word) | Q(message__text__icontains=word))
         return qs.distinct()
 
 
 class MessageAdminForm(forms.ModelForm):
     recipients = forms.MultipleChoiceField(
         choices=lambda: [
-            (u.id, '{} ({})'.format(u.get_username(), u.get_full_name()))
-            for u in get_user_model().objects.all()
+            (u.id, "{} ({})".format(u.get_username(), u.get_full_name())) for u in get_user_model().objects.all()
         ],
         widget=widgets.FilteredSelectMultiple(
-            verbose_name=_('Recipients'),
+            verbose_name=_("Recipients"),
             is_stacked=False,
         ),
-        label=_('Recipients'),
+        label=_("Recipients"),
         required=False,
     )
 
     class Meta:
         model = Message
-        fields = ['sender', 'subject', 'text']
+        fields = ["sender", "subject", "text"]
 
     def __init__(self, *args, **kwargs):
-        instance = kwargs.get('instance', None)
+        instance = kwargs.get("instance", None)
         if instance:
-            kwargs['initial'] = kwargs.get('initial', {})
-            kwargs['initial']['recipients'] = list(set(
-                kwargs['initial'].get('recipients', []) +
-                [r[0] for r in instance.recipients.values_list('recipient_id')]
-            ))
+            kwargs["initial"] = kwargs.get("initial", {})
+            kwargs["initial"]["recipients"] = list(
+                set(
+                    kwargs["initial"].get("recipients", [])
+                    + [r[0] for r in instance.recipients.values_list("recipient_id")]
+                )
+            )
         super().__init__(*args, **kwargs)
 
     def _save_m2m(self):
-        super(MessageAdminForm, self)._save_m2m()
-        recipients = set(map(int, self.cleaned_data['recipients']))
+        super()._save_m2m()
+        recipients = set(map(int, self.cleaned_data["recipients"]))
         for recipient in self.instance.all_recipients:
             if recipient.recipient_id not in recipients:
                 recipient.delete()
         for user_id in recipients:
             MessageRecipient.objects.get_or_create(recipient_id=user_id, message=self.instance)
         return self.instance
```

### Comparing `leprikon-3.0.0/leprikon/forms/reports/orderables.py` & `leprikon-3.5.0/leprikon/forms/reports/orderables.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,28 +1,36 @@
 from django import forms
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ...models.orderables import Orderable
 from ..form import FormMixin
 
 
 class OrderablePaymentsForm(FormMixin, forms.Form):
-    date_start = forms.DateField(label=_('Start date'))
-    date_end = forms.DateField(label=_('End date'))
+    date_start = forms.DateField(label=_("Start date"))
+    date_end = forms.DateField(label=_("End date"))
 
 
 class OrderablePaymentsStatusForm(FormMixin, forms.Form):
-    date = forms.DateField(label=_('Status for date'))
+    date = forms.DateField(label=_("Status for date"))
 
 
 class OrderableStatsForm(FormMixin, forms.Form):
-    date = forms.DateField(label=_('Statistics for date'))
+    date = forms.DateField(label=_("Statistics for date"))
     orderables = forms.ModelMultipleChoiceField(
         queryset=Orderable.objects.all(),
-        label=_('Orderables'),
+        label=_("Orderables"),
+    )
+    paid_only = forms.BooleanField(label=_("Count only paid registrations"), required=False)
+    paid_later = forms.BooleanField(label=_("Count registrations paid later"), required=False)
+    approved_later = forms.BooleanField(label=_("Count registrations approved later"), required=False)
+    unique_participants = forms.BooleanField(label=_("Count only unique participants"), required=False)
+    min_days = forms.IntegerField(
+        label=_("Minimal number of days"),
+        help_text=_("Count only participants attending events that last at least this number of days."),
+        required=False,
     )
-    paid_only = forms.BooleanField(label=_('Count only paid registrations'), required=False)
 
     def __init__(self, *args, **kwargs):
-        school_year = kwargs.pop('school_year')
+        school_year = kwargs.pop("school_year")
         super().__init__(*args, **kwargs)
-        self.fields['orderables'].queryset = Orderable.objects.filter(school_year=school_year)
+        self.fields["orderables"].queryset = Orderable.objects.filter(school_year=school_year)
```

### Comparing `leprikon-3.0.0/leprikon/forms/schoolyear.py` & `leprikon-3.5.0/leprikon/forms/schoolyear.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,23 +1,21 @@
 from django import forms
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
 from ..models.schoolyear import SchoolYear
 
 
 class SchoolYearForm(forms.Form):
     school_year = forms.ModelChoiceField(
-        label=_('School year'),
+        label=_("School year"),
         queryset=SchoolYear.objects.all(),
         empty_label=None,
     )
     back = settings.LEPRIKON_PARAM_BACK
 
     def __init__(self, request, *args, **kwargs):
         if request:
-            kwargs['initial'] = {'school_year': request.school_year}
+            kwargs["initial"] = {"school_year": request.school_year}
         super().__init__(*args, **kwargs)
         if request and not request.user.is_staff:
-            self.fields['school_year'].queryset = (
-                self.fields['school_year'].queryset.filter(active=True)
-            )
+            self.fields["school_year"].queryset = self.fields["school_year"].queryset.filter(active=True)
```

### Comparing `leprikon-3.0.0/leprikon/forms/timesheets.py` & `leprikon-3.5.0/leprikon/forms/timesheets.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,75 +1,82 @@
 from django import forms
 from django.core.exceptions import ValidationError
 from django.utils import formats
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..models.timesheets import Timesheet, TimesheetEntry
 from .fields import ReadonlyField
 from .form import FormMixin
 
 
 class TimesheetEntryAdminForm(forms.ModelForm):
     """
     Validation of ManyToManyField must be performed in form.clean()
     Always use TimesheetEntryAdminForm to change TimesheetEntry
     """
 
     class Meta:
         model = TimesheetEntry
-        fields = ('date', 'start', 'end', 'entry_type', 'description')
+        fields = ("date", "start", "end", "entry_type", "description")
 
     def __init__(self, **kwargs):
-        self.leader = kwargs.pop('leader', None) or kwargs['instance'].timesheet.leader
-        super(TimesheetEntryAdminForm, self).__init__(**kwargs)
+        self.leader = kwargs.pop("leader", None) or kwargs["instance"].timesheet.leader
+        super().__init__(**kwargs)
 
         # make date, start and end read only, if timesheet is already submitted
         if self.instance.id and self.instance.timesheet.submitted:
             self.readonly = True
             self.readonly_fields = [
-                ReadonlyField(label=_('Date'), value=self.instance.date),
-                ReadonlyField(label=_('Start'), value=self.instance.start),
-                ReadonlyField(label=_('End'), value=self.instance.end),
-                ReadonlyField(label=_('Entry type'), value=self.instance.entry_type),
+                ReadonlyField(label=_("Date"), value=self.instance.date),
+                ReadonlyField(label=_("Start"), value=self.instance.start),
+                ReadonlyField(label=_("End"), value=self.instance.end),
+                ReadonlyField(label=_("Entry type"), value=self.instance.entry_type),
             ]
-            self.fields = {'description': self.fields['description']}
+            self.fields = {"description": self.fields["description"]}
         else:
             self.readonly = False
 
     def clean_date(self):
         if self.instance.id:
-            if self.cleaned_data['date'] < self.instance.timesheet.period.start:
-                raise ValidationError(_('The timesheet period {period} starts {start}').format(
-                    period=self.instance.timesheet.period.name,
-                    start=formats.date_format(self.instance.timesheet.period.start, "SHORT_DATE_FORMAT"),
-                ))
-            if self.cleaned_data['date'] > self.instance.timesheet.period.end:
-                raise ValidationError(_('The timesheet period {period} ends {end}').format(
-                    period=self.instance.timesheet.period.name,
-                    end=formats.date_format(self.instance.timesheet.period.end, "SHORT_DATE_FORMAT"),
-                ))
+            if self.cleaned_data["date"] < self.instance.timesheet.period.start:
+                raise ValidationError(
+                    _("The timesheet period {period} starts {start}").format(
+                        period=self.instance.timesheet.period.name,
+                        start=formats.date_format(self.instance.timesheet.period.start, "SHORT_DATE_FORMAT"),
+                    )
+                )
+            if self.cleaned_data["date"] > self.instance.timesheet.period.end:
+                raise ValidationError(
+                    _("The timesheet period {period} ends {end}").format(
+                        period=self.instance.timesheet.period.name,
+                        end=formats.date_format(self.instance.timesheet.period.end, "SHORT_DATE_FORMAT"),
+                    )
+                )
         else:
-            self.instance.timesheet = Timesheet.objects.for_leader_and_date(leader=self.leader,
-                                                                            date=self.cleaned_data['date'])
+            self.instance.timesheet = Timesheet.objects.for_leader_and_date(
+                leader=self.leader, date=self.cleaned_data["date"]
+            )
             if self.instance.timesheet.submitted:
-                raise ValidationError(_('Your timesheet for period {period} has already been submitted.').format(
-                    period=self.instance.timesheet.period.name,
-                ))
-        return self.cleaned_data['date']
+                raise ValidationError(
+                    _("Your timesheet for period {period} has already been submitted.").format(
+                        period=self.instance.timesheet.period.name,
+                    )
+                )
+        return self.cleaned_data["date"]
 
     def clean(self):
         # check overlaping entries
-        if 'date' in self.cleaned_data and 'start' in self.cleaned_data and 'end' in self.cleaned_data:
+        if "date" in self.cleaned_data and "start" in self.cleaned_data and "end" in self.cleaned_data:
             qs = self.instance.timesheet.timesheet_entries.filter(
-                date=self.cleaned_data['date'],
-                start__lt=self.cleaned_data['end'],
-                end__gt=self.cleaned_data['start'],
+                date=self.cleaned_data["date"],
+                start__lt=self.cleaned_data["end"],
+                end__gt=self.cleaned_data["start"],
             )
             if self.instance.id:
                 qs = qs.exclude(id=self.instance.id)
             if qs.exists():
-                raise ValidationError(_('An overlaping entry has already been added in the timesheet.'))
+                raise ValidationError(_("An overlaping entry has already been added in the timesheet."))
         return self.cleaned_data
 
 
 class TimesheetEntryForm(FormMixin, TimesheetEntryAdminForm):
     pass
```

### Comparing `leprikon-3.0.0/leprikon/forms/user.py` & `leprikon-3.5.0/leprikon/forms/user.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,111 +1,107 @@
 from django import forms
 from django.contrib.auth import get_user_model, password_validation
 from django.contrib.auth.forms import (
     AuthenticationForm as _AuthenticationForm,
     PasswordChangeForm as _PasswordChangeForm,
     PasswordResetForm as _PasswordResetForm,
-    SetPasswordForm as _SetPasswordForm, UserChangeForm as _UserChangeForm,
+    SetPasswordForm as _SetPasswordForm,
+    UserChangeForm as _UserChangeForm,
     UserCreationForm as _UserCreationForm,
 )
 from django.core.exceptions import ValidationError
-from django.utils.translation import ugettext_lazy as _
-from verified_email_field.auth import (
-    EmailAuthenticationForm as _EmailAuthenticationForm,
-)
+from django.utils.translation import gettext_lazy as _
+from verified_email_field.auth import EmailAuthenticationForm as _EmailAuthenticationForm
 from verified_email_field.forms import VerifiedEmailField
 
 from .form import FormMixin
 
 User = get_user_model()
 
 
 class UserFormMixin(FormMixin):
-
     def clean_email(self):
-        email = self.cleaned_data['email'].lower()
+        email = self.cleaned_data["email"].lower()
         user_qs = User.objects.filter(email=email)
         if self.instance.pk:
             user_qs = user_qs.exclude(pk=self.instance.pk)
         if email and user_qs.exists():
             raise ValidationError(
-                _('User with this email already exists.'),
-                code='exists',
-                params={'email': email},
+                _("User with this email already exists."),
+                code="exists",
+                params={"email": email},
             )
         else:
             return email
 
 
 class UserAdminCreateForm(UserFormMixin, forms.ModelForm):
-
     # create user with random password
     # users without password may not reset the password themselves
     def save(self, commit=True):
-        user = super(UserAdminCreateForm, self).save(commit)
+        user = super().save(commit)
         user.set_password(User.objects.make_random_password())
         user.save()
         return user
 
     class Meta:
         model = User
-        fields = ['username', 'first_name', 'last_name', 'email']
+        fields = ["username", "first_name", "last_name", "email"]
 
 
 class UserAdminChangeForm(UserFormMixin, _UserChangeForm):
     pass
 
 
 class UserCreateForm(UserFormMixin, _UserCreationForm):
-    email = VerifiedEmailField(label=_('E-mail'), fieldsetup_id='UserCreateForm', required=True)
-    agreement = forms.BooleanField(label=_('I agree with the terms.'), required=True)
+    email = VerifiedEmailField(label=_("E-mail"), fieldsetup_id="UserCreateForm", required=True)
+    agreement = forms.BooleanField(label=_("I agree with the terms."), required=True)
 
     def __init__(self, **kwargs):
-        super(UserCreateForm, self).__init__(**kwargs)
-        self.fields['username'].help_text = None
-        self.fields['password1'].help_text = password_validation.password_validators_help_text_html()
+        super().__init__(**kwargs)
+        self.fields["username"].help_text = None
+        self.fields["password1"].help_text = password_validation.password_validators_help_text_html()
 
     class Meta:
         model = User
-        fields = ['username', 'first_name', 'last_name', 'email']
+        fields = ["username", "first_name", "last_name", "email"]
 
 
 class UserAgreementForm(FormMixin, forms.Form):
-    agreement = forms.BooleanField(label=_('I agree with the terms.'), required=True)
+    agreement = forms.BooleanField(label=_("I agree with the terms."), required=True)
 
 
 class UserEmailForm(UserFormMixin, forms.ModelForm):
-    email = VerifiedEmailField(label=_('E-mail'), fieldsetup_id='UserEmailForm', required=True)
+    email = VerifiedEmailField(label=_("E-mail"), fieldsetup_id="UserEmailForm", required=True)
 
     class Meta:
         model = User
-        fields = ['email']
+        fields = ["email"]
 
 
 class UserUpdateForm(UserFormMixin, forms.ModelForm):
-
     def __init__(self, **kwargs):
-        super(UserUpdateForm, self).__init__(**kwargs)
-        self.fields['username'].help_text = None
+        super().__init__(**kwargs)
+        self.fields["username"].help_text = None
 
     class Meta:
         model = User
-        fields = ['username', 'first_name', 'last_name']
+        fields = ["username", "first_name", "last_name"]
 
 
 class UserLoginForm:
     class PasswordForm(FormMixin, _AuthenticationForm):
         pass
 
     class EmailForm(FormMixin, _EmailAuthenticationForm):
         pass
 
     def __init__(self, request, data=None, **kwargs):
         if data:
-            if 'email_0' in data:
+            if "email_0" in data:
                 self.used_form = self.email_form = self.EmailForm(data=data)
                 self.password_form = self.PasswordForm(request=request)
             else:
                 self.used_form = self.password_form = self.PasswordForm(data=data, request=request)
                 self.email_form = self.EmailForm()
         else:
             self.password_form = self.PasswordForm(request=request)
@@ -120,15 +116,17 @@
 
 class UserPasswordForm(FormMixin, _PasswordChangeForm):
     pass
 
 
 class PasswordResetForm(FormMixin, _PasswordResetForm):
     def get_users(self, email):
-        return User.objects.filter(**{
-            'email__iexact': email,
-            'is_active': True,
-        })
+        return User.objects.filter(
+            **{
+                "email__iexact": email,
+                "is_active": True,
+            }
+        )
 
 
 class SetPasswordForm(FormMixin, _SetPasswordForm):
     pass
```

### Comparing `leprikon-3.0.0/leprikon/locale/cs/LC_MESSAGES/django.mo` & `leprikon-3.5.0/leprikon/locale/cs/LC_MESSAGES/django.mo`

 * *Files 11% similar despite different names*

#### msgunfmt {}

```diff
@@ -1,18 +1,24 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: leprikon\n"
 "Report-Msgid-Bugs-To: \n"
-"Last-Translator: Jakub Dorňák <jakub.dornak@misli.cz>\n"
+"Last-Translator: Jakub Dorňák <jakub.dornak@qbsoftware.cz>\n"
 "Language: cs\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
 "Plural-Forms: nplurals=3; plural=(n==1) ? 0 : (n>=2 && n<=4) ? 1 : 2;\n"
 
+msgid "%d other registration"
+msgid_plural "%d other registrations"
+msgstr[0] "%d další přihláška"
+msgstr[1] "%d další přihlášky"
+msgstr[2] "%d dalších přihlášek"
+
 msgid ", and "
 msgstr " a "
 
 msgid "Account closures"
 msgstr "Uzavření účtu"
 
 msgid "Active Registrations"
@@ -77,14 +83,20 @@
 
 msgid "All information will be merged into selected account."
 msgstr "Všechny informace budou sloučeny do vybraného uživatelského účtu."
 
 msgid "All orderable events"
 msgstr "Všechny akce na objednání"
 
+msgid "All received payments"
+msgstr "Všechny přijaté platby"
+
+msgid "All returned payments"
+msgstr "Všechny vrácené platby"
+
 msgid "All selected courses will be copied to selected school year."
 msgstr "Vybrané kurzy budou zkopírovány do vybraného školního roku."
 
 msgid "All selected events will be copied to selected school year."
 msgstr "Vybrané akce budou zkopírovány do vybraného školního roku."
 
 msgid "All selected leaders will be added to selected school year."
@@ -123,17 +135,14 @@
 
 msgid "Amount can not be zero."
 msgstr "Částka nemůže být nula."
 
 msgid "Amount due"
 msgstr "Částka k úhradě"
 
-msgid "Amount must be {valid_amount}."
-msgstr "Částka musí být {valid_amount}"
-
 msgid "Amount or number of percents"
 msgstr "Částka nebo počet procent"
 
 msgid "An overlaping entry has already been added in the journal."
 msgstr "V deníku už je kolidující záznam."
 
 msgid "An overlaping entry has already been added in the timesheet."
@@ -216,26 +225,35 @@
 
 msgid "Can not send instructions to user {}."
 msgstr "Nepodařilo se odeslat instrukce uživateli {}."
 
 msgid "Cancel"
 msgstr "Zrušit"
 
+msgid "Cancel cancelation request for selected registrations"
+msgstr "Zrušit žádost o odhlášení pro vybrané přihlášky"
+
+msgid "Cancel refund request"
+msgstr "Zrušení žádosti o vrácení přeplatku"
+
 msgid "Cancel selected registrations"
 msgstr "Odhlásit vybrané přihlášky"
 
 msgid "Change billing information"
 msgstr "Upravit fakturační údaje"
 
 msgid "Change e-mail"
 msgstr "Změnit e-mail"
 
 msgid "Change e-mail address"
 msgstr "Změna e-mailové adresy"
 
+msgid "Change journal"
+msgstr "Upravit deník"
+
 msgid "Change journal entry"
 msgstr "Změnit záznam deníku"
 
 msgid "Change parent"
 msgstr "Aktualizace údajů o zástupci"
 
 msgid "Change participant"
@@ -261,20 +279,20 @@
 
 msgid "Citizenship"
 msgstr "Státní občanství"
 
 msgid "Class"
 msgstr "Třída"
 
-msgid "Close chat"
-msgstr "Zavřít chat"
-
 msgid "Company number"
 msgstr "IČ"
 
+msgid "Constant symbol"
+msgstr "Konstantní symbol"
+
 msgid "Contact"
 msgstr "Kontakt"
 
 msgid "Contact person"
 msgstr "Kontaktní osoba"
 
 msgid "Continue"
@@ -291,29 +309,43 @@
 
 msgid "Copy selected school year divisions to another school year"
 msgstr "Kopírovat vybraná členění školního roku do jiného školního roku"
 
 msgid "Count only paid registrations"
 msgstr "Započítat pouze zaplacené přihlášky"
 
+msgid "Count only participants attending at most this number of hours weekly."
+msgstr "Započítat pouze účastníky, kteří docházejí nanejvýš tolik hodin týdně."
+
+msgid ""
+"Count only participants attending events that last at least this number of "
+"days."
+msgstr "Započítat pouze účastníky akcí, které trvají alespoň tolik dní."
+
+msgid "Count only unique participants"
+msgstr "Započítat pouze unikátní účastníky"
+
+msgid "Count registrations approved later"
+msgstr "Započítat přihlášky schválené později"
+
+msgid "Count registrations paid later"
+msgstr "Započítat přihlášky zaplacené později"
+
 msgid "Course"
 msgstr "Kurz"
 
 msgid "Course list"
 msgstr "Výpis kurzů"
 
 msgid "Course list with search form"
 msgstr "Výpis kurzů s vyhledávacím formulářem"
 
 msgid "Course payments"
 msgstr "Platby za kurzy"
 
-msgid "Course payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za kurzy od %(date_start)s do %(date_end)s"
-
 msgid "Course payments status"
 msgstr "Stav plateb za kurzy"
 
 msgid "Course payments status by date %(date)s"
 msgstr "Stav plateb za kurzy ke dni %(date)s"
 
 msgid "Course statistics"
@@ -330,14 +362,17 @@
 
 msgid "Courses count"
 msgstr "Počet kurzů"
 
 msgid "Create account"
 msgstr "Vytvořit účet"
 
+msgid "Create journal"
+msgstr "Vytvořit deník"
+
 msgid "Currently we only accept payments in cash."
 msgstr "Momentálně přijímáme platby pouze v hotovosti."
 
 msgid "Czech"
 msgstr "Čeština"
 
 msgid "Czechia"
@@ -348,26 +383,35 @@
 
 msgid "Date and time of registration"
 msgstr "Datum a čas přihlášení"
 
 msgid "Date must be after the last account closure ({})."
 msgstr "Datum musí být vyšší než datum posledního uzavření účtu ({})."
 
+msgid "Date: %(date)s"
+msgstr "Datum: %(date)s"
+
 msgid "Day of week"
 msgstr "Den v týdnu"
 
 msgid "Debtor"
 msgstr "Dlužník"
 
 msgid "Debtors list"
 msgstr "Seznam dlužníků"
 
 msgid "Debtors list by date %(date)s"
 msgstr "Seznam dlužníků ke dni %(date)s"
 
+msgid "Decision"
+msgstr "Rozhodnutí"
+
+msgid "Decision issued by: %(user)s"
+msgstr "Rozhodnutí vydal(a): %(user)s"
+
 msgid "Default"
 msgstr "Výchozí"
 
 msgid "Delete"
 msgstr "Smazat"
 
 msgid "Delete billing information"
@@ -375,14 +419,17 @@
 
 msgid "Delete information about parent"
 msgstr "Smazat informace o zákonném zástupci"
 
 msgid "Delete information about participant"
 msgstr "Smazat informace o účastníkovi"
 
+msgid "Delete journal"
+msgstr "Smazat deník"
+
 msgid "Delete journal entry"
 msgstr "Smazat záznam deníku"
 
 msgid "Delete timesheet entry"
 msgstr "Smazat záznam výkazu práce"
 
 msgid "Department"
@@ -393,32 +440,44 @@
 
 msgid "Discounts"
 msgstr "Slevy"
 
 msgid "Django Administration"
 msgstr "Správa systému Leprikón"
 
+msgid "Do You really want to cancel the refund request: {}?"
+msgstr "Opravdu chcete smazat žádost o vrácení přeplatku: {}?"
+
 msgid "Do You really want to delete journal entry?"
 msgstr "Opravdu chcete smazat záznam deníku?"
 
 msgid "Do You really want to delete the billing information: {}?"
 msgstr "Opravdu chcete smazat fakturační údaje: {}?"
 
 msgid "Do You really want to delete the information about parent: {}?"
 msgstr "Opravdu chcete smazat informace o zákonném zástupci: {}?"
 
 msgid "Do You really want to delete the information about participant: {}?"
 msgstr "Opravdu chcete smazat informace o účastníkovi: {}?"
 
+msgid "Do You really want to delete the journal {}?"
+msgstr "Opravdu chcete smazat deník {}?"
+
 msgid "Do You really want to delete timesheet entry?"
 msgstr "Opravdu chcete smazat záznam výkazu práce?"
 
 msgid "Documentation"
 msgstr "Dokumentace"
 
+msgid "Donation Type"
+msgstr "Druh daru"
+
+msgid "Donations"
+msgstr "Dary"
+
 msgid "Due date"
 msgstr "Datum splatnosti"
 
 msgid "Duration"
 msgstr "Doba trvání"
 
 msgid "E-mail"
@@ -435,14 +494,17 @@
 
 msgid "End date"
 msgstr "Datum konce"
 
 msgid "End must be later than start"
 msgstr "Konec musí být později než začátek"
 
+msgid "Enter a valid account number."
+msgstr "Zadejte platné číslo účtu v českém nebo mezinárodním formátu (IBAN)."
+
 msgid "Enter a valid birth number."
 msgstr "Zadejte platné rodné číslo."
 
 msgid "Enter a valid hex color."
 msgstr "Zadejte platnou barvu."
 
 msgid "Enter valid JSON structure representing field configuration."
@@ -473,17 +535,14 @@
 
 msgid "Event list with search form"
 msgstr "Výpis akcí s vyhledávacím formulářem"
 
 msgid "Event payments"
 msgstr "Platby za akce"
 
-msgid "Event payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za akce od %(date_start)s do %(date_end)s"
-
 msgid "Event payments status"
 msgstr "Stav plateb za akce"
 
 msgid "Event payments status by date %(date)s"
 msgstr "Stav plateb za akce ke dni %(date)s"
 
 msgid "Event statistics"
@@ -497,28 +556,38 @@
 
 msgid "Events"
 msgstr "Akce"
 
 msgid "Events count"
 msgstr "Počet akcí"
 
-msgid "Export selected items in single PDF."
-msgstr "Exportovat vybrané položky v jediném PDF."
+msgid "Export selected items in single PDF"
+msgstr "Exportovat vybrané položky v jediném PDF"
+
+msgid "Export selected records as ABO"
+msgstr "Exportovat vybrané záznamy ve formátu ABO (KB:KM)"
 
 msgid "Export selected records as CSV"
 msgstr "Exportovat vybrané záznamy ve formátu CSV (hodnoty oddělené čárkou)"
 
 msgid "Export selected records as XLSX"
 msgstr "Exportovat vybrané záznamy ve formátu XLSX (Excel)"
 
+msgid "Export selected registrations as invoices in XML"
+msgstr ""
+"Exportovat vybrané záznamy ve formátu XML pro Money S3 (experimentální)"
+
+msgid "Export setup"
+msgstr "Nastavení exportu"
+
 msgid "Failed to create field with given field args: {}"
 msgstr "Nepodařilo se vytvořit vstupní pole se zadanými parametry: {}"
 
-msgid "Failed to update item {instance}."
-msgstr "Nepodařilo se upravit položku {instance}."
+msgid "Failed to update item {}."
+msgstr "Nepodařilo se upravit položku {}."
 
 msgid "Fields to update"
 msgstr "Pole k úpravení"
 
 msgid "First name"
 msgstr "Jméno"
 
@@ -537,23 +606,23 @@
 
 msgid "Friday"
 msgstr "pátek"
 
 msgid "Full name"
 msgstr "Jméno a příjmení"
 
+msgid "Generate refund requests for selected registrations"
+msgstr "Vygenerovat žádosti o vrácení přeplatku pro vybrané přihlášky"
+
 msgid "Girls"
 msgstr "Ženy"
 
 msgid "Group"
 msgstr "Skupina"
 
-msgid "Group member details only include name and note."
-msgstr "Údaje o členu skupiny zahrnují pouze jméno a poznámku."
-
 msgid "Group members"
 msgstr "Členové skupiny"
 
 msgid "Group name"
 msgstr "Název skupiny"
 
 msgid "Grouped by course groups"
@@ -563,14 +632,23 @@
 msgstr "Seskupeno podle skupin akcí"
 
 msgid "Health"
 msgstr "Údaje o zdravotní způsobilosti účastníka (případná omezení)"
 
 msgid ""
 "Hello,\n"
+"Your registration has been overpaid.\n"
+"Please, tell us how you wish us to refund."
+msgstr ""
+"Dobrý den,\n"
+"U vaší přihlášky evidujeme přeplatek.\n"
+"Dejte nám prosím vědět, jak si přejete, abychom Vám přeplatek vrátili."
+
+msgid ""
+"Hello,\n"
 "Your registration was canceled."
 msgstr ""
 "Dobrý den,\n"
 "vaše přihláška byla odhlášena."
 
 msgid ""
 "Hello,\n"
@@ -611,14 +689,23 @@
 msgstr ""
 "Dobrý den,\n"
 "právě jsme obdrželi Vaši platbu. Děkujeme Vám.\n"
 "Doklad naleznete v příloze."
 
 msgid ""
 "Hello,\n"
+"we have just returned Your payment. Thank You.\n"
+"Please see the recipe attached."
+msgstr ""
+"Dobrý den,\n"
+"právě jsme Vám vrátili platbu.\n"
+"Doklad naleznete v příloze."
+
+msgid ""
+"Hello,\n"
 "we'd like to ask You to pay for Your registration.\n"
 "If You have already made the payment recently, please ignore this message."
 msgstr ""
 "Dobrý den,\n"
 "žádáme Vás o uhrazení přihlášky.\n"
 "Pokud jste již platbu v nedávné době provedli, můžete tuto zprávu ignorovat."
 
@@ -634,14 +721,19 @@
 msgid "If You fill in end time, You must fill start time too."
 msgstr "Pokud vyplníte čas konce, musíte vyplnit také čas začátku."
 
 msgid "If You fill in start time, You must fill end time too."
 msgstr "Pokud vyplníte čas začátku, musíte vyplnit také čas konce."
 
 msgid ""
+"If You wish, You may transfer the overpaid amount to a donation for our "
+"organization."
+msgstr "Pokud chcete, můžete přeplatek věnovat naší organizaci."
+
+msgid ""
 "If set, payment request will be sent this number of days before event date. "
 "If not set, payment request will be sent when registration is approved."
 msgstr ""
 "Pokud je nastaven, výzva k platbě bude odeslání tolik dní před termínem "
 "konání. Pokud není nastaven, výzva k platbě bude odeslána v okamžik "
 "schválení přihlášky."
 
@@ -654,29 +746,35 @@
 
 msgid "In"
 msgstr "V"
 
 msgid "Inactive Registrations"
 msgstr "Neaktivní přihlášky"
 
-msgid "Include past subjects"
-msgstr "Zobrazit i proběhlé akce"
-
 msgid "Information about parent has been deleted."
 msgstr "Informace o zákonném zástupci byly smazány."
 
 msgid "Information about participant has been deleted."
 msgstr "Informace o účastníkovi byly smazány."
 
 msgid "Instructions were send to user {}."
 msgstr "Instrukce byly odeslány uživateli {}."
 
 msgid "Journal"
 msgstr "Deník"
 
+msgid "Journal has been deleted."
+msgstr "Deník byl smazán."
+
+msgid "Journals"
+msgstr "Deníky"
+
+msgid "Journals of {subject_type} {subject}"
+msgstr "Deníky {subject_type} {subject}"
+
 msgid "Keep empty to skip searching by age groups."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle věkových skupin."
 
 msgid "Keep empty to skip searching by course types."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle typů kurzů."
 
 msgid "Keep empty to skip searching by departments."
@@ -771,23 +869,32 @@
 
 msgid "Mark selected timesheets as paid"
 msgstr "Označit vybrané výkazy jako zaplacené"
 
 msgid "Maximal age for this age group is ${ageGroup.max_age}."
 msgstr "Maximální věk pro tuto věkovou skupinu je ${ageGroup.max_age}."
 
+msgid "Maximal number of weekly hours"
+msgstr "Maximální počet hodin týdně"
+
 msgid "Merge selected user accounts"
 msgstr "Sloučit vybrané uživatele"
 
+msgid "Message for recipient"
+msgstr "Zpráva pro příjemce"
+
 msgid "Messages"
 msgstr "Zprávy"
 
 msgid "Minimal age for this age group is ${ageGroup.min_age}."
 msgstr "Minimální věk pro tuto věkovou skupinu je ${ageGroup.min_age}."
 
+msgid "Minimal number of days"
+msgstr "Minimální počet dní"
+
 msgid "Monday"
 msgstr "pondělí"
 
 msgid "More information"
 msgstr "Více informací"
 
 msgid "My {subject_type}"
@@ -801,17 +908,26 @@
 
 msgid "New billing information"
 msgstr "Nové fakturační údaje"
 
 msgid "New billing information {} have been created."
 msgstr "Nové fakturační údaje {} byly vytvořeny."
 
+msgid "New donation"
+msgstr "Nový dar"
+
+msgid "New journal"
+msgstr "Nový deník"
+
 msgid "New journal entry"
 msgstr "Nový záznam deníku"
 
+msgid "New journal {} has been created."
+msgstr "Nový deník {} byl vytvořen."
+
 msgid "New messages"
 msgstr "Nepřečtené zprávy"
 
 msgid "New parent"
 msgstr "Nový zástupce"
 
 msgid "New parent {} has been created."
@@ -819,38 +935,50 @@
 
 msgid "New participant"
 msgstr "Nový účastník"
 
 msgid "New participant {} has been created."
 msgstr "Účastník {} byl vytvořen."
 
+msgid "New payment transfer"
+msgstr "Nový převod platby"
+
+msgid "New refund request"
+msgstr "Nová žádost o vrácení přeplatku"
+
 msgid "New timesheet entry"
 msgstr "Nový záznam výkazu práce"
 
 msgid "New timesheet entry has been created."
 msgstr "Nový záznam výkazu práce byl vytvořen."
 
 msgid "No items found matching given search parameters."
 msgstr "Žádné položky neodpovídají zadaným parametrům hledání."
 
 msgid "No items found."
 msgstr "Žádné položky nebyly nalezeny."
 
+msgid "No journals matching given search parameters found."
+msgstr "Žádné deníky neodpovídají zadaným parametrům hledání."
+
 msgid "No leaders matching given query."
 msgstr "Žádní vedoucí neodpovídají hledanému výrazu."
 
 msgid "No messages matching given query."
 msgstr "Žádné zprávy neodpovídají hledanému výrazu."
 
 msgid "No {subject_type} matching given search parameters found."
 msgstr "Žádné {subject_type} neodpovídají zadaným parametrům hledání."
 
 msgid "No, take me back"
 msgstr "Ne, beru zpět"
 
+msgid "No."
+msgstr "Č."
+
 msgid "Not set"
 msgstr "Nenastaveno"
 
 msgid "Note"
 msgstr "Poznámka"
 
 msgid "Number of hours"
@@ -864,57 +992,45 @@
 
 msgid "Number of registrations"
 msgstr "Počet přihlášek"
 
 msgid "OK"
 msgstr "OK"
 
+msgid "Offer refund for selected registrations"
+msgstr "Odeslat nabídku vrácení přeplatku pro vybrané přihlášky"
+
+msgid "Oncoming {subject_type}"
+msgstr "Nadcházející {subject_type}"
+
 msgid "Online payment"
 msgstr "Online platba"
 
 msgid "Only the first of the two years."
 msgstr "Pouze první ze dvou roků."
 
-msgid ""
-"Only the leader can write to broadcast group. Users may reply to the sender "
-"with direct messages.\n"
-"Chat group allows all members to chat with each other."
-msgstr ""
-"Do vysílací skupiny může psát jen vedoucí. Uživatelé mu mohou odpovídat "
-"prostřednictvím přímých zpráv.\n"
-"Diskuzní skupina umožňuje všem členům diskutovat s ostatními."
-
 msgid "Only use to set value specific for this subject."
 msgstr "Nastavte pouze pokud je hodnota specifická pro tento předmět."
 
 msgid "Open"
 msgstr "Otevřít"
 
-msgid "Open chat"
-msgstr "Otevřít chat"
-
-msgid "Open in new window"
-msgstr "Otevřít v novém okně"
-
 msgid ""
 "Or You may use following QR code to scan the payment details to your mobile "
 "banking application"
 msgstr ""
 "Případně můžete použít následující QR kód pro načtení platebních informací "
 "do své mobilní bankovní aplikace"
 
 msgid "Orderable event"
 msgstr "Akce na objednání"
 
 msgid "Orderable event payments"
 msgstr "Platby za akce na objednání"
 
-msgid "Orderable event payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za akce na objednání od %(date_start)s do %(date_end)s"
-
 msgid "Orderable event payments status"
 msgstr "Stav plateb za akce na objednání"
 
 msgid "Orderable event payments status by date %(date)s"
 msgstr "Stav plateb za akce na objednání ke dni %(date)s"
 
 msgid "Orderable event statistics"
@@ -940,20 +1056,26 @@
 
 msgid "Orderable statistics"
 msgstr "Statistiky akcí na objednání"
 
 msgid "Orderables"
 msgstr "Akce na objednání"
 
+msgid "Organization"
+msgstr "Organizace"
+
 msgid "Other options"
 msgstr "Další možnosti"
 
 msgid "Overdue"
 msgstr "Po splatnosti"
 
+msgid "Overpaid amount"
+msgstr "Výše přeplatku"
+
 msgid "Overpayments"
 msgstr "Přeplatky"
 
 msgid "Parent"
 msgstr "Zástupce"
 
 msgid "Parent's signature"
@@ -963,18 +1085,21 @@
 msgstr "Zástupci"
 
 msgid "Participant"
 msgstr "Účastník"
 
 msgid ""
 "Participant details include birth number (birth day), age group, contacts, "
-"parent, etc."
+"parent, etc. Group member details only include name and note."
 msgstr ""
 "Údaje o účastníkovi zahrnují rodné číslo, věkovou skupinu, kontakty, zákonné "
-"zástupce, atd."
+"zástupce, atd. Údaje o členovi skupiny zahrnují pouze jméno a poznámku."
+
+msgid "Participant hours count"
+msgstr "Počet účastníkohodin"
 
 msgid "Participant with this birth number has already been registered."
 msgstr "Účastník s tímto rodným číslem je již přihlášený."
 
 msgid "Participants"
 msgstr "Účastníci"
 
@@ -986,31 +1111,28 @@
 
 msgid "Password change successful"
 msgstr "Heslo bylo úspěšně změněno"
 
 msgid "Password reset complete"
 msgstr "Nastavení hesla dokončeno"
 
+msgid "Past {subject_type} in school year {school_year}"
+msgstr "Proběhlé {subject_type} ve školním roce {school_year}"
+
 msgid "Payment Gateway"
 msgstr "Platební brána"
 
 msgid "Payment Type"
 msgstr "Typ platby"
 
-msgid "Payment can only have one relation."
-msgstr "Platba může mít jen jeden související objekt."
-
 msgid "Payment request"
 msgstr "Výzva k platbě"
 
-msgid "Payment type must be {valid_payment_type}."
-msgstr "Typ platby musí být {valid_payment_type}."
-
 msgid "Payment was requested for selected registrations."
-msgstr "Výzva k platbě byla odeslána pro vybrané přihlášky"
+msgstr "Výzva k platbě byla odeslána pro vybrané přihlášky."
 
 msgid "Payments"
 msgstr "Platby"
 
 msgid "Payments overview"
 msgstr "Přehled plateb"
 
@@ -1028,17 +1150,14 @@
 
 msgid "Phone"
 msgstr "Telefon"
 
 msgid "Place"
 msgstr "Místo"
 
-msgid "Place / Risk"
-msgstr "Místo / Riziko"
-
 msgid "Plan for the activity"
 msgstr "Plán činnosti"
 
 msgid "Please correct the highlighted errors below."
 msgstr "Opravte prosím níže uvedené chyby."
 
 msgid ""
@@ -1075,32 +1194,77 @@
 
 msgid "Publish selected events"
 msgstr "Zveřejnit vybrané akce"
 
 msgid "Publish selected orderable events"
 msgstr "Zveřejnit vybrané akce na objednání"
 
+msgid "Receipt for donation"
+msgstr "Potvrzení o přijetí daru"
+
 msgid "Receipt for payment"
 msgstr "Potvrzení o přijetí platby"
 
+msgid "Receipt for returned payment"
+msgstr "Potvrzení o vrácení platby"
+
 msgid "Receivables"
 msgstr "Pohledávky"
 
+msgid "Received - returned payments"
+msgstr "Přijaté - vrácené platby"
+
+msgid "Received course payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za kurzy od %(date_start)s do %(date_end)s"
+
+msgid "Received event payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za akce od %(date_start)s do %(date_end)s"
+
+msgid "Received orderable event payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za akce na objednání od %(date_start)s do %(date_end)s"
+
 msgid "Received payments"
 msgstr "Přijaté platby"
 
+msgid "Received personally on"
+msgstr "Převzato osobně dne"
+
 msgid "Recipients"
 msgstr "Příjemci"
 
 msgid "Recipients of message {}"
 msgstr "Příjemci zprávy {}"
 
 msgid "Recipients will be added to selected message."
 msgstr "Příjemci budou přidáni k vybarané zprávě."
 
+msgid "Reference number: %(reference_number)s"
+msgstr "Číslo jednací: %(reference_number)s"
+
+msgid "Refund may only be requested for overpaid registrations."
+msgstr "O navrácení přeplatku je možné žádat pouze pro přeplacené přihlášky."
+
+msgid "Refund options"
+msgstr "Možnosti navrácení"
+
+msgid "Refund request has been canceled."
+msgstr "Žádost o vrácení přeplatku byla zrušena."
+
+msgid "Refund request has been updated."
+msgstr "Žádost o vrácení přeplatku byla upravena."
+
+msgid "Refund request have been created."
+msgstr "Žádost o vrácení přeplatku byla vytvořena."
+
+msgid "Refund requests were generated for selected registrations."
+msgstr "Žádosti o vrácení přeplatku byly vygenerovány pro vybrané přihlášky."
+
+msgid "Refund was offered for selected registrations."
+msgstr "Nabídka vrácení přeplatku byla odeslána pro vybrané přihlášky."
+
 msgid "Refuse selected registrations"
 msgstr "Odmítnout vybrané přihlášky"
 
 msgid "Registering ended on {}"
 msgstr "Přihlašování bylo ukončeno {}."
 
 msgid "Registering is currently not allowed."
@@ -1117,31 +1281,42 @@
 
 msgid "Registration cancellation request"
 msgstr "Požadavek na odhlášení"
 
 msgid "Registration for %(subject_type)s"
 msgstr "Přihláška na %(subject_type)s"
 
-msgid "Registration for {subject_type} {subject}"
-msgstr "Přihláška na {subject_type} {subject}"
+msgid "Registration for %(subject_type)s %(subject)s"
+msgstr "Přihláška na %(subject_type)s %(subject)s"
+
+msgid "Registration for %(subject_type)s %(subject)s - payment request"
+msgstr "Přihláška na %(subject_type)s %(subject)s - výzva k platbě"
+
+msgid ""
+"Registration for %(subject_type)s %(subject)s - received payment confirmation"
+msgstr "Přihláška na %(subject_type)s %(subject)s - potvrzení přijaté platby"
+
+msgid "Registration for %(subject_type)s %(subject)s - refund offer"
+msgstr "Přihláška na %(subject_type)s %(subject)s - nabídka vrácení přeplatku"
 
-msgid "Registration for {subject_type} {subject} - payment confirmation"
-msgstr "Přihláška na {subject_type} {subject} - potvrzení platby"
+msgid ""
+"Registration for %(subject_type)s %(subject)s - returned payment confirmation"
+msgstr "Přihláška na %(subject_type)s %(subject)s - potvrzení vrácené platby"
 
-msgid "Registration for {subject_type} {subject} - payment request"
-msgstr "Přihláška na {subject_type} {subject} - výzva k platbě"
+msgid "Registration for %(subject_type)s %(subject)s was approved"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla schválena"
 
-msgid "Registration for {subject_type} {subject} was approved"
-msgstr "Přihláška na {subject_type} {subject} byla schválena"
+msgid "Registration for %(subject_type)s %(subject)s was canceled"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla odhlášena"
 
-msgid "Registration for {subject_type} {subject} was canceled"
-msgstr "Přihláška na {subject_type} {subject} byla odhlášena"
+msgid "Registration for %(subject_type)s %(subject)s was refused"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla odmítnuta"
 
-msgid "Registration for {subject_type} {subject} was refused"
-msgstr "Přihláška na {subject_type} {subject} byla odmítnuta"
+msgid "Registration for {subject_type} {subject}"
+msgstr "Přihláška na {subject_type} {subject}"
 
 msgid "Registration number (variable symbol)"
 msgstr "Číslo přihlášky (variabilní symbol)"
 
 msgid "Registrations"
 msgstr "Přihlášky"
 
@@ -1159,14 +1334,29 @@
 
 msgid "Reset my password"
 msgstr "Resetovat heslo"
 
 msgid "Reset password"
 msgstr "Reset hesla"
 
+msgid "Returned amount"
+msgstr "Vrácená částka"
+
+msgid "Returned course payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za kurzy od %(date_start)s do %(date_end)s"
+
+msgid "Returned event payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za akce od %(date_start)s do %(date_end)s"
+
+msgid "Returned orderable event payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za akce na objednání od %(date_start)s do %(date_end)s"
+
+msgid "Returned payments"
+msgstr "Vrácené platby"
+
 msgid "Risks"
 msgstr "Rizika"
 
 msgid "Saturday"
 msgstr "sobota"
 
 msgid "Save"
@@ -1183,14 +1373,23 @@
 
 msgid "Search"
 msgstr "Hledat"
 
 msgid "Search term"
 msgstr "Hledaný výraz"
 
+msgid ""
+"Select page, where the subjects will be listed. New subject type requireds "
+"new page. If You assign an existing page, the current content of the page "
+"will be replaced with the new subject list."
+msgstr ""
+"Vyberte stránku, na níž bude výpis položek tohoto typu. Nový typ kurzu nebo "
+"akce vyžaduje novou stránku. Pokud přiřadíte existující stránku, její "
+"stávající obsah bude nahrazen výpisem kurzů nebo akcí nového typu."
+
 msgid "Select target account for merge"
 msgstr "Vyberte cílový uživatelský účet pro sloučení"
 
 msgid "Select target message"
 msgstr "Vyberte cílovou zprávu"
 
 msgid "Select target school year"
@@ -1279,14 +1478,17 @@
 
 msgid "Show"
 msgstr "Zobrazit"
 
 msgid "Show invisible"
 msgstr "Zobrazit neviditelné"
 
+msgid "Show past"
+msgstr "Zobrazit proběhlé"
+
 msgid "Show this message on site %(name)s:"
 msgstr "Zobrazit tuto zprávu na webu %(name)s:"
 
 msgid "Signature"
 msgstr "Podpis"
 
 msgid "Some submitted timesheet entries end at {end}"
@@ -1303,17 +1505,14 @@
 
 msgid "Start must be before end"
 msgstr "Začátek musí být dříve než konec"
 
 msgid "Start sending"
 msgstr "Spustit odesílání"
 
-msgid "Statistics"
-msgstr "Statistiky"
-
 msgid "Statistics for date"
 msgstr "Statistiky k datu"
 
 msgid "Status"
 msgstr "Stav"
 
 msgid "Status for date"
@@ -1330,14 +1529,17 @@
 
 msgid "Submit timesheet"
 msgstr "Odevzdat výkaz práce"
 
 msgid "Summary"
 msgstr "Přehled"
 
+msgid "Summary from %(date_start)s to %(date_end)s"
+msgstr "Souhrn od %(date_start)s do %(date_end)s"
+
 msgid "Sunday"
 msgstr "neděle"
 
 msgid "Switch school year"
 msgstr "Přepnout školní rok"
 
 msgid "Target group"
@@ -1361,14 +1563,17 @@
 msgid ""
 "Thank You, the online payment was successful. The confirmation will be "
 "available within several minutes."
 msgstr ""
 "Děkujeme, on-line platba se zdařila. Potvrzení bude k dispozici během pár "
 "minut."
 
+msgid "Thank You. Your support is very appreciated."
+msgstr "Děkujeme Vám, velmi si vážíme Vaší podpory."
+
 msgid "Thanks for using our site!"
 msgstr "Děkujeme, že používáte naše stránky!"
 
 msgid "The %(site_name)s team"
 msgstr "Tým %(site_name)s"
 
 msgid "The agreement has been saved."
@@ -1376,29 +1581,20 @@
 
 msgid "The attachment will be available before registration."
 msgstr "Příloha bude dostupná před přihlášením."
 
 msgid "The attachment will be sent with notification on selected events."
 msgstr "Příhloha bude odeslána s notifikací o vybraných událostech."
 
+msgid "The cancelation requests have been removed from selected registrations."
+msgstr "U vybraných přihlášek byla zrušena žádost o odhlášení."
+
 msgid "The cancellation request for {} has been saved."
 msgstr "Požadavek na odhlášení přihlášky {} byl uložen."
 
-msgid "The capacity is full."
-msgstr "Kapacita je naplněna."
-
-msgid ""
-"The capacity of this %(subject_type)s has already been filled. You may "
-"register anyway, but the registration may not be approved. We will inform "
-"You."
-msgstr ""
-"Kapacita %(subject_type)s je již naplněna. Můžete se přesto přihlásit, ale "
-"Vaše přihláška nemusí být schválena. O jejím zpracování Vás budeme dále "
-"informovat."
-
 msgid "The changes in {subject_type} {subject} have been saved."
 msgstr "Změny v {subject_type} {subject} byly uloženy."
 
 msgid "The discounts have been created for selected registrations."
 msgstr "K vybraným přihláškám byly přidány slevy."
 
 msgid "The journal entry ends at {end}"
@@ -1424,14 +1620,32 @@
 
 msgid "The parent {} has been updated."
 msgstr "Zástupce {} byl upraven."
 
 msgid "The participant {} has been updated."
 msgstr "Účastník {} byl upraven."
 
+msgid "The payment has been transferred."
+msgstr "Platba byla převedena."
+
+msgid ""
+"The payment may only be transferred to a registration, for which the payment "
+"is required. If You have submitted new registration recently, You may need "
+"to wait until the payment is requested for that registration."
+msgstr ""
+"Platba může být převedena pouze na přihlášku, pro kterou je požadována "
+"platba. Pokud jste vyplnili novou přihlášku, možná budete muset počkat, až "
+"budete vyzváni k platbě."
+
+msgid "The payment will be added to this registration."
+msgstr "Platba bude připsána k této přihlášce."
+
+msgid "The payment will be deducted from this registration."
+msgstr "Platba bude odečtena od této přihlášky."
+
 msgid ""
 "The registration has been saved. We will inform you about its further "
 "processing."
 msgstr ""
 "Přihláška byla uložena. O jejím dalším zpracování Vás budeme informovat."
 
 msgid "The registration {r} has already been approved."
@@ -1472,14 +1686,20 @@
 
 msgid "There are no active registrations for this %(subject_type)s."
 msgstr "Na %(subject_type)s nejsou žádné aktivní přihlášky."
 
 msgid "There are no approved registrations for this {}."
 msgstr "Na {} nejsou žádné aktivní přihlášky."
 
+msgid "This field is forbidden for transaction type {transaction_type}."
+msgstr "Toto pole je u platby typu {transaction_type} zakázané."
+
+msgid "This field is mandatory for transaction type {transaction_type}."
+msgstr "Toto pole je u platby typu {transaction_type} povinné."
+
 msgid "This is help text. The help text is shown next to the form field."
 msgstr "Toto je text nápovědy. Nápověda se zobrazuje u formulářového políčka."
 
 msgid "Thursday"
 msgstr "čtvrtek"
 
 msgid "Time"
@@ -1530,23 +1750,32 @@
 msgid ""
 "Unfortunately, the online payment was not successful. Please, try it again "
 "or choose another payment method."
 msgstr ""
 "Bohužel, on-line platba se nezdařila. Zkuste to prosím znovu, nebo zvolte "
 "jiný způsob platby."
 
+msgid ""
+"Unit name the price applies to. For example semester, month, or 5 lessons."
+msgstr ""
+"Název jednotky, za kterou je udávána cena, například pololetí, měsíc, 5 "
+"lekcí, apod."
+
 msgid "Unpublish selected courses"
 msgstr "Skrýt vybrané kurzy"
 
 msgid "Unpublish selected events"
 msgstr "Skrýt vybrané akce"
 
 msgid "Unpublish selected orderable events"
 msgstr "Skrýt vybrané akce na objednání"
 
+msgid "Update refund request"
+msgstr "Upravení žádost o vrácení přeplatku"
+
 msgid "User account {} has been created."
 msgstr "Uživatel {} byl vytvořen."
 
 msgid "User account {} has been updated."
 msgstr "Uživatel {} byl upraven."
 
 msgid "User with this email already exists."
@@ -1579,17 +1808,14 @@
 msgstr ""
 "Poslali jsme vám na e-mail pokyny k nastavení hesla. Měly by dorazit během "
 "pár minut."
 
 msgid "Wednesday"
 msgstr "středa"
 
-msgid "Welcome to %(site_name)s's chat!"
-msgstr "Vítejte na chatu %(site_name)s!"
-
 msgid "Which school years should the block be visible for?"
 msgstr "Pro které školní roky se má tento blok zobrazit?"
 
 msgid "Yes"
 msgstr "Ano"
 
 msgid "Yes, I'm sure"
@@ -1603,26 +1829,24 @@
 
 msgid "You have overdue of %(overdue)s."
 msgstr "Máte závazky po splatnosti v celkové výši %(overdue)s."
 
 msgid "You have overpaid %(overpaid)s."
 msgstr "Máte přeplatek ve výši %(overpaid)s."
 
+msgid "You have requested a refund to the bank account:"
+msgstr "Máte požádáno o vrácení přeplatku na účet:"
+
 msgid ""
 "You may check the current status of your registrations and payments using "
 "following link:"
 msgstr ""
 "Aktuální stav svých přihlášek a plateb můžete zkontrolovat pomocí "
 "následujícího odkazu:"
 
-msgid "You may download the registration in PDF using the following link:"
-msgstr ""
-"Vyplněnou přihlášku ve formátu PDF můžete stáhnout pomocí následujícího "
-"odkazu:"
-
 msgid ""
 "You may use following QR code to scan the payment details to your mobile "
 "banking application"
 msgstr ""
 "Následující QR kód můžete použít pro načtení platebních informací do své "
 "mobilní bankovní aplikace"
 
@@ -1656,14 +1880,17 @@
 
 msgid "account closure"
 msgstr "uzavření účtu"
 
 msgid "account closures"
 msgstr "uzavření účtu"
 
+msgid "accounted by"
+msgstr "zaúčtoval(a)"
+
 msgid "accounted time"
 msgstr "čas zaúčtování"
 
 msgid "accounting code"
 msgstr "účetní kód"
 
 msgid "actions"
@@ -1680,29 +1907,38 @@
 
 msgid "add discount"
 msgstr "přidat slevu"
 
 msgid "add entry"
 msgstr "přidat záznam"
 
+msgid "add journal"
+msgstr "přidat deník"
+
 msgid "add journal entry"
 msgstr "přidat záznam deníku"
 
 msgid "add parent"
 msgstr "přidat zástupce"
 
 msgid "add participant"
 msgstr "přidat účastníka"
 
 msgid "add payment"
 msgstr "přidat platbu"
 
+msgid "add received payment"
+msgstr "přidat přijatou platbu"
+
 msgid "add registration"
 msgstr "vytvořit přihlášku"
 
+msgid "add returned payment"
+msgstr "přidat vrácenou platbu"
+
 msgid "additional answers"
 msgstr "doplňující odpovědi"
 
 msgid "additional legal agreements"
 msgstr "další souhlasy na přihlášce"
 
 msgid "additional question"
@@ -1710,14 +1946,20 @@
 
 msgid "additional questions"
 msgstr "doplňující otázky"
 
 msgid "address"
 msgstr "adresa"
 
+msgid "admission decision"
+msgstr "rozhodnutí o přijetí"
+
+msgid "advanced settings"
+msgstr "pokročilá nastavení"
+
 msgid "age group"
 msgstr "věková skupina"
 
 msgid "age groups"
 msgstr "věkové skupiny"
 
 msgid "age groups list"
@@ -1738,15 +1980,15 @@
 msgid "agreement options"
 msgstr "volby souhlasu"
 
 msgid "all"
 msgstr "všichni"
 
 msgid "allow period selection"
-msgstr "povolit výbět odbobí"
+msgstr "povolit výběr odbobí"
 
 msgid "allow user to choose school year periods on registration form"
 msgstr "umožní uživateli při přihlašování vybrat konkrétní období"
 
 msgid "amount"
 msgstr "částka"
 
@@ -1773,23 +2015,29 @@
 
 msgid "attachment"
 msgstr "příloha"
 
 msgid "attachments"
 msgstr "přílohy"
 
+msgid "available for registration"
+msgstr "povoleno k přihlašování"
+
 msgid "awaiting approval"
 msgstr "čeká na schválení"
 
 msgid "back"
 msgstr "zpět"
 
 msgid "bank account"
 msgstr "číslo účtu"
 
+msgid "bank account number"
+msgstr "číslo bankovního účtu"
+
 msgid "bank account transaction"
 msgstr "transakce na účtu"
 
 msgid "billing information"
 msgstr "fakturační údaje"
 
 msgid "birh year"
@@ -1800,20 +2048,20 @@
 
 msgid "birth number"
 msgstr "rodné číslo"
 
 msgid "boolean field"
 msgstr "zatržítko"
 
-msgid "broadcast group"
-msgstr "vysílací skupina"
-
 msgid "cancel"
 msgstr "odhlásit"
 
+msgid "cancel refund request"
+msgstr "zrušit žádost o vrácení"
+
 msgid "cancel registration"
 msgstr "odhlásit"
 
 msgid "cancel search"
 msgstr "zrušit hledání"
 
 msgid "cancelation"
@@ -1830,23 +2078,20 @@
 
 msgid "canceled by"
 msgstr "odhlásil(a)"
 
 msgid "cancellation requested on %(d)s"
 msgstr "o odhlášení požádáno %(d)s"
 
+msgid "change account number"
+msgstr "změnit číslo účtu"
+
 msgid "char field"
 msgstr "textové pole"
 
-msgid "chat group"
-msgstr "diskuzní skupina"
-
-msgid "chat group type"
-msgstr "typ diskuzní skupiny"
-
 msgid "choice field"
 msgstr "výběr"
 
 msgid "citizenship"
 msgstr "státní občanství"
 
 msgid "citizenships"
@@ -1890,17 +2135,14 @@
 
 msgid "course discounts"
 msgstr "slevy na kurz"
 
 msgid "course groups"
 msgstr "skupiny kurzů"
 
-msgid "course payments"
-msgstr "platby za kurzy"
-
 msgid "course registration"
 msgstr "přihláška na kurz"
 
 msgid "course registration history"
 msgstr "historie přihlášky na kurz"
 
 msgid "course registrations"
@@ -1926,19 +2168,25 @@
 
 msgid "date field"
 msgstr "datum"
 
 msgid "day of week"
 msgstr "den v týdnu"
 
+msgid "decision"
+msgstr "rozhodnutí"
+
+msgid "decision print setup"
+msgstr "nastavení tisku rozhodnutí"
+
 msgid "default bill print setup"
 msgstr "výchozí nastavení tisku dokladů"
 
-msgid "default chat group type"
-msgstr "výchozí typ diskuzní skupiny"
+msgid "default decision print setup"
+msgstr "výchozí nastavení tisku rozhodnutí"
 
 msgid "default organization"
 msgstr "výchozí organizace"
 
 msgid "default payment request print setup"
 msgstr "výchozí nastavení tisku výzvy k platbě"
 
@@ -1983,14 +2231,47 @@
 
 msgid "distance in milimetres"
 msgstr "vzdálenost v milimetrech"
 
 msgid "division name"
 msgstr "název členění"
 
+msgid "donate"
+msgstr "darovat"
+
+msgid "donation"
+msgstr "dar"
+
+msgid "donation - bank"
+msgstr "dar na bankovní účet"
+
+msgid "donation - cash"
+msgstr "dar v hotovosti"
+
+msgid "donation - online"
+msgstr "dar on-line"
+
+msgid "donation date"
+msgstr "datum přijetí"
+
+msgid "donation print setup"
+msgstr "nastavení tisku potvrzení o daru"
+
+msgid "donation received by"
+msgstr "dar přijal(a)"
+
+msgid "donation type"
+msgstr "druh daru"
+
+msgid "donations"
+msgstr "dary"
+
+msgid "donor user"
+msgstr "dárce"
+
 msgid "download"
 msgstr "stažení"
 
 msgid "due date"
 msgstr "datum splatnosti"
 
 msgid "due from"
@@ -2043,17 +2324,14 @@
 
 msgid "event discounts"
 msgstr "slevy na akce"
 
 msgid "event groups"
 msgstr "skupiny akcí"
 
-msgid "event payments"
-msgstr "platby za akce"
-
 msgid "event registration"
 msgstr "přihláška na akci"
 
 msgid "event registrations"
 msgstr "přihlášky na akce"
 
 msgid "event type"
@@ -2116,15 +2394,15 @@
 msgid "health"
 msgstr "údaje o zdravotní způsobilosti účastníka (případná omezení)"
 
 msgid "help text"
 msgstr "nápověda"
 
 msgid "imported from account statement"
-msgstr "imporováno z výpisu z účtu"
+msgstr "importováno z výpisu z účtu"
 
 msgid "in school year %(school_year)s"
 msgstr "ve školním roce %(school_year)s"
 
 msgid "inactive"
 msgstr "neaktivní"
 
@@ -2139,20 +2417,32 @@
 
 msgid "journal leader entries"
 msgstr "záznamy vedoucích v deníku"
 
 msgid "journal leader entry"
 msgstr "záznam vedoucího v deníku"
 
+msgid "journal name"
+msgstr "název deníku"
+
+msgid "journals"
+msgstr "deníky"
+
 msgid "last name"
 msgstr "příjmení"
 
 msgid "last time user agreement changed"
 msgstr "čas poslední změny souhlasu uživatele"
 
+msgid "last updated by"
+msgstr "naposledy upravil(a)"
+
+msgid "last updated time"
+msgstr "naposledy upraveno"
+
 msgid "leader"
 msgstr "vedoucí"
 
 msgid "leaders"
 msgstr "vedoucí"
 
 msgid "leaders list"
@@ -2190,40 +2480,34 @@
 
 msgid "margin top"
 msgstr "horní okraj"
 
 msgid "maximal age"
 msgstr "maximální věk"
 
-msgid "maximal group members count per registration"
-msgstr "maximální počet členů skupiny na přihlášce"
-
-msgid "maximal participants count per registration"
-msgstr "maximální počet účastníků na přihlášce"
+msgid "maximal participants / group members count per registration"
+msgstr "maximální počet účastníků / členů skupiny na přihlášce"
 
 msgid "maximal registrations count"
 msgstr "maximální počet přihlášek"
 
 msgid "message"
 msgstr "zpráva"
 
 msgid "messages"
 msgstr "zprávy"
 
 msgid "minimal age"
 msgstr "minimální věk"
 
-msgid "minimal group members count per registration"
-msgstr "minimální počet členů skupiny na přihlášce"
-
 msgid "minimal number of days to due date"
 msgstr "minimální počet dní do data splatnosti"
 
-msgid "minimal participants count per registration"
-msgstr "minimální počet účastníků na přihlášce"
+msgid "minimal participants / group members count per registration"
+msgstr "minimální počet účastníků / členů skupiny na přihlášce"
 
 msgid "minimal registrations count"
 msgstr "minimální počet přihlášek"
 
 msgid "name"
 msgstr "název"
 
@@ -2256,17 +2540,23 @@
 
 msgid "new registration, capacity full"
 msgstr "nová přihláška, naplěná kapacita"
 
 msgid "next"
 msgstr "další"
 
+msgid "no"
+msgstr "ne"
+
 msgid "no billing information"
 msgstr "bez fakturačních údajů"
 
+msgid "no other registration"
+msgstr "žádná další přihláška"
+
 msgid "no period"
 msgstr "žádné období"
 
 msgid "not canceled"
 msgstr "neodhlášeno"
 
 msgid "note"
@@ -2277,14 +2567,17 @@
 
 msgid "number of days to due date before event date"
 msgstr "počet dní do data splatnosti před termínem konání"
 
 msgid "number of days to send the payment request before event date"
 msgstr "počet dní pro odeslání výzvy k platbě před termínem konání"
 
+msgid "number of price units"
+msgstr "počet jednotek"
+
 msgid "online payment"
 msgstr "platba on-line"
 
 msgid "option"
 msgstr "volba"
 
 msgid "order"
@@ -2295,17 +2588,14 @@
 
 msgid "orderable event discount"
 msgstr "sleva na akci na objednání"
 
 msgid "orderable event discounts"
 msgstr "slevy na akce na objednání"
 
-msgid "orderable event payments"
-msgstr "platby za akce na objednání"
-
 msgid "orderable event registration"
 msgstr "přihláška na akci na objednání"
 
 msgid "orderable event registrations"
 msgstr "přihlášky na akce na objednání"
 
 msgid "orderable event type"
@@ -2334,16 +2624,16 @@
 
 msgid "page"
 msgstr "stránka"
 
 msgid "paid"
 msgstr "zaplaceno"
 
-msgid "paid %(paid)s"
-msgstr "zaplaceno %(paid)s"
+msgid "paid %(received)s"
+msgstr "zaplaceno %(received)s"
 
 msgid "parent"
 msgstr "zástupce"
 
 msgid "parents"
 msgstr "zástupci"
 
@@ -2370,17 +2660,14 @@
 
 msgid "payment - cash"
 msgstr "platba v hotovosti"
 
 msgid "payment - online"
 msgstr "platba on-line"
 
-msgid "payment - transfer from return"
-msgstr "platba z přeplatku"
-
 msgid "payment date"
 msgstr "datum přijetí platby"
 
 msgid "payment not requested"
 msgstr "platba není požadována"
 
 msgid "payment not requested yet"
@@ -2406,29 +2693,29 @@
 
 msgid "payment requested"
 msgstr "odeslání výzvy k platbě"
 
 msgid "payment requested by"
 msgstr "výzvy k platbě odeslal(a)"
 
+msgid "payment returned"
+msgstr "platba vrácena"
+
 msgid "payment type"
 msgstr "typ platby"
 
 msgid "payments"
 msgstr "platby"
 
 msgid "pdf background"
 msgstr "pdf pozadí"
 
 msgid "period"
 msgstr "období"
 
-msgid "period name"
-msgstr "název období"
-
 msgctxt "person"
 msgid "Name"
 msgstr "Jméno"
 
 msgid "phone"
 msgstr "telefon"
 
@@ -2443,26 +2730,32 @@
 
 msgid "plan"
 msgstr "plán"
 
 msgid "plural"
 msgstr "množné číslo"
 
-msgid "positive value for payment, negative value for return"
-msgstr "kladné číslo pro platbu, záporné pro navrácení přeplatku"
-
 msgid "postal code"
 msgstr "PSČ"
 
 msgid "previous"
 msgstr "předchozí"
 
 msgid "price"
 msgstr "cena"
 
+msgid "price per participant"
+msgstr "cena za účastníka"
+
+msgid "price per registration"
+msgstr "cena za přihlášku"
+
+msgid "price unit name"
+msgstr "název jednotky k ceně"
+
 msgid "print setup"
 msgstr "nastavení tisku"
 
 msgid "print setups"
 msgstr "nastavení tisku"
 
 msgid "printable journal"
@@ -2482,32 +2775,50 @@
 
 msgid "queued"
 msgstr "ve frontě"
 
 msgid "random number"
 msgstr "náhodné číslo"
 
-msgid "received by"
-msgstr "přijal(a)"
-
 msgid "received online payment"
 msgstr "přijatá on-line platba"
 
+msgid "received payment"
+msgstr "přijatá platba"
+
+msgid "received payments"
+msgstr "přijaté platby"
+
 msgid "recipe number"
 msgstr "číslo stvrzenky"
 
 msgid "recipient"
 msgstr "příjemce"
 
 msgid "recipients"
 msgstr "příjemci"
 
 msgid "recipients count"
 msgstr "počet příjemců"
 
+msgid "refund offer time"
+msgstr "čas nabídky vrácení přeplatku"
+
+msgid "refund request"
+msgstr "žádost o vrácení přeplatku"
+
+msgid "refund requests"
+msgstr "žádosti o vrácení přeplatku"
+
+msgid "refunded %(returned)s"
+msgstr "vráceno %(returned)s"
+
+msgid "refusal decision"
+msgstr "rozhodnutí o odmítnutí"
+
 msgid "registered group"
 msgstr "přihlášená skupina"
 
 msgid "registered groups"
 msgstr "přihlášené skupiny"
 
 msgid "registered period"
@@ -2563,37 +2874,49 @@
 
 msgid "registration type"
 msgstr "způsob přihlašování"
 
 msgid "registrations"
 msgstr "přihlášky"
 
-msgid "related payment"
-msgstr "související platba"
-
 msgid "relative amount in percents"
 msgstr "relativní částka v procentech"
 
+msgid "request refund to a bank account"
+msgstr "požádat o vrácení na bankovní účet"
+
+msgid "requested by"
+msgstr "požádal(a)"
+
+msgid "requested time"
+msgstr "čas požádání"
+
 msgid "require birth number"
 msgstr "vyžadovat rodné číslo"
 
 msgid "require school"
 msgstr "vyžadovat školu"
 
 msgid "required"
 msgstr "povinný"
 
-msgid "return - bank"
-msgstr "navrácení přeplatku na bankovní účet"
+msgid "required field with an empty option"
+msgstr "poviné pole s možností neodpovědět"
 
-msgid "return - cash"
-msgstr "navrácení přeplatku v hotovosti"
+msgid "returned payment"
+msgstr "vrácená platba"
 
-msgid "return - transfer to payment"
-msgstr "navrácení přeplatku převodem na platbu"
+msgid "returned payment - bank"
+msgstr "platba vrácená na bankovní účet"
+
+msgid "returned payment - cash"
+msgstr "platba vrácená v hotovosti"
+
+msgid "returned payments"
+msgstr "vrácené platby"
 
 msgid "risks"
 msgstr "rizika"
 
 msgid "school"
 msgstr "škola"
 
@@ -2665,14 +2988,17 @@
 
 msgid "show recipients details"
 msgstr "zobrazit podrobnosti o příjemcích"
 
 msgid "skipped"
 msgstr "zrušeno"
 
+msgid "source registration"
+msgstr "zdrojová přihláška"
+
 msgid "start"
 msgstr "začátek"
 
 msgid "start date"
 msgstr "datum začátku"
 
 msgid "start time"
@@ -2713,14 +3039,17 @@
 
 msgid "target groups"
 msgstr "cílové skupiny"
 
 msgid "target groups list"
 msgstr "seznam cílových skupin"
 
+msgid "target registration"
+msgstr "cílová přihláška"
+
 msgid "template"
 msgstr "šablona"
 
 msgid "text"
 msgstr "text"
 
 msgid "text field"
@@ -2728,29 +3057,38 @@
 
 msgid "text: discount granted"
 msgstr "text: poskytnuta sleva"
 
 msgid "text: payment received"
 msgstr "text: platba přijata"
 
+msgid "text: payment returned"
+msgstr "text: platba vrácena"
+
 msgid "text: registration approved"
 msgstr "text: přihláška schválena"
 
 msgid "text: registration canceled"
 msgstr "text: přihláška odhlášena"
 
 msgid "text: registration payment request"
 msgstr "text: výzva k platbě"
 
 msgid "text: registration received"
 msgstr "text: přihláška přijata"
 
+msgid "text: registration refund offer"
+msgstr "text: nabídka vrácení přeplatku"
+
 msgid "text: registration refused"
 msgstr "text: přihláška odmítnuta"
 
+msgid "texts"
+msgstr "texty"
+
 msgid "time"
 msgstr "čas"
 
 msgid "time of agreement"
 msgstr "čas souhlasu"
 
 msgid "time of approval"
@@ -2791,23 +3129,44 @@
 
 msgid "timesheets"
 msgstr "výkazy práce"
 
 msgid "total amount due"
 msgstr "celkem k úhradě"
 
+msgid "total price"
+msgstr "výsledná cena"
+
+msgid "transaction"
+msgstr "transakce"
+
+msgid "transactions"
+msgstr "transakce"
+
+msgid "transfer between registrations"
+msgstr "převod mezi dvěma přihláškami"
+
+msgid "transfer from registration to donation"
+msgstr "dar z přeplatku"
+
+msgid "transfer to a payment"
+msgstr "převést na platbu"
+
 msgid "type"
 msgstr "typ"
 
 msgid "unapproved"
 msgstr "neschváleno"
 
 msgid "unapproved registrations count"
 msgstr "počet neschválených přihlášek"
 
+msgid "unique identifier"
+msgstr "unikátní identifikátor"
+
 msgid "update entry"
 msgstr "upravit záznam"
 
 msgid "url"
 msgstr "url adresa"
 
 msgid "user"
@@ -2836,27 +3195,27 @@
 
 msgid "work description"
 msgstr "popis práce"
 
 msgid "year"
 msgstr "rok"
 
+msgid "yes"
+msgstr "ano"
+
 msgid "{day}, {start:%H:%M}"
 msgstr "{day} od {start:%H:%M}"
 
 msgid "{day}, {start:%H:%M} - {end:%H:%M}"
 msgstr "{day} od {start:%H:%M} do {end:%H:%M}"
 
 msgid "{first_name} {last_name} ({birth_date})"
 msgstr "{first_name} {last_name} ({birth_date})"
 
-msgid "{name}, {start:%m/%d %y} - {end:%m/%d %y}"
-msgstr "{name}, {start:%d. %m. %y} až {end:%d. %m. %y}"
-
-msgid "{num_updated} items were updated."
-msgstr "{num_updated} položek bylo upraveno."
-
 msgid "{subject_type} in school year {school_year}"
 msgstr "{subject_type} ve školním roce {school_year}"
 
+msgid "{} items were updated."
+msgstr "{} položek bylo upraveno."
+
 msgid "{} overpaid"
 msgstr "přeplaceno {}"
```

### Comparing `leprikon-3.0.0/leprikon/locale/cs/LC_MESSAGES/django.po` & `leprikon-3.5.0/leprikon/locale/cs/LC_MESSAGES/django.po`

 * *Files 2% similar despite different names*

```diff
@@ -1,1180 +1,1399 @@
 # Leprikon translation.
-# Copyright (C) 2018 Jakub Dorňák <jakub.dornak@misli.cz>
+# Copyright (C) 2021 Jakub Dorňák <jakub.dornak@qbsoftware.cz>
 # This file is distributed under the same license as the leprikon package.
-# Jakub Dorňák <jakub.dornak@misli.cz>, 2018.
 #
 #, fuzzy
 msgid ""
 msgstr ""
 "Project-Id-Version: leprikon\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2020-12-14 15:22+0100\n"
-"Last-Translator: Jakub Dorňák <jakub.dornak@misli.cz>\n"
+"POT-Creation-Date: 2023-01-20 02:21+0100\n"
+"Last-Translator: Jakub Dorňák <jakub.dornak@qbsoftware.cz>\n"
 "Language: cs\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
 "Plural-Forms: nplurals=3; plural=(n==1) ? 0 : (n>=2 && n<=4) ? 1 : 2;\n"
 
-#: admin/__init__.py:19 admin/__init__.py:20 admin/__init__.py:32
+#: admin/__init__.py:41 admin/__init__.py:42 admin/__init__.py:54
 msgid "Leprikon administration"
 msgstr "Správa systému Leprikón"
 
-#: admin/bulkupdate.py:24
+#: admin/bulkupdate.py:29
 msgid "Fields to update"
 msgstr "Pole k úpravení"
 
-#: admin/bulkupdate.py:67
-#, python-brace-format
-msgid "Failed to update item {instance}."
-msgstr "Nepodařilo se upravit položku {instance}."
+#: admin/bulkupdate.py:43
+msgid "Bulk update selected items"
+msgstr "Hromadně upravit vybrané položky"
 
-#: admin/bulkupdate.py:72
-#, python-brace-format
-msgid "{num_updated} items were updated."
-msgstr "{num_updated} položek bylo upraveno."
+#: admin/bulkupdate.py:71
+msgid "Failed to update item {}."
+msgstr "Nepodařilo se upravit položku {}."
+
+#: admin/bulkupdate.py:76
+msgid "{} items were updated."
+msgstr "{} položek bylo upraveno."
 
-#: admin/bulkupdate.py:82
+#: admin/bulkupdate.py:89
 msgid "Bulk update"
 msgstr "Hromadné upravení"
 
-#: admin/bulkupdate.py:91
-msgid "Bulk update selected items"
-msgstr "Hromadně upravit vybrané položky"
+#: admin/courses.py:110
+msgid "Publish selected courses"
+msgstr "Zveřejnit vybrané kurzy"
 
-#: admin/courses.py:75
+#: admin/courses.py:113
 msgid "Selected courses were published."
 msgstr "Vybrané kurzy byly zveřejněny."
 
-#: admin/courses.py:76
-msgid "Publish selected courses"
-msgstr "Zveřejnit vybrané kurzy"
+#: admin/courses.py:115
+msgid "Unpublish selected courses"
+msgstr "Skrýt vybrané kurzy"
 
-#: admin/courses.py:80
+#: admin/courses.py:118
 msgid "Selected courses were unpublished."
 msgstr "Vybrané kurzy byly skryty."
 
-#: admin/courses.py:81
-msgid "Unpublish selected courses"
-msgstr "Skrýt vybrané kurzy"
+#: admin/courses.py:120
+msgid "Copy selected courses to another school year"
+msgstr "Kopírovat vybrané kurzy do jiného školního roku"
 
-#: admin/courses.py:86 admin/events.py:60 admin/orderables.py:60
-#: admin/roles.py:40 admin/schoolyear.py:48
+#: admin/courses.py:124 admin/events.py:89 admin/orderables.py:84
+#: admin/roles.py:59 admin/schoolyear.py:48
 msgid "Target school year"
 msgstr "Cílový školní rok"
 
-#: admin/courses.py:87
+#: admin/courses.py:125
 msgid "All selected courses will be copied to selected school year."
 msgstr "Vybrané kurzy budou zkopírovány do vybraného školního roku."
 
-#: admin/courses.py:96
+#: admin/courses.py:135
 msgid "Selected courses were copied to school year {}."
 msgstr "Vybrané kurzy byly zkopírovány do školního roku {}."
 
-#: admin/courses.py:110 admin/events.py:84 admin/orderables.py:87
-#: admin/roles.py:64 admin/schoolyear.py:79
+#: admin/courses.py:152 admin/events.py:117 admin/orderables.py:115
+#: admin/roles.py:87 admin/schoolyear.py:83
 msgid "Select target school year"
 msgstr "Vyberte cílový školní rok"
 
-#: admin/courses.py:119
-msgid "Copy selected courses to another school year"
-msgstr "Kopírovat vybrané kurzy do jiného školního roku"
+#: admin/courses.py:213 admin/events.py:144 admin/orderables.py:145
+msgid "Add discounts to selected registrations"
+msgstr "Přidat k vybraným přihláškám slevy"
 
-#: admin/courses.py:164 admin/events.py:119 admin/orderables.py:122
+#: admin/courses.py:220 admin/events.py:151 admin/orderables.py:152
 msgid "Discount type"
 msgstr "Druh slevy"
 
-#: admin/courses.py:166 admin/events.py:121 admin/orderables.py:124
+#: admin/courses.py:221 admin/events.py:152 admin/orderables.py:153
 msgid "absolute amount"
 msgstr "konkrétní částka"
 
-#: admin/courses.py:167 admin/events.py:122 admin/orderables.py:125
+#: admin/courses.py:221 admin/events.py:152 admin/orderables.py:153
 msgid "relative amount in percents"
 msgstr "relativní částka v procentech"
 
-#: admin/courses.py:171 admin/events.py:126 admin/orderables.py:129
+#: admin/courses.py:224 admin/events.py:155 admin/orderables.py:156
 msgid "Amount or number of percents"
 msgstr "Částka nebo počet procent"
 
-#: admin/courses.py:181
+#: admin/courses.py:234
 #, python-brace-format
 msgid "Periods of school year division: {school_year_division}"
 msgstr "Období členění školního roku: {school_year_division}"
 
-#: admin/courses.py:225 admin/events.py:150 admin/orderables.py:153
+#: admin/courses.py:282 admin/events.py:175 admin/orderables.py:176
 msgid "The discounts have been created for selected registrations."
 msgstr "K vybraným přihláškám byly přidány slevy."
 
-#: admin/courses.py:240 admin/events.py:165 admin/orderables.py:168
+#: admin/courses.py:299 admin/events.py:192 admin/orderables.py:193
 msgid "Add discounts"
 msgstr "Přidat slevy"
 
-#: admin/courses.py:249 admin/events.py:174 admin/orderables.py:177
-msgid "Add discounts to selected registrations"
-msgstr "Přidat k vybraným přihláškám slevy"
+#: admin/courses.py:310 admin/events.py:203 admin/orderables.py:204
+#: models/subjects.py:1607
+msgid "discounts"
+msgstr "slevy"
 
-#: admin/courses.py:264 admin/events.py:185 admin/orderables.py:188
+#: admin/courses.py:326 admin/events.py:214 admin/orderables.py:215
 msgid "add discount"
 msgstr "přidat slevu"
 
-#: admin/courses.py:269 models/courses.py:310
-msgid "course discounts"
-msgstr "slevy na kurz"
+#: admin/courses.py:332 admin/subjects.py:1000
+msgid "total price"
+msgstr "výsledná cena"
+
+#: admin/courses.py:345 admin/orderables.py:219 admin/subjects.py:966
+#: models/subjects.py:1691
+msgid "received payments"
+msgstr "přijaté platby"
 
-#: admin/courses.py:286 admin/events.py:201 admin/orderables.py:204
+#: admin/courses.py:362 admin/orderables.py:234
 msgid "add payment"
 msgstr "přidat platbu"
 
-#: admin/courses.py:291
-msgid "course payments"
-msgstr "platby za kurzy"
+#: admin/events.py:75
+msgid "Publish selected events"
+msgstr "Zveřejnit vybrané akce"
 
-#: admin/events.py:49
+#: admin/events.py:78
 msgid "Selected events were published."
 msgstr "Vybrané akce byly zveřejněny."
 
-#: admin/events.py:50
-msgid "Publish selected events"
-msgstr "Zveřejnit vybrané akce"
+#: admin/events.py:80
+msgid "Unpublish selected events"
+msgstr "Skrýt vybrané akce"
 
-#: admin/events.py:54
+#: admin/events.py:83
 msgid "Selected events were unpublished."
 msgstr "Vybrané akce byly skryty."
 
-#: admin/events.py:55
-msgid "Unpublish selected events"
-msgstr "Skrýt vybrané akce"
+#: admin/events.py:85
+msgid "Copy selected events to another school year"
+msgstr "Kopírovat vybrané akce do jiného školního roku"
 
-#: admin/events.py:61
+#: admin/events.py:90
 msgid "All selected events will be copied to selected school year."
 msgstr "Vybrané akce budou zkopírovány do vybraného školního roku."
 
-#: admin/events.py:70
+#: admin/events.py:100
 msgid "Selected events were copied to school year {}."
 msgstr "Vybrané akce byly zkopírovány do školního roku {}."
 
-#: admin/events.py:93
-msgid "Copy selected events to another school year"
-msgstr "Kopírovat vybrané akce do jiného školního roku"
-
-#: admin/events.py:188 models/events.py:134
-msgid "event discounts"
-msgstr "slevy na akce"
-
-#: admin/events.py:204
-msgid "event payments"
-msgstr "platby za akce"
-
-#: admin/export.py:104
+#: admin/export.py:103
 msgid "Export selected records as CSV"
 msgstr "Exportovat vybrané záznamy ve formátu CSV (hodnoty oddělené čárkou)"
 
-#: admin/export.py:111
+#: admin/export.py:112
 msgid "Export selected records as XLSX"
 msgstr "Exportovat vybrané záznamy ve formátu XLSX (Excel)"
 
-#: admin/filters.py:36
+#: admin/filters.py:37
 msgid "status"
 msgstr "stav"
 
-#: admin/filters.py:41 admin/filters.py:57 admin/filters.py:106
-#: models/agreements.py:12 models/question.py:23 models/schoolyear.py:31
+#: admin/filters.py:42 admin/filters.py:58 admin/filters.py:107
+#: models/agreements.py:12 models/question.py:34 models/schoolyear.py:31
 msgid "active"
 msgstr "aktivní"
 
-#: admin/filters.py:42 admin/filters.py:62
+#: admin/filters.py:43 admin/filters.py:63
 msgid "inactive"
 msgstr "neaktivní"
 
-#: admin/filters.py:68
+#: admin/filters.py:69
 msgid "approval"
 msgstr "schválení"
 
-#: admin/filters.py:73
+#: admin/filters.py:74
 msgid "approved"
 msgstr "schváleno"
 
-#: admin/filters.py:74
+#: admin/filters.py:75
 msgid "unapproved"
 msgstr "neschváleno"
 
-#: admin/filters.py:85
+#: admin/filters.py:86
 msgid "cancelation"
 msgstr "odhlášení"
 
-#: admin/filters.py:90
+#: admin/filters.py:91
 msgid "not canceled"
 msgstr "neodhlášeno"
 
-#: admin/filters.py:91 admin/filters.py:111
+#: admin/filters.py:92 admin/filters.py:112
 msgid "canceled"
 msgstr "odhlášeno"
 
-#: admin/filters.py:192
+#: admin/filters.py:214 admin/transaction.py:28
 msgid "All"
 msgstr "Vše"
 
-#: admin/filters.py:193
+#: admin/filters.py:214
 msgid "Set"
 msgstr "Nastaveno"
 
-#: admin/filters.py:194
+#: admin/filters.py:214
 msgid "Not set"
 msgstr "Nenastaveno"
 
-#: admin/journals.py:60 admin/timesheets.py:61
+#: admin/journals.py:115 admin/journals.py:124 admin/journals.py:239
+#: models/journals.py:104 models/journals.py:105 models/journals.py:138
+#: models/journals.py:149 models/journals.py:283
+#: templates/leprikon/journal_preview.html:39
+msgid "journal"
+msgstr "deník"
+
+#: admin/journals.py:123
+msgid "printable journal"
+msgstr "tisknutelný deník"
+
+#: admin/journals.py:129
+msgid "printable list of participants"
+msgstr "tisknutelný seznam účastníků"
+
+#: admin/journals.py:130 models/journals.py:96 models/journals.py:163
+#: models/roles.py:177 models/subjects.py:379 models/subjects.py:897
+#: models/subjects.py:901 models/subjects.py:1413
+#: templates/leprikon/registration_payment_request/subject.rml:125
+#: templates/leprikon/registration_payment_request/subject.rml:147
+#: templates/leprikon/registration_recipe.rml:10
+msgid "participants"
+msgstr "účastníci"
+
+#: admin/journals.py:191 admin/timesheets.py:67
 msgid "update entry"
 msgstr "upravit záznam"
 
-#: admin/journals.py:61 admin/timesheets.py:62
+#: admin/journals.py:192 admin/timesheets.py:68
 #: templates/leprikon/billing_info_preview.html:8
+#: templates/leprikon/journal_journal.html:137
+#: templates/leprikon/journal_journal.html:230
+#: templates/leprikon/journal_journal.html:272
+#: templates/leprikon/journal_journal.html:288
+#: templates/leprikon/journal_journal.html:303
+#: templates/leprikon/journal_preview.html:9
 #: templates/leprikon/parent_preview.html:8
 #: templates/leprikon/participant_preview.html:8
-#: templates/leprikon/subject_journal.html:133
-#: templates/leprikon/subject_journal.html:221
-#: templates/leprikon/subject_journal.html:263
-#: templates/leprikon/subject_journal.html:282
-#: templates/leprikon/subject_journal.html:301
-#: templates/leprikon/subject_preview.html:17
+#: templates/leprikon/subject_preview.html:15
 #: templates/leprikon/timesheet_detail.html:43
 msgid "edit"
 msgstr "upravit"
 
-#: admin/journals.py:110 admin/subjects.py:687 admin/subjects.py:824
-#: models/journals.py:15 models/journals.py:142 models/messages.py:22
-#: models/roles.py:254 models/subjects.py:482 models/subjects.py:786
-#: models/subjects.py:804 models/subjects.py:814
-#: templates/leprikon/alternating.html:15
-msgid "subject"
-msgstr "předmět"
-
-#: admin/journals.py:115
+#: admin/journals.py:243
 msgid "agenda"
 msgstr "program"
 
-#: admin/messages.py:21
+#: admin/messages.py:20
 msgid "Sending emails"
 msgstr "Odesílání e-mailů"
 
-#: admin/messages.py:41 templates/leprikon/admin/send_message.html:11
+#: admin/messages.py:36 templates/leprikon/admin/send_message.html:11
 msgid "Send message"
 msgstr "Poslat zprávu"
 
-#: admin/messages.py:47
+#: admin/messages.py:42
+msgid "Add recipients to existing message"
+msgstr "Přidat příjemce k existující zprávě"
+
+#: admin/messages.py:46
 msgid "Target message"
 msgstr "Cílová zpráva"
 
-#: admin/messages.py:48
+#: admin/messages.py:47
 msgid "Recipients will be added to selected message."
 msgstr "Příjemci budou přidáni k vybarané zprávě."
 
 #: admin/messages.py:66
 msgid "Select target message"
 msgstr "Vyberte cílovou zprávu"
 
-#: admin/messages.py:73
-msgid "Add recipients to existing message"
-msgstr "Přidat příjemce k existující zprávě"
+#: admin/messages.py:95 admin/messages.py:123 models/messages.py:67
+msgid "recipients"
+msgstr "příjemci"
 
-#: admin/messages.py:105
+#: admin/messages.py:106
 msgid "recipients count"
 msgstr "počet příjemců"
 
-#: admin/messages.py:106
+#: admin/messages.py:107
 msgid "sent mail"
 msgstr "odesláno e-mailem"
 
-#: admin/messages.py:107 models/messages.py:50
+#: admin/messages.py:108 models/messages.py:61
 msgid "viewed on site"
 msgstr "zobrazeno na webu"
 
-#: admin/messages.py:113 admin/messages.py:121 models/messages.py:56
-msgid "recipients"
-msgstr "příjemci"
+#: admin/messages.py:115
+msgid "actions"
+msgstr "akce"
 
-#: admin/messages.py:122
+#: admin/messages.py:124
 msgid "show recipients details"
 msgstr "zobrazit podrobnosti o příjemcích"
 
-#: admin/messages.py:124
+#: admin/messages.py:126
 msgid "send mails"
 msgstr "odeslat e-maily"
 
-#: admin/messages.py:125
+#: admin/messages.py:127
 msgid "send mail to all recipients"
 msgstr "odeslat e-mail všem příjemcům"
 
-#: admin/messages.py:127
+#: admin/messages.py:129
 msgid "send unsent"
 msgstr "odeslat neodeslané"
 
-#: admin/messages.py:128
+#: admin/messages.py:130
 msgid "send mails to new recipients only"
 msgstr "odeslat e-maily pouze novým příjemcům"
 
-#: admin/messages.py:132
-msgid "actions"
-msgstr "akce"
-
-#: admin/messages.py:173
+#: admin/messages.py:167
 msgid "Send email to selected recipients"
 msgstr "Odeslat e-mail vybraným příjemcům"
 
-#: admin/messages.py:180
+#: admin/messages.py:182
 msgid "Recipients of message {}"
 msgstr "Příjemci zprávy {}"
 
-#: admin/orderables.py:49
+#: admin/orderables.py:70
+msgid "Publish selected orderable events"
+msgstr "Zveřejnit vybrané akce na objednání"
+
+#: admin/orderables.py:73
 msgid "Selected orderable events were published."
 msgstr "Vybrané akce na objednání byly zveřejněny."
 
-#: admin/orderables.py:50
-msgid "Publish selected orderable events"
-msgstr "Zveřejnit vybrané akce na objednání"
+#: admin/orderables.py:75
+msgid "Unpublish selected orderable events"
+msgstr "Skrýt vybrané akce na objednání"
 
-#: admin/orderables.py:54
+#: admin/orderables.py:78
 msgid "Selected orderable events were unpublished."
 msgstr "Vybrané akce na objednání byly skryty."
 
-#: admin/orderables.py:55
-msgid "Unpublish selected orderable events"
-msgstr "Skrýt vybrané akce na objednání"
+#: admin/orderables.py:80
+msgid "Copy selected orderable events to another school year"
+msgstr "Kopírovat vybrané akce na objednání do jiného školního roku"
 
-#: admin/orderables.py:61
+#: admin/orderables.py:85
 msgid "All selected orderable events will be copied to selected school year."
 msgstr ""
 "Vybrané akce na objednání budou zkopírovány do vybraného školního roku."
 
-#: admin/orderables.py:72
+#: admin/orderables.py:97
 msgid "Selected orderable events were copied to school year {}."
 msgstr "Vybrané akce na objednání byly zkopírovány do školního roku {}."
 
-#: admin/orderables.py:96
-msgid "Copy selected orderable events to another school year"
-msgstr "Kopírovat vybrané akce na objednání do jiného školního roku"
-
-#: admin/orderables.py:191 models/orderables.py:136
-msgid "orderable event discounts"
-msgstr "slevy na akce na objednání"
+#: admin/pdf.py:17
+msgid "Export selected items in single PDF"
+msgstr "Exportovat vybrané položky v jediném PDF"
 
-#: admin/orderables.py:207
-msgid "orderable event payments"
-msgstr "platby za akce na objednání"
-
-#: admin/pdf.py:36
-msgid "Export selected items in single PDF."
-msgstr "Exportovat vybrané položky v jediném PDF."
-
-#: admin/pdf.py:61 templates/leprikon/payments.html:29
+#: admin/pdf.py:65 templates/leprikon/donations.html:23
+#: templates/leprikon/payments.html:32
 #: templates/leprikon/registration_preview.html:8
 msgid "download"
 msgstr "stažení"
 
-#: admin/registrationlink.py:106 admin/registrationlink.py:108
-#: models/registrationlink.py:27 models/subjects.py:848
+#: admin/refundrequest.py:61 models/organizations.py:21
+msgid "IBAN"
+msgstr "IBAN"
+
+#: admin/refundrequest.py:65 models/organizations.py:22
+msgid "BIC (SWIFT)"
+msgstr "BIC (SWIFT)"
+
+#: admin/refundrequest.py:69 admin/subjects.py:1178 admin/transaction.py:98
+#: models/refundrequest.py:45 models/transaction.py:116
+#: templates/leprikon/donation_pdf/recipe.rml:34
+#: templates/leprikon/received_payment_pdf/recipe.rml:38
+#: templates/leprikon/returned_payment_pdf/recipe.rml:38
+msgid "amount"
+msgstr "částka"
+
+#: admin/refundrequest.py:79 models/refundrequest.py:14
+msgid "requested time"
+msgstr "čas požádání"
+
+#: admin/refundrequest.py:86
+msgid "Export selected records as ABO"
+msgstr "Exportovat vybrané záznamy ve formátu ABO (KB:KM)"
+
+#: admin/refundrequest.py:90
+msgid "Constant symbol"
+msgstr "Konstantní symbol"
+
+#: admin/refundrequest.py:91
+msgid "Message for recipient"
+msgstr "Zpráva pro příjemce"
+
+#: admin/refundrequest.py:117
+msgid "Export setup"
+msgstr "Nastavení exportu"
+
+#: admin/registrationlink.py:113 admin/registrationlink.py:118
+#: models/registrationlink.py:34 models/subjects.py:861
 msgid "registration link"
 msgstr "přihlášovací odkaz"
 
-#: admin/registrationlink.py:128 admin/subjects.py:294 models/subjects.py:854
-#: templates/leprikon/subject_preview.html:101
+#: admin/registrationlink.py:130 admin/subjects.py:384 models/subjects.py:867
+#: templates/leprikon/subject_preview.html:99
 msgid "registrations"
 msgstr "přihlášky"
 
-#: admin/roles.py:41
+#: admin/roles.py:55
+msgid "Add selected leaders to another school year"
+msgstr "Přidat vybrané vedoucí do jiného školního roku"
+
+#: admin/roles.py:60
 msgid "All selected leaders will be added to selected school year."
 msgstr "Vybraní vedoucí budou přidáni do vybraného školního roku."
 
-#: admin/roles.py:50
+#: admin/roles.py:70
 msgid "Selected leaders were added to school year {}."
 msgstr "Vybraní vedoucí byli přidáni do školního roku {}."
 
-#: admin/roles.py:73
-msgid "Add selected leaders to another school year"
-msgstr "Přidat vybrané vedoucí do jiného školního roku"
-
-#: admin/roles.py:77 models/roles.py:111 models/roles.py:150
-#: models/subjects.py:1238 models/subjects.py:1261 models/subjects.py:1270
-#: models/subjects.py:1370 models/subjects.py:1396
+#: admin/roles.py:98 models/roles.py:112 models/roles.py:151
+#: models/subjects.py:1365 models/subjects.py:1390 models/subjects.py:1399
+#: models/subjects.py:1518 models/subjects.py:1546
 msgid "first name"
 msgstr "jméno"
 
-#: admin/roles.py:82 models/roles.py:112 models/roles.py:151
-#: models/subjects.py:1239 models/subjects.py:1262 models/subjects.py:1271
-#: models/subjects.py:1371 models/subjects.py:1397
+#: admin/roles.py:102 models/roles.py:113 models/roles.py:152
+#: models/subjects.py:1366 models/subjects.py:1391 models/subjects.py:1400
+#: models/subjects.py:1519 models/subjects.py:1547
 msgid "last name"
 msgstr "příjmení"
 
-#: admin/roles.py:87 conf/default_settings.py:11
-#: templates/leprikon/payment_pdf/recipe.rml:19
+#: admin/roles.py:106 conf/default_settings.py:11
+#: templates/leprikon/donation_pdf/recipe.rml:19
+#: templates/leprikon/received_payment_pdf/recipe.rml:19
 #: templates/leprikon/registration_payment_request/subject.rml:60
 #: templates/leprikon/registration_payment_request/subject.rml:84
+#: templates/leprikon/returned_payment_pdf/recipe.rml:19
 msgid "email"
 msgstr "e-mail"
 
-#: admin/roles.py:92 models/roles.py:98
+#: admin/roles.py:110 models/roles.py:98
 msgid "contacts"
 msgstr "kontakty"
 
-#: admin/roles.py:100 models/roles.py:25 models/roles.py:110
-#: models/roles.py:147 models/roles.py:210 models/subjects.py:812
-#: models/useragreement.py:8
+#: admin/roles.py:114 models/roles.py:26 models/roles.py:110
+#: models/roles.py:148 models/roles.py:218 models/subjects.py:783
+#: models/useragreement.py:11
 msgid "user"
 msgstr "uživatel"
 
-#: admin/roles.py:121 models/courses.py:41
+#: admin/roles.py:137 models/courses.py:37
 msgid "courses"
 msgstr "kurzy"
 
-#: admin/roles.py:130 models/events.py:34
+#: admin/roles.py:147 models/events.py:34
 msgid "events"
 msgstr "akce"
 
-#: admin/roles.py:139 models/orderables.py:37
+#: admin/roles.py:157 models/orderables.py:38
 msgid "orderable events"
 msgstr "akce na objednání"
 
-#: admin/roles.py:147 admin/subjects.py:317 admin/subjects.py:358
-#: models/roles.py:27 models/subjects.py:419
+#: admin/roles.py:167 admin/subjects.py:441 admin/subjects.py:489
+#: models/roles.py:29 models/subjects.py:422
 msgid "photo"
 msgstr "fotka"
 
+#: admin/schoolyear.py:44
+msgid "Copy selected school year divisions to another school year"
+msgstr "Kopírovat vybraná členění školního roku do jiného školního roku"
+
 #: admin/schoolyear.py:49
 msgid ""
 "All selected school year divisions will be copied to selected school year."
 msgstr ""
 "Vybraná členění školního roku budou zkopírována do vybraného školního roku."
 
-#: admin/schoolyear.py:64
+#: admin/schoolyear.py:65
 msgid "Selected school year divisions were copied to school year {}."
 msgstr "Vybraná členění školního roku byla zkopírována do školního roku {}."
 
-#: admin/schoolyear.py:88
-msgid "Copy selected school year divisions to another school year"
-msgstr "Kopírovat vybraná členění školního roku do jiného školního roku"
-
-#: admin/subjects.py:242
-msgid "printable journal"
-msgstr "tisknutelný deník"
-
-#: admin/subjects.py:243 admin/subjects.py:252
-#: templates/leprikon/subject_preview.html:105
-msgid "journal"
-msgstr "deník"
+#: admin/sendmail.py:9
+msgid "Send selected items by e-mail"
+msgstr "Odeslat vybrané položky e-mailem"
 
-#: admin/subjects.py:248
-msgid "printable list of participants"
-msgstr "tisknutelný seznam účastníků"
+#: admin/sendmail.py:13
+msgid "Selected items were sent by e-mail."
+msgstr "Vybrané položky byly odeslány e-mailem."
 
-#: admin/subjects.py:249 models/journals.py:21 models/roles.py:172
-#: models/subjects.py:394 models/subjects.py:886 models/subjects.py:890
-#: models/subjects.py:1284 templates/leprikon/payment_pdf/recipe.rml:63
-#: templates/leprikon/registration_payment_request/subject.rml:125
-#: templates/leprikon/registration_payment_request/subject.rml:147
-msgid "participants"
-msgstr "účastníci"
+#: admin/subjects.py:229
+msgid "advanced settings"
+msgstr "pokročilá nastavení"
+
+#: admin/subjects.py:256
+msgid "texts"
+msgstr "texty"
+
+#: admin/subjects.py:357 admin/subjects.py:364
+#: templates/leprikon/subject_preview.html:103
+msgid "journals"
+msgstr "deníky"
+
+#: admin/subjects.py:369
+msgid "add journal"
+msgstr "přidat deník"
 
-#: admin/subjects.py:266
+#: admin/subjects.py:391
 msgid "There are no approved registrations for this {}."
 msgstr "Na {} nejsou žádné aktivní přihlášky."
 
-#: admin/subjects.py:268
+#: admin/subjects.py:393
 msgid "The number of approved registrations is lower than {}."
 msgstr "Schválených přihlášek je méně než {}."
 
-#: admin/subjects.py:270
+#: admin/subjects.py:395
 msgid "The number of approved registrations is greater than {}."
 msgstr "Schválených přihlášek je více než {}."
 
-#: admin/subjects.py:291
+#: admin/subjects.py:424
 msgid "add registration"
 msgstr "vytvořit přihlášku"
 
-#: admin/subjects.py:299
+#: admin/subjects.py:429
 msgid "registration allowed"
 msgstr "povoleno přihlášování"
 
-#: admin/subjects.py:303
+#: admin/subjects.py:433
 msgid "approved registrations count"
 msgstr "počet schválených přihlášek"
 
-#: admin/subjects.py:308
+#: admin/subjects.py:437
 msgid "unapproved registrations count"
 msgstr "počet neschválených přihlášek"
 
-#: admin/subjects.py:553
+#: admin/subjects.py:762
+msgid "Approve selected registrations"
+msgstr "Schválit vybrané přihlášky"
+
+#: admin/subjects.py:772
 #, python-brace-format
 msgid "The registration {r} has been approved and the user has been notified."
 msgstr "Přihláška {r} byla schválena a uživatel byl informován."
 
-#: admin/subjects.py:555
-msgid "Approve selected registrations"
-msgstr "Schválit vybrané přihlášky"
+#: admin/subjects.py:775
+msgid "Refuse selected registrations"
+msgstr "Odmítnout vybrané přihlášky"
 
-#: admin/subjects.py:565
+#: admin/subjects.py:785
 #, python-brace-format
 msgid "The registration {r} has been refused and the user has been notified."
 msgstr "Přihláška {r} byla odmítnuta a uživatel byl informován."
 
-#: admin/subjects.py:567
-msgid "Refuse selected registrations"
-msgstr "Odmítnout vybrané přihlášky"
+#: admin/subjects.py:788
+msgid "Request payment for selected registrations"
+msgstr "Odeslat výzvu k platbě pro vybrané přihlášky"
 
-#: admin/subjects.py:572
+#: admin/subjects.py:792
 msgid "Payment was requested for selected registrations."
-msgstr "Výzva k platbě byla odeslána pro vybrané přihlášky"
+msgstr "Výzva k platbě byla odeslána pro vybrané přihlášky."
 
-#: admin/subjects.py:573
-msgid "Request payment for selected registrations"
-msgstr "Odeslat výzvu k platbě pro vybrané přihlášky"
+#: admin/subjects.py:794
+msgid "Offer refund for selected registrations"
+msgstr "Odeslat nabídku vrácení přeplatku pro vybrané přihlášky"
+
+#: admin/subjects.py:798
+msgid "Refund was offered for selected registrations."
+msgstr "Nabídka vrácení přeplatku byla odeslána pro vybrané přihlášky."
+
+#: admin/subjects.py:800
+msgid "Generate refund requests for selected registrations"
+msgstr "Vygenerovat žádosti o vrácení přeplatku pro vybrané přihlášky"
+
+#: admin/subjects.py:804
+msgid "Refund requests were generated for selected registrations."
+msgstr "Žádosti o vrácení přeplatku byly vygenerovány pro vybrané přihlášky."
+
+#: admin/subjects.py:806
+msgid "Export selected registrations as invoices in XML"
+msgstr ""
+"Exportovat vybrané záznamy ve formátu XML pro Money S3 (experimentální)"
+
+#: admin/subjects.py:812
+msgid "Cancel selected registrations"
+msgstr "Odhlásit vybrané přihlášky"
 
-#: admin/subjects.py:583
+#: admin/subjects.py:822
 #, python-brace-format
 msgid "The registration {r} has been canceled and the user has been notified."
 msgstr "Přihláška {r} byla odhlášena a uživatel byl informován."
 
-#: admin/subjects.py:585
-msgid "Cancel selected registrations"
-msgstr "Odhlásit vybrané přihlášky"
+#: admin/subjects.py:825
+msgid "Cancel cancelation request for selected registrations"
+msgstr "Zrušit žádost o odhlášení pro vybrané přihlášky"
+
+#: admin/subjects.py:828
+msgid "The cancelation requests have been removed from selected registrations."
+msgstr "U vybraných přihlášek byla zrušena žádost o odhlášení."
 
-#: admin/subjects.py:679
+#: admin/subjects.py:924
 msgid "cancelation requested"
 msgstr "požádáno o odhlášení"
 
-#: admin/subjects.py:680
+#: admin/subjects.py:925
 msgid "new registration"
 msgstr "nová přihláška"
 
-#: admin/subjects.py:681
+#: admin/subjects.py:926
 msgid "new registration, capacity full"
 msgstr "nová přihláška, naplěná kapacita"
 
-#: admin/subjects.py:682
+#: admin/subjects.py:927
 msgid "approved registration"
 msgstr "schválená přihláška"
 
-#: admin/subjects.py:700 models/subjects.py:819
+#: admin/subjects.py:930 admin/subjects.py:1081 models/journals.py:85
+#: models/journals.py:288 models/messages.py:27 models/roles.py:265
+#: models/subjects.py:506 models/subjects.py:724 models/subjects.py:772
+#: models/subjects.py:786 templates/leprikon/alternating.html:15
+msgid "subject"
+msgstr "předmět"
+
+#: admin/subjects.py:934
+msgid "decision"
+msgstr "rozhodnutí"
+
+#: admin/subjects.py:943
+msgid "admission decision"
+msgstr "rozhodnutí o přijetí"
+
+#: admin/subjects.py:943
+msgid "refusal decision"
+msgstr "rozhodnutí o odmítnutí"
+
+#: admin/subjects.py:947 models/subjects.py:793
 msgid "time of registration"
 msgstr "čas přihlášení"
 
-#: admin/subjects.py:705 models/subjects.py:822
+#: admin/subjects.py:949 models/subjects.py:802
 msgid "time of approval"
 msgstr "čas schválení"
 
-#: admin/subjects.py:710 models/subjects.py:825
+#: admin/subjects.py:951 models/subjects.py:811 models/subjects.py:820
 msgid "payment request time"
 msgstr "odeslání výzvy k platbě"
 
-#: admin/subjects.py:715 models/subjects.py:830
+#: admin/subjects.py:953
+msgid "refund offer time"
+msgstr "čas nabídky vrácení přeplatku"
+
+#: admin/subjects.py:955 models/subjects.py:829
 msgid "time of cancellation request"
 msgstr "čas žádosti o odhlášení"
 
-#: admin/subjects.py:720 models/subjects.py:835
+#: admin/subjects.py:957 models/subjects.py:838
 msgid "time of cancellation"
 msgstr "čas odhlášení"
 
-#: admin/subjects.py:728
+#: admin/subjects.py:962
 msgid "random number"
 msgstr "náhodné číslo"
 
-#: admin/subjects.py:832 models/subjects.py:1508
-#: templates/leprikon/payment_pdf/recipe.rml:38
-msgid "amount"
-msgstr "částka"
-
-#: admin/subjects.py:899
-msgid "Selected items were sent by e-mail."
-msgstr "Vybrané položky byly odeslány e-mailem."
+#: admin/subjects.py:980
+msgid "add received payment"
+msgstr "přidat přijatou platbu"
+
+#: admin/subjects.py:984 models/subjects.py:1710
+msgid "returned payments"
+msgstr "vrácené platby"
+
+#: admin/subjects.py:996
+msgid "add returned payment"
+msgstr "přidat vrácenou platbu"
 
-#: admin/subjects.py:900
-msgid "Send selected items by e-mail"
-msgstr "Odeslat vybrané položky e-mailem"
+#: admin/subjects.py:1126 models/subjects.py:853
+#: templates/leprikon/received_payment_pdf/recipe.rml:30
+#: templates/leprikon/registration_payment_request/subject.rml:193
+#: templates/leprikon/returned_payment_pdf/recipe.rml:30
+msgid "variable symbol"
+msgstr "variabilní symbol"
 
-#: admin/timesheets.py:54 models/roles.py:26 models/subjects.py:406
+#: admin/timesheets.py:58 models/roles.py:28 models/subjects.py:401
 #: templates/leprikon/registration_payment_request/subject.rml:109
 #: templates/leprikon/timesheet_detail.html:29
 msgid "description"
 msgstr "popis"
 
-#: admin/timesheets.py:106
+#: admin/timesheets.py:100
 msgid "group durations"
 msgstr "časy podle skupin"
 
-#: admin/timesheets.py:110
-msgid "Selected timesheets where marked as paid."
-msgstr "Vybrané výkazy byly sloučeni pod uživatele {}."
-
-#: admin/timesheets.py:111
+#: admin/timesheets.py:112
 msgid "Mark selected timesheets as paid"
 msgstr "Označit vybrané výkazy jako zaplacené"
 
 #: admin/timesheets.py:115
-msgid "Selected timesheets where submitted."
-msgstr "Vybrané výkazy byly odevzdány."
+msgid "Selected timesheets where marked as paid."
+msgstr "Vybrané výkazy byly sloučeni pod uživatele {}."
 
-#: admin/timesheets.py:116
+#: admin/timesheets.py:117
 msgid "Submit selected timesheets"
 msgstr "Odevzdat vybrané výkazy práce"
 
-#: admin/user.py:27 models/roles.py:34 models/roles.py:85 models/roles.py:238
-#: models/timesheets.py:68
+#: admin/timesheets.py:120
+msgid "Selected timesheets where submitted."
+msgstr "Vybrané výkazy byly odevzdány."
+
+#: admin/transaction.py:59 models/transaction.py:31
+msgid "accounted time"
+msgstr "čas zaúčtování"
+
+#: admin/transaction.py:60 models/transaction.py:40
+msgid "last updated time"
+msgstr "naposledy upraveno"
+
+#: admin/user.py:25 models/roles.py:36 models/roles.py:86 models/roles.py:247
+#: models/timesheets.py:70
 msgid "leader"
 msgstr "vedoucí"
 
-#: admin/user.py:37 views/generic.py:148
+#: admin/user.py:35 views/generic.py:150
 msgid "Yes"
 msgstr "Ano"
 
+#: admin/user.py:60
+msgid "Merge selected user accounts"
+msgstr "Sloučit vybrané uživatele"
+
 #: admin/user.py:64
 msgid "Target user"
 msgstr "Cílový uživatel"
 
 #: admin/user.py:65
 msgid "All information will be merged into selected account."
 msgstr "Všechny informace budou sloučeny do vybraného uživatelského účtu."
 
-#: admin/user.py:76
+#: admin/user.py:77
 msgid "User {} was merged into user {}."
 msgstr "Uživatel {} byl sloučen do uživatele {}."
 
-#: admin/user.py:79
+#: admin/user.py:80
 msgid "Can not merge user {} into user {}."
 msgstr "Není možné sloučit uživatele {} do uživatele {}."
 
-#: admin/user.py:86
+#: admin/user.py:89
 msgid "Select target user for merge"
 msgstr "Vyberte cílového uživatele pro sloučení"
 
-#: admin/user.py:87
+#: admin/user.py:91
 msgid ""
 "Are you sure you want to merge selected users into one? All participants, "
 "parents, registrations and other related information will be added to the "
 "target user account and the remaining users will be deleted."
 msgstr ""
 "Opravdu chcete sloučit vybrané uživatele do jednoho? Všichni účastníci, "
 "zástupci, přihlášky, a další informace spojené s těmito uživateli budou "
 "přidány k cílovému uživatelskému účtu a zbývající účty budou smazány."
 
-#: admin/user.py:91 templates/leprikon/admin/dashboard.html:7
+#: admin/user.py:96 templates/leprikon/admin/dashboard.html:7
 msgid "Users"
 msgstr "Uživatelé"
 
-#: admin/user.py:92
+#: admin/user.py:97
 msgid "Select target account for merge"
 msgstr "Vyberte cílový uživatelský účet pro sloučení"
 
-#: admin/user.py:97
-msgid "Merge selected user accounts"
-msgstr "Sloučit vybrané uživatele"
+#: admin/user.py:104
+msgid "Send instructions to reset password to selected users"
+msgstr "Odeslat vybraným uživatelům instrukce pro reset hesla"
 
-#: admin/user.py:107
+#: admin/user.py:111
 msgid "Instructions were send to user {}."
 msgstr "Instrukce byly odeslány uživateli {}."
 
-#: admin/user.py:111
+#: admin/user.py:114
 msgid "Can not send instructions to user {}."
 msgstr "Nepodařilo se odeslat instrukce uživateli {}."
 
-#: admin/user.py:114
-msgid "Send instructions to reset password to selected users"
-msgstr "Odeslat vybraným uživatelům instrukce pro reset hesla"
-
-#: admin/user.py:164 admin/user.py:167 admin/user.py:172 admin/user.py:175
+#: admin/user.py:153 admin/user.py:158 admin/user.py:164 admin/user.py:169
 msgid "login"
 msgstr "přihlásit"
 
 #: apps.py:9 cms_apps.py:13 cms_menus.py:15 cms_plugins/base.py:7
-#: cms_toolbars.py:15 cms_toolbars.py:17
+#: cms_toolbars.py:14 cms_toolbars.py:16
 msgid "Leprikon"
 msgstr "Leprikón"
 
 #: cms_apps.py:22
 msgid "Leprikon subject type"
 msgstr "Leprikón - typ kurzu nebo akce"
 
-#: cms_menus.py:24 templates/leprikon/leader_summary.html:6
+#: cms_menus.py:25 templates/leprikon/leader_summary.html:6
 #: templates/leprikon/summary.html:6
 msgid "Summary"
 msgstr "Přehled"
 
-#: cms_menus.py:30 templates/leprikon/reports/index.html:6
+#: cms_menus.py:33 templates/leprikon/reports/index.html:6
 msgid "Reports"
 msgstr "Reporty"
 
-#: cms_menus.py:36 cms_plugins/leaders.py:12 forms/journals.py:64
-#: forms/subjects.py:50
+#: cms_menus.py:41 cms_plugins/leaders.py:10 forms/journals.py:175
+#: forms/subjects.py:54
 msgid "Leader"
 msgstr "Vedoucí"
 
-#: cms_menus.py:43
+#: cms_menus.py:50
 #, python-brace-format
 msgid "My {subject_type}"
 msgstr "Moje {subject_type}"
 
-#: cms_menus.py:49
+#: cms_menus.py:58
 msgid "Alternating"
 msgstr "Suplování"
 
-#: cms_menus.py:55 templates/leprikon/admin/dashboard.html:17
-#: views/timesheets.py:21
+#: cms_menus.py:66 templates/leprikon/admin/dashboard.html:17
+#: views/timesheets.py:18
 msgid "Timesheets"
 msgstr "Výkazy práce"
 
-#: cms_menus.py:61 templates/rocketchat/chat.html:15 views/messages.py:19
+#: cms_menus.py:74 views/messages.py:19
 msgid "Messages"
 msgstr "Zprávy"
 
-#: cms_menus.py:67 templates/leprikon/admin/dashboard.html:35
-#: templates/leprikon/reports/course_stats.html:19
+#: cms_menus.py:82 templates/leprikon/admin/dashboard.html:36
+#: templates/leprikon/reports/course_stats.html:23
 #: templates/leprikon/reports/event_stats.html:19
 #: templates/leprikon/reports/orderable_stats.html:19
 msgid "Registrations"
 msgstr "Přihlášky"
 
-#: cms_menus.py:73 templates/leprikon/admin/dashboard.html:40
-#: views/reports/subjects.py:25 views/subjects.py:292
+#: cms_menus.py:90 views/subjects.py:327
 msgid "Payments"
 msgstr "Platby"
 
-#: cms_menus.py:79 templates/leprikon/registration_mail_details.html:6
+#: cms_menus.py:98 views/donation.py:20
+msgid "Donations"
+msgstr "Dary"
+
+#: cms_menus.py:106 forms/refundrequest.py:23
+#: templates/leprikon/journal_journal.html:186
+#: templates/leprikon/registration_mail_details.html:6
 #: templates/leprikon/registration_mail_details.txt:2
-#: templates/leprikon/subject_journal.html:180
+#: templates/leprikon/summary.html:42
 msgid "Participants"
 msgstr "Účastníci"
 
-#: cms_menus.py:85 templates/leprikon/subject_registration_form.html:221
+#: cms_menus.py:114 templates/leprikon/subject_registration_form.html:212
 #: views/billing_info.py:19
 msgid "Billing information"
 msgstr "Fakturační údaje"
 
-#: cms_menus.py:105 templates/leprikon/login.html:6
+#: cms_menus.py:136 templates/leprikon/login.html:6
 #: templates/leprikon/login.html:30 templates/leprikon/login.html:57
 #: templates/leprikon/password_reset_complete.html:12
 msgid "Log in"
 msgstr "Přihlásit se"
 
-#: cms_menus.py:111 templates/leprikon/login.html:73 views/user.py:21
+#: cms_menus.py:144 templates/leprikon/login.html:73 views/user.py:25
 msgid "Create account"
 msgstr "Vytvořit účet"
 
-#: cms_menus.py:117 templates/leprikon/login.html:78
+#: cms_menus.py:152 templates/leprikon/login.html:78
 msgid "Reset password"
 msgstr "Reset hesla"
 
-#: cms_menus.py:125
+#: cms_menus.py:162
 msgid "Change user details"
 msgstr "Změnit údaje o uživateli"
 
-#: cms_menus.py:131
+#: cms_menus.py:170
 msgid "Change e-mail"
 msgstr "Změnit e-mail"
 
-#: cms_menus.py:137 templates/admin/base.html:13
-#: templates/admin/inc/branding.html:23 views/user.py:105
+#: cms_menus.py:178 templates/admin/base.html:13
+#: templates/admin/inc/branding.html:23 views/user.py:110
 msgid "Change password"
 msgstr "Změnit heslo"
 
-#: cms_menus.py:143
+#: cms_menus.py:186
 msgid "Link with Google account"
 msgstr "Propojit s účtem Google"
 
-#: cms_menus.py:150
+#: cms_menus.py:199
 msgid "Link with Facebook account"
 msgstr "Propojit s účtem Facebook"
 
-#: cms_menus.py:157 templates/admin/base.html:14
+#: cms_menus.py:212 templates/admin/base.html:14
 #: templates/admin/inc/branding.html:29
 msgid "Log out"
 msgstr "Odhlásit se"
 
-#: cms_plugins/courses.py:12
+#: cms_plugins/courses.py:10
 #: templates/leprikon/reports/course_payments_status.html:14
 msgid "Course"
 msgstr "Kurz"
 
-#: cms_plugins/courses.py:22
+#: cms_plugins/courses.py:20
 msgid "Course list"
 msgstr "Výpis kurzů"
 
-#: cms_plugins/courses.py:32
+#: cms_plugins/courses.py:30
 msgid "Course list with search form"
 msgstr "Výpis kurzů s vyhledávacím formulářem"
 
-#: cms_plugins/events.py:12
+#: cms_plugins/events.py:10
 #: templates/leprikon/reports/event_payments_status.html:14
 msgid "Event"
 msgstr "Akce"
 
-#: cms_plugins/events.py:22
+#: cms_plugins/events.py:20
 msgid "Event list"
 msgstr "Výpis akcí"
 
-#: cms_plugins/events.py:32
+#: cms_plugins/events.py:30
 msgid "Event list with search form"
 msgstr "Výpis akcí s vyhledávacím formulářem"
 
-#: cms_plugins/leaders.py:22
+#: cms_plugins/leaders.py:20
 msgid "Leader list"
 msgstr "Výpis vedoucích"
 
-#: cms_plugins/leaders.py:31
+#: cms_plugins/leaders.py:29
 msgid "Leader list with search form"
 msgstr "Výpis vedoucích s vyhledávacím formulářem"
 
-#: cms_plugins/orderables.py:12
+#: cms_plugins/orderables.py:10
 #: templates/leprikon/reports/orderable_payments_status.html:14
 msgid "Orderable event"
 msgstr "Akce na objednání"
 
-#: cms_plugins/orderables.py:22
+#: cms_plugins/orderables.py:20
 msgid "Orderable list"
 msgstr "Výpis akcí na objednání"
 
-#: cms_plugins/orderables.py:32
+#: cms_plugins/orderables.py:30
 msgid "Orderable list with search form"
 msgstr "Výpis akcí na objednání s vyhledávacím formulářem"
 
 #: cms_plugins/schoolyears.py:10
 msgid "School year block"
 msgstr "Blok školního roku"
 
-#: conf/default_settings.py:12 models/organizations.py:16 models/roles.py:117
-#: models/roles.py:162 models/roles.py:218 models/subjects.py:1251
-#: models/subjects.py:1266 models/subjects.py:1275 models/subjects.py:1375
-#: models/subjects.py:1426 templates/leprikon/payment_pdf/recipe.rml:20
+#: conf/default_settings.py:12 models/organizations.py:18 models/roles.py:118
+#: models/roles.py:165 models/roles.py:227 models/subjects.py:1379
+#: models/subjects.py:1395 models/subjects.py:1404 models/subjects.py:1523
+#: models/subjects.py:1581 templates/leprikon/donation_pdf/recipe.rml:20
+#: templates/leprikon/received_payment_pdf/recipe.rml:20
 #: templates/leprikon/registration_payment_request/subject.rml:61
 #: templates/leprikon/registration_payment_request/subject.rml:85
+#: templates/leprikon/returned_payment_pdf/recipe.rml:20
 msgid "phone"
 msgstr "telefon"
 
 #: conf/default_settings.py:13
 msgid "url"
 msgstr "url adresa"
 
-#: conf/default_settings.py:17 conf/default_settings.py:21
-#: conf/default_settings.py:25 conf/default_settings.py:29
-#: conf/default_settings.py:33 conf/default_settings.py:38
-#: conf/default_settings.py:43 conf/default_settings.py:48
+#: conf/default_settings.py:16 conf/default_settings.py:18
+#: conf/default_settings.py:20 conf/default_settings.py:22
+#: conf/default_settings.py:25 conf/default_settings.py:30
+#: conf/default_settings.py:35 conf/default_settings.py:39
 msgid "Default"
 msgstr "Výchozí"
 
-#: conf/default_settings.py:34
+#: conf/default_settings.py:26
 msgid "Grouped by course groups"
 msgstr "Seskupeno podle skupin kurzů"
 
-#: conf/default_settings.py:39 conf/default_settings.py:44
+#: conf/default_settings.py:31 conf/default_settings.py:36
 msgid "Grouped by event groups"
 msgstr "Seskupeno podle skupin akcí"
 
-#: conf/default_settings.py:58
+#: conf/default_settings.py:48
 msgid "boolean field"
 msgstr "zatržítko"
 
-#: conf/default_settings.py:62
+#: conf/default_settings.py:52
 msgid "char field"
 msgstr "textové pole"
 
-#: conf/default_settings.py:66
+#: conf/default_settings.py:56
 msgid "text field"
 msgstr "víceřádkové textové pole"
 
-#: conf/default_settings.py:70
+#: conf/default_settings.py:60
 msgid "choice field"
 msgstr "výběr"
 
-#: conf/default_settings.py:74
+#: conf/default_settings.py:64
+msgid "required field with an empty option"
+msgstr "poviné pole s možností neodpovědět"
+
+#: conf/default_settings.py:68
 msgid "date field"
 msgstr "datum"
 
-#: forms/courses.py:14 templates/leprikon/registration_pdf/subject.rml:79
+#: forms/courses.py:14 templates/leprikon/registration_pdf/subject.rml:78
 msgid "Periods"
 msgstr "Období"
 
-#: forms/fields.py:14
+#: forms/fields.py:19
 msgid "agree"
 msgstr "souhlasím"
 
-#: forms/fields.py:15
+#: forms/fields.py:20
 msgid "disagree"
 msgstr "nesouhlasím"
 
-#: forms/journals.py:44
+#: forms/fields.py:53
+msgid "yes"
+msgstr "ano"
+
+#: forms/fields.py:54
+msgid "no"
+msgstr "ne"
+
+#: forms/journals.py:97 models/courses.py:25 models/courses.py:97
+#: models/courses.py:111 models/journals.py:91 models/schoolyear.py:70
+#: models/schoolyear.py:107
+msgid "school year division"
+msgstr "členění školního roku"
+
+#: forms/journals.py:156
 #, python-brace-format
 msgid "The journal entry starts at {start}"
 msgstr "Záznam deníku začíná v {start}."
 
-#: forms/journals.py:48
+#: forms/journals.py:160
 #, python-brace-format
 msgid "The journal entry ends at {end}"
 msgstr "Záznam deníku končí v {end}."
 
-#: forms/journals.py:62 forms/journals.py:193
-#: templates/leprikon/messages_table.html:6 templates/leprikon/payments.html:15
-msgid "Subject"
-msgstr "Předmět"
+#: forms/journals.py:173 forms/journals.py:309
+#: templates/leprikon/journal_journal.html:12
+#: templates/leprikon/journal_journal.html:122
+msgid "Journal"
+msgstr "Deník"
 
-#: forms/journals.py:63 forms/journals.py:87 forms/timesheets.py:29
+#: forms/journals.py:174 forms/journals.py:197 forms/timesheets.py:29
+#: templates/leprikon/donations.html:8
+#: templates/leprikon/journal_journal.html:211
 #: templates/leprikon/messages_table.html:7 templates/leprikon/payments.html:14
 #: templates/leprikon/reports/course_payments.html:14
+#: templates/leprikon/reports/course_payments.html:38
 #: templates/leprikon/reports/event_payments.html:14
+#: templates/leprikon/reports/event_payments.html:38
 #: templates/leprikon/reports/orderable_payments.html:14
-#: templates/leprikon/subject_journal.html:203
+#: templates/leprikon/reports/orderable_payments.html:38
 msgid "Date"
 msgstr "Datum"
 
-#: forms/journals.py:68 forms/timesheets.py:30
-#: templates/leprikon/subject_preview.html:31
+#: forms/journals.py:179 forms/timesheets.py:30
+#: templates/leprikon/subject_preview.html:29
 msgid "Start"
 msgstr "Začátek"
 
-#: forms/journals.py:69 forms/timesheets.py:31
-#: templates/leprikon/subject_preview.html:34
+#: forms/journals.py:180 forms/timesheets.py:31
+#: templates/leprikon/subject_preview.html:32
 msgid "End"
 msgstr "Konec"
 
-#: forms/journals.py:123
+#: forms/journals.py:242
 msgid "If You fill in start time, You must fill end time too."
 msgstr "Pokud vyplníte čas začátku, musíte vyplnit také čas konce."
 
-#: forms/journals.py:125
+#: forms/journals.py:244
 msgid "If You fill in end time, You must fill start time too."
 msgstr "Pokud vyplníte čas konce, musíte vyplnit také čas začátku."
 
-#: forms/journals.py:138
+#: forms/journals.py:257
 msgid "An overlaping entry has already been added in the journal."
 msgstr "V deníku už je kolidující záznam."
 
-#: forms/journals.py:147
+#: forms/journals.py:266
 msgid ""
 "Following participants were selected as instructed, but not selected as "
 "present: {}"
 msgstr ""
 "Následující účastníci byly označeni jako poučeni, ale nebyly označeni jako "
 "přítomní: {}"
 
-#: forms/journals.py:158
+#: forms/journals.py:277
 msgid "Following participants have not yet been instructed: {}"
 msgstr "Následující účastníci ještě nebyli poučeni: {}"
 
-#: forms/journals.py:173
+#: forms/journals.py:289
 #, python-brace-format
 msgid "Some submitted timesheet entries start at {start}"
 msgstr "Některé odevzdané záznamy práce začínají v {start}"
 
-#: forms/journals.py:177
+#: forms/journals.py:293
 #, python-brace-format
 msgid "Some submitted timesheet entries end at {end}"
 msgstr "Některé odevzdané záznamy práce končí v {end}"
 
-#: forms/journals.py:187 templates/leprikon/admin/dashboard.html:12
-#: templates/leprikon/subject_journal.html:159
+#: forms/journals.py:303 templates/leprikon/admin/dashboard.html:12
+#: templates/leprikon/journal_journal.html:163
 msgid "Leaders"
 msgstr "Vedoucí"
 
-#: forms/journals.py:188
+#: forms/journals.py:304
 msgid "Alternates"
 msgstr "Náhradní vedoucí"
 
-#: forms/journals.py:284
+#: forms/journals.py:404
 #, python-brace-format
 msgid "Leader {leaders} has already submitted timesheet for {period}."
 msgid_plural "Leaders {leaders} have already submitted timesheet for {period}."
 msgstr[0] "Vedoucí {leaders} má již odevzdaný výkaz práce za {period}."
 msgstr[1] "Vedoucí {leaders} již mají odevzdaný výkaz práce za {period}."
 msgstr[2] "Vedoucí {leaders} již mají odevzdaný výkaz práce za {period}."
 
-#: forms/journals.py:293
+#: forms/journals.py:413
 #, python-brace-format
 msgid "Alternate {leaders} has already submitted timesheet for {period}."
 msgid_plural ""
 "Alternates {leaders} have already submitted timesheet for {period}."
 msgstr[0] ""
 "Náhradní vedoucí {leaders} má již odevzdaný výkaz práce za {period}."
 msgstr[1] ""
 "Náhradní vedoucí {leaders} již mají odevzdaný výkaz práce za {period}."
 msgstr[2] ""
 "Náhradní vedoucí {leaders} již mají odevzdaný výkaz práce za {period}."
 
-#: forms/leaders.py:9 forms/messages.py:12 forms/subjects.py:44
+#: forms/leaders.py:9 forms/messages.py:12 forms/subjects.py:48
 msgid "Search term"
 msgstr "Hledaný výraz"
 
-#: forms/messages.py:37 forms/messages.py:40
+#: forms/messages.py:33 forms/messages.py:36
 msgid "Recipients"
 msgstr "Příjemci"
 
+#: forms/refundrequest.py:25
+#: templates/leprikon/registration_decision/subject.rml:57
+#: templates/leprikon/registration_details.html:32
+#: templates/leprikon/registration_mail_details.html:6
+#: templates/leprikon/registration_mail_details.txt:2
+#: templates/leprikon/registration_pdf/subject.rml:98
+#: templates/leprikon/registration_preview.html:62
+#: templates/leprikon/subject_registration_form.html:83
+#: templates/leprikon/summary.html:42
+msgid "Participant"
+msgstr "Účastník"
+
+#: forms/refundrequest.py:30
+#: templates/leprikon/registration_decision/subject.rml:78
+#: templates/leprikon/registration_details.html:109
+#: templates/leprikon/registration_mail_details.html:9
+#: templates/leprikon/registration_mail_details.txt:3
+#: templates/leprikon/registration_pdf/subject.rml:234
+#: templates/leprikon/registration_preview.html:86
+#: templates/leprikon/subject_registration_form.html:177
+#: templates/leprikon/summary.html:45
+msgid "Contact person"
+msgstr "Kontaktní osoba"
+
+#: forms/refundrequest.py:32
+#: templates/leprikon/registration_decision/subject.rml:74
+#: templates/leprikon/registration_details.html:97
+#: templates/leprikon/registration_mail_details.html:10
+#: templates/leprikon/registration_mail_details.txt:4
+#: templates/leprikon/registration_pdf/subject.rml:230
+#: templates/leprikon/registration_preview.html:80
+#: templates/leprikon/summary.html:46
+msgid "Group name"
+msgstr "Název skupiny"
+
+#: forms/refundrequest.py:34
+#: templates/leprikon/registration_refund_offer/subject.html:7
+#: templates/leprikon/registration_refund_offer/subject.txt:4
+#: templates/leprikon/summary.html:34
+msgid "Overpaid amount"
+msgstr "Výše přeplatku"
+
 #: forms/reports/courses.py:9 forms/reports/events.py:9
-#: forms/reports/orderables.py:9 forms/reports/subjects.py:8
+#: forms/reports/orderables.py:9
 msgid "Start date"
 msgstr "Datum začátku"
 
 #: forms/reports/courses.py:10 forms/reports/events.py:10
-#: forms/reports/orderables.py:10 forms/reports/subjects.py:9
+#: forms/reports/orderables.py:10
 msgid "End date"
 msgstr "Datum konce"
 
 #: forms/reports/courses.py:14 forms/reports/debtors.py:8
 #: forms/reports/events.py:14 forms/reports/orderables.py:14
-#: forms/reports/subjects.py:13
 msgid "Status for date"
 msgstr "Stav k datu"
 
 #: forms/reports/courses.py:18 forms/reports/events.py:18
-#: forms/reports/orderables.py:18 forms/reports/subjects.py:17
+#: forms/reports/orderables.py:18
 msgid "Statistics for date"
 msgstr "Statistiky k datu"
 
 #: forms/reports/courses.py:21
 msgid "Courses"
 msgstr "Kurzy"
 
 #: forms/reports/courses.py:23 forms/reports/events.py:23
-#: forms/reports/orderables.py:23 forms/reports/subjects.py:18
+#: forms/reports/orderables.py:23
 msgid "Count only paid registrations"
 msgstr "Započítat pouze zaplacené přihlášky"
 
+#: forms/reports/courses.py:24 forms/reports/events.py:24
+#: forms/reports/orderables.py:24
+msgid "Count registrations paid later"
+msgstr "Započítat přihlášky zaplacené později"
+
+#: forms/reports/courses.py:25 forms/reports/events.py:25
+#: forms/reports/orderables.py:25
+msgid "Count registrations approved later"
+msgstr "Započítat přihlášky schválené později"
+
+#: forms/reports/courses.py:26 forms/reports/events.py:26
+#: forms/reports/orderables.py:26
+msgid "Count only unique participants"
+msgstr "Započítat pouze unikátní účastníky"
+
+#: forms/reports/courses.py:28
+msgid "Maximal number of weekly hours"
+msgstr "Maximální počet hodin týdně"
+
+#: forms/reports/courses.py:29
+msgid "Count only participants attending at most this number of hours weekly."
+msgstr "Započítat pouze účastníky, kteří docházejí nanejvýš tolik hodin týdně."
+
 #: forms/reports/events.py:21
 msgid "Events"
 msgstr "Akce"
 
+#: forms/reports/events.py:28 forms/reports/orderables.py:28
+msgid "Minimal number of days"
+msgstr "Minimální počet dní"
+
+#: forms/reports/events.py:29 forms/reports/orderables.py:29
+msgid ""
+"Count only participants attending events that last at least this number of "
+"days."
+msgstr "Započítat pouze účastníky akcí, které trvají alespoň tolik dní."
+
 #: forms/reports/orderables.py:21
 msgid "Orderables"
 msgstr "Akce na objednání"
 
 #: forms/schoolyear.py:10
+#: templates/leprikon/registration_decision/subject.rml:48
 msgid "School year"
 msgstr "Školní rok"
 
-#: forms/subjects.py:45
+#: forms/subjects.py:49
 msgid "Course type"
 msgstr "Typ kurzu"
 
-#: forms/subjects.py:46
+#: forms/subjects.py:50
 msgid "Event type"
 msgstr "Typ akce"
 
-#: forms/subjects.py:47
+#: forms/subjects.py:51
 msgid "Orderable event type"
 msgstr "Typ akce na objednání"
 
-#: forms/subjects.py:48
+#: forms/subjects.py:52
 msgid "Department"
 msgstr "Oddělení"
 
-#: forms/subjects.py:49 templates/leprikon/registration_pdf/subject.rml:211
-#: templates/leprikon/subject_registration_form.html:173
+#: forms/subjects.py:53 templates/leprikon/registration_pdf/subject.rml:210
+#: templates/leprikon/subject_registration_form.html:164
 msgid "Group"
 msgstr "Skupina"
 
-#: forms/subjects.py:51 templates/leprikon/subject_preview.html:43
-#: templates/leprikon/subject_preview.html:51
+#: forms/subjects.py:55 templates/leprikon/journal_preview.html:25
+#: templates/leprikon/subject_preview.html:41
+#: templates/leprikon/subject_preview.html:49
 msgid "Place"
 msgstr "Místo"
 
-#: forms/subjects.py:52 templates/leprikon/participant_preview.html:18
+#: forms/subjects.py:56 templates/leprikon/participant_preview.html:18
 #: templates/leprikon/registration_details.html:44
-#: templates/leprikon/registration_pdf/subject.rml:109
-#: templates/leprikon/subject_preview.html:59
+#: templates/leprikon/registration_pdf/subject.rml:108
+#: templates/leprikon/subject_preview.html:57
 msgid "Age group"
 msgstr "Věková skupina"
 
-#: forms/subjects.py:53 templates/leprikon/registration_details.html:103
-#: templates/leprikon/registration_pdf/subject.rml:217
-#: templates/leprikon/subject_preview.html:66
+#: forms/subjects.py:57 templates/leprikon/registration_details.html:103
+#: templates/leprikon/registration_pdf/subject.rml:216
+#: templates/leprikon/subject_preview.html:64
 msgid "Target group"
 msgstr "Cílová skupina"
 
-#: forms/subjects.py:54
+#: forms/subjects.py:59
 msgid "Day of week"
 msgstr "Den v týdnu"
 
-#: forms/subjects.py:56
-msgid "Include past subjects"
-msgstr "Zobrazit i proběhlé akce"
+#: forms/subjects.py:61
+msgid "Show past"
+msgstr "Zobrazit proběhlé"
 
-#: forms/subjects.py:57
+#: forms/subjects.py:62
 msgid "Available for registration"
 msgstr "Povoleno přihlašování"
 
-#: forms/subjects.py:58
+#: forms/subjects.py:63
 msgid "Show invisible"
 msgstr "Zobrazit neviditelné"
 
-#: forms/subjects.py:256
+#: forms/subjects.py:268
 msgid "Participant with this birth number has already been registered."
 msgstr "Účastník s tímto rodným číslem je již přihlášený."
 
-#: forms/subjects.py:345 forms/subjects.py:486
+#: forms/subjects.py:353 forms/subjects.py:520
 #: templates/leprikon/participant_preview.html:36
 #: templates/leprikon/registration_details.html:65
 #: templates/leprikon/registration_details.html:130
-#: templates/leprikon/registration_pdf/subject.rml:145
-#: templates/leprikon/registration_pdf/subject.rml:222
+#: templates/leprikon/registration_pdf/subject.rml:144
+#: templates/leprikon/registration_pdf/subject.rml:221
 msgid "School"
 msgstr "Škola"
 
-#: forms/subjects.py:349 forms/subjects.py:490 models/roles.py:165
-#: models/subjects.py:1256 models/subjects.py:1379
+#: forms/subjects.py:357 forms/subjects.py:524 models/roles.py:169
+#: models/subjects.py:1385 models/subjects.py:1528
 msgid "other school"
 msgstr "jiná škola"
 
-#: forms/subjects.py:370 forms/subjects.py:381 forms/subjects.py:650
+#: forms/subjects.py:378 forms/subjects.py:389 forms/subjects.py:694
 msgid "Choose"
 msgstr "Vyberte"
 
-#: forms/subjects.py:371
+#: forms/subjects.py:379
 msgid "new participant"
 msgstr "nový účastník"
 
-#: forms/subjects.py:382
+#: forms/subjects.py:390
 msgid "new parent"
 msgstr "nový zástupce"
 
-#: forms/subjects.py:652
+#: forms/subjects.py:696
 msgid "no billing information"
 msgstr "bez fakturačních údajů"
 
-#: forms/subjects.py:654
+#: forms/subjects.py:700
 msgid "new billing information"
 msgstr "nové fakturační údaje"
 
 #: forms/timesheets.py:32
 msgid "Entry type"
 msgstr "Typ záznamu"
 
-#: forms/timesheets.py:41
+#: forms/timesheets.py:42
 #, python-brace-format
 msgid "The timesheet period {period} starts {start}"
 msgstr "Období {period} začíná {start}"
 
-#: forms/timesheets.py:46
+#: forms/timesheets.py:49
 #, python-brace-format
 msgid "The timesheet period {period} ends {end}"
 msgstr "Období {period} končí {end}"
 
-#: forms/timesheets.py:54
+#: forms/timesheets.py:60
 #, python-brace-format
 msgid "Your timesheet for period {period} has already been submitted."
 msgstr "Váš výkaz práce za {period} byl již odevzdán."
 
-#: forms/timesheets.py:70
+#: forms/timesheets.py:77
 msgid "An overlaping entry has already been added in the timesheet."
 msgstr "Ve výkazu práce už je kolidující záznam."
 
-#: forms/user.py:31
+#: forms/user.py:29
 msgid "User with this email already exists."
 msgstr "Uživatel s touto e-mailovou adresou již existuje."
 
-#: forms/user.py:59 forms/user.py:77
-#: templates/leprikon/registration_pdf/subject.rml:139
-#: templates/leprikon/registration_pdf/subject.rml:250
+#: forms/user.py:57 forms/user.py:75
+#: templates/leprikon/registration_pdf/subject.rml:138
+#: templates/leprikon/registration_pdf/subject.rml:249
 msgid "E-mail"
 msgstr "E-mail"
 
-#: forms/user.py:60 forms/user.py:73
+#: forms/user.py:58 forms/user.py:71
 msgid "I agree with the terms."
 msgstr "Souhlasím s podmínkami."
 
 #: gettext_overrides.py:9
 msgid "Publish page changes"
 msgstr "Publikovat změny"
 
@@ -1186,60 +1405,60 @@
 msgid "other country in EU"
 msgstr "jiná země v EU"
 
 #: migrations/0017_citizenship.py:25
 msgid "country outside EU"
 msgstr "země mimo EU"
 
-#: models/account.py:12
+#: models/account.py:11
 msgid "closure date"
 msgstr "datum uzavření"
 
-#: models/account.py:19
+#: models/account.py:18
 msgid "account closure"
 msgstr "uzavření účtu"
 
-#: models/account.py:20
+#: models/account.py:19
 msgid "account closures"
 msgstr "uzavření účtu"
 
-#: models/agegroup.py:8 models/agreements.py:8 models/agreements.py:31
+#: models/agegroup.py:8 models/agreements.py:8 models/agreements.py:32
 #: models/citizenship.py:6 models/department.py:6 models/place.py:6
-#: models/printsetup.py:11 models/question.py:14 models/registrationlink.py:18
-#: models/roles.py:211 models/school.py:7 models/schoolyear.py:103
-#: models/subjects.py:261 models/subjects.py:405 models/subjects.py:1419
-#: models/targetgroup.py:8 models/timesheets.py:122
+#: models/printsetup.py:11 models/question.py:14 models/registrationlink.py:24
+#: models/roles.py:220 models/school.py:7 models/schoolyear.py:109
+#: models/subjects.py:337 models/subjects.py:400 models/subjects.py:1574
+#: models/targetgroup.py:8 models/timesheets.py:124
 msgid "name"
 msgstr "název"
 
 #: models/agegroup.py:9
 msgid "minimal age"
 msgstr "minimální věk"
 
 #: models/agegroup.py:10
 msgid "maximal age"
 msgstr "maximální věk"
 
-#: models/agegroup.py:11 models/agreements.py:9 models/agreements.py:32
-#: models/citizenship.py:7 models/roles.py:89 models/subjects.py:135
-#: models/subjects.py:242 models/subjects.py:264 models/subjects.py:790
-#: models/targetgroup.py:9 models/timesheets.py:123
+#: models/agegroup.py:11 models/agreements.py:9 models/agreements.py:33
+#: models/citizenship.py:7 models/roles.py:89 models/schoolyear.py:115
+#: models/subjects.py:138 models/subjects.py:317 models/subjects.py:340
+#: models/subjects.py:740 models/targetgroup.py:9 models/timesheets.py:125
 msgid "order"
 msgstr "pořadí"
 
 #: models/agegroup.py:12 models/targetgroup.py:10
 msgid "require school"
 msgstr "vyžadovat školu"
 
-#: models/agegroup.py:17 models/roles.py:149 models/subjects.py:1247
+#: models/agegroup.py:17 models/roles.py:150 models/subjects.py:1375
 msgid "age group"
 msgstr "věková skupina"
 
-#: models/agegroup.py:18 models/courses.py:395 models/events.py:158
-#: models/orderables.py:160 models/subjects.py:412
+#: models/agegroup.py:18 models/courses.py:377 models/events.py:188
+#: models/orderables.py:192 models/subjects.py:414 models/subjects.py:728
 msgid "age groups"
 msgstr "věkové skupiny"
 
 #: models/agreements.py:10
 msgid "heading"
 msgstr "nadpis"
 
@@ -1247,728 +1466,786 @@
 msgid "agreement"
 msgstr "souhlas"
 
 #: models/agreements.py:17
 msgid "legal agreement"
 msgstr "právní ujednání"
 
-#: models/agreements.py:18 models/subjects.py:842
+#: models/agreements.py:18 models/subjects.py:851
 msgid "legal agreements"
 msgstr "právní ujednání"
 
-#: models/agreements.py:33
+#: models/agreements.py:34
 msgid "required"
 msgstr "povinný"
 
-#: models/agreements.py:34
+#: models/agreements.py:35
 msgid "option"
 msgstr "volba"
 
-#: models/agreements.py:40
+#: models/agreements.py:41
 msgid "agreement option"
 msgstr "volba souhlasu"
 
-#: models/agreements.py:41 models/subjects.py:926
+#: models/agreements.py:42 models/subjects.py:950
 msgid "agreement options"
 msgstr "volby souhlasu"
 
 #: models/citizenship.py:8
 msgid "require birth number"
 msgstr "vyžadovat rodné číslo"
 
-#: models/citizenship.py:13 models/roles.py:153 models/subjects.py:1241
+#: models/citizenship.py:13 models/roles.py:154 models/subjects.py:1368
 msgid "citizenship"
 msgstr "státní občanství"
 
 #: models/citizenship.py:14
 msgid "citizenships"
 msgstr "státní občanství"
 
-#: models/courses.py:30 models/schoolyear.py:64 models/schoolyear.py:102
-msgid "school year division"
-msgstr "členění školního roku"
-
-#: models/courses.py:32
+#: models/courses.py:28 models/courses.py:100
 msgid "allow period selection"
-msgstr "povolit výbět odbobí"
+msgstr "povolit výběr odbobí"
 
-#: models/courses.py:34
+#: models/courses.py:30 models/courses.py:102
 msgid "allow user to choose school year periods on registration form"
 msgstr "umožní uživateli při přihlašování vybrat konkrétní období"
 
-#: models/courses.py:40 models/courses.py:103 models/courses.py:316
-#: models/courses.py:318 models/courses.py:376 models/subjects.py:120
+#: models/courses.py:36 models/courses.py:282 models/courses.py:285
+#: models/courses.py:341 models/subjects.py:108 models/subjects.py:714
 msgid "course"
 msgstr "kurz"
 
-#: models/courses.py:57 models/courses.py:112 models/events.py:50
-msgid "times"
-msgstr "časy"
-
-#: models/courses.py:104
-msgid "day of week"
-msgstr "den v týdnu"
-
-#: models/courses.py:105 models/events.py:25 models/journals.py:17
-#: models/journals.py:117 models/orderables.py:69 models/timesheets.py:141
-msgid "start time"
-msgstr "čas začátku"
-
-#: models/courses.py:106 models/events.py:26 models/journals.py:18
-#: models/journals.py:118 models/timesheets.py:142
-msgid "end time"
-msgstr "čas konce"
-
-#: models/courses.py:111
-msgid "time"
-msgstr "čas"
-
-#: models/courses.py:116
-msgid "{day}, {start:%H:%M} - {end:%H:%M}"
-msgstr "{day} od {start:%H:%M} do {end:%H:%M}"
-
-#: models/courses.py:122
-msgid "{day}, {start:%H:%M}"
-msgstr "{day} od {start:%H:%M}"
-
-#: models/courses.py:156
+#: models/courses.py:117
 msgid "course registration"
 msgstr "přihláška na kurz"
 
-#: models/courses.py:157
+#: models/courses.py:118
 msgid "course registrations"
 msgstr "přihlášky na kurzy"
 
-#: models/courses.py:180
+#: models/courses.py:143
 msgid "no period"
 msgstr "žádné období"
 
-#: models/courses.py:220 models/courses.py:294 models/events.py:129
-#: models/orderables.py:131 models/subjects.py:853 models/subjects.py:1237
-#: models/subjects.py:1366 models/subjects.py:1395 models/subjects.py:1418
-#: models/subjects.py:1504 templates/leprikon/registration_links.html:4
+#: models/courses.py:181 models/courses.py:256 models/events.py:141
+#: models/orderables.py:145 models/refundrequest.py:27 models/subjects.py:866
+#: models/subjects.py:1363 models/subjects.py:1512 models/subjects.py:1544
+#: models/subjects.py:1572 templates/leprikon/registration_links.html:4
 msgid "registration"
 msgstr "přihláška"
 
-#: models/courses.py:226 models/courses.py:300 models/timesheets.py:66
+#: models/courses.py:187 models/courses.py:262 models/timesheets.py:67
 msgid "period"
 msgstr "období"
 
-#: models/courses.py:228 models/subjects.py:237
+#: models/courses.py:189 models/subjects.py:307 models/subjects.py:308
 msgid "payment requested"
 msgstr "odeslání výzvy k platbě"
 
-#: models/courses.py:232
+#: models/courses.py:193
 msgid "registered period"
 msgstr "přihlášené období"
 
-#: models/courses.py:233
+#: models/courses.py:194
 msgid "registered periods"
 msgstr "přihlášená období"
 
-#: models/courses.py:309
+#: models/courses.py:271
 msgid "course discount"
 msgstr "sleva na kurz"
 
-#: models/courses.py:325 models/courses.py:326
+#: models/courses.py:272
+msgid "course discounts"
+msgstr "slevy na kurz"
+
+#: models/courses.py:293 models/courses.py:294
 msgid "course registration history"
 msgstr "historie přihlášky na kurz"
 
-#: models/courses.py:332
+#: models/courses.py:300
 msgid "now"
 msgstr "nyní"
 
-#: models/courses.py:377 models/courses.py:403 models/events.py:140
-#: models/events.py:166 models/orderables.py:142 models/orderables.py:168
-#: models/roles.py:240 models/roles.py:256
+#: models/courses.py:343 models/courses.py:402 models/events.py:154
+#: models/events.py:213 models/orderables.py:158 models/orderables.py:217
+#: models/roles.py:249 models/roles.py:268
 msgid "template"
 msgstr "šablona"
 
-#: models/courses.py:380 models/courses.py:406 models/events.py:143
-#: models/events.py:169 models/orderables.py:145 models/orderables.py:171
-#: models/roles.py:243 models/roles.py:259
+#: models/courses.py:347 models/courses.py:406 models/events.py:158
+#: models/events.py:217 models/orderables.py:162 models/orderables.py:221
+#: models/roles.py:253 models/roles.py:272
 msgid "The template used to render plugin."
 msgstr "Šablona, která bude použita k zobrazení."
 
-#: models/courses.py:388 models/courses.py:481 models/events.py:151
-#: models/events.py:244 models/orderables.py:153 models/orderables.py:246
-#: models/registrationlink.py:14 models/roles.py:252 models/roles.py:287
-#: models/schoolyear.py:38 models/schoolyear.py:56 models/subjects.py:400
+#: models/courses.py:356 models/courses.py:482 models/events.py:167
+#: models/events.py:293 models/orderables.py:171 models/orderables.py:297
+#: models/registrationlink.py:18 models/roles.py:262 models/roles.py:305
+#: models/schoolyear.py:38 models/schoolyear.py:56 models/subjects.py:385
 msgid "school year"
 msgstr "školní rok"
 
-#: models/courses.py:389 models/department.py:13 models/events.py:152
-#: models/orderables.py:154
+#: models/courses.py:362 models/department.py:13 models/events.py:173
+#: models/orderables.py:177
 msgid "departments"
 msgstr "oddělení"
 
-#: models/courses.py:390 models/events.py:153 models/orderables.py:155
+#: models/courses.py:363 models/events.py:174 models/orderables.py:178
 msgid "Keep empty to skip searching by departments."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle oddělení."
 
-#: models/courses.py:393 models/courses.py:483
+#: models/courses.py:370 models/courses.py:488
 msgid "course types"
 msgstr "typy kurzů"
 
-#: models/courses.py:394
+#: models/courses.py:371
 msgid "Keep empty to skip searching by course types."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle typů kurzů."
 
-#: models/courses.py:396 models/events.py:159 models/orderables.py:161
+#: models/courses.py:378 models/events.py:189 models/orderables.py:193
 msgid "Keep empty to skip searching by age groups."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle věkových skupin."
 
-#: models/courses.py:397 models/events.py:160 models/orderables.py:162
-#: models/subjects.py:413 models/targetgroup.py:16
+#: models/courses.py:384 models/events.py:195 models/orderables.py:199
+#: models/subjects.py:415 models/subjects.py:730 models/targetgroup.py:16
 msgid "target groups"
 msgstr "cílové skupiny"
 
-#: models/courses.py:398 models/events.py:161 models/orderables.py:163
+#: models/courses.py:385 models/events.py:196 models/orderables.py:200
 msgid "Keep empty to skip searching by target groups."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle cílových skupin."
 
-#: models/courses.py:399
+#: models/courses.py:391
 msgid "course groups"
 msgstr "skupiny kurzů"
 
-#: models/courses.py:400 models/events.py:163 models/orderables.py:165
+#: models/courses.py:392 models/events.py:203 models/orderables.py:207
 msgid "Keep empty to skip searching by groups."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle skupin."
 
-#: models/courses.py:401 models/events.py:164 models/orderables.py:166
-#: models/roles.py:35 models/subjects.py:414
+#: models/courses.py:398 models/events.py:207 models/journals.py:94
+#: models/orderables.py:211 models/roles.py:37 models/subjects.py:416
 msgid "leaders"
 msgstr "vedoucí"
 
-#: models/courses.py:402 models/events.py:165 models/orderables.py:167
+#: models/courses.py:399 models/events.py:210 models/orderables.py:214
 msgid "Keep empty to skip searching by leaders."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle vedoucích."
 
 #: models/department.py:7
 msgid "department code"
 msgstr "kód oddělení"
 
 #: models/department.py:12 models/subjects.py:408
 msgid "department"
 msgstr "oddělení"
 
-#: models/events.py:23 models/orderables.py:68 models/schoolyear.py:104
-#: models/timesheets.py:31
+#: models/donation.py:15
+msgid "donation"
+msgstr "dar"
+
+#: models/donation.py:16
+msgid "donations"
+msgstr "dary"
+
+#: models/events.py:23 models/orderables.py:74 models/schoolyear.py:110
+#: models/timesheets.py:32
 msgid "start date"
 msgstr "datum začátku"
 
-#: models/events.py:24 models/schoolyear.py:105 models/timesheets.py:32
+#: models/events.py:24 models/schoolyear.py:111 models/timesheets.py:33
 msgid "end date"
 msgstr "datum konce"
 
-#: models/events.py:27 models/schoolyear.py:106
+#: models/events.py:25 models/journals.py:159 models/journals.py:266
+#: models/orderables.py:75 models/times.py:23 models/timesheets.py:149
+msgid "start time"
+msgstr "čas začátku"
+
+#: models/events.py:26 models/journals.py:160 models/journals.py:267
+#: models/times.py:24 models/timesheets.py:150
+msgid "end time"
+msgstr "čas konce"
+
+#: models/events.py:27 models/schoolyear.py:113
 msgid "due from"
 msgstr "splatnost od"
 
-#: models/events.py:28 models/schoolyear.py:107
+#: models/events.py:28 models/schoolyear.py:114
 #: templates/leprikon/registration_payment_request/subject.rml:115
 msgid "due date"
 msgstr "datum splatnosti"
 
-#: models/events.py:33 models/events.py:139 models/orderables.py:141
-#: models/subjects.py:121
+#: models/events.py:33 models/events.py:152 models/orderables.py:156
+#: models/subjects.py:109
 msgid "event"
 msgstr "akce"
 
-#: models/events.py:100
+#: models/events.py:40 models/journals.py:144 models/subjects.py:720
+#: models/times.py:31 models/times.py:81
+msgid "times"
+msgstr "časy"
+
+#: models/events.py:111
 msgid "event registration"
 msgstr "přihláška na akci"
 
-#: models/events.py:101
+#: models/events.py:112
 msgid "event registrations"
 msgstr "přihlášky na akce"
 
-#: models/events.py:133
+#: models/events.py:146
 msgid "event discount"
 msgstr "sleva na akci"
 
-#: models/events.py:156 models/events.py:246 models/orderables.py:158
-#: models/orderables.py:248
+#: models/events.py:147
+msgid "event discounts"
+msgstr "slevy na akce"
+
+#: models/events.py:181 models/events.py:299 models/orderables.py:185
+#: models/orderables.py:303
 msgid "event types"
 msgstr "druhy akcí"
 
-#: models/events.py:157 models/orderables.py:159
+#: models/events.py:182 models/orderables.py:186
 msgid "Keep empty to skip searching by event types."
 msgstr "Ponechte prázdné, pokud nechcete hledat podle skupin akcí."
 
-#: models/events.py:162 models/orderables.py:164
+#: models/events.py:202 models/orderables.py:206
 msgid "event groups"
 msgstr "skupiny akcí"
 
-#: models/fields.py:21
+#: models/fields.py:25
 msgid "Enter a valid hex color."
 msgstr "Zadejte platnou barvu."
 
-#: models/fields.py:48
+#: models/fields.py:53
 msgid "Monday"
 msgstr "pondělí"
 
-#: models/fields.py:49
+#: models/fields.py:54
 msgid "Tuesday"
 msgstr "úterý"
 
-#: models/fields.py:50
+#: models/fields.py:55
 msgid "Wednesday"
 msgstr "středa"
 
-#: models/fields.py:51
+#: models/fields.py:56
 msgid "Thursday"
 msgstr "čtvrtek"
 
-#: models/fields.py:52
+#: models/fields.py:57
 msgid "Friday"
 msgstr "pátek"
 
-#: models/fields.py:53
+#: models/fields.py:58
 msgid "Saturday"
 msgstr "sobota"
 
-#: models/fields.py:54
+#: models/fields.py:59
 msgid "Sunday"
 msgstr "neděle"
 
-#: models/fields.py:79
+#: models/fields.py:84
 msgid "Enter a valid birth number."
 msgstr "Zadejte platné rodné číslo."
 
-#: models/journals.py:16 models/journals.py:136 models/timesheets.py:140
+#: models/journals.py:93
+msgid "journal name"
+msgstr "název deníku"
+
+#: models/journals.py:98
+msgid "risks"
+msgstr "rizika"
+
+#: models/journals.py:99
+msgid "plan"
+msgstr "plán"
+
+#: models/journals.py:100
+msgid "evaluation"
+msgstr "evaluace"
+
+#: models/journals.py:143 models/subjects.py:719 models/times.py:30
+msgid "time"
+msgstr "čas"
+
+#: models/journals.py:156 models/schoolyear.py:120
+msgid "school year period"
+msgstr "období školního roku"
+
+#: models/journals.py:158 models/journals.py:278 models/timesheets.py:148
 #: templates/leprikon/alternating.html:14
-#: templates/leprikon/registration_pdf/subject.rml:310
+#: templates/leprikon/registration_pdf/subject.rml:309
 #: templates/leprikon/timesheet_detail.html:25
 msgid "date"
 msgstr "datum"
 
-#: models/journals.py:19
+#: models/journals.py:161
 msgid "session agenda"
 msgstr "program schůzky"
 
-#: models/journals.py:24 templates/leprikon/subject_journal.html:232
+#: models/journals.py:169 templates/leprikon/journal_journal.html:241
 msgid "participants instructed about safety and internal rules"
 msgstr "účastníci poučeni o bezpečnosti a vnitřním řádu"
 
-#: models/journals.py:30 models/journals.py:114
+#: models/journals.py:175 models/journals.py:257
 msgid "journal entry"
 msgstr "záznam deníku"
 
-#: models/journals.py:31
+#: models/journals.py:176
 msgid "journal entries"
 msgstr "záznamy deníku"
 
-#: models/journals.py:60 models/journals.py:155 models/orderables.py:23
-#: models/orderables.py:45 models/timesheets.py:165
+#: models/journals.py:195 models/journals.py:301 models/orderables.py:22
+#: models/orderables.py:44 models/timesheets.py:170
 #: templates/leprikon/timesheet_detail.html:27
 msgid "duration"
 msgstr "doba trvání"
 
-#: models/journals.py:116 models/timesheets.py:79 models/timesheets.py:136
+#: models/journals.py:264 models/timesheets.py:81 models/timesheets.py:140
 msgid "timesheet"
 msgstr "výkaz práce"
 
-#: models/journals.py:122
+#: models/journals.py:271
 msgid "journal leader entry"
 msgstr "záznam vedoucího v deníku"
 
-#: models/journals.py:123
+#: models/journals.py:272
 msgid "journal leader entries"
 msgstr "záznamy vedoucích v deníku"
 
-#: models/leprikonsite.py:40
+#: models/leprikonsite.py:49
 msgid "default organization"
 msgstr "výchozí organizace"
 
-#: models/leprikonsite.py:42
+#: models/leprikonsite.py:57
 msgid "default registration print setup"
 msgstr "výchozí nastavení tisku přihlášek"
 
-#: models/leprikonsite.py:44
+#: models/leprikonsite.py:65
+msgid "default decision print setup"
+msgstr "výchozí nastavení tisku rozhodnutí"
+
+#: models/leprikonsite.py:73
 msgid "default payment request print setup"
 msgstr "výchozí nastavení tisku výzvy k platbě"
 
-#: models/leprikonsite.py:46
+#: models/leprikonsite.py:81
 msgid "default bill print setup"
 msgstr "výchozí nastavení tisku dokladů"
 
-#: models/leprikonsite.py:47
+#: models/leprikonsite.py:83
 msgid "user agreement"
 msgstr "souhlas uživatele"
 
-#: models/leprikonsite.py:48
+#: models/leprikonsite.py:84
 msgid "last time user agreement changed"
 msgstr "čas poslední změny souhlasu uživatele"
 
-#: models/leprikonsite.py:50
+#: models/leprikonsite.py:89
 msgid "default registration agreements"
 msgstr "výchozí souhlasy na přihlášce"
 
-#: models/leprikonsite.py:51
+#: models/leprikonsite.py:90
 msgid "Add legal agreements for the registration form."
 msgstr "Přidejte souhlasy, které mají být v registračním formuláři."
 
-#: models/leprikonsite.py:54
+#: models/leprikonsite.py:93
 msgid "Payment Gateway"
 msgstr "Platební brána"
 
-#: models/leprikonsite.py:60
+#: models/leprikonsite.py:100
 msgid "leprikon site"
 msgstr "nastavení Leprikónu"
 
-#: models/leprikonsite.py:61
+#: models/leprikonsite.py:101
 msgid "leprikon sites"
 msgstr "nastavení Leprikónu"
 
-#: models/messages.py:19
+#: models/messages.py:18
 msgid "created"
 msgstr "vytvořeno"
 
-#: models/messages.py:21
+#: models/messages.py:25
 msgid "sender"
 msgstr "odesilatel"
 
-#: models/messages.py:23
+#: models/messages.py:28
 msgid "text"
 msgstr "text"
 
-#: models/messages.py:28 models/messages.py:46 models/messages.py:102
+#: models/messages.py:33 models/messages.py:51 models/messages.py:113
 msgid "message"
 msgstr "zpráva"
 
-#: models/messages.py:29
+#: models/messages.py:34
 msgid "messages"
 msgstr "zprávy"
 
-#: models/messages.py:48 models/messages.py:55
+#: models/messages.py:58 models/messages.py:66
 msgid "recipient"
 msgstr "příjemce"
 
-#: models/messages.py:49
+#: models/messages.py:60
 #: templates/admin/leprikon/messagerecipient/send_mails.html:63
 msgid "sent"
 msgstr "odesláno"
 
-#: models/messages.py:51
+#: models/messages.py:62
 msgid "sent by email"
 msgstr "odesláno e-mailem"
 
-#: models/messages.py:107 models/subjects.py:248
+#: models/messages.py:119 models/subjects.py:323
 msgid "attachment"
 msgstr "příloha"
 
-#: models/messages.py:108 models/subjects.py:249
+#: models/messages.py:120 models/subjects.py:324
 msgid "attachments"
 msgstr "přílohy"
 
-#: models/orderables.py:23
+#: models/orderables.py:22
 msgid "Format: HH:MM:SS"
 msgstr "Formát: HH:MM:SS"
 
-#: models/orderables.py:25
+#: models/orderables.py:24
 msgid "number of days to send the payment request before event date"
 msgstr "počet dní pro odeslání výzvy k platbě před termínem konání"
 
-#: models/orderables.py:27
+#: models/orderables.py:28
 msgid ""
 "If set, payment request will be sent this number of days before event date. "
 "If not set, payment request will be sent when registration is approved."
 msgstr ""
 "Pokud je nastaven, výzva k platbě bude odeslání tolik dní před termínem "
 "konání. Pokud není nastaven, výzva k platbě bude odeslána v okamžik "
 "schválení přihlášky."
 
-#: models/orderables.py:31
+#: models/orderables.py:32
 msgid "number of days to due date before event date"
 msgstr "počet dní do data splatnosti před termínem konání"
 
-#: models/orderables.py:36 models/subjects.py:122
+#: models/orderables.py:37 models/subjects.py:110
 msgid "orderable event"
 msgstr "akce na objednání"
 
-#: models/orderables.py:73
+#: models/orderables.py:79
 msgid "orderable event registration"
 msgstr "přihláška na akci na objednání"
 
-#: models/orderables.py:74
+#: models/orderables.py:80
 msgid "orderable event registrations"
 msgstr "přihlášky na akce na objednání"
 
-#: models/orderables.py:126
+#: models/orderables.py:122
 msgid "event date"
 msgstr "termín konání"
 
-#: models/orderables.py:135
+#: models/orderables.py:150
 msgid "orderable event discount"
 msgstr "sleva na akci na objednání"
 
-#: models/organizations.py:11
+#: models/orderables.py:151
+msgid "orderable event discounts"
+msgstr "slevy na akce na objednání"
+
+#: models/organizations.py:13
 msgid "organization name"
 msgstr "název organizace"
 
-#: models/organizations.py:12 models/roles.py:113 models/roles.py:158
-#: models/roles.py:212 models/school.py:8 models/subjects.py:1248
-#: models/subjects.py:1263 models/subjects.py:1272 models/subjects.py:1372
-#: models/subjects.py:1420
+#: models/organizations.py:14 models/roles.py:114 models/roles.py:161
+#: models/roles.py:221 models/school.py:8 models/subjects.py:1376
+#: models/subjects.py:1392 models/subjects.py:1401 models/subjects.py:1520
+#: models/subjects.py:1575
 msgid "street"
 msgstr "ulice a číslo popisné"
 
-#: models/organizations.py:13 models/roles.py:114 models/roles.py:159
-#: models/roles.py:213 models/school.py:9 models/subjects.py:1249
-#: models/subjects.py:1264 models/subjects.py:1273 models/subjects.py:1373
-#: models/subjects.py:1421
+#: models/organizations.py:15 models/roles.py:115 models/roles.py:162
+#: models/roles.py:222 models/school.py:9 models/subjects.py:1377
+#: models/subjects.py:1393 models/subjects.py:1402 models/subjects.py:1521
+#: models/subjects.py:1576
 msgid "city"
 msgstr "město (pošta)"
 
-#: models/organizations.py:14 models/roles.py:115 models/roles.py:160
-#: models/roles.py:214 models/subjects.py:1250 models/subjects.py:1265
-#: models/subjects.py:1274 models/subjects.py:1374 models/subjects.py:1422
+#: models/organizations.py:16 models/roles.py:116 models/roles.py:163
+#: models/roles.py:223 models/subjects.py:1378 models/subjects.py:1394
+#: models/subjects.py:1403 models/subjects.py:1522 models/subjects.py:1577
 msgid "postal code"
 msgstr "PSČ"
 
-#: models/organizations.py:15 models/roles.py:116 models/roles.py:161
-#: models/roles.py:219 models/subjects.py:1252 models/subjects.py:1267
-#: models/subjects.py:1276 models/subjects.py:1376 models/subjects.py:1427
+#: models/organizations.py:17 models/roles.py:117 models/roles.py:164
+#: models/roles.py:228 models/subjects.py:1380 models/subjects.py:1396
+#: models/subjects.py:1405 models/subjects.py:1524 models/subjects.py:1582
 msgid "email address"
 msgstr "e-mail"
 
-#: models/organizations.py:17 models/roles.py:215 models/subjects.py:1423
-#: templates/leprikon/payment_pdf/recipe.rml:22
+#: models/organizations.py:19 models/roles.py:224 models/subjects.py:1578
+#: templates/leprikon/donation_pdf/recipe.rml:22
+#: templates/leprikon/received_payment_pdf/recipe.rml:22
 #: templates/leprikon/registration_payment_request/subject.rml:63
 #: templates/leprikon/registration_payment_request/subject.rml:87
+#: templates/leprikon/returned_payment_pdf/recipe.rml:22
 msgid "company number"
 msgstr "IČ"
 
-#: models/organizations.py:18 models/roles.py:216 models/subjects.py:1424
+#: models/organizations.py:20 models/roles.py:225 models/subjects.py:1579
 #: templates/leprikon/billing_info_preview.html:22
 #: templates/leprikon/registration_payment_request/subject.rml:64
 #: templates/leprikon/registration_payment_request/subject.rml:88
 msgid "VAT number"
 msgstr "DIČ"
 
-#: models/organizations.py:19
-msgid "IBAN"
-msgstr "IBAN"
-
-#: models/organizations.py:20
-msgid "BIC (SWIFT)"
-msgstr "BIC (SWIFT)"
+#: models/organizations.py:29
+msgid "donation print setup"
+msgstr "nastavení tisku potvrzení o daru"
 
-#: models/organizations.py:24 models/subjects.py:151 models/subjects.py:465
+#: models/organizations.py:34 models/subjects.py:186 models/subjects.py:490
+#: models/transaction.py:161
 msgid "organization"
 msgstr "organizace"
 
-#: models/organizations.py:25
+#: models/organizations.py:35
 msgid "organizations"
 msgstr "organizace"
 
-#: models/organizations.py:33 models/roles.py:234 models/subjects.py:1441
-#: templates/leprikon/payment_pdf/recipe.rml:15
+#: models/organizations.py:40 models/roles.py:240 models/subjects.py:1593
+#: templates/leprikon/donation_pdf/recipe.rml:15
+#: templates/leprikon/received_payment_pdf/recipe.rml:15
 #: templates/leprikon/registration_payment_request/subject.rml:56
 #: templates/leprikon/registration_payment_request/subject.rml:78
+#: templates/leprikon/returned_payment_pdf/recipe.rml:15
 msgid "address"
 msgstr "adresa"
 
-#: models/organizations.py:38
+#: models/organizations.py:45
 #: templates/leprikon/registration_payment_request/subject.rml:201
 msgid "bank account"
 msgstr "číslo účtu"
 
-#: models/place.py:7 models/place.py:12 models/subjects.py:411
+#: models/place.py:7 models/place.py:12 models/subjects.py:412
 msgid "place"
 msgstr "místo"
 
 #: models/place.py:13
 msgid "places"
 msgstr "místa"
 
-#: models/printsetup.py:12
+#: models/printsetup.py:13
 msgid "pdf background"
 msgstr "pdf pozadí"
 
-#: models/printsetup.py:14
+#: models/printsetup.py:15
 msgid "margin top"
 msgstr "horní okraj"
 
-#: models/printsetup.py:15 models/printsetup.py:17 models/printsetup.py:19
-#: models/printsetup.py:21
+#: models/printsetup.py:15 models/printsetup.py:16 models/printsetup.py:17
+#: models/printsetup.py:18
 msgid "distance in milimetres"
 msgstr "vzdálenost v milimetrech"
 
 #: models/printsetup.py:16
 msgid "margin left"
 msgstr "levý okraj"
 
-#: models/printsetup.py:18
+#: models/printsetup.py:17
 msgid "margin right"
 msgstr "pravý okraj"
 
-#: models/printsetup.py:20
+#: models/printsetup.py:18
 msgid "margin bottom"
 msgstr "spodní okraj"
 
-#: models/printsetup.py:26
+#: models/printsetup.py:23
 msgid "print setup"
 msgstr "nastavení tisku"
 
-#: models/printsetup.py:27
+#: models/printsetup.py:24
 msgid "print setups"
 msgstr "nastavení tisku"
 
 #: models/question.py:15
+msgid "unique identifier"
+msgstr "unikátní identifikátor"
+
+#: models/question.py:16
 msgid "question"
 msgstr "otázka"
 
-#: models/question.py:16
+#: models/question.py:18
 msgid "help text"
 msgstr "nápověda"
 
-#: models/question.py:17
+#: models/question.py:21
 msgid "This is help text. The help text is shown next to the form field."
 msgstr "Toto je text nápovědy. Nápověda se zobrazuje u formulářového políčka."
 
-#: models/question.py:18
+#: models/question.py:24
 msgid "field"
 msgstr "vstupní pole"
 
-#: models/question.py:21
+#: models/question.py:29
 msgid "field_args"
 msgstr "parametry"
 
-#: models/question.py:22
+#: models/question.py:32
 msgid "Enter valid JSON structure representing field configuration."
 msgstr ""
 "Zadejte validní strukturu v jazyce JSON, obsahující konfiguraci vstupního "
 "pole."
 
-#: models/question.py:27
+#: models/question.py:39
 msgid "additional question"
 msgstr "doplňující otázka"
 
-#: models/question.py:28 models/subjects.py:137 models/subjects.py:448
+#: models/question.py:40 models/subjects.py:143 models/subjects.py:436
 msgid "additional questions"
 msgstr "doplňující otázky"
 
-#: models/question.py:57
+#: models/question.py:64
 msgid "Failed to create field with given field args: {}"
 msgstr "Nepodařilo se vytvořit vstupní pole se zadanými parametry: {}"
 
-#: models/registrationlink.py:16 models/subjects.py:188 models/subjects.py:257
-#: models/subjects.py:265 models/subjects.py:402
+#: models/refundrequest.py:21
+msgid "requested by"
+msgstr "požádal(a)"
+
+#: models/refundrequest.py:29
+msgid "bank account number"
+msgstr "číslo bankovního účtu"
+
+#: models/refundrequest.py:34
+msgid "refund request"
+msgstr "žádost o vrácení přeplatku"
+
+#: models/refundrequest.py:35
+msgid "refund requests"
+msgstr "žádosti o vrácení přeplatku"
+
+#: models/refundrequest.py:43
+msgid "Refund may only be requested for overpaid registrations."
+msgstr "O navrácení přeplatku je možné žádat pouze pro přeplacené přihlášky."
+
+#: models/registrationlink.py:21 models/subjects.py:246 models/subjects.py:332
+#: models/subjects.py:341 models/subjects.py:388
 msgid "subject type"
 msgstr "typ kurzu nebo akce"
 
-#: models/registrationlink.py:19 models/subjects.py:417
+#: models/registrationlink.py:25 models/subjects.py:420
 msgid "registration active from"
 msgstr "přihlašování povoleno od"
 
-#: models/registrationlink.py:20 models/subjects.py:418
+#: models/registrationlink.py:26 models/subjects.py:421
 msgid "registration active to"
 msgstr "přihlašování povoleno do"
 
-#: models/registrationlink.py:22 models/subjects.py:129 models/subjects.py:483
+#: models/registrationlink.py:28 models/subjects.py:120 models/subjects.py:507
 msgid "subjects"
 msgstr "předmět"
 
-#: models/registrationlink.py:28
+#: models/registrationlink.py:35
 msgid "registration links"
 msgstr "přihlašovací odkazy"
 
-#: models/roles.py:28 models/subjects.py:422
+#: models/roles.py:30 models/subjects.py:131 models/subjects.py:423
 msgid "page"
 msgstr "stránka"
 
-#: models/roles.py:29 models/schoolyear.py:39 models/schoolyear.py:127
+#: models/roles.py:31 models/schoolyear.py:39 models/schoolyear.py:131
 msgid "school years"
 msgstr "školní roky"
 
-#: models/roles.py:86
+#: models/roles.py:87
 msgid "contact type"
 msgstr "druh kontaktu"
 
 #: models/roles.py:88 models/roles.py:97
 msgid "contact"
 msgstr "kontakt"
 
-#: models/roles.py:90 models/subjects.py:231 models/subjects.py:416
+#: models/roles.py:90 models/subjects.py:298 models/subjects.py:419
 msgid "public"
 msgstr "veřejný"
 
-#: models/roles.py:121
+#: models/roles.py:122
 msgid "parent"
 msgstr "zástupce"
 
-#: models/roles.py:122
+#: models/roles.py:123
 msgid "parents"
 msgstr "zástupci"
 
-#: models/roles.py:154 models/subjects.py:1242
+#: models/roles.py:156 models/subjects.py:1370
 msgid "birth number"
 msgstr "rodné číslo"
 
-#: models/roles.py:155 models/subjects.py:1243
+#: models/roles.py:157 models/subjects.py:1371
 msgid "birth date"
 msgstr "datum narození"
 
-#: models/roles.py:156 models/subjects.py:1244
+#: models/roles.py:159 models/subjects.py:1373
 msgid "gender"
 msgstr "pohlaví"
 
-#: models/roles.py:157 models/subjects.py:1245
+#: models/roles.py:159 models/subjects.py:1373
 msgid "male / boy"
 msgstr "muž / chlapec"
 
-#: models/roles.py:157 models/subjects.py:1245
+#: models/roles.py:159 models/subjects.py:1373
 msgid "female / girl"
 msgstr "žena / dívka"
 
-#: models/roles.py:164 models/school.py:14 models/subjects.py:1255
-#: models/subjects.py:1378
+#: models/roles.py:167 models/school.py:14 models/subjects.py:1383
+#: models/subjects.py:1526
 msgid "school"
 msgstr "škola"
 
-#: models/roles.py:166 models/subjects.py:1257 models/subjects.py:1380
+#: models/roles.py:170 models/subjects.py:1386 models/subjects.py:1529
 msgid "class"
 msgstr "třída"
 
-#: models/roles.py:167 models/subjects.py:1258
+#: models/roles.py:171 models/subjects.py:1387
 msgid "health"
 msgstr "údaje o zdravotní způsobilosti účastníka (případná omezení)"
 
-#: models/roles.py:171 models/subjects.py:1283
-#: templates/leprikon/payment_pdf/recipe.rml:61
+#: models/roles.py:172 models/subjects.py:1407 models/subjects.py:1531
+msgid "additional answers"
+msgstr "doplňující odpovědi"
+
+#: models/roles.py:176 models/subjects.py:1412
 #: templates/leprikon/registration_payment_request/subject.rml:125
 #: templates/leprikon/registration_payment_request/subject.rml:147
+#: templates/leprikon/registration_recipe.rml:12
 msgid "participant"
 msgstr "účastník"
 
-#: models/roles.py:175
+#: models/roles.py:180
 #, python-brace-format
 msgid "{first_name} {last_name} ({birth_date})"
 msgstr "{first_name} {last_name} ({birth_date})"
 
-#: models/roles.py:217 models/subjects.py:1425
-#: templates/leprikon/payment_pdf/recipe.rml:69
+#: models/roles.py:226 models/subjects.py:1580
 #: templates/leprikon/registration_payment_request/subject.rml:83
 #: templates/leprikon/registration_payment_request/subject.rml:128
 #: templates/leprikon/registration_payment_request/subject.rml:150
+#: templates/leprikon/registration_recipe.rml:18
 msgid "contact person"
 msgstr "kontaktní osoba"
 
-#: models/roles.py:220 models/subjects.py:1428
+#: models/roles.py:229 models/subjects.py:1583
 msgid "employee ID"
 msgstr "identifikace zaměstnance"
 
-#: models/roles.py:225 models/roles.py:226 models/subjects.py:1432
-#: models/subjects.py:1433
+#: models/roles.py:234 models/roles.py:235 models/subjects.py:1587
+#: models/subjects.py:1588
 msgid "billing information"
 msgstr "fakturační údaje"
 
-#: models/roles.py:268 models/roles.py:269
+#: models/roles.py:282 models/roles.py:283
 msgid "Selected subject is not in the selected school year."
 msgstr "Vybraná aktivita není ve vybraném školním roce."
 
 #: models/school.py:15
 msgid "schools"
 msgstr "školy"
 
@@ -1980,725 +2257,755 @@
 msgid "Only the first of the two years."
 msgstr "Pouze první ze dvou roků."
 
 #: models/schoolyear.py:46
 msgid "Can not delete sclool year with courses or events."
 msgstr "Nemůžete smazat školní rok, pokud má nějaké kurzy nebo akce."
 
-#: models/schoolyear.py:57
+#: models/schoolyear.py:58
 msgid "division name"
 msgstr "název členění"
 
-#: models/schoolyear.py:58
-msgid "period name"
-msgstr "název období"
+#: models/schoolyear.py:60
+msgid "price unit name"
+msgstr "název jednotky k ceně"
+
+#: models/schoolyear.py:62
+msgid ""
+"Unit name the price applies to. For example semester, month, or 5 lessons."
+msgstr ""
+"Název jednotky, za kterou je udávána cena, například pololetí, měsíc, 5 "
+"lekcí, apod."
 
-#: models/schoolyear.py:65
+#: models/schoolyear.py:71
 msgid "school year divisions"
 msgstr "členění školního roku"
 
 #: models/schoolyear.py:112
-msgid "school year period"
-msgstr "období školního roku"
+msgid "number of price units"
+msgstr "počet jednotek"
 
-#: models/schoolyear.py:113
+#: models/schoolyear.py:121
 msgid "school year periods"
 msgstr "období školních roků"
 
-#: models/schoolyear.py:116
-msgid "{name}, {start:%m/%d %y} - {end:%m/%d %y}"
-msgstr "{name}, {start:%d. %m. %y} až {end:%d. %m. %y}"
-
-#: models/schoolyear.py:128
+#: models/schoolyear.py:132
 msgid "Which school years should the block be visible for?"
 msgstr "Pro které školní roky se má tento blok zobrazit?"
 
-#: models/startend.py:9
+#: models/startend.py:10
 msgid "Start must be before end"
 msgstr "Začátek musí být dříve než konec"
 
-#: models/startend.py:10
+#: models/startend.py:11
 msgid "End must be later than start"
 msgstr "Konec musí být později než začátek"
 
-#: models/subjects.py:63
+#: models/subjects.py:71
 msgid ""
 "Hello,\n"
 "thank You for submitting the registration.\n"
 "We will inform you about its further processing."
 msgstr ""
 "Dobrý den,\n"
 "děkujeme Vám za vyplnění přihlášky.\n"
 "O jejím dalším zpracování Vás budeme informovat."
 
-#: models/subjects.py:69
+#: models/subjects.py:75
 msgid ""
 "Hello,\n"
 "we are pleased to inform You, that Your registration was approved.\n"
 "We are looking forward to see You."
 msgstr ""
 "Dobrý den,\n"
 "máme pro Vás dobrou zprávu, Vaše přihláška byla schválena.\n"
 "Těšíme se na Vás."
 
-#: models/subjects.py:75
+#: models/subjects.py:80
 msgid ""
 "Hello,\n"
 "we are sorry to inform You, that Your registration was refused."
 msgstr ""
 "Dobrý den,\n"
 "je nám líto, Vaše přihláška byla odmítnuta."
 
-#: models/subjects.py:80
+#: models/subjects.py:84
 msgid ""
 "Hello,\n"
 "we'd like to ask You to pay for Your registration.\n"
 "If You have already made the payment recently, please ignore this message."
 msgstr ""
 "Dobrý den,\n"
 "žádáme Vás o uhrazení přihlášky.\n"
 "Pokud jste již platbu v nedávné době provedli, můžete tuto zprávu ignorovat."
 
-#: models/subjects.py:86
+#: models/subjects.py:89
+msgid ""
+"Hello,\n"
+"Your registration has been overpaid.\n"
+"Please, tell us how you wish us to refund."
+msgstr ""
+"Dobrý den,\n"
+"U vaší přihlášky evidujeme přeplatek.\n"
+"Dejte nám prosím vědět, jak si přejete, abychom Vám přeplatek vrátili."
+
+#: models/subjects.py:91
 msgid ""
 "Hello,\n"
 "Your registration was canceled."
 msgstr ""
 "Dobrý den,\n"
 "vaše přihláška byla odhlášena."
 
-#: models/subjects.py:91
+#: models/subjects.py:92
 msgid ""
 "Hello,\n"
 "we have just grated a discount for Your registration."
 msgstr ""
 "Dobrý den,\n"
 "dali jsme Vám slevu na přihlášku."
 
-#: models/subjects.py:96
+#: models/subjects.py:94
 msgid ""
 "Hello,\n"
 "we have just received Your payment. Thank You.\n"
 "Please see the recipe attached."
 msgstr ""
 "Dobrý den,\n"
 "právě jsme obdrželi Vaši platbu. Děkujeme Vám.\n"
 "Doklad naleznete v příloze."
 
-#: models/subjects.py:105
-msgid "broadcast group"
-msgstr "vysílací skupina"
-
-#: models/subjects.py:106
-msgid "chat group"
-msgstr "diskuzní skupina"
-
-#: models/subjects.py:110
+#: models/subjects.py:97
 msgid ""
-"Only the leader can write to broadcast group. Users may reply to the sender "
-"with direct messages.\n"
-"Chat group allows all members to chat with each other."
+"Hello,\n"
+"we have just returned Your payment. Thank You.\n"
+"Please see the recipe attached."
 msgstr ""
-"Do vysílací skupiny může psát jen vedoucí. Uživatelé mu mohou odpovídat "
-"prostřednictvím přímých zpráv.\n"
-"Diskuzní skupina umožňuje všem členům diskutovat s ostatními."
+"Dobrý den,\n"
+"právě jsme Vám vrátili platbu.\n"
+"Doklad naleznete v příloze."
 
-#: models/subjects.py:125
+#: models/subjects.py:115
 msgid "course type"
 msgstr "typ kurzu"
 
-#: models/subjects.py:126
+#: models/subjects.py:116
 msgid "event type"
 msgstr "typ akce"
 
-#: models/subjects.py:127
+#: models/subjects.py:117
 msgid "orderable event type"
 msgstr "typ akce na objednání"
 
-#: models/subjects.py:130
+#: models/subjects.py:121
 msgid "name (singular)"
 msgstr "název (jednotné číslo)"
 
-#: models/subjects.py:131
+#: models/subjects.py:122
 msgid "name (genitiv)"
 msgstr "název (druhý pád)"
 
-#: models/subjects.py:132
+#: models/subjects.py:123
 msgid "name (akuzativ)"
 msgstr "název (čtvrtý pád)"
 
-#: models/subjects.py:133
+#: models/subjects.py:124
 msgid "name (plural)"
 msgstr "název (množné číslo)"
 
-#: models/subjects.py:138 models/subjects.py:450
+#: models/subjects.py:133
+msgid ""
+"Select page, where the subjects will be listed. New subject type requireds "
+"new page. If You assign an existing page, the current content of the page "
+"will be replaced with the new subject list."
+msgstr ""
+"Vyberte stránku, na níž bude výpis položek tohoto typu. Nový typ kurzu nebo "
+"akce vyžaduje novou stránku. Pokud přiřadíte existující stránku, její "
+"stávající obsah bude nahrazen výpisem kurzů nebo akcí nového typu."
+
+#: models/subjects.py:144 models/subjects.py:439
 msgid "Add additional questions to be asked in the registration form."
 msgstr "Přidejte doplňující otázky, které mají být v registračním formuláři."
 
-#: models/subjects.py:141 models/subjects.py:452
+#: models/subjects.py:150 models/subjects.py:445
 msgid "additional legal agreements"
 msgstr "další souhlasy na přihlášce"
 
-#: models/subjects.py:142
+#: models/subjects.py:151
 msgid "Add additional legal agreements specific to this subject type."
 msgstr ""
 "Pridejte souhlasy, které mají být v registračním formuláři pro tento typ "
 "kurzu nebo akce."
 
-#: models/subjects.py:145 models/subjects.py:456
+#: models/subjects.py:159 models/subjects.py:454 models/subjects.py:463
 msgid "registration print setup"
 msgstr "nastavení tisku přihlášek"
 
-#: models/subjects.py:147 models/subjects.py:459
+#: models/subjects.py:167
+msgid "decision print setup"
+msgstr "nastavení tisku rozhodnutí"
+
+#: models/subjects.py:175 models/subjects.py:472
 msgid "payment request print setup"
 msgstr "nastavení tisku výzvy k platbě"
 
-#: models/subjects.py:149 models/subjects.py:462
+#: models/subjects.py:183 models/subjects.py:481
 msgid "payment print setup"
 msgstr "nastavení tisku dokladů"
 
-#: models/subjects.py:153
-msgid "default chat group type"
-msgstr "výchozí typ diskuzní skupiny"
-
-#: models/subjects.py:157 models/subjects.py:471
+#: models/subjects.py:189 models/subjects.py:493
 msgid "text: registration received"
 msgstr "text: přihláška přijata"
 
-#: models/subjects.py:161 models/subjects.py:472
+#: models/subjects.py:195 models/subjects.py:494
 msgid "text: registration approved"
 msgstr "text: přihláška schválena"
 
-#: models/subjects.py:165 models/subjects.py:473
+#: models/subjects.py:201 models/subjects.py:495
 msgid "text: registration refused"
 msgstr "text: přihláška odmítnuta"
 
-#: models/subjects.py:169 models/subjects.py:474
+#: models/subjects.py:207 models/subjects.py:496
 msgid "text: registration payment request"
 msgstr "text: výzva k platbě"
 
-#: models/subjects.py:173 models/subjects.py:475
+#: models/subjects.py:213 models/subjects.py:497
+msgid "text: registration refund offer"
+msgstr "text: nabídka vrácení přeplatku"
+
+#: models/subjects.py:219 models/subjects.py:498
 msgid "text: registration canceled"
 msgstr "text: přihláška odhlášena"
 
-#: models/subjects.py:177 models/subjects.py:476
+#: models/subjects.py:225 models/subjects.py:499
 msgid "text: discount granted"
 msgstr "text: poskytnuta sleva"
 
-#: models/subjects.py:181 models/subjects.py:477
+#: models/subjects.py:231 models/subjects.py:500
 msgid "text: payment received"
 msgstr "text: platba přijata"
 
-#: models/subjects.py:189
+#: models/subjects.py:237 models/subjects.py:501
+msgid "text: payment returned"
+msgstr "text: platba vrácena"
+
+#: models/subjects.py:247
 msgid "subject types"
 msgstr "typy kurzů nebo akcí"
 
-#: models/subjects.py:232
+#: models/subjects.py:298
 msgid "The attachment will be available before registration."
 msgstr "Příloha bude dostupná před přihlášením."
 
-#: models/subjects.py:233
+#: models/subjects.py:301
 msgid "send when"
 msgstr "odeslat když"
 
-#: models/subjects.py:234
+#: models/subjects.py:304
 msgid "registration received"
 msgstr "přihláška přijata"
 
-#: models/subjects.py:235
+#: models/subjects.py:305
 msgid "registration approved"
 msgstr "přihláška schválena"
 
-#: models/subjects.py:236
+#: models/subjects.py:306
 msgid "registration refused"
 msgstr "přihláška odmítnuta"
 
-#: models/subjects.py:238
+#: models/subjects.py:309
 msgid "registration canceled"
 msgstr "přihláška odhlášena"
 
-#: models/subjects.py:239
+#: models/subjects.py:310
 msgid "discount granted"
 msgstr "poskytnuta sleva"
 
-#: models/subjects.py:240
+#: models/subjects.py:311
 msgid "payment received"
 msgstr "platba přijata"
 
-#: models/subjects.py:241
+#: models/subjects.py:312
+msgid "payment returned"
+msgstr "platba vrácena"
+
+#: models/subjects.py:315
 msgid "The attachment will be sent with notification on selected events."
 msgstr "Příhloha bude odeslána s notifikací o vybraných událostech."
 
-#: models/subjects.py:262
+#: models/subjects.py:338
 msgid "plural"
 msgstr "množné číslo"
 
-#: models/subjects.py:263
+#: models/subjects.py:339
 msgid "color"
 msgstr "barva"
 
-#: models/subjects.py:270
+#: models/subjects.py:346
 msgid "subject group"
 msgstr "skupina kurzů nebo akcí"
 
-#: models/subjects.py:271
+#: models/subjects.py:347
 msgid "subject groups"
 msgstr "skupiny kurzů a akcí"
 
-#: models/subjects.py:395 models/subjects.py:409
+#: models/subjects.py:380 models/subjects.py:410
 msgid "groups"
 msgstr "skupiny"
 
-#: models/subjects.py:403
+#: models/subjects.py:391
 msgid "registration type"
 msgstr "způsob přihlašování"
 
-#: models/subjects.py:404
-msgid "accounting code"
-msgstr "účetní kód"
-
-#: models/subjects.py:415 models/subjects.py:789 models/subjects.py:817
-msgid "price"
-msgstr "cena"
-
-#: models/subjects.py:424
-msgid "minimal participants count per registration"
-msgstr "minimální počet účastníků na přihlášce"
-
-#: models/subjects.py:426 models/subjects.py:431
+#: models/subjects.py:395
 msgid ""
 "Participant details include birth number (birth day), age group, contacts, "
-"parent, etc."
+"parent, etc. Group member details only include name and note."
 msgstr ""
 "Údaje o účastníkovi zahrnují rodné číslo, věkovou skupinu, kontakty, zákonné "
-"zástupce, atd."
-
-#: models/subjects.py:429
-msgid "maximal participants count per registration"
-msgstr "maximální počet účastníků na přihlášce"
+"zástupce, atd. Údaje o členovi skupiny zahrnují pouze jméno a poznámku."
 
-#: models/subjects.py:434
-msgid "minimal group members count per registration"
-msgstr "minimální počet členů skupiny na přihlášce"
-
-#: models/subjects.py:435 models/subjects.py:439
-msgid "Group member details only include name and note."
-msgstr "Údaje o členu skupiny zahrnují pouze jméno a poznámku."
+#: models/subjects.py:399
+msgid "accounting code"
+msgstr "účetní kód"
 
-#: models/subjects.py:438
-msgid "maximal group members count per registration"
-msgstr "maximální počet členů skupiny na přihlášce"
+#: models/subjects.py:417 models/subjects.py:738
+msgid "price per registration"
+msgstr "cena za přihlášku"
+
+#: models/subjects.py:418 models/subjects.py:739
+msgid "price per participant"
+msgstr "cena za účastníka"
+
+#: models/subjects.py:425 models/subjects.py:733
+msgid "minimal participants / group members count per registration"
+msgstr "minimální počet účastníků / členů skupiny na přihlášce"
+
+#: models/subjects.py:428 models/subjects.py:736
+msgid "maximal participants / group members count per registration"
+msgstr "maximální počet účastníků / členů skupiny na přihlášce"
 
-#: models/subjects.py:441
+#: models/subjects.py:430
 msgid "minimal registrations count"
 msgstr "minimální počet přihlášek"
 
-#: models/subjects.py:442
+#: models/subjects.py:431
 msgid "maximal registrations count"
 msgstr "maximální počet přihlášek"
 
-#: models/subjects.py:443
+#: models/subjects.py:432
 msgid "minimal number of days to due date"
 msgstr "minimální počet dní do data splatnosti"
 
-#: models/subjects.py:444
-msgid "risks"
-msgstr "rizika"
-
-#: models/subjects.py:445
-msgid "plan"
-msgstr "plán"
-
-#: models/subjects.py:446
-msgid "evaluation"
-msgstr "evaluace"
-
-#: models/subjects.py:447 models/subjects.py:838 models/subjects.py:1398
-#: models/subjects.py:1509
+#: models/subjects.py:433 models/subjects.py:847 models/subjects.py:1548
+#: models/transaction.py:121
 msgid "note"
 msgstr "poznámka"
 
-#: models/subjects.py:453
+#: models/subjects.py:446
 msgid "Add additional legal agreements specific for this subject."
 msgstr ""
 "Pridejte souhlasy, které mají být v registračním formuláři pro tento předmět."
 
-#: models/subjects.py:457 models/subjects.py:460 models/subjects.py:463
-#: models/subjects.py:466
+#: models/subjects.py:455 models/subjects.py:464 models/subjects.py:473
+#: models/subjects.py:482 models/subjects.py:491
 msgid "Only use to set value specific for this subject."
 msgstr "Nastavte pouze pokud je hodnota specifická pro tento předmět."
 
-#: models/subjects.py:468
-msgid "chat group type"
-msgstr "typ diskuzní skupiny"
-
-#: models/subjects.py:615 templatetags/leprikon_tags.py:147
+#: models/subjects.py:610 templatetags/leprikon_tags.py:146
 msgid "Registering will start on {}."
 msgstr "Přihlašování bude zahájeno {}."
 
-#: models/subjects.py:617 templatetags/leprikon_tags.py:134
+#: models/subjects.py:612 templatetags/leprikon_tags.py:133
 msgid "Registering ended on {}"
 msgstr "Přihlašování bylo ukončeno {}."
 
-#: models/subjects.py:618 templatetags/leprikon_tags.py:131
-msgid "Registering is currently not allowed."
-msgstr "Přihlašování momentálně není povoleno."
-
-#: models/subjects.py:635
+#: models/subjects.py:631
 msgid "age groups list"
 msgstr "seznam věkových skupin"
 
-#: models/subjects.py:639
+#: models/subjects.py:635
 msgid "groups list"
 msgstr "seznam skupin"
 
-#: models/subjects.py:643
+#: models/subjects.py:639
 msgid "leaders list"
 msgstr "seznam vedoucích"
 
-#: models/subjects.py:647
+#: models/subjects.py:643
 msgid "target groups list"
 msgstr "seznam cílových skupin"
 
-#: models/subjects.py:787
+#: models/subjects.py:725
 msgid "variant name"
 msgstr "název varianty"
 
-#: models/subjects.py:788
+#: models/subjects.py:726
 msgid "variant description"
 msgstr "popis varianty"
 
-#: models/subjects.py:795 models/subjects.py:816
+#: models/subjects.py:727
+msgid "available for registration"
+msgstr "povoleno k přihlašování"
+
+#: models/subjects.py:745 models/subjects.py:789
 msgid "variant"
 msgstr "varianta"
 
-#: models/subjects.py:796
+#: models/subjects.py:746
 msgid "variants"
 msgstr "varianty"
 
-#: models/subjects.py:821
+#: models/subjects.py:791
+msgid "price"
+msgstr "cena"
+
+#: models/subjects.py:800
 msgid "created by"
 msgstr "vytvořil(a)"
 
-#: models/subjects.py:824
+#: models/subjects.py:809
 msgid "approved by"
 msgstr "schválil(a)"
 
-#: models/subjects.py:828
+#: models/subjects.py:818 models/subjects.py:827
 msgid "payment requested by"
 msgstr "výzvy k platbě odeslal(a)"
 
-#: models/subjects.py:833
+#: models/subjects.py:836
 msgid "cancelation requested by"
 msgstr "o odhlášení požádal(a)"
 
-#: models/subjects.py:837
+#: models/subjects.py:845
 msgid "canceled by"
 msgstr "odhlásil(a)"
 
-#: models/subjects.py:844 templates/leprikon/payment_pdf/recipe.rml:30
-#: templates/leprikon/registration_payment_request/subject.rml:193
-msgid "variable symbol"
-msgstr "variabilní symbol"
+#: models/subjects.py:919
+#, python-format
+msgid "%d other registration"
+msgid_plural "%d other registrations"
+msgstr[0] "%d další přihláška"
+msgstr[1] "%d další přihlášky"
+msgstr[2] "%d dalších přihlášek"
+
+#: models/subjects.py:921
+msgid "no other registration"
+msgstr "žádná další přihláška"
 
-#: models/subjects.py:898 models/subjects.py:902 models/subjects.py:1403
+#: models/subjects.py:930 models/subjects.py:934 models/subjects.py:1553
 msgid "group members"
 msgstr "členové skupiny"
 
-#: models/subjects.py:1083 views/subjects.py:188
-#, python-brace-format
-msgid "Registration for {subject_type} {subject}"
-msgstr "Přihláška na {subject_type} {subject}"
-
-#: models/subjects.py:1084
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} - payment request"
-msgstr "Přihláška na {subject_type} {subject} - výzva k platbě"
-
-#: models/subjects.py:1085
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} was approved"
-msgstr "Přihláška na {subject_type} {subject} byla schválena"
-
-#: models/subjects.py:1086
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} was refused"
-msgstr "Přihláška na {subject_type} {subject} byla odmítnuta"
-
-#: models/subjects.py:1087
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} was canceled"
-msgstr "Přihláška na {subject_type} {subject} byla odhlášena"
-
-#: models/subjects.py:1103
+#: models/subjects.py:1180
 #, python-brace-format
 msgid ""
 "Unfortunately, it is not possible to restore canceled registration {r}. "
 "Please create new one."
 msgstr ""
 "Bohužel, odhlášenou přihlášku {r} není možné obnovit. Vytvořte prosím novou."
 
-#: models/subjects.py:1105
+#: models/subjects.py:1182
 #, python-brace-format
 msgid "The registration {r} has already been approved."
 msgstr "Přihláška {r} již byla schválena."
 
-#: models/subjects.py:1128
+#: models/subjects.py:1234
 #, python-brace-format
 msgid "The registration {r} has already been refued."
 msgstr "Přihláška {r} již byla odmítnuta."
 
-#: models/subjects.py:1131
+#: models/subjects.py:1238
 #, python-brace-format
 msgid ""
 "Unfortunately, it is not possible to refuse the registration {r}. However, "
 "You may cancel it."
 msgstr "Bohužel, přihlášku {r} není možné odmítnout. Můžete ji ale odhlásit."
 
-#: models/subjects.py:1143
+#: models/subjects.py:1251
 #, python-brace-format
 msgid "The registration {r} has already been canceled."
 msgstr "Přihláška {r} již byla odhlášena."
 
-#: models/subjects.py:1146
+#: models/subjects.py:1255
 #, python-brace-format
 msgid ""
 "Unfortunately, it is not possible to cancel the registration {r}. However, "
 "You may refuse it."
 msgstr "Bohužel, přihlášku {r} není možné odhlásit. Můžete ji ale odmítnout."
 
-#: models/subjects.py:1260 models/subjects.py:1302
+#: models/subjects.py:1389 models/subjects.py:1429
 msgid "first parent"
 msgstr "první zákonný zástupce"
 
-#: models/subjects.py:1269 models/subjects.py:1310
+#: models/subjects.py:1398 models/subjects.py:1437
 msgid "second parent"
 msgstr "druhý zákonný zástupce"
 
-#: models/subjects.py:1278 models/subjects.py:1382
-msgid "additional answers"
-msgstr "doplňující odpovědi"
-
-#: models/subjects.py:1368 models/targetgroup.py:15
+#: models/subjects.py:1515 models/targetgroup.py:15
 msgid "target group"
 msgstr "cílová skupina"
 
-#: models/subjects.py:1369 templates/leprikon/payment_pdf/recipe.rml:72
+#: models/subjects.py:1517
 #: templates/leprikon/registration_payment_request/subject.rml:129
 #: templates/leprikon/registration_payment_request/subject.rml:151
+#: templates/leprikon/registration_recipe.rml:21
 msgid "group name"
 msgstr "název skupiny"
 
-#: models/subjects.py:1386
+#: models/subjects.py:1535
 msgid "registered group"
 msgstr "přihlášená skupina"
 
-#: models/subjects.py:1387
+#: models/subjects.py:1536
 msgid "registered groups"
 msgstr "přihlášené skupiny"
 
-#: models/subjects.py:1402
+#: models/subjects.py:1552
 msgid "group member"
 msgstr "člen skupiny"
 
-#: models/subjects.py:1452
-msgid "Amount can not be zero."
-msgstr "Částka nemůže být nula."
-
-#: models/subjects.py:1457
-msgid "Date must be after the last account closure ({})."
-msgstr "Datum musí být vyšší než datum posledního uzavření účtu ({})."
-
-#: models/subjects.py:1466 models/subjects.py:1505
-msgid "accounted time"
-msgstr "čas zaúčtování"
-
-#: models/subjects.py:1467 models/subjects.py:1473
+#: models/subjects.py:1600 models/subjects.py:1606
 #: templates/leprikon/registration_payments.html:30
-#: templates/leprikon/registration_payments.html:37
+#: templates/leprikon/registration_payments.html:38
 msgid "discount"
 msgstr "sleva"
 
-#: models/subjects.py:1468
+#: models/subjects.py:1601
 msgid "discount explanation"
 msgstr "vysvětlení slevy"
 
-#: models/subjects.py:1474
-msgid "discounts"
-msgstr "slevy"
-
-#: models/subjects.py:1492
-msgid "payment - cash"
-msgstr "platba v hotovosti"
-
-#: models/subjects.py:1493
-msgid "payment - bank"
-msgstr "platba na bankovní účet"
-
-#: models/subjects.py:1494
-msgid "payment - online"
-msgstr "platba on-line"
-
-#: models/subjects.py:1495
-msgid "payment - transfer from return"
-msgstr "platba z přeplatku"
-
-#: models/subjects.py:1496
-msgid "return - cash"
-msgstr "navrácení přeplatku v hotovosti"
-
-#: models/subjects.py:1497
-msgid "return - bank"
-msgstr "navrácení přeplatku na bankovní účet"
-
-#: models/subjects.py:1498
-msgid "return - transfer to payment"
-msgstr "navrácení přeplatku převodem na platbu"
-
-#: models/subjects.py:1506
-msgid "mail sent"
-msgstr "odesláno e-mailem"
-
-#: models/subjects.py:1507 models/subjects.py:1545
-#: templates/leprikon/payment_pdf/recipe.rml:43
-msgid "payment type"
-msgstr "typ platby"
-
-#: models/subjects.py:1508
-msgid "positive value for payment, negative value for return"
-msgstr "kladné číslo pro platbu, záporné pro navrácení přeplatku"
-
-#: models/subjects.py:1512
-msgid "related payment"
-msgstr "související platba"
-
-#: models/subjects.py:1514
-msgid "bank account transaction"
-msgstr "transakce na účtu"
-
-#: models/subjects.py:1517
-msgid "online payment"
-msgstr "platba on-line"
-
-#: models/subjects.py:1519
-msgid "received by"
-msgstr "přijal(a)"
-
-#: models/subjects.py:1523
+#: models/subjects.py:1667
 msgid "payment"
 msgstr "platba"
 
-#: models/subjects.py:1524
+#: models/subjects.py:1668
 msgid "payments"
 msgstr "platby"
 
-#: models/subjects.py:1564
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} - payment confirmation"
-msgstr "Přihláška na {subject_type} {subject} - potvrzení platby"
-
-#: models/subjects.py:1593
-msgid "Payment can only have one relation."
-msgstr "Platba může mít jen jeden související objekt."
-
-#: models/subjects.py:1616
-#, python-brace-format
-msgid "Payment type must be {valid_payment_type}."
-msgstr "Typ platby musí být {valid_payment_type}."
-
-#: models/subjects.py:1622
-#, python-brace-format
-msgid "Amount must be {valid_amount}."
-msgstr "Částka musí být {valid_amount}"
+#: models/subjects.py:1690
+msgid "received payment"
+msgstr "přijatá platba"
+
+#: models/subjects.py:1697 models/transaction.py:142
+msgid "target registration"
+msgstr "cílová přihláška"
+
+#: models/subjects.py:1709
+msgid "returned payment"
+msgstr "vrácená platba"
+
+#: models/subjects.py:1716 models/transaction.py:133
+msgid "source registration"
+msgstr "zdrojová přihláška"
 
-#: models/subjects.py:1651
+#: models/subjects.py:1739
 msgid "received online payment"
 msgstr "přijatá on-line platba"
 
-#: models/subjects.py:1676
+#: models/subjects.py:1822
 msgid "imported from account statement"
-msgstr "imporováno z výpisu z účtu"
+msgstr "importováno z výpisu z účtu"
+
+#: models/times.py:22
+msgid "day of week"
+msgstr "den v týdnu"
+
+#: models/times.py:35
+msgid "{day}, {start:%H:%M} - {end:%H:%M}"
+msgstr "{day} od {start:%H:%M} do {end:%H:%M}"
 
-#: models/timesheets.py:39
+#: models/times.py:41
+msgid "{day}, {start:%H:%M}"
+msgstr "{day} od {start:%H:%M}"
+
+#: models/timesheets.py:40
 msgid "timesheet period"
 msgstr "období výkazu práce"
 
-#: models/timesheets.py:40
+#: models/timesheets.py:41
 msgid "timesheet periods"
 msgstr "období výkazu práce"
 
-#: models/timesheets.py:70
+#: models/timesheets.py:72
 msgid "submitted"
 msgstr "odevzdaný"
 
-#: models/timesheets.py:71 models/utils.py:57
+#: models/timesheets.py:73 models/utils.py:78
 msgid "paid"
 msgstr "zaplaceno"
 
-#: models/timesheets.py:80
+#: models/timesheets.py:82
 msgid "timesheets"
 msgstr "výkazy práce"
 
-#: models/timesheets.py:128
+#: models/timesheets.py:130
 msgid "timesheet entry type"
 msgstr "typ záznamu výkazu práce"
 
-#: models/timesheets.py:129
+#: models/timesheets.py:131
 msgid "timesheet entry types"
 msgstr "typy záznamů výkazu práce"
 
-#: models/timesheets.py:138
+#: models/timesheets.py:146
 msgid "entry type"
 msgstr "druh záznamu"
 
-#: models/timesheets.py:143
+#: models/timesheets.py:151
 msgid "work description"
 msgstr "popis práce"
 
-#: models/timesheets.py:148
+#: models/timesheets.py:156
 msgid "timesheet entry"
 msgstr "záznam výkazu práce"
 
-#: models/timesheets.py:149
+#: models/timesheets.py:157
 msgid "timesheet entries"
 msgstr "záznamy výkazu práce"
 
-#: models/useragreement.py:10
+#: models/transaction.py:38
+msgid "accounted by"
+msgstr "zaúčtoval(a)"
+
+#: models/transaction.py:47
+msgid "last updated by"
+msgstr "naposledy upravil(a)"
+
+#: models/transaction.py:65
+msgid "Amount can not be zero."
+msgstr "Částka nemůže být nula."
+
+#: models/transaction.py:70
+msgid "Date must be after the last account closure ({})."
+msgstr "Datum musí být vyšší než datum posledního uzavření účtu ({})."
+
+#: models/transaction.py:89
+msgid "payment - cash"
+msgstr "platba v hotovosti"
+
+#: models/transaction.py:90
+msgid "payment - bank"
+msgstr "platba na bankovní účet"
+
+#: models/transaction.py:91
+msgid "payment - online"
+msgstr "platba on-line"
+
+#: models/transaction.py:92
+msgid "returned payment - cash"
+msgstr "platba vrácená v hotovosti"
+
+#: models/transaction.py:93
+msgid "returned payment - bank"
+msgstr "platba vrácená na bankovní účet"
+
+#: models/transaction.py:94
+msgid "transfer between registrations"
+msgstr "převod mezi dvěma přihláškami"
+
+#: models/transaction.py:95
+msgid "donation - cash"
+msgstr "dar v hotovosti"
+
+#: models/transaction.py:96
+msgid "donation - bank"
+msgstr "dar na bankovní účet"
+
+#: models/transaction.py:97
+msgid "donation - online"
+msgstr "dar on-line"
+
+#: models/transaction.py:98
+msgid "transfer from registration to donation"
+msgstr "dar z přeplatku"
+
+#: models/transaction.py:114 models/transaction.py:247
+#: templates/leprikon/received_payment_pdf/recipe.rml:43
+#: templates/leprikon/returned_payment_pdf/recipe.rml:43
+msgid "payment type"
+msgstr "typ platby"
+
+#: models/transaction.py:124
+msgid "mail sent"
+msgstr "odesláno e-mailem"
+
+#: models/transaction.py:134
+msgid "The payment will be deducted from this registration."
+msgstr "Platba bude odečtena od této přihlášky."
+
+#: models/transaction.py:143
+msgid "The payment will be added to this registration."
+msgstr "Platba bude připsána k této přihlášce."
+
+#: models/transaction.py:153
+msgid "donor user"
+msgstr "dárce"
+
+#: models/transaction.py:170
+msgid "bank account transaction"
+msgstr "transakce na účtu"
+
+#: models/transaction.py:178
+msgid "online payment"
+msgstr "platba on-line"
+
+#: models/transaction.py:184
+msgid "transaction"
+msgstr "transakce"
+
+#: models/transaction.py:185
+msgid "transactions"
+msgstr "transakce"
+
+#: models/transaction.py:230
+#, python-brace-format
+msgid "This field is mandatory for transaction type {transaction_type}."
+msgstr "Toto pole je u platby typu {transaction_type} povinné."
+
+#: models/transaction.py:237
+#, python-brace-format
+msgid "This field is forbidden for transaction type {transaction_type}."
+msgstr "Toto pole je u platby typu {transaction_type} zakázané."
+
+#: models/useragreement.py:15
 msgid "time of agreement"
 msgstr "čas souhlasu"
 
-#: models/utils.py:50
+#: models/utils.py:71
 msgid "amount due {}"
 msgstr "částka k úhradě {}"
 
-#: models/utils.py:52
+#: models/utils.py:73
 msgid "overdue {}"
 msgstr "{} po splatnosti"
 
-#: models/utils.py:54
+#: models/utils.py:75
 msgid "{} overpaid"
 msgstr "přeplaceno {}"
 
-#: models/utils.py:59
+#: models/utils.py:80
 msgid "payment not requested"
 msgstr "platba není požadována"
 
-#: models/utils.py:61
+#: models/utils.py:82
 msgid "payment not requested yet"
 msgstr "platba ještě není požadována"
 
-#: models/utils.py:176
+#: models/utils.py:210
+msgid "Enter a valid account number."
+msgstr "Zadejte platné číslo účtu v českém nebo mezinárodním formátu (IBAN)."
+
+#: models/utils.py:232
 msgid "Keep empty to use default value:"
 msgstr "Pokud není vyplněno, použije se výchozí hodnota:"
 
-#: models/utils.py:191
+#: models/utils.py:251
 msgid "Keep empty to use default value: {}"
 msgstr "Pokud není vyplněno, použije se výchozí hodnota: {}"
 
-#: site/settings.py:256
+#: site/settings.py:253
 msgid "Czech"
 msgstr "Čeština"
 
 #: templates/admin/base.html:5
 msgid "View site"
 msgstr "Zobrazení webu"
 
@@ -2738,31 +3045,32 @@
 #: templates/admin/inc/branding.html:37
 msgid "Open"
 msgstr "Otevřít"
 
 #: templates/admin/leprikon/coursediscount/popup_response.html:3
 #: templates/admin/leprikon/eventdiscount/popup_response.html:3
 #: templates/admin/leprikon/orderablediscount/popup_response.html:3
-#: templates/admin/leprikon/subjectpayment/popup_response.html:3
+#: templates/admin/leprikon/subjectreceivedpayment/popup_response.html:3
+#: templates/admin/leprikon/subjectreturnedpayment/popup_response.html:3
 msgid "Popup closing..."
 msgstr "Zavírám okno..."
 
-#: templates/admin/leprikon/message/add_recipients.html:12 views/generic.py:37
+#: templates/admin/leprikon/message/add_recipients.html:12 views/generic.py:36
 msgid "add"
 msgstr "přidat"
 
 #: templates/admin/leprikon/message/add_recipients.html:13
-#: templates/leprikon/subject_journal.html:104
+#: templates/leprikon/journal_journal.html:104
 msgid "back"
 msgstr "zpět"
 
 #: templates/admin/leprikon/messagerecipient/change_list.html:6
 #: templates/admin/leprikon/messagerecipient/send_mails.html:32
 #: templates/leprikon/admin/action_form.html:8
-#: templates/leprikon/admin/bulk_update_form.html:7
+#: templates/leprikon/admin/bulk_update_form.html:6
 #: templates/leprikon/admin/merge.html:8
 #: templates/leprikon/admin/send_message.html:8
 msgid "Home"
 msgstr "Domů"
 
 #: templates/admin/leprikon/messagerecipient/send_mails.html:42
 msgid "Start sending"
@@ -2777,28 +3085,46 @@
 msgstr "odesílání"
 
 #: templates/admin/leprikon/messagerecipient/send_mails.html:67
 msgid "failed"
 msgstr "selhalo"
 
 #: templates/leprikon/admin/action_form.html:26
-#: templates/leprikon/admin/bulk_update_form.html:30
+#: templates/leprikon/admin/bulk_update_form.html:29
 msgid "Continue"
 msgstr "Pokračovat"
 
 #: templates/leprikon/admin/action_form.html:27
-#: templates/leprikon/admin/bulk_update_form.html:31
+#: templates/leprikon/admin/bulk_update_form.html:30
 msgid "Cancel"
 msgstr "Zrušit"
 
 #: templates/leprikon/admin/dashboard.html:22
 msgid "Account closures"
 msgstr "Uzavření účtu"
 
-#: templates/leprikon/admin/dashboard.html:45
+#: templates/leprikon/admin/dashboard.html:41
+msgid "Journals"
+msgstr "Deníky"
+
+#: templates/leprikon/admin/dashboard.html:46
+#: templates/leprikon/reports/course_payments_status.html:19
+#: templates/leprikon/reports/event_payments_status.html:19
+#: templates/leprikon/reports/orderable_payments_status.html:19
+msgid "Received payments"
+msgstr "Přijaté platby"
+
+#: templates/leprikon/admin/dashboard.html:51
+#: templates/leprikon/reports/course_payments_status.html:20
+#: templates/leprikon/reports/event_payments_status.html:20
+#: templates/leprikon/reports/orderable_payments_status.html:20
+msgid "Returned payments"
+msgstr "Vrácené platby"
+
+#: templates/leprikon/admin/dashboard.html:56
 #: templates/leprikon/reports/course_payments_status.html:17
 #: templates/leprikon/reports/event_payments_status.html:17
 #: templates/leprikon/reports/orderable_payments_status.html:17
 msgid "Discounts"
 msgstr "Slevy"
 
 #: templates/leprikon/admin/merge.html:32
@@ -2809,16 +3135,16 @@
 msgid "No, take me back"
 msgstr "Ne, beru zpět"
 
 #: templates/leprikon/admin/send_message.html:23
 msgid "Send"
 msgstr "Odeslat"
 
-#: templates/leprikon/admin/send_message.html:24 views/generic.py:79
-#: views/user.py:106
+#: templates/leprikon/admin/send_message.html:24 views/generic.py:85
+#: views/user.py:111
 msgid "Back"
 msgstr "Zpět"
 
 #: templates/leprikon/alternating.html:16
 #: templates/leprikon/timesheet_detail.html:26
 msgid "start"
 msgstr "začátek"
@@ -2831,34 +3157,35 @@
 msgid "edit timesheet entry"
 msgstr "upravit záznam výkazu práce"
 
 #: templates/leprikon/alternating.html:33
 msgid "edit course journal entry"
 msgstr "upravit záznam deníku"
 
-#: templates/leprikon/base.html:81
+#: templates/leprikon/base.html:79
 msgid "Powered by Leprikón Information System"
 msgstr "Informační systém Leprikón"
 
 #: templates/leprikon/billing_info_preview.html:12
+#: templates/leprikon/journal_journal.html:141
+#: templates/leprikon/journal_journal.html:235
+#: templates/leprikon/journal_preview.html:14
 #: templates/leprikon/parent_preview.html:12
 #: templates/leprikon/participant_preview.html:12
-#: templates/leprikon/subject_journal.html:137
-#: templates/leprikon/subject_journal.html:226
 #: templates/leprikon/timesheet_detail.html:48
 msgid "delete"
 msgstr "smazat"
 
 #: templates/leprikon/billing_info_preview.html:18
 #: templates/leprikon/participant_preview.html:24
 #: templates/leprikon/registration_details.html:50
 #: templates/leprikon/registration_details.html:115
-#: templates/leprikon/registration_pdf/subject.rml:124
-#: templates/leprikon/registration_pdf/subject.rml:195
-#: templates/leprikon/registration_pdf/subject.rml:239
+#: templates/leprikon/registration_pdf/subject.rml:123
+#: templates/leprikon/registration_pdf/subject.rml:194
+#: templates/leprikon/registration_pdf/subject.rml:238
 msgid "Address"
 msgstr "Adresa"
 
 #: templates/leprikon/billing_info_preview.html:21
 msgid "Company number"
 msgstr "IČ"
 
@@ -2870,35 +3197,35 @@
 #: templates/leprikon/filtered_subject_list.html:36
 #: templates/leprikon/filtered_subject_list.html:46
 #: templates/leprikon/journalentry_form.html:21
 #: templates/leprikon/journalentry_form.html:32
 #: templates/leprikon/journalentry_form.html:44
 #: templates/leprikon/journalentry_form.html:56
 #: templates/leprikon/leader_list.html:18
-#: templates/leprikon/reports/course_stats.html:63
+#: templates/leprikon/reports/course_stats.html:67
 #: templates/leprikon/reports/event_stats.html:63
 #: templates/leprikon/reports/index.html:58
 #: templates/leprikon/reports/orderable_stats.html:63
 #: templates/leprikon/subject_list.html:18
 #: templates/leprikon/subject_list.html:28
 msgid "selected"
 msgstr "vybraných"
 
 #: templates/leprikon/cms/leader_list/default.html:25
 #: templates/leprikon/leader_preview.html:28
 #: templates/leprikon/participant_preview.html:30
 #: templates/leprikon/registration_details.html:57
 #: templates/leprikon/registration_details.html:122
-#: templates/leprikon/registration_pdf/subject.rml:199
+#: templates/leprikon/registration_pdf/subject.rml:198
 msgid "Contact"
 msgstr "Kontakt"
 
 #: templates/leprikon/cms/leader_list/default.html:38
 #: templates/leprikon/leader_preview.html:41
-#: templates/leprikon/subject_preview.html:89
+#: templates/leprikon/subject_preview.html:87
 msgid "More information"
 msgstr "Více informací"
 
 #: templates/leprikon/cms/leader_list_filtered.html:18
 #: templates/leprikon/journalentry_form.html:26
 #: templates/leprikon/journalentry_form.html:37
 #: templates/leprikon/journalentry_form.html:49
@@ -2935,46 +3262,166 @@
 
 #: templates/leprikon/course_registrations.html:25
 #: templates/leprikon/event_registrations.html:25
 #: templates/leprikon/orderable_registrations.html:25
 msgid "Inactive Registrations"
 msgstr "Neaktivní přihlášky"
 
+#: templates/leprikon/donation_pdf/recipe.rml:5
+msgid "Receipt for donation"
+msgstr "Potvrzení o přijetí daru"
+
+#: templates/leprikon/donation_pdf/recipe.rml:6
+#: templates/leprikon/received_payment_pdf/recipe.rml:6
+#: templates/leprikon/returned_payment_pdf/recipe.rml:6
+msgid "recipe number"
+msgstr "číslo stvrzenky"
+
+#: templates/leprikon/donation_pdf/recipe.rml:30
+msgid "donation date"
+msgstr "datum přijetí"
+
+#: templates/leprikon/donation_pdf/recipe.rml:39
+msgid "donation type"
+msgstr "druh daru"
+
+#: templates/leprikon/donation_pdf/recipe.rml:56
+msgid "donation received by"
+msgstr "dar přijal(a)"
+
+#: templates/leprikon/donations.html:9
+msgid "Donation Type"
+msgstr "Druh daru"
+
+#: templates/leprikon/donations.html:10
+msgid "Organization"
+msgstr "Organizace"
+
+#: templates/leprikon/donations.html:11 templates/leprikon/payments.html:17
+#: templates/leprikon/reports/course_payments.html:16
+#: templates/leprikon/reports/event_payments.html:16
+#: templates/leprikon/reports/orderable_payments.html:16
+msgid "Amount"
+msgstr "Částka"
+
 #: templates/leprikon/filter_form.html:15
 #: templates/leprikon/filtered_subject_list.html:15
 msgid "search"
 msgstr "vyhledat"
 
 #: templates/leprikon/filter_form.html:16
 #: templates/leprikon/filtered_subject_list.html:16
 msgid "cancel search"
 msgstr "zrušit hledání"
 
 #: templates/leprikon/form.html:15 templates/leprikon/login.html:19
 #: templates/leprikon/login.html:46
-#: templates/leprikon/subject_registration_form.html:15
+#: templates/leprikon/subject_registration_form.html:9
 msgid "Please correct the highlighted errors below."
 msgstr "Opravte prosím níže uvedené chyby."
 
+#: templates/leprikon/journal_journal.html:127
+msgid "Attendance"
+msgstr "Docházka"
+
+#: templates/leprikon/journal_journal.html:131
+#: templates/leprikon/journal_journal.html:210
+msgid "No."
+msgstr "Č."
+
+#: templates/leprikon/journal_journal.html:132
+msgctxt "person"
+msgid "Name"
+msgstr "Jméno"
+
+#: templates/leprikon/journal_journal.html:155
+#: templates/leprikon/journal_journal.html:255
+#: templates/leprikon/timesheet_detail.html:12 views/timesheets.py:14
+msgid "add entry"
+msgstr "přidat záznam"
+
+#: templates/leprikon/journal_journal.html:207
+msgid "Agenda"
+msgstr "Program"
+
+#: templates/leprikon/journal_journal.html:212
+#: templates/leprikon/journal_preview.html:23
+#: templates/leprikon/subject_preview.html:46
+msgid "Time"
+msgstr "Čas"
+
+#: templates/leprikon/journal_journal.html:213
+msgid "Number of hours"
+msgstr "Počet hodin"
+
+#: templates/leprikon/journal_journal.html:214
+msgid "Number of leaders"
+msgstr "Počet vedoucích"
+
+#: templates/leprikon/journal_journal.html:215
+msgid "Number of participants"
+msgstr "Počet přítomných"
+
+#: templates/leprikon/journal_journal.html:216
+msgid "Session agenda"
+msgstr "Program schůzky"
+
+#: templates/leprikon/journal_journal.html:222
+#: templates/leprikon/journal_journal.html:223
+msgid "skipped"
+msgstr "zrušeno"
+
+#: templates/leprikon/journal_journal.html:268
+msgid "Risks"
+msgstr "Rizika"
+
+#: templates/leprikon/journal_journal.html:284
+msgid "Plan for the activity"
+msgstr "Plán činnosti"
+
+#: templates/leprikon/journal_journal.html:299
+msgid "Evaluation of the activity"
+msgstr "Hodnocení činnosti"
+
+#: templates/leprikon/journal_journal_pdf/default.rml:36
+msgid "full name"
+msgstr "jméno a příjmení"
+
+#: templates/leprikon/journal_journal_pdf/default.rml:37
+msgid "birh year"
+msgstr "rok nar."
+
+#: templates/leprikon/journal_preview.html:31
+#: templates/leprikon/subject_preview.html:71
+msgid "Led by"
+msgid_plural "Led by"
+msgstr[0] "Vede"
+msgstr[1] "Vedou"
+msgstr[2] "Vedou"
+
+#: templates/leprikon/journal_preview.html:43
+msgid "add journal entry"
+msgstr "přidat záznam deníku"
+
 #: templates/leprikon/journalentry_form.html:17
 #: templates/leprikon/journalentry_form.html:28
 #: templates/leprikon/journalentry_form.html:40
 #: templates/leprikon/journalentry_form.html:52
-#: templates/leprikon/reports/course_stats.html:59
+#: templates/leprikon/reports/course_stats.html:63
 #: templates/leprikon/reports/event_stats.html:59
 #: templates/leprikon/reports/index.html:54
 #: templates/leprikon/reports/orderable_stats.html:59
 msgid "select all"
 msgstr "vybrat všechny"
 
 #: templates/leprikon/journalentry_form.html:19
 #: templates/leprikon/journalentry_form.html:30
 #: templates/leprikon/journalentry_form.html:42
 #: templates/leprikon/journalentry_form.html:54
-#: templates/leprikon/reports/course_stats.html:61
+#: templates/leprikon/reports/course_stats.html:65
 #: templates/leprikon/reports/event_stats.html:61
 #: templates/leprikon/reports/index.html:56
 #: templates/leprikon/reports/orderable_stats.html:61
 msgid "all"
 msgstr "všichni"
 
 #: templates/leprikon/leader_summary.html:11
@@ -3011,18 +3458,22 @@
 msgstr "Odesláno"
 
 #: templates/leprikon/messagerecipient_detail.html:12
 msgid "Viewed"
 msgstr "Zobrazeno"
 
 #: templates/leprikon/messagerecipient_detail.html:20
-#: templates/leprikon/subject_preview.html:80
+#: templates/leprikon/subject_preview.html:78
 msgid "Attachments"
 msgstr "Přílohy"
 
+#: templates/leprikon/messages_table.html:6
+msgid "Subject"
+msgstr "Předmět"
+
 #: templates/leprikon/modal_messages.html:16
 msgid "OK"
 msgstr "OK"
 
 #: templates/leprikon/pagination.html:4
 msgid "previous"
 msgstr "předchozí"
@@ -3034,22 +3485,22 @@
 #: templates/leprikon/pagination.html:13
 #, python-format
 msgid "displaying %(from)s – %(until)s of %(count)s"
 msgstr "zobrazeno %(from)s – %(until)s z %(count)s"
 
 #: templates/leprikon/participant_preview.html:42
 #: templates/leprikon/registration_details.html:72
-#: templates/leprikon/registration_pdf/subject.rml:163
+#: templates/leprikon/registration_pdf/subject.rml:162
 msgid "Health"
 msgstr "Údaje o zdravotní způsobilosti účastníka (případná omezení)"
 
 #: templates/leprikon/participants.html:7
-#: templates/leprikon/registration_pdf/subject.rml:181
+#: templates/leprikon/registration_pdf/subject.rml:180
 #: templates/leprikon/registration_preview.html:69
-#: templates/leprikon/subject_registration_form.html:131
+#: templates/leprikon/subject_registration_form.html:122
 msgid "Parents"
 msgstr "Zástupci"
 
 #: templates/leprikon/participants.html:11
 msgid "add parent"
 msgstr "přidat zástupce"
 
@@ -3112,35 +3563,14 @@
 msgstr "Děkujeme, že používáte naše stránky!"
 
 #: templates/leprikon/password_reset_email.html:13
 #, python-format
 msgid "The %(site_name)s team"
 msgstr "Tým %(site_name)s"
 
-#: templates/leprikon/payment_pdf/recipe.rml:5
-msgid "Receipt for payment"
-msgstr "Potvrzení o přijetí platby"
-
-#: templates/leprikon/payment_pdf/recipe.rml:6
-msgid "recipe number"
-msgstr "číslo stvrzenky"
-
-#: templates/leprikon/payment_pdf/recipe.rml:34
-msgid "payment date"
-msgstr "datum přijetí platby"
-
-#: templates/leprikon/payment_pdf/recipe.rml:54
-#, python-format
-msgid "name of %(subject_type)s"
-msgstr "název %(subject_type)s"
-
-#: templates/leprikon/payment_pdf/recipe.rml:79
-msgid "payment received by"
-msgstr "platbu přijal(a)"
-
 #: templates/leprikon/payments.html:7
 msgid ""
 "Thank You, the online payment was successful. The confirmation will be "
 "available within several minutes."
 msgstr ""
 "Děkujeme, on-line platba se zdařila. Potvrzení bude k dispozici během pár "
 "minut."
@@ -3149,36 +3579,117 @@
 msgid ""
 "Unfortunately, the online payment was not successful. Please, try it again "
 "or choose another payment method."
 msgstr ""
 "Bohužel, on-line platba se nezdařila. Zkuste to prosím znovu, nebo zvolte "
 "jiný způsob platby."
 
-#: templates/leprikon/payments.html:16
+#: templates/leprikon/payments.html:15
 msgid "Payment Type"
 msgstr "Typ platby"
 
-#: templates/leprikon/payments.html:17
-#: templates/leprikon/reports/course_payments.html:16
-#: templates/leprikon/reports/event_payments.html:16
-#: templates/leprikon/reports/orderable_payments.html:16
-msgid "Amount"
-msgstr "Částka"
+#: templates/leprikon/payments.html:16
+#: templates/leprikon/reports/course_payments.html:15
+#: templates/leprikon/reports/course_payments.html:39
+#: templates/leprikon/reports/event_payments.html:15
+#: templates/leprikon/reports/event_payments.html:39
+#: templates/leprikon/reports/orderable_payments.html:15
+#: templates/leprikon/reports/orderable_payments.html:39
+#: templates/leprikon/summary.html:33
+msgid "Registration"
+msgstr "Přihláška"
+
+#: templates/leprikon/received_payment_pdf/recipe.rml:5
+msgid "Receipt for payment"
+msgstr "Potvrzení o přijetí platby"
+
+#: templates/leprikon/received_payment_pdf/recipe.rml:34
+#: templates/leprikon/returned_payment_pdf/recipe.rml:34
+msgid "payment date"
+msgstr "datum přijetí platby"
+
+#: templates/leprikon/received_payment_pdf/recipe.rml:58
+#: templates/leprikon/returned_payment_pdf/recipe.rml:58
+msgid "payment received by"
+msgstr "platbu přijal(a)"
+
+#: templates/leprikon/received_payment_received/subject.subject.txt:1
+#, python-format
+msgid ""
+"Registration for %(subject_type)s %(subject)s - received payment confirmation"
+msgstr "Přihláška na %(subject_type)s %(subject)s - potvrzení přijaté platby"
+
+#: templates/leprikon/registration_approved/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was approved"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla schválena"
+
+#: templates/leprikon/registration_canceled/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was canceled"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla odhlášena"
+
+#: templates/leprikon/registration_decision/subject.rml:41
+#, python-format
+msgid "Reference number: %(reference_number)s"
+msgstr "Číslo jednací: %(reference_number)s"
+
+#: templates/leprikon/registration_decision/subject.rml:52
+#: templates/leprikon/registration_pdf/subject.rml:54
+#, python-format
+msgid "Name of %(subject_type)s"
+msgstr "Název %(subject_type)s"
+
+#: templates/leprikon/registration_decision/subject.rml:62
+#: templates/leprikon/registration_pdf/subject.rml:113
+msgid "Birth number"
+msgstr "Rodné číslo"
+
+#: templates/leprikon/registration_decision/subject.rml:67
+#: templates/leprikon/registration_details.html:38
+#: templates/leprikon/registration_pdf/subject.rml:118
+msgid "Birth date"
+msgstr "Datum narození"
+
+#: templates/leprikon/registration_decision/subject.rml:86
+msgid "Decision"
+msgstr "Rozhodnutí"
+
+#: templates/leprikon/registration_decision/subject.rml:101
+#: templates/leprikon/registration_decision/subject.rml:106
+#, python-format
+msgid "Decision issued by: %(user)s"
+msgstr "Rozhodnutí vydal(a): %(user)s"
+
+#: templates/leprikon/registration_decision/subject.rml:103
+#: templates/leprikon/registration_decision/subject.rml:108
+#, python-format
+msgid "Date: %(date)s"
+msgstr "Datum: %(date)s"
+
+#: templates/leprikon/registration_decision/subject.rml:116
+msgid "Received personally on"
+msgstr "Převzato osobně dne"
+
+#: templates/leprikon/registration_decision/subject.rml:117
+#: templates/leprikon/registration_pdf/subject.rml:310
+msgid "Signature"
+msgstr "Podpis"
 
 #: templates/leprikon/registration_details.html:4
 #: templates/leprikon/registration_payment_request/subject.rml:46
 #: templates/leprikon/registration_preview.html:5
 msgid "registration number"
 msgstr "číslo přihlášky"
 
 #: templates/leprikon/registration_details.html:10
-#: templates/leprikon/registration_pdf/subject.rml:69
-#: templates/leprikon/registration_pdf/subject.rml:74
+#: templates/leprikon/registration_pdf/subject.rml:68
+#: templates/leprikon/registration_pdf/subject.rml:73
 #: templates/leprikon/registration_preview.html:29
-#: templates/leprikon/subject_registration_form.html:25
+#: templates/leprikon/subject_registration_form.html:19
 msgid "Event date"
 msgstr "Termín konání"
 
 #: templates/leprikon/registration_details.html:17
 #: templates/leprikon/registration_preview.html:42
 msgid "Status"
 msgstr "Stav"
@@ -3202,74 +3713,32 @@
 msgstr "přihláška schválena %(d)s"
 
 #: templates/leprikon/registration_details.html:26
 #: templates/leprikon/registration_preview.html:55
 msgid "awaiting approval"
 msgstr "čeká na schválení"
 
-#: templates/leprikon/registration_details.html:32
-#: templates/leprikon/registration_mail_details.html:6
-#: templates/leprikon/registration_mail_details.txt:2
-#: templates/leprikon/registration_pdf/subject.rml:99
-#: templates/leprikon/registration_preview.html:62
-#: templates/leprikon/subject_registration_form.html:92
-msgid "Participant"
-msgstr "Účastník"
-
-#: templates/leprikon/registration_details.html:38
-#: templates/leprikon/registration_pdf/subject.rml:119
-msgid "Birth date"
-msgstr "Datum narození"
-
 #: templates/leprikon/registration_details.html:79
 msgid "Parent"
 msgstr "Zástupce"
 
-#: templates/leprikon/registration_details.html:97
-#: templates/leprikon/registration_mail_details.html:10
-#: templates/leprikon/registration_mail_details.txt:4
-#: templates/leprikon/registration_pdf/subject.rml:231
-#: templates/leprikon/registration_preview.html:80
-msgid "Group name"
-msgstr "Název skupiny"
-
-#: templates/leprikon/registration_details.html:109
-#: templates/leprikon/registration_mail_details.html:9
-#: templates/leprikon/registration_mail_details.txt:3
-#: templates/leprikon/registration_pdf/subject.rml:235
-#: templates/leprikon/registration_preview.html:86
-#: templates/leprikon/subject_registration_form.html:186
-msgid "Contact person"
-msgstr "Kontaktní osoba"
-
 #: templates/leprikon/registration_details.html:137
-#: templates/leprikon/registration_pdf/subject.rml:264
+#: templates/leprikon/registration_pdf/subject.rml:263
 #: templates/leprikon/registration_preview.html:92
 msgid "Group members"
 msgstr "Členové skupiny"
 
 #: templates/leprikon/registration_details.html:145
 msgid "Legal agreements"
 msgstr "Právní ujednání"
 
 #: templates/leprikon/registration_links.html:9
 msgid "fill in the registration form"
 msgstr "vyplnit přihlášku"
 
-#: templates/leprikon/registration_links.html:12
-msgid "The capacity is full."
-msgstr "Kapacita je naplněna."
-
-#: templates/leprikon/registration_mail_details.html:15
-#: templates/leprikon/registration_mail_details.txt:7
-msgid "You may download the registration in PDF using the following link:"
-msgstr ""
-"Vyplněnou přihlášku ve formátu PDF můžete stáhnout pomocí následujícího "
-"odkazu:"
-
 #: templates/leprikon/registration_mail_footer.html:3
 #: templates/leprikon/registration_mail_footer.txt:1
 msgid ""
 "You may check the current status of your registrations and payments using "
 "following link:"
 msgstr ""
 "Aktuální stav svých přihlášek a plateb můžete zkontrolovat pomocí "
@@ -3284,18 +3753,18 @@
 msgid "Period"
 msgstr "Období"
 
 #: templates/leprikon/registration_payment_request/subject.html:12
 #: templates/leprikon/registration_payment_request/subject.html:19
 #: templates/leprikon/registration_payment_request/subject.txt:5
 #: templates/leprikon/registration_payment_request/subject.txt:7
-#: templates/leprikon/reports/course_payments_status.html:20
+#: templates/leprikon/reports/course_payments_status.html:21
 #: templates/leprikon/reports/debtors.html:15
-#: templates/leprikon/reports/event_payments_status.html:20
-#: templates/leprikon/reports/orderable_payments_status.html:20
+#: templates/leprikon/reports/event_payments_status.html:21
+#: templates/leprikon/reports/orderable_payments_status.html:21
 msgid "Amount due"
 msgstr "Částka k úhradě"
 
 #: templates/leprikon/registration_payment_request/subject.html:13
 #: templates/leprikon/registration_payment_request/subject.html:20
 #: templates/leprikon/registration_payment_request/subject.txt:6
 #: templates/leprikon/registration_payment_request/subject.txt:8
@@ -3305,42 +3774,42 @@
 #: templates/leprikon/registration_payment_request/subject.html:26
 #: templates/leprikon/registration_payment_request/subject.txt:10
 msgid "Please, use following link to perform online payment"
 msgstr "Pro on-line platbu prosím použijte následující odkaz"
 
 #: templates/leprikon/registration_payment_request/subject.html:33
 #: templates/leprikon/registration_payment_request/subject.txt:13
-#: templates/leprikon/registration_payments.html:47
+#: templates/leprikon/registration_payments.html:48
 msgid "Please, use following information for bank transfer"
 msgstr "Pro platbu převodem prosím použijte následující údaje"
 
 #: templates/leprikon/registration_payment_request/subject.html:34
 #: templates/leprikon/registration_payment_request/subject.txt:14
-#: templates/leprikon/registration_payments.html:48
+#: templates/leprikon/registration_payments.html:49
 msgid "Bank account"
 msgstr "Číslo účtu"
 
 #: templates/leprikon/registration_payment_request/subject.html:35
 #: templates/leprikon/registration_payment_request/subject.txt:15
-#: templates/leprikon/registration_payments.html:49
+#: templates/leprikon/registration_payments.html:50
 msgid "Variable symbol"
 msgstr "Variabilní symbol"
 
 #: templates/leprikon/registration_payment_request/subject.html:38
 #: templates/leprikon/registration_payment_request/subject.rml:172
 msgid ""
 "You may use following QR code to scan the payment details to your mobile "
 "banking application"
 msgstr ""
 "Následující QR kód můžete použít pro načtení platebních informací do své "
 "mobilní bankovní aplikace"
 
 #: templates/leprikon/registration_payment_request/subject.html:44
 #: templates/leprikon/registration_payment_request/subject.txt:17
-#: templates/leprikon/registration_payments.html:57
+#: templates/leprikon/registration_payments.html:58
 msgid "Currently we only accept payments in cash."
 msgstr "Momentálně přijímáme platby pouze v hotovosti."
 
 #: templates/leprikon/registration_payment_request/subject.rml:45
 msgid "Payment request"
 msgstr "Výzva k platbě"
 
@@ -3360,52 +3829,62 @@
 msgid "amount due"
 msgstr "částka k úhradě"
 
 #: templates/leprikon/registration_payment_request/subject.rml:185
 msgid "total amount due"
 msgstr "celkem k úhradě"
 
+#: templates/leprikon/registration_payment_request/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s - payment request"
+msgstr "Přihláška na %(subject_type)s %(subject)s - výzva k platbě"
+
 #: templates/leprikon/registration_payments.html:4
 #: templates/leprikon/registration_pdf/subject.rml:58
 #: templates/leprikon/reports/course_payments_status.html:15
 #: templates/leprikon/reports/event_payments_status.html:15
 #: templates/leprikon/reports/orderable_payments_status.html:15
-#: templates/leprikon/subject_registration_form.html:30
-#: templates/leprikon/subject_registration_form.html:66
+#: templates/leprikon/subject_registration_form.html:24
+#: templates/leprikon/subject_registration_form.html:60
 msgid "Price"
 msgstr "Cena"
 
-#: templates/leprikon/registration_payments.html:12
-#: views/reports/subjects.py:44
+#: templates/leprikon/registration_payments.html:11
 msgid "Payments status"
 msgstr "Stav plateb"
 
-#: templates/leprikon/registration_payments.html:17
+#: templates/leprikon/registration_payments.html:16
 msgid "payment request"
 msgstr "výzva k platbě"
 
-#: templates/leprikon/registration_payments.html:28
+#: templates/leprikon/registration_payments.html:27
 #: templates/leprikon/registration_payments.html:35
 #, python-format
-msgid "paid %(paid)s"
-msgstr "zaplaceno %(paid)s"
+msgid "paid %(received)s"
+msgstr "zaplaceno %(received)s"
+
+#: templates/leprikon/registration_payments.html:28
+#: templates/leprikon/registration_payments.html:36
+#, python-format
+msgid "refunded %(returned)s"
+msgstr "vráceno %(returned)s"
 
-#: templates/leprikon/registration_payments.html:41
+#: templates/leprikon/registration_payments.html:42
 msgid "Online payment"
 msgstr "Online platba"
 
-#: templates/leprikon/registration_payments.html:42
+#: templates/leprikon/registration_payments.html:43
 msgid "pay online"
 msgstr "zaplatit on-line"
 
-#: templates/leprikon/registration_payments.html:45
+#: templates/leprikon/registration_payments.html:46
 msgid "Bank transfer"
 msgstr "Bankovní převod"
 
-#: templates/leprikon/registration_payments.html:52
+#: templates/leprikon/registration_payments.html:53
 msgid ""
 "Or You may use following QR code to scan the payment details to your mobile "
 "banking application"
 msgstr ""
 "Případně můžete použít následující QR kód pro načtení platebních informací "
 "do své mobilní bankovní aplikace"
 
@@ -3415,77 +3894,62 @@
 msgstr "Přihláška na %(subject_type)s"
 
 #: templates/leprikon/registration_pdf/subject.rml:48
 #, python-format
 msgid "in school year %(school_year)s"
 msgstr "ve školním roce %(school_year)s"
 
-#: templates/leprikon/registration_pdf/subject.rml:54
-#, python-format
-msgid "Name of %(subject_type)s"
-msgstr "Název %(subject_type)s"
-
-#: templates/leprikon/registration_pdf/subject.rml:84
+#: templates/leprikon/registration_pdf/subject.rml:83
 msgid "Times"
 msgstr "Čas"
 
-#: templates/leprikon/registration_pdf/subject.rml:90
+#: templates/leprikon/registration_pdf/subject.rml:89
 msgid "Registration number (variable symbol)"
 msgstr "Číslo přihlášky (variabilní symbol)"
 
-#: templates/leprikon/registration_pdf/subject.rml:105
-#: templates/leprikon/registration_pdf/subject.rml:191
+#: templates/leprikon/registration_pdf/subject.rml:104
+#: templates/leprikon/registration_pdf/subject.rml:190
 msgid "Full name"
 msgstr "Jméno a příjmení"
 
-#: templates/leprikon/registration_pdf/subject.rml:114
-msgid "Birth number"
-msgstr "Rodné číslo"
-
-#: templates/leprikon/registration_pdf/subject.rml:128
+#: templates/leprikon/registration_pdf/subject.rml:127
 msgid "Citizenship"
 msgstr "Státní občanství"
 
-#: templates/leprikon/registration_pdf/subject.rml:133
-#: templates/leprikon/registration_pdf/subject.rml:244
+#: templates/leprikon/registration_pdf/subject.rml:132
+#: templates/leprikon/registration_pdf/subject.rml:243
 msgid "Phone"
 msgstr "Telefon"
 
-#: templates/leprikon/registration_pdf/subject.rml:149
-#: templates/leprikon/registration_pdf/subject.rml:226
+#: templates/leprikon/registration_pdf/subject.rml:148
+#: templates/leprikon/registration_pdf/subject.rml:225
 msgid "Class"
 msgstr "Třída"
 
-#: templates/leprikon/registration_pdf/subject.rml:270
+#: templates/leprikon/registration_pdf/subject.rml:269
 msgid "First name"
 msgstr "Jméno"
 
-#: templates/leprikon/registration_pdf/subject.rml:271
+#: templates/leprikon/registration_pdf/subject.rml:270
 msgid "Last name"
 msgstr "Příjmení"
 
-#: templates/leprikon/registration_pdf/subject.rml:272
-#: templates/leprikon/subject_registration_form.html:239
+#: templates/leprikon/registration_pdf/subject.rml:271
+#: templates/leprikon/subject_registration_form.html:230
 msgid "Note"
 msgstr "Poznámka"
 
-#: templates/leprikon/registration_pdf/subject.rml:309
+#: templates/leprikon/registration_pdf/subject.rml:308
 msgid "In"
 msgstr "V"
 
-#: templates/leprikon/registration_pdf/subject.rml:311
+#: templates/leprikon/registration_pdf/subject.rml:310
 msgid "Parent's signature"
 msgstr "Podpis zákonného zástupce"
 
-#: templates/leprikon/registration_pdf/subject.rml:311
-#: templates/leprikon/subject_journal.html:291
-#: templates/leprikon/subject_journal.html:310
-msgid "Signature"
-msgstr "Podpis"
-
 #: templates/leprikon/registration_preview.html:13
 msgid "cancel registration"
 msgstr "odhlásit"
 
 #: templates/leprikon/registration_preview.html:15
 msgid "cancel"
 msgstr "odhlásit"
@@ -3506,34 +3970,102 @@
 "Unfortunately, the capacity of this %(subject_type)s has already been "
 "filled.\n"
 "The registration may be refused."
 msgstr ""
 "Bohužel, kapacita %(subject_type)s je již naplněna.\n"
 "Vaše přihláška může být odmítnuta."
 
+#: templates/leprikon/registration_received/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s"
+msgstr "Přihláška na %(subject_type)s %(subject)s"
+
+#: templates/leprikon/registration_recipe.rml:3
+#, python-format
+msgid "name of %(subject_type)s"
+msgstr "název %(subject_type)s"
+
+#: templates/leprikon/registration_refund_offer/subject.html:11
+#: templates/leprikon/registration_refund_offer/subject.txt:6
+#: templates/leprikon/summary.html:62
+msgid "request refund to a bank account"
+msgstr "požádat o vrácení na bankovní účet"
+
+#: templates/leprikon/registration_refund_offer/subject.html:14
+#: templates/leprikon/registration_refund_offer/subject.txt:9
+#: templates/leprikon/summary.html:65
+msgid "transfer to a payment"
+msgstr "převést na platbu"
+
+#: templates/leprikon/registration_refund_offer/subject.html:17
+#: templates/leprikon/registration_refund_offer/subject.txt:12
+#: templates/leprikon/summary.html:68
+msgid "donate"
+msgstr "darovat"
+
+#: templates/leprikon/registration_refund_offer/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s - refund offer"
+msgstr "Přihláška na %(subject_type)s %(subject)s - nabídka vrácení přeplatku"
+
+#: templates/leprikon/registration_refused/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was refused"
+msgstr "Přihláška na %(subject_type)s %(subject)s byla odmítnuta"
+
 #: templates/leprikon/registrations.html:6
 #, python-format
 msgid "Registrations in school year %(school_year)s"
 msgstr "Přihlášky ve školním roce %(school_year)s"
 
 #: templates/leprikon/registrations.html:15
 #, python-format
 msgid "You have no registrations in school year %(school_year)s."
 msgstr "Ve školním roce %(school_year)s nemáte žádné přihlášky."
 
 #: templates/leprikon/reports/course_payments.html:10
 #, python-format
-msgid "Course payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za kurzy od %(date_start)s do %(date_end)s"
+msgid "Received course payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za kurzy od %(date_start)s do %(date_end)s"
 
-#: templates/leprikon/reports/course_payments.html:15
-#: templates/leprikon/reports/event_payments.html:15
-#: templates/leprikon/reports/orderable_payments.html:15
-msgid "Registration"
-msgstr "Přihláška"
+#: templates/leprikon/reports/course_payments.html:34
+#, python-format
+msgid "Returned course payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za kurzy od %(date_start)s do %(date_end)s"
+
+#: templates/leprikon/reports/course_payments.html:40
+#: templates/leprikon/reports/event_payments.html:40
+#: templates/leprikon/reports/orderable_payments.html:40
+msgid "Returned amount"
+msgstr "Vrácená částka"
+
+#: templates/leprikon/reports/course_payments.html:58
+#: templates/leprikon/reports/event_payments.html:58
+#: templates/leprikon/reports/orderable_payments.html:58
+#, python-format
+msgid "Summary from %(date_start)s to %(date_end)s"
+msgstr "Souhrn od %(date_start)s do %(date_end)s"
+
+#: templates/leprikon/reports/course_payments.html:62
+#: templates/leprikon/reports/event_payments.html:62
+#: templates/leprikon/reports/orderable_payments.html:62
+msgid "All received payments"
+msgstr "Všechny přijaté platby"
+
+#: templates/leprikon/reports/course_payments.html:63
+#: templates/leprikon/reports/event_payments.html:63
+#: templates/leprikon/reports/orderable_payments.html:63
+msgid "All returned payments"
+msgstr "Všechny vrácené platby"
+
+#: templates/leprikon/reports/course_payments.html:64
+#: templates/leprikon/reports/event_payments.html:64
+#: templates/leprikon/reports/orderable_payments.html:64
+msgid "Received - returned payments"
+msgstr "Přijaté - vrácené platby"
 
 #: templates/leprikon/reports/course_payments_status.html:10
 #, python-format
 msgid "Course payments status by date %(date)s"
 msgstr "Stav plateb za kurzy ke dni %(date)s"
 
 #: templates/leprikon/reports/course_payments_status.html:16
@@ -3544,58 +4076,56 @@
 
 #: templates/leprikon/reports/course_payments_status.html:18
 #: templates/leprikon/reports/event_payments_status.html:18
 #: templates/leprikon/reports/orderable_payments_status.html:18
 msgid "Receivables"
 msgstr "Pohledávky"
 
-#: templates/leprikon/reports/course_payments_status.html:19
-#: templates/leprikon/reports/event_payments_status.html:19
-#: templates/leprikon/reports/orderable_payments_status.html:19
-msgid "Received payments"
-msgstr "Přijaté platby"
-
-#: templates/leprikon/reports/course_payments_status.html:21
-#: templates/leprikon/reports/event_payments_status.html:21
-#: templates/leprikon/reports/orderable_payments_status.html:21
+#: templates/leprikon/reports/course_payments_status.html:22
+#: templates/leprikon/reports/event_payments_status.html:22
+#: templates/leprikon/reports/orderable_payments_status.html:22
 msgid "Overpayments"
 msgstr "Přeplatky"
 
-#: templates/leprikon/reports/course_payments_status.html:78
+#: templates/leprikon/reports/course_payments_status.html:85
 msgid "All courses"
 msgstr "Všechny kurzy"
 
 #: templates/leprikon/reports/course_stats.html:10
 #, python-format
 msgid "Course statistics for %(date)s"
 msgstr "Statistiky kurzů ke dni %(date)s"
 
 #: templates/leprikon/reports/course_stats.html:14
 msgid "Courses count"
 msgstr "Počet kurzů"
 
 #: templates/leprikon/reports/course_stats.html:18
+msgid "Participant hours count"
+msgstr "Počet účastníkohodin"
+
+#: templates/leprikon/reports/course_stats.html:22
 #: templates/leprikon/reports/event_stats.html:18
 #: templates/leprikon/reports/orderable_stats.html:18
 msgid "Age Group"
 msgstr "Věková skupina"
 
-#: templates/leprikon/reports/course_stats.html:20
+#: templates/leprikon/reports/course_stats.html:24
 #: templates/leprikon/reports/event_stats.html:20
 #: templates/leprikon/reports/orderable_stats.html:20
 msgid "Boys"
 msgstr "Muži"
 
-#: templates/leprikon/reports/course_stats.html:21
+#: templates/leprikon/reports/course_stats.html:25
 #: templates/leprikon/reports/event_stats.html:21
 #: templates/leprikon/reports/orderable_stats.html:21
 msgid "Girls"
 msgstr "Ženy"
 
-#: templates/leprikon/reports/course_stats.html:38
+#: templates/leprikon/reports/course_stats.html:42
 #: templates/leprikon/reports/debtors.html:39
 #: templates/leprikon/reports/event_stats.html:38
 #: templates/leprikon/reports/orderable_stats.html:38
 msgid "Total"
 msgstr "Celkem"
 
 #: templates/leprikon/reports/debtors.html:10
@@ -3609,220 +4139,160 @@
 
 #: templates/leprikon/reports/debtors.html:16
 msgid "Overdue"
 msgstr "Po splatnosti"
 
 #: templates/leprikon/reports/event_payments.html:10
 #, python-format
-msgid "Event payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za akce od %(date_start)s do %(date_end)s"
+msgid "Received event payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za akce od %(date_start)s do %(date_end)s"
+
+#: templates/leprikon/reports/event_payments.html:34
+#, python-format
+msgid "Returned event payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za akce od %(date_start)s do %(date_end)s"
 
 #: templates/leprikon/reports/event_payments_status.html:10
 #, python-format
 msgid "Event payments status by date %(date)s"
 msgstr "Stav plateb za akce ke dni %(date)s"
 
-#: templates/leprikon/reports/event_payments_status.html:78
+#: templates/leprikon/reports/event_payments_status.html:85
 msgid "All events"
 msgstr "Všechny akce"
 
 #: templates/leprikon/reports/event_stats.html:10
 #, python-format
 msgid "Event statistics for %(date)s"
 msgstr "Statistiky akcí ke dni %(date)s"
 
 #: templates/leprikon/reports/event_stats.html:14
 msgid "Events count"
 msgstr "Počet akcí"
 
-#: templates/leprikon/reports/index.html:37 views/reports/courses.py:26
-#: views/reports/courses.py:45 views/reports/courses.py:94
-#: views/reports/debtors.py:20 views/reports/events.py:26
-#: views/reports/events.py:45 views/reports/events.py:94
-#: views/reports/orderables.py:26 views/reports/orderables.py:45
-#: views/reports/orderables.py:94 views/reports/subjects.py:26
-#: views/reports/subjects.py:45 views/reports/subjects.py:94
+#: templates/leprikon/reports/index.html:37 views/reports/courses.py:25
+#: views/reports/courses.py:51 views/reports/courses.py:102
+#: views/reports/debtors.py:20 views/reports/events.py:23
+#: views/reports/events.py:49 views/reports/events.py:99
+#: views/reports/orderables.py:23 views/reports/orderables.py:49
+#: views/reports/orderables.py:100
 msgid "Show"
 msgstr "Zobrazit"
 
 #: templates/leprikon/reports/orderable_payments.html:10
 #, python-format
-msgid "Orderable event payments from %(date_start)s to %(date_end)s"
-msgstr "Platby za akce na objednání od %(date_start)s do %(date_end)s"
+msgid "Received orderable event payments from %(date_start)s to %(date_end)s"
+msgstr "Přijaté platby za akce na objednání od %(date_start)s do %(date_end)s"
+
+#: templates/leprikon/reports/orderable_payments.html:34
+#, python-format
+msgid "Returned orderable event payments from %(date_start)s to %(date_end)s"
+msgstr "Vrácené platby za akce na objednání od %(date_start)s do %(date_end)s"
 
 #: templates/leprikon/reports/orderable_payments_status.html:10
 #, python-format
 msgid "Orderable event payments status by date %(date)s"
 msgstr "Stav plateb za akce na objednání ke dni %(date)s"
 
-#: templates/leprikon/reports/orderable_payments_status.html:78
+#: templates/leprikon/reports/orderable_payments_status.html:85
 msgid "All orderable events"
 msgstr "Všechny akce na objednání"
 
 #: templates/leprikon/reports/orderable_stats.html:10
 #, python-format
 msgid "Orderable event statistics for %(date)s"
 msgstr "Statistiky akcí na objednání ke dni %(date)s"
 
 #: templates/leprikon/reports/orderable_stats.html:14
 msgid "Orderable events count"
 msgstr "Počet akcí na objednání"
 
-#: templates/leprikon/subject_journal.html:12
-msgid "Journal"
-msgstr "Deník"
-
-#: templates/leprikon/subject_journal.html:124
-msgid "Attendance"
-msgstr "Docházka"
-
-#: templates/leprikon/subject_journal.html:128
-msgctxt "person"
-msgid "Name"
-msgstr "Jméno"
-
-#: templates/leprikon/subject_journal.html:151
-#: templates/leprikon/subject_journal.html:246
-#: templates/leprikon/timesheet_detail.html:12 views/timesheets.py:17
-msgid "add entry"
-msgstr "přidat záznam"
-
-#: templates/leprikon/subject_journal.html:200
-msgid "Agenda"
-msgstr "Program"
-
-#: templates/leprikon/subject_journal.html:204
-#: templates/leprikon/subject_preview.html:48
-msgid "Time"
-msgstr "Čas"
-
-#: templates/leprikon/subject_journal.html:205
-msgid "Number of hours"
-msgstr "Počet hodin"
-
-#: templates/leprikon/subject_journal.html:206
-msgid "Number of leaders"
-msgstr "Počet vedoucích"
-
-#: templates/leprikon/subject_journal.html:207
-msgid "Number of participants"
-msgstr "Počet přítomných"
-
-#: templates/leprikon/subject_journal.html:208
-msgid "Session agenda"
-msgstr "Program schůzky"
-
-#: templates/leprikon/subject_journal.html:213
-#: templates/leprikon/subject_journal.html:214
-msgid "skipped"
-msgstr "zrušeno"
-
-#: templates/leprikon/subject_journal.html:259
-msgid "Risks"
-msgstr "Rizika"
-
-#: templates/leprikon/subject_journal.html:270
-msgid "Place / Risk"
-msgstr "Místo / Riziko"
+#: templates/leprikon/returned_payment_pdf/recipe.rml:5
+msgid "Receipt for returned payment"
+msgstr "Potvrzení o vrácení platby"
 
-#: templates/leprikon/subject_journal.html:278
-msgid "Plan for the activity"
-msgstr "Plán činnosti"
-
-#: templates/leprikon/subject_journal.html:297
-msgid "Evaluation of the activity"
-msgstr "Hodnocení činnosti"
-
-#: templates/leprikon/subject_journal_pdf/subject.rml:36
-msgid "full name"
-msgstr "jméno a příjmení"
-
-#: templates/leprikon/subject_journal_pdf/subject.rml:37
-msgid "birh year"
-msgstr "rok nar."
+#: templates/leprikon/returned_payment_received/subject.subject.txt:1
+#, python-format
+msgid ""
+"Registration for %(subject_type)s %(subject)s - returned payment confirmation"
+msgstr "Přihláška na %(subject_type)s %(subject)s - potvrzení vrácené platby"
 
-#: templates/leprikon/subject_preview.html:49
+#: templates/leprikon/subject_preview.html:47
 msgid "Duration"
 msgstr "Doba trvání"
 
-#: templates/leprikon/subject_preview.html:59
+#: templates/leprikon/subject_preview.html:57
 msgid "Age groups"
 msgstr "Věkové skupiny"
 
-#: templates/leprikon/subject_preview.html:66
+#: templates/leprikon/subject_preview.html:64
 msgid "Target groups"
 msgstr "Cílové skupiny"
 
-#: templates/leprikon/subject_preview.html:73
-msgid "Led by"
-msgid_plural "Led by"
-msgstr[0] "Vede"
-msgstr[1] "Vedou"
-msgstr[2] "Vedou"
-
-#: templates/leprikon/subject_preview.html:109
-msgid "add journal entry"
-msgstr "přidat záznam deníku"
-
-#: templates/leprikon/subject_registration_form.html:10
-#, python-format
-msgid ""
-"The capacity of this %(subject_type)s has already been filled. You may "
-"register anyway, but the registration may not be approved. We will inform "
-"You."
-msgstr ""
-"Kapacita %(subject_type)s je již naplněna. Můžete se přesto přihlásit, ale "
-"Vaše přihláška nemusí být schválena. O jejím zpracování Vás budeme dále "
-"informovat."
-
-#: templates/leprikon/subject_registration_form.html:199
+#: templates/leprikon/subject_registration_form.html:190
 msgid "Participants list"
 msgstr "Seznam účastníků"
 
-#: templates/leprikon/subject_registration_form.html:307
+#: templates/leprikon/subject_registration_form.html:302
 #, python-brace-format
 msgid "Minimal age for this age group is ${ageGroup.min_age}."
 msgstr "Minimální věk pro tuto věkovou skupinu je ${ageGroup.min_age}."
 
-#: templates/leprikon/subject_registration_form.html:314
+#: templates/leprikon/subject_registration_form.html:309
 #, python-brace-format
 msgid "Maximal age for this age group is ${ageGroup.max_age}."
 msgstr "Maximální věk pro tuto věkovou skupinu je ${ageGroup.max_age}."
 
 #: templates/leprikon/summary.html:10
-msgid "New messages"
-msgstr "Nepřečtené zprávy"
-
-#: templates/leprikon/summary.html:15
-msgid "You have no new messages."
-msgstr "Nemáte žádné nové zprávy."
-
-#: templates/leprikon/summary.html:18
 msgid "Payments overview"
 msgstr "Přehled plateb"
 
-#: templates/leprikon/summary.html:22
+#: templates/leprikon/summary.html:15
 #, python-format
 msgid "You have overdue of %(overdue)s."
 msgstr "Máte závazky po splatnosti v celkové výši %(overdue)s."
 
-#: templates/leprikon/summary.html:27
+#: templates/leprikon/summary.html:20
 #, python-format
 msgid "Your current amount due is %(amount_due)s."
 msgstr "Vaše aktuální částka k úhradě je %(amount_due)s."
 
-#: templates/leprikon/summary.html:30
+#: templates/leprikon/summary.html:23
 msgid "All Your receivables have been paid."
 msgstr "Všechny vaše závazky jsou zaplaceny."
 
-#: templates/leprikon/summary.html:33
+#: templates/leprikon/summary.html:26
 #, python-format
 msgid "You have overpaid %(overpaid)s."
 msgstr "Máte přeplatek ve výši %(overpaid)s."
 
+#: templates/leprikon/summary.html:35
+msgid "Refund options"
+msgstr "Možnosti navrácení"
+
+#: templates/leprikon/summary.html:52
+msgid "You have requested a refund to the bank account:"
+msgstr "Máte požádáno o vrácení přeplatku na účet:"
+
+#: templates/leprikon/summary.html:55
+msgid "change account number"
+msgstr "změnit číslo účtu"
+
+#: templates/leprikon/summary.html:58
+msgid "cancel refund request"
+msgstr "zrušit žádost o vrácení"
+
+#: templates/leprikon/summary.html:77
+msgid "New messages"
+msgstr "Nepřečtené zprávy"
+
+#: templates/leprikon/summary.html:82
+msgid "You have no new messages."
+msgstr "Nemáte žádné nové zprávy."
+
 #: templates/leprikon/terms_conditions.html:6
 msgid "Terms and Conditions"
 msgstr "Obchodní podmínky"
 
 #: templates/leprikon/timesheet_detail.html:17
 #: templates/leprikon/timesheet_preview.html:9
 msgid "submit"
@@ -3832,36 +4302,23 @@
 msgid "type"
 msgstr "typ"
 
 #: templates/leprikon/user_dropdown.html:5
 msgid "Anonymous user"
 msgstr "Nepřihlášený uživatel"
 
-#: templates/rocketchat/chat.html:5
-msgid "Open chat"
-msgstr "Otevřít chat"
-
-#: templates/rocketchat/chat.html:16
-msgid "Close chat"
-msgstr "Zavřít chat"
-
-#: templates/rocketchat/chat.html:20
-msgid "Open in new window"
-msgstr "Otevřít v novém okně"
-
-#: templates/rocketchat/home.html:2
-#, python-format
-msgid "Welcome to %(site_name)s's chat!"
-msgstr "Vítejte na chatu %(site_name)s!"
+#: templatetags/leprikon_tags.py:130
+msgid "Registering is currently not allowed."
+msgstr "Přihlašování momentálně není povoleno."
 
-#: templatetags/leprikon_tags.py:139
+#: templatetags/leprikon_tags.py:138
 msgid "Registering will end on {}."
 msgstr "Přihlašování bude ukončeno {}."
 
-#: utils.py:108 utils.py:110
+#: utils.py:129 utils.py:131
 msgid ", and "
 msgstr " a "
 
 #: views/billing_info.py:15
 msgid "add billing information"
 msgstr "přidat fakturační údaje"
 
@@ -3889,79 +4346,103 @@
 msgid "Billing information have been deleted."
 msgstr "Fakturační údaje byly smazány."
 
 #: views/billing_info.py:52
 msgid "Do You really want to delete the billing information: {}?"
 msgstr "Opravdu chcete smazat fakturační údaje: {}?"
 
-#: views/generic.py:39
+#: views/generic.py:38
 msgid "No items found."
 msgstr "Žádné položky nebyly nalezeny."
 
-#: views/generic.py:68
+#: views/generic.py:67
 msgid "No items found matching given search parameters."
 msgstr "Žádné položky neodpovídají zadaným parametrům hledání."
 
-#: views/generic.py:105
+#: views/generic.py:107
 msgid "Save"
 msgstr "Uložit"
 
-#: views/generic.py:185
+#: views/generic.py:187
 msgid "Delete"
 msgstr "Smazat"
 
 #: views/journals.py:16
 msgid "Alternating in school year {}"
 msgstr "Suplování ve školním roce {}"
 
-#: views/journals.py:39
+#: views/journals.py:41
+msgid "New journal"
+msgstr "Nový deník"
+
+#: views/journals.py:56
+msgid "New journal {} has been created."
+msgstr "Nový deník {} byl vytvořen."
+
+#: views/journals.py:67
+msgid "Change journal"
+msgstr "Upravit deník"
+
+#: views/journals.py:72
+msgid "Delete journal"
+msgstr "Smazat deník"
+
+#: views/journals.py:73
+msgid "Journal has been deleted."
+msgstr "Deník byl smazán."
+
+#: views/journals.py:88
+msgid "Do You really want to delete the journal {}?"
+msgstr "Opravdu chcete smazat deník {}?"
+
+#: views/journals.py:95
 msgid "New journal entry"
 msgstr "Nový záznam deníku"
 
-#: views/journals.py:40
+#: views/journals.py:96
 msgid "The journal entry has been created."
 msgstr "Záznam deníku byl vytvořen."
 
-#: views/journals.py:59
+#: views/journals.py:115
 msgid "Change journal entry"
 msgstr "Změnit záznam deníku"
 
-#: views/journals.py:60
+#: views/journals.py:116
 msgid "The journal entry has been updated."
 msgstr "Záznam deníku byl upraven."
 
-#: views/journals.py:72
+#: views/journals.py:128
 msgid "Delete journal entry"
 msgstr "Smazat záznam deníku"
 
-#: views/journals.py:73
+#: views/journals.py:129
 msgid "The journal entry has been deleted."
 msgstr "Záznam deníku byl smazán."
 
-#: views/journals.py:88
+#: views/journals.py:144
 msgid "Do You really want to delete journal entry?"
 msgstr "Opravdu chcete smazat záznam deníku?"
 
-#: views/journals.py:95 views/timesheets.py:78
+#: views/journals.py:151 views/timesheets.py:79
 msgid "Change timesheet entry"
 msgstr "Aktualizace záznamu výkazu práce"
 
-#: views/journals.py:96 views/timesheets.py:79
+#: views/journals.py:152 views/timesheets.py:80
 msgid "The timesheet entry has been updated."
 msgstr "Záznam výkazu práce byl upraven."
 
-#: views/journals.py:111 views/timesheets.py:90
+#: views/journals.py:168 views/timesheets.py:91
 msgid "Delete timesheet entry"
 msgstr "Smazat záznam výkazu práce"
 
-#: views/journals.py:112 views/timesheets.py:91
+#: views/journals.py:169 views/timesheets.py:92
 msgid "The timesheet entry has been deleted."
 msgstr "Záznam výkazu práce byl smazán."
 
-#: views/journals.py:121 views/timesheets.py:106
+#: views/journals.py:182 views/timesheets.py:107
 msgid "Do You really want to delete timesheet entry?"
 msgstr "Opravdu chcete smazat záznam výkazu práce?"
 
 #: views/leaders.py:13
 msgid "No leaders matching given query."
 msgstr "Žádní vedoucí neodpovídají hledanému výrazu."
 
@@ -3973,35 +4454,35 @@
 msgid "No messages matching given query."
 msgstr "Žádné zprávy neodpovídají hledanému výrazu."
 
 #: views/parents.py:13
 msgid "New parent"
 msgstr "Nový zástupce"
 
-#: views/parents.py:26
+#: views/parents.py:25
 msgid "New parent {} has been created."
 msgstr "Zástupce {} byl vytvořen."
 
-#: views/parents.py:33
+#: views/parents.py:32
 msgid "Change parent"
 msgstr "Aktualizace údajů o zástupci"
 
-#: views/parents.py:45
+#: views/parents.py:44
 msgid "The parent {} has been updated."
 msgstr "Zástupce {} byl upraven."
 
-#: views/parents.py:50
+#: views/parents.py:49
 msgid "Delete information about parent"
 msgstr "Smazat informace o zákonném zástupci"
 
-#: views/parents.py:51
+#: views/parents.py:50
 msgid "Information about parent has been deleted."
 msgstr "Informace o zákonném zástupci byly smazány."
 
-#: views/parents.py:58
+#: views/parents.py:57
 msgid "Do You really want to delete the information about parent: {}?"
 msgstr "Opravdu chcete smazat informace o zákonném zástupci: {}?"
 
 #: views/participants.py:11
 msgid "add participant"
 msgstr "přidat účastníka"
 
@@ -4033,186 +4514,270 @@
 msgid "Information about participant has been deleted."
 msgstr "Informace o účastníkovi byly smazány."
 
 #: views/participants.py:73
 msgid "Do You really want to delete the information about participant: {}?"
 msgstr "Opravdu chcete smazat informace o účastníkovi: {}?"
 
-#: views/reports/__init__.py:27 views/reports/courses.py:25
+#: views/refundrequest.py:30
+msgid "New refund request"
+msgstr "Nová žádost o vrácení přeplatku"
+
+#: views/refundrequest.py:33
+msgid "Refund request have been created."
+msgstr "Žádost o vrácení přeplatku byla vytvořena."
+
+#: views/refundrequest.py:43
+msgid "Refund request has been updated."
+msgstr "Žádost o vrácení přeplatku byla upravena."
+
+#: views/refundrequest.py:44
+msgid "Update refund request"
+msgstr "Upravení žádost o vrácení přeplatku"
+
+#: views/refundrequest.py:54
+msgid "Cancel refund request"
+msgstr "Zrušení žádosti o vrácení přeplatku"
+
+#: views/refundrequest.py:55
+msgid "Refund request has been canceled."
+msgstr "Žádost o vrácení přeplatku byla zrušena."
+
+#: views/refundrequest.py:58
+msgid "Do You really want to cancel the refund request: {}?"
+msgstr "Opravdu chcete smazat žádost o vrácení přeplatku: {}?"
+
+#: views/refundrequest.py:63
+msgid "New payment transfer"
+msgstr "Nový převod platby"
+
+#: views/refundrequest.py:66
+msgid ""
+"The payment may only be transferred to a registration, for which the payment "
+"is required. If You have submitted new registration recently, You may need "
+"to wait until the payment is requested for that registration."
+msgstr ""
+"Platba může být převedena pouze na přihlášku, pro kterou je požadována "
+"platba. Pokud jste vyplnili novou přihlášku, možná budete muset počkat, až "
+"budete vyzváni k platbě."
+
+#: views/refundrequest.py:73
+msgid "The payment has been transferred."
+msgstr "Platba byla převedena."
+
+#: views/refundrequest.py:78
+msgid "New donation"
+msgstr "Nový dar"
+
+#: views/refundrequest.py:80
+msgid ""
+"If You wish, You may transfer the overpaid amount to a donation for our "
+"organization."
+msgstr "Pokud chcete, můžete přeplatek věnovat naší organizaci."
+
+#: views/refundrequest.py:83
+msgid "Thank You. Your support is very appreciated."
+msgstr "Děkujeme Vám, velmi si vážíme Vaší podpory."
+
+#: views/reports/__init__.py:22 views/reports/courses.py:24
 msgid "Course payments"
 msgstr "Platby za kurzy"
 
-#: views/reports/__init__.py:33 views/reports/events.py:25
+#: views/reports/__init__.py:28 views/reports/events.py:22
 msgid "Event payments"
 msgstr "Platby za akce"
 
-#: views/reports/__init__.py:39
+#: views/reports/__init__.py:34
 msgid "Orderable event payments"
 msgstr "Platby za akce na objednání"
 
-#: views/reports/__init__.py:45 views/reports/courses.py:44
+#: views/reports/__init__.py:40 views/reports/courses.py:50
 msgid "Course payments status"
 msgstr "Stav plateb za kurzy"
 
-#: views/reports/__init__.py:51 views/reports/events.py:44
+#: views/reports/__init__.py:46 views/reports/events.py:48
 msgid "Event payments status"
 msgstr "Stav plateb za akce"
 
-#: views/reports/__init__.py:57 views/reports/orderables.py:44
+#: views/reports/__init__.py:52 views/reports/orderables.py:48
 msgid "Orderable event payments status"
 msgstr "Stav plateb za akce na objednání"
 
-#: views/reports/__init__.py:63 views/reports/courses.py:93
+#: views/reports/__init__.py:58 views/reports/courses.py:101
 msgid "Course statistics"
 msgstr "Statistiky kurzů"
 
-#: views/reports/__init__.py:69 views/reports/events.py:93
+#: views/reports/__init__.py:64 views/reports/events.py:98
 msgid "Event statistics"
 msgstr "Statistiky akcí"
 
-#: views/reports/__init__.py:75
+#: views/reports/__init__.py:70
 msgid "Orderable event statistics"
 msgstr "Statistiky akcí na objednání"
 
-#: views/reports/__init__.py:81 views/reports/debtors.py:19
+#: views/reports/__init__.py:76 views/reports/debtors.py:19
 msgid "Debtors list"
 msgstr "Seznam dlužníků"
 
-#: views/reports/orderables.py:25
+#: views/reports/orderables.py:22
 msgid "Orderable payments"
 msgstr "Platby za akce na objednání"
 
-#: views/reports/orderables.py:93
+#: views/reports/orderables.py:99
 msgid "Orderable statistics"
 msgstr "Statistiky akcí na objednání"
 
-#: views/reports/subjects.py:93
-msgid "Statistics"
-msgstr "Statistiky"
-
 #: views/schoolyear.py:9
 msgid "Switch school year"
 msgstr "Přepnout školní rok"
 
 #: views/schoolyear.py:12
 msgid "You now work with school year {}."
 msgstr "Nyní pracujete se školním rokem {}"
 
-#: views/subjects.py:72
+#: views/subjects.py:79
+#, python-brace-format
+msgid "Past {subject_type} in school year {school_year}"
+msgstr "Proběhlé {subject_type} ve školním roce {school_year}"
+
+#: views/subjects.py:83
+#, python-brace-format
+msgid "Oncoming {subject_type}"
+msgstr "Nadcházející {subject_type}"
+
+#: views/subjects.py:86
 #, python-brace-format
 msgid "{subject_type} in school year {school_year}"
 msgstr "{subject_type} ve školním roce {school_year}"
 
-#: views/subjects.py:78
+#: views/subjects.py:92
 #, python-brace-format
 msgid "No {subject_type} matching given search parameters found."
 msgstr "Žádné {subject_type} neodpovídají zadaným parametrům hledání."
 
-#: views/subjects.py:109
+#: views/subjects.py:119
 #, python-brace-format
 msgid "My {subject_type} in school year {school_year}"
 msgstr "Moje {subject_type} ve školním roce {school_year}"
 
-#: views/subjects.py:146
+#: views/subjects.py:147
+msgid "Create journal"
+msgstr "Vytvořit deník"
+
+#: views/subjects.py:150
+msgid "No journals matching given search parameters found."
+msgstr "Žádné deníky neodpovídají zadaným parametrům hledání."
+
+#: views/subjects.py:155
+#, python-brace-format
+msgid "Journals of {subject_type} {subject}"
+msgstr "Deníky {subject_type} {subject}"
+
+#: views/subjects.py:175
 #, python-brace-format
 msgid "Change {subject_type} {subject}"
 msgstr "Upravit {subject_type} {subject}"
 
-#: views/subjects.py:152
+#: views/subjects.py:181
 #, python-brace-format
 msgid "The changes in {subject_type} {subject} have been saved."
 msgstr "Změny v {subject_type} {subject} byly uloženy."
 
-#: views/subjects.py:178
+#: views/subjects.py:207
 msgid "Submit registration"
 msgstr "Odeslat přihlášku"
 
-#: views/subjects.py:179
+#: views/subjects.py:208
 msgid ""
 "The registration has been saved. We will inform you about its further "
 "processing."
 msgstr ""
 "Přihláška byla uložena. O jejím dalším zpracování Vás budeme informovat."
 
-#: views/subjects.py:258
+#: views/subjects.py:217
+#, python-brace-format
+msgid "Registration for {subject_type} {subject}"
+msgstr "Přihláška na {subject_type} {subject}"
+
+#: views/subjects.py:293
 msgid "Registration cancellation request"
 msgstr "Požadavek na odhlášení"
 
-#: views/subjects.py:264
+#: views/subjects.py:299
 msgid "Are you sure You want to cancel the registration \"{}\"?"
 msgstr "Opravdu chcete stornovat přihlášku \"{}\"?"
 
-#: views/subjects.py:267
+#: views/subjects.py:302
 msgid "The cancellation request for {} has been saved."
 msgstr "Požadavek na odhlášení přihlášky {} byl uložen."
 
-#: views/timesheets.py:39
+#: views/timesheets.py:36
 msgid "Submit timesheet"
 msgstr "Odevzdat výkaz práce"
 
-#: views/timesheets.py:49
+#: views/timesheets.py:50
 msgid ""
 "Are you sure You want to submit the timesheet now? You won't be able to edit "
 "the entries for {} any more."
 msgstr ""
 "Opravdu chcete odevzdat výkaz práce? Záznamy za {} už nebude možné upravovat."
 
-#: views/timesheets.py:54
+#: views/timesheets.py:55
 msgid "The timesheet for () has been submitted."
 msgstr "Výkaz práce za {} byl odevzdán."
 
-#: views/timesheets.py:65
+#: views/timesheets.py:66
 msgid "New timesheet entry"
 msgstr "Nový záznam výkazu práce"
 
-#: views/timesheets.py:66
+#: views/timesheets.py:67
 msgid "New timesheet entry has been created."
 msgstr "Nový záznam výkazu práce byl vytvořen."
 
-#: views/user.py:25
+#: views/user.py:29
 msgid "User account {} has been created."
 msgstr "Uživatel {} byl vytvořen."
 
-#: views/user.py:58
+#: views/user.py:62
 msgid "Agreement with the terms of use"
 msgstr "Souhlas s podmínkami užití"
 
-#: views/user.py:62
+#: views/user.py:66
 msgid "The agreement has been saved."
 msgstr "Váš souhlas byl uložen."
 
-#: views/user.py:79
+#: views/user.py:83
 msgid "Change user"
 msgstr "Aktualizace údajů o uživateli"
 
-#: views/user.py:85
+#: views/user.py:89
 msgid "User account {} has been updated."
 msgstr "Uživatel {} byl upraven."
 
-#: views/user.py:93
+#: views/user.py:97
 msgid "Change e-mail address"
 msgstr "Změna e-mailové adresy"
 
-#: views/user.py:95
+#: views/user.py:99
 msgid "Set e-mail address"
 msgstr "Nastavení e-mailové adresy"
 
-#: views/user.py:133
+#: views/user.py:140
 msgid ""
 "Enter your email address, and we'll email instructions for setting a new one."
 msgstr ""
 "Zadejte svou e-mailovou adresu a my Vám pošleme instrukce pro nastavení "
 "nového hesla."
 
-#: views/user.py:135
+#: views/user.py:142
 msgid "Reset my password"
 msgstr "Resetovat heslo"
 
-#: views/user.py:154
+#: views/user.py:163
 msgid ""
 "Please enter your new password twice so we can verify you typed it in "
 "correctly."
 msgstr "Prosím vložte své nové heslo pro kontrolu dvakrát."
 
-#: views/user.py:156
+#: views/user.py:165
 msgid "Set my password"
 msgstr "Nastavit heslo"
```

### Comparing `leprikon-3.0.0/leprikon/locale/en/LC_MESSAGES/django.po` & `leprikon-3.5.0/leprikon/locale/en/LC_MESSAGES/django.po`

 * *Files 15% similar despite different names*

```diff
@@ -1,654 +1,977 @@
-# SOME DESCRIPTIVE TITLE.
-# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
-# This file is distributed under the same license as the PACKAGE package.
-# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
+# Leprikon translation.
+# Copyright (C) 2021 Jakub Dorňák <jakub.dornak@qbsoftware.cz>
+# This file is distributed under the same license as the leprikon package.
 #
 #, fuzzy
 msgid ""
 msgstr ""
-"Project-Id-Version: PACKAGE VERSION\n"
+"Project-Id-Version: leprikon\n"
 "Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2019-09-09 15:52+0200\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
-"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
-"Language-Team: LANGUAGE <LL@li.org>\n"
-"Language: \n"
+"POT-Creation-Date: 2022-08-28 11:34+0200\n"
+"Last-Translator: Jakub Dorňák <jakub.dornak@qbsoftware.cz>\n"
+"Language: en\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=INTEGER; plural=EXPRESSION;\n"
+"Plural-Forms: nplurals=1; plural=(n==1) ? 0 : 1;\n"
 
-#: admin/__init__.py:18 admin/__init__.py:19 admin/__init__.py:31
+#: admin/__init__.py:41 admin/__init__.py:42 admin/__init__.py:54
 msgid "Leprikon administration"
 msgstr ""
 
-#: admin/courses.py:81
-msgid "Selected courses were published."
+#: admin/bulkupdate.py:29
+msgid "Fields to update"
 msgstr ""
 
-#: admin/courses.py:82
-msgid "Publish selected courses"
+#: admin/bulkupdate.py:43
+msgid "Bulk update selected items"
 msgstr ""
 
-#: admin/courses.py:86
-msgid "Selected courses were unpublished."
+#: admin/bulkupdate.py:71
+msgid "Failed to update item {}."
+msgstr ""
+
+#: admin/bulkupdate.py:76
+msgid "{} items were updated."
+msgstr ""
+
+#: admin/bulkupdate.py:89
+msgid "Bulk update"
+msgstr ""
+
+#: admin/courses.py:84
+msgid "Publish selected courses"
 msgstr ""
 
 #: admin/courses.py:87
+msgid "Selected courses were published."
+msgstr ""
+
+#: admin/courses.py:89
 msgid "Unpublish selected courses"
 msgstr ""
 
-#: admin/courses.py:92 admin/events.py:61 admin/roles.py:37
-#: admin/schoolyear.py:47
+#: admin/courses.py:92
+msgid "Selected courses were unpublished."
+msgstr ""
+
+#: admin/courses.py:94
+msgid "Copy selected courses to another school year"
+msgstr ""
+
+#: admin/courses.py:98 admin/events.py:91 admin/orderables.py:86
+#: admin/roles.py:58 admin/schoolyear.py:48
 msgid "Target school year"
 msgstr ""
 
-#: admin/courses.py:93
+#: admin/courses.py:99
 msgid "All selected courses will be copied to selected school year."
 msgstr ""
 
-#: admin/courses.py:102
+#: admin/courses.py:109
 msgid "Selected courses were copied to school year {}."
 msgstr ""
 
-#: admin/courses.py:110 admin/events.py:79 admin/roles.py:52
-#: admin/schoolyear.py:72
+#: admin/courses.py:126 admin/events.py:119 admin/orderables.py:117
+#: admin/roles.py:86 admin/schoolyear.py:83
 msgid "Select target school year"
 msgstr ""
 
-#: admin/courses.py:118
-msgid "Copy selected courses to another school year"
+#: admin/courses.py:175 admin/events.py:145 admin/orderables.py:146
+msgid "Add discounts to selected registrations"
 msgstr ""
 
-#: admin/courses.py:170 admin/events.py:122
-msgid "add discount"
+#: admin/courses.py:182 admin/events.py:152 admin/orderables.py:153
+msgid "Discount type"
 msgstr ""
 
-#: admin/courses.py:175
-msgid "course discounts"
+#: admin/courses.py:183 admin/events.py:153 admin/orderables.py:154
+msgid "absolute amount"
 msgstr ""
 
-#: admin/courses.py:193 admin/events.py:139
-msgid "add payment"
+#: admin/courses.py:183 admin/events.py:153 admin/orderables.py:154
+msgid "relative amount in percents"
 msgstr ""
 
-#: admin/courses.py:198
-msgid "course payments"
+#: admin/courses.py:186 admin/events.py:156 admin/orderables.py:157
+msgid "Amount or number of percents"
 msgstr ""
 
-#: admin/courses.py:202 admin/courses.py:216
-msgid "actual balance"
+#: admin/courses.py:196
+#, python-brace-format
+msgid "Periods of school year division: {school_year_division}"
 msgstr ""
 
-#: admin/courses.py:206 admin/courses.py:226
-msgid "total balance"
+#: admin/courses.py:246 admin/events.py:176 admin/orderables.py:177
+msgid "The discounts have been created for selected registrations."
 msgstr ""
 
-#: admin/events.py:50
-msgid "Selected events were published."
+#: admin/courses.py:263 admin/events.py:193 admin/orderables.py:194
+msgid "Add discounts"
 msgstr ""
 
-#: admin/events.py:51
-msgid "Publish selected events"
+#: admin/courses.py:274 admin/events.py:204 admin/orderables.py:205
+#: models/subjects.py:1532
+msgid "discounts"
 msgstr ""
 
-#: admin/events.py:55
-msgid "Selected events were unpublished."
+#: admin/courses.py:290 admin/events.py:214 admin/orderables.py:215
+msgid "add discount"
 msgstr ""
 
-#: admin/events.py:56
-msgid "Unpublish selected events"
+#: admin/courses.py:296 admin/subjects.py:862
+msgid "total price"
 msgstr ""
 
-#: admin/events.py:62
-msgid "All selected events will be copied to selected school year."
+#: admin/courses.py:309 admin/orderables.py:218 admin/subjects.py:834
+#: models/subjects.py:1616
+msgid "received payments"
 msgstr ""
 
-#: admin/events.py:71
-msgid "Selected events were copied to school year {}."
+#: admin/courses.py:326 admin/orderables.py:231
+msgid "add payment"
+msgstr ""
+
+#: admin/events.py:77
+msgid "Publish selected events"
+msgstr ""
+
+#: admin/events.py:80
+msgid "Selected events were published."
+msgstr ""
+
+#: admin/events.py:82
+msgid "Unpublish selected events"
+msgstr ""
+
+#: admin/events.py:85
+msgid "Selected events were unpublished."
 msgstr ""
 
 #: admin/events.py:87
 msgid "Copy selected events to another school year"
 msgstr ""
 
-#: admin/events.py:125
-msgid "event discounts"
+#: admin/events.py:92
+msgid "All selected events will be copied to selected school year."
 msgstr ""
 
-#: admin/events.py:142
-msgid "event payments"
+#: admin/events.py:102
+msgid "Selected events were copied to school year {}."
 msgstr ""
 
-#: admin/export.py:93
+#: admin/export.py:104
 msgid "Export selected records as CSV"
 msgstr ""
 
-#: admin/export.py:100
+#: admin/export.py:113
 msgid "Export selected records as XLSX"
 msgstr ""
 
-#: admin/filters.py:39
+#: admin/filters.py:37
 msgid "status"
 msgstr ""
 
-#: admin/filters.py:44 admin/filters.py:60 admin/filters.py:111
-#: models/agreements.py:14 models/question.py:25 models/schoolyear.py:31
+#: admin/filters.py:42 admin/filters.py:58 admin/filters.py:107
+#: models/agreements.py:12 models/question.py:34 models/schoolyear.py:31
 msgid "active"
 msgstr ""
 
-#: admin/filters.py:45 admin/filters.py:65
+#: admin/filters.py:43 admin/filters.py:63
 msgid "inactive"
 msgstr ""
 
-#: admin/filters.py:72
+#: admin/filters.py:69
 msgid "approval"
 msgstr ""
 
-#: admin/filters.py:77
+#: admin/filters.py:74
 msgid "approved"
 msgstr ""
 
-#: admin/filters.py:78
+#: admin/filters.py:75
 msgid "unapproved"
 msgstr ""
 
-#: admin/filters.py:90
+#: admin/filters.py:86
 msgid "cancelation"
 msgstr ""
 
-#: admin/filters.py:95
+#: admin/filters.py:91
 msgid "not canceled"
 msgstr ""
 
-#: admin/filters.py:96 admin/filters.py:116
+#: admin/filters.py:92 admin/filters.py:112
 msgid "canceled"
 msgstr ""
 
-#: admin/journals.py:60 admin/timesheets.py:62
+#: admin/filters.py:214 admin/transaction.py:25
+msgid "All"
+msgstr ""
+
+#: admin/filters.py:214
+msgid "Set"
+msgstr ""
+
+#: admin/filters.py:214
+msgid "Not set"
+msgstr ""
+
+#: admin/journals.py:111 admin/journals.py:119 admin/journals.py:230
+#: models/journals.py:97 models/journals.py:98 models/journals.py:132
+#: models/journals.py:143 models/journals.py:270
+#: templates/leprikon/journal_preview.html:39
+msgid "journal"
+msgstr ""
+
+#: admin/journals.py:118
+msgid "printable journal"
+msgstr ""
+
+#: admin/journals.py:124
+msgid "printable list of participants"
+msgstr ""
+
+#: admin/journals.py:125 models/journals.py:89 models/journals.py:150
+#: models/roles.py:178 models/subjects.py:367 models/subjects.py:851
+#: models/subjects.py:855 models/subjects.py:1338
+#: templates/leprikon/registration_payment_request/subject.rml:125
+#: templates/leprikon/registration_payment_request/subject.rml:147
+#: templates/leprikon/registration_recipe.rml:10
+msgid "participants"
+msgstr ""
+
+#: admin/journals.py:184 admin/timesheets.py:65
 msgid "update entry"
 msgstr ""
 
-#: admin/journals.py:61 admin/timesheets.py:63
+#: admin/journals.py:185 admin/timesheets.py:66
+#: templates/leprikon/billing_info_preview.html:8
+#: templates/leprikon/journal_journal.html:137
+#: templates/leprikon/journal_journal.html:230
+#: templates/leprikon/journal_journal.html:272
+#: templates/leprikon/journal_journal.html:288
+#: templates/leprikon/journal_journal.html:303
+#: templates/leprikon/journal_preview.html:9
+#: templates/leprikon/parent_preview.html:8
 #: templates/leprikon/participant_preview.html:8
-#: templates/leprikon/participant_preview.html:18
-#: templates/leprikon/subject_journal.html:133
-#: templates/leprikon/subject_journal.html:216
-#: templates/leprikon/subject_journal.html:245
-#: templates/leprikon/subject_journal.html:264
-#: templates/leprikon/subject_journal.html:283
 #: templates/leprikon/subject_preview.html:17
-#: templates/leprikon/timesheet_detail.html:38
+#: templates/leprikon/timesheet_detail.html:43
 msgid "edit"
 msgstr ""
 
-#: admin/journals.py:100 admin/subjects.py:460 admin/subjects.py:552
-#: models/journals.py:20 models/journals.py:144 models/messages.py:21
-#: models/roles.py:249 models/subjects.py:231 models/subjects.py:440
-#: models/subjects.py:457 models/subjects.py:565
-#: templates/leprikon/alternating.html:15
-msgid "subject"
-msgstr ""
-
-#: admin/journals.py:105
+#: admin/journals.py:234
 msgid "agenda"
 msgstr ""
 
-#: admin/messages.py:21
+#: admin/messages.py:20
 msgid "Sending emails"
 msgstr ""
 
-#: admin/messages.py:41 templates/leprikon/admin/send_message.html:11
+#: admin/messages.py:36 templates/leprikon/admin/send_message.html:11
 msgid "Send message"
 msgstr ""
 
-#: admin/messages.py:47
+#: admin/messages.py:42
+msgid "Add recipients to existing message"
+msgstr ""
+
+#: admin/messages.py:46
 msgid "Target message"
 msgstr ""
 
-#: admin/messages.py:48
+#: admin/messages.py:47
 msgid "Recipients will be added to selected message."
 msgstr ""
 
 #: admin/messages.py:66
 msgid "Select target message"
 msgstr ""
 
-#: admin/messages.py:73
-msgid "Add recipients to existing message"
+#: admin/messages.py:95 admin/messages.py:120 models/messages.py:68
+msgid "recipients"
 msgstr ""
 
 #: admin/messages.py:105
 msgid "recipients count"
 msgstr ""
 
 #: admin/messages.py:106
 msgid "sent mail"
 msgstr ""
 
-#: admin/messages.py:107 models/messages.py:50
+#: admin/messages.py:107 models/messages.py:62
 msgid "viewed on site"
 msgstr ""
 
-#: admin/messages.py:113 admin/messages.py:121 models/messages.py:56
-msgid "recipients"
+#: admin/messages.py:113
+msgid "actions"
 msgstr ""
 
-#: admin/messages.py:122
+#: admin/messages.py:121
 msgid "show recipients details"
 msgstr ""
 
-#: admin/messages.py:125
+#: admin/messages.py:123
 msgid "send mails"
 msgstr ""
 
-#: admin/messages.py:126
+#: admin/messages.py:124
 msgid "send mail to all recipients"
 msgstr ""
 
-#: admin/messages.py:128
+#: admin/messages.py:126
 msgid "send unsent"
 msgstr ""
 
-#: admin/messages.py:129
+#: admin/messages.py:127
 msgid "send mails to new recipients only"
 msgstr ""
 
-#: admin/messages.py:133
-msgid "actions"
-msgstr ""
-
-#: admin/messages.py:174
+#: admin/messages.py:163
 msgid "Send email to selected recipients"
 msgstr ""
 
-#: admin/messages.py:181
+#: admin/messages.py:178
 msgid "Recipients of message {}"
 msgstr ""
 
-#: admin/pdf.py:35
-msgid "Export selected items in single PDF."
+#: admin/orderables.py:72
+msgid "Publish selected orderable events"
 msgstr ""
 
-#: admin/pdf.py:60 templates/leprikon/payments.html:29
+#: admin/orderables.py:75
+msgid "Selected orderable events were published."
+msgstr ""
+
+#: admin/orderables.py:77
+msgid "Unpublish selected orderable events"
+msgstr ""
+
+#: admin/orderables.py:80
+msgid "Selected orderable events were unpublished."
+msgstr ""
+
+#: admin/orderables.py:82
+msgid "Copy selected orderable events to another school year"
+msgstr ""
+
+#: admin/orderables.py:87
+msgid "All selected orderable events will be copied to selected school year."
+msgstr ""
+
+#: admin/orderables.py:99
+msgid "Selected orderable events were copied to school year {}."
+msgstr ""
+
+#: admin/pdf.py:17
+msgid "Export selected items in single PDF"
+msgstr ""
+
+#: admin/pdf.py:65 templates/leprikon/donations.html:23
+#: templates/leprikon/payments.html:32
 #: templates/leprikon/registration_preview.html:8
 msgid "download"
 msgstr ""
 
-#: admin/roles.py:38
-msgid "All selected leaders will be added to selected school year."
+#: admin/refundrequest.py:60 models/organizations.py:21
+msgid "IBAN"
 msgstr ""
 
-#: admin/roles.py:47
-msgid "Selected leaders were added to school year {}."
+#: admin/refundrequest.py:64 models/organizations.py:22
+msgid "BIC (SWIFT)"
 msgstr ""
 
-#: admin/roles.py:59
+#: admin/refundrequest.py:68 admin/subjects.py:1031 admin/transaction.py:95
+#: models/refundrequest.py:45 models/transaction.py:116
+#: templates/leprikon/donation_pdf/recipe.rml:34
+#: templates/leprikon/received_payment_pdf/recipe.rml:38
+#: templates/leprikon/returned_payment_pdf/recipe.rml:38
+msgid "amount"
+msgstr ""
+
+#: admin/refundrequest.py:76 models/refundrequest.py:14
+msgid "requested time"
+msgstr ""
+
+#: admin/refundrequest.py:83
+msgid "Export selected records as ABO"
+msgstr ""
+
+#: admin/refundrequest.py:87
+msgid "Constant symbol"
+msgstr ""
+
+#: admin/refundrequest.py:88
+msgid "Message for recipient"
+msgstr ""
+
+#: admin/refundrequest.py:114
+msgid "Export setup"
+msgstr ""
+
+#: admin/registrationlink.py:112 admin/registrationlink.py:116
+#: models/registrationlink.py:34 models/subjects.py:815
+msgid "registration link"
+msgstr ""
+
+#: admin/registrationlink.py:127 admin/subjects.py:275 models/subjects.py:821
+#: templates/leprikon/subject_preview.html:101
+msgid "registrations"
+msgstr ""
+
+#: admin/roles.py:54
 msgid "Add selected leaders to another school year"
 msgstr ""
 
-#: admin/roles.py:63 models/roles.py:117 models/roles.py:156
-#: models/subjects.py:574 models/subjects.py:841 models/subjects.py:861
-#: models/subjects.py:870 models/subjects.py:1008
+#: admin/roles.py:59
+msgid "All selected leaders will be added to selected school year."
+msgstr ""
+
+#: admin/roles.py:69
+msgid "Selected leaders were added to school year {}."
+msgstr ""
+
+#: admin/roles.py:97 models/roles.py:113 models/roles.py:152
+#: models/subjects.py:1290 models/subjects.py:1315 models/subjects.py:1324
+#: models/subjects.py:1443 models/subjects.py:1471
 msgid "first name"
 msgstr ""
 
-#: admin/roles.py:68 models/roles.py:118 models/roles.py:157
-#: models/subjects.py:575 models/subjects.py:842 models/subjects.py:862
-#: models/subjects.py:871 models/subjects.py:1009
+#: admin/roles.py:101 models/roles.py:114 models/roles.py:153
+#: models/subjects.py:1291 models/subjects.py:1316 models/subjects.py:1325
+#: models/subjects.py:1444 models/subjects.py:1472
 msgid "last name"
 msgstr ""
 
-#: admin/roles.py:73 conf/default_settings.py:11
-#: templates/leprikon/payment_pdf/recipe.rml:19
+#: admin/roles.py:105 conf/default_settings.py:11
+#: templates/leprikon/donation_pdf/recipe.rml:19
+#: templates/leprikon/received_payment_pdf/recipe.rml:19
+#: templates/leprikon/registration_payment_request/subject.rml:60
+#: templates/leprikon/registration_payment_request/subject.rml:84
+#: templates/leprikon/returned_payment_pdf/recipe.rml:19
 msgid "email"
 msgstr ""
 
-#: admin/roles.py:78 models/roles.py:102
+#: admin/roles.py:109 models/roles.py:99
 msgid "contacts"
 msgstr ""
 
-#: admin/roles.py:86 models/roles.py:24 models/roles.py:115 models/roles.py:152
-#: models/subjects.py:563 models/useragreement.py:8
+#: admin/roles.py:113 models/roles.py:27 models/roles.py:111
+#: models/roles.py:149 models/roles.py:219 models/subjects.py:737
+#: models/useragreement.py:11
 msgid "user"
 msgstr ""
 
-#: admin/roles.py:103 models/courses.py:35
+#: admin/roles.py:132 models/courses.py:37
 msgid "courses"
 msgstr ""
 
-#: admin/roles.py:112 models/events.py:31
+#: admin/roles.py:140 models/events.py:34
 msgid "events"
 msgstr ""
 
-#: admin/roles.py:120 admin/subjects.py:203 admin/subjects.py:269
-#: models/roles.py:27 models/subjects.py:186
+#: admin/roles.py:148 models/orderables.py:38
+msgid "orderable events"
+msgstr ""
+
+#: admin/roles.py:156 admin/subjects.py:329 admin/subjects.py:376
+#: models/roles.py:30 models/subjects.py:401
 msgid "photo"
 msgstr ""
 
-#: admin/schoolyear.py:48
+#: admin/schoolyear.py:44
+msgid "Copy selected school year divisions to another school year"
+msgstr ""
+
+#: admin/schoolyear.py:49
 msgid ""
 "All selected school year divisions will be copied to selected school year."
 msgstr ""
 
-#: admin/schoolyear.py:63
+#: admin/schoolyear.py:65
 msgid "Selected school year divisions were copied to school year {}."
 msgstr ""
 
-#: admin/schoolyear.py:80
-msgid "Copy selected school year divisions to another school year"
+#: admin/sendmail.py:9
+msgid "Send selected items by e-mail"
 msgstr ""
 
-#: admin/subjects.py:135
-msgid "printable journal"
+#: admin/sendmail.py:13
+msgid "Selected items were sent by e-mail."
 msgstr ""
 
-#: admin/subjects.py:136 admin/subjects.py:138
-#: templates/leprikon/subject_preview.html:107
-msgid "journal"
+#: admin/subjects.py:258 admin/subjects.py:264
+#: templates/leprikon/subject_preview.html:105
+msgid "journals"
+msgstr ""
+
+#: admin/subjects.py:268
+msgid "add journal"
 msgstr ""
 
-#: admin/subjects.py:152
+#: admin/subjects.py:282
 msgid "There are no approved registrations for this {}."
 msgstr ""
 
-#: admin/subjects.py:154
+#: admin/subjects.py:284
 msgid "The number of approved registrations is lower than {}."
 msgstr ""
 
-#: admin/subjects.py:156
+#: admin/subjects.py:286
 msgid "The number of approved registrations is greater than {}."
 msgstr ""
 
-#: admin/subjects.py:177
+#: admin/subjects.py:313
 msgid "add registration"
 msgstr ""
 
-#: admin/subjects.py:180 models/subjects.py:601
-#: templates/leprikon/subject_preview.html:103
-msgid "registrations"
-msgstr ""
-
-#: admin/subjects.py:185
+#: admin/subjects.py:317
 msgid "registration allowed"
 msgstr ""
 
-#: admin/subjects.py:189
+#: admin/subjects.py:321
 msgid "approved registrations count"
 msgstr ""
 
-#: admin/subjects.py:194
+#: admin/subjects.py:325
 msgid "unapproved registrations count"
 msgstr ""
 
-#: admin/subjects.py:216
-msgid "Registration dates were updated."
+#: admin/subjects.py:639
+msgid "Approve selected registrations"
 msgstr ""
 
-#: admin/subjects.py:221
-msgid "Select registration dates"
+#: admin/subjects.py:649
+#, python-brace-format
+msgid "The registration {r} has been approved and the user has been notified."
 msgstr ""
 
-#: admin/subjects.py:229
-msgid "Set registration dates"
+#: admin/subjects.py:652
+msgid "Refuse selected registrations"
 msgstr ""
 
-#: admin/subjects.py:368
-msgid "Selected registrations were approved."
+#: admin/subjects.py:662
+#, python-brace-format
+msgid "The registration {r} has been refused and the user has been notified."
 msgstr ""
 
-#: admin/subjects.py:369
-msgid "Approve selected registrations"
+#: admin/subjects.py:665
+msgid "Request payment for selected registrations"
 msgstr ""
 
-#: admin/subjects.py:374
-msgid "Selected registrations were refused."
+#: admin/subjects.py:669
+msgid "Payment was requested for selected registrations."
 msgstr ""
 
-#: admin/subjects.py:375
-msgid "Refuse selected registrations"
+#: admin/subjects.py:671
+msgid "Offer refund for selected registrations"
 msgstr ""
 
-#: admin/subjects.py:380
-msgid "Payment was requested for selected registrations."
+#: admin/subjects.py:675
+msgid "Refund was offered for selected registrations."
 msgstr ""
 
-#: admin/subjects.py:381
-msgid "Request payment for selected registrations"
+#: admin/subjects.py:677
+msgid "Generate refund requests for selected registrations"
+msgstr ""
+
+#: admin/subjects.py:681
+msgid "Refund requests were generated for selected registrations."
 msgstr ""
 
-#: admin/subjects.py:386
-msgid "Selected registrations were canceled."
+#: admin/subjects.py:683
+msgid "Export selected registrations as invoices in XML"
 msgstr ""
 
-#: admin/subjects.py:387
+#: admin/subjects.py:689
 msgid "Cancel selected registrations"
 msgstr ""
 
-#: admin/subjects.py:560 models/subjects.py:1092
-#: templates/leprikon/payment_pdf/recipe.rml:38
-msgid "amount"
+#: admin/subjects.py:699
+#, python-brace-format
+msgid "The registration {r} has been canceled and the user has been notified."
+msgstr ""
+
+#: admin/subjects.py:702
+msgid "Cancel cancelation request for selected registrations"
+msgstr ""
+
+#: admin/subjects.py:705
+msgid "The cancelation requests have been removed from selected registrations."
+msgstr ""
+
+#: admin/subjects.py:794
+msgid "cancelation requested"
+msgstr ""
+
+#: admin/subjects.py:795
+msgid "new registration"
 msgstr ""
 
-#: admin/timesheets.py:55 models/roles.py:26 models/subjects.py:172
-#: templates/leprikon/timesheet_detail.html:24
+#: admin/subjects.py:796
+msgid "new registration, capacity full"
+msgstr ""
+
+#: admin/subjects.py:797
+msgid "approved registration"
+msgstr ""
+
+#: admin/subjects.py:800 admin/subjects.py:934 models/journals.py:85
+#: models/journals.py:275 models/messages.py:28 models/roles.py:266
+#: models/subjects.py:497 models/subjects.py:705 models/subjects.py:726
+#: models/subjects.py:740 templates/leprikon/alternating.html:15
+msgid "subject"
+msgstr ""
+
+#: admin/subjects.py:804
+msgid "decision"
+msgstr ""
+
+#: admin/subjects.py:812
+msgid "admission decision"
+msgstr ""
+
+#: admin/subjects.py:812
+msgid "refusal decision"
+msgstr ""
+
+#: admin/subjects.py:815 models/subjects.py:747
+msgid "time of registration"
+msgstr ""
+
+#: admin/subjects.py:817 models/subjects.py:756
+msgid "time of approval"
+msgstr ""
+
+#: admin/subjects.py:819 models/subjects.py:765 models/subjects.py:774
+msgid "payment request time"
+msgstr ""
+
+#: admin/subjects.py:821
+msgid "refund offer time"
+msgstr ""
+
+#: admin/subjects.py:823 models/subjects.py:783
+msgid "time of cancellation request"
+msgstr ""
+
+#: admin/subjects.py:825 models/subjects.py:792
+msgid "time of cancellation"
+msgstr ""
+
+#: admin/subjects.py:830
+msgid "random number"
+msgstr ""
+
+#: admin/subjects.py:846
+msgid "add received payment"
+msgstr ""
+
+#: admin/subjects.py:849 models/subjects.py:1635
+msgid "returned payments"
+msgstr ""
+
+#: admin/subjects.py:859
+msgid "add returned payment"
+msgstr ""
+
+#: admin/subjects.py:979 models/subjects.py:807
+#: templates/leprikon/received_payment_pdf/recipe.rml:30
+#: templates/leprikon/registration_payment_request/subject.rml:193
+#: templates/leprikon/returned_payment_pdf/recipe.rml:30
+msgid "variable symbol"
+msgstr ""
+
+#: admin/timesheets.py:57 models/roles.py:29 models/subjects.py:381
+#: templates/leprikon/registration_payment_request/subject.rml:109
+#: templates/leprikon/timesheet_detail.html:29
 msgid "description"
 msgstr ""
 
-#: admin/timesheets.py:101
+#: admin/timesheets.py:97
 msgid "group durations"
 msgstr ""
 
-#: admin/timesheets.py:105
+#: admin/timesheets.py:107
+msgid "Mark selected timesheets as paid"
+msgstr ""
+
+#: admin/timesheets.py:110
 msgid "Selected timesheets where marked as paid."
 msgstr ""
 
-#: admin/timesheets.py:106
-msgid "Mark selected timesheets as paid"
+#: admin/timesheets.py:112
+msgid "Submit selected timesheets"
 msgstr ""
 
-#: admin/timesheets.py:110
+#: admin/timesheets.py:115
 msgid "Selected timesheets where submitted."
 msgstr ""
 
-#: admin/timesheets.py:111
-msgid "Submit selected timesheets"
+#: admin/transaction.py:56 models/transaction.py:32
+msgid "accounted time"
+msgstr ""
+
+#: admin/transaction.py:57 models/transaction.py:41
+msgid "last updated time"
 msgstr ""
 
-#: admin/user.py:36
+#: admin/user.py:25 models/roles.py:37 models/roles.py:87 models/roles.py:248
+#: models/timesheets.py:70
+msgid "leader"
+msgstr ""
+
+#: admin/user.py:35 views/generic.py:151
+msgid "Yes"
+msgstr ""
+
+#: admin/user.py:60
+msgid "Merge selected user accounts"
+msgstr ""
+
+#: admin/user.py:64
 msgid "Target user"
 msgstr ""
 
-#: admin/user.py:37
+#: admin/user.py:65
 msgid "All information will be merged into selected account."
 msgstr ""
 
-#: admin/user.py:48
+#: admin/user.py:77
 msgid "User {} was merged into user {}."
 msgstr ""
 
-#: admin/user.py:51
+#: admin/user.py:80
 msgid "Can not merge user {} into user {}."
 msgstr ""
 
-#: admin/user.py:58
+#: admin/user.py:89
 msgid "Select target user for merge"
 msgstr ""
 
-#: admin/user.py:59
+#: admin/user.py:91
 msgid ""
 "Are you sure you want to merge selected users into one? All participants, "
 "parents, registrations and other related information will be added to the "
 "target user account and the remaining users will be deleted."
 msgstr ""
 
-#: admin/user.py:63
+#: admin/user.py:96 templates/leprikon/admin/dashboard.html:7
 msgid "Users"
 msgstr ""
 
-#: admin/user.py:64
+#: admin/user.py:97
 msgid "Select target account for merge"
 msgstr ""
 
-#: admin/user.py:69
-msgid "Merge selected user accounts"
+#: admin/user.py:104
+msgid "Send instructions to reset password to selected users"
 msgstr ""
 
-#: admin/user.py:117 admin/user.py:120 admin/user.py:125 admin/user.py:128
+#: admin/user.py:111
+msgid "Instructions were send to user {}."
+msgstr ""
+
+#: admin/user.py:114
+msgid "Can not send instructions to user {}."
+msgstr ""
+
+#: admin/user.py:153 admin/user.py:158 admin/user.py:164 admin/user.py:168
 msgid "login"
 msgstr ""
 
 #: apps.py:9 cms_apps.py:13 cms_menus.py:15 cms_plugins/base.py:7
-#: cms_toolbars.py:15 cms_toolbars.py:17
+#: cms_toolbars.py:14 cms_toolbars.py:16
 msgid "Leprikon"
 msgstr ""
 
 #: cms_apps.py:22
 msgid "Leprikon subject type"
 msgstr ""
 
-#: cms_menus.py:24 templates/leprikon/leader_summary.html:6
+#: cms_menus.py:25 templates/leprikon/leader_summary.html:6
 #: templates/leprikon/summary.html:6
 msgid "Summary"
 msgstr ""
 
-#: cms_menus.py:30 templates/leprikon/reports/index.html:6
+#: cms_menus.py:33 templates/leprikon/reports/index.html:6
 msgid "Reports"
 msgstr ""
 
-#: cms_menus.py:36 cms_plugins/leaders.py:12 forms/journals.py:65
-#: forms/subjects.py:44
+#: cms_menus.py:41 cms_plugins/leaders.py:10 forms/journals.py:145
+#: forms/subjects.py:54
 msgid "Leader"
 msgstr ""
 
-#: cms_menus.py:43
+#: cms_menus.py:50
 #, python-brace-format
 msgid "My {subject_type}"
 msgstr ""
 
-#: cms_menus.py:49
+#: cms_menus.py:58
 msgid "Alternating"
 msgstr ""
 
-#: cms_menus.py:55 views/timesheets.py:21
+#: cms_menus.py:66 templates/leprikon/admin/dashboard.html:17
+#: views/timesheets.py:18
 msgid "Timesheets"
 msgstr ""
 
-#: cms_menus.py:61 views/messages.py:19
+#: cms_menus.py:74 views/messages.py:19
 msgid "Messages"
 msgstr ""
 
-#: cms_menus.py:67 templates/leprikon/reports/course_stats.html:19
+#: cms_menus.py:82 templates/leprikon/admin/dashboard.html:36
+#: templates/leprikon/reports/course_stats.html:23
 #: templates/leprikon/reports/event_stats.html:19
+#: templates/leprikon/reports/orderable_stats.html:19
 msgid "Registrations"
 msgstr ""
 
-#: cms_menus.py:73 templates/leprikon/registration_payments.html:27
-#: views/subjects.py:269
+#: cms_menus.py:90 views/subjects.py:327
 msgid "Payments"
 msgstr ""
 
-#: cms_menus.py:79 templates/leprikon/subject_journal.html:175
+#: cms_menus.py:98 views/donation.py:20
+msgid "Donations"
+msgstr ""
+
+#: cms_menus.py:106 forms/refundrequest.py:23
+#: templates/leprikon/journal_journal.html:186
+#: templates/leprikon/registration_mail_details.html:6
+#: templates/leprikon/registration_mail_details.txt:2
+#: templates/leprikon/summary.html:42
 msgid "Participants"
 msgstr ""
 
-#: cms_menus.py:99 templates/leprikon/login.html:19
+#: cms_menus.py:114 templates/leprikon/subject_registration_form.html:215
+#: views/billing_info.py:19
+msgid "Billing information"
+msgstr ""
+
+#: cms_menus.py:136 templates/leprikon/login.html:6
+#: templates/leprikon/login.html:30 templates/leprikon/login.html:57
 #: templates/leprikon/password_reset_complete.html:12
 msgid "Log in"
 msgstr ""
 
-#: cms_menus.py:105 templates/leprikon/login.html:28 views/user.py:31
+#: cms_menus.py:144 templates/leprikon/login.html:73 views/user.py:25
 msgid "Create account"
 msgstr ""
 
-#: cms_menus.py:111
+#: cms_menus.py:152 templates/leprikon/login.html:78
 msgid "Reset password"
 msgstr ""
 
-#: cms_menus.py:119
+#: cms_menus.py:162
 msgid "Change user details"
 msgstr ""
 
-#: cms_menus.py:125
+#: cms_menus.py:170
 msgid "Change e-mail"
 msgstr ""
 
-#: cms_menus.py:131 templates/admin/inc/branding.html:23 views/user.py:115
+#: cms_menus.py:178 templates/admin/base.html:13
+#: templates/admin/inc/branding.html:23 views/user.py:110
 msgid "Change password"
 msgstr ""
 
-#: cms_menus.py:137
+#: cms_menus.py:186
 msgid "Link with Google account"
 msgstr ""
 
-#: cms_menus.py:144
+#: cms_menus.py:199
 msgid "Link with Facebook account"
 msgstr ""
 
-#: cms_menus.py:151 templates/admin/inc/branding.html:29
+#: cms_menus.py:212 templates/admin/base.html:14
+#: templates/admin/inc/branding.html:29
 msgid "Log out"
 msgstr ""
 
-#: cms_plugins/courses.py:12
+#: cms_plugins/courses.py:10
 #: templates/leprikon/reports/course_payments_status.html:14
 msgid "Course"
 msgstr ""
 
-#: cms_plugins/courses.py:22
+#: cms_plugins/courses.py:20
 msgid "Course list"
 msgstr ""
 
-#: cms_plugins/courses.py:32
+#: cms_plugins/courses.py:30
 msgid "Course list with search form"
 msgstr ""
 
-#: cms_plugins/events.py:12
+#: cms_plugins/events.py:10
 #: templates/leprikon/reports/event_payments_status.html:14
 msgid "Event"
 msgstr ""
 
-#: cms_plugins/events.py:22
+#: cms_plugins/events.py:20
 msgid "Event list"
 msgstr ""
 
-#: cms_plugins/events.py:32
+#: cms_plugins/events.py:30
 msgid "Event list with search form"
 msgstr ""
 
-#: cms_plugins/leaders.py:22
+#: cms_plugins/leaders.py:20
 msgid "Leader list"
 msgstr ""
 
-#: cms_plugins/leaders.py:32
+#: cms_plugins/leaders.py:29
 msgid "Leader list with search form"
 msgstr ""
 
-#: conf/default_settings.py:12 models/leprikonsite.py:46 models/roles.py:123
-#: models/roles.py:163 models/subjects.py:579 models/subjects.py:851
-#: models/subjects.py:866 models/subjects.py:875
-#: templates/leprikon/payment_pdf/recipe.rml:20
+#: cms_plugins/orderables.py:10
+#: templates/leprikon/reports/orderable_payments_status.html:14
+msgid "Orderable event"
+msgstr ""
+
+#: cms_plugins/orderables.py:20
+msgid "Orderable list"
+msgstr ""
+
+#: cms_plugins/orderables.py:30
+msgid "Orderable list with search form"
+msgstr ""
+
+#: cms_plugins/schoolyears.py:10
+msgid "School year block"
+msgstr ""
+
+#: conf/default_settings.py:12 models/organizations.py:18 models/roles.py:119
+#: models/roles.py:166 models/roles.py:228 models/subjects.py:1304
+#: models/subjects.py:1320 models/subjects.py:1329 models/subjects.py:1448
+#: models/subjects.py:1506 templates/leprikon/donation_pdf/recipe.rml:20
+#: templates/leprikon/received_payment_pdf/recipe.rml:20
+#: templates/leprikon/registration_payment_request/subject.rml:61
+#: templates/leprikon/registration_payment_request/subject.rml:85
+#: templates/leprikon/returned_payment_pdf/recipe.rml:20
 msgid "phone"
 msgstr ""
 
 #: conf/default_settings.py:13
 msgid "url"
 msgstr ""
 
-#: conf/default_settings.py:17 conf/default_settings.py:21
-#: conf/default_settings.py:25 conf/default_settings.py:29
-#: conf/default_settings.py:34 conf/default_settings.py:39
+#: conf/default_settings.py:16 conf/default_settings.py:18
+#: conf/default_settings.py:20 conf/default_settings.py:22
+#: conf/default_settings.py:25 conf/default_settings.py:30
+#: conf/default_settings.py:35 conf/default_settings.py:39
 msgid "Default"
 msgstr ""
 
-#: conf/default_settings.py:30
+#: conf/default_settings.py:26
 msgid "Grouped by course groups"
 msgstr ""
 
-#: conf/default_settings.py:35
+#: conf/default_settings.py:31 conf/default_settings.py:36
 msgid "Grouped by event groups"
 msgstr ""
 
 #: conf/default_settings.py:48
 msgid "boolean field"
 msgstr ""
 
@@ -661,262 +984,389 @@
 msgstr ""
 
 #: conf/default_settings.py:60
 msgid "choice field"
 msgstr ""
 
 #: conf/default_settings.py:64
+msgid "required field with an empty option"
+msgstr ""
+
+#: conf/default_settings.py:68
 msgid "date field"
 msgstr ""
 
-#: forms/fields.py:14
+#: forms/courses.py:14 templates/leprikon/registration_pdf/subject.rml:79
+msgid "Periods"
+msgstr ""
+
+#: forms/fields.py:19
 msgid "agree"
 msgstr ""
 
-#: forms/fields.py:15
+#: forms/fields.py:20
 msgid "disagree"
 msgstr ""
 
-#: forms/journals.py:44
+#: forms/fields.py:53
+msgid "yes"
+msgstr ""
+
+#: forms/fields.py:54
+msgid "no"
+msgstr ""
+
+#: forms/journals.py:126
 #, python-brace-format
 msgid "The journal entry starts at {start}"
 msgstr ""
 
-#: forms/journals.py:48
+#: forms/journals.py:130
 #, python-brace-format
 msgid "The journal entry ends at {end}"
 msgstr ""
 
-#: forms/journals.py:63 forms/journals.py:174
-#: templates/leprikon/messages_table.html:6 templates/leprikon/payments.html:15
-msgid "Subject"
+#: forms/journals.py:143 forms/journals.py:270
+#: templates/leprikon/journal_journal.html:12
+#: templates/leprikon/journal_journal.html:122
+msgid "Journal"
 msgstr ""
 
-#: forms/journals.py:64 forms/journals.py:90 forms/timesheets.py:29
+#: forms/journals.py:144 forms/journals.py:167 forms/timesheets.py:29
+#: templates/leprikon/donations.html:8
+#: templates/leprikon/journal_journal.html:211
 #: templates/leprikon/messages_table.html:7 templates/leprikon/payments.html:14
 #: templates/leprikon/reports/course_payments.html:14
+#: templates/leprikon/reports/course_payments.html:38
 #: templates/leprikon/reports/event_payments.html:14
-#: templates/leprikon/subject_journal.html:198
+#: templates/leprikon/reports/event_payments.html:38
+#: templates/leprikon/reports/orderable_payments.html:14
+#: templates/leprikon/reports/orderable_payments.html:38
 msgid "Date"
 msgstr ""
 
-#: forms/journals.py:69 forms/timesheets.py:30
-#: templates/leprikon/cms/event_list/default.html:26
-#: templates/leprikon/cms/event_list/grouped.html:28
+#: forms/journals.py:149 forms/timesheets.py:30
 #: templates/leprikon/subject_preview.html:31
 msgid "Start"
 msgstr ""
 
-#: forms/journals.py:70 forms/timesheets.py:31
-#: templates/leprikon/cms/event_list/default.html:29
-#: templates/leprikon/cms/event_list/grouped.html:31
+#: forms/journals.py:150 forms/timesheets.py:31
 #: templates/leprikon/subject_preview.html:34
 msgid "End"
 msgstr ""
 
-#: forms/journals.py:126
+#: forms/journals.py:203
 msgid "If You fill in start time, You must fill end time too."
 msgstr ""
 
-#: forms/journals.py:128
+#: forms/journals.py:205
 msgid "If You fill in end time, You must fill start time too."
 msgstr ""
 
-#: forms/journals.py:141
+#: forms/journals.py:218
 msgid "An overlaping entry has already been added in the journal."
 msgstr ""
 
-#: forms/journals.py:153
+#: forms/journals.py:227
+msgid ""
+"Following participants were selected as instructed, but not selected as "
+"present: {}"
+msgstr ""
+
+#: forms/journals.py:238
+msgid "Following participants have not yet been instructed: {}"
+msgstr ""
+
+#: forms/journals.py:250
 #, python-brace-format
 msgid "Some submitted timesheet entries start at {start}"
 msgstr ""
 
-#: forms/journals.py:157
+#: forms/journals.py:254
 #, python-brace-format
 msgid "Some submitted timesheet entries end at {end}"
 msgstr ""
 
-#: forms/journals.py:168 templates/leprikon/subject_journal.html:154
+#: forms/journals.py:264 templates/leprikon/admin/dashboard.html:12
+#: templates/leprikon/journal_journal.html:163
 msgid "Leaders"
 msgstr ""
 
-#: forms/journals.py:169
+#: forms/journals.py:265
 msgid "Alternates"
 msgstr ""
 
-#: forms/journals.py:262
+#: forms/journals.py:365
 #, python-brace-format
 msgid "Leader {leaders} has already submitted timesheet for {period}."
 msgid_plural "Leaders {leaders} have already submitted timesheet for {period}."
 msgstr[0] ""
 msgstr[1] ""
 
-#: forms/journals.py:271
+#: forms/journals.py:374
 #, python-brace-format
 msgid "Alternate {leaders} has already submitted timesheet for {period}."
 msgid_plural ""
 "Alternates {leaders} have already submitted timesheet for {period}."
 msgstr[0] ""
 msgstr[1] ""
 
-#: forms/leaders.py:9 forms/messages.py:12 forms/subjects.py:39
+#: forms/leaders.py:9 forms/messages.py:12 forms/subjects.py:48
 msgid "Search term"
 msgstr ""
 
-#: forms/messages.py:38 forms/messages.py:41
+#: forms/messages.py:33 forms/messages.py:36
 msgid "Recipients"
 msgstr ""
 
-#: forms/reports/courses.py:8 forms/reports/events.py:8
-msgid "Start date"
+#: forms/refundrequest.py:25
+#: templates/leprikon/registration_decision/subject.rml:57
+#: templates/leprikon/registration_details.html:32
+#: templates/leprikon/registration_mail_details.html:6
+#: templates/leprikon/registration_mail_details.txt:2
+#: templates/leprikon/registration_pdf/subject.rml:99
+#: templates/leprikon/registration_preview.html:62
+#: templates/leprikon/subject_registration_form.html:86
+#: templates/leprikon/summary.html:42
+msgid "Participant"
+msgstr ""
+
+#: forms/refundrequest.py:30
+#: templates/leprikon/registration_decision/subject.rml:78
+#: templates/leprikon/registration_details.html:109
+#: templates/leprikon/registration_mail_details.html:9
+#: templates/leprikon/registration_mail_details.txt:3
+#: templates/leprikon/registration_pdf/subject.rml:235
+#: templates/leprikon/registration_preview.html:86
+#: templates/leprikon/subject_registration_form.html:180
+#: templates/leprikon/summary.html:45
+msgid "Contact person"
+msgstr ""
+
+#: forms/refundrequest.py:32
+#: templates/leprikon/registration_decision/subject.rml:74
+#: templates/leprikon/registration_details.html:97
+#: templates/leprikon/registration_mail_details.html:10
+#: templates/leprikon/registration_mail_details.txt:4
+#: templates/leprikon/registration_pdf/subject.rml:231
+#: templates/leprikon/registration_preview.html:80
+#: templates/leprikon/summary.html:46
+msgid "Group name"
+msgstr ""
+
+#: forms/refundrequest.py:34
+#: templates/leprikon/registration_refund_offer/subject.html:7
+#: templates/leprikon/registration_refund_offer/subject.txt:4
+#: templates/leprikon/summary.html:34
+msgid "Overpaid amount"
 msgstr ""
 
 #: forms/reports/courses.py:9 forms/reports/events.py:9
+#: forms/reports/orderables.py:9
+msgid "Start date"
+msgstr ""
+
+#: forms/reports/courses.py:10 forms/reports/events.py:10
+#: forms/reports/orderables.py:10
 msgid "End date"
 msgstr ""
 
-#: forms/reports/courses.py:13 forms/reports/debtors.py:8
-#: forms/reports/events.py:13
+#: forms/reports/courses.py:14 forms/reports/debtors.py:8
+#: forms/reports/events.py:14 forms/reports/orderables.py:14
 msgid "Status for date"
 msgstr ""
 
-#: forms/reports/courses.py:17 forms/reports/events.py:17
+#: forms/reports/courses.py:18 forms/reports/events.py:18
+#: forms/reports/orderables.py:18
 msgid "Statistics for date"
 msgstr ""
 
-#: forms/reports/courses.py:18 forms/reports/events.py:18
+#: forms/reports/courses.py:21
+msgid "Courses"
+msgstr ""
+
+#: forms/reports/courses.py:23 forms/reports/events.py:23
+#: forms/reports/orderables.py:23
 msgid "Count only paid registrations"
 msgstr ""
 
+#: forms/reports/courses.py:24 forms/reports/events.py:24
+#: forms/reports/orderables.py:24
+msgid "Count registrations paid later"
+msgstr ""
+
+#: forms/reports/courses.py:25 forms/reports/events.py:25
+#: forms/reports/orderables.py:25
+msgid "Count registrations approved later"
+msgstr ""
+
+#: forms/reports/courses.py:26 forms/reports/events.py:26
+#: forms/reports/orderables.py:26
+msgid "Count only unique participants"
+msgstr ""
+
+#: forms/reports/courses.py:28
+msgid "Maximal number of weekly hours"
+msgstr ""
+
+#: forms/reports/courses.py:29
+msgid "Count only participants attending at most this number of hours weekly."
+msgstr ""
+
+#: forms/reports/events.py:21
+msgid "Events"
+msgstr ""
+
+#: forms/reports/events.py:28 forms/reports/orderables.py:28
+msgid "Minimal number of days"
+msgstr ""
+
+#: forms/reports/events.py:29 forms/reports/orderables.py:29
+msgid ""
+"Count only participants attending events that last at least this number of "
+"days."
+msgstr ""
+
+#: forms/reports/orderables.py:21
+msgid "Orderables"
+msgstr ""
+
 #: forms/schoolyear.py:10
+#: templates/leprikon/registration_decision/subject.rml:48
 msgid "School year"
 msgstr ""
 
-#: forms/subjects.py:40
+#: forms/subjects.py:49
 msgid "Course type"
 msgstr ""
 
-#: forms/subjects.py:41
+#: forms/subjects.py:50
 msgid "Event type"
 msgstr ""
 
-#: forms/subjects.py:42
+#: forms/subjects.py:51
+msgid "Orderable event type"
+msgstr ""
+
+#: forms/subjects.py:52
 msgid "Department"
 msgstr ""
 
-#: forms/subjects.py:43 templates/leprikon/registration_pdf/subject.rml:199
-#: templates/leprikon/subject_registration_form.html:161
+#: forms/subjects.py:53 templates/leprikon/registration_pdf/subject.rml:211
+#: templates/leprikon/subject_registration_form.html:167
 msgid "Group"
 msgstr ""
 
-#: forms/subjects.py:45 templates/leprikon/subject_preview.html:43
-#: templates/leprikon/subject_preview.html:50
+#: forms/subjects.py:55 templates/leprikon/journal_preview.html:25
+#: templates/leprikon/subject_preview.html:43
+#: templates/leprikon/subject_preview.html:51
 msgid "Place"
 msgstr ""
 
-#: forms/subjects.py:46 templates/leprikon/participant_preview.html:23
-#: templates/leprikon/registration_details.html:22
-#: templates/leprikon/registration_pdf/subject.rml:104
-#: templates/leprikon/subject_preview.html:58
+#: forms/subjects.py:56 templates/leprikon/participant_preview.html:18
+#: templates/leprikon/registration_details.html:44
+#: templates/leprikon/registration_pdf/subject.rml:109
+#: templates/leprikon/subject_preview.html:59
 msgid "Age group"
-msgid_plural "Age groups"
-msgstr[0] ""
-msgstr[1] ""
+msgstr ""
+
+#: forms/subjects.py:57 templates/leprikon/registration_details.html:103
+#: templates/leprikon/registration_pdf/subject.rml:217
+#: templates/leprikon/subject_preview.html:66
+msgid "Target group"
+msgstr ""
 
-#: forms/subjects.py:47
+#: forms/subjects.py:59
 msgid "Day of week"
 msgstr ""
 
-#: forms/subjects.py:49
-msgid "Include past subjects"
+#: forms/subjects.py:61
+msgid "Show past"
 msgstr ""
 
-#: forms/subjects.py:50
+#: forms/subjects.py:62
 msgid "Available for registration"
 msgstr ""
 
-#: forms/subjects.py:51
+#: forms/subjects.py:63
 msgid "Show invisible"
 msgstr ""
 
-#: forms/subjects.py:196
-msgid ""
-"At least one age group must be selected, if participants are allowed on "
-"registration."
-msgstr ""
-
-#: forms/subjects.py:200
-msgid ""
-"At least one target group must be selected, if group members are allowed on "
-"registration."
+#: forms/subjects.py:268
+msgid "Participant with this birth number has already been registered."
 msgstr ""
 
-#: forms/subjects.py:208 forms/subjects.py:378
-#: templates/leprikon/participant_preview.html:41
-#: templates/leprikon/registration_details.html:42
-#: templates/leprikon/registration_details.html:106
-#: templates/leprikon/registration_pdf/subject.rml:133
-#: templates/leprikon/registration_pdf/subject.rml:234
+#: forms/subjects.py:353 forms/subjects.py:520
+#: templates/leprikon/participant_preview.html:36
+#: templates/leprikon/registration_details.html:65
+#: templates/leprikon/registration_details.html:130
+#: templates/leprikon/registration_pdf/subject.rml:145
+#: templates/leprikon/registration_pdf/subject.rml:222
 msgid "School"
 msgstr ""
 
-#: forms/subjects.py:211 forms/subjects.py:382 models/roles.py:168
-#: models/subjects.py:583 models/subjects.py:856
+#: forms/subjects.py:357 forms/subjects.py:524 models/roles.py:170
+#: models/subjects.py:1310 models/subjects.py:1453
 msgid "other school"
 msgstr ""
 
-#: forms/subjects.py:241 forms/subjects.py:252
+#: forms/subjects.py:378 forms/subjects.py:389 forms/subjects.py:692
 msgid "Choose"
 msgstr ""
 
-#: forms/subjects.py:242
+#: forms/subjects.py:379
 msgid "new participant"
 msgstr ""
 
-#: forms/subjects.py:253
+#: forms/subjects.py:390
 msgid "new parent"
 msgstr ""
 
-#: forms/subjects.py:610
-msgid "Your email"
+#: forms/subjects.py:694
+msgid "no billing information"
+msgstr ""
+
+#: forms/subjects.py:698
+msgid "new billing information"
 msgstr ""
 
 #: forms/timesheets.py:32
 msgid "Entry type"
 msgstr ""
 
-#: forms/timesheets.py:41
+#: forms/timesheets.py:42
 #, python-brace-format
 msgid "The timesheet period {period} starts {start}"
 msgstr ""
 
-#: forms/timesheets.py:46
+#: forms/timesheets.py:49
 #, python-brace-format
 msgid "The timesheet period {period} ends {end}"
 msgstr ""
 
-#: forms/timesheets.py:54
+#: forms/timesheets.py:60
 #, python-brace-format
 msgid "Your timesheet for period {period} has already been submitted."
 msgstr ""
 
-#: forms/timesheets.py:70
+#: forms/timesheets.py:77
 msgid "An overlaping entry has already been added in the timesheet."
 msgstr ""
 
-#: forms/user.py:28
+#: forms/user.py:29
 msgid "User with this email already exists."
 msgstr ""
 
-#: forms/user.py:56 templates/leprikon/registration_pdf/subject.rml:127
-#: templates/leprikon/registration_pdf/subject.rml:228
+#: forms/user.py:57 forms/user.py:75
+#: templates/leprikon/registration_pdf/subject.rml:139
+#: templates/leprikon/registration_pdf/subject.rml:250
 msgid "E-mail"
 msgstr ""
 
-#: forms/user.py:57 forms/user.py:70
+#: forms/user.py:58 forms/user.py:71
 msgid "I agree with the terms."
 msgstr ""
 
 #: gettext_overrides.py:9
 msgid "Publish page changes"
 msgstr ""
 
@@ -928,610 +1378,846 @@
 msgid "other country in EU"
 msgstr ""
 
 #: migrations/0017_citizenship.py:25
 msgid "country outside EU"
 msgstr ""
 
-#: models/account.py:14
+#: models/account.py:11
 msgid "closure date"
 msgstr ""
 
-#: models/account.py:21
+#: models/account.py:18
 msgid "account closure"
 msgstr ""
 
-#: models/account.py:22
+#: models/account.py:19
 msgid "account closures"
 msgstr ""
 
-#: models/agegroup.py:10 models/agreements.py:10 models/agreements.py:33
-#: models/citizenship.py:8 models/department.py:8 models/place.py:8
-#: models/printsetup.py:13 models/question.py:16 models/school.py:9
-#: models/schoolyear.py:108 models/subjects.py:128 models/subjects.py:171
-#: models/targetgroup.py:10 models/timesheets.py:129
+#: models/agegroup.py:8 models/agreements.py:8 models/agreements.py:32
+#: models/citizenship.py:6 models/department.py:6 models/place.py:6
+#: models/printsetup.py:11 models/question.py:14 models/registrationlink.py:24
+#: models/roles.py:221 models/school.py:7 models/schoolyear.py:104
+#: models/subjects.py:325 models/subjects.py:380 models/subjects.py:1499
+#: models/targetgroup.py:8 models/timesheets.py:124
 msgid "name"
 msgstr ""
 
-#: models/agegroup.py:11 models/agreements.py:11 models/agreements.py:34
-#: models/citizenship.py:9 models/roles.py:93 models/subjects.py:73
-#: models/subjects.py:115 models/subjects.py:131 models/subjects.py:444
-#: models/subjects.py:459 models/targetgroup.py:11 models/timesheets.py:130
+#: models/agegroup.py:9
+msgid "minimal age"
+msgstr ""
+
+#: models/agegroup.py:10
+msgid "maximal age"
+msgstr ""
+
+#: models/agegroup.py:11 models/agreements.py:9 models/agreements.py:33
+#: models/citizenship.py:7 models/roles.py:90 models/subjects.py:126
+#: models/subjects.py:305 models/subjects.py:328 models/subjects.py:709
+#: models/targetgroup.py:9 models/timesheets.py:125
 msgid "order"
 msgstr ""
 
-#: models/agegroup.py:12 models/targetgroup.py:12
+#: models/agegroup.py:12 models/targetgroup.py:10
 msgid "require school"
 msgstr ""
 
-#: models/agegroup.py:17 models/roles.py:154 models/subjects.py:844
+#: models/agegroup.py:17 models/roles.py:151 models/subjects.py:1300
 msgid "age group"
 msgstr ""
 
-#: models/agegroup.py:18 models/courses.py:380 models/events.py:192
-#: models/subjects.py:178
+#: models/agegroup.py:18 models/courses.py:354 models/events.py:188
+#: models/orderables.py:192 models/subjects.py:394
 msgid "age groups"
 msgstr ""
 
-#: models/agreements.py:12
+#: models/agreements.py:10
 msgid "heading"
 msgstr ""
 
-#: models/agreements.py:13 models/agreements.py:32
+#: models/agreements.py:11 models/agreements.py:30
 msgid "agreement"
 msgstr ""
 
-#: models/agreements.py:19
+#: models/agreements.py:17
 msgid "legal agreement"
 msgstr ""
 
-#: models/agreements.py:20 models/subjects.py:594
+#: models/agreements.py:18 models/subjects.py:805
 msgid "legal agreements"
 msgstr ""
 
-#: models/agreements.py:35
+#: models/agreements.py:34
 msgid "required"
 msgstr ""
 
-#: models/agreements.py:36
+#: models/agreements.py:35
 msgid "option"
 msgstr ""
 
-#: models/agreements.py:42
+#: models/agreements.py:41
 msgid "agreement option"
 msgstr ""
 
-#: models/agreements.py:43 models/subjects.py:688
+#: models/agreements.py:42 models/subjects.py:885
 msgid "agreement options"
 msgstr ""
 
-#: models/citizenship.py:14 models/roles.py:164 models/subjects.py:849
+#: models/citizenship.py:8
+msgid "require birth number"
+msgstr ""
+
+#: models/citizenship.py:13 models/roles.py:155 models/subjects.py:1293
 msgid "citizenship"
 msgstr ""
 
-#: models/citizenship.py:15
+#: models/citizenship.py:14
 msgid "citizenships"
 msgstr ""
 
-#: models/courses.py:28 models/schoolyear.py:65 models/schoolyear.py:106
+#: models/courses.py:25 models/schoolyear.py:65 models/schoolyear.py:102
 msgid "school year division"
 msgstr ""
 
-#: models/courses.py:34 models/courses.py:154 models/courses.py:298
-#: models/courses.py:300 models/courses.py:361 models/subjects.py:60
-msgid "course"
+#: models/courses.py:28
+msgid "allow period selection"
 msgstr ""
 
-#: models/courses.py:61 models/courses.py:163 models/events.py:50
-msgid "times"
+#: models/courses.py:30
+msgid "allow user to choose school year periods on registration form"
 msgstr ""
 
-#: models/courses.py:155
-msgid "day of week"
+#: models/courses.py:36 models/courses.py:259 models/courses.py:262
+#: models/courses.py:318 models/subjects.py:96 models/subjects.py:695
+msgid "course"
 msgstr ""
 
-#: models/courses.py:156 models/events.py:24 models/journals.py:23
-#: models/journals.py:119 models/timesheets.py:150
-msgid "start time"
+#: models/courses.py:95
+msgid "course registration"
 msgstr ""
 
-#: models/courses.py:157 models/events.py:25 models/journals.py:24
-#: models/journals.py:120 models/timesheets.py:151
-msgid "end time"
+#: models/courses.py:96
+msgid "course registrations"
 msgstr ""
 
-#: models/courses.py:162
-msgid "time"
+#: models/courses.py:121
+msgid "no period"
 msgstr ""
 
-#: models/courses.py:167
-msgid "{day}, {start:%H:%M} - {end:%H:%M}"
+#: models/courses.py:159 models/courses.py:233 models/events.py:141
+#: models/orderables.py:145 models/refundrequest.py:27 models/subjects.py:820
+#: models/subjects.py:1288 models/subjects.py:1437 models/subjects.py:1469
+#: models/subjects.py:1497 templates/leprikon/registration_links.html:4
+msgid "registration"
 msgstr ""
 
-#: models/courses.py:173
-msgid "{day}, {start:%H:%M}"
+#: models/courses.py:165 models/courses.py:239 models/timesheets.py:67
+msgid "period"
 msgstr ""
 
-#: models/courses.py:208
-msgid "course registration"
+#: models/courses.py:167 models/subjects.py:295 models/subjects.py:296
+msgid "payment requested"
 msgstr ""
 
-#: models/courses.py:209
-msgid "course registrations"
+#: models/courses.py:171
+msgid "registered period"
 msgstr ""
 
-#: models/courses.py:289 models/events.py:167 models/subjects.py:600
-#: models/subjects.py:835 models/subjects.py:1006 models/subjects.py:1088
-#: templates/leprikon/registration_links.html:4
-msgid "registration"
+#: models/courses.py:172
+msgid "registered periods"
 msgstr ""
 
-#: models/courses.py:291 models/timesheets.py:71
-msgid "period"
+#: models/courses.py:248
+msgid "course discount"
+msgstr ""
+
+#: models/courses.py:249
+msgid "course discounts"
 msgstr ""
 
-#: models/courses.py:308 models/courses.py:309
+#: models/courses.py:270 models/courses.py:271
 msgid "course registration history"
 msgstr ""
 
-#: models/courses.py:315
+#: models/courses.py:277
 msgid "now"
 msgstr ""
 
-#: models/courses.py:362 models/courses.py:386 models/events.py:174
-#: models/events.py:198 models/roles.py:235 models/roles.py:252
+#: models/courses.py:320 models/courses.py:379 models/events.py:154
+#: models/events.py:213 models/orderables.py:158 models/orderables.py:217
+#: models/roles.py:250 models/roles.py:269
 msgid "template"
 msgstr ""
 
-#: models/courses.py:365 models/courses.py:389 models/events.py:177
-#: models/events.py:201 models/roles.py:238 models/roles.py:255
+#: models/courses.py:324 models/courses.py:383 models/events.py:158
+#: models/events.py:217 models/orderables.py:162 models/orderables.py:221
+#: models/roles.py:254 models/roles.py:273
 msgid "The template used to render plugin."
 msgstr ""
 
-#: models/courses.py:373 models/courses.py:457 models/events.py:185
-#: models/events.py:269 models/roles.py:247 models/roles.py:283
-#: models/schoolyear.py:38 models/schoolyear.py:57 models/subjects.py:167
+#: models/courses.py:333 models/courses.py:459 models/events.py:167
+#: models/events.py:293 models/orderables.py:171 models/orderables.py:297
+#: models/registrationlink.py:18 models/roles.py:263 models/roles.py:306
+#: models/schoolyear.py:38 models/schoolyear.py:56 models/subjects.py:373
 msgid "school year"
 msgstr ""
 
-#: models/courses.py:375 models/department.py:15 models/events.py:187
+#: models/courses.py:339 models/department.py:13 models/events.py:173
+#: models/orderables.py:177
 msgid "departments"
 msgstr ""
 
-#: models/courses.py:376 models/events.py:188
+#: models/courses.py:340 models/events.py:174 models/orderables.py:178
 msgid "Keep empty to skip searching by departments."
 msgstr ""
 
-#: models/courses.py:377 models/courses.py:459
+#: models/courses.py:347 models/courses.py:465
 msgid "course types"
 msgstr ""
 
-#: models/courses.py:379
+#: models/courses.py:348
 msgid "Keep empty to skip searching by course types."
 msgstr ""
 
-#: models/courses.py:381 models/events.py:193
+#: models/courses.py:355 models/events.py:189 models/orderables.py:193
 msgid "Keep empty to skip searching by age groups."
 msgstr ""
 
-#: models/courses.py:382
+#: models/courses.py:361 models/events.py:195 models/orderables.py:199
+#: models/subjects.py:395 models/targetgroup.py:16
+msgid "target groups"
+msgstr ""
+
+#: models/courses.py:362 models/events.py:196 models/orderables.py:200
+msgid "Keep empty to skip searching by target groups."
+msgstr ""
+
+#: models/courses.py:368
 msgid "course groups"
 msgstr ""
 
-#: models/courses.py:383 models/events.py:195
+#: models/courses.py:369 models/events.py:203 models/orderables.py:207
 msgid "Keep empty to skip searching by groups."
 msgstr ""
 
-#: models/courses.py:384 models/events.py:196 models/roles.py:37
-#: models/subjects.py:181
+#: models/courses.py:375 models/events.py:207 models/journals.py:87
+#: models/orderables.py:211 models/roles.py:38 models/subjects.py:396
 msgid "leaders"
 msgstr ""
 
-#: models/courses.py:385 models/events.py:197
+#: models/courses.py:376 models/events.py:210 models/orderables.py:214
 msgid "Keep empty to skip searching by leaders."
 msgstr ""
 
-#: models/department.py:9
+#: models/department.py:7
 msgid "department code"
 msgstr ""
 
-#: models/department.py:14 models/subjects.py:173
+#: models/department.py:12 models/subjects.py:388
 msgid "department"
 msgstr ""
 
-#: models/events.py:22 models/schoolyear.py:109 models/timesheets.py:34
+#: models/donation.py:15
+msgid "donation"
+msgstr ""
+
+#: models/donation.py:16
+msgid "donations"
+msgstr ""
+
+#: models/events.py:23 models/orderables.py:74 models/schoolyear.py:105
+#: models/timesheets.py:32
 msgid "start date"
 msgstr ""
 
-#: models/events.py:23 models/schoolyear.py:110 models/timesheets.py:35
+#: models/events.py:24 models/schoolyear.py:106 models/timesheets.py:33
 msgid "end date"
 msgstr ""
 
-#: models/events.py:30 models/events.py:173 models/subjects.py:61
+#: models/events.py:25 models/journals.py:146 models/journals.py:253
+#: models/orderables.py:75 models/times.py:24 models/timesheets.py:149
+msgid "start time"
+msgstr ""
+
+#: models/events.py:26 models/journals.py:147 models/journals.py:254
+#: models/times.py:25 models/timesheets.py:150
+msgid "end time"
+msgstr ""
+
+#: models/events.py:27 models/schoolyear.py:107
+msgid "due from"
+msgstr ""
+
+#: models/events.py:28 models/schoolyear.py:108
+#: templates/leprikon/registration_payment_request/subject.rml:115
+msgid "due date"
+msgstr ""
+
+#: models/events.py:33 models/events.py:152 models/orderables.py:156
+#: models/subjects.py:97
 msgid "event"
 msgstr ""
 
-#: models/events.py:142
+#: models/events.py:40 models/journals.py:138 models/subjects.py:701
+#: models/times.py:32 models/times.py:82
+msgid "times"
+msgstr ""
+
+#: models/events.py:111
 msgid "event registration"
 msgstr ""
 
-#: models/events.py:143
+#: models/events.py:112
 msgid "event registrations"
 msgstr ""
 
-#: models/events.py:189 models/events.py:271
+#: models/events.py:146
+msgid "event discount"
+msgstr ""
+
+#: models/events.py:147
+msgid "event discounts"
+msgstr ""
+
+#: models/events.py:181 models/events.py:299 models/orderables.py:185
+#: models/orderables.py:303
 msgid "event types"
 msgstr ""
 
-#: models/events.py:191
+#: models/events.py:182 models/orderables.py:186
 msgid "Keep empty to skip searching by event types."
 msgstr ""
 
-#: models/events.py:194
+#: models/events.py:202 models/orderables.py:206
 msgid "event groups"
 msgstr ""
 
-#: models/fields.py:21
+#: models/fields.py:25
 msgid "Enter a valid hex color."
 msgstr ""
 
-#: models/fields.py:49
+#: models/fields.py:53
 msgid "Monday"
 msgstr ""
 
-#: models/fields.py:50
+#: models/fields.py:54
 msgid "Tuesday"
 msgstr ""
 
-#: models/fields.py:51
+#: models/fields.py:55
 msgid "Wednesday"
 msgstr ""
 
-#: models/fields.py:52
+#: models/fields.py:56
 msgid "Thursday"
 msgstr ""
 
-#: models/fields.py:53
+#: models/fields.py:57
 msgid "Friday"
 msgstr ""
 
-#: models/fields.py:54
+#: models/fields.py:58
 msgid "Saturday"
 msgstr ""
 
-#: models/fields.py:55
+#: models/fields.py:59
 msgid "Sunday"
 msgstr ""
 
-#: models/fields.py:81
+#: models/fields.py:84
 msgid "Enter a valid birth number."
 msgstr ""
 
-#: models/journals.py:15
-msgid "instruction on OSH"
+#: models/journals.py:86
+msgid "journal name"
+msgstr ""
+
+#: models/journals.py:91
+msgid "risks"
 msgstr ""
 
-#: models/journals.py:22 models/journals.py:138 models/timesheets.py:149
+#: models/journals.py:92
+msgid "plan"
+msgstr ""
+
+#: models/journals.py:93
+msgid "evaluation"
+msgstr ""
+
+#: models/journals.py:137 models/subjects.py:700 models/times.py:31
+msgid "time"
+msgstr ""
+
+#: models/journals.py:145 models/journals.py:265 models/timesheets.py:148
 #: templates/leprikon/alternating.html:14
-#: templates/leprikon/registration_pdf/subject.rml:292
-#: templates/leprikon/timesheet_detail.html:20
+#: templates/leprikon/registration_pdf/subject.rml:310
+#: templates/leprikon/timesheet_detail.html:25
 msgid "date"
 msgstr ""
 
-#: models/journals.py:25
+#: models/journals.py:148
 msgid "session agenda"
 msgstr ""
 
-#: models/journals.py:26 models/roles.py:179 models/subjects.py:625
-#: models/subjects.py:629 models/subjects.py:883
-msgid "participants"
+#: models/journals.py:156 templates/leprikon/journal_journal.html:241
+msgid "participants instructed about safety and internal rules"
 msgstr ""
 
-#: models/journals.py:32 models/journals.py:115
+#: models/journals.py:162 models/journals.py:244
 msgid "journal entry"
 msgstr ""
 
-#: models/journals.py:33
+#: models/journals.py:163
 msgid "journal entries"
 msgstr ""
 
-#: models/journals.py:62 models/journals.py:157 models/timesheets.py:174
-#: templates/leprikon/timesheet_detail.html:22
+#: models/journals.py:182 models/journals.py:288 models/orderables.py:22
+#: models/orderables.py:44 models/timesheets.py:170
+#: templates/leprikon/timesheet_detail.html:27
 msgid "duration"
 msgstr ""
 
-#: models/journals.py:117 models/timesheets.py:84 models/timesheets.py:145
+#: models/journals.py:251 models/timesheets.py:81 models/timesheets.py:140
 msgid "timesheet"
 msgstr ""
 
-#: models/journals.py:124
+#: models/journals.py:258
 msgid "journal leader entry"
 msgstr ""
 
-#: models/journals.py:125
+#: models/journals.py:259
 msgid "journal leader entries"
 msgstr ""
 
-#: models/leprikonsite.py:41
-msgid "company name"
-msgstr ""
-
-#: models/leprikonsite.py:42 models/roles.py:119 models/roles.py:159
-#: models/school.py:10 models/subjects.py:576 models/subjects.py:846
-#: models/subjects.py:863 models/subjects.py:872
-msgid "street"
-msgstr ""
-
-#: models/leprikonsite.py:43 models/roles.py:120 models/roles.py:160
-#: models/school.py:11 models/subjects.py:577 models/subjects.py:847
-#: models/subjects.py:864 models/subjects.py:873
-msgid "city"
-msgstr ""
-
-#: models/leprikonsite.py:44 models/roles.py:121 models/roles.py:161
-#: models/subjects.py:578 models/subjects.py:848 models/subjects.py:865
-#: models/subjects.py:874
-msgid "postal code"
-msgstr ""
-
-#: models/leprikonsite.py:45 models/roles.py:122 models/roles.py:162
-#: models/subjects.py:580 models/subjects.py:852 models/subjects.py:867
-#: models/subjects.py:876
-msgid "email address"
-msgstr ""
-
-#: models/leprikonsite.py:47 templates/leprikon/payment_pdf/recipe.rml:22
-msgid "company number"
+#: models/leprikonsite.py:49
+msgid "default organization"
 msgstr ""
 
-#: models/leprikonsite.py:48
-msgid "VAT number"
+#: models/leprikonsite.py:57
+msgid "default registration print setup"
 msgstr ""
 
-#: models/leprikonsite.py:49
-msgid "IBAN"
+#: models/leprikonsite.py:65
+msgid "default decision print setup"
 msgstr ""
 
-#: models/leprikonsite.py:50
-msgid "BIC (SWIFT)"
+#: models/leprikonsite.py:73
+msgid "default payment request print setup"
 msgstr ""
 
-#: models/leprikonsite.py:52
-msgid "bill print setup"
+#: models/leprikonsite.py:81
+msgid "default bill print setup"
 msgstr ""
 
-#: models/leprikonsite.py:54 models/subjects.py:83 models/subjects.py:224
-msgid "registration print setup"
-msgstr ""
-
-#: models/leprikonsite.py:55
+#: models/leprikonsite.py:83
 msgid "user agreement"
 msgstr ""
 
-#: models/leprikonsite.py:56
+#: models/leprikonsite.py:84
 msgid "last time user agreement changed"
 msgstr ""
 
-#: models/leprikonsite.py:58
-msgid "registration agreements"
+#: models/leprikonsite.py:89
+msgid "default registration agreements"
 msgstr ""
 
-#: models/leprikonsite.py:59
+#: models/leprikonsite.py:90
 msgid "Add legal agreements for the registration form."
 msgstr ""
 
-#: models/leprikonsite.py:62
+#: models/leprikonsite.py:93
 msgid "Payment Gateway"
 msgstr ""
 
-#: models/leprikonsite.py:68
+#: models/leprikonsite.py:100
 msgid "leprikon site"
 msgstr ""
 
-#: models/leprikonsite.py:69
+#: models/leprikonsite.py:101
 msgid "leprikon sites"
 msgstr ""
 
-#: models/messages.py:20
+#: models/messages.py:19
 msgid "created"
 msgstr ""
 
-#: models/messages.py:22
+#: models/messages.py:26
+msgid "sender"
+msgstr ""
+
+#: models/messages.py:29
 msgid "text"
 msgstr ""
 
-#: models/messages.py:27 models/messages.py:46 models/messages.py:97
+#: models/messages.py:34 models/messages.py:52 models/messages.py:114
 msgid "message"
 msgstr ""
 
-#: models/messages.py:28
+#: models/messages.py:35
 msgid "messages"
 msgstr ""
 
-#: models/messages.py:47 models/messages.py:55
+#: models/messages.py:59 models/messages.py:67
 msgid "recipient"
 msgstr ""
 
-#: models/messages.py:49
+#: models/messages.py:61
 #: templates/admin/leprikon/messagerecipient/send_mails.html:63
 msgid "sent"
 msgstr ""
 
-#: models/messages.py:51
+#: models/messages.py:63
 msgid "sent by email"
 msgstr ""
 
-#: models/messages.py:102 models/subjects.py:120 models/subjects.py:464
+#: models/messages.py:120 models/subjects.py:311
 msgid "attachment"
 msgstr ""
 
-#: models/messages.py:103 models/subjects.py:121 models/subjects.py:465
+#: models/messages.py:121 models/subjects.py:312
 msgid "attachments"
 msgstr ""
 
-#: models/place.py:9 models/place.py:14 models/subjects.py:176
+#: models/orderables.py:22
+msgid "Format: HH:MM:SS"
+msgstr ""
+
+#: models/orderables.py:24
+msgid "number of days to send the payment request before event date"
+msgstr ""
+
+#: models/orderables.py:28
+msgid ""
+"If set, payment request will be sent this number of days before event date. "
+"If not set, payment request will be sent when registration is approved."
+msgstr ""
+
+#: models/orderables.py:32
+msgid "number of days to due date before event date"
+msgstr ""
+
+#: models/orderables.py:37 models/subjects.py:98
+msgid "orderable event"
+msgstr ""
+
+#: models/orderables.py:79
+msgid "orderable event registration"
+msgstr ""
+
+#: models/orderables.py:80
+msgid "orderable event registrations"
+msgstr ""
+
+#: models/orderables.py:122
+msgid "event date"
+msgstr ""
+
+#: models/orderables.py:150
+msgid "orderable event discount"
+msgstr ""
+
+#: models/orderables.py:151
+msgid "orderable event discounts"
+msgstr ""
+
+#: models/organizations.py:13
+msgid "organization name"
+msgstr ""
+
+#: models/organizations.py:14 models/roles.py:115 models/roles.py:162
+#: models/roles.py:222 models/school.py:8 models/subjects.py:1301
+#: models/subjects.py:1317 models/subjects.py:1326 models/subjects.py:1445
+#: models/subjects.py:1500
+msgid "street"
+msgstr ""
+
+#: models/organizations.py:15 models/roles.py:116 models/roles.py:163
+#: models/roles.py:223 models/school.py:9 models/subjects.py:1302
+#: models/subjects.py:1318 models/subjects.py:1327 models/subjects.py:1446
+#: models/subjects.py:1501
+msgid "city"
+msgstr ""
+
+#: models/organizations.py:16 models/roles.py:117 models/roles.py:164
+#: models/roles.py:224 models/subjects.py:1303 models/subjects.py:1319
+#: models/subjects.py:1328 models/subjects.py:1447 models/subjects.py:1502
+msgid "postal code"
+msgstr ""
+
+#: models/organizations.py:17 models/roles.py:118 models/roles.py:165
+#: models/roles.py:229 models/subjects.py:1305 models/subjects.py:1321
+#: models/subjects.py:1330 models/subjects.py:1449 models/subjects.py:1507
+msgid "email address"
+msgstr ""
+
+#: models/organizations.py:19 models/roles.py:225 models/subjects.py:1503
+#: templates/leprikon/donation_pdf/recipe.rml:22
+#: templates/leprikon/received_payment_pdf/recipe.rml:22
+#: templates/leprikon/registration_payment_request/subject.rml:63
+#: templates/leprikon/registration_payment_request/subject.rml:87
+#: templates/leprikon/returned_payment_pdf/recipe.rml:22
+msgid "company number"
+msgstr ""
+
+#: models/organizations.py:20 models/roles.py:226 models/subjects.py:1504
+#: templates/leprikon/billing_info_preview.html:22
+#: templates/leprikon/registration_payment_request/subject.rml:64
+#: templates/leprikon/registration_payment_request/subject.rml:88
+msgid "VAT number"
+msgstr ""
+
+#: models/organizations.py:29
+msgid "donation print setup"
+msgstr ""
+
+#: models/organizations.py:34 models/subjects.py:174 models/subjects.py:481
+#: models/transaction.py:157
+msgid "organization"
+msgstr ""
+
+#: models/organizations.py:35
+msgid "organizations"
+msgstr ""
+
+#: models/organizations.py:40 models/roles.py:241 models/subjects.py:1518
+#: templates/leprikon/donation_pdf/recipe.rml:15
+#: templates/leprikon/received_payment_pdf/recipe.rml:15
+#: templates/leprikon/registration_payment_request/subject.rml:56
+#: templates/leprikon/registration_payment_request/subject.rml:78
+#: templates/leprikon/returned_payment_pdf/recipe.rml:15
+msgid "address"
+msgstr ""
+
+#: models/organizations.py:45
+#: templates/leprikon/registration_payment_request/subject.rml:201
+msgid "bank account"
+msgstr ""
+
+#: models/place.py:7 models/place.py:12 models/subjects.py:392
 msgid "place"
 msgstr ""
 
-#: models/place.py:15
+#: models/place.py:13
 msgid "places"
 msgstr ""
 
-#: models/printsetup.py:14
+#: models/printsetup.py:13
 msgid "pdf background"
 msgstr ""
 
-#: models/printsetup.py:16
+#: models/printsetup.py:15
 msgid "margin top"
 msgstr ""
 
-#: models/printsetup.py:17 models/printsetup.py:19 models/printsetup.py:21
-#: models/printsetup.py:23
+#: models/printsetup.py:15 models/printsetup.py:16 models/printsetup.py:17
+#: models/printsetup.py:18
 msgid "distance in milimetres"
 msgstr ""
 
-#: models/printsetup.py:18
+#: models/printsetup.py:16
 msgid "margin left"
 msgstr ""
 
-#: models/printsetup.py:20
+#: models/printsetup.py:17
 msgid "margin right"
 msgstr ""
 
-#: models/printsetup.py:22
+#: models/printsetup.py:18
 msgid "margin bottom"
 msgstr ""
 
-#: models/printsetup.py:28
+#: models/printsetup.py:23
 msgid "print setup"
 msgstr ""
 
-#: models/printsetup.py:29
+#: models/printsetup.py:24
 msgid "print setups"
 msgstr ""
 
-#: models/question.py:17
+#: models/question.py:15
+msgid "unique identifier"
+msgstr ""
+
+#: models/question.py:16
 msgid "question"
 msgstr ""
 
 #: models/question.py:18
 msgid "help text"
 msgstr ""
 
-#: models/question.py:19
+#: models/question.py:21
 msgid "This is help text. The help text is shown next to the form field."
 msgstr ""
 
-#: models/question.py:20
+#: models/question.py:24
 msgid "field"
 msgstr ""
 
-#: models/question.py:23
+#: models/question.py:29
 msgid "field_args"
 msgstr ""
 
-#: models/question.py:24
+#: models/question.py:32
 msgid "Enter valid JSON structure representing field configuration."
 msgstr ""
 
-#: models/question.py:29
+#: models/question.py:39
 msgid "additional question"
 msgstr ""
 
-#: models/question.py:30 models/subjects.py:75 models/subjects.py:216
+#: models/question.py:40 models/subjects.py:131 models/subjects.py:427
 msgid "additional questions"
 msgstr ""
 
-#: models/question.py:59
+#: models/question.py:64
 msgid "Failed to create field with given field args: {}"
 msgstr ""
 
-#: models/roles.py:29 models/subjects.py:188
-msgid "page"
+#: models/refundrequest.py:21
+msgid "requested by"
 msgstr ""
 
-#: models/roles.py:31 models/schoolyear.py:39
-msgid "school years"
+#: models/refundrequest.py:29
+msgid "bank account number"
 msgstr ""
 
-#: models/roles.py:36 models/roles.py:89 models/roles.py:233
-#: models/timesheets.py:73
-msgid "leader"
+#: models/refundrequest.py:34
+msgid "refund request"
+msgstr ""
+
+#: models/refundrequest.py:35
+msgid "refund requests"
+msgstr ""
+
+#: models/refundrequest.py:43
+msgid "Refund may only be requested for overpaid registrations."
+msgstr ""
+
+#: models/registrationlink.py:21 models/subjects.py:234 models/subjects.py:320
+#: models/subjects.py:329 models/subjects.py:376
+msgid "subject type"
 msgstr ""
 
-#: models/roles.py:90
+#: models/registrationlink.py:25 models/subjects.py:399
+msgid "registration active from"
+msgstr ""
+
+#: models/registrationlink.py:26 models/subjects.py:400
+msgid "registration active to"
+msgstr ""
+
+#: models/registrationlink.py:28 models/subjects.py:108 models/subjects.py:498
+msgid "subjects"
+msgstr ""
+
+#: models/registrationlink.py:35
+msgid "registration links"
+msgstr ""
+
+#: models/roles.py:31 models/subjects.py:119 models/subjects.py:402
+msgid "page"
+msgstr ""
+
+#: models/roles.py:32 models/schoolyear.py:39 models/schoolyear.py:128
+msgid "school years"
+msgstr ""
+
+#: models/roles.py:88
 msgid "contact type"
 msgstr ""
 
-#: models/roles.py:92 models/roles.py:101
+#: models/roles.py:89 models/roles.py:98
 msgid "contact"
 msgstr ""
 
-#: models/roles.py:94 models/subjects.py:183
+#: models/roles.py:91 models/subjects.py:286 models/subjects.py:398
 msgid "public"
 msgstr ""
 
-#: models/roles.py:127
+#: models/roles.py:123
 msgid "parent"
 msgstr ""
 
-#: models/roles.py:128
+#: models/roles.py:124
 msgid "parents"
 msgstr ""
 
-#: models/roles.py:158 models/subjects.py:843
+#: models/roles.py:157 models/subjects.py:1295
 msgid "birth number"
 msgstr ""
 
-#: models/roles.py:166 models/school.py:16 models/subjects.py:581
-#: models/subjects.py:854
+#: models/roles.py:158 models/subjects.py:1296
+msgid "birth date"
+msgstr ""
+
+#: models/roles.py:160 models/subjects.py:1298
+msgid "gender"
+msgstr ""
+
+#: models/roles.py:160 models/subjects.py:1298
+msgid "male / boy"
+msgstr ""
+
+#: models/roles.py:160 models/subjects.py:1298
+msgid "female / girl"
+msgstr ""
+
+#: models/roles.py:168 models/school.py:14 models/subjects.py:1308
+#: models/subjects.py:1451
 msgid "school"
 msgstr ""
 
-#: models/roles.py:169 models/subjects.py:584 models/subjects.py:857
+#: models/roles.py:171 models/subjects.py:1311 models/subjects.py:1454
 msgid "class"
 msgstr ""
 
-#: models/roles.py:170 models/subjects.py:858
+#: models/roles.py:172 models/subjects.py:1312
 msgid "health"
 msgstr ""
 
-#: models/roles.py:173 models/subjects.py:839
-msgid "gender"
+#: models/roles.py:173 models/subjects.py:1332 models/subjects.py:1456
+msgid "additional answers"
 msgstr ""
 
-#: models/roles.py:165 models/subjects.py:1189
-msgid "male / boy"
+#: models/roles.py:177 models/subjects.py:1337
+#: templates/leprikon/registration_payment_request/subject.rml:125
+#: templates/leprikon/registration_payment_request/subject.rml:147
+#: templates/leprikon/registration_recipe.rml:12
+msgid "participant"
 msgstr ""
 
-#: models/roles.py:165 models/subjects.py:1189
-msgid "female / girl"
+#: models/roles.py:181
+#, python-brace-format
+msgid "{first_name} {last_name} ({birth_date})"
 msgstr ""
 
-#: models/roles.py:178 models/subjects.py:882 models/subjects.py:905
-#: templates/leprikon/payment_pdf/recipe.rml:67
-msgid "participant"
-msgid_plural "participants"
-msgstr[0] ""
-msgstr[1] ""
+#: models/roles.py:227 models/subjects.py:1505
+#: templates/leprikon/registration_payment_request/subject.rml:83
+#: templates/leprikon/registration_payment_request/subject.rml:128
+#: templates/leprikon/registration_payment_request/subject.rml:150
+#: templates/leprikon/registration_recipe.rml:18
+msgid "contact person"
+msgstr ""
 
-#: models/roles.py:183
-#, python-brace-format
-msgid "{first_name} {last_name} ({birth_num})"
+#: models/roles.py:230 models/subjects.py:1508
+msgid "employee ID"
 msgstr ""
 
-#: models/roles.py:197
-msgid "You have already entered participant with this birth number"
+#: models/roles.py:235 models/roles.py:236 models/subjects.py:1512
+#: models/subjects.py:1513
+msgid "billing information"
 msgstr ""
 
-#: models/roles.py:264 models/roles.py:265
+#: models/roles.py:283 models/roles.py:284
 msgid "Selected subject is not in the selected school year."
 msgstr ""
 
-#: models/school.py:17
+#: models/school.py:15
 msgid "schools"
 msgstr ""
 
 #: models/schoolyear.py:30
 msgid "year"
 msgstr ""
 
@@ -1551,492 +2237,764 @@
 msgid "period name"
 msgstr ""
 
 #: models/schoolyear.py:66
 msgid "school year divisions"
 msgstr ""
 
-#: models/schoolyear.py:115
+#: models/schoolyear.py:113
 msgid "school year period"
 msgstr ""
 
-#: models/schoolyear.py:116
+#: models/schoolyear.py:114
 msgid "school year periods"
 msgstr ""
 
-#: models/schoolyear.py:119
+#: models/schoolyear.py:117
 msgid "{name}, {start:%m/%d %y} - {end:%m/%d %y}"
 msgstr ""
 
-#: models/startend.py:9
-msgid "Start must be before end"
+#: models/schoolyear.py:129
+msgid "Which school years should the block be visible for?"
 msgstr ""
 
 #: models/startend.py:10
+msgid "Start must be before end"
+msgstr ""
+
+#: models/startend.py:11
 msgid "End must be later than start"
 msgstr ""
 
-#: models/subjects.py:64
+#: models/subjects.py:59
+msgid ""
+"Hello,\n"
+"thank You for submitting the registration.\n"
+"We will inform you about its further processing."
+msgstr ""
+
+#: models/subjects.py:63
+msgid ""
+"Hello,\n"
+"we are pleased to inform You, that Your registration was approved.\n"
+"We are looking forward to see You."
+msgstr ""
+
+#: models/subjects.py:68
+msgid ""
+"Hello,\n"
+"we are sorry to inform You, that Your registration was refused."
+msgstr ""
+
+#: models/subjects.py:72
+msgid ""
+"Hello,\n"
+"we'd like to ask You to pay for Your registration.\n"
+"If You have already made the payment recently, please ignore this message."
+msgstr ""
+
+#: models/subjects.py:77
+msgid ""
+"Hello,\n"
+"Your registration has been overpaid.\n"
+"Please, tell us how you wish us to refund."
+msgstr ""
+
+#: models/subjects.py:79
+msgid ""
+"Hello,\n"
+"Your registration was canceled."
+msgstr ""
+
+#: models/subjects.py:80
+msgid ""
+"Hello,\n"
+"we have just grated a discount for Your registration."
+msgstr ""
+
+#: models/subjects.py:82
+msgid ""
+"Hello,\n"
+"we have just received Your payment. Thank You.\n"
+"Please see the recipe attached."
+msgstr ""
+
+#: models/subjects.py:85
+msgid ""
+"Hello,\n"
+"we have just returned Your payment. Thank You.\n"
+"Please see the recipe attached."
+msgstr ""
+
+#: models/subjects.py:103
 msgid "course type"
 msgstr ""
 
-#: models/subjects.py:65
+#: models/subjects.py:104
 msgid "event type"
 msgstr ""
 
-#: models/subjects.py:67 models/subjects.py:232
-msgid "subjects"
+#: models/subjects.py:105
+msgid "orderable event type"
 msgstr ""
 
-#: models/subjects.py:68
+#: models/subjects.py:109
 msgid "name (singular)"
 msgstr ""
 
-#: models/subjects.py:69
+#: models/subjects.py:110
 msgid "name (genitiv)"
 msgstr ""
 
-#: models/subjects.py:70
+#: models/subjects.py:111
 msgid "name (akuzativ)"
 msgstr ""
 
-#: models/subjects.py:71
+#: models/subjects.py:112
 msgid "name (plural)"
 msgstr ""
 
-#: models/subjects.py:76 models/subjects.py:218
+#: models/subjects.py:121
+msgid ""
+"Select page, where the subjects will be listed. New subject type requireds "
+"new page. If You assign an existing page, the current content of the page "
+"will be replaced with the new subject list."
+msgstr ""
+
+#: models/subjects.py:132 models/subjects.py:430
 msgid "Add additional questions to be asked in the registration form."
 msgstr ""
 
-#: models/subjects.py:79 models/subjects.py:220
+#: models/subjects.py:138 models/subjects.py:436
 msgid "additional legal agreements"
 msgstr ""
 
-#: models/subjects.py:80
+#: models/subjects.py:139
 msgid "Add additional legal agreements specific to this subject type."
 msgstr ""
 
-#: models/subjects.py:85 models/subjects.py:226
+#: models/subjects.py:147 models/subjects.py:445 models/subjects.py:454
+msgid "registration print setup"
+msgstr ""
+
+#: models/subjects.py:155
+msgid "decision print setup"
+msgstr ""
+
+#: models/subjects.py:163 models/subjects.py:463
+msgid "payment request print setup"
+msgstr ""
+
+#: models/subjects.py:171 models/subjects.py:472
 msgid "payment print setup"
 msgstr ""
 
-#: models/subjects.py:90 models/subjects.py:113 models/subjects.py:132
-#: models/subjects.py:168
-msgid "subject type"
+#: models/subjects.py:177 models/subjects.py:484
+msgid "text: registration received"
+msgstr ""
+
+#: models/subjects.py:183 models/subjects.py:485
+msgid "text: registration approved"
+msgstr ""
+
+#: models/subjects.py:189 models/subjects.py:486
+msgid "text: registration refused"
+msgstr ""
+
+#: models/subjects.py:195 models/subjects.py:487
+msgid "text: registration payment request"
+msgstr ""
+
+#: models/subjects.py:201 models/subjects.py:488
+msgid "text: registration refund offer"
+msgstr ""
+
+#: models/subjects.py:207 models/subjects.py:489
+msgid "text: registration canceled"
+msgstr ""
+
+#: models/subjects.py:213 models/subjects.py:490
+msgid "text: discount granted"
 msgstr ""
 
-#: models/subjects.py:91
+#: models/subjects.py:219 models/subjects.py:491
+msgid "text: payment received"
+msgstr ""
+
+#: models/subjects.py:225 models/subjects.py:492
+msgid "text: payment returned"
+msgstr ""
+
+#: models/subjects.py:235
 msgid "subject types"
 msgstr ""
 
-#: models/subjects.py:129
+#: models/subjects.py:286
+msgid "The attachment will be available before registration."
+msgstr ""
+
+#: models/subjects.py:289
+msgid "send when"
+msgstr ""
+
+#: models/subjects.py:292
+msgid "registration received"
+msgstr ""
+
+#: models/subjects.py:293
+msgid "registration approved"
+msgstr ""
+
+#: models/subjects.py:294
+msgid "registration refused"
+msgstr ""
+
+#: models/subjects.py:297
+msgid "registration canceled"
+msgstr ""
+
+#: models/subjects.py:298
+msgid "discount granted"
+msgstr ""
+
+#: models/subjects.py:299
+msgid "payment received"
+msgstr ""
+
+#: models/subjects.py:300
+msgid "payment returned"
+msgstr ""
+
+#: models/subjects.py:303
+msgid "The attachment will be sent with notification on selected events."
+msgstr ""
+
+#: models/subjects.py:326
 msgid "plural"
 msgstr ""
 
-#: models/subjects.py:130
+#: models/subjects.py:327
 msgid "color"
 msgstr ""
 
-#: models/subjects.py:137
+#: models/subjects.py:334
 msgid "subject group"
 msgstr ""
 
-#: models/subjects.py:138
+#: models/subjects.py:335
 msgid "subject groups"
 msgstr ""
 
-#: models/subjects.py:170
-msgid "accounting code"
-msgstr ""
-
-#: models/subjects.py:175
+#: models/subjects.py:368 models/subjects.py:390
 msgid "groups"
 msgstr ""
 
-#: models/subjects.py:180 models/targetgroup.py:18
-msgid "target groups"
+#: models/subjects.py:378
+msgid "registration type"
 msgstr ""
 
-#: models/subjects.py:182 models/subjects.py:443 models/subjects.py:569
-msgid "price"
-msgstr ""
-
-#: models/subjects.py:184
-msgid "registration active from"
+#: models/subjects.py:379
+msgid "accounting code"
 msgstr ""
 
-#: models/subjects.py:185
-msgid "registration active to"
+#: models/subjects.py:397 models/subjects.py:708 models/subjects.py:745
+msgid "price"
 msgstr ""
 
-#: models/subjects.py:191
+#: models/subjects.py:404
 msgid "minimal participants count per registration"
 msgstr ""
 
-#: models/subjects.py:193 models/subjects.py:198
+#: models/subjects.py:406 models/subjects.py:411
 msgid ""
 "Participant details include birth number (birth day), age group, contacts, "
 "parent, etc."
 msgstr ""
 
-#: models/subjects.py:196
+#: models/subjects.py:409
 msgid "maximal participants count per registration"
 msgstr ""
 
-#: models/subjects.py:201
+#: models/subjects.py:414
 msgid "minimal group members count per registration"
 msgstr ""
 
-#: models/subjects.py:203 models/subjects.py:208
+#: models/subjects.py:415 models/subjects.py:419
 msgid "Group member details only include name and note."
 msgstr ""
 
-#: models/subjects.py:206
+#: models/subjects.py:418
 msgid "maximal group members count per registration"
 msgstr ""
 
-#: models/subjects.py:210
+#: models/subjects.py:421
 msgid "minimal registrations count"
 msgstr ""
 
-#: models/subjects.py:211
+#: models/subjects.py:422
 msgid "maximal registrations count"
 msgstr ""
 
-#: models/subjects.py:212
-msgid "risks"
+#: models/subjects.py:423
+msgid "minimal number of days to due date"
 msgstr ""
 
-#: models/subjects.py:213
-msgid "plan"
+#: models/subjects.py:424 models/subjects.py:801 models/subjects.py:1473
+#: models/transaction.py:117
+msgid "note"
 msgstr ""
 
-#: models/subjects.py:214
-msgid "evaluation"
+#: models/subjects.py:437
+msgid "Add additional legal agreements specific for this subject."
 msgstr ""
 
-#: models/subjects.py:215 models/subjects.py:590 models/subjects.py:1010
-#: models/subjects.py:1093
-msgid "note"
+#: models/subjects.py:446 models/subjects.py:455 models/subjects.py:464
+#: models/subjects.py:473 models/subjects.py:482
+msgid "Only use to set value specific for this subject."
 msgstr ""
 
-#: models/subjects.py:221
-msgid "Add additional legal agreements specific for this subject."
+#: models/subjects.py:590 templatetags/leprikon_tags.py:146
+msgid "Registering will start on {}."
 msgstr ""
 
-#: models/subjects.py:308
+#: models/subjects.py:592 templatetags/leprikon_tags.py:133
+msgid "Registering ended on {}"
+msgstr ""
+
+#: models/subjects.py:593 templatetags/leprikon_tags.py:130
+msgid "Registering is currently not allowed."
+msgstr ""
+
+#: models/subjects.py:612
+msgid "age groups list"
+msgstr ""
+
+#: models/subjects.py:616
 msgid "groups list"
 msgstr ""
 
-#: models/subjects.py:312
+#: models/subjects.py:620
 msgid "leaders list"
 msgstr ""
 
-#: models/subjects.py:441
+#: models/subjects.py:624
+msgid "target groups list"
+msgstr ""
+
+#: models/subjects.py:706
 msgid "variant name"
 msgstr ""
 
-#: models/subjects.py:442
+#: models/subjects.py:707
 msgid "variant description"
 msgstr ""
 
-#: models/subjects.py:449 models/subjects.py:567
+#: models/subjects.py:714 models/subjects.py:743
 msgid "variant"
 msgstr ""
 
-#: models/subjects.py:450
+#: models/subjects.py:715
 msgid "variants"
 msgstr ""
 
-#: models/subjects.py:562
-msgid "time of registration"
-msgstr ""
-
-#: models/subjects.py:571 models/targetgroup.py:17
-msgid "target group"
-msgstr ""
-
-#: models/subjects.py:573 templates/leprikon/payment_pdf/recipe.rml:60
-msgid "group name"
+#: models/subjects.py:754
+msgid "created by"
 msgstr ""
 
-#: models/subjects.py:586
-msgid "time of approval"
+#: models/subjects.py:763
+msgid "approved by"
 msgstr ""
 
-#: models/subjects.py:587
-msgid "payment request time"
+#: models/subjects.py:772 models/subjects.py:781
+msgid "payment requested by"
 msgstr ""
 
-#: models/subjects.py:588
-msgid "time of cancellation"
+#: models/subjects.py:790
+msgid "cancelation requested by"
 msgstr ""
 
-#: models/subjects.py:589
-msgid "cancel request"
+#: models/subjects.py:799
+msgid "canceled by"
 msgstr ""
 
-#: models/subjects.py:596 templates/leprikon/payment_pdf/recipe.rml:30
-msgid "variable symbol"
+#: models/subjects.py:865 models/subjects.py:869 models/subjects.py:1478
+msgid "group members"
 msgstr ""
 
-#: models/subjects.py:660 models/subjects.py:664 models/subjects.py:1015
-msgid "group members"
+#: models/subjects.py:1105
+#, python-brace-format
+msgid ""
+"Unfortunately, it is not possible to restore canceled registration {r}. "
+"Please create new one."
 msgstr ""
 
-#: models/subjects.py:762 views/subjects.py:193
+#: models/subjects.py:1107
 #, python-brace-format
-msgid "Registration for {subject_type} {subject}"
+msgid "The registration {r} has already been approved."
 msgstr ""
 
-#: models/subjects.py:763
+#: models/subjects.py:1159
 #, python-brace-format
-msgid "Registration for {subject_type} {subject} - payment request"
+msgid "The registration {r} has already been refued."
 msgstr ""
 
-#: models/subjects.py:764
+#: models/subjects.py:1163
 #, python-brace-format
-msgid "Registration for {subject_type} {subject} was approved"
+msgid ""
+"Unfortunately, it is not possible to refuse the registration {r}. However, "
+"You may cancel it."
 msgstr ""
 
-#: models/subjects.py:765
+#: models/subjects.py:1176
 #, python-brace-format
-msgid "Registration for {subject_type} {subject} was refused"
+msgid "The registration {r} has already been canceled."
 msgstr ""
 
-#: models/subjects.py:766
+#: models/subjects.py:1180
 #, python-brace-format
-msgid "Registration for {subject_type} {subject} was canceled"
+msgid ""
+"Unfortunately, it is not possible to cancel the registration {r}. However, "
+"You may refuse it."
 msgstr ""
 
-#: models/subjects.py:860 models/subjects.py:917
+#: models/subjects.py:1314 models/subjects.py:1354
 msgid "first parent"
 msgstr ""
 
-#: models/subjects.py:869 models/subjects.py:925
+#: models/subjects.py:1323 models/subjects.py:1362
 msgid "second parent"
 msgstr ""
 
-#: models/subjects.py:878
-msgid "additional answers"
+#: models/subjects.py:1440 models/targetgroup.py:15
+msgid "target group"
 msgstr ""
 
-#: models/subjects.py:1014
-msgid "group member"
+#: models/subjects.py:1442
+#: templates/leprikon/registration_payment_request/subject.rml:129
+#: templates/leprikon/registration_payment_request/subject.rml:151
+#: templates/leprikon/registration_recipe.rml:21
+msgid "group name"
 msgstr ""
 
-#: models/subjects.py:1037
-msgid "Amount can not be zero."
+#: models/subjects.py:1460
+msgid "registered group"
 msgstr ""
 
-#: models/subjects.py:1042
-msgid "Date must be after the last account closure ({})."
+#: models/subjects.py:1461
+msgid "registered groups"
 msgstr ""
 
-#: models/subjects.py:1051 models/subjects.py:1090
-msgid "accounted time"
+#: models/subjects.py:1477
+msgid "group member"
 msgstr ""
 
-#: models/subjects.py:1052 models/subjects.py:1058
-#: templates/leprikon/registration_payments.html:44
+#: models/subjects.py:1525 models/subjects.py:1531
+#: templates/leprikon/registration_payments.html:31
+#: templates/leprikon/registration_payments.html:39
 msgid "discount"
 msgstr ""
 
-#: models/subjects.py:1053
+#: models/subjects.py:1526
 msgid "discount explanation"
 msgstr ""
 
-#: models/subjects.py:1059 templates/leprikon/summary.html:23
-msgid "discounts"
+#: models/subjects.py:1592
+msgid "payment"
+msgstr ""
+
+#: models/subjects.py:1593
+msgid "payments"
+msgstr ""
+
+#: models/subjects.py:1615
+msgid "received payment"
+msgstr ""
+
+#: models/subjects.py:1622 models/transaction.py:138
+msgid "target registration"
+msgstr ""
+
+#: models/subjects.py:1634
+msgid "returned payment"
+msgstr ""
+
+#: models/subjects.py:1641 models/transaction.py:129
+msgid "source registration"
+msgstr ""
+
+#: models/subjects.py:1664
+msgid "received online payment"
+msgstr ""
+
+#: models/subjects.py:1747
+msgid "imported from account statement"
+msgstr ""
+
+#: models/times.py:23
+msgid "day of week"
+msgstr ""
+
+#: models/times.py:36
+msgid "{day}, {start:%H:%M} - {end:%H:%M}"
+msgstr ""
+
+#: models/times.py:42
+msgid "{day}, {start:%H:%M}"
+msgstr ""
+
+#: models/timesheets.py:40
+msgid "timesheet period"
+msgstr ""
+
+#: models/timesheets.py:41
+msgid "timesheet periods"
+msgstr ""
+
+#: models/timesheets.py:72
+msgid "submitted"
+msgstr ""
+
+#: models/timesheets.py:73 models/utils.py:78
+msgid "paid"
+msgstr ""
+
+#: models/timesheets.py:82
+msgid "timesheets"
+msgstr ""
+
+#: models/timesheets.py:130
+msgid "timesheet entry type"
+msgstr ""
+
+#: models/timesheets.py:131
+msgid "timesheet entry types"
+msgstr ""
+
+#: models/timesheets.py:146
+msgid "entry type"
+msgstr ""
+
+#: models/timesheets.py:151
+msgid "work description"
 msgstr ""
 
-#: models/subjects.py:1077
+#: models/timesheets.py:156
+msgid "timesheet entry"
+msgstr ""
+
+#: models/timesheets.py:157
+msgid "timesheet entries"
+msgstr ""
+
+#: models/transaction.py:39
+msgid "accounted by"
+msgstr ""
+
+#: models/transaction.py:48
+msgid "last updated by"
+msgstr ""
+
+#: models/transaction.py:66
+msgid "Amount can not be zero."
+msgstr ""
+
+#: models/transaction.py:71
+msgid "Date must be after the last account closure ({})."
+msgstr ""
+
+#: models/transaction.py:90
 msgid "payment - cash"
 msgstr ""
 
-#: models/subjects.py:1078
+#: models/transaction.py:91
 msgid "payment - bank"
 msgstr ""
 
-#: models/subjects.py:1079
+#: models/transaction.py:92
 msgid "payment - online"
 msgstr ""
 
-#: models/subjects.py:1080
-msgid "payment - transfer from return"
+#: models/transaction.py:93
+msgid "returned payment - cash"
 msgstr ""
 
-#: models/subjects.py:1081
-msgid "return - cash"
+#: models/transaction.py:94
+msgid "returned payment - bank"
 msgstr ""
 
-#: models/subjects.py:1082
-msgid "return - bank"
+#: models/transaction.py:95
+msgid "transfer between registrations"
 msgstr ""
 
-#: models/subjects.py:1083
-msgid "return - transfer to payment"
+#: models/transaction.py:96
+msgid "donation - cash"
 msgstr ""
 
-#: models/subjects.py:1091 models/subjects.py:1121
-#: templates/leprikon/payment_pdf/recipe.rml:43
-msgid "payment type"
+#: models/transaction.py:97
+msgid "donation - bank"
 msgstr ""
 
-#: models/subjects.py:1092
-msgid "positive value for payment, negative value for return"
+#: models/transaction.py:98
+msgid "donation - online"
 msgstr ""
 
-#: models/subjects.py:1094
-msgid "related payment"
+#: models/transaction.py:99
+msgid "transfer from registration to donation"
 msgstr ""
 
-#: models/subjects.py:1097
-msgid "bank account transaction"
+#: models/transaction.py:115 models/transaction.py:244
+#: templates/leprikon/received_payment_pdf/recipe.rml:43
+#: templates/leprikon/returned_payment_pdf/recipe.rml:43
+msgid "payment type"
 msgstr ""
 
-#: models/subjects.py:1099
-msgid "online payment"
+#: models/transaction.py:120
+msgid "mail sent"
 msgstr ""
 
-#: models/subjects.py:1102
-msgid "received by"
+#: models/transaction.py:130
+msgid "The payment will be deducted from this registration."
 msgstr ""
 
-#: models/subjects.py:1107
-msgid "payment"
+#: models/transaction.py:139
+msgid "The payment will be added to this registration."
 msgstr ""
 
-#: models/subjects.py:1108
-msgid "payments"
+#: models/transaction.py:149
+msgid "donor user"
 msgstr ""
 
-#: models/subjects.py:1141
-#, python-brace-format
-msgid "Registration for {subject_type} {subject} - payment confirmation"
+#: models/transaction.py:166
+msgid "bank account transaction"
+msgstr ""
+
+#: models/transaction.py:175
+msgid "online payment"
+msgstr ""
+
+#: models/transaction.py:181
+msgid "transaction"
 msgstr ""
 
-#: models/subjects.py:1162
-msgid "Payment can only have one relation."
+#: models/transaction.py:182
+msgid "transactions"
 msgstr ""
 
-#: models/subjects.py:1185
+#: models/transaction.py:227
 #, python-brace-format
-msgid "Payment type must be {valid_payment_type}."
+msgid "This field is mandatory for transaction type {transaction_type}."
 msgstr ""
 
-#: models/subjects.py:1191
+#: models/transaction.py:234
 #, python-brace-format
-msgid "Amount must be {valid_amount}."
+msgid "This field is forbidden for transaction type {transaction_type}."
 msgstr ""
 
-#: models/subjects.py:1222
-msgid "received online payment"
+#: models/useragreement.py:15
+msgid "time of agreement"
 msgstr ""
 
-#: models/subjects.py:1247
-msgid "imported from account statement"
+#: models/utils.py:71
+msgid "amount due {}"
 msgstr ""
 
-#: models/timesheets.py:42
-msgid "timesheet period"
+#: models/utils.py:73
+msgid "overdue {}"
 msgstr ""
 
-#: models/timesheets.py:43
-msgid "timesheet periods"
+#: models/utils.py:75
+msgid "{} overpaid"
 msgstr ""
 
-#: models/timesheets.py:75
-msgid "submitted"
+#: models/utils.py:80
+msgid "payment not requested"
 msgstr ""
 
-#: models/timesheets.py:76 models/utils.py:33
-#: templates/leprikon/summary.html:24
-msgid "paid"
+#: models/utils.py:82
+msgid "payment not requested yet"
 msgstr ""
 
-#: models/timesheets.py:85
-msgid "timesheets"
+#: models/utils.py:210
+msgid "Enter a valid account number."
 msgstr ""
 
-#: models/timesheets.py:135
-msgid "timesheet entry type"
+#: models/utils.py:232
+msgid "Keep empty to use default value:"
 msgstr ""
 
-#: models/timesheets.py:136
-msgid "timesheet entry types"
+#: models/utils.py:251
+msgid "Keep empty to use default value: {}"
 msgstr ""
 
-#: models/timesheets.py:147
-msgid "entry type"
+#: site/settings.py:262
+msgid "Czech"
 msgstr ""
 
-#: models/timesheets.py:152
-msgid "work description"
+#: templates/admin/base.html:5
+msgid "View site"
 msgstr ""
 
-#: models/timesheets.py:157
-msgid "timesheet entry"
+#: templates/admin/base.html:10 templates/admin/inc/branding.html:16
+msgid "Documentation"
 msgstr ""
 
-#: models/timesheets.py:158
-msgid "timesheet entries"
+#: templates/admin/change_list.html:13
+msgid "Legend"
 msgstr ""
 
-#: models/useragreement.py:10
-msgid "time of agreement"
+#: templates/admin/change_list.html:21
+msgid "Filter"
 msgstr ""
 
-#: models/utils.py:35
-msgid "{} let to pay"
+#: templates/admin/change_list_results.html:17
+msgid "Remove from sorting"
 msgstr ""
 
-#: models/utils.py:37
-msgid "{} overpaid"
+#: templates/admin/change_list_results.html:18
+#, python-format
+msgid "Sorting priority: %(priority_number)s"
 msgstr ""
 
-#: site/settings.py:230
-msgid "Czech"
+#: templates/admin/change_list_results.html:19
+msgid "Toggle sorting"
 msgstr ""
 
 #: templates/admin/inc/branding.html:5 templates/cms/toolbar/items/logo.html:4
 msgid "Version"
 msgstr ""
 
 #: templates/admin/inc/branding.html:7 templates/admin/inc/branding.html:10
 msgid "Django Administration"
 msgstr ""
 
-#: templates/admin/inc/branding.html:16
-msgid "Documentation"
-msgstr ""
-
 #: templates/admin/inc/branding.html:37
 msgid "Open"
 msgstr ""
 
 #: templates/admin/leprikon/coursediscount/popup_response.html:3
 #: templates/admin/leprikon/eventdiscount/popup_response.html:3
-#: templates/admin/leprikon/subjectpayment/popup_response.html:3
+#: templates/admin/leprikon/orderablediscount/popup_response.html:3
+#: templates/admin/leprikon/subjectreceivedpayment/popup_response.html:3
+#: templates/admin/leprikon/subjectreturnedpayment/popup_response.html:3
 msgid "Popup closing..."
 msgstr ""
 
-#: templates/admin/leprikon/message/add_recipients.html:12 views/generic.py:38
+#: templates/admin/leprikon/message/add_recipients.html:12 views/generic.py:37
 msgid "add"
 msgstr ""
 
 #: templates/admin/leprikon/message/add_recipients.html:13
-#: templates/leprikon/subject_journal.html:104
+#: templates/leprikon/journal_journal.html:104
 msgid "back"
 msgstr ""
 
 #: templates/admin/leprikon/messagerecipient/change_list.html:6
 #: templates/admin/leprikon/messagerecipient/send_mails.html:32
 #: templates/leprikon/admin/action_form.html:8
-#: templates/leprikon/admin/change_form.html:7
+#: templates/leprikon/admin/bulk_update_form.html:7
 #: templates/leprikon/admin/merge.html:8
 #: templates/leprikon/admin/send_message.html:8
 msgid "Home"
 msgstr ""
 
 #: templates/admin/leprikon/messagerecipient/send_mails.html:42
 msgid "Start sending"
@@ -2050,43 +3008,72 @@
 msgid "sending"
 msgstr ""
 
 #: templates/admin/leprikon/messagerecipient/send_mails.html:67
 msgid "failed"
 msgstr ""
 
-#: templates/leprikon/admin/action_form.html:23
-#: templates/leprikon/admin/change_form.html:28
+#: templates/leprikon/admin/action_form.html:26
+#: templates/leprikon/admin/bulk_update_form.html:30
 msgid "Continue"
 msgstr ""
 
-#: templates/leprikon/admin/action_form.html:24
-#: templates/leprikon/admin/change_form.html:29
+#: templates/leprikon/admin/action_form.html:27
+#: templates/leprikon/admin/bulk_update_form.html:31
 msgid "Cancel"
 msgstr ""
 
+#: templates/leprikon/admin/dashboard.html:22
+msgid "Account closures"
+msgstr ""
+
+#: templates/leprikon/admin/dashboard.html:41
+msgid "Journals"
+msgstr ""
+
+#: templates/leprikon/admin/dashboard.html:46
+#: templates/leprikon/reports/course_payments_status.html:19
+#: templates/leprikon/reports/event_payments_status.html:19
+#: templates/leprikon/reports/orderable_payments_status.html:19
+msgid "Received payments"
+msgstr ""
+
+#: templates/leprikon/admin/dashboard.html:51
+#: templates/leprikon/reports/course_payments_status.html:20
+#: templates/leprikon/reports/event_payments_status.html:20
+#: templates/leprikon/reports/orderable_payments_status.html:20
+msgid "Returned payments"
+msgstr ""
+
+#: templates/leprikon/admin/dashboard.html:56
+#: templates/leprikon/reports/course_payments_status.html:17
+#: templates/leprikon/reports/event_payments_status.html:17
+#: templates/leprikon/reports/orderable_payments_status.html:17
+msgid "Discounts"
+msgstr ""
+
 #: templates/leprikon/admin/merge.html:32
 msgid "Yes, I'm sure"
 msgstr ""
 
 #: templates/leprikon/admin/merge.html:33
 msgid "No, take me back"
 msgstr ""
 
 #: templates/leprikon/admin/send_message.html:23
 msgid "Send"
 msgstr ""
 
-#: templates/leprikon/admin/send_message.html:24 views/generic.py:82
-#: views/user.py:116
+#: templates/leprikon/admin/send_message.html:24 views/generic.py:86
+#: views/user.py:111
 msgid "Back"
 msgstr ""
 
 #: templates/leprikon/alternating.html:16
-#: templates/leprikon/timesheet_detail.html:21
+#: templates/leprikon/timesheet_detail.html:26
 msgid "start"
 msgstr ""
 
 #: templates/leprikon/alternating.html:17
 msgid "end"
 msgstr ""
 
@@ -2094,161 +3081,297 @@
 msgid "edit timesheet entry"
 msgstr ""
 
 #: templates/leprikon/alternating.html:33
 msgid "edit course journal entry"
 msgstr ""
 
-#: templates/leprikon/base.html:82
-msgid "OK"
+#: templates/leprikon/base.html:79
+msgid "Powered by Leprikón Information System"
 msgstr ""
 
-#: templates/leprikon/base.html:104
-msgid "Powered by Leprikón Information System"
+#: templates/leprikon/billing_info_preview.html:12
+#: templates/leprikon/journal_journal.html:141
+#: templates/leprikon/journal_journal.html:235
+#: templates/leprikon/journal_preview.html:14
+#: templates/leprikon/parent_preview.html:12
+#: templates/leprikon/participant_preview.html:12
+#: templates/leprikon/timesheet_detail.html:48
+msgid "delete"
+msgstr ""
+
+#: templates/leprikon/billing_info_preview.html:18
+#: templates/leprikon/participant_preview.html:24
+#: templates/leprikon/registration_details.html:50
+#: templates/leprikon/registration_details.html:115
+#: templates/leprikon/registration_pdf/subject.rml:124
+#: templates/leprikon/registration_pdf/subject.rml:195
+#: templates/leprikon/registration_pdf/subject.rml:239
+msgid "Address"
+msgstr ""
+
+#: templates/leprikon/billing_info_preview.html:21
+msgid "Company number"
 msgstr ""
 
 #: templates/leprikon/cms/course_list_filtered.html:20
 #: templates/leprikon/cms/course_list_filtered.html:30
 #: templates/leprikon/cms/event_list_filtered.html:20
 #: templates/leprikon/cms/leader_list_filtered.html:22
+#: templates/leprikon/cms/orderable_list_filtered.html:20
 #: templates/leprikon/filtered_subject_list.html:36
 #: templates/leprikon/filtered_subject_list.html:46
-#: templates/leprikon/journalentry_form.html:22
-#: templates/leprikon/journalentry_form.html:31
-#: templates/leprikon/journalentry_form.html:41
+#: templates/leprikon/journalentry_form.html:21
+#: templates/leprikon/journalentry_form.html:32
+#: templates/leprikon/journalentry_form.html:44
+#: templates/leprikon/journalentry_form.html:56
 #: templates/leprikon/leader_list.html:18
+#: templates/leprikon/reports/course_stats.html:67
+#: templates/leprikon/reports/event_stats.html:63
+#: templates/leprikon/reports/index.html:58
+#: templates/leprikon/reports/orderable_stats.html:63
 #: templates/leprikon/subject_list.html:18
 #: templates/leprikon/subject_list.html:28
 msgid "selected"
 msgstr ""
 
-#: templates/leprikon/cms/event_list/default.html:38
-#: templates/leprikon/cms/event_list/grouped.html:40
-#: templates/leprikon/registration_payment_request/subject.html:15
-#: templates/leprikon/registration_payment_request/subject.txt:7
-#: templates/leprikon/registration_payments.html:4
-#: templates/leprikon/registration_pdf/subject.rml:58
-#: templates/leprikon/reports/course_payments_status.html:15
-#: templates/leprikon/reports/event_payments_status.html:15
-#: templates/leprikon/subject_registration_form.html:23
-#: templates/leprikon/subject_registration_form.html:59
-msgid "Price"
-msgstr ""
-
-#: templates/leprikon/cms/event_list/default.html:46
-#: templates/leprikon/cms/event_list/grouped.html:48
-#: templates/leprikon/subject_preview.html:72
-msgid "Led by"
-msgid_plural "Led by"
-msgstr[0] ""
-msgstr[1] ""
-
-#: templates/leprikon/cms/event_list/default.html:53
-#: templates/leprikon/cms/event_list/grouped.html:55
-#: templates/leprikon/messagerecipient_detail.html:20
-#: templates/leprikon/subject_preview.html:79
-msgid "Attachments"
+#: templates/leprikon/cms/leader_list/default.html:25
+#: templates/leprikon/leader_preview.html:28
+#: templates/leprikon/participant_preview.html:30
+#: templates/leprikon/registration_details.html:57
+#: templates/leprikon/registration_details.html:122
+#: templates/leprikon/registration_pdf/subject.rml:199
+msgid "Contact"
 msgstr ""
 
-#: templates/leprikon/cms/event_list/default.html:65
-#: templates/leprikon/cms/event_list/grouped.html:67
 #: templates/leprikon/cms/leader_list/default.html:38
 #: templates/leprikon/leader_preview.html:41
-#: templates/leprikon/subject_preview.html:91
+#: templates/leprikon/subject_preview.html:89
 msgid "More information"
 msgstr ""
 
-#: templates/leprikon/cms/leader_list/default.html:25
-#: templates/leprikon/leader_preview.html:28
-#: templates/leprikon/participant_preview.html:35
-#: templates/leprikon/registration_details.html:35
-#: templates/leprikon/registration_details.html:98
-#: templates/leprikon/registration_pdf/subject.rml:187
-msgid "Contact"
-msgstr ""
-
 #: templates/leprikon/cms/leader_list_filtered.html:18
-#: templates/leprikon/journalentry_form.html:16
-#: templates/leprikon/journalentry_form.html:36
+#: templates/leprikon/journalentry_form.html:26
+#: templates/leprikon/journalentry_form.html:37
+#: templates/leprikon/journalentry_form.html:49
 #: templates/leprikon/leader_list.html:14
 #: templates/leprikon/subject_list.html:14
 msgid "Search"
 msgstr ""
 
 #: templates/leprikon/course_registrations.html:6
+#: templates/leprikon/event_registrations.html:6
+#: templates/leprikon/orderable_registrations.html:6
 #, python-format
-msgid "Registrations for course %(name)s"
+msgid "Registrations for %(subject_type)s %(name)s"
 msgstr ""
 
 #: templates/leprikon/course_registrations.html:8
 #: templates/leprikon/event_registrations.html:8
+#: templates/leprikon/orderable_registrations.html:8
 msgid "Active Registrations"
 msgstr ""
 
 #: templates/leprikon/course_registrations.html:13
-msgid "There are no active registrations for this course."
+#: templates/leprikon/event_registrations.html:13
+#: templates/leprikon/orderable_registrations.html:13
+#, python-format
+msgid "There are no active registrations for this %(subject_type)s."
 msgstr ""
 
 #: templates/leprikon/course_registrations.html:17
 #: templates/leprikon/event_registrations.html:17
+#: templates/leprikon/orderable_registrations.html:17
 msgid "Unapproved Registrations"
 msgstr ""
 
 #: templates/leprikon/course_registrations.html:25
 #: templates/leprikon/event_registrations.html:25
+#: templates/leprikon/orderable_registrations.html:25
 msgid "Inactive Registrations"
 msgstr ""
 
-#: templates/leprikon/event_registrations.html:6
-#, python-format
-msgid "Registrations for event %(name)s"
+#: templates/leprikon/donation_pdf/recipe.rml:5
+msgid "Receipt for donation"
 msgstr ""
 
-#: templates/leprikon/event_registrations.html:13
-msgid "There are no active registrations for this event."
+#: templates/leprikon/donation_pdf/recipe.rml:6
+#: templates/leprikon/received_payment_pdf/recipe.rml:6
+#: templates/leprikon/returned_payment_pdf/recipe.rml:6
+msgid "recipe number"
+msgstr ""
+
+#: templates/leprikon/donation_pdf/recipe.rml:30
+msgid "donation date"
+msgstr ""
+
+#: templates/leprikon/donation_pdf/recipe.rml:39
+msgid "donation type"
+msgstr ""
+
+#: templates/leprikon/donation_pdf/recipe.rml:56
+msgid "donation received by"
+msgstr ""
+
+#: templates/leprikon/donations.html:9
+msgid "Donation Type"
+msgstr ""
+
+#: templates/leprikon/donations.html:10
+msgid "Organization"
+msgstr ""
+
+#: templates/leprikon/donations.html:11 templates/leprikon/payments.html:17
+#: templates/leprikon/reports/course_payments.html:16
+#: templates/leprikon/reports/event_payments.html:16
+#: templates/leprikon/reports/orderable_payments.html:16
+msgid "Amount"
 msgstr ""
 
 #: templates/leprikon/filter_form.html:15
 #: templates/leprikon/filtered_subject_list.html:15
 msgid "search"
 msgstr ""
 
 #: templates/leprikon/filter_form.html:16
 #: templates/leprikon/filtered_subject_list.html:16
 msgid "cancel search"
 msgstr ""
 
-#: templates/leprikon/form.html:15
-#: templates/leprikon/subject_registration_form.html:15
+#: templates/leprikon/form.html:15 templates/leprikon/login.html:19
+#: templates/leprikon/login.html:46
+#: templates/leprikon/subject_registration_form.html:9
 msgid "Please correct the highlighted errors below."
 msgstr ""
 
-#: templates/leprikon/journalentry_form.html:19
+#: templates/leprikon/journal_journal.html:127
+msgid "Attendance"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:131
+#: templates/leprikon/journal_journal.html:210
+msgid "No."
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:132
+msgctxt "person"
+msgid "Name"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:155
+#: templates/leprikon/journal_journal.html:255
+#: templates/leprikon/timesheet_detail.html:12 views/timesheets.py:14
+msgid "add entry"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:207
+msgid "Agenda"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:212
+#: templates/leprikon/journal_preview.html:23
+#: templates/leprikon/subject_preview.html:48
+msgid "Time"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:213
+msgid "Number of hours"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:214
+msgid "Number of leaders"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:215
+msgid "Number of participants"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:216
+msgid "Session agenda"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:222
+#: templates/leprikon/journal_journal.html:223
+msgid "skipped"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:268
+msgid "Risks"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:284
+msgid "Plan for the activity"
+msgstr ""
+
+#: templates/leprikon/journal_journal.html:299
+msgid "Evaluation of the activity"
+msgstr ""
+
+#: templates/leprikon/journal_journal_pdf/default.rml:36
+msgid "full name"
+msgstr ""
+
+#: templates/leprikon/journal_journal_pdf/default.rml:37
+msgid "birh year"
+msgstr ""
+
+#: templates/leprikon/journal_preview.html:31
+#: templates/leprikon/subject_preview.html:73
+msgid "Led by"
+msgid_plural "Led by"
+msgstr[0] ""
+msgstr[1] ""
+
+#: templates/leprikon/journal_preview.html:43
+msgid "add journal entry"
+msgstr ""
+
+#: templates/leprikon/journalentry_form.html:17
 #: templates/leprikon/journalentry_form.html:28
-#: templates/leprikon/journalentry_form.html:38
+#: templates/leprikon/journalentry_form.html:40
+#: templates/leprikon/journalentry_form.html:52
+#: templates/leprikon/reports/course_stats.html:63
+#: templates/leprikon/reports/event_stats.html:59
+#: templates/leprikon/reports/index.html:54
+#: templates/leprikon/reports/orderable_stats.html:59
 msgid "select all"
 msgstr ""
 
+#: templates/leprikon/journalentry_form.html:19
+#: templates/leprikon/journalentry_form.html:30
+#: templates/leprikon/journalentry_form.html:42
+#: templates/leprikon/journalentry_form.html:54
+#: templates/leprikon/reports/course_stats.html:65
+#: templates/leprikon/reports/event_stats.html:61
+#: templates/leprikon/reports/index.html:56
+#: templates/leprikon/reports/orderable_stats.html:61
+msgid "all"
+msgstr ""
+
 #: templates/leprikon/leader_summary.html:11
 msgid "Timesheets to be submitted"
 msgstr ""
 
-#: templates/leprikon/login.html:6
-msgid "Login"
+#: templates/leprikon/login.html:12
+msgid "Log in with username and password"
 msgstr ""
 
-#: templates/leprikon/login.html:25
+#: templates/leprikon/login.html:39
+msgid "Log in with verified e-mail"
+msgstr ""
+
+#: templates/leprikon/login.html:66
 msgid "Other options"
 msgstr ""
 
-#: templates/leprikon/login.html:35 templates/leprikon/login.html:42
+#: templates/leprikon/login.html:85
 msgid "Log in with Google"
 msgstr ""
 
-#: templates/leprikon/login.html:50
+#: templates/leprikon/login.html:93
 msgid "Log in with Facebook"
 msgstr ""
 
 #: templates/leprikon/message_mail.html:7 templates/leprikon/message_mail.txt:6
 #, python-format
 msgid "Show this message on site %(name)s:"
 msgstr ""
@@ -2257,54 +3380,50 @@
 msgid "Sent"
 msgstr ""
 
 #: templates/leprikon/messagerecipient_detail.html:12
 msgid "Viewed"
 msgstr ""
 
+#: templates/leprikon/messagerecipient_detail.html:20
+#: templates/leprikon/subject_preview.html:80
+msgid "Attachments"
+msgstr ""
+
+#: templates/leprikon/messages_table.html:6
+msgid "Subject"
+msgstr ""
+
+#: templates/leprikon/modal_messages.html:16
+msgid "OK"
+msgstr ""
+
 #: templates/leprikon/pagination.html:4
 msgid "previous"
 msgstr ""
 
 #: templates/leprikon/pagination.html:8
 msgid "next"
 msgstr ""
 
 #: templates/leprikon/pagination.html:13
 #, python-format
 msgid "displaying %(from)s – %(until)s of %(count)s"
 msgstr ""
 
-#: templates/leprikon/parent_preview.html:15
-msgid "Parent has not filled all contact information."
-msgstr ""
-
-#: templates/leprikon/participant_preview.html:15
-msgid "Participant has not filled all contact information."
-msgstr ""
-
-#: templates/leprikon/participant_preview.html:29
-#: templates/leprikon/registration_details.html:28
-#: templates/leprikon/registration_details.html:91
-#: templates/leprikon/registration_pdf/subject.rml:112
-#: templates/leprikon/registration_pdf/subject.rml:183
-#: templates/leprikon/registration_pdf/subject.rml:217
-msgid "Address"
-msgstr ""
-
-#: templates/leprikon/participant_preview.html:47
-#: templates/leprikon/registration_details.html:48
-#: templates/leprikon/registration_pdf/subject.rml:151
+#: templates/leprikon/participant_preview.html:42
+#: templates/leprikon/registration_details.html:72
+#: templates/leprikon/registration_pdf/subject.rml:163
 msgid "Health"
 msgstr ""
 
 #: templates/leprikon/participants.html:7
-#: templates/leprikon/registration_pdf/subject.rml:169
-#: templates/leprikon/registration_preview.html:57
-#: templates/leprikon/subject_registration_form.html:119
+#: templates/leprikon/registration_pdf/subject.rml:181
+#: templates/leprikon/registration_preview.html:69
+#: templates/leprikon/subject_registration_form.html:125
 msgid "Parents"
 msgstr ""
 
 #: templates/leprikon/participants.html:11
 msgid "add parent"
 msgstr ""
 
@@ -2345,720 +3464,886 @@
 #, python-format
 msgid ""
 "You're receiving this email because you requested a password reset for your "
 "user account at %(site_name)s."
 msgstr ""
 
 #: templates/leprikon/password_reset_email.html:4
-msgid "Please go to the following page and choose a new password:"
+msgid "Your username, in case you've forgotten:"
 msgstr ""
 
-#: templates/leprikon/password_reset_email.html:8
-msgid "Your username, in case you've forgotten:"
+#: templates/leprikon/password_reset_email.html:6
+msgid "Please go to the following page and choose a new password:"
 msgstr ""
 
-#: templates/leprikon/password_reset_email.html:10
+#: templates/leprikon/password_reset_email.html:11
 msgid "Thanks for using our site!"
 msgstr ""
 
-#: templates/leprikon/password_reset_email.html:12
+#: templates/leprikon/password_reset_email.html:13
 #, python-format
 msgid "The %(site_name)s team"
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:5
-msgid "Receipt for payment"
+#: templates/leprikon/payments.html:7
+msgid ""
+"Thank You, the online payment was successful. The confirmation will be "
+"available within several minutes."
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:6
-msgid "recipe number"
+#: templates/leprikon/payments.html:9
+msgid ""
+"Unfortunately, the online payment was not successful. Please, try it again "
+"or choose another payment method."
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:15
-msgid "address"
+#: templates/leprikon/payments.html:15
+msgid "Payment Type"
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:34
-msgid "payment date"
+#: templates/leprikon/payments.html:16
+#: templates/leprikon/reports/course_payments.html:15
+#: templates/leprikon/reports/course_payments.html:39
+#: templates/leprikon/reports/event_payments.html:15
+#: templates/leprikon/reports/event_payments.html:39
+#: templates/leprikon/reports/orderable_payments.html:15
+#: templates/leprikon/reports/orderable_payments.html:39
+#: templates/leprikon/summary.html:33
+msgid "Registration"
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:54
-#, python-format
-msgid "name of %(subject_type)s"
+#: templates/leprikon/received_payment_pdf/recipe.rml:5
+msgid "Receipt for payment"
+msgstr ""
+
+#: templates/leprikon/received_payment_pdf/recipe.rml:34
+#: templates/leprikon/returned_payment_pdf/recipe.rml:34
+msgid "payment date"
 msgstr ""
 
-#: templates/leprikon/payment_pdf/recipe.rml:75
+#: templates/leprikon/received_payment_pdf/recipe.rml:58
+#: templates/leprikon/returned_payment_pdf/recipe.rml:58
 msgid "payment received by"
 msgstr ""
 
-#: templates/leprikon/payment_received/subject.html:4
-#: templates/leprikon/payment_received/subject.txt:1
+#: templates/leprikon/received_payment_received/subject.subject.txt:1
+#, python-format
 msgid ""
-"Hello,\n"
-"we have just received Your payment. Please see the recipe attached.\n"
-"\n"
-"Thank You."
+"Registration for %(subject_type)s %(subject)s - received payment confirmation"
 msgstr ""
 
-#: templates/leprikon/payments.html:7
-msgid ""
-"Thank You, the online payment was successful. The confirmation will be "
-"available within several minutes."
+#: templates/leprikon/registration_approved/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was approved"
 msgstr ""
 
-#: templates/leprikon/payments.html:9
-msgid ""
-"Unfortunately, the online payment was not successful. Please, try it again "
-"or choose another payment method."
+#: templates/leprikon/registration_canceled/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was canceled"
 msgstr ""
 
-#: templates/leprikon/payments.html:16
-msgid "Payment Type"
+#: templates/leprikon/registration_decision/subject.rml:41
+#, python-format
+msgid "Reference number: %(reference_number)s"
 msgstr ""
 
-#: templates/leprikon/payments.html:17
-#: templates/leprikon/reports/course_payments.html:16
-#: templates/leprikon/reports/event_payments.html:16
-msgid "Amount"
+#: templates/leprikon/registration_decision/subject.rml:52
+#: templates/leprikon/registration_pdf/subject.rml:54
+#, python-format
+msgid "Name of %(subject_type)s"
 msgstr ""
 
-#: templates/leprikon/registration_approved/subject.html:4
-#: templates/leprikon/registration_approved/subject.txt:1
-#: templates/leprikon/registration_canceled/subject.html:4
-#: templates/leprikon/registration_canceled/subject.txt:1
-msgid ""
-"Hello,\n"
-"we are pleased to inform You, that your registration was approved."
+#: templates/leprikon/registration_decision/subject.rml:62
+#: templates/leprikon/registration_pdf/subject.rml:114
+msgid "Birth number"
 msgstr ""
 
-#: templates/leprikon/registration_approved/subject.html:9
-#: templates/leprikon/registration_approved/subject.txt:4
-#: templates/leprikon/registration_canceled/subject.html:9
-#: templates/leprikon/registration_canceled/subject.txt:4
-msgid "We are looking forward to see You."
+#: templates/leprikon/registration_decision/subject.rml:67
+#: templates/leprikon/registration_details.html:38
+#: templates/leprikon/registration_pdf/subject.rml:119
+msgid "Birth date"
+msgstr ""
+
+#: templates/leprikon/registration_decision/subject.rml:86
+msgid "Decision"
+msgstr ""
+
+#: templates/leprikon/registration_decision/subject.rml:101
+#: templates/leprikon/registration_decision/subject.rml:106
+#, python-format
+msgid "Decision issued by: %(user)s"
+msgstr ""
+
+#: templates/leprikon/registration_decision/subject.rml:103
+#: templates/leprikon/registration_decision/subject.rml:108
+#, python-format
+msgid "Date: %(date)s"
+msgstr ""
+
+#: templates/leprikon/registration_decision/subject.rml:116
+msgid "Received personally on"
+msgstr ""
+
+#: templates/leprikon/registration_decision/subject.rml:117
+#: templates/leprikon/registration_pdf/subject.rml:311
+msgid "Signature"
 msgstr ""
 
 #: templates/leprikon/registration_details.html:4
+#: templates/leprikon/registration_payment_request/subject.rml:46
 #: templates/leprikon/registration_preview.html:5
 msgid "registration number"
 msgstr ""
 
 #: templates/leprikon/registration_details.html:10
-#: templates/leprikon/registration_payment_request/subject.html:12
-#: templates/leprikon/registration_payment_request/subject.txt:6
-#: templates/leprikon/registration_pdf/subject.rml:94
-#: templates/leprikon/registration_preview.html:50
-#: templates/leprikon/subject_registration_form.html:86
-msgid "Participant"
-msgid_plural "Participants"
-msgstr[0] ""
-msgstr[1] ""
-
-#: templates/leprikon/registration_details.html:16
-msgid "Birth date"
+#: templates/leprikon/registration_pdf/subject.rml:69
+#: templates/leprikon/registration_pdf/subject.rml:74
+#: templates/leprikon/registration_preview.html:29
+#: templates/leprikon/subject_registration_form.html:19
+msgid "Event date"
 msgstr ""
 
-#: templates/leprikon/registration_details.html:55
-msgid "Parent"
+#: templates/leprikon/registration_details.html:17
+#: templates/leprikon/registration_preview.html:42
+msgid "Status"
 msgstr ""
 
-#: templates/leprikon/registration_details.html:73
-#: templates/leprikon/registration_payment_request/subject.html:10
-#: templates/leprikon/registration_payment_request/subject.txt:5
-#: templates/leprikon/registration_pdf/subject.rml:205
-#: templates/leprikon/registration_preview.html:68
-msgid "Group name"
+#: templates/leprikon/registration_details.html:20
+#: templates/leprikon/registration_preview.html:46
+#, python-format
+msgid "registration canceled on %(d)s"
 msgstr ""
 
-#: templates/leprikon/registration_details.html:79
-#: templates/leprikon/registration_pdf/subject.rml:209
-#: templates/leprikon/subject_preview.html:65
-msgid "Target group"
-msgid_plural "Target groups"
-msgstr[0] ""
-msgstr[1] ""
+#: templates/leprikon/registration_details.html:22
+#: templates/leprikon/registration_preview.html:51
+#, python-format
+msgid "cancellation requested on %(d)s"
+msgstr ""
 
-#: templates/leprikon/registration_details.html:85
-#: templates/leprikon/registration_pdf/subject.rml:213
-#: templates/leprikon/registration_preview.html:74
-msgid "Group leader"
+#: templates/leprikon/registration_details.html:24
+#: templates/leprikon/registration_preview.html:53
+#, python-format
+msgid "registration approved on %(d)s"
 msgstr ""
 
-#: templates/leprikon/registration_details.html:113
-#: templates/leprikon/registration_pdf/subject.rml:246
-#: templates/leprikon/registration_preview.html:80
-msgid "Group members"
+#: templates/leprikon/registration_details.html:26
+#: templates/leprikon/registration_preview.html:55
+msgid "awaiting approval"
 msgstr ""
 
-#: templates/leprikon/registration_details.html:121
-msgid "Legal agreements"
+#: templates/leprikon/registration_details.html:79
+msgid "Parent"
 msgstr ""
 
-#: templates/leprikon/registration_links.html:9
-msgid "register"
+#: templates/leprikon/registration_details.html:137
+#: templates/leprikon/registration_pdf/subject.rml:264
+#: templates/leprikon/registration_preview.html:92
+msgid "Group members"
 msgstr ""
 
-#: templates/leprikon/registration_links.html:12
-msgid "Registering is currently not allowed."
+#: templates/leprikon/registration_details.html:145
+msgid "Legal agreements"
 msgstr ""
 
-#: templates/leprikon/registration_links.html:13
-msgid "The capacity is full."
+#: templates/leprikon/registration_links.html:9
+msgid "fill in the registration form"
 msgstr ""
 
 #: templates/leprikon/registration_mail_footer.html:3
 #: templates/leprikon/registration_mail_footer.txt:1
 msgid ""
 "You may check the current status of your registrations and payments using "
 "following link:"
 msgstr ""
 
 #: templates/leprikon/registration_participant_presence.html:4
 msgid "Presence"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:4
-#: templates/leprikon/registration_payment_request/subject.txt:1
-#: templates/leprikon/registration_received/subject.html:4
-#: templates/leprikon/registration_received/subject.txt:1
-msgid ""
-"Hello,\n"
-"thank You for submitting registration."
+#: templates/leprikon/registration_payment_request/subject.html:11
+#: templates/leprikon/registration_payment_request/subject.txt:4
+msgid "Period"
 msgstr ""
 
+#: templates/leprikon/registration_payment_request/subject.html:12
+#: templates/leprikon/registration_payment_request/subject.html:19
+#: templates/leprikon/registration_payment_request/subject.txt:5
+#: templates/leprikon/registration_payment_request/subject.txt:7
+#: templates/leprikon/reports/course_payments_status.html:21
+#: templates/leprikon/reports/debtors.html:15
+#: templates/leprikon/reports/event_payments_status.html:21
+#: templates/leprikon/reports/orderable_payments_status.html:21
+msgid "Amount due"
+msgstr ""
+
+#: templates/leprikon/registration_payment_request/subject.html:13
 #: templates/leprikon/registration_payment_request/subject.html:20
-#: templates/leprikon/registration_payment_request/subject.txt:9
+#: templates/leprikon/registration_payment_request/subject.txt:6
+#: templates/leprikon/registration_payment_request/subject.txt:8
+msgid "Due date"
+msgstr ""
+
+#: templates/leprikon/registration_payment_request/subject.html:26
+#: templates/leprikon/registration_payment_request/subject.txt:10
 msgid "Please, use following link to perform online payment"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:27
-#: templates/leprikon/registration_payment_request/subject.txt:12
-#: templates/leprikon/registration_payments.html:57
+#: templates/leprikon/registration_payment_request/subject.html:33
+#: templates/leprikon/registration_payment_request/subject.txt:13
+#: templates/leprikon/registration_payments.html:49
 msgid "Please, use following information for bank transfer"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:28
-#: templates/leprikon/registration_payment_request/subject.txt:13
-#: templates/leprikon/registration_payments.html:58
+#: templates/leprikon/registration_payment_request/subject.html:34
+#: templates/leprikon/registration_payment_request/subject.txt:14
+#: templates/leprikon/registration_payments.html:50
 msgid "Bank account"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:29
-#: templates/leprikon/registration_payment_request/subject.txt:14
-#: templates/leprikon/registration_payments.html:59
+#: templates/leprikon/registration_payment_request/subject.html:35
+#: templates/leprikon/registration_payment_request/subject.txt:15
+#: templates/leprikon/registration_payments.html:51
 msgid "Variable symbol"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:32
-#: templates/leprikon/registration_payments.html:62
+#: templates/leprikon/registration_payment_request/subject.html:38
+#: templates/leprikon/registration_payment_request/subject.rml:172
 msgid ""
-"Or You may use following QR code to scan the payment details to your mobile "
+"You may use following QR code to scan the payment details to your mobile "
 "banking application"
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:38
-#: templates/leprikon/registration_payment_request/subject.txt:16
-#: templates/leprikon/registration_payments.html:67
+#: templates/leprikon/registration_payment_request/subject.html:44
+#: templates/leprikon/registration_payment_request/subject.txt:17
+#: templates/leprikon/registration_payments.html:59
 msgid "Currently we only accept payments in cash."
 msgstr ""
 
-#: templates/leprikon/registration_payment_request/subject.html:42
-#: templates/leprikon/registration_payment_request/subject.txt:18
-msgid ""
-"If You have already made the payment recently, please ignore this message."
+#: templates/leprikon/registration_payment_request/subject.rml:45
+msgid "Payment request"
 msgstr ""
 
-#: templates/leprikon/registration_payments.html:13
-msgid "Discount"
+#: templates/leprikon/registration_payment_request/subject.rml:53
+msgid "provider"
 msgstr ""
 
-#: templates/leprikon/registration_payments.html:51
-msgid "Online payment"
+#: templates/leprikon/registration_payment_request/subject.rml:73
+msgid "payer"
 msgstr ""
 
-#: templates/leprikon/registration_payments.html:52
-msgid "pay online"
+#: templates/leprikon/registration_payment_request/subject.rml:91
+msgid "Employee ID"
 msgstr ""
 
-#: templates/leprikon/registration_payments.html:55
-msgid "Bank transfer"
+#: templates/leprikon/registration_payment_request/subject.rml:112
+msgid "amount due"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:47
+#: templates/leprikon/registration_payment_request/subject.rml:185
+msgid "total amount due"
+msgstr ""
+
+#: templates/leprikon/registration_payment_request/subject.subject.txt:1
 #, python-format
-msgid "Registration for %(subject_type)s"
+msgid "Registration for %(subject_type)s %(subject)s - payment request"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:48
+#: templates/leprikon/registration_payments.html:4
+#: templates/leprikon/registration_pdf/subject.rml:58
+#: templates/leprikon/reports/course_payments_status.html:15
+#: templates/leprikon/reports/event_payments_status.html:15
+#: templates/leprikon/reports/orderable_payments_status.html:15
+#: templates/leprikon/subject_registration_form.html:24
+#: templates/leprikon/subject_registration_form.html:60
+msgid "Price"
+msgstr ""
+
+#: templates/leprikon/registration_payments.html:12
+msgid "Payments status"
+msgstr ""
+
+#: templates/leprikon/registration_payments.html:17
+msgid "payment request"
+msgstr ""
+
+#: templates/leprikon/registration_payments.html:28
+#: templates/leprikon/registration_payments.html:36
 #, python-format
-msgid "in school year %(school_year)s"
+msgid "paid %(received)s"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:54
+#: templates/leprikon/registration_payments.html:29
+#: templates/leprikon/registration_payments.html:37
 #, python-format
-msgid "Name of %(subject_type)s"
+msgid "refunded %(returned)s"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:69
-msgid "Dates of event"
+#: templates/leprikon/registration_payments.html:43
+msgid "Online payment"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:74
-msgid "Periods"
+#: templates/leprikon/registration_payments.html:44
+msgid "pay online"
+msgstr ""
+
+#: templates/leprikon/registration_payments.html:47
+msgid "Bank transfer"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:79
+#: templates/leprikon/registration_payments.html:54
+msgid ""
+"Or You may use following QR code to scan the payment details to your mobile "
+"banking application"
+msgstr ""
+
+#: templates/leprikon/registration_pdf/subject.rml:47
+#, python-format
+msgid "Registration for %(subject_type)s"
+msgstr ""
+
+#: templates/leprikon/registration_pdf/subject.rml:48
+#, python-format
+msgid "in school year %(school_year)s"
+msgstr ""
+
+#: templates/leprikon/registration_pdf/subject.rml:84
 msgid "Times"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:85
+#: templates/leprikon/registration_pdf/subject.rml:90
 msgid "Registration number (variable symbol)"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:100
-#: templates/leprikon/registration_pdf/subject.rml:179
+#: templates/leprikon/registration_pdf/subject.rml:105
+#: templates/leprikon/registration_pdf/subject.rml:191
 msgid "Full name"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:108
-msgid "Birth number"
-msgstr ""
-
-#: templates/leprikon/registration_pdf/subject.rml:116
+#: templates/leprikon/registration_pdf/subject.rml:128
 msgid "Citizenship"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:121
-#: templates/leprikon/registration_pdf/subject.rml:222
+#: templates/leprikon/registration_pdf/subject.rml:133
+#: templates/leprikon/registration_pdf/subject.rml:244
 msgid "Phone"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:137
-#: templates/leprikon/registration_pdf/subject.rml:238
+#: templates/leprikon/registration_pdf/subject.rml:149
+#: templates/leprikon/registration_pdf/subject.rml:226
 msgid "Class"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:252
+#: templates/leprikon/registration_pdf/subject.rml:270
 msgid "First name"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:253
+#: templates/leprikon/registration_pdf/subject.rml:271
 msgid "Last name"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:254
+#: templates/leprikon/registration_pdf/subject.rml:272
+#: templates/leprikon/subject_registration_form.html:233
 msgid "Note"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:291
+#: templates/leprikon/registration_pdf/subject.rml:309
 msgid "In"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:293
+#: templates/leprikon/registration_pdf/subject.rml:311
 msgid "Parent's signature"
 msgstr ""
 
-#: templates/leprikon/registration_pdf/subject.rml:293
-#: templates/leprikon/subject_journal.html:273
-#: templates/leprikon/subject_journal.html:292
-msgid "Signature"
-msgstr ""
-
 #: templates/leprikon/registration_preview.html:13
 msgid "cancel registration"
 msgstr ""
 
 #: templates/leprikon/registration_preview.html:15
 msgid "cancel"
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:28
+#: templates/leprikon/registration_preview.html:36
 msgid "Date and time of registration"
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:34
-msgid "Status"
+#: templates/leprikon/registration_preview.html:48
+#, python-format
+msgid "registration refused on %(d)s"
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:37
+#: templates/leprikon/registration_received/subject.html:7
+#: templates/leprikon/registration_received/subject.txt:3
 #, python-format
-msgid "registration canceled on %(d)s"
+msgid ""
+"Unfortunately, the capacity of this %(subject_type)s has already been "
+"filled.\n"
+"The registration may be refused."
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:39
-msgid "cancellation requested"
+#: templates/leprikon/registration_received/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s"
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:41
+#: templates/leprikon/registration_recipe.rml:3
 #, python-format
-msgid "registration approved on %(d)s"
+msgid "name of %(subject_type)s"
 msgstr ""
 
-#: templates/leprikon/registration_preview.html:43
-msgid "awaiting approval"
+#: templates/leprikon/registration_refund_offer/subject.html:11
+#: templates/leprikon/registration_refund_offer/subject.txt:6
+#: templates/leprikon/summary.html:62
+msgid "request refund to a bank account"
 msgstr ""
 
-#: templates/leprikon/registration_received/subject.html:7
-#: templates/leprikon/registration_received/subject.txt:3
-#, python-format
-msgid ""
-"Unfortunately, the capacity of this %(subject_type)s has already been "
-"filled.\n"
-"The registration may not be approved."
+#: templates/leprikon/registration_refund_offer/subject.html:14
+#: templates/leprikon/registration_refund_offer/subject.txt:9
+#: templates/leprikon/summary.html:65
+msgid "transfer to a payment"
 msgstr ""
 
-#: templates/leprikon/registration_received/subject.html:10
-#: templates/leprikon/registration_received/subject.txt:5
-msgid "We will inform you about its further processing."
+#: templates/leprikon/registration_refund_offer/subject.html:17
+#: templates/leprikon/registration_refund_offer/subject.txt:12
+#: templates/leprikon/summary.html:68
+msgid "donate"
 msgstr ""
 
-#: templates/leprikon/registration_received/subject.html:13
-#: templates/leprikon/registration_received/subject.txt:6
-msgid "See attached files for futher information."
+#: templates/leprikon/registration_refund_offer/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s - refund offer"
 msgstr ""
 
-#: templates/leprikon/registration_refused/subject.html:4
-#: templates/leprikon/registration_refused/subject.txt:1
-msgid ""
-"Hello,\n"
-"we are sorry to inform You, that your registration was refused."
+#: templates/leprikon/registration_refused/subject.subject.txt:1
+#, python-format
+msgid "Registration for %(subject_type)s %(subject)s was refused"
 msgstr ""
 
 #: templates/leprikon/registrations.html:6
 #, python-format
 msgid "Registrations in school year %(school_year)s"
 msgstr ""
 
-#: templates/leprikon/registrations.html:14
+#: templates/leprikon/registrations.html:15
 #, python-format
 msgid "You have no registrations in school year %(school_year)s."
 msgstr ""
 
 #: templates/leprikon/reports/course_payments.html:10
 #, python-format
-msgid "Course payments from %(date_start)s to %(date_end)s"
+msgid "Received course payments from %(date_start)s to %(date_end)s"
 msgstr ""
 
-#: templates/leprikon/reports/course_payments.html:15
-#: templates/leprikon/reports/event_payments.html:15
-msgid "Registration"
+#: templates/leprikon/reports/course_payments.html:34
+#, python-format
+msgid "Returned course payments from %(date_start)s to %(date_end)s"
+msgstr ""
+
+#: templates/leprikon/reports/course_payments.html:40
+#: templates/leprikon/reports/event_payments.html:40
+#: templates/leprikon/reports/orderable_payments.html:40
+msgid "Returned amount"
+msgstr ""
+
+#: templates/leprikon/reports/course_payments.html:58
+#: templates/leprikon/reports/event_payments.html:58
+#: templates/leprikon/reports/orderable_payments.html:58
+#, python-format
+msgid "Summary from %(date_start)s to %(date_end)s"
+msgstr ""
+
+#: templates/leprikon/reports/course_payments.html:62
+#: templates/leprikon/reports/event_payments.html:62
+#: templates/leprikon/reports/orderable_payments.html:62
+msgid "All received payments"
+msgstr ""
+
+#: templates/leprikon/reports/course_payments.html:63
+#: templates/leprikon/reports/event_payments.html:63
+#: templates/leprikon/reports/orderable_payments.html:63
+msgid "All returned payments"
+msgstr ""
+
+#: templates/leprikon/reports/course_payments.html:64
+#: templates/leprikon/reports/event_payments.html:64
+#: templates/leprikon/reports/orderable_payments.html:64
+msgid "Received - returned payments"
 msgstr ""
 
 #: templates/leprikon/reports/course_payments_status.html:10
 #, python-format
 msgid "Course payments status by date %(date)s"
 msgstr ""
 
 #: templates/leprikon/reports/course_payments_status.html:16
 #: templates/leprikon/reports/event_payments_status.html:16
+#: templates/leprikon/reports/orderable_payments_status.html:16
 msgid "Number of registrations"
 msgstr ""
 
-#: templates/leprikon/reports/course_payments_status.html:17
-#: templates/leprikon/reports/event_payments_status.html:17
-msgid "Discounts"
-msgstr ""
-
 #: templates/leprikon/reports/course_payments_status.html:18
 #: templates/leprikon/reports/event_payments_status.html:18
+#: templates/leprikon/reports/orderable_payments_status.html:18
 msgid "Receivables"
 msgstr ""
 
-#: templates/leprikon/reports/course_payments_status.html:19
-#: templates/leprikon/reports/event_payments_status.html:19
-msgid "Received payments"
+#: templates/leprikon/reports/course_payments_status.html:22
+#: templates/leprikon/reports/event_payments_status.html:22
+#: templates/leprikon/reports/orderable_payments_status.html:22
+msgid "Overpayments"
 msgstr ""
 
-#: templates/leprikon/reports/course_payments_status.html:20
-#: templates/leprikon/reports/event_payments_status.html:20
-msgid "Balance"
-msgstr ""
-
-#: templates/leprikon/reports/course_payments_status.html:67
+#: templates/leprikon/reports/course_payments_status.html:85
 msgid "All courses"
 msgstr ""
 
 #: templates/leprikon/reports/course_stats.html:10
 #, python-format
 msgid "Course statistics for %(date)s"
 msgstr ""
 
 #: templates/leprikon/reports/course_stats.html:14
 msgid "Courses count"
 msgstr ""
 
 #: templates/leprikon/reports/course_stats.html:18
+msgid "Participant hours count"
+msgstr ""
+
+#: templates/leprikon/reports/course_stats.html:22
 #: templates/leprikon/reports/event_stats.html:18
+#: templates/leprikon/reports/orderable_stats.html:18
 msgid "Age Group"
 msgstr ""
 
-#: templates/leprikon/reports/course_stats.html:20
+#: templates/leprikon/reports/course_stats.html:24
 #: templates/leprikon/reports/event_stats.html:20
+#: templates/leprikon/reports/orderable_stats.html:20
 msgid "Boys"
 msgstr ""
 
-#: templates/leprikon/reports/course_stats.html:21
+#: templates/leprikon/reports/course_stats.html:25
 #: templates/leprikon/reports/event_stats.html:21
+#: templates/leprikon/reports/orderable_stats.html:21
 msgid "Girls"
 msgstr ""
 
-#: templates/leprikon/reports/course_stats.html:38
+#: templates/leprikon/reports/course_stats.html:42
+#: templates/leprikon/reports/debtors.html:39
 #: templates/leprikon/reports/event_stats.html:38
+#: templates/leprikon/reports/orderable_stats.html:38
 msgid "Total"
 msgstr ""
 
 #: templates/leprikon/reports/debtors.html:10
 #, python-format
 msgid "Debtors list by date %(date)s"
 msgstr ""
 
 #: templates/leprikon/reports/debtors.html:14
 msgid "Debtor"
 msgstr ""
 
-#: templates/leprikon/reports/debtors.html:15
-msgid "Debt"
+#: templates/leprikon/reports/debtors.html:16
+msgid "Overdue"
 msgstr ""
 
-#: templates/leprikon/reports/debtors.html:34
-msgid "Total debt"
+#: templates/leprikon/reports/event_payments.html:10
+#, python-format
+msgid "Received event payments from %(date_start)s to %(date_end)s"
 msgstr ""
 
-#: templates/leprikon/reports/event_payments.html:10
+#: templates/leprikon/reports/event_payments.html:34
 #, python-format
-msgid "Event payments from %(date_start)s to %(date_end)s"
+msgid "Returned event payments from %(date_start)s to %(date_end)s"
 msgstr ""
 
 #: templates/leprikon/reports/event_payments_status.html:10
 #, python-format
 msgid "Event payments status by date %(date)s"
 msgstr ""
 
-#: templates/leprikon/reports/event_payments_status.html:67
+#: templates/leprikon/reports/event_payments_status.html:85
 msgid "All events"
 msgstr ""
 
 #: templates/leprikon/reports/event_stats.html:10
 #, python-format
 msgid "Event statistics for %(date)s"
 msgstr ""
 
 #: templates/leprikon/reports/event_stats.html:14
 msgid "Events count"
 msgstr ""
 
-#: templates/leprikon/reports/index.html:36 views/reports/courses.py:26
-#: views/reports/courses.py:45 views/reports/courses.py:97
-#: views/reports/debtors.py:17 views/reports/events.py:26
-#: views/reports/events.py:45 views/reports/events.py:97
+#: templates/leprikon/reports/index.html:37 views/reports/courses.py:25
+#: views/reports/courses.py:51 views/reports/courses.py:102
+#: views/reports/debtors.py:20 views/reports/events.py:23
+#: views/reports/events.py:49 views/reports/events.py:99
+#: views/reports/orderables.py:23 views/reports/orderables.py:49
+#: views/reports/orderables.py:100
 msgid "Show"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:12
-msgid "Journal"
+#: templates/leprikon/reports/orderable_payments.html:10
+#, python-format
+msgid "Received orderable event payments from %(date_start)s to %(date_end)s"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:124
-msgid "Attendance"
+#: templates/leprikon/reports/orderable_payments.html:34
+#, python-format
+msgid "Returned orderable event payments from %(date_start)s to %(date_end)s"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:128
-msgctxt "person"
-msgid "Name"
+#: templates/leprikon/reports/orderable_payments_status.html:10
+#, python-format
+msgid "Orderable event payments status by date %(date)s"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:146
-#: templates/leprikon/subject_journal.html:228 views/timesheets.py:17
-msgid "add entry"
+#: templates/leprikon/reports/orderable_payments_status.html:85
+msgid "All orderable events"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:195
-msgid "Agenda"
+#: templates/leprikon/reports/orderable_stats.html:10
+#, python-format
+msgid "Orderable event statistics for %(date)s"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:199
-#: templates/leprikon/subject_preview.html:48
-msgid "Time"
+#: templates/leprikon/reports/orderable_stats.html:14
+msgid "Orderable events count"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:200
-msgid "Number of hours"
+#: templates/leprikon/returned_payment_pdf/recipe.rml:5
+msgid "Receipt for returned payment"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:201
-msgid "Number of leaders"
+#: templates/leprikon/returned_payment_received/subject.subject.txt:1
+#, python-format
+msgid ""
+"Registration for %(subject_type)s %(subject)s - returned payment confirmation"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:202
-msgid "Number of participants"
+#: templates/leprikon/subject_preview.html:49
+msgid "Duration"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:203
-msgid "Session agenda"
+#: templates/leprikon/subject_preview.html:59
+msgid "Age groups"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:208
-#: templates/leprikon/subject_journal.html:209
-msgid "skipped"
+#: templates/leprikon/subject_preview.html:66
+msgid "Target groups"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:241
-msgid "Risks"
+#: templates/leprikon/subject_registration_form.html:193
+msgid "Participants list"
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:252
-msgid "Place / Risk"
+#: templates/leprikon/subject_registration_form.html:305
+#, python-brace-format
+msgid "Minimal age for this age group is ${ageGroup.min_age}."
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:260
-msgid "Plan for the activity"
+#: templates/leprikon/subject_registration_form.html:312
+#, python-brace-format
+msgid "Maximal age for this age group is ${ageGroup.max_age}."
 msgstr ""
 
-#: templates/leprikon/subject_journal.html:279
-msgid "Evaluation of the activity"
+#: templates/leprikon/summary.html:10
+msgid "Payments overview"
 msgstr ""
 
-#: templates/leprikon/subject_preview.html:111
-msgid "add journal entry"
+#: templates/leprikon/summary.html:15
+#, python-format
+msgid "You have overdue of %(overdue)s."
 msgstr ""
 
-#: templates/leprikon/subject_registration_form.html:10
+#: templates/leprikon/summary.html:20
 #, python-format
-msgid ""
-"The capacity of this %(subject_type)s has already been filled. You may "
-"register anyway, but the registration may not be approved. We will inform "
-"You."
+msgid "Your current amount due is %(amount_due)s."
 msgstr ""
 
-#: templates/leprikon/subject_registration_form.html:79
-msgid "User"
+#: templates/leprikon/summary.html:23
+msgid "All Your receivables have been paid."
 msgstr ""
 
-#: templates/leprikon/subject_registration_form.html:163
-msgid "Contact person"
+#: templates/leprikon/summary.html:26
+#, python-format
+msgid "You have overpaid %(overpaid)s."
 msgstr ""
 
-#: templates/leprikon/subject_registration_form.html:180
-msgid "Participants list"
+#: templates/leprikon/summary.html:35
+msgid "Refund options"
 msgstr ""
 
-#: templates/leprikon/summary.html:10
-msgid "New messages"
+#: templates/leprikon/summary.html:52
+msgid "You have requested a refund to the bank account:"
 msgstr ""
 
-#: templates/leprikon/summary.html:15
-msgid "You have no new messages."
+#: templates/leprikon/summary.html:55
+msgid "change account number"
 msgstr ""
 
-#: templates/leprikon/summary.html:18
-msgid "Registrations and payments overview"
+#: templates/leprikon/summary.html:58
+msgid "cancel refund request"
 msgstr ""
 
-#: templates/leprikon/summary.html:21
-msgid "registrations count"
+#: templates/leprikon/summary.html:77
+msgid "New messages"
 msgstr ""
 
-#: templates/leprikon/summary.html:22
-msgid "total price of all registrations"
+#: templates/leprikon/summary.html:82
+msgid "You have no new messages."
 msgstr ""
 
 #: templates/leprikon/terms_conditions.html:6
 msgid "Terms and Conditions"
 msgstr ""
 
-#: templates/leprikon/timesheet_detail.html:12
+#: templates/leprikon/timesheet_detail.html:17
 #: templates/leprikon/timesheet_preview.html:9
 msgid "submit"
 msgstr ""
 
-#: templates/leprikon/timesheet_detail.html:23
+#: templates/leprikon/timesheet_detail.html:28
 msgid "type"
 msgstr ""
 
-#: templates/leprikon/timesheet_detail.html:43
-msgid "delete"
-msgstr ""
-
 #: templates/leprikon/user_dropdown.html:5
 msgid "Anonymous user"
 msgstr ""
 
-#: utils.py:102 utils.py:104
+#: templatetags/leprikon_tags.py:138
+msgid "Registering will end on {}."
+msgstr ""
+
+#: utils.py:121 utils.py:123
 msgid ", and "
 msgstr ""
 
-#: views/generic.py:40
+#: views/billing_info.py:15
+msgid "add billing information"
+msgstr ""
+
+#: views/billing_info.py:34
+msgid "New billing information"
+msgstr ""
+
+#: views/billing_info.py:37
+msgid "New billing information {} have been created."
+msgstr ""
+
+#: views/billing_info.py:42
+msgid "Billing information have been updated."
+msgstr ""
+
+#: views/billing_info.py:43
+msgid "Change billing information"
+msgstr ""
+
+#: views/billing_info.py:48
+msgid "Delete billing information"
+msgstr ""
+
+#: views/billing_info.py:49
+msgid "Billing information have been deleted."
+msgstr ""
+
+#: views/billing_info.py:52
+msgid "Do You really want to delete the billing information: {}?"
+msgstr ""
+
+#: views/generic.py:39
 msgid "No items found."
 msgstr ""
 
-#: views/generic.py:70
+#: views/generic.py:68
 msgid "No items found matching given search parameters."
 msgstr ""
 
-#: views/generic.py:109
+#: views/generic.py:108
 msgid "Save"
 msgstr ""
 
-#: views/generic.py:165
-msgid "Yes"
-msgstr ""
-
-#: views/generic.py:208
+#: views/generic.py:188
 msgid "Delete"
 msgstr ""
 
-#: views/journals.py:16
+#: views/journals.py:15
 msgid "Alternating in school year {}"
 msgstr ""
 
-#: views/journals.py:39
+#: views/journals.py:40
+msgid "New journal"
+msgstr ""
+
+#: views/journals.py:56
+msgid "New journal {} has been created."
+msgstr ""
+
+#: views/journals.py:64
+msgid "Change journal"
+msgstr ""
+
+#: views/journals.py:69
+msgid "Delete journal"
+msgstr ""
+
+#: views/journals.py:70
+msgid "Journal has been deleted."
+msgstr ""
+
+#: views/journals.py:85
+msgid "Do You really want to delete the journal {}?"
+msgstr ""
+
+#: views/journals.py:92
 msgid "New journal entry"
 msgstr ""
 
-#: views/journals.py:40
+#: views/journals.py:93
 msgid "The journal entry has been created."
 msgstr ""
 
-#: views/journals.py:59
+#: views/journals.py:112
 msgid "Change journal entry"
 msgstr ""
 
-#: views/journals.py:60
+#: views/journals.py:113
 msgid "The journal entry has been updated."
 msgstr ""
 
-#: views/journals.py:72
+#: views/journals.py:125
 msgid "Delete journal entry"
 msgstr ""
 
-#: views/journals.py:73
+#: views/journals.py:126
 msgid "The journal entry has been deleted."
 msgstr ""
 
-#: views/journals.py:88
+#: views/journals.py:141
 msgid "Do You really want to delete journal entry?"
 msgstr ""
 
-#: views/journals.py:95 views/timesheets.py:82
+#: views/journals.py:148 views/timesheets.py:79
 msgid "Change timesheet entry"
 msgstr ""
 
-#: views/journals.py:96 views/timesheets.py:83
+#: views/journals.py:149 views/timesheets.py:80
 msgid "The timesheet entry has been updated."
 msgstr ""
 
-#: views/journals.py:111 views/timesheets.py:95
+#: views/journals.py:165 views/timesheets.py:91
 msgid "Delete timesheet entry"
 msgstr ""
 
-#: views/journals.py:112 views/timesheets.py:96
+#: views/journals.py:166 views/timesheets.py:92
 msgid "The timesheet entry has been deleted."
 msgstr ""
 
-#: views/journals.py:121 views/timesheets.py:111
+#: views/journals.py:179 views/timesheets.py:107
 msgid "Do You really want to delete timesheet entry?"
 msgstr ""
 
 #: views/leaders.py:13
 msgid "No leaders matching given query."
 msgstr ""
 
@@ -3070,194 +4355,323 @@
 msgid "No messages matching given query."
 msgstr ""
 
 #: views/parents.py:13
 msgid "New parent"
 msgstr ""
 
-#: views/parents.py:26
+#: views/parents.py:25
 msgid "New parent {} has been created."
 msgstr ""
 
-#: views/parents.py:34
+#: views/parents.py:32
 msgid "Change parent"
 msgstr ""
 
-#: views/parents.py:46
+#: views/parents.py:44
 msgid "The parent {} has been updated."
 msgstr ""
 
+#: views/parents.py:49
+msgid "Delete information about parent"
+msgstr ""
+
+#: views/parents.py:50
+msgid "Information about parent has been deleted."
+msgstr ""
+
+#: views/parents.py:57
+msgid "Do You really want to delete the information about parent: {}?"
+msgstr ""
+
 #: views/participants.py:11
 msgid "add participant"
 msgstr ""
 
 #: views/participants.py:17
 msgid "Participants and parents"
 msgstr ""
 
-#: views/participants.py:31
+#: views/participants.py:30
 msgid "New participant"
 msgstr ""
 
-#: views/participants.py:42
+#: views/participants.py:41
 msgid "New participant {} has been created."
 msgstr ""
 
-#: views/participants.py:50
+#: views/participants.py:48
 msgid "Change participant"
 msgstr ""
 
-#: views/participants.py:62
+#: views/participants.py:60
 msgid "The participant {} has been updated."
 msgstr ""
 
-#: views/reports/__init__.py:27 views/reports/courses.py:25
+#: views/participants.py:65
+msgid "Delete information about participant"
+msgstr ""
+
+#: views/participants.py:66
+msgid "Information about participant has been deleted."
+msgstr ""
+
+#: views/participants.py:73
+msgid "Do You really want to delete the information about participant: {}?"
+msgstr ""
+
+#: views/refundrequest.py:30
+msgid "New refund request"
+msgstr ""
+
+#: views/refundrequest.py:33
+msgid "Refund request have been created."
+msgstr ""
+
+#: views/refundrequest.py:43
+msgid "Refund request has been updated."
+msgstr ""
+
+#: views/refundrequest.py:44
+msgid "Update refund request"
+msgstr ""
+
+#: views/refundrequest.py:54
+msgid "Cancel refund request"
+msgstr ""
+
+#: views/refundrequest.py:55
+msgid "Refund request has been canceled."
+msgstr ""
+
+#: views/refundrequest.py:58
+msgid "Do You really want to cancel the refund request: {}?"
+msgstr ""
+
+#: views/refundrequest.py:63
+msgid "New payment transfer"
+msgstr ""
+
+#: views/refundrequest.py:66
+msgid ""
+"The payment may only be transferred to a registration, for which the payment "
+"is required. If You have submitted new registration recently, You may need "
+"to wait until the payment is requested for that registration."
+msgstr ""
+
+#: views/refundrequest.py:73
+msgid "The payment has been transferred."
+msgstr ""
+
+#: views/refundrequest.py:78
+msgid "New donation"
+msgstr ""
+
+#: views/refundrequest.py:80
+msgid ""
+"If You wish, You may transfer the overpaid amount to a donation for our "
+"organization."
+msgstr ""
+
+#: views/refundrequest.py:83
+msgid "Thank You. Your support is very appreciated."
+msgstr ""
+
+#: views/reports/__init__.py:22 views/reports/courses.py:24
 msgid "Course payments"
 msgstr ""
 
-#: views/reports/__init__.py:33 views/reports/events.py:25
+#: views/reports/__init__.py:28 views/reports/events.py:22
 msgid "Event payments"
 msgstr ""
 
-#: views/reports/__init__.py:39 views/reports/courses.py:44
+#: views/reports/__init__.py:34
+msgid "Orderable event payments"
+msgstr ""
+
+#: views/reports/__init__.py:40 views/reports/courses.py:50
 msgid "Course payments status"
 msgstr ""
 
-#: views/reports/__init__.py:45 views/reports/events.py:44
+#: views/reports/__init__.py:46 views/reports/events.py:48
 msgid "Event payments status"
 msgstr ""
 
-#: views/reports/__init__.py:51 views/reports/courses.py:96
+#: views/reports/__init__.py:52 views/reports/orderables.py:48
+msgid "Orderable event payments status"
+msgstr ""
+
+#: views/reports/__init__.py:58 views/reports/courses.py:101
 msgid "Course statistics"
 msgstr ""
 
-#: views/reports/__init__.py:57 views/reports/events.py:96
+#: views/reports/__init__.py:64 views/reports/events.py:98
 msgid "Event statistics"
 msgstr ""
 
-#: views/reports/__init__.py:63 views/reports/debtors.py:16
+#: views/reports/__init__.py:70
+msgid "Orderable event statistics"
+msgstr ""
+
+#: views/reports/__init__.py:76 views/reports/debtors.py:19
 msgid "Debtors list"
 msgstr ""
 
+#: views/reports/orderables.py:22
+msgid "Orderable payments"
+msgstr ""
+
+#: views/reports/orderables.py:99
+msgid "Orderable statistics"
+msgstr ""
+
 #: views/schoolyear.py:9
 msgid "Switch school year"
 msgstr ""
 
 #: views/schoolyear.py:12
 msgid "You now work with school year {}."
 msgstr ""
 
-#: views/subjects.py:69
+#: views/subjects.py:79
+#, python-brace-format
+msgid "Past {subject_type} in school year {school_year}"
+msgstr ""
+
+#: views/subjects.py:83
+#, python-brace-format
+msgid "Oncoming {subject_type}"
+msgstr ""
+
+#: views/subjects.py:86
 #, python-brace-format
 msgid "{subject_type} in school year {school_year}"
 msgstr ""
 
-#: views/subjects.py:75
+#: views/subjects.py:92
 #, python-brace-format
 msgid "No {subject_type} matching given search parameters found."
 msgstr ""
 
-#: views/subjects.py:106
+#: views/subjects.py:119
 #, python-brace-format
 msgid "My {subject_type} in school year {school_year}"
 msgstr ""
 
-#: views/subjects.py:145
+#: views/subjects.py:147
+msgid "Create journal"
+msgstr ""
+
+#: views/subjects.py:150
+msgid "No journals matching given search parameters found."
+msgstr ""
+
+#: views/subjects.py:155
+#, python-brace-format
+msgid "Journals of {subject_type} {subject}"
+msgstr ""
+
+#: views/subjects.py:175
 #, python-brace-format
 msgid "Change {subject_type} {subject}"
 msgstr ""
 
-#: views/subjects.py:151
+#: views/subjects.py:181
 #, python-brace-format
 msgid "The changes in {subject_type} {subject} have been saved."
 msgstr ""
 
-#: views/subjects.py:178
+#: views/subjects.py:207
 msgid "Submit registration"
 msgstr ""
 
-#: views/subjects.py:179
+#: views/subjects.py:208
 msgid ""
 "The registration has been saved. We will inform you about its further "
 "processing."
 msgstr ""
 
-#: views/subjects.py:242
+#: views/subjects.py:217
+#, python-brace-format
+msgid "Registration for {subject_type} {subject}"
+msgstr ""
+
+#: views/subjects.py:293
 msgid "Registration cancellation request"
 msgstr ""
 
-#: views/subjects.py:245
+#: views/subjects.py:299
 msgid "Are you sure You want to cancel the registration \"{}\"?"
 msgstr ""
 
-#: views/subjects.py:248
+#: views/subjects.py:302
 msgid "The cancellation request for {} has been saved."
 msgstr ""
 
-#: views/timesheets.py:41
+#: views/timesheets.py:36
 msgid "Submit timesheet"
 msgstr ""
 
-#: views/timesheets.py:51
+#: views/timesheets.py:50
 msgid ""
 "Are you sure You want to submit the timesheet now? You won't be able to edit "
 "the entries for {} any more."
 msgstr ""
 
-#: views/timesheets.py:56
+#: views/timesheets.py:55
 msgid "The timesheet for () has been submitted."
 msgstr ""
 
-#: views/timesheets.py:68
+#: views/timesheets.py:66
 msgid "New timesheet entry"
 msgstr ""
 
-#: views/timesheets.py:69
+#: views/timesheets.py:67
 msgid "New timesheet entry has been created."
 msgstr ""
 
-#: views/user.py:35
+#: views/user.py:29
 msgid "User account {} has been created."
 msgstr ""
 
-#: views/user.py:68
+#: views/user.py:62
 msgid "Agreement with the terms of use"
 msgstr ""
 
-#: views/user.py:72
+#: views/user.py:66
 msgid "The agreement has been saved."
 msgstr ""
 
-#: views/user.py:89
+#: views/user.py:83
 msgid "Change user"
 msgstr ""
 
-#: views/user.py:95
+#: views/user.py:89
 msgid "User account {} has been updated."
 msgstr ""
 
-#: views/user.py:103
+#: views/user.py:97
 msgid "Change e-mail address"
 msgstr ""
 
-#: views/user.py:105
+#: views/user.py:99
 msgid "Set e-mail address"
 msgstr ""
 
-#: views/user.py:141
+#: views/user.py:140
 msgid ""
 "Enter your email address, and we'll email instructions for setting a new one."
 msgstr ""
 
-#: views/user.py:143
+#: views/user.py:142
 msgid "Reset my password"
 msgstr ""
 
-#: views/user.py:161
+#: views/user.py:163
 msgid ""
 "Please enter your new password twice so we can verify you typed it in "
 "correctly."
 msgstr ""
 
-#: views/user.py:163
+#: views/user.py:165
 msgid "Set my password"
 msgstr ""
```

### Comparing `leprikon-3.0.0/leprikon/middleware.py` & `leprikon-3.5.0/leprikon/middleware.py`

 * *Files 4% similar despite different names*

```diff
@@ -4,49 +4,48 @@
 
 from . import __version__
 from .conf import settings
 from .models.leprikonsite import LeprikonSite
 from .models.roles import Leader
 from .models.schoolyear import SchoolYear
 from .models.useragreement import UserAgreement
-from .rocketchat import get_rc_id, rc_logout
 
 
 class school_year:
     def __get__(self, request, type=None):
         if request is None:
             return self
         try:
             return request._leprikon_school_year
         except AttributeError:
             years = SchoolYear.objects
             if not request.user.is_staff:
                 years = years.filter(active=True)
             try:
                 # return year stored in the session
-                request._leprikon_school_year = years.get(id=request.session['school_year_id'])
+                request._leprikon_school_year = years.get(id=request.session["school_year_id"])
             except (KeyError, SchoolYear.DoesNotExist):
                 request._leprikon_school_year = SchoolYear.objects.get_current()
         return request._leprikon_school_year
 
     def __set__(self, request, school_year):
         if request:
             request._leprikon_school_year = school_year
-            request.session['school_year_id'] = school_year.id
+            request.session["school_year_id"] = school_year.id
 
     def __delete__(self, request):
         if request:
-            del(request._leprikon_school_year)
+            del request._leprikon_school_year
 
 
 class LeprikonMiddleware:
-    user_agreement_url = reverse_lazy('leprikon:user_agreement')
-    user_email_url = reverse_lazy('leprikon:user_email')
-    user_login_url = reverse_lazy('leprikon:user_login')
-    user_logout_url = reverse_lazy('leprikon:user_logout')
+    user_agreement_url = reverse_lazy("leprikon:user_agreement")
+    user_email_url = reverse_lazy("leprikon:user_email")
+    user_login_url = reverse_lazy("leprikon:user_login")
+    user_logout_url = reverse_lazy("leprikon:user_logout")
 
     def __init__(self, get_response):
         self.get_response = get_response
 
     def __call__(self, request):
         # add school_year property to request
         type(request).school_year = school_year()
@@ -61,23 +60,23 @@
         request.leprikon_site = LeprikonSite.objects.get_current()
 
         # add leprikon version to request
         request.leprikon_version = __version__
 
         # check user agreement
         if (
-            request.leprikon_site.user_agreement_changed and
-            request.user.is_authenticated and
-            not request.session.get('user_agreement_ok')
+            request.leprikon_site.user_agreement_changed
+            and request.user.is_authenticated
+            and not request.session.get("user_agreement_ok")
         ):
             if UserAgreement.objects.filter(
                 user=request.user,
                 granted__gt=request.leprikon_site.user_agreement_changed,
             ).exists():
-                request.session['user_agreement_ok'] = 1
+                request.session["user_agreement_ok"] = 1
             elif request.path not in (
                 self.user_agreement_url,
                 self.user_logout_url,
             ):
                 return redirect_to_login(
                     request.path,
                     login_url=self.user_agreement_url,
@@ -100,28 +99,15 @@
         # set session expiry
         if request.user.is_authenticated:
             if request.user.is_staff:
                 request.session.set_expiry(settings.SESSION_STAFF_COOKIE_AGE)
             else:
                 request.session.set_expiry(settings.SESSION_COOKIE_AGE)
 
-        response = self.get_response(request)
-
-        if 'rc_uid' in request.COOKIES and (
-            not request.user.is_authenticated or
-            request.COOKIES['rc_uid'] != get_rc_id(request.user)
-        ):
-            try:
-                rc_logout(
-                    auth_token=request.COOKIES['rc_token'],
-                    user_id=request.COOKIES['rc_uid'],
-                )
-            except Exception:
-                pass
-        return response
+        return self.get_response(request)
 
     def process_exception(self, request, exception):
         if isinstance(exception, PermissionDenied):
             return redirect_to_login(
                 request.path,
                 login_url=self.user_login_url,
                 redirect_field_name=settings.LEPRIKON_PARAM_BACK,
```

### Comparing `leprikon-3.0.0/leprikon/migrations/0001_initial.py` & `leprikon-3.5.0/leprikon/migrations/0001_initial.py`

 * *Files 0% similar despite different names*

```diff
@@ -38,15 +38,15 @@
                 'verbose_name_plural': 'age groups',
             },
         ),
         migrations.CreateModel(
             name='Contact',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
-                ('contact_type', models.CharField(choices=[('email', 'email'), ('phone', 'phone'), ('url', 'url')], max_length=30, verbose_name='contact type')),
+                ('contact_type', models.CharField(choices=settings.LEPRIKON_CONTACT_TYPES, max_length=30, verbose_name='contact type')),
                 ('contact', models.CharField(max_length=250, verbose_name='contact')),
                 ('order', models.IntegerField(blank=True, default=0, verbose_name='order')),
                 ('public', models.BooleanField(default=False, verbose_name='public')),
             ],
             options={
                 'ordering': ('order',),
                 'verbose_name': 'contact',
@@ -589,15 +589,15 @@
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                 ('submitted', models.BooleanField(default=False, verbose_name='submitted')),
                 ('paid', models.BooleanField(default=False, verbose_name='paid')),
                 ('leader', models.ForeignKey(editable=False, on_delete=django.db.models.deletion.PROTECT, related_name='timesheets', to='leprikon.Leader', verbose_name='leader')),
             ],
             options={
-                'ordering': ('-period__start',),
+                'ordering': ('-period__start', 'leader'),
                 'verbose_name': 'timesheet',
                 'verbose_name_plural': 'timesheets',
             },
         ),
         migrations.CreateModel(
             name='TimesheetEntry',
             fields=[
```

### Comparing `leprikon-3.0.0/leprikon/migrations/0002_initial_data.py` & `leprikon-3.5.0/leprikon/migrations/0002_initial_data.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0003_managers.py` & `leprikon-3.5.0/leprikon/migrations/0003_managers.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0005_subjectregistration_variable_symbol.py` & `leprikon-3.5.0/leprikon/migrations/0005_subjectregistration_variable_symbol.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0006_discount_periods.py` & `leprikon-3.5.0/leprikon/migrations/0006_discount_periods.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0007_bill_print_setup.py` & `leprikon-3.5.0/leprikon/migrations/0007_bill_print_setup.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0009_subjectpayment_received_by.py` & `leprikon-3.5.0/leprikon/migrations/0009_subjectpayment_received_by.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0012_subject_variants.py` & `leprikon-3.5.0/leprikon/migrations/0012_subject_variants.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0013_drop_insurance.py` & `leprikon-3.5.0/leprikon/migrations/0013_drop_insurance.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0015_school_year_divisions.py` & `leprikon-3.5.0/leprikon/migrations/0015_school_year_divisions.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0016_school_year_divisions_cleanup.py` & `leprikon-3.5.0/leprikon/migrations/0016_school_year_divisions_cleanup.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0017_citizenship.py` & `leprikon-3.5.0/leprikon/migrations/0017_citizenship.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # Generated by Django 1.11.12 on 2018-08-29 13:30
 
 from django.db import migrations, models
 from django.utils import translation
-from django.utils.translation import ugettext as _
+from django.utils.translation import gettext as _
 from django_countries.data import COUNTRIES
 import django.db.models.deletion
 from leprikon.conf import settings
 
 
 _('Czechia')  # we want Czechia to be translated
 all_EU_countries = [
@@ -16,17 +16,17 @@
 other_EU_countries = [country for country in all_EU_countries if country != settings.LEPRIKON_COUNTRY]
 
 
 def create_default_citizenships(apps, schema_editor):
     Citizenship = apps.get_model('leprikon', 'Citizenship')
     translation.activate(settings.LEPRIKON_COUNTRY)
     Citizenship.objects.bulk_create((
-        Citizenship(order=0, name=COUNTRIES[settings.LEPRIKON_COUNTRY]),
-        Citizenship(order=1, name=_('other country in EU')),
-        Citizenship(order=2, name=_('country outside EU')),
+        Citizenship(order=0, name=COUNTRIES[settings.LEPRIKON_COUNTRY], require_birth_num=True),
+        Citizenship(order=1, name=_('other country in EU'), require_birth_num=False),
+        Citizenship(order=2, name=_('country outside EU'), require_birth_num=False),
     ))
 
 
 def update_registration_citizenships(apps, schema_editor):
     Citizenship = apps.get_model('leprikon', 'Citizenship')
     SubjectRegistration = apps.get_model('leprikon', 'SubjectRegistration')
     SubjectRegistration.objects.filter(
```

### Comparing `leprikon-3.0.0/leprikon/migrations/0019_department.py` & `leprikon-3.5.0/leprikon/migrations/0019_department.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0020_agreements.py` & `leprikon-3.5.0/leprikon/migrations/0020_agreements.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0021_user_agreement.py` & `leprikon-3.5.0/leprikon/migrations/0021_user_agreement.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0022_bankreader.py` & `leprikon-3.5.0/leprikon/migrations/0022_bankreader.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0023_accountclosure.py` & `leprikon-3.5.0/leprikon/migrations/0023_accountclosure.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0025_agreements.py` & `leprikon-3.5.0/leprikon/migrations/0025_agreements.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0026_online_payments.py` & `leprikon-3.5.0/leprikon/migrations/0026_online_payments.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0027_journals.py` & `leprikon-3.5.0/leprikon/migrations/0027_journals.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0028_agegroups.py` & `leprikon-3.5.0/leprikon/migrations/0028_agegroups.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0029_payment_restrictions.py` & `leprikon-3.5.0/leprikon/migrations/0029_payment_restrictions.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0030_agreements.py` & `leprikon-3.5.0/leprikon/migrations/0030_agreements.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0031_registration_questions_agreements.py` & `leprikon-3.5.0/leprikon/migrations/0031_registration_questions_agreements.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0032_registration_participants_groups.py` & `leprikon-3.5.0/leprikon/migrations/0032_registration_participants_groups.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0033_target_groups.py` & `leprikon-3.5.0/leprikon/migrations/0033_target_groups.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0034_subject_registration_group.py` & `leprikon-3.5.0/leprikon/migrations/0034_subject_registration_group.py`

 * *Files 1% similar despite different names*

```diff
@@ -66,15 +66,15 @@
             model_name='subject',
             name='min_group_members_count',
             field=models.PositiveIntegerField(help_text='Group member details only include name and note.', verbose_name='minimal group members count per registration'),
         ),
         migrations.AddField(
             model_name='subject',
             name='registration_type',
-            field=models.CharField(choices=[('P', 'participants'), ('G', 'groups')], default='P', max_length=1, verbose_name='registration type'),
+            field=models.CharField(choices=[('P', 'participants'), ('G', 'groups')], default='P', max_length=1, help_text='Participant details include birth number (birth day), age group, contacts, parent, etc. Group member details only include name and note.', verbose_name='registration type'),
             preserve_default=False,
         ),
         migrations.RunPython(set_subject_registration_type),
         migrations.CreateModel(
             name='SubjectRegistrationGroup',
             fields=[
                 ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
```

### Comparing `leprikon-3.0.0/leprikon/migrations/0035_on_delete.py` & `leprikon-3.5.0/leprikon/migrations/0035_on_delete.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0036_participants_instructed.py` & `leprikon-3.5.0/leprikon/migrations/0036_participants_instructed.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0037_message_sender.py` & `leprikon-3.5.0/leprikon/migrations/0037_message_sender.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0038_organizations.py` & `leprikon-3.5.0/leprikon/migrations/0038_organizations.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0039_editable_texts.py` & `leprikon-3.5.0/leprikon/migrations/0039_editable_texts.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0040_due_dates.py` & `leprikon-3.5.0/leprikon/migrations/0040_due_dates.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0041_billing_info.py` & `leprikon-3.5.0/leprikon/migrations/0041_billing_info.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0042_chat_group_types.py` & `leprikon-3.5.0/leprikon/migrations/0042_chat_group_types.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0043_registration_links.py` & `leprikon-3.5.0/leprikon/migrations/0043_registration_links.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0044_billinginfo_contacts.py` & `leprikon-3.5.0/leprikon/migrations/0044_billinginfo_contacts.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0045_registration_slug.py` & `leprikon-3.5.0/leprikon/migrations/0045_registration_slug.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0046_attachment_events.py` & `leprikon-3.5.0/leprikon/migrations/0046_attachment_events.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0047_pr_print_setup.py` & `leprikon-3.5.0/leprikon/migrations/0047_pr_print_setup.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0048_birth_date.py` & `leprikon-3.5.0/leprikon/migrations/0048_birth_date.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0049_target_groups_fix.py` & `leprikon-3.5.0/leprikon/migrations/0049_target_groups_fix.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0051_registration_group_name.py` & `leprikon-3.5.0/leprikon/migrations/0051_registration_group_name.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0052_payment_notification_sent.py` & `leprikon-3.5.0/leprikon/migrations/0052_payment_notification_sent.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0053_registration_dates_by.py` & `leprikon-3.5.0/leprikon/migrations/0053_registration_dates_by.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0055_schoolyearblockplugin.py` & `leprikon-3.5.0/leprikon/migrations/0055_schoolyearblockplugin.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0056_registration_period.py` & `leprikon-3.5.0/leprikon/migrations/0056_registration_period.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0057_registration_period.py` & `leprikon-3.5.0/leprikon/migrations/0057_registration_period.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/migrations/0058_agegroup_min_max_age.py` & `leprikon-3.5.0/leprikon/migrations/0058_agegroup_min_max_age.py`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/models/agegroup.py` & `leprikon-3.5.0/leprikon/models/agegroup.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,24 +1,24 @@
 from django.db import models
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..utils import first_upper
 
 
 class AgeGroup(models.Model):
-    name = models.CharField(_('name'), max_length=50)
-    min_age = models.PositiveSmallIntegerField(_('minimal age'), blank=True, null=True)
-    max_age = models.PositiveSmallIntegerField(_('maximal age'), blank=True, null=True)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    require_school = models.BooleanField(_('require school'), default=True)
+    name = models.CharField(_("name"), max_length=50)
+    min_age = models.PositiveSmallIntegerField(_("minimal age"), blank=True, null=True)
+    max_age = models.PositiveSmallIntegerField(_("maximal age"), blank=True, null=True)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    require_school = models.BooleanField(_("require school"), default=True)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('age group')
-        verbose_name_plural = _('age groups')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("age group")
+        verbose_name_plural = _("age groups")
 
     def __str__(self):
         return self.name
 
     def title(self):
         return first_upper(self.name)
```

### Comparing `leprikon-3.0.0/leprikon/models/agreements.py` & `leprikon-3.5.0/leprikon/models/agreements.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,44 +1,45 @@
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from djangocms_text_ckeditor.fields import HTMLField
 
 
 class Agreement(models.Model):
-    name = models.CharField(_('name'), max_length=50, unique=True)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    heading = models.CharField(_('heading'), max_length=50, blank=True, default='')
-    agreement = HTMLField(_('agreement'), blank=True, default='')
-    active = models.BooleanField(_('active'), default=True)
+    name = models.CharField(_("name"), max_length=50, unique=True)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    heading = models.CharField(_("heading"), max_length=50, blank=True, default="")
+    agreement = HTMLField(_("agreement"), blank=True, default="")
+    active = models.BooleanField(_("active"), default=True)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('legal agreement')
-        verbose_name_plural = _('legal agreements')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("legal agreement")
+        verbose_name_plural = _("legal agreements")
 
     def __str__(self):
         return self.name
 
     @cached_property
     def all_options(self):
         return list(self.options.all())
 
 
 class AgreementOption(models.Model):
-    agreement = models.ForeignKey(Agreement, on_delete=models.CASCADE,
-                                  related_name='options', verbose_name=_('agreement'))
-    name = models.CharField(_('name'), max_length=50)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    required = models.BooleanField(_('required'), default=False)
-    option = HTMLField(_('option'))
+    agreement = models.ForeignKey(
+        Agreement, on_delete=models.CASCADE, related_name="options", verbose_name=_("agreement")
+    )
+    name = models.CharField(_("name"), max_length=50)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    required = models.BooleanField(_("required"), default=False)
+    option = HTMLField(_("option"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        unique_together = (('agreement', 'name'),)
-        verbose_name = _('agreement option')
-        verbose_name_plural = _('agreement options')
+        app_label = "leprikon"
+        ordering = ("order",)
+        unique_together = (("agreement", "name"),)
+        verbose_name = _("agreement option")
+        verbose_name_plural = _("agreement options")
 
     def __str__(self):
         return self.name
```

### Comparing `leprikon-3.0.0/leprikon/models/citizenship.py` & `leprikon-3.5.0/leprikon/models/citizenship.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,17 +1,17 @@
 from django.db import models
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 
 class Citizenship(models.Model):
-    name = models.CharField(_('name'), max_length=50)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    require_birth_num = models.BooleanField(_('require birth number'), default=True)
+    name = models.CharField(_("name"), max_length=50)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    require_birth_num = models.BooleanField(_("require birth number"), default=True)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('citizenship')
-        verbose_name_plural = _('citizenships')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("citizenship")
+        verbose_name_plural = _("citizenships")
 
     def __str__(self):
         return self.name
```

### Comparing `leprikon-3.0.0/leprikon/models/courses.py` & `leprikon-3.5.0/leprikon/models/courses.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,208 +1,136 @@
 from collections import namedtuple
-from datetime import date, datetime, timedelta
+from datetime import date, timedelta
+from typing import List
 
 from cms.models import CMSPlugin
 from django.db import models, transaction
 from django.dispatch import receiver
-from django.utils.encoding import force_text
 from django.utils.formats import date_format
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
-from ..utils import comma_separated
 from .agegroup import AgeGroup
 from .department import Department
-from .fields import DAY_OF_WEEK, DayOfWeekField
-from .journals import JournalEntry
 from .roles import Leader
 from .schoolyear import SchoolYear, SchoolYearDivision, SchoolYearPeriod
 from .startend import StartEndMixin
-from .subjects import (
-    Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType,
-)
+from .subjects import Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType, SubjectVariant
 from .targetgroup import TargetGroup
-from .utils import PaymentStatus, change_year
+from .utils import PaymentStatus, change_year, copy_related_objects
 
 
 class Course(Subject):
-    school_year_division = models.ForeignKey(SchoolYearDivision, on_delete=models.PROTECT,
-                                             related_name='courses', verbose_name=_('school year division'))
-    allow_period_selection = models.BooleanField(
-        _('allow period selection'),
-        default=False,
-        help_text=_('allow user to choose school year periods on registration form'),
-    )
-
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('code', 'name')
-        verbose_name = _('course')
-        verbose_name_plural = _('courses')
-
-    @cached_property
-    def all_times(self):
-        return list(self.times.all())
-
-    @cached_property
-    def all_periods(self):
-        return list(self.school_year_division.periods.all())
-
-    @cached_property
-    def all_journal_entries(self):
-        return list(self.journal_entries.all())
-
-    def get_times_list(self):
-        return comma_separated(self.all_times)
-    get_times_list.short_description = _('times')
-
-    def get_next_time(self, now=None):
-        try:
-            return min(t.get_next_time(now) for t in self.all_times)
-        except ValueError:
-            return None
+        app_label = "leprikon"
+        ordering = ("code", "name")
+        verbose_name = _("course")
+        verbose_name_plural = _("courses")
 
     @property
     def registrations_history_registrations(self):
         return CourseRegistration.objects.filter(course_history__course=self).distinct()
 
     @property
     def inactive_registrations(self):
-        return (CourseRegistration.objects.filter(course_history__course=self)
-                .exclude(id__in=self.active_registrations.all()).distinct())
+        return (
+            CourseRegistration.objects.filter(course_history__course=self)
+            .exclude(id__in=self.active_registrations.all())
+            .distinct()
+        )
 
-    def copy_to_school_year(old, school_year):
+    def copy_to_school_year(old, school_year: SchoolYear):
         new = Course.objects.get(id=old.id)
         new.id, new.pk = None, None
         new.school_year = school_year
         new.public = False
-        new.evaluation = ''
-        new.note = ''
+        new.note = ""
         year_delta = school_year.year - old.school_year.year
-        new.school_year_division = SchoolYearDivision.objects.filter(
-            school_year=school_year,
-            name=old.school_year_division.name,
-        ).first() or old.school_year_division.copy_to_school_year(school_year)
-        new.reg_from = new.reg_from and change_year(new.reg_from, year_delta)
-        new.reg_to = new.reg_to and change_year(new.reg_to, year_delta)
         new.save()
-        new.times.set(old.times.all())
         new.groups.set(old.groups.all())
         new.age_groups.set(old.age_groups.all())
         new.target_groups.set(old.target_groups.all())
         for leader in old.all_leaders:
             school_year.leaders.add(leader)
         new.leaders.set(old.all_leaders)
         new.questions.set(old.questions.all())
-        new.attachments.set(old.attachments.all())
-        return new
-
-
-class CourseTime(StartEndMixin, models.Model):
-    course = models.ForeignKey(Course, on_delete=models.CASCADE,
-                               related_name='times', verbose_name=_('course'))
-    day_of_week = DayOfWeekField(_('day of week'))
-    start = models.TimeField(_('start time'), blank=True, null=True)
-    end = models.TimeField(_('end time'), blank=True, null=True)
-
-    class Meta:
-        app_label = 'leprikon'
-        ordering = ('day_of_week', 'start')
-        verbose_name = _('time')
-        verbose_name_plural = _('times')
-
-    def __str__(self):
-        if self.start is not None and self.end is not None:
-            return _('{day}, {start:%H:%M} - {end:%H:%M}').format(
-                day=self.day,
-                start=self.start,
-                end=self.end,
-            )
-        elif self.start is not None:
-            return _('{day}, {start:%H:%M}').format(
-                day=self.day,
-                start=self.start,
-            )
-        else:
-            return force_text(self.day)
-
-    @cached_property
-    def day(self):
-        return DAY_OF_WEEK[self.day_of_week]
-
-    Time = namedtuple('Time', ('date', 'start', 'end'))
-
-    def get_next_time(self, now=None):
-        now = now or datetime.now()
-        daydelta = (self.day_of_week - now.isoweekday()) % 7
-        if daydelta == 0 and (isinstance(now, date) or self.start is None or self.start <= now.time()):
-            daydelta = 7
-        if isinstance(now, datetime):
-            next_date = now.date() + timedelta(daydelta)
-        else:
-            next_date = now + timedelta(daydelta)
-        return self.Time(
-            date=next_date,
-            start=self.start,
-            end=self.end,
+        for old_variant in old.all_variants:
+            new_variant = SubjectVariant.objects.get(id=old_variant.id)
+            new_variant.id, new_variant.pk = None, None
+            new_variant.subject = new
+            if old_variant.school_year_division:
+                new_variant.school_year_division = SchoolYearDivision.objects.filter(
+                    school_year=school_year,
+                    name=old_variant.school_year_division.name,
+                ).first() or old_variant.school_year_division.copy_to_school_year(school_year)
+            new_variant.reg_from = change_year(new_variant.reg_from, year_delta)
+            new_variant.reg_to = change_year(new_variant.reg_to, year_delta)
+            new_variant.save()
+            new_variant.age_groups.set(old_variant.age_groups.all())
+            new_variant.target_groups.set(old_variant.target_groups.all())
+        copy_related_objects(
+            new,
+            attachments=old.attachments,
+            times=old.times,
         )
+        return new
 
 
 class CourseRegistration(SubjectRegistration):
     subject_type = SubjectType.COURSE
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('course registration')
-        verbose_name_plural = _('course registrations')
+        app_label = "leprikon"
+        verbose_name = _("course registration")
+        verbose_name_plural = _("course registrations")
 
     @cached_property
-    def all_registration_periods(self):
-        return list(
-            self.course_registration_periods.select_related('period')
-        )
+    def all_registration_periods(self) -> List["CourseRegistrationPeriod"]:
+        return list(self.course_registration_periods.select_related("period"))
 
     def get_period_payment_statuses(self, d=None):
-        paid = self.get_paid(d)
+        received = self.get_received(d)
+        returned = self.get_returned(d)
+
         for counter, registration_period in enumerate(self.all_registration_periods, start=1):
             period_payment_status = registration_period.get_payment_status(
-                paid=paid,
+                received=received,
+                returned=returned,
                 last_period=counter == len(self.all_registration_periods),
                 d=d,
             )
             yield period_payment_status
-            paid -= period_payment_status.status.paid
+            received -= period_payment_status.status.received
+            returned = 0  # all returned payments are "spent" to the first period
         if not self.all_registration_periods:
             # create fake registration period to ensure some payment status
             registration_period = CourseRegistrationPeriod(
                 registration=self,
                 period=SchoolYearPeriod(
-                    name=_('no period'),
-                )
+                    name=_("no period"),
+                ),
             )
             yield CourseRegistrationPeriod.PeriodPaymentStatus(
                 period=registration_period.period,
                 registration_period=registration_period,
                 status=PaymentStatus(
                     price=0,
                     discount=0,
-                    explanation='',
-                    paid=paid,
+                    explanation="",
+                    received=received,
+                    returned=returned,
                     current_date=d,
                     due_from=None,
                     due_date=None,
                 ),
             )
 
     def get_payment_status(self, d=None):
-        return sum(
-            pps.status
-            for pps in self.get_period_payment_statuses(d)
-        )
+        return sum(pps.status for pps in self.get_period_payment_statuses(d))
 
     @cached_property
     def period_payment_statuses(self):
         return list(self.get_period_payment_statuses())
 
     @transaction.atomic
     def request_payment(self, payment_requested_by):
@@ -212,205 +140,245 @@
         super().request_payment(payment_requested_by)
 
 
 class CourseRegistrationPeriod(models.Model):
     registration = models.ForeignKey(
         CourseRegistration,
         on_delete=models.CASCADE,
-        related_name='course_registration_periods',
-        verbose_name=_('registration'),
+        related_name="course_registration_periods",
+        verbose_name=_("registration"),
     )
     period = models.ForeignKey(
         SchoolYearPeriod,
         on_delete=models.PROTECT,
-        related_name='course_registration_periods',
-        verbose_name=_('period'),
+        related_name="course_registration_periods",
+        verbose_name=_("period"),
     )
-    payment_requested = models.BooleanField(_('payment requested'), default=False)
+    payment_requested = models.BooleanField(_("payment requested"), default=False)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('registered period')
-        verbose_name_plural = _('registered periods')
-        ordering = ('period__start',)
+        app_label = "leprikon"
+        verbose_name = _("registered period")
+        verbose_name_plural = _("registered periods")
+        ordering = ("period__start",)
 
     def __str__(self):
         return str(self.period)
 
     @cached_property
     def all_discounts(self):
         # use cached self.registration.all_discounts instead of
         # return list(self.discounts.all())
-        return [
-            discount for discount in self.registration.all_discounts
-            if discount.registration_period_id == self.id
-        ]
+        return [discount for discount in self.registration.all_discounts if discount.registration_period_id == self.id]
 
-    PeriodPaymentStatus = namedtuple(
-        'PeriodPaymentStatus',
-        ('period', 'registration_period', 'status'),
-    )
+    class PeriodPaymentStatus(
+        namedtuple(
+            "PeriodPaymentStatus",
+            ["period", "registration_period", "status"],
+        )
+    ):
+        period: SchoolYearPeriod
+        registration_period: "CourseRegistrationPeriod"
+        status: PaymentStatus
 
-    def get_payment_status(self, paid, last_period, d=None):
+    def get_payment_status(self, received, returned, last_period, d=None) -> PeriodPaymentStatus:
         if d is None:
             d = date.today()
-        discount = sum(
-            discount.amount
-            for discount in self.all_discounts
-            if discount.accounted.date() <= d
-        )
-        explanation = ',\n'.join(
+        period_price = self.registration.price * self.period.price_units_count
+        discount = sum(discount.amount for discount in self.all_discounts if discount.accounted.date() <= d)
+        explanation = ",\n".join(
             discount.explanation.strip()
             for discount in self.all_discounts
             if discount.accounted.date() <= d and discount.explanation.strip()
         )
         return self.PeriodPaymentStatus(
             period=self.period,
             registration_period=self,
             status=PaymentStatus(
-                price=self.registration.price,
+                price=period_price,
                 discount=discount,
                 explanation=explanation,
-                paid=min(self.registration.price - discount, paid) if not last_period else paid,
+                received=min(period_price - discount + returned, received) if not last_period else received,
+                returned=returned,
                 current_date=d,
-                due_from=self.registration.payment_requested and max(
+                due_from=self.registration.payment_requested
+                and max(
                     self.period.due_from,
                     self.registration.payment_requested.date(),
                 ),
-                due_date=self.registration.payment_requested and max(
+                due_date=self.registration.payment_requested
+                and max(
                     self.period.due_date,
-                    self.registration.payment_requested.date() + timedelta(
-                        days=self.registration.subject.min_due_date_days
-                    )
+                    self.registration.payment_requested.date()
+                    + timedelta(days=self.registration.subject.min_due_date_days),
                 ),
             ),
         )
 
 
 class CourseDiscount(SubjectDiscount):
     registration = models.ForeignKey(
         CourseRegistration,
         on_delete=models.CASCADE,
-        related_name='discounts',
-        verbose_name=_('registration'),
+        related_name="discounts",
+        verbose_name=_("registration"),
     )
     registration_period = models.ForeignKey(
         CourseRegistrationPeriod,
         on_delete=models.CASCADE,
-        related_name='discounts',
-        verbose_name=_('period'),
+        related_name="discounts",
+        verbose_name=_("period"),
     )
 
     @cached_property
     def period(self):
         return self.registration_period.period
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('course discount')
-        verbose_name_plural = _('course discounts')
-        ordering = ('accounted',)
+        app_label = "leprikon"
+        verbose_name = _("course discount")
+        verbose_name_plural = _("course discounts")
+        ordering = ("accounted",)
 
 
 class CourseRegistrationHistory(StartEndMixin, models.Model):
-    registration = models.ForeignKey(CourseRegistration, editable=False, on_delete=models.PROTECT,
-                                     related_name='course_history', verbose_name=_('course'))
-    course = models.ForeignKey(Course, editable=False, on_delete=models.PROTECT,
-                               related_name='registrations_history', verbose_name=_('course'))
+    registration = models.ForeignKey(
+        CourseRegistration,
+        editable=False,
+        on_delete=models.PROTECT,
+        related_name="course_history",
+        verbose_name=_("course"),
+    )
+    course = models.ForeignKey(
+        Course, editable=False, on_delete=models.PROTECT, related_name="registrations_history", verbose_name=_("course")
+    )
     start = models.DateField()
     end = models.DateField(blank=True, null=True)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('start',)
-        verbose_name = _('course registration history')
-        verbose_name_plural = _('course registration history')
+        app_label = "leprikon"
+        ordering = ("start",)
+        verbose_name = _("course registration history")
+        verbose_name_plural = _("course registration history")
 
     def __str__(self):
-        return '{course}, {start} - {end}'.format(
+        return "{course}, {start} - {end}".format(
             course=self.course.name,
-            start=date_format(self.start, 'SHORT_DATE_FORMAT'),
-            end=date_format(self.end, 'SHORT_DATE_FORMAT') if self.end else _('now'),
+            start=date_format(self.start, "SHORT_DATE_FORMAT"),
+            end=date_format(self.end, "SHORT_DATE_FORMAT") if self.end else _("now"),
         )
 
-    @property
-    def journal_entries(self):
-        qs = JournalEntry.objects.filter(subject_id=self.course_id, date__gte=self.start)
-        if self.end:
-            return qs.filter(date__lte=self.end)
-        else:
-            return qs
-
     def save(self, *args, **kwargs):
         if self.id:
             original = self.__class__.objects.get(id=self.id)
-            min_journal_date = original.journal_entries.aggregate(models.Min('date'))['date__min']
-            max_journal_date = original.journal_entries.aggregate(models.Max('date'))['date__max']
+            min_journal_date = original.journal_entries.aggregate(models.Min("date"))["date__min"]
+            max_journal_date = original.journal_entries.aggregate(models.Max("date"))["date__max"]
             # if journal entry exists, start must be set and lower or equal to min journal date
             if min_journal_date and self.start > min_journal_date:
                 self.start = min_journal_date
             # end can not be lower than max journal date
             if self.end and max_journal_date and self.end < max_journal_date:
                 self.end = max_journal_date
-        super(CourseRegistrationHistory, self).save(*args, **kwargs)
+        super().save(*args, **kwargs)
 
 
 @receiver(models.signals.post_save, sender=CourseRegistration)
 def update_course_registration_history(sender, instance, created, **kwargs):
     if instance.approved:
         d = date.today()
         # if created or changed
-        if (instance.course_history.count() == 0 or
-                instance.course_history.filter(end=None).exclude(course_id=instance.subject_id).update(end=d)):
+        if instance.course_history.count() == 0 or instance.course_history.filter(end=None).exclude(
+            course_id=instance.subject_id
+        ).update(end=d):
             # reopen or create entry starting today
             (
                 CourseRegistrationHistory.objects.filter(
-                    registration_id=instance.id, course_id=instance.subject_id, start=d,
-                ).update(end=None) or
-                CourseRegistrationHistory.objects.create(
-                    registration_id=instance.id, course_id=instance.subject_id, start=d,
+                    registration_id=instance.id,
+                    course_id=instance.subject_id,
+                    start=d,
+                ).update(end=None)
+                or CourseRegistrationHistory.objects.create(
+                    registration_id=instance.id,
+                    course_id=instance.subject_id,
+                    start=d,
                 )
             )
 
 
 class CoursePlugin(CMSPlugin):
-    course = models.ForeignKey(Course, on_delete=models.CASCADE, related_name='+', verbose_name=_('course'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_COURSE_TEMPLATES,
-                                default=settings.LEPRIKON_COURSE_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    course = models.ForeignKey(Course, on_delete=models.CASCADE, related_name="+", verbose_name=_("course"))
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_COURSE_TEMPLATES,
+        default=settings.LEPRIKON_COURSE_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
 
 class CourseListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    departments = models.ManyToManyField(Department, blank=True, related_name='+', verbose_name=_('departments'),
-                                         help_text=_('Keep empty to skip searching by departments.'))
-    course_types = models.ManyToManyField(SubjectType, blank=True,
-                                          limit_choices_to={'subject_type': SubjectType.COURSE},
-                                          related_name='+', verbose_name=_('course types'),
-                                          help_text=_('Keep empty to skip searching by course types.'))
-    age_groups = models.ManyToManyField(AgeGroup, blank=True, related_name='+', verbose_name=_('age groups'),
-                                        help_text=_('Keep empty to skip searching by age groups.'))
-    target_groups = models.ManyToManyField(TargetGroup, blank=True, related_name='+', verbose_name=_('target groups'),
-                                           help_text=_('Keep empty to skip searching by target groups.'))
-    groups = models.ManyToManyField(SubjectGroup, blank=True, related_name='+', verbose_name=_('course groups'),
-                                    help_text=_('Keep empty to skip searching by groups.'))
-    leaders = models.ManyToManyField(Leader, blank=True, related_name='+', verbose_name=_('leaders'),
-                                     help_text=_('Keep empty to skip searching by leaders.'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_COURSELIST_TEMPLATES,
-                                default=settings.LEPRIKON_COURSELIST_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    departments = models.ManyToManyField(
+        Department,
+        blank=True,
+        related_name="+",
+        verbose_name=_("departments"),
+        help_text=_("Keep empty to skip searching by departments."),
+    )
+    course_types = models.ManyToManyField(
+        SubjectType,
+        blank=True,
+        limit_choices_to={"subject_type": SubjectType.COURSE},
+        related_name="+",
+        verbose_name=_("course types"),
+        help_text=_("Keep empty to skip searching by course types."),
+    )
+    age_groups = models.ManyToManyField(
+        AgeGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("age groups"),
+        help_text=_("Keep empty to skip searching by age groups."),
+    )
+    target_groups = models.ManyToManyField(
+        TargetGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("target groups"),
+        help_text=_("Keep empty to skip searching by target groups."),
+    )
+    groups = models.ManyToManyField(
+        SubjectGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("course groups"),
+        help_text=_("Keep empty to skip searching by groups."),
+    )
+    leaders = models.ManyToManyField(
+        Leader,
+        blank=True,
+        related_name="+",
+        verbose_name=_("leaders"),
+        help_text=_("Keep empty to skip searching by leaders."),
+    )
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_COURSELIST_TEMPLATES,
+        default=settings.LEPRIKON_COURSELIST_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.departments.set(oldinstance.departments.all())
         self.course_types.set(oldinstance.course_types.all())
         self.groups.set(oldinstance.groups.all())
         self.age_groups.set(oldinstance.age_groups.all())
         self.target_groups.set(oldinstance.target_groups.all())
@@ -436,19 +404,20 @@
     def all_target_groups(self):
         return list(self.target_groups.all())
 
     @cached_property
     def all_leaders(self):
         return list(self.leaders.all())
 
-    Group = namedtuple('Group', ('group', 'objects'))
+    Group = namedtuple("Group", ("group", "objects"))
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
         courses = Course.objects.filter(school_year=school_year, public=True).distinct()
 
         if self.all_departments:
             courses = courses.filter(department__in=self.all_departments)
         if self.all_course_types:
             courses = courses.filter(subject_type__in=self.all_course_types)
         if self.all_age_groups:
@@ -461,52 +430,60 @@
             courses = courses.filter(groups__in=self.all_groups)
             groups = self.all_groups
         elif self.all_course_types:
             groups = SubjectGroup.objects.filter(subject_types__in=self.all_course_types)
         else:
             groups = SubjectGroup.objects.all()
 
-        context.update({
-            'school_year': school_year,
-            'courses': courses,
-            'groups': (
-                self.Group(group=group, objects=courses.filter(groups=group))
-                for group in groups
-            ),
-        })
+        context.update(
+            {
+                "school_year": school_year,
+                "courses": courses,
+                "groups": (self.Group(group=group, objects=courses.filter(groups=group)) for group in groups),
+            }
+        )
         return context
 
 
 class FilteredCourseListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    course_types = models.ManyToManyField(SubjectType, limit_choices_to={'subject_type': SubjectType.COURSE},
-                                          related_name='+', verbose_name=_('course types'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    course_types = models.ManyToManyField(
+        SubjectType,
+        limit_choices_to={"subject_type": SubjectType.COURSE},
+        related_name="+",
+        verbose_name=_("course types"),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.course_types.set(oldinstance.course_types.all())
 
     @cached_property
     def all_course_types(self):
         return list(self.course_types.all())
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
 
         from ..forms.subjects import SubjectFilterForm
+
         form = SubjectFilterForm(
             subject_type_type=SubjectType.COURSE,
             subject_types=self.all_course_types,
             school_year=school_year,
-            is_staff=context['request'].user.is_staff,
-            data=context['request'].GET,
+            is_staff=context["request"].user.is_staff,
+            data=context["request"].GET,
+        )
+        context.update(
+            {
+                "school_year": school_year,
+                "form": form,
+                "courses": form.get_queryset(),
+            }
         )
-        context.update({
-            'school_year': school_year,
-            'form': form,
-            'courses': form.get_queryset(),
-        })
         return context
```

### Comparing `leprikon-3.0.0/leprikon/models/department.py` & `leprikon-3.5.0/leprikon/models/department.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,19 +1,19 @@
 from django.db import models
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 
 class Department(models.Model):
-    name = models.CharField(_('name'), max_length=50)
-    code = models.PositiveSmallIntegerField(_('department code'), blank=True, default=0)
+    name = models.CharField(_("name"), max_length=50)
+    code = models.PositiveSmallIntegerField(_("department code"), blank=True, default=0)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('code', 'name')
-        verbose_name = _('department')
-        verbose_name_plural = _('departments')
+        app_label = "leprikon"
+        ordering = ("code", "name")
+        verbose_name = _("department")
+        verbose_name_plural = _("departments")
 
     def __str__(self):
         if self.code:
-            return '{code} {name}'.format(code=self.code, name=self.name)
+            return "{code} {name}".format(code=self.code, name=self.name)
         else:
-            return '{name}'.format(name=self.name)
+            return "{name}".format(name=self.name)
```

### Comparing `leprikon-3.0.0/leprikon/models/events.py` & `leprikon-3.5.0/leprikon/models/events.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,179 +1,238 @@
 from collections import namedtuple
 from datetime import date, datetime, timedelta
 
 from cms.models import CMSPlugin
 from django.db import models
 from django.utils.formats import date_format, time_format
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
+from ..utils import attributes
 from .agegroup import AgeGroup
 from .department import Department
 from .roles import Leader
-from .schoolyear import SchoolYear
-from .subjects import (
-    Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType,
-)
+from .schoolyear import SchoolYear, SchoolYearDivision
+from .subjects import Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType, SubjectVariant
 from .targetgroup import TargetGroup
-from .utils import PaymentStatus, change_year
+from .times import Time
+from .utils import PaymentStatus, change_year, copy_related_objects
 
 
 class Event(Subject):
-    start_date = models.DateField(_('start date'))
-    end_date = models.DateField(_('end date'))
-    start_time = models.TimeField(_('start time'), blank=True, null=True)
-    end_time = models.TimeField(_('end time'), blank=True, null=True)
-    due_from = models.DateField(_('due from'))
-    due_date = models.DateField(_('due date'))
+    start_date = models.DateField(_("start date"))
+    end_date = models.DateField(_("end date"))
+    start_time = models.TimeField(_("start time"), blank=True, null=True)
+    end_time = models.TimeField(_("end time"), blank=True, null=True)
+    due_from = models.DateField(_("due from"))
+    due_date = models.DateField(_("due date"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('start_date', 'start_time')
-        verbose_name = _('event')
-        verbose_name_plural = _('events')
+        app_label = "leprikon"
+        ordering = ("start_date", "start_time")
+        verbose_name = _("event")
+        verbose_name_plural = _("events")
 
     @property
     def inactive_registrations(self):
         return self.registrations.filter(canceled__isnull=False)
 
+    @attributes(short_description=_("times"))
     def event_date(self):
-        return '{start}{separator}{end}'.format(
-            start=(date_format(datetime.combine(self.start_date, self.start_time), 'SHORT_DATETIME_FORMAT')
-                   if self.start_time else date_format(self.start_date, 'SHORT_DATE_FORMAT')),
-            separator=' - ' if self.start_date != self.end_date or self.end_time is not None else '',
-            end=((time_format(self.end_time, 'TIME_FORMAT') if self.end_time else '')
-                 if self.start_date == self.end_date
-                 else (date_format(datetime.combine(self.end_date, self.end_time), 'SHORT_DATETIME_FORMAT')
-                       if self.end_time else date_format(self.end_date, 'SHORT_DATE_FORMAT'))),
+        return "{start}{separator}{end}".format(
+            start=(
+                date_format(datetime.combine(self.start_date, self.start_time), "SHORT_DATETIME_FORMAT")
+                if self.start_time
+                else date_format(self.start_date, "SHORT_DATE_FORMAT")
+            ),
+            separator=" - " if self.start_date != self.end_date or self.end_time is not None else "",
+            end=(
+                (time_format(self.end_time, "TIME_FORMAT") if self.end_time else "")
+                if self.start_date == self.end_date
+                else (
+                    date_format(datetime.combine(self.end_date, self.end_time), "SHORT_DATETIME_FORMAT")
+                    if self.end_time
+                    else date_format(self.end_date, "SHORT_DATE_FORMAT")
+                )
+            ),
         )
-    event_date.short_description = _('times')
-
-    Time = namedtuple('Time', ('date', 'start', 'end'))
 
     def get_next_time(self, now=None):
         if not now:
-            return self.Time(
+            return Time(
                 date=self.start_date,
                 start=self.start_time,
                 end=(self.end_time if self.end_date == self.start_date else None),
             )
         else:
             next_date = (now.date() if isinstance(now, datetime) else now) + timedelta(1)
-            return self.Time(
+            return Time(
                 date=next_date,
                 start=None,
                 end=(self.end_time if self.end_date == next_date else None),
             )
 
-    def copy_to_school_year(old, school_year):
+    def copy_to_school_year(old, school_year: SchoolYear):
         new = Event.objects.get(id=old.id)
         new.id, new.pk = None, None
         new.school_year = school_year
         new.public = False
-        new.evaluation = ''
-        new.note = ''
+        new.note = ""
         year_delta = school_year.year - old.school_year.year
-        new.reg_from = new.reg_from and change_year(new.reg_from, year_delta)
-        new.reg_to = new.reg_to and change_year(new.reg_to, year_delta)
         new.due_from = change_year(new.due_from, year_delta)
         new.due_date = change_year(new.due_date, year_delta)
         new.start_date = change_year(new.start_date, year_delta)
         new.end_date = change_year(new.end_date, year_delta)
         new.save()
         new.groups.set(old.groups.all())
         new.age_groups.set(old.age_groups.all())
         new.target_groups.set(old.target_groups.all())
         for leader in old.all_leaders:
             school_year.leaders.add(leader)
         new.leaders.set(old.all_leaders)
         new.questions.set(old.questions.all())
-        new.attachments.set(old.attachments.all())
+        for old_variant in old.all_variants:
+            new_variant = SubjectVariant.objects.get(id=old_variant.id)
+            new_variant.id, new_variant.pk = None, None
+            new_variant.subject = new
+            if old_variant.school_year_division:
+                new_variant.school_year_division = SchoolYearDivision.objects.filter(
+                    school_year=school_year,
+                    name=old_variant.school_year_division.name,
+                ).first() or old_variant.school_year_division.copy_to_school_year(school_year)
+            new_variant.reg_from = change_year(new_variant.reg_from, year_delta)
+            new_variant.reg_to = change_year(new_variant.reg_to, year_delta)
+            new_variant.save()
+            new_variant.age_groups.set(old_variant.age_groups.all())
+            new_variant.target_groups.set(old_variant.target_groups.all())
+        copy_related_objects(
+            new,
+            attachments=old.attachments,
+            times=old.times,
+        )
         return new
 
 
 class EventRegistration(SubjectRegistration):
     subject_type = SubjectType.EVENT
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('event registration')
-        verbose_name_plural = _('event registrations')
+        app_label = "leprikon"
+        verbose_name = _("event registration")
+        verbose_name_plural = _("event registrations")
 
     def get_payment_status(self, d=None):
         return PaymentStatus(
             price=self.price,
             discount=self.get_discounted(d),
-            explanation=',\n'.join(
+            explanation=",\n".join(
                 discount.explanation.strip()
                 for discount in self.all_discounts
                 if (d is None or discount.accounted.date() <= d) and discount.explanation.strip()
             ),
-            paid=self.get_paid(d),
+            received=self.get_received(d),
+            returned=self.get_returned(d),
             current_date=d or date.today(),
-            due_from=self.payment_requested and max(
+            due_from=self.payment_requested
+            and max(
                 self.subject.event.due_from,
                 self.payment_requested.date(),
             ),
-            due_date=self.payment_requested and max(
+            due_date=self.payment_requested
+            and max(
                 self.subject.event.due_date,
-                self.payment_requested.date() + timedelta(
-                    days=self.subject.min_due_date_days
-                )
+                self.payment_requested.date() + timedelta(days=self.subject.min_due_date_days),
             ),
         )
 
 
 class EventDiscount(SubjectDiscount):
-    registration = models.ForeignKey(EventRegistration, on_delete=models.CASCADE,
-                                     related_name='discounts', verbose_name=_('registration'))
+    registration = models.ForeignKey(
+        EventRegistration, on_delete=models.CASCADE, related_name="discounts", verbose_name=_("registration")
+    )
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('event discount')
-        verbose_name_plural = _('event discounts')
-        ordering = ('accounted',)
+        app_label = "leprikon"
+        verbose_name = _("event discount")
+        verbose_name_plural = _("event discounts")
+        ordering = ("accounted",)
 
 
 class EventPlugin(CMSPlugin):
-    event = models.ForeignKey(Event, on_delete=models.CASCADE, related_name='+', verbose_name=_('event'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_EVENT_TEMPLATES,
-                                default=settings.LEPRIKON_EVENT_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    event = models.ForeignKey(Event, on_delete=models.CASCADE, related_name="+", verbose_name=_("event"))
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_EVENT_TEMPLATES,
+        default=settings.LEPRIKON_EVENT_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
 
 class EventListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    departments = models.ManyToManyField(Department, blank=True, related_name='+', verbose_name=_('departments'),
-                                         help_text=_('Keep empty to skip searching by departments.'))
-    event_types = models.ManyToManyField(SubjectType, blank=True,
-                                         limit_choices_to={'subject_type': SubjectType.EVENT},
-                                         related_name='+', verbose_name=_('event types'),
-                                         help_text=_('Keep empty to skip searching by event types.'))
-    age_groups = models.ManyToManyField(AgeGroup, blank=True, related_name='+', verbose_name=_('age groups'),
-                                        help_text=_('Keep empty to skip searching by age groups.'))
-    target_groups = models.ManyToManyField(TargetGroup, blank=True, related_name='+', verbose_name=_('target groups'),
-                                           help_text=_('Keep empty to skip searching by target groups.'))
-    groups = models.ManyToManyField(SubjectGroup, blank=True, related_name='+', verbose_name=_('event groups'),
-                                    help_text=_('Keep empty to skip searching by groups.'))
-    leaders = models.ManyToManyField(Leader, verbose_name=_('leaders'), blank=True, related_name='+',
-                                     help_text=_('Keep empty to skip searching by leaders.'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_EVENTLIST_TEMPLATES,
-                                default=settings.LEPRIKON_EVENTLIST_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    departments = models.ManyToManyField(
+        Department,
+        blank=True,
+        related_name="+",
+        verbose_name=_("departments"),
+        help_text=_("Keep empty to skip searching by departments."),
+    )
+    event_types = models.ManyToManyField(
+        SubjectType,
+        blank=True,
+        limit_choices_to={"subject_type": SubjectType.EVENT},
+        related_name="+",
+        verbose_name=_("event types"),
+        help_text=_("Keep empty to skip searching by event types."),
+    )
+    age_groups = models.ManyToManyField(
+        AgeGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("age groups"),
+        help_text=_("Keep empty to skip searching by age groups."),
+    )
+    target_groups = models.ManyToManyField(
+        TargetGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("target groups"),
+        help_text=_("Keep empty to skip searching by target groups."),
+    )
+    groups = models.ManyToManyField(
+        SubjectGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("event groups"),
+        help_text=_("Keep empty to skip searching by groups."),
+    )
+    leaders = models.ManyToManyField(
+        Leader,
+        verbose_name=_("leaders"),
+        blank=True,
+        related_name="+",
+        help_text=_("Keep empty to skip searching by leaders."),
+    )
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_EVENTLIST_TEMPLATES,
+        default=settings.LEPRIKON_EVENTLIST_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.departments.set(oldinstance.departments.all())
         self.event_types.set(oldinstance.event_types.all())
         self.groups.set(oldinstance.groups.all())
         self.age_groups.set(oldinstance.age_groups.all())
         self.target_groups.set(oldinstance.target_groups.all())
@@ -199,19 +258,20 @@
     def all_target_groups(self):
         return list(self.target_groups.all())
 
     @cached_property
     def all_leaders(self):
         return list(self.leaders.all())
 
-    Group = namedtuple('Group', ('group', 'objects'))
+    Group = namedtuple("Group", ("group", "objects"))
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
         events = Event.objects.filter(school_year=school_year, public=True).distinct()
 
         if self.all_departments:
             events = events.filter(department__in=self.all_departments)
         if self.all_event_types:
             events = events.filter(subject_type__in=self.all_event_types)
         if self.all_age_groups:
@@ -224,52 +284,60 @@
             events = events.filter(groups__in=self.all_groups)
             groups = self.all_groups
         elif self.all_event_types:
             groups = SubjectGroup.objects.filter(subject_types__in=self.all_event_types)
         else:
             groups = SubjectGroup.objects.all()
 
-        context.update({
-            'school_year': school_year,
-            'events': events,
-            'groups': (
-                self.Group(group=group, objects=events.filter(groups=group))
-                for group in groups
-            ),
-        })
+        context.update(
+            {
+                "school_year": school_year,
+                "events": events,
+                "groups": (self.Group(group=group, objects=events.filter(groups=group)) for group in groups),
+            }
+        )
         return context
 
 
 class FilteredEventListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    event_types = models.ManyToManyField(SubjectType, limit_choices_to={'subject_type': SubjectType.EVENT},
-                                         related_name='+', verbose_name=_('event types'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    event_types = models.ManyToManyField(
+        SubjectType,
+        limit_choices_to={"subject_type": SubjectType.EVENT},
+        related_name="+",
+        verbose_name=_("event types"),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.event_types.set(oldinstance.event_types.all())
 
     @cached_property
     def all_event_types(self):
         return list(self.event_types.all())
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
 
         from ..forms.subjects import SubjectFilterForm
+
         form = SubjectFilterForm(
             subject_type_type=SubjectType.EVENT,
             subject_types=self.all_event_types,
             school_year=school_year,
-            is_staff=context['request'].user.is_staff,
-            data=context['request'].GET,
+            is_staff=context["request"].user.is_staff,
+            data=context["request"].GET,
+        )
+        context.update(
+            {
+                "school_year": school_year,
+                "form": form,
+                "events": form.get_queryset(),
+            }
         )
-        context.update({
-            'school_year': school_year,
-            'form': form,
-            'events': form.get_queryset(),
-        })
         return context
```

### Comparing `leprikon-3.0.0/leprikon/models/fields.py` & `leprikon-3.5.0/leprikon/models/fields.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,136 +1,198 @@
 import re
+from typing import Any, Optional
 
+from cms.forms.fields import PageSelectFormField
 from django import forms
 from django.core.exceptions import ValidationError
 from django.core.validators import RegexValidator
 from django.db import models
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from localflavor.cz.forms import CZPostalCodeField
 
 from ..conf import settings
 from ..utils import get_birth_date
+from .utils import BankAccount, parse_bank_account
 
 
 class ColorInput(forms.TextInput):
-    input_type = 'color'
+    input_type = "color"
 
 
 class ColorField(models.CharField):
-    default_validators = [RegexValidator(
-        re.compile('^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$'),
-        _('Enter a valid hex color.'),
-        'invalid',
-    )]
+    default_validators = [
+        RegexValidator(
+            re.compile("^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"),
+            _("Enter a valid hex color."),
+            "invalid",
+        )
+    ]
 
     def __init__(self, *args, **kwargs):
-        kwargs['max_length'] = 10
-        super(ColorField, self).__init__(*args, **kwargs)
+        kwargs["max_length"] = 10
+        super().__init__(*args, **kwargs)
 
     def formfield(self, **kwargs):
-        kwargs['widget'] = ColorInput
-        return super(ColorField, self).formfield(**kwargs)
+        kwargs["widget"] = ColorInput
+        return super().formfield(**kwargs)
 
 
 class EmailField(models.EmailField):
     def to_python(self, value):
-        v = super(EmailField, self).to_python(value)
+        v = super().to_python(value)
         return v and v.lower()
 
 
 class PriceField(models.DecimalField):
     def __init__(self, *args, **kwargs):
-        kwargs.setdefault('decimal_places', settings.PRICE_DECIMAL_PLACES)
-        kwargs.setdefault('max_digits', settings.PRICE_MAX_DIGITS)
-        super(PriceField, self).__init__(*args, **kwargs)
+        kwargs.setdefault("decimal_places", settings.PRICE_DECIMAL_PLACES)
+        kwargs.setdefault("max_digits", settings.PRICE_MAX_DIGITS)
+        super().__init__(*args, **kwargs)
 
 
 DAY_OF_WEEK = {
-    1: _('Monday'),
-    2: _('Tuesday'),
-    3: _('Wednesday'),
-    4: _('Thursday'),
-    5: _('Friday'),
-    6: _('Saturday'),
-    7: _('Sunday'),
+    1: _("Monday"),
+    2: _("Tuesday"),
+    3: _("Wednesday"),
+    4: _("Thursday"),
+    5: _("Friday"),
+    6: _("Saturday"),
+    7: _("Sunday"),
 }
 
 
 class DayOfWeekField(models.IntegerField):
     def __init__(self, *args, **kwargs):
         defaults = {
-            'choices': tuple(sorted(DAY_OF_WEEK.items())),
+            "choices": tuple(sorted(DAY_OF_WEEK.items())),
         }
         defaults.update(kwargs)
-        super(DayOfWeekField, self).__init__(*args, **defaults)
+        super().__init__(*args, **defaults)
 
 
-birth_num_regex = re.compile('^[0-9]{2}([0257][1-9]|[1368][0-2])[0-3][0-9]/?[0-9]{3,4}$')
+birth_num_regex = re.compile("^[0-9]{2}([0257][1-9]|[1368][0-2])[0-3][0-9]/?[0-9]{3,4}$")
 
 
 def validate_birth_num(value):
     try:
         assert birth_num_regex.match(value) is not None
         get_birth_date(value)
-        value = value.replace('/', '')
+        value = value.replace("/", "")
         if len(value) > 9:
             assert int(value) % 11 == 0
     except Exception:
         raise ValidationError(
-            message=_('Enter a valid birth number.'),
-            code='invalid',
+            message=_("Enter a valid birth number."),
+            code="invalid",
         )
 
 
 class BirthNumberFormField(forms.CharField):
     default_validators = [validate_birth_num]
 
 
 class BirthNumberField(models.CharField):
     default_validators = [validate_birth_num]
 
     def __init__(self, *args, **kwargs):
-        kwargs['max_length'] = 11
-        super(BirthNumberField, self).__init__(*args, **kwargs)
+        kwargs["max_length"] = 11
+        super().__init__(*args, **kwargs)
 
     def deconstruct(self):
-        name, path, args, kwargs = super(BirthNumberField, self).deconstruct()
-        del kwargs['max_length']
+        name, path, args, kwargs = super().deconstruct()
+        if kwargs["max_length"] == 11:
+            del kwargs["max_length"]
         return name, path, args, kwargs
 
     def clean(self, value, model_instance):
-        value = super(BirthNumberField, self).clean(value, model_instance)
-        return value if value[6] == '/' else '{}/{}'.format(value[:6], value[6:])
+        value = super().clean(value, model_instance)
+        return value if value[6] == "/" else "{}/{}".format(value[:6], value[6:])
 
     def formfield(self, **kwargs):
-        kwargs.setdefault('form_class', BirthNumberFormField)
+        kwargs.setdefault("form_class", BirthNumberFormField)
         return super().formfield(**kwargs)
 
 
+class BankAccountFormField(forms.CharField):
+    validators = [parse_bank_account]
+
+
+class BankAccountField(models.CharField):
+    def __init__(self, *args, **kwargs):
+        kwargs.setdefault("max_length", 34)
+        super().__init__(*args, **kwargs)
+        self.validators = [parse_bank_account]
+
+    def deconstruct(self):
+        name, path, args, kwargs = super().deconstruct()
+        if kwargs["max_length"] == 34:
+            del kwargs["max_length"]
+        return name, path, args, kwargs
+
+    def formfield(self, **kwargs):
+        kwargs.setdefault("form_class", BankAccountFormField)
+        return super().formfield(**kwargs)
+
+    def from_db_value(self, value: Optional[str], expression, connection):
+        if value is None:
+            return value
+        return BankAccount(value)
+
+    def get_prep_value(self, value: Optional[BankAccount]) -> Optional[str]:
+        return value and value.compact
+
+    def to_python(self, value: Any) -> Optional[BankAccount]:
+        if value is None:
+            return value
+        return parse_bank_account(value)
+
+
 class _PostalCodeField(CZPostalCodeField, forms.CharField):
-    '''
+    """
     CZPostalCodeField derived from CharField instead of just Field
     to support max_length
-    '''
+    """
 
 
 class PostalCodeField(models.CharField):
     def __init__(self, *args, **kwargs):
-        defaults = {'max_length': 6}
+        defaults = {"max_length": 6}
         defaults.update(kwargs)
-        super(PostalCodeField, self).__init__(*args, **defaults)
+        super().__init__(*args, **defaults)
 
     def deconstruct(self):
-        name, path, args, kwargs = super(PostalCodeField, self).deconstruct()
+        name, path, args, kwargs = super().deconstruct()
         del kwargs["max_length"]
         return name, path, args, kwargs
 
     def formfield(self, **kwargs):
-        defaults = {'form_class': _PostalCodeField}
+        defaults = {"form_class": _PostalCodeField}
         defaults.update(kwargs)
-        return super(PostalCodeField, self).formfield(**defaults)
+        return super().formfield(**defaults)
 
     def clean(self, value, model_instance):
-        return super(PostalCodeField, self).clean(
-            value[3] == ' ' and value or '{} {}'.format(value[:3], value[3:]),
+        return super().clean(
+            value[3] == " " and value or "{} {}".format(value[:3], value[3:]),
             model_instance,
         )
+
+
+class UniquePageField(models.OneToOneField):
+    """
+    This is a copy of PageField based on OneToOneField instead of ForeignKey.
+    """
+
+    default_form_class = PageSelectFormField
+
+    def __init__(self, **kwargs):
+        # We hard-code the `to` argument for ForeignKey.__init__
+        # since a PageField can only be a ForeignKey to a Page
+        kwargs["to"] = "cms.Page"
+        kwargs["on_delete"] = kwargs.get("on_delete", models.CASCADE)
+        super().__init__(**kwargs)
+
+    def formfield(self, **kwargs):
+        defaults = {
+            "form_class": self.default_form_class,
+        }
+        defaults.update(kwargs)
+        return super().formfield(**defaults)
```

### Comparing `leprikon-3.0.0/leprikon/models/journals.py` & `leprikon-3.5.0/leprikon/views/journals.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,165 +1,182 @@
-from datetime import datetime, timedelta
-
-from django.db import models
-from django.urls import reverse_lazy as reverse
-from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
-from djangocms_text_ckeditor.fields import HTMLField
-
-from .startend import StartEndMixin
-from .subjects import Subject, SubjectRegistrationParticipant
-
-
-class JournalEntry(StartEndMixin, models.Model):
-    subject = models.ForeignKey(Subject, editable=False, on_delete=models.PROTECT,
-                                related_name='journal_entries', verbose_name=_('subject'))
-    date = models.DateField(_('date'))
-    start = models.TimeField(_('start time'), blank=True, null=True)
-    end = models.TimeField(_('end time'), blank=True, null=True)
-    agenda = HTMLField(_('session agenda'), default='')
-    participants = models.ManyToManyField(SubjectRegistrationParticipant, blank=True,
-                                          related_name='journal_entries', verbose_name=_('participants'))
-    participants_instructed = models.ManyToManyField(
-        SubjectRegistrationParticipant, blank=True, related_name='instructed',
-        verbose_name=_('participants instructed about safety and internal rules'),
-    )
-
-    class Meta:
-        app_label = 'leprikon'
-        ordering = ('date', 'start', 'end')
-        verbose_name = _('journal entry')
-        verbose_name_plural = _('journal entries')
-
-    def __str__(self):
-        return '{subject_name}, {date}, {duration}'.format(
-            subject_name=self.subject.name,
-            date=self.date,
-            duration=self.duration,
-        )
-
-    @cached_property
-    def datetime_start(self):
-        try:
-            return datetime.combine(self.date, self.start)
-        except TypeError:
-            return None
-
-    @cached_property
-    def datetime_end(self):
-        try:
-            return datetime.combine(self.date, self.end)
-        except TypeError:
-            return None
-
-    @cached_property
-    def duration(self):
-        try:
-            return self.datetime_end - self.datetime_start
-        except TypeError:
-            return timedelta()
-    duration.short_description = _('duration')
-
-    @cached_property
-    def all_participants(self):
-        return list(self.participants.all())
-
-    @cached_property
-    def all_participants_instructed(self):
-        return list(self.participants_instructed.all())
-
-    @cached_property
-    def all_participants_idset(self):
-        return set(r.id for r in self.all_participants)
-
-    @cached_property
-    def all_leader_entries(self):
-        return list(self.leader_entries.all())
-
-    @cached_property
-    def all_leader_entries_by_leader(self):
-        return dict((e.timesheet.leader, e) for e in self.all_leader_entries)
-
-    @cached_property
-    def all_leaders(self):
-        return list(
-            le.timesheet.leader for le in self.all_leader_entries
-            if le.timesheet.leader in self.subject.all_leaders
-        )
-
-    @cached_property
-    def all_alternates(self):
-        return list(
-            le.timesheet.leader for le in self.all_leader_entries
-            if le.timesheet.leader not in self.subject.all_leaders
+from django.http import Http404
+from django.shortcuts import get_object_or_404
+from django.urls.base import reverse_lazy as reverse
+from django.utils.translation import gettext_lazy as _
+
+from ..forms.journals import JournalCreateForm, JournalEntryForm, JournalLeaderEntryForm, JournalUpdateForm
+from ..models.journals import Journal, JournalEntry, JournalLeaderEntry, Subject
+from ..utils import reverse_with_back
+from .generic import CreateView, DeleteView, DetailView, TemplateView, UpdateView
+
+
+class AlternatingView(TemplateView):
+    template_name = "leprikon/alternating.html"
+
+    def get_title(self):
+        return _("Alternating in school year {}").format(self.request.school_year)
+
+    def get_context_data(self, **kwargs):
+        context = super().get_context_data(**kwargs)
+        context["alternate_leader_entries"] = self.request.leader.get_alternate_leader_entries(self.request.school_year)
+        return context
+
+
+class JournalQuerySetMixin:
+    def get_queryset(self):
+        qs = super().get_queryset()
+        if not self.request.user.is_staff:
+            qs = qs.filter(leaders=self.request.leader)
+        return qs
+
+
+class JournalView(JournalQuerySetMixin, DetailView):
+    model = Journal
+    template_name_suffix = "_journal"
+
+
+class JournalCreateView(CreateView):
+    model = Journal
+    form_class = JournalCreateForm
+    template_name = "leprikon/journal_form.html"
+    title = _("New journal")
+
+    def dispatch(self, request, subject):
+        kwargs = {"id": subject}
+        if not self.request.user.is_staff:
+            kwargs["leaders"] = self.request.leader
+        self.subject = get_object_or_404(Subject, **kwargs)
+        return super().dispatch(request)
+
+    def get_form_kwargs(self):
+        kwargs = super().get_form_kwargs()
+        kwargs["subject"] = self.subject
+        return kwargs
+
+    def get_message(self):
+        return _("New journal {} has been created.").format(self.object)
+
+    def get_success_url(self):
+        return reverse_with_back(self.request, "leprikon:journal_update", args=(self.object.id,))
+
+
+class JournalUpdateView(JournalQuerySetMixin, UpdateView):
+    model = Journal
+    form_class = JournalUpdateForm
+    success_url = reverse("leprikon:summary")
+    template_name = "leprikon/journal_form.html"
+    title = _("Change journal")
+
+
+class JournalDeleteView(DeleteView):
+    model = Journal
+    title = _("Delete journal")
+    message = _("Journal has been deleted.")
+
+    def get_queryset(self):
+        qs = super().get_queryset()
+        if not self.request.user.is_staff:
+            qs = qs.filter(subject__leaders=self.request.leader)
+        return qs
+
+    def get_object(self):
+        obj = super().get_object()
+        if obj.all_journal_entries:
+            raise Http404()
+        return obj
+
+    def get_question(self):
+        return _("Do You really want to delete the journal {}?").format(self.object)
+
+
+class JournalEntryCreateView(CreateView):
+    model = JournalEntry
+    form_class = JournalEntryForm
+    template_name = "leprikon/journalentry_form.html"
+    title = _("New journal entry")
+    message = _("The journal entry has been created.")
+
+    def dispatch(self, request, *args, **kwargs):
+        if self.request.user.is_staff:
+            self.journal = get_object_or_404(Journal, id=int(kwargs.pop("journal")))
+        else:
+            self.journal = get_object_or_404(Journal, id=int(kwargs.pop("journal")), leaders=self.request.leader)
+        return super().dispatch(request, *args, **kwargs)
+
+    def get_form_kwargs(self):
+        kwargs = super().get_form_kwargs()
+        kwargs["journal"] = self.journal
+        return kwargs
+
+
+class JournalEntryUpdateView(UpdateView):
+    model = JournalEntry
+    form_class = JournalEntryForm
+    template_name = "leprikon/journalentry_form.html"
+    title = _("Change journal entry")
+    message = _("The journal entry has been updated.")
+
+    def get_object(self):
+        obj = super().get_object()
+        if self.request.user.is_staff or self.request.leader in obj.journal.all_leaders + obj.all_alternates:
+            return obj
+        else:
+            raise Http404()
+
+
+class JournalEntryDeleteView(DeleteView):
+    model = JournalEntry
+    title = _("Delete journal entry")
+    message = _("The journal entry has been deleted.")
+
+    def get_queryset(self):
+        qs = super().get_queryset()
+        if not self.request.user.is_staff:
+            qs = qs.filter(journal__leaders=self.request.leader)
+        return qs
+
+    def get_object(self):
+        obj = super().get_object()
+        if obj.affects_submitted_timesheets:
+            raise Http404()
+        return obj
+
+    def get_question(self):
+        return _("Do You really want to delete journal entry?")
+
+
+class JournalLeaderEntryUpdateView(UpdateView):
+    model = JournalLeaderEntry
+    form_class = JournalLeaderEntryForm
+    template_name = "leprikon/journalleaderentry_form.html"
+    title = _("Change timesheet entry")
+    message = _("The timesheet entry has been updated.")
+
+    def get_object(self):
+        obj = super().get_object()
+        if (
+            self.request.user.is_staff
+            or obj.timesheet.leader == self.request.leader
+            or self.request.leader in obj.journal_entry.journal.all_leaders
+        ):
+            return obj
+        else:
+            raise Http404()
+
+
+class JournalLeaderEntryDeleteView(DeleteView):
+    model = JournalLeaderEntry
+    title = _("Delete timesheet entry")
+    message = _("The timesheet entry has been deleted.")
+
+    def get_queryset(self):
+        return (
+            super()
+            .get_queryset()
+            .filter(
+                timesheet__leader=self.request.leader,
+                timesheet__submitted=False,
+            )
         )
 
-    @cached_property
-    def affects_submitted_timesheets(self):
-        return self.leader_entries.filter(timesheet__submitted=True).exists()
-
-    def save(self, *args, **kwargs):
-        if self.end is None:
-            self.end = self.start
-        super(JournalEntry, self).save(*args, **kwargs)
-
-    def get_edit_url(self):
-        return reverse('leprikon:journalentry_update', args=(self.id,))
-
-    def get_delete_url(self):
-        return reverse('leprikon:journalentry_delete', args=(self.id,))
-
-
-class JournalLeaderEntry(StartEndMixin, models.Model):
-    journal_entry = models.ForeignKey(JournalEntry, editable=False, on_delete=models.CASCADE,
-                                      related_name='leader_entries', verbose_name=_('journal entry'))
-    timesheet = models.ForeignKey('leprikon.Timesheet', editable=False, on_delete=models.PROTECT,
-                                  related_name='journal_entries', verbose_name=_('timesheet'))
-    start = models.TimeField(_('start time'))
-    end = models.TimeField(_('end time'))
-
-    class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('journal leader entry')
-        verbose_name_plural = _('journal leader entries')
-        unique_together = (('journal_entry', 'timesheet'),)
-
-    def __str__(self):
-        return '{subject_name}, {date}, {duration}'.format(
-            subject_name=self.journal_entry.subject.name,
-            date=self.journal_entry.date,
-            duration=self.duration,
-        )
-
-    @cached_property
-    def date(self):
-        return self.journal_entry.date
-    date.short_description = _('date')
-    date.admin_order_field = 'journal_entry__date'
-
-    @cached_property
-    def subject(self):
-        return self.journal_entry.subject
-    subject.short_description = _('subject')
-
-    @cached_property
-    def datetime_start(self):
-        return datetime.combine(self.date, self.start)
-
-    @cached_property
-    def datetime_end(self):
-        return datetime.combine(self.date, self.end)
-
-    @cached_property
-    def duration(self):
-        return self.datetime_end - self.datetime_start
-    duration.short_description = _('duration')
-
-    @property
-    def group(self):
-        return self.subject
-
-    def get_edit_url(self):
-        return reverse('leprikon:journalleaderentry_update', args=(self.id,))
-
-    def get_delete_url(self):
-        return reverse('leprikon:journalleaderentry_delete', args=(self.id,))
+    def get_question(self):
+        return _("Do You really want to delete timesheet entry?")
```

### Comparing `leprikon-3.0.0/leprikon/models/leprikonsite.py` & `leprikon-3.5.0/leprikon/models/leprikonsite.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 from time import time
 
 from django.contrib.sites.models import Site
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from django_pays.models import Gateway
 from djangocms_text_ckeditor.fields import HTMLField
 
 from ..conf import settings
 from .account import AccountClosure
 from .agreements import Agreement
 from .organizations import Organization
@@ -18,52 +18,92 @@
     _cached_site = None
     _cache_timestamp = None
 
     def get_current(self):
         now = time()
         if not self._cached_site or now - self._cache_timestamp > settings.LEPRIKON_SITE_CACHE_MAX_AGE:
             lookup_kwargs = {}
-            if getattr(settings, 'SITE_ID', ''):
-                lookup_kwargs['pk'] = settings.SITE_ID
+            if getattr(settings, "SITE_ID", ""):
+                lookup_kwargs["pk"] = settings.SITE_ID
             self._cached_site = self.get_or_create(**lookup_kwargs)[0]
             self._cache_timestamp = now
         return self._cached_site
 
     def get_queryset(self):
-        return super(LeprikonSiteManager, self).get_queryset().select_related(
-            'bill_print_setup',
-            'reg_print_setup',
+        return (
+            super()
+            .get_queryset()
+            .select_related(
+                "bill_print_setup",
+                "reg_print_setup",
+            )
         )
 
 
 class LeprikonSite(Site):
-    organization = models.ForeignKey(Organization, blank=True, null=True, on_delete=models.SET_NULL,
-                                     related_name='+', verbose_name=_('default organization'))
-    reg_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                        related_name='+', verbose_name=_('default registration print setup'))
-    pr_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                       related_name='+', verbose_name=_('default payment request print setup'))
-    bill_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                         related_name='+', verbose_name=_('default bill print setup'))
-    user_agreement = HTMLField(_('user agreement'), blank=True, default='')
-    user_agreement_changed = models.DateTimeField(_('last time user agreement changed'), blank=True, null=True)
+    organization = models.ForeignKey(
+        Organization,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("default organization"),
+    )
+    reg_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("default registration print setup"),
+    )
+    decision_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("default decision print setup"),
+    )
+    pr_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("default payment request print setup"),
+    )
+    bill_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("default bill print setup"),
+    )
+    user_agreement = HTMLField(_("user agreement"), blank=True, default="")
+    user_agreement_changed = models.DateTimeField(_("last time user agreement changed"), blank=True, null=True)
     registration_agreements = models.ManyToManyField(
-        Agreement, blank=True, related_name='+', verbose_name=_('default registration agreements'),
-        help_text=_('Add legal agreements for the registration form.'),
+        Agreement,
+        blank=True,
+        related_name="+",
+        verbose_name=_("default registration agreements"),
+        help_text=_("Add legal agreements for the registration form."),
+    )
+    payment_gateway = models.ForeignKey(
+        Gateway, blank=True, null=True, on_delete=models.SET_NULL, related_name="+", verbose_name=_("Payment Gateway")
     )
-    payment_gateway = models.ForeignKey(Gateway, blank=True, null=True, on_delete=models.SET_NULL,
-                                        related_name='+', verbose_name=_('Payment Gateway'))
 
     objects = LeprikonSiteManager()
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('leprikon site')
-        verbose_name_plural = _('leprikon sites')
+        app_label = "leprikon"
+        verbose_name = _("leprikon site")
+        verbose_name_plural = _("leprikon sites")
 
     @cached_property
     def max_closure_date(self):
         return AccountClosure.objects.max_closure_date()
 
     @cached_property
     def url(self):
-        return settings.LEPRIKON_URL or f'https://{self.domain}'
+        return settings.LEPRIKON_URL or f"https://{self.domain}"
```

### Comparing `leprikon-3.0.0/leprikon/models/messages.py` & `leprikon-3.5.0/leprikon/models/messages.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,111 +1,123 @@
 import uuid
 
 from django.core.mail import EmailMultiAlternatives
 from django.db import models
 from django.template.loader import get_template
 from django.urls import reverse_lazy as reverse
-from django.utils.encoding import force_text
 from django.utils.functional import cached_property
 from django.utils.timezone import now
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from djangocms_text_ckeditor.fields import HTMLField
 from filer.fields.file import FilerFileField
 
 from ..conf import settings
 from .leprikonsite import LeprikonSite
 
 
 class Message(models.Model):
-    created = models.DateTimeField(_('created'), editable=False, auto_now_add=True)
-    sender = models.ForeignKey(settings.AUTH_USER_MODEL, limit_choices_to={'is_staff': True}, null=True,
-                               on_delete=models.SET_NULL, related_name='+', verbose_name=_('sender'))
-    subject = models.CharField(_('subject'), max_length=150)
-    text = HTMLField(_('text'), default='')
+    created = models.DateTimeField(_("created"), editable=False, auto_now_add=True)
+    sender = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        limit_choices_to={"is_staff": True},
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("sender"),
+    )
+    subject = models.CharField(_("subject"), max_length=150)
+    text = HTMLField(_("text"), default="")
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('-created',)
-        verbose_name = _('message')
-        verbose_name_plural = _('messages')
+        app_label = "leprikon"
+        ordering = ("-created",)
+        verbose_name = _("message")
+        verbose_name_plural = _("messages")
 
     def __str__(self):
-        return '{}'.format(self.subject)
+        return "{}".format(self.subject)
 
     @cached_property
     def all_attachments(self):
         return list(self.attachments.all())
 
     @cached_property
     def all_recipients(self):
         return list(self.recipients.all())
 
 
 class MessageRecipient(models.Model):
     slug = models.SlugField(editable=False)
-    message = models.ForeignKey(Message, editable=False, on_delete=models.CASCADE,
-                                related_name='recipients', verbose_name=_('message'))
-    recipient = models.ForeignKey(settings.AUTH_USER_MODEL, editable=False, on_delete=models.CASCADE,
-                                  related_name='leprikon_messages', verbose_name=_('recipient'))
-    sent = models.DateTimeField(_('sent'), editable=False, auto_now_add=True)
-    viewed = models.DateTimeField(_('viewed on site'), editable=False, null=True, default=None)
-    sent_mail = models.DateTimeField(_('sent by email'), editable=False, null=True, default=None)
+    message = models.ForeignKey(
+        Message, editable=False, on_delete=models.CASCADE, related_name="recipients", verbose_name=_("message")
+    )
+    recipient = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        on_delete=models.CASCADE,
+        related_name="leprikon_messages",
+        verbose_name=_("recipient"),
+    )
+    sent = models.DateTimeField(_("sent"), editable=False, auto_now_add=True)
+    viewed = models.DateTimeField(_("viewed on site"), editable=False, null=True, default=None)
+    sent_mail = models.DateTimeField(_("sent by email"), editable=False, null=True, default=None)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('recipient')
-        verbose_name_plural = _('recipients')
-        ordering = ('-sent',)
-        unique_together = (('message', 'recipient'),)
+        app_label = "leprikon"
+        verbose_name = _("recipient")
+        verbose_name_plural = _("recipients")
+        ordering = ("-sent",)
+        unique_together = (("message", "recipient"),)
 
     def __str__(self):
-        return '{} ({})'.format(self.recipient.get_username(), self.recipient.get_full_name())
+        return "{} ({})".format(self.recipient.get_username(), self.recipient.get_full_name())
 
     def save(self, *args, **kwargs):
         if not self.slug:
             self.slug = uuid.uuid4()
             while MessageRecipient.objects.filter(slug=self.slug).exists():
                 self.slug = uuid.uuid4()
-        super(MessageRecipient, self).save(*args, **kwargs)
+        super().save(*args, **kwargs)
 
     def get_absolute_url(self):
-        return reverse('leprikon:message_detail', args=(self.slug,))
+        return reverse("leprikon:message_detail", args=(self.slug,))
 
     def send_mail(self):
         context = {
-            'message_recipient': self,
-            'site': LeprikonSite.objects.get_current(),
+            "message_recipient": self,
+            "site": LeprikonSite.objects.get_current(),
         }
         if self.message.sender_id:
             from_email = f'"{self.message.sender.get_full_name()}" <{settings.SERVER_EMAIL_PLAIN}>'
             reply_to = f'"{self.message.sender.get_full_name()}" <{self.message.sender.email}>'
         else:
             from_email = settings.SERVER_EMAIL
             reply_to = None
         msg = EmailMultiAlternatives(
             subject=self.message.subject,
-            body=get_template('leprikon/message_mail.txt').render(context),
+            body=get_template("leprikon/message_mail.txt").render(context),
             from_email=from_email,
             to=[self.recipient.email],
-            headers={'X-Mailer': 'Leprikon (http://leprikon.cz/)'},
+            headers={"X-Mailer": "Leprikon (http://leprikon.cz/)"},
             reply_to=[reply_to],
         )
-        msg.attach_alternative(get_template('leprikon/message_mail.html').render(context), 'text/html')
+        msg.attach_alternative(get_template("leprikon/message_mail.html").render(context), "text/html")
         for attachment in self.message.attachments.all():
             msg.attach_file(attachment.file.file.path)
         msg.send()
         self.sent_mail = now()
         self.save()
 
 
 class MessageAttachment(models.Model):
-    message = models.ForeignKey(Message, on_delete=models.CASCADE,
-                                related_name='attachments', verbose_name=_('message'))
-    file = FilerFileField(on_delete=models.CASCADE, related_name='+')
+    message = models.ForeignKey(
+        Message, on_delete=models.CASCADE, related_name="attachments", verbose_name=_("message")
+    )
+    file = FilerFileField(on_delete=models.CASCADE, related_name="+")
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('attachment')
-        verbose_name_plural = _('attachments')
+        app_label = "leprikon"
+        verbose_name = _("attachment")
+        verbose_name_plural = _("attachments")
 
     def __str__(self):
-        return force_text(self.file)
+        return str(self.file)
```

### Comparing `leprikon-3.0.0/leprikon/models/orderables.py` & `leprikon-3.5.0/leprikon/models/orderables.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,106 +1,126 @@
 from collections import namedtuple
 from datetime import date, datetime, timedelta
 
 from cms.models import CMSPlugin
 from django.db import models
 from django.utils.formats import date_format, time_format
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
+from ..utils import attributes
 from .agegroup import AgeGroup
 from .department import Department
 from .roles import Leader
-from .schoolyear import SchoolYear
-from .subjects import (
-    Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType,
-)
+from .schoolyear import SchoolYear, SchoolYearDivision
+from .subjects import Subject, SubjectDiscount, SubjectGroup, SubjectRegistration, SubjectType, SubjectVariant
 from .targetgroup import TargetGroup
-from .utils import PaymentStatus
+from .utils import PaymentStatus, change_year, copy_related_objects
 
 
 class Orderable(Subject):
-    duration = models.DurationField(_('duration'), help_text=_('Format: HH:MM:SS'))
+    duration = models.DurationField(_("duration"), help_text=_("Format: HH:MM:SS"))
     due_from_days = models.IntegerField(
-        _('number of days to send the payment request before event date'), blank=True, null=True,
+        _("number of days to send the payment request before event date"),
+        blank=True,
+        null=True,
         help_text=_(
-            'If set, payment request will be sent this number of days before event date. '
-            'If not set, payment request will be sent when registration is approved.'
+            "If set, payment request will be sent this number of days before event date. "
+            "If not set, payment request will be sent when registration is approved."
         ),
     )
-    due_date_days = models.IntegerField(_('number of days to due date before event date'), default=0)
+    due_date_days = models.IntegerField(_("number of days to due date before event date"), default=0)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('code', 'name')
-        verbose_name = _('orderable event')
-        verbose_name_plural = _('orderable events')
+        app_label = "leprikon"
+        ordering = ("code", "name")
+        verbose_name = _("orderable event")
+        verbose_name_plural = _("orderable events")
 
     @property
     def inactive_registrations(self):
         return self.registrations.filter(canceled__isnull=False)
 
+    @attributes(short_description=_("duration"))
     def get_times_list(self):
         return self.duration
-    get_times_list.short_description = _('duration')
 
-    def copy_to_school_year(old, school_year):
+    def copy_to_school_year(old, school_year: SchoolYear):
         new = Orderable.objects.get(id=old.id)
         new.id, new.pk = None, None
         new.school_year = school_year
         new.public = False
-        new.evaluation = ''
-        new.note = ''
+        new.note = ""
+        year_delta = school_year.year - old.school_year.year
         new.save()
         new.groups.set(old.groups.all())
         new.age_groups.set(old.age_groups.all())
         new.target_groups.set(old.target_groups.all())
         for leader in old.all_leaders:
             school_year.leaders.add(leader)
         new.leaders.set(old.all_leaders)
         new.questions.set(old.questions.all())
-        new.attachments.set(old.attachments.all())
+        for old_variant in old.all_variants:
+            new_variant = SubjectVariant.objects.get(id=old_variant.id)
+            new_variant.id, new_variant.pk = None, None
+            new_variant.subject = new
+            if old_variant.school_year_division:
+                new_variant.school_year_division = SchoolYearDivision.objects.filter(
+                    school_year=school_year,
+                    name=old_variant.school_year_division.name,
+                ).first() or old_variant.school_year_division.copy_to_school_year(school_year)
+            new_variant.reg_from = change_year(new_variant.reg_from, year_delta)
+            new_variant.reg_to = change_year(new_variant.reg_to, year_delta)
+            new_variant.save()
+            new_variant.age_groups.set(old_variant.age_groups.all())
+            new_variant.target_groups.set(old_variant.target_groups.all())
+        copy_related_objects(
+            new,
+            attachments=old.attachments,
+            times=old.times,
+        )
         return new
 
 
 class OrderableRegistration(SubjectRegistration):
     subject_type = SubjectType.ORDERABLE
-    start_date = models.DateField(_('start date'))
-    start_time = models.TimeField(_('start time'), blank=True, null=True)
+    start_date = models.DateField(_("start date"))
+    start_time = models.TimeField(_("start time"), blank=True, null=True)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('orderable event registration')
-        verbose_name_plural = _('orderable event registrations')
+        app_label = "leprikon"
+        verbose_name = _("orderable event registration")
+        verbose_name_plural = _("orderable event registrations")
 
     def get_payment_status(self, d=None):
         return PaymentStatus(
             price=self.price,
             discount=self.get_discounted(d),
-            explanation=',\n'.join(
+            explanation=",\n".join(
                 discount.explanation.strip()
                 for discount in self.all_discounts
                 if (d is None or discount.accounted.date() <= d) and discount.explanation.strip()
             ),
-            paid=self.get_paid(d),
+            received=self.get_received(d),
+            returned=self.get_returned(d),
             current_date=d or date.today(),
-            due_from=self.payment_requested and (
+            due_from=self.payment_requested
+            and (
                 self.payment_requested.date()
                 if self.subject.orderable.due_from_days is None
                 else max(
                     self.start_date - timedelta(days=self.subject.orderable.due_from_days),
                     self.payment_requested.date(),
                 )
             ),
-            due_date=self.payment_requested and max(
+            due_date=self.payment_requested
+            and max(
                 self.start_date - timedelta(days=self.subject.orderable.due_date_days),
-                self.payment_requested.date() + timedelta(
-                    days=self.subject.min_due_date_days
-                )
+                self.payment_requested.date() + timedelta(days=self.subject.min_due_date_days),
             ),
         )
 
     @cached_property
     def end_date(self):
         if self.start_time:
             return (datetime.combine(self.start_date, self.start_time) + self.subject.orderable.duration).date()
@@ -108,74 +128,118 @@
             return self.start_date + self.subject.orderable.duration
 
     @cached_property
     def end_time(self):
         if self.start_time:
             return (datetime.combine(self.start_date, self.start_time) + self.subject.orderable.duration).time()
 
+    @attributes(admin_order_field="start_date", short_description=_("event date"))
     def event_date(self):
-        return '{start}{separator}{end}'.format(
-            start=(date_format(datetime.combine(self.start_date, self.start_time), 'SHORT_DATETIME_FORMAT')
-                   if self.start_time else date_format(self.start_date, 'SHORT_DATE_FORMAT')),
-            separator=' - ' if self.start_date != self.end_date or self.end_time is not None else '',
-            end=((time_format(self.end_time, 'TIME_FORMAT') if self.end_time else '')
-                 if self.start_date == self.end_date
-                 else (date_format(datetime.combine(self.end_date, self.end_time), 'SHORT_DATETIME_FORMAT')
-                       if self.end_time else date_format(self.end_date, 'SHORT_DATE_FORMAT'))),
+        return "{start}{separator}{end}".format(
+            start=(
+                date_format(datetime.combine(self.start_date, self.start_time), "SHORT_DATETIME_FORMAT")
+                if self.start_time
+                else date_format(self.start_date, "SHORT_DATE_FORMAT")
+            ),
+            separator=" - " if self.start_date != self.end_date or self.end_time is not None else "",
+            end=(
+                (time_format(self.end_time, "TIME_FORMAT") if self.end_time else "")
+                if self.start_date == self.end_date
+                else (
+                    date_format(datetime.combine(self.end_date, self.end_time), "SHORT_DATETIME_FORMAT")
+                    if self.end_time
+                    else date_format(self.end_date, "SHORT_DATE_FORMAT")
+                )
+            ),
         )
-    event_date.admin_order_field = 'start_date'
-    event_date.short_description = _('event date')
 
 
 class OrderableDiscount(SubjectDiscount):
-    registration = models.ForeignKey(OrderableRegistration, on_delete=models.CASCADE,
-                                     related_name='discounts', verbose_name=_('registration'))
+    registration = models.ForeignKey(
+        OrderableRegistration, on_delete=models.CASCADE, related_name="discounts", verbose_name=_("registration")
+    )
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('orderable event discount')
-        verbose_name_plural = _('orderable event discounts')
-        ordering = ('accounted',)
+        app_label = "leprikon"
+        verbose_name = _("orderable event discount")
+        verbose_name_plural = _("orderable event discounts")
+        ordering = ("accounted",)
 
 
 class OrderablePlugin(CMSPlugin):
-    event = models.ForeignKey(Orderable, on_delete=models.CASCADE, related_name='+', verbose_name=_('event'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_ORDERABLE_TEMPLATES,
-                                default=settings.LEPRIKON_ORDERABLE_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    event = models.ForeignKey(Orderable, on_delete=models.CASCADE, related_name="+", verbose_name=_("event"))
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_ORDERABLE_TEMPLATES,
+        default=settings.LEPRIKON_ORDERABLE_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
 
 class OrderableListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    departments = models.ManyToManyField(Department, blank=True, related_name='+', verbose_name=_('departments'),
-                                         help_text=_('Keep empty to skip searching by departments.'))
-    event_types = models.ManyToManyField(SubjectType, blank=True,
-                                         limit_choices_to={'subject_type': SubjectType.ORDERABLE},
-                                         related_name='+', verbose_name=_('event types'),
-                                         help_text=_('Keep empty to skip searching by event types.'))
-    age_groups = models.ManyToManyField(AgeGroup, blank=True, related_name='+', verbose_name=_('age groups'),
-                                        help_text=_('Keep empty to skip searching by age groups.'))
-    target_groups = models.ManyToManyField(TargetGroup, blank=True, related_name='+', verbose_name=_('target groups'),
-                                           help_text=_('Keep empty to skip searching by target groups.'))
-    groups = models.ManyToManyField(SubjectGroup, blank=True, related_name='+', verbose_name=_('event groups'),
-                                    help_text=_('Keep empty to skip searching by groups.'))
-    leaders = models.ManyToManyField(Leader, verbose_name=_('leaders'), blank=True, related_name='+',
-                                     help_text=_('Keep empty to skip searching by leaders.'))
-    template = models.CharField(_('template'), max_length=100,
-                                choices=settings.LEPRIKON_ORDERABLELIST_TEMPLATES,
-                                default=settings.LEPRIKON_ORDERABLELIST_TEMPLATES[0][0],
-                                help_text=_('The template used to render plugin.'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    departments = models.ManyToManyField(
+        Department,
+        blank=True,
+        related_name="+",
+        verbose_name=_("departments"),
+        help_text=_("Keep empty to skip searching by departments."),
+    )
+    event_types = models.ManyToManyField(
+        SubjectType,
+        blank=True,
+        limit_choices_to={"subject_type": SubjectType.ORDERABLE},
+        related_name="+",
+        verbose_name=_("event types"),
+        help_text=_("Keep empty to skip searching by event types."),
+    )
+    age_groups = models.ManyToManyField(
+        AgeGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("age groups"),
+        help_text=_("Keep empty to skip searching by age groups."),
+    )
+    target_groups = models.ManyToManyField(
+        TargetGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("target groups"),
+        help_text=_("Keep empty to skip searching by target groups."),
+    )
+    groups = models.ManyToManyField(
+        SubjectGroup,
+        blank=True,
+        related_name="+",
+        verbose_name=_("event groups"),
+        help_text=_("Keep empty to skip searching by groups."),
+    )
+    leaders = models.ManyToManyField(
+        Leader,
+        verbose_name=_("leaders"),
+        blank=True,
+        related_name="+",
+        help_text=_("Keep empty to skip searching by leaders."),
+    )
+    template = models.CharField(
+        _("template"),
+        max_length=100,
+        choices=settings.LEPRIKON_ORDERABLELIST_TEMPLATES,
+        default=settings.LEPRIKON_ORDERABLELIST_TEMPLATES[0][0],
+        help_text=_("The template used to render plugin."),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.departments.set(oldinstance.departments.all())
         self.event_types.set(oldinstance.event_types.all())
         self.groups.set(oldinstance.groups.all())
         self.age_groups.set(oldinstance.age_groups.all())
         self.target_groups.set(oldinstance.age_groups.all())
@@ -201,19 +265,20 @@
     def all_target_groups(self):
         return list(self.target_groups.all())
 
     @cached_property
     def all_leaders(self):
         return list(self.leaders.all())
 
-    Group = namedtuple('Group', ('group', 'objects'))
+    Group = namedtuple("Group", ("group", "objects"))
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
         events = Orderable.objects.filter(school_year=school_year, public=True).distinct()
 
         if self.all_departments:
             events = events.filter(department__in=self.all_departments)
         if self.all_event_types:
             events = events.filter(subject_type__in=self.all_event_types)
         if self.all_age_groups:
@@ -226,52 +291,60 @@
             events = events.filter(groups__in=self.all_groups)
             groups = self.all_groups
         elif self.all_event_types:
             groups = SubjectGroup.objects.filter(subject_types__in=self.all_event_types)
         else:
             groups = SubjectGroup.objects.all()
 
-        context.update({
-            'school_year': school_year,
-            'events': events,
-            'groups': (
-                self.Group(group=group, objects=events.filter(groups=group))
-                for group in groups
-            ),
-        })
+        context.update(
+            {
+                "school_year": school_year,
+                "events": events,
+                "groups": (self.Group(group=group, objects=events.filter(groups=group)) for group in groups),
+            }
+        )
         return context
 
 
 class FilteredOrderableListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    event_types = models.ManyToManyField(SubjectType, limit_choices_to={'subject_type': SubjectType.ORDERABLE},
-                                         related_name='+', verbose_name=_('event types'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    event_types = models.ManyToManyField(
+        SubjectType,
+        limit_choices_to={"subject_type": SubjectType.ORDERABLE},
+        related_name="+",
+        verbose_name=_("event types"),
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def copy_relations(self, oldinstance):
         self.event_types = oldinstance.event_types.all()
 
     @cached_property
     def all_event_types(self):
         return list(self.event_types.all())
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
 
         from ..forms.subjects import SubjectFilterForm
+
         form = SubjectFilterForm(
             subject_type_type=SubjectType.ORDERABLE,
             subject_types=self.all_event_types,
             school_year=school_year,
-            is_staff=context['request'].user.is_staff,
-            data=context['request'].GET,
+            is_staff=context["request"].user.is_staff,
+            data=context["request"].GET,
+        )
+        context.update(
+            {
+                "school_year": school_year,
+                "form": form,
+                "events": form.get_queryset(),
+            }
         )
-        context.update({
-            'school_year': school_year,
-            'form': form,
-            'events': form.get_queryset(),
-        })
         return context
```

### Comparing `leprikon-3.0.0/leprikon/models/organizations.py` & `leprikon-3.5.0/leprikon/models/organizations.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,38 +1,48 @@
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from localflavor.generic.models import BICField, IBANField
 
+from ..utils import attributes
 from .fields import EmailField, PostalCodeField
+from .printsetup import PrintSetup
 from .utils import BankAccount
 
 
 class Organization(models.Model):
-    name = models.CharField(_('organization name'), max_length=150)
-    street = models.CharField(_('street'), max_length=150, blank=True, default='')
-    city = models.CharField(_('city'), max_length=150, blank=True, default='')
-    postal_code = PostalCodeField(_('postal code'), blank=True, default='')
-    email = EmailField(_('email address'), blank=True, default='')
-    phone = models.CharField(_('phone'), max_length=30, blank=True, default='')
-    company_num = models.CharField(_('company number'), max_length=8, blank=True, default='')
-    vat_number = models.CharField(_('VAT number'), max_length=12, blank=True, default='')
-    iban = IBANField(_('IBAN'), blank=True, default='')
-    bic = BICField(_('BIC (SWIFT)'), blank=True, default='')
+    name = models.CharField(_("organization name"), max_length=150)
+    street = models.CharField(_("street"), max_length=150, blank=True, default="")
+    city = models.CharField(_("city"), max_length=150, blank=True, default="")
+    postal_code = PostalCodeField(_("postal code"), blank=True, default="")
+    email = EmailField(_("email address"), blank=True, default="")
+    phone = models.CharField(_("phone"), max_length=30, blank=True, default="")
+    company_num = models.CharField(_("company number"), max_length=8, blank=True, default="")
+    vat_number = models.CharField(_("VAT number"), max_length=12, blank=True, default="")
+    iban = IBANField(_("IBAN"), blank=True, default="")
+    bic = BICField(_("BIC (SWIFT)"), blank=True, default="")
+    donation_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("donation print setup"),
+    )
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('organization')
-        verbose_name_plural = _('organizations')
+        app_label = "leprikon"
+        verbose_name = _("organization")
+        verbose_name_plural = _("organizations")
 
     def __str__(self):
-        return f'{self.name} ({self.bank_account})'
+        return f"{self.name} ({self.bank_account})"
 
+    @attributes(short_description=_("address"))
     @cached_property
     def address(self):
-        return ', '.join(filter(bool, (self.street, self.city, self.postal_code)))
-    address.short_description = _('address')
+        return ", ".join(filter(bool, (self.street, self.city, self.postal_code)))
 
+    @attributes(short_description=_("bank account"))
     @cached_property
     def bank_account(self):
         return self.iban and BankAccount(self.iban)
-    bank_account.short_description = _('bank account')
```

### Comparing `leprikon-3.0.0/leprikon/models/printsetup.py` & `leprikon-3.5.0/leprikon/models/printsetup.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,47 +1,44 @@
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from filer.fields.file import FilerFileField
-from PyPDF2 import PdfFileReader
+from pypdf import PdfReader
 from reportlab.lib.pagesizes import A4, portrait
 from reportlab.lib.units import mm
 
 
 class PrintSetup(models.Model):
-    name = models.CharField(_('name'), max_length=150)
-    background = FilerFileField(verbose_name=_('pdf background'), blank=True, null=True,
-                                on_delete=models.SET_NULL, related_name='+')
-    top = models.IntegerField(_('margin top'), blank=True, default=20,
-                              help_text=_('distance in milimetres'))
-    left = models.IntegerField(_('margin left'), blank=True, default=20,
-                               help_text=_('distance in milimetres'))
-    right = models.IntegerField(_('margin right'), blank=True, default=20,
-                                help_text=_('distance in milimetres'))
-    bottom = models.IntegerField(_('margin bottom'), blank=True, default=20,
-                                 help_text=_('distance in milimetres'))
+    name = models.CharField(_("name"), max_length=150)
+    background = FilerFileField(
+        verbose_name=_("pdf background"), blank=True, null=True, on_delete=models.SET_NULL, related_name="+"
+    )
+    top = models.IntegerField(_("margin top"), blank=True, default=20, help_text=_("distance in milimetres"))
+    left = models.IntegerField(_("margin left"), blank=True, default=20, help_text=_("distance in milimetres"))
+    right = models.IntegerField(_("margin right"), blank=True, default=20, help_text=_("distance in milimetres"))
+    bottom = models.IntegerField(_("margin bottom"), blank=True, default=20, help_text=_("distance in milimetres"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('name',)
-        verbose_name = _('print setup')
-        verbose_name_plural = _('print setups')
+        app_label = "leprikon"
+        ordering = ("name",)
+        verbose_name = _("print setup")
+        verbose_name_plural = _("print setups")
 
     def __str__(self):
         return self.name
 
     @cached_property
     def background_pdf(self):
-        return PdfFileReader(self.background.file) if self.background else None
+        return PdfReader(self.background.file) if self.background else None
 
     @cached_property
     def page_size(self):
         if self.background:
-            mediaBox = self.background_pdf.getPage(0).mediaBox
-            return [int(mediaBox[2]), int(mediaBox[3])]
+            mediabox = self.background_pdf.pages[0].mediabox
+            return [int(mediabox[2]), int(mediabox[3])]
         else:
             return portrait(A4)
 
     @cached_property
     def x1(self):
         return int(self.left * mm)
```

### Comparing `leprikon-3.0.0/leprikon/models/question.py` & `leprikon-3.5.0/leprikon/models/question.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,57 +1,64 @@
 from json import loads
 
 from django.core.exceptions import ValidationError
 from django.db import models
 from django.utils.functional import cached_property
 from django.utils.module_loading import import_string
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
 from ..utils import first_upper
 
 
 class Question(models.Model):
-    name = models.CharField(_('name'), max_length=50, unique=True)
-    question = models.CharField(_('question'), max_length=50)
-    help_text = models.TextField(_('help text'), blank=True, null=True,
-                                 help_text=_('This is help text. The help text is shown next to the form field.'))
-    field = models.CharField(_('field'), max_length=150, choices=(
-        (key, val['name']) for key, val in settings.LEPRIKON_QUESTION_FIELDS.items()
-    ))
-    field_args = models.TextField(_('field_args'), blank=True, default='{}',
-                                  help_text=_('Enter valid JSON structure representing field configuration.'))
-    active = models.BooleanField(_('active'), default=True)
+    name = models.CharField(_("name"), max_length=150)
+    slug = models.SlugField(_("unique identifier"), max_length=50, unique=True)
+    question = models.CharField(_("question"), max_length=150)
+    help_text = models.TextField(
+        _("help text"),
+        blank=True,
+        null=True,
+        help_text=_("This is help text. The help text is shown next to the form field."),
+    )
+    field = models.CharField(
+        _("field"),
+        max_length=150,
+        choices=((key, val["name"]) for key, val in settings.LEPRIKON_QUESTION_FIELDS.items()),
+    )
+    field_args = models.TextField(
+        _("field_args"),
+        blank=True,
+        default="{}",
+        help_text=_("Enter valid JSON structure representing field configuration."),
+    )
+    active = models.BooleanField(_("active"), default=True)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('additional question')
-        verbose_name_plural = _('additional questions')
+        app_label = "leprikon"
+        ordering = ("name",)
+        verbose_name = _("additional question")
+        verbose_name_plural = _("additional questions")
 
     def __str__(self):
-        return self.question
+        return self.name
 
     @cached_property
     def field_class(self):
-        return import_string(settings.LEPRIKON_QUESTION_FIELDS[self.field]['class'])
+        return import_string(settings.LEPRIKON_QUESTION_FIELDS[self.field]["class"])
 
     @cached_property
     def field_kwargs(self):
         return loads(self.field_args)
 
     @cached_property
     def field_label(self):
         return first_upper(self.question)
 
     def get_field(self, initial=None):
-        return self.field_class(
-            label=self.field_label,
-            initial=initial,
-            help_text=self.help_text,
-            **self.field_kwargs
-        )
+        return self.field_class(label=self.field_label, initial=initial, help_text=self.help_text, **self.field_kwargs)
 
     def clean(self):
         try:
             self.get_field()
         except Exception as e:
-            raise ValidationError({'field_args': [_('Failed to create field with given field args: {}').format(e)]})
+            raise ValidationError({"field_args": [_("Failed to create field with given field args: {}").format(e)]})
```

### Comparing `leprikon-3.0.0/leprikon/models/registrationlink.py` & `leprikon-3.5.0/leprikon/models/registrationlink.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,41 +1,48 @@
 from django.db import models
 from django.urls import reverse
 from django.utils import timezone
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from .leprikonsite import LeprikonSite
 from .schoolyear import SchoolYear
-from .subjects import Subject, SubjectType
+from .subjects import SubjectType, SubjectVariant
 
 
 class RegistrationLink(models.Model):
-    school_year = models.ForeignKey(SchoolYear, editable=False, on_delete=models.CASCADE,
-                                    related_name='registration_links', verbose_name=_('school year'))
-    subject_type = models.ForeignKey(SubjectType, on_delete=models.CASCADE,
-                                     related_name='registration_links', verbose_name=_('subject type'))
+    school_year = models.ForeignKey(
+        SchoolYear,
+        editable=False,
+        on_delete=models.CASCADE,
+        related_name="registration_links",
+        verbose_name=_("school year"),
+    )
+    subject_type = models.ForeignKey(
+        SubjectType, on_delete=models.CASCADE, related_name="registration_links", verbose_name=_("subject type")
+    )
     slug = models.SlugField(editable=False, max_length=64)
-    name = models.CharField(_('name'), max_length=50)
-    reg_from = models.DateTimeField(_('registration active from'))
-    reg_to = models.DateTimeField(_('registration active to'))
-    subjects = models.ManyToManyField(Subject, blank=False, related_name='registration_links',
-                                      verbose_name=_('subjects'))
+    name = models.CharField(_("name"), max_length=50)
+    reg_from = models.DateTimeField(_("registration active from"))
+    reg_to = models.DateTimeField(_("registration active to"))
+    subject_variants = models.ManyToManyField(
+        SubjectVariant, blank=False, related_name="registration_links", verbose_name=_("subjects")
+    )
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('reg_from', 'reg_to')
-        verbose_name = _('registration link')
-        verbose_name_plural = _('registration links')
+        app_label = "leprikon"
+        ordering = ("reg_from", "reg_to")
+        verbose_name = _("registration link")
+        verbose_name_plural = _("registration links")
 
     def __str__(self):
         return self.name
 
     def get_absolute_url(self):
-        return reverse('leprikon:registration_link', args=(self.slug,))
+        return reverse("leprikon:registration_link", args=(self.slug,))
 
     @cached_property
     def link(self):
         return LeprikonSite.objects.get_current().url + self.get_absolute_url()
 
     @property
     def registration_allowed(self):
```

### Comparing `leprikon-3.0.0/leprikon/models/roles.py` & `leprikon-3.5.0/leprikon/models/roles.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,57 +1,59 @@
 from collections import namedtuple
+from json import loads
 
 from cms.models import CMSPlugin
 from cms.models.fields import PageField
 from django.core.exceptions import ValidationError
 from django.db import models
-from django.utils.encoding import smart_text
 from django.utils.formats import date_format
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from djangocms_text_ckeditor.fields import HTMLField
 from filer.fields.image import FilerImageField
 
 from ..conf import settings
 from ..forms.leaders import LeaderFilterForm
+from ..utils import attributes
 from .agegroup import AgeGroup
 from .citizenship import Citizenship
 from .fields import BirthNumberField, EmailField, PostalCodeField
 from .school import School
 from .schoolyear import SchoolYear
 
 
 class Leader(models.Model):
-    user = models.OneToOneField(settings.AUTH_USER_MODEL, on_delete=models.PROTECT,
-                                related_name='leprikon_leader', verbose_name=_('user'))
-    description = HTMLField(_('description'), blank=True, default='')
-    photo = FilerImageField(verbose_name=_('photo'), blank=True, null=True, related_name='+', on_delete=models.SET_NULL)
-    page = PageField(verbose_name=_('page'), blank=True, null=True, related_name='+', on_delete=models.SET_NULL)
-    school_years = models.ManyToManyField(SchoolYear, related_name='leaders', verbose_name=_('school years'))
+    user = models.OneToOneField(
+        settings.AUTH_USER_MODEL, on_delete=models.PROTECT, related_name="leprikon_leader", verbose_name=_("user")
+    )
+    description = HTMLField(_("description"), blank=True, default="")
+    photo = FilerImageField(verbose_name=_("photo"), blank=True, null=True, related_name="+", on_delete=models.SET_NULL)
+    page = PageField(verbose_name=_("page"), blank=True, null=True, related_name="+", on_delete=models.SET_NULL)
+    school_years = models.ManyToManyField(SchoolYear, related_name="leaders", verbose_name=_("school years"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('user__last_name', 'user__first_name')
-        verbose_name = _('leader')
-        verbose_name_plural = _('leaders')
+        app_label = "leprikon"
+        ordering = ("user__last_name", "user__first_name")
+        verbose_name = _("leader")
+        verbose_name_plural = _("leaders")
 
     def __str__(self):
         return self.full_name or self.user.username
 
     @cached_property
     def first_name(self):
         return self.user.first_name
 
     @cached_property
     def last_name(self):
         return self.user.last_name
 
     @cached_property
     def full_name(self):
-        return '{} {}'.format(self.first_name, self.last_name).strip()
+        return "{} {}".format(self.first_name, self.last_name).strip()
 
     @cached_property
     def all_contacts(self):
         return list(self.contacts.all())
 
     @cached_property
     def all_public_contacts(self):
@@ -59,246 +61,266 @@
 
     @cached_property
     def all_school_years(self):
         return list(self.school_years.all())
 
     def get_alternate_leader_entries(self, school_year):
         from .journals import JournalLeaderEntry
+
         return JournalLeaderEntry.objects.filter(
             timesheet__leader=self,
-            journal_entry__subject__school_year=school_year,
-        ).exclude(journal_entry__subject__in=self.subjects.all())
+            journal_entry__journal__subject__school_year=school_year,
+        ).exclude(journal_entry__journal__subject__in=self.subjects.all())
 
-    SubjectsGroup = namedtuple('SubjectsGroup', ('subject_type', 'subjects'))
+    SubjectsGroup = namedtuple("SubjectsGroup", ("subject_type", "subjects"))
 
     def get_subjects_by_types(self):
         from .subjects import SubjectType
+
         return (
-            self.SubjectsGroup(
-                subject_type=subject_type,
-                subjects=subject_type.subjects.filter(leaders=self)
-            )
+            self.SubjectsGroup(subject_type=subject_type, subjects=subject_type.subjects.filter(leaders=self))
             for subject_type in SubjectType.objects.all()
         )
 
 
 class Contact(models.Model):
-    leader = models.ForeignKey(Leader, on_delete=models.CASCADE, related_name='contacts', verbose_name=_('leader'))
-    contact_type = models.CharField(_('contact type'), max_length=30,
-                                    choices=settings.LEPRIKON_CONTACT_TYPES)
-    contact = models.CharField(_('contact'), max_length=250)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    public = models.BooleanField(_('public'), default=False)
+    leader = models.ForeignKey(Leader, on_delete=models.CASCADE, related_name="contacts", verbose_name=_("leader"))
+    contact_type = models.CharField(_("contact type"), max_length=30, choices=settings.LEPRIKON_CONTACT_TYPES)
+    contact = models.CharField(_("contact"), max_length=250)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    public = models.BooleanField(_("public"), default=False)
 
     CONTACT_TYPES = dict(settings.LEPRIKON_CONTACT_TYPES)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('contact')
-        verbose_name_plural = _('contacts')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("contact")
+        verbose_name_plural = _("contacts")
 
     def __str__(self):
-        return '{}, {}: {}'.format(self.leader.full_name, self.contact_type_name, self.contact)
+        return "{}, {}: {}".format(self.leader.full_name, self.contact_type_name, self.contact)
 
     @cached_property
     def contact_type_name(self):
         return self.CONTACT_TYPES[self.contact_type]
 
 
 class Parent(models.Model):
-    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE,
-                             related_name='leprikon_parents', verbose_name=_('user'))
-    first_name = models.CharField(_('first name'), max_length=30)
-    last_name = models.CharField(_('last name'), max_length=30)
-    street = models.CharField(_('street'), max_length=150)
-    city = models.CharField(_('city'), max_length=150)
-    postal_code = PostalCodeField(_('postal code'))
-    email = EmailField(_('email address'), blank=True, default='')
-    phone = models.CharField(_('phone'), max_length=30)
+    user = models.ForeignKey(
+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="leprikon_parents", verbose_name=_("user")
+    )
+    first_name = models.CharField(_("first name"), max_length=30)
+    last_name = models.CharField(_("last name"), max_length=30)
+    street = models.CharField(_("street"), max_length=150)
+    city = models.CharField(_("city"), max_length=150)
+    postal_code = PostalCodeField(_("postal code"))
+    email = EmailField(_("email address"), blank=True, default="")
+    phone = models.CharField(_("phone"), max_length=30)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('parent')
-        verbose_name_plural = _('parents')
+        app_label = "leprikon"
+        verbose_name = _("parent")
+        verbose_name_plural = _("parents")
 
     def __str__(self):
         return self.full_name
 
     @cached_property
     def address(self):
-        return '{}, {}, {}'.format(self.street, self.city, self.postal_code)
+        return "{}, {}, {}".format(self.street, self.city, self.postal_code)
 
     @cached_property
     def contact(self):
         if self.email and self.phone:
-            return '{}, {}'.format(self.phone, self.email)
+            return "{}, {}".format(self.phone, self.email)
         else:
-            return self.email or self.phone or ''
+            return self.email or self.phone or ""
 
     @cached_property
     def full_name(self):
-        return '{} {}'.format(self.first_name, self.last_name)
+        return "{} {}".format(self.first_name, self.last_name)
 
 
 class Participant(models.Model):
-    MALE = 'm'
-    FEMALE = 'f'
-    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE,
-                             related_name='leprikon_participants', verbose_name=_('user'))
-    age_group = models.ForeignKey(AgeGroup, on_delete=models.PROTECT,
-                                  related_name='+', verbose_name=_('age group'))
-    first_name = models.CharField(_('first name'), max_length=30)
-    last_name = models.CharField(_('last name'), max_length=30)
-    citizenship = models.ForeignKey(Citizenship, on_delete=models.PROTECT,
-                                    related_name='+', verbose_name=_('citizenship'))
-    birth_num = BirthNumberField(_('birth number'), blank=True, null=True)
-    birth_date = models.DateField(_('birth date'))
-    gender = models.CharField(_('gender'), max_length=1,
-                              choices=((MALE, _('male / boy')), (FEMALE, _('female / girl'))))
-    street = models.CharField(_('street'), max_length=150)
-    city = models.CharField(_('city'), max_length=150)
-    postal_code = PostalCodeField(_('postal code'))
-    email = EmailField(_('email address'), blank=True, default='')
-    phone = models.CharField(_('phone'), max_length=30, blank=True, default='')
-    school = models.ForeignKey(School, blank=True, null=True, on_delete=models.PROTECT,
-                               related_name='participants', verbose_name=_('school'))
-    school_other = models.CharField(_('other school'), max_length=150, blank=True, default='')
-    school_class = models.CharField(_('class'), max_length=30, blank=True, default='')
-    health = models.TextField(_('health'), blank=True, default='')
+    MALE = "m"
+    FEMALE = "f"
+    user = models.ForeignKey(
+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="leprikon_participants", verbose_name=_("user")
+    )
+    age_group = models.ForeignKey(AgeGroup, on_delete=models.PROTECT, related_name="+", verbose_name=_("age group"))
+    first_name = models.CharField(_("first name"), max_length=30)
+    last_name = models.CharField(_("last name"), max_length=30)
+    citizenship = models.ForeignKey(
+        Citizenship, on_delete=models.PROTECT, related_name="+", verbose_name=_("citizenship")
+    )
+    birth_num = BirthNumberField(_("birth number"), blank=True, null=True)
+    birth_date = models.DateField(_("birth date"))
+    gender = models.CharField(
+        _("gender"), max_length=1, choices=((MALE, _("male / boy")), (FEMALE, _("female / girl")))
+    )
+    street = models.CharField(_("street"), max_length=150)
+    city = models.CharField(_("city"), max_length=150)
+    postal_code = PostalCodeField(_("postal code"))
+    email = EmailField(_("email address"), blank=True, default="")
+    phone = models.CharField(_("phone"), max_length=30, blank=True, default="")
+    school = models.ForeignKey(
+        School, blank=True, null=True, on_delete=models.PROTECT, related_name="participants", verbose_name=_("school")
+    )
+    school_other = models.CharField(_("other school"), max_length=150, blank=True, default="")
+    school_class = models.CharField(_("class"), max_length=30, blank=True, default="")
+    health = models.TextField(_("health"), blank=True, default="")
+    answers = models.TextField(_("additional answers"), blank=True, default="{}", editable=False)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('participant')
-        verbose_name_plural = _('participants')
+        app_label = "leprikon"
+        verbose_name = _("participant")
+        verbose_name_plural = _("participants")
 
     def __str__(self):
-        return _('{first_name} {last_name} ({birth_date})').format(
+        return _("{first_name} {last_name} ({birth_date})").format(
             first_name=self.first_name,
             last_name=self.last_name,
-            birth_date=date_format(self.birth_date, 'SHORT_DATE_FORMAT'),
+            birth_date=date_format(self.birth_date, "SHORT_DATE_FORMAT"),
         )
 
+    def get_answers(self):
+        return loads(self.answers)
+
     @cached_property
     def full_name(self):
-        return '{} {}'.format(self.first_name, self.last_name)
+        return "{} {}".format(self.first_name, self.last_name)
 
     @cached_property
     def address(self):
-        return '{}, {}, {}'.format(self.street, self.city, self.postal_code)
+        return "{}, {}, {}".format(self.street, self.city, self.postal_code)
 
     @cached_property
-    def contact(self):
+    def contact(self) -> str:
         if self.email and self.phone:
-            return '{}, {}'.format(self.phone, self.email)
+            return "{}, {}".format(self.phone, self.email)
         else:
-            return self.email or self.phone or ''
+            return self.email or self.phone or ""
 
     @cached_property
-    def school_name(self):
-        return self.school and smart_text(self.school) or self.school_other
+    def school_name(self) -> str:
+        return self.school and str(self.school) or self.school_other
 
     @cached_property
-    def school_and_class(self):
+    def school_and_class(self) -> str:
         if self.school_name and self.school_class:
-            return '{}, {}'.format(self.school_name, self.school_class)
+            return "{}, {}".format(self.school_name, self.school_class)
         else:
-            return self.school_name or self.school_class or ''
+            return self.school_name or self.school_class or ""
 
 
 class BillingInfo(models.Model):
-    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE,
-                             related_name='leprikon_billing_info', verbose_name=_('user'))
-    name = models.CharField(_('name'), max_length=150)
-    street = models.CharField(_('street'), max_length=150, blank=True, default='')
-    city = models.CharField(_('city'), max_length=150, blank=True, default='')
-    postal_code = PostalCodeField(_('postal code'), blank=True, default='')
-    company_num = models.CharField(_('company number'), max_length=8, blank=True, default='')
-    vat_number = models.CharField(_('VAT number'), max_length=12, blank=True, default='')
-    contact_person = models.CharField(_('contact person'), max_length=60, blank=True, default='')
-    phone = models.CharField(_('phone'), max_length=30, blank=True, default='')
-    email = EmailField(_('email address'), blank=True, default='')
-    employee = models.CharField(_('employee ID'), max_length=150, blank=True, default='')
+    user = models.ForeignKey(
+        settings.AUTH_USER_MODEL, on_delete=models.CASCADE, related_name="leprikon_billing_info", verbose_name=_("user")
+    )
+    name = models.CharField(_("name"), max_length=150)
+    street = models.CharField(_("street"), max_length=150, blank=True, default="")
+    city = models.CharField(_("city"), max_length=150, blank=True, default="")
+    postal_code = PostalCodeField(_("postal code"), blank=True, default="")
+    company_num = models.CharField(_("company number"), max_length=8, blank=True, default="")
+    vat_number = models.CharField(_("VAT number"), max_length=12, blank=True, default="")
+    contact_person = models.CharField(_("contact person"), max_length=60, blank=True, default="")
+    phone = models.CharField(_("phone"), max_length=30, blank=True, default="")
+    email = EmailField(_("email address"), blank=True, default="")
+    employee = models.CharField(_("employee ID"), max_length=150, blank=True, default="")
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('name',)
-        verbose_name = _('billing information')
-        verbose_name_plural = _('billing information')
+        app_label = "leprikon"
+        ordering = ("name",)
+        verbose_name = _("billing information")
+        verbose_name_plural = _("billing information")
 
     def __str__(self):
         return self.name
 
+    @attributes(short_description=_("address"))
     @cached_property
     def address(self):
-        return ', '.join(filter(bool, (self.street, self.city, self.postal_code)))
-    address.short_description = _('address')
+        return ", ".join(filter(bool, (self.street, self.city, self.postal_code)))
 
 
 class LeaderPlugin(CMSPlugin):
-    leader = models.ForeignKey(Leader, on_delete=models.CASCADE, related_name='+', verbose_name=_('leader'))
+    leader = models.ForeignKey(Leader, on_delete=models.CASCADE, related_name="+", verbose_name=_("leader"))
     template = models.CharField(
-        _('template'), max_length=100,
+        _("template"),
+        max_length=100,
         choices=settings.LEPRIKON_LEADER_TEMPLATES,
         default=settings.LEPRIKON_LEADER_TEMPLATES[0][0],
-        help_text=_('The template used to render plugin.'),
+        help_text=_("The template used to render plugin."),
     )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
 
 class LeaderListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
-    subject = models.ForeignKey('leprikon.Subject', blank=True, null=True, on_delete=models.CASCADE,
-                                related_name='+', verbose_name=_('subject'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
+    subject = models.ForeignKey(
+        "leprikon.Subject", blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("subject")
+    )
     template = models.CharField(
-        _('template'), max_length=100,
+        _("template"),
+        max_length=100,
         choices=settings.LEPRIKON_LEADERLIST_TEMPLATES,
         default=settings.LEPRIKON_LEADERLIST_TEMPLATES[0][0],
-        help_text=_('The template used to render plugin.'),
+        help_text=_("The template used to render plugin."),
     )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def clean(self):
         if self.school_year and self.subject and self.subject.school_year != self.school_year:
-            raise ValidationError({
-                'school_year': [_('Selected subject is not in the selected school year.')],
-                'subject': [_('Selected subject is not in the selected school year.')],
-            })
+            raise ValidationError(
+                {
+                    "school_year": [_("Selected subject is not in the selected school year.")],
+                    "subject": [_("Selected subject is not in the selected school year.")],
+                }
+            )
 
     def render(self, context):
         if self.subject:
             leaders = self.subject.leaders.all()
         else:
-            school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                           SchoolYear.objects.get_current())
+            school_year = (
+                self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+            )
             leaders = school_year.leaders.all()
-        context.update({
-            'leaders': leaders,
-        })
+        context.update(
+            {
+                "leaders": leaders,
+            }
+        )
         return context
 
 
 class FilteredLeaderListPlugin(CMSPlugin):
-    school_year = models.ForeignKey(SchoolYear, blank=True, null=True, on_delete=models.CASCADE,
-                                    related_name='+', verbose_name=_('school year'))
+    school_year = models.ForeignKey(
+        SchoolYear, blank=True, null=True, on_delete=models.CASCADE, related_name="+", verbose_name=_("school year")
+    )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def render(self, context):
-        school_year = (self.school_year or getattr(context.get('request'), 'school_year') or
-                       SchoolYear.objects.get_current())
+        school_year = (
+            self.school_year or getattr(context.get("request"), "school_year") or SchoolYear.objects.get_current()
+        )
         form = LeaderFilterForm(
             school_year=school_year,
-            data=context['request'].GET,
+            data=context["request"].GET,
+        )
+        context.update(
+            {
+                "school_year": school_year,
+                "form": form,
+                "leaders": form.get_queryset(),
+            }
         )
-        context.update({
-            'school_year': school_year,
-            'form': form,
-            'leaders': form.get_queryset(),
-        })
         return context
```

### Comparing `leprikon-3.0.0/leprikon/models/school.py` & `leprikon-3.5.0/leprikon/models/school.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 
 class School(models.Model):
-    name = models.CharField(_('name'), max_length=50)
-    street = models.CharField(_('street'), max_length=50, blank=True, default='')
-    city = models.CharField(_('city'), max_length=50, blank=True, default='')
+    name = models.CharField(_("name"), max_length=50)
+    street = models.CharField(_("street"), max_length=50, blank=True, default="")
+    city = models.CharField(_("city"), max_length=50, blank=True, default="")
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('city', 'name')
-        verbose_name = _('school')
-        verbose_name_plural = _('schools')
+        app_label = "leprikon"
+        ordering = ("city", "name")
+        verbose_name = _("school")
+        verbose_name_plural = _("schools")
 
     def __str__(self):
         if self.address:
-            return '{}, {}'.format(self.name, self.address)
+            return "{}, {}".format(self.name, self.address)
         else:
             return self.name
 
     @cached_property
     def address(self):
         if self.street and self.city:
-            return '{}, {}'.format(self.street, self.city)
+            return "{}, {}".format(self.street, self.city)
         else:
             return self.street or self.city
```

### Comparing `leprikon-3.0.0/leprikon/models/schoolyear.py` & `leprikon-3.5.0/leprikon/models/schoolyear.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,72 +1,78 @@
 from datetime import date
 
 from cms.models import CMSPlugin
 from django.db import models
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..utils import comma_separated
 from .startend import StartEndMixin
 from .utils import change_year
 
 
 class SchoolYearManager(models.Manager):
     def get_current(self):
         # by default use last active year
-        school_year = self.filter(active=True).order_by('-year').first()
+        school_year = self.filter(active=True).order_by("-year").first()
         if school_year is None:
             # Create or activate current year
             if date.today().month < 7:
                 year = date.today().year - 1
             else:
                 year = date.today().year
             school_year = SchoolYear.objects.get_or_create(year=year)[0]
             school_year.active = True
             school_year.save()
         return school_year
 
 
 class SchoolYear(models.Model):
-    year = models.IntegerField(_('year'), unique=True, help_text=_('Only the first of the two years.'))
-    active = models.BooleanField(_('active'), default=False)
+    year = models.IntegerField(_("year"), unique=True, help_text=_("Only the first of the two years."))
+    active = models.BooleanField(_("active"), default=False)
 
     objects = SchoolYearManager()
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('-year',)
-        verbose_name = _('school year')
-        verbose_name_plural = _('school years')
+        app_label = "leprikon"
+        ordering = ("-year",)
+        verbose_name = _("school year")
+        verbose_name_plural = _("school years")
 
     def __str__(self):
         return self.name
 
     def delete(self):
         if self.courses.count() or self.events.count():
-            raise Exception(_('Can not delete sclool year with courses or events.'))
-        super(SchoolYear, self).delete()
+            raise Exception(_("Can not delete sclool year with courses or events."))
+        super().delete()
 
     @cached_property
     def name(self):
-        return '{}/{}'.format(self.year, self.year + 1)
+        return "{}/{}".format(self.year, self.year + 1)
 
 
 class SchoolYearDivision(models.Model):
-    school_year = models.ForeignKey(SchoolYear, on_delete=models.CASCADE,
-                                    related_name='divisions', verbose_name=_('school year'))
-    name = models.CharField(_('division name'), max_length=150)
-    period_name = models.CharField(_('period name'), max_length=150)
+    school_year = models.ForeignKey(
+        SchoolYear, on_delete=models.CASCADE, related_name="divisions", verbose_name=_("school year")
+    )
+    name = models.CharField(_("division name"), max_length=150)
+    price_unit_name = models.CharField(
+        _("price unit name"),
+        max_length=150,
+        help_text=_("Unit name the price applies to. For example semester, month, or 5 lessons."),
+        # "Název jednotky, za kterou je udávána cena, například pololetí, měsíc, 5 lekcí, apod."
+    )
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('name',)
-        unique_together = (('school_year', 'name'),)
-        verbose_name = _('school year division')
-        verbose_name_plural = _('school year divisions')
+        app_label = "leprikon"
+        ordering = ("name",)
+        unique_together = (("school_year", "name"),)
+        verbose_name = _("school year division")
+        verbose_name_plural = _("school year divisions")
 
     def __str__(self):
         return self.name
 
     @cached_property
     def all_periods(self):
         return list(self.periods.all())
@@ -75,65 +81,63 @@
         new = SchoolYearDivision.objects.get(id=old.id)
         new.id, new.pk = None, None
         new.school_year = school_year
         new.save()
         year_delta = school_year.year - old.school_year.year
         periods = []
         for period in old.all_periods:
-            periods.append(SchoolYearPeriod(
-                school_year_division=new,
-                name=period.name,
-                start=change_year(period.start, year_delta),
-                end=change_year(period.end, year_delta),
-                due_from=change_year(period.due_from, year_delta),
-                due_date=change_year(period.due_date, year_delta),
-            ))
+            periods.append(
+                SchoolYearPeriod(
+                    school_year_division=new,
+                    name=period.name,
+                    start=change_year(period.start, year_delta),
+                    end=change_year(period.end, year_delta),
+                    due_from=change_year(period.due_from, year_delta),
+                    due_date=change_year(period.due_date, year_delta),
+                )
+            )
         SchoolYearPeriod.objects.bulk_create(periods)
         return new
 
     def get_current_period(self):
-        return (
-            self.periods.filter(end__gte=date.today()).first() or
-            self.periods.last()
-        )
+        return self.periods.filter(end__gte=date.today()).first() or self.periods.last()
 
 
 class SchoolYearPeriod(StartEndMixin, models.Model):
-    school_year_division = models.ForeignKey(SchoolYearDivision, on_delete=models.CASCADE,
-                                             related_name='periods', verbose_name=_('school year division'))
-    name = models.CharField(_('name'), max_length=150)
-    start = models.DateField(_('start date'))
-    end = models.DateField(_('end date'))
-    due_from = models.DateField(_('due from'))
-    due_date = models.DateField(_('due date'))
+    school_year_division = models.ForeignKey(
+        SchoolYearDivision, on_delete=models.CASCADE, related_name="periods", verbose_name=_("school year division")
+    )
+    name = models.CharField(_("name"), max_length=150)
+    start = models.DateField(_("start date"), blank=True, null=True)
+    end = models.DateField(_("end date"), blank=True, null=True)
+    price_units_count = models.DecimalField(_("number of price units"), default=1, decimal_places=2, max_digits=10)
+    due_from = models.DateField(_("due from"))
+    due_date = models.DateField(_("due date"))
+    order = models.IntegerField(_("order"), blank=True, default=0)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('start',)
-        verbose_name = _('school year period')
-        verbose_name_plural = _('school year periods')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("school year period")
+        verbose_name_plural = _("school year periods")
 
     def __str__(self):
-        return _('{name}, {start:%m/%d %y} - {end:%m/%d %y}').format(
-            name=self.name,
-            start=self.start,
-            end=self.end,
-        )
+        return self.name
 
 
 class SchoolYearBlockPlugin(CMSPlugin):
     school_years = models.ManyToManyField(
         SchoolYear,
-        related_name='+',
-        verbose_name=_('school years'),
-        help_text=_('Which school years should the block be visible for?'),
+        related_name="+",
+        verbose_name=_("school years"),
+        help_text=_("Which school years should the block be visible for?"),
     )
 
     class Meta:
-        app_label = 'leprikon'
+        app_label = "leprikon"
 
     def __str__(self):
         return comma_separated(self.all_school_years)
 
     @cached_property
     def all_school_years(self):
         return list(self.school_years.all())
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `leprikon-3.0.0/leprikon/models/subjects.py` & `leprikon-3.5.0/leprikon/models/subjects.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,660 +1,657 @@
 import colorsys
 import logging
 from collections import OrderedDict, namedtuple
 from datetime import datetime, time
+from decimal import Decimal
 from email.mime.image import MIMEImage
 from io import BytesIO
 from itertools import chain
 from json import loads
 from os.path import basename
 from tempfile import NamedTemporaryFile
+from typing import List, Set
+from urllib.parse import urlencode
 
-import qrcode
-import trml2pdf
+import segno
 from bankreader.models import Transaction as BankreaderTransaction
 from cms.models.fields import PageField
+from cms.models.pagemodel import Page
+from cms.signals.apphook import set_restart_trigger
 from django.core.exceptions import ValidationError
-from django.core.mail import EmailMultiAlternatives
 from django.db import models, transaction
 from django.dispatch import receiver
-from django.template.loader import select_template
 from django.urls import reverse
-from django.utils import formats, timezone
-from django.utils.encoding import force_text, smart_text
+from django.utils import timezone
 from django.utils.functional import cached_property
 from django.utils.safestring import mark_safe
 from django.utils.text import slugify
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _, ngettext
 from django_pays import payment_url as pays_payment_url
 from django_pays.models import Payment as PaysPayment
 from djangocms_text_ckeditor.fields import HTMLField
 from filer.fields.file import FilerFileField
 from filer.fields.image import FilerImageField
 from multiselectfield import MultiSelectField
-from PyPDF2 import PdfFileReader, PdfFileWriter
 
 from ..conf import settings
-from ..utils import (
-    FEMALE, MALE, comma_separated, currency, lazy_paragraph as paragraph,
-    localeconv, spayd,
-)
+from ..utils import FEMALE, MALE, attributes, comma_separated, currency, lazy_paragraph as paragraph, localeconv, spayd
 from .agegroup import AgeGroup
 from .agreements import Agreement, AgreementOption
 from .citizenship import Citizenship
 from .department import Department
-from .fields import (
-    BirthNumberField, ColorField, EmailField, PostalCodeField, PriceField,
-)
+from .fields import BirthNumberField, ColorField, EmailField, PostalCodeField, PriceField, UniquePageField
 from .leprikonsite import LeprikonSite
 from .organizations import Organization
+from .pdfmail import PdfExportAndMailMixin
 from .place import Place
 from .printsetup import PrintSetup
 from .question import Question
 from .roles import Leader
 from .school import School
-from .schoolyear import SchoolYear
+from .schoolyear import SchoolYear, SchoolYearDivision
 from .targetgroup import TargetGroup
-from .utils import (
-    generate_variable_symbol, lazy_help_text_with_html_default, shorten,
-)
+from .times import AbstractTime, TimesMixin
+from .transaction import AbstractTransaction, Transaction
+from .utils import BankAccount, PaymentStatus, generate_variable_symbol, lazy_help_text_with_html_default
 
 logger = logging.getLogger(__name__)
 
 DEFAULT_TEXTS = {
-    'text_registration_received': paragraph(_(
-        'Hello,\n'
-        'thank You for submitting the registration.\n'
-        'We will inform you about its further processing.'
-    )),
-
-    'text_registration_approved': paragraph(_(
-        'Hello,\n'
-        'we are pleased to inform You, that Your registration was approved.\n'
-        'We are looking forward to see You.'
-    )),
-
-    'text_registration_refused': paragraph(_(
-        'Hello,\n'
-        'we are sorry to inform You, that Your registration was refused.'
-    )),
-
-    'text_registration_payment_request': paragraph(_(
-        'Hello,\n'
-        'we\'d like to ask You to pay for Your registration.\n'
-        'If You have already made the payment recently, please ignore this message.'
-    )),
-
-    'text_registration_canceled': paragraph(_(
-        'Hello,\n'
-        'Your registration was canceled.'
-    )),
-
-    'text_discount_granted': paragraph(_(
-        'Hello,\n'
-        'we have just grated a discount for Your registration.'
-    )),
-
-    'text_payment_received': paragraph(_(
-        'Hello,\n'
-        'we have just received Your payment. Thank You.\n'
-        'Please see the recipe attached.'
-    )),
+    "text_registration_received": paragraph(
+        _("Hello,\nthank You for submitting the registration.\nWe will inform you about its further processing.")
+    ),
+    "text_registration_approved": paragraph(
+        _(
+            "Hello,\nwe are pleased to inform You, that Your registration was approved.\n"
+            "We are looking forward to see You."
+        )
+    ),
+    "text_registration_refused": paragraph(
+        _("Hello,\nwe are sorry to inform You, that Your registration was refused.")
+    ),
+    "text_registration_payment_request": paragraph(
+        _(
+            "Hello,\nwe'd like to ask You to pay for Your registration.\n"
+            "If You have already made the payment recently, please ignore this message."
+        )
+    ),
+    "text_registration_refund_offer": paragraph(
+        _("Hello,\nYour registration has been overpaid.\nPlease, tell us how you wish us to refund.")
+    ),
+    "text_registration_canceled": paragraph(_("Hello,\nYour registration was canceled.")),
+    "text_discount_granted": paragraph(_("Hello,\nwe have just grated a discount for Your registration.")),
+    "text_payment_received": paragraph(
+        _("Hello,\nwe have just received Your payment. Thank You.\nPlease see the recipe attached.")
+    ),
+    "text_payment_returned": paragraph(
+        _("Hello,\nwe have just returned Your payment. Thank You.\nPlease see the recipe attached.")
+    ),
 }
 
-CHAT_GROUP_BROADCAST = 'B'
-CHAT_GROUP_CHAT = 'C'
-CHAT_GROUP_TYPE_LABELS = OrderedDict([
-    (CHAT_GROUP_BROADCAST, _('broadcast group')),
-    (CHAT_GROUP_CHAT, _('chat group')),
-])
-
-CHAT_GROUP_TYPE_HELP_TEXT = _(
-    'Only the leader can write to broadcast group. Users may reply to the sender with direct messages.\n'
-    'Chat group allows all members to chat with each other.'
-)
-
 
 class SubjectType(models.Model):
-    COURSE = 'course'
-    EVENT = 'event'
-    ORDERABLE = 'orderable'
-    subject_type_labels = OrderedDict([
-        (COURSE, _('course')),
-        (EVENT, _('event')),
-        (ORDERABLE, _('orderable event')),
-    ])
-    subject_type_type_labels = OrderedDict([
-        (COURSE, _('course type')),
-        (EVENT, _('event type')),
-        (ORDERABLE, _('orderable event type')),
-    ])
-    subject_type = models.CharField(_('subjects'), max_length=10, choices=subject_type_labels.items())
-    name = models.CharField(_('name (singular)'), max_length=150)
-    name_genitiv = models.CharField(_('name (genitiv)'), max_length=150, blank=True)
-    name_akuzativ = models.CharField(_('name (akuzativ)'), max_length=150, blank=True)
-    plural = models.CharField(_('name (plural)'), max_length=150)
-    slug = models.SlugField()
-    order = models.IntegerField(_('order'), blank=True, default=0)
+    COURSE = "course"
+    EVENT = "event"
+    ORDERABLE = "orderable"
+    subject_type_labels = OrderedDict(
+        [
+            (COURSE, _("course")),
+            (EVENT, _("event")),
+            (ORDERABLE, _("orderable event")),
+        ]
+    )
+    subject_type_type_labels = OrderedDict(
+        [
+            (COURSE, _("course type")),
+            (EVENT, _("event type")),
+            (ORDERABLE, _("orderable event type")),
+        ]
+    )
+    subject_type = models.CharField(_("subjects"), max_length=10, choices=subject_type_labels.items())
+    name = models.CharField(_("name (singular)"), max_length=150)
+    name_genitiv = models.CharField(_("name (genitiv)"), max_length=150, blank=True)
+    name_akuzativ = models.CharField(_("name (akuzativ)"), max_length=150, blank=True)
+    plural = models.CharField(_("name (plural)"), max_length=150)
+    slug = models.SlugField(unique=True)
+    page = UniquePageField(
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="leprikon_subject_type",
+        verbose_name=_("page"),
+        help_text=_(
+            "Select page, where the subjects will be listed. New subject type requireds new page. "
+            "If You assign an existing page, the current content of the page will be replaced "
+            "with the new subject list."
+        ),
+    )
+    order = models.IntegerField(_("order"), blank=True, default=0)
     questions = models.ManyToManyField(
-        Question, blank=True, related_name='+', verbose_name=_('additional questions'),
-        help_text=_('Add additional questions to be asked in the registration form.'),
+        Question,
+        blank=True,
+        related_name="+",
+        verbose_name=_("additional questions"),
+        help_text=_("Add additional questions to be asked in the registration form."),
     )
     registration_agreements = models.ManyToManyField(
-        Agreement, blank=True, related_name='+', verbose_name=_('additional legal agreements'),
-        help_text=_('Add additional legal agreements specific to this subject type.'),
+        Agreement,
+        blank=True,
+        related_name="+",
+        verbose_name=_("additional legal agreements"),
+        help_text=_("Add additional legal agreements specific to this subject type."),
+    )
+    reg_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("registration print setup"),
+    )
+    decision_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("decision print setup"),
+    )
+    pr_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("payment request print setup"),
+    )
+    bill_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("payment print setup"),
     )
-    reg_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                        related_name='+', verbose_name=_('registration print setup'))
-    pr_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                       related_name='+', verbose_name=_('payment request print setup'))
-    bill_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                         related_name='+', verbose_name=_('payment print setup'))
-    organization = models.ForeignKey(Organization, blank=True, null=True, on_delete=models.SET_NULL,
-                                     related_name='+', verbose_name=_('organization'))
-    chat_group_type = models.CharField(
-        _('default chat group type'), max_length=1, choices=CHAT_GROUP_TYPE_LABELS.items(),
-        default=CHAT_GROUP_BROADCAST, help_text=CHAT_GROUP_TYPE_HELP_TEXT,
+    organization = models.ForeignKey(
+        Organization, blank=True, null=True, on_delete=models.SET_NULL, related_name="+", verbose_name=_("organization")
     )
     text_registration_received = HTMLField(
-        _('text: registration received'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_registration_received']),
+        _("text: registration received"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_received"]),
     )
     text_registration_approved = HTMLField(
-        _('text: registration approved'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_registration_approved']),
+        _("text: registration approved"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_approved"]),
     )
     text_registration_refused = HTMLField(
-        _('text: registration refused'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_registration_refused']),
+        _("text: registration refused"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_refused"]),
     )
     text_registration_payment_request = HTMLField(
-        _('text: registration payment request'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_registration_payment_request']),
+        _("text: registration payment request"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_payment_request"]),
+    )
+    text_registration_refund_offer = HTMLField(
+        _("text: registration refund offer"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_refund_offer"]),
     )
     text_registration_canceled = HTMLField(
-        _('text: registration canceled'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_registration_canceled']),
+        _("text: registration canceled"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_registration_canceled"]),
     )
     text_discount_granted = HTMLField(
-        _('text: discount granted'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_discount_granted']),
+        _("text: discount granted"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_discount_granted"]),
     )
     text_payment_received = HTMLField(
-        _('text: payment received'), blank=True, default='',
-        help_text=lazy_help_text_with_html_default('', DEFAULT_TEXTS['text_payment_received']),
+        _("text: payment received"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_payment_received"]),
+    )
+    text_payment_returned = HTMLField(
+        _("text: payment returned"),
+        blank=True,
+        default="",
+        help_text=lazy_help_text_with_html_default("", DEFAULT_TEXTS["text_payment_returned"]),
     )
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('subject type')
-        verbose_name_plural = _('subject types')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("subject type")
+        verbose_name_plural = _("subject types")
 
     def __str__(self):
         return self.name
 
     def save(self, *args, **kwargs):
         if self.name_genitiv is None:
             self.name_genitiv = self.name
         if self.name_akuzativ is None:
             self.name_akuzativ = self.name
-        super(SubjectType, self).save(*args, **kwargs)
+        super().save(*args, **kwargs)
 
     @cached_property
     def all_questions(self):
         return list(self.questions.all())
 
     @cached_property
     def all_attachments(self):
         return list(self.attachments.all())
 
     def get_absolute_url(self):
-        return reverse(self.slug + ':subject_list')
+        return reverse(self.slug + ":subject_list")
+
+    def get_journals_url(self):
+        change_list = reverse("admin:leprikon_journal_changelist")
+        return f"{change_list}?subject__subject_type__id__exact={self.id}"
 
     def get_subjects_url(self):
-        change_list = reverse(f'admin:leprikon_{self.subject_type}_changelist')
-        return f'{change_list}?subject_type__id__exact={self.id}'
+        change_list = reverse(f"admin:leprikon_{self.subject_type}_changelist")
+        return f"{change_list}?subject_type__id__exact={self.id}"
 
     def get_registrations_url(self):
-        change_list = reverse(f'admin:leprikon_{self.subject_type}registration_changelist')
-        return f'{change_list}?subject__subject_type__id__exact={self.id}'
+        change_list = reverse(f"admin:leprikon_{self.subject_type}registration_changelist")
+        return f"{change_list}?subject__subject_type__id__exact={self.id}"
 
     def get_discounts_url(self):
-        change_list = reverse(f'admin:leprikon_{self.subject_type}discount_changelist')
-        return f'{change_list}?registration__subject__subject_type__id__exact={self.id}'
+        change_list = reverse(f"admin:leprikon_{self.subject_type}discount_changelist")
+        return f"{change_list}?registration__subject__subject_type__id__exact={self.id}"
 
-    def get_payments_url(self):
-        change_list = reverse('admin:leprikon_subjectpayment_changelist')
-        return f'{change_list}?registration__subject__subject_type__id__exact={self.id}'
+    def get_received_payments_url(self):
+        change_list = reverse("admin:leprikon_subjectreceivedpayment_changelist")
+        return f"{change_list}?target_registration__subject__subject_type__id__exact={self.id}"
+
+    def get_returned_payments_url(self):
+        change_list = reverse("admin:leprikon_subjectreturnedpayment_changelist")
+        return f"{change_list}?source_registration__subject__subject_type__id__exact={self.id}"
 
 
 class BaseAttachment(models.Model):
-    file = FilerFileField(on_delete=models.CASCADE, related_name='+')
-    public = models.BooleanField(_('public'), default=True,
-                                 help_text=_('The attachment will be available before registration.'))
-    events = MultiSelectField(_('send when'), blank=True, choices=(
-        ('registration_received', _('registration received')),
-        ('registration_approved', _('registration approved')),
-        ('registration_refused', _('registration refused')),
-        ('registration_payment_request', _('payment requested')),
-        ('registration_canceled', _('registration canceled')),
-        ('discount_granted', _('discount granted')),
-        ('payment_received', _('payment received')),
-    ), default=[], help_text=_('The attachment will be sent with notification on selected events.'))
-    order = models.IntegerField(_('order'), blank=True, default=0)
+    file = FilerFileField(on_delete=models.CASCADE, related_name="+")
+    public = models.BooleanField(
+        _("public"), default=True, help_text=_("The attachment will be available before registration.")
+    )
+    events = MultiSelectField(
+        _("send when"),
+        blank=True,
+        choices=(
+            ("registration_received", _("registration received")),
+            ("registration_approved", _("registration approved")),
+            ("registration_refused", _("registration refused")),
+            ("registration_payment_request", _("payment requested")),
+            ("registration_refund_offer", _("payment requested")),
+            ("registration_canceled", _("registration canceled")),
+            ("discount_granted", _("discount granted")),
+            ("payment_received", _("payment received")),
+            ("payment_returned", _("payment returned")),
+        ),
+        default=[],
+        help_text=_("The attachment will be sent with notification on selected events."),
+    )
+    order = models.IntegerField(_("order"), blank=True, default=0)
 
     class Meta:
         abstract = True
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('attachment')
-        verbose_name_plural = _('attachments')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("attachment")
+        verbose_name_plural = _("attachments")
 
     def __str__(self):
-        return force_text(self.file)
+        return str(self.file)
 
 
 class SubjectTypeAttachment(BaseAttachment):
-    subject_type = models.ForeignKey(SubjectType, on_delete=models.CASCADE,
-                                     related_name='attachments', verbose_name=_('subject type'))
+    subject_type = models.ForeignKey(
+        SubjectType, on_delete=models.CASCADE, related_name="attachments", verbose_name=_("subject type")
+    )
 
 
 class SubjectGroup(models.Model):
-    name = models.CharField(_('name'), max_length=150)
-    plural = models.CharField(_('plural'), max_length=150)
-    color = ColorField(_('color'))
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    subject_types = models.ManyToManyField(SubjectType, related_name='groups', verbose_name=_('subject type'))
+    name = models.CharField(_("name"), max_length=150)
+    plural = models.CharField(_("plural"), max_length=150)
+    color = ColorField(_("color"))
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    subject_types = models.ManyToManyField(SubjectType, related_name="groups", verbose_name=_("subject type"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('subject group')
-        verbose_name_plural = _('subject groups')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("subject group")
+        verbose_name_plural = _("subject groups")
 
     def __str__(self):
         return self.name
 
     @cached_property
     def font_color(self):
         (h, s, v) = colorsys.rgb_to_hsv(
             int(self.color[1:3], 16) / 255.0,
             int(self.color[3:5], 16) / 255.0,
             int(self.color[5:6], 16) / 255.0,
         )
-        if v > .5:
+        if v > 0.5:
             v = 0
         else:
             v = 1
-        if s > .5:
+        if s > 0.5:
             s = 0
         else:
             s = 1
         (r, g, b) = colorsys.hsv_to_rgb(h, s, v)
-        return '#{:02x}{:02x}{:02x}'.format(
+        return "#{:02x}{:02x}{:02x}".format(
             int(r * 255),
             int(g * 255),
             int(b * 255),
         )
 
 
-class PdfExportAndMailMixin(object):
-    all_attachments = []
-
-    def get_absolute_url(self):
-        return reverse('leprikon:{}_pdf'.format(self.object_name), kwargs={'pk': self.pk, 'slug': self.slug})
-
-    def select_template(self, event, suffix):
-        return select_template([
-            'leprikon/{}_{}/{}.{}'.format(self.object_name, event, param, suffix) for param in (
-                self.subject.subject_type.slug,
-                self.subject.subject_type.subject_type,
-                'subject',
-            )
-        ])
-
-    def get_context(self, event):
-        return {
-            'event': event,
-            'pdf_filename': self.get_pdf_filename(event),
-            'print_setup': self.get_print_setup(event),
-            'object': self,
-            'site': LeprikonSite.objects.get_current(),
-        }
-
-    def get_mail_subject(self, event):
-        return self.mail_subject_patterns[event].format(
-            subject_type=self.subject.subject_type.name_akuzativ,
-            subject=self.subject.name,
-        )
-
-    def get_attachments(self, event):
-        return None
-
-    def send_mail(self, event='received'):
-        template_txt = self.select_template(event, 'txt')
-        template_html = self.select_template(event, 'html')
-        context = self.get_context(event)
-        content_txt = template_txt.render(context)
-        content_html = template_html.render(context)
-        EmailMultiAlternatives(
-            subject=self.get_mail_subject(event),
-            body=content_txt,
-            from_email=settings.SERVER_EMAIL,
-            to=self.all_recipients,
-            headers={'X-Mailer': 'Leprikon (http://leprikon.cz/)'},
-            alternatives=[(content_html, 'text/html')],
-            attachments=self.get_attachments(event),
-        ).send()
-
-    def get_pdf_filename(self, event):
-        return self.slug + '.pdf'
-
-    def get_pdf_attachment(self, event):
-        return (self.get_pdf_filename(event), self.get_pdf(event), 'application/pdf')
-
-    def get_pdf(self, event):
-        output = BytesIO()
-        self.write_pdf(event, output)
-        output.seek(0)
-        return output.read()
-
-    def write_pdf(self, event, output):
-        # get plain pdf from rml
-        template = self.select_template(event, 'rml')
-        rml_content = template.render(self.get_context(event))
-        pdf_content = trml2pdf.parseString(rml_content.encode('utf-8'))
-        print_setup = self.get_print_setup(event)
-
-        # merge with background
-        if print_setup.background:
-            template_pdf = PdfFileReader(print_setup.background.file)
-            registration_pdf = PdfFileReader(BytesIO(pdf_content))
-            writer = PdfFileWriter()
-            # merge pages from both template and registration
-            for i in range(registration_pdf.getNumPages()):
-                if i < template_pdf.getNumPages():
-                    page = template_pdf.getPage(i)
-                    page.mergePage(registration_pdf.getPage(i))
-                else:
-                    page = registration_pdf.getPage(i)
-                writer.addPage(page)
-            # write result to output
-            writer.write(output)
-        else:
-            # write basic pdf registration to response
-            output.write(pdf_content)
-        return output
-
-
-class Subject(PdfExportAndMailMixin, models.Model):
-    object_name = 'subject'
-
-    PARTICIPANTS = 'P'
-    GROUPS = 'G'
+class Subject(TimesMixin, models.Model):
+    PARTICIPANTS = "P"
+    GROUPS = "G"
     REGISTRATION_TYPE_CHOICES = [
-        (PARTICIPANTS, _('participants')),
-        (GROUPS, _('groups')),
+        (PARTICIPANTS, _("participants")),
+        (GROUPS, _("groups")),
     ]
     REGISTRATION_TYPES = dict(REGISTRATION_TYPE_CHOICES)
 
-    school_year = models.ForeignKey(SchoolYear, editable=False, on_delete=models.CASCADE,
-                                    related_name='subjects', verbose_name=_('school year'))
-    subject_type = models.ForeignKey(SubjectType, on_delete=models.PROTECT,
-                                     related_name='subjects', verbose_name=_('subject type'))
-    registration_type = models.CharField(_('registration type'), choices=REGISTRATION_TYPE_CHOICES, max_length=1)
-    code = models.PositiveSmallIntegerField(_('accounting code'), blank=True, default=0)
-    name = models.CharField(_('name'), max_length=150)
-    description = HTMLField(_('description'), blank=True, default='')
-    department = models.ForeignKey(Department, blank=True, null=True, on_delete=models.SET_NULL,
-                                   related_name='subjects', verbose_name=_('department'))
-    groups = models.ManyToManyField(SubjectGroup, verbose_name=_('groups'), related_name='subjects', blank=True)
-    place = models.ForeignKey(Place, blank=True, null=True, on_delete=models.SET_NULL,
-                              related_name='subjects', verbose_name=_('place'))
-    age_groups = models.ManyToManyField(AgeGroup, related_name='subjects', verbose_name=_('age groups'))
-    target_groups = models.ManyToManyField(TargetGroup, related_name='subjects', verbose_name=_('target groups'))
-    leaders = models.ManyToManyField(Leader, blank=True, related_name='subjects', verbose_name=_('leaders'))
-    price = PriceField(_('price'), blank=True, null=True)
-    public = models.BooleanField(_('public'), default=False)
-    reg_from = models.DateTimeField(_('registration active from'), blank=True, null=True)
-    reg_to = models.DateTimeField(_('registration active to'), blank=True, null=True)
-    photo = FilerImageField(verbose_name=_('photo'), blank=True, null=True,
-                            related_name='+', on_delete=models.SET_NULL)
-    page = PageField(blank=True, null=True, on_delete=models.SET_NULL,
-                     related_name='+', verbose_name=_('page'))
-    min_participants_count = models.PositiveIntegerField(
-        _('minimal participants count per registration'),
-        default=1,
-        help_text=_('Participant details include birth number (birth day), age group, contacts, parent, etc.'),
+    school_year = models.ForeignKey(
+        SchoolYear, editable=False, on_delete=models.CASCADE, related_name="subjects", verbose_name=_("school year")
     )
-    max_participants_count = models.PositiveIntegerField(
-        _('maximal participants count per registration'),
-        default=1,
-        help_text=_('Participant details include birth number (birth day), age group, contacts, parent, etc.'),
-    )
-    min_group_members_count = models.PositiveIntegerField(
-        _('minimal group members count per registration'),
-        help_text=_('Group member details only include name and note.'),
-    )
-    max_group_members_count = models.PositiveIntegerField(
-        _('maximal group members count per registration'),
-        help_text=_('Group member details only include name and note.'),
-    )
-    min_registrations_count = models.PositiveIntegerField(_('minimal registrations count'), blank=True, null=True)
-    max_registrations_count = models.PositiveIntegerField(_('maximal registrations count'), blank=True, null=True)
-    min_due_date_days = models.PositiveIntegerField(_('minimal number of days to due date'), default=3)
-    risks = HTMLField(_('risks'), blank=True)
-    plan = HTMLField(_('plan'), blank=True)
-    evaluation = HTMLField(_('evaluation'), blank=True)
-    note = models.CharField(_('note'), max_length=300, blank=True, default='')
-    questions = models.ManyToManyField(Question, verbose_name=_('additional questions'),
-                                       related_name='+', blank=True,
-                                       help_text=_('Add additional questions to be asked in the registration form.'))
-    registration_agreements = models.ManyToManyField(
-        Agreement, blank=True, related_name='+', verbose_name=_('additional legal agreements'),
-        help_text=_('Add additional legal agreements specific for this subject.'),
+    subject_type = models.ForeignKey(
+        SubjectType, on_delete=models.PROTECT, related_name="subjects", verbose_name=_("subject type")
     )
-    reg_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                        related_name='+', verbose_name=_('registration print setup'),
-                                        help_text=_('Only use to set value specific for this subject.'))
-    pr_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                       related_name='+', verbose_name=_('payment request print setup'),
-                                       help_text=_('Only use to set value specific for this subject.'))
-    bill_print_setup = models.ForeignKey(PrintSetup, blank=True, null=True, on_delete=models.SET_NULL,
-                                         related_name='+', verbose_name=_('payment print setup'),
-                                         help_text=_('Only use to set value specific for this subject.'))
-    organization = models.ForeignKey(Organization, blank=True, null=True, on_delete=models.SET_NULL,
-                                     related_name='+', verbose_name=_('organization'),
-                                     help_text=_('Only use to set value specific for this subject.'))
-    chat_group_type = models.CharField(
-        _('chat group type'), blank=True, max_length=1, null=True, choices=CHAT_GROUP_TYPE_LABELS.items(),
-        help_text=CHAT_GROUP_TYPE_HELP_TEXT,
-    )
-    text_registration_received = HTMLField(_('text: registration received'), blank=True, default='')
-    text_registration_approved = HTMLField(_('text: registration approved'), blank=True, default='')
-    text_registration_refused = HTMLField(_('text: registration refused'), blank=True, default='')
-    text_registration_payment_request = HTMLField(_('text: registration payment request'), blank=True, default='')
-    text_registration_canceled = HTMLField(_('text: registration canceled'), blank=True, default='')
-    text_discount_granted = HTMLField(_('text: discount granted'), blank=True, default='')
-    text_payment_received = HTMLField(_('text: payment received'), blank=True, default='')
+    registration_type = models.CharField(
+        _("registration type"),
+        choices=REGISTRATION_TYPE_CHOICES,
+        max_length=1,
+        help_text=_(
+            "Participant details include birth number (birth day), age group, contacts, parent, etc. "
+            "Group member details only include name and note."
+        ),
+    )
+    code = models.PositiveSmallIntegerField(_("accounting code"), blank=True, default=0)
+    name = models.CharField(_("name"), max_length=150)
+    description = HTMLField(_("description"), blank=True, default="")
+    department = models.ForeignKey(
+        Department,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="subjects",
+        verbose_name=_("department"),
+    )
+    groups = models.ManyToManyField(SubjectGroup, verbose_name=_("groups"), related_name="subjects", blank=True)
+    place = models.ForeignKey(
+        Place, blank=True, null=True, on_delete=models.SET_NULL, related_name="subjects", verbose_name=_("place")
+    )
+    age_groups = models.ManyToManyField(AgeGroup, related_name="subjects", verbose_name=_("age groups"))
+    target_groups = models.ManyToManyField(TargetGroup, related_name="subjects", verbose_name=_("target groups"))
+    leaders = models.ManyToManyField(Leader, blank=True, related_name="subjects", verbose_name=_("leaders"))
+    public = models.BooleanField(_("public"), default=False)
+    photo = FilerImageField(verbose_name=_("photo"), blank=True, null=True, related_name="+", on_delete=models.SET_NULL)
+    page = PageField(blank=True, null=True, on_delete=models.SET_NULL, related_name="+", verbose_name=_("page"))
+    min_registrations_count = models.PositiveIntegerField(_("minimal registrations count"), blank=True, null=True)
+    max_registrations_count = models.PositiveIntegerField(_("maximal registrations count"), blank=True, null=True)
+    min_due_date_days = models.PositiveIntegerField(_("minimal number of days to due date"), default=3)
+    note = models.CharField(_("note"), max_length=300, blank=True, default="")
+    questions = models.ManyToManyField(
+        Question,
+        verbose_name=_("additional questions"),
+        related_name="+",
+        blank=True,
+        help_text=_("Add additional questions to be asked in the registration form."),
+    )
+    registration_agreements = models.ManyToManyField(
+        Agreement,
+        blank=True,
+        related_name="+",
+        verbose_name=_("additional legal agreements"),
+        help_text=_("Add additional legal agreements specific for this subject."),
+    )
+    reg_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("registration print setup"),
+        help_text=_("Only use to set value specific for this subject."),
+    )
+    decision_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("registration print setup"),
+        help_text=_("Only use to set value specific for this subject."),
+    )
+    pr_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("payment request print setup"),
+        help_text=_("Only use to set value specific for this subject."),
+    )
+    bill_print_setup = models.ForeignKey(
+        PrintSetup,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("payment print setup"),
+        help_text=_("Only use to set value specific for this subject."),
+    )
+    organization = models.ForeignKey(
+        Organization,
+        blank=True,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="+",
+        verbose_name=_("organization"),
+        help_text=_("Only use to set value specific for this subject."),
+    )
+    text_registration_received = HTMLField(_("text: registration received"), blank=True, default="")
+    text_registration_approved = HTMLField(_("text: registration approved"), blank=True, default="")
+    text_registration_refused = HTMLField(_("text: registration refused"), blank=True, default="")
+    text_registration_payment_request = HTMLField(_("text: registration payment request"), blank=True, default="")
+    text_registration_refund_offer = HTMLField(_("text: registration refund offer"), blank=True, default="")
+    text_registration_canceled = HTMLField(_("text: registration canceled"), blank=True, default="")
+    text_discount_granted = HTMLField(_("text: discount granted"), blank=True, default="")
+    text_payment_received = HTMLField(_("text: payment received"), blank=True, default="")
+    text_payment_returned = HTMLField(_("text: payment returned"), blank=True, default="")
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('code', 'name')
-        verbose_name = _('subject')
-        verbose_name_plural = _('subjects')
+        app_label = "leprikon"
+        ordering = ("code", "name")
+        verbose_name = _("subject")
+        verbose_name_plural = _("subjects")
 
     def __str__(self):
-        return '{} {}'.format(self.school_year, self.display_name)
+        return "{} {}".format(self.school_year, self.display_name)
 
     def save(self, *args, **kwargs):
-        if self.registration_type_participants:
-            self.min_group_members_count = 0
-            self.max_group_members_count = 0
-        elif self.registration_type_groups:
-            self.min_participants_count = 0
-            self.max_participants_count = 0
         # For some reason django doesn't set the default value for code,
         # which leads to database error.
         self.code = self.code or 0
         super().save(*args, **kwargs)
 
     @cached_property
+    def price_text(self) -> str:
+        return " | ".join(v.price_text for v in self.all_variants)
+
+    @cached_property
     def registration_type_participants(self):
         return self.registration_type == self.PARTICIPANTS
 
     @cached_property
     def registration_type_groups(self):
         return self.registration_type == self.GROUPS
 
     @cached_property
-    def slug(self):
-        return shorten(slugify(self), 100)
-
-    @cached_property
     def subject(self):
         if self.subject_type.subject_type == self.subject_type.COURSE:
             return self.course
         else:
             return self.event
 
     @cached_property
     def display_name(self):
         if settings.LEPRIKON_SHOW_SUBJECT_CODE and self.code:
-            return '{} – {}'.format(self.code, self.name)
+            return f"{self.code} – {self.name}"
         else:
             return self.name
 
     @cached_property
-    def all_variants(self):
+    def all_variants(self) -> List["SubjectVariant"]:
         return list(self.variants.all())
 
     @cached_property
-    def all_groups(self):
+    def all_available_variants(self) -> List["SubjectVariant"]:
+        return [variant for variant in self.all_variants if variant.registration_allowed]
+
+    @cached_property
+    def all_groups(self) -> List["SubjectGroup"]:
         return list(self.groups.all())
 
     @cached_property
-    def all_age_groups(self):
+    def all_age_groups(self) -> List["AgeGroup"]:
         return list(self.age_groups.all())
 
     @cached_property
-    def all_target_groups(self):
+    def all_target_groups(self) -> List["TargetGroup"]:
         return list(self.target_groups.all())
 
     @cached_property
-    def all_leaders(self):
+    def all_leaders(self) -> List[Leader]:
         return list(self.leaders.all())
 
     @cached_property
-    def all_questions(self):
+    def all_questions(self) -> Set["Question"]:
         return set(self.subject_type.all_questions + list(self.questions.all()))
 
     @cached_property
-    def all_attachments(self):
+    def all_attachments(self) -> List["SubjectAttachment"]:
         return list(self.attachments.all())
 
     @cached_property
     def public_attachments(self):
         return [
-            attachment
-            for attachment in (self.subject_type.all_attachments + self.all_attachments)
-            if attachment.public
+            attachment for attachment in (self.subject_type.all_attachments + self.all_attachments) if attachment.public
         ]
 
     @cached_property
-    def all_registrations(self):
+    def all_registrations(self) -> List["SubjectRegistration"]:
         return list(self.registrations.all())
 
-    def get_valid_participants(self, d):
-        qs = SubjectRegistrationParticipant.objects
-        if self.subject_type.subject_type == SubjectType.COURSE:
-            qs = qs.filter(
-                models.Q(registration__courseregistration__course_history__course_id=self.id) &
-                (
-                    models.Q(registration__courseregistration__course_history__end__isnull=True) |
-                    models.Q(registration__courseregistration__course_history__end__gte=d)
-                )
-            )
-        else:  # self.subject_type.subject_type in (SubjectType.EVENT, SubjectType.ORDERABLE):
-            qs = qs.filter(
-                registration__subject_id=self.id,
-                registration__approved__isnull=False,
+    @cached_property
+    def reg_from(self):
+        now = timezone.now()
+        if any(variant.reg_to and variant.reg_to > now and variant.reg_from is None for variant in self.all_variants):
+            return None
+        try:
+            return min(
+                variant.reg_from
+                for variant in self.all_variants
+                if variant.reg_from and (variant.reg_to is None or variant.reg_to > now)
             )
-        return qs.exclude(registration__canceled__date__lt=d)
+        except ValueError:
+            return None
 
     @cached_property
-    def all_approved_participants(self):
-        qs = SubjectRegistrationParticipant.objects
-        if self.subject_type.subject_type == SubjectType.COURSE:
-            qs = qs.filter(
-                registration__courseregistration__course_history__course_id=self.id,
-            ).annotate(
-                approved=models.F('registration__approved'),
-                canceled=models.F('registration__canceled'),
-            )
-        else:  # self.subject_type.subject_type in (SubjectType.EVENT, SubjectType.ORDERABLE):
-            qs = qs.filter(
-                registration__subject_id=self.id,
-                registration__approved__isnull=False,
+    def reg_to(self):
+        now = timezone.now()
+        if any(
+            variant.reg_from and variant.reg_from <= now and variant.reg_to is None for variant in self.all_variants
+        ):
+            return None
+        try:
+            return max(
+                variant.reg_to
+                for variant in self.all_variants
+                if variant.reg_to and (variant.reg_from is None or variant.reg_from <= now)
             )
-        return list(qs)
+        except ValueError:
+            return None
 
-    @property
+    @cached_property
     def registration_allowed(self):
-        now = timezone.now()
-        return (
-            self.price is not None and
-            (self.reg_from or self.reg_to) and
-            (self.reg_from is None or self.reg_from <= now) and
-            (self.reg_to is None or self.reg_to > now)
-        )
+        return any(variant.registration_allowed for variant in self.all_variants)
 
     @property
     def registration_not_allowed_message(self):
         now = timezone.now()
-        if self.price is not None:
-            if self.reg_from > now:
-                return _('Registering will start on {}.').format(self.reg_from)
-            if self.reg_to < now:
-                return _('Registering ended on {}').format(self.reg_to)
-        return _('Registering is currently not allowed.')
+        if self.reg_from > now:
+            return _("Registering will start on {}.").format(self.reg_from)
+        if self.reg_to < now:
+            return _("Registering ended on {}").format(self.reg_to)
 
     @property
     def full(self):
         return self.max_registrations_count and self.active_registrations_count >= self.max_registrations_count
 
+    @property
+    def over_capapcity(self):
+        return self.max_registrations_count and self.active_registrations_count > self.max_registrations_count
+
     def get_absolute_url(self):
-        return reverse(self.subject_type.slug + ':subject_detail', args=(self.id,))
+        return reverse(self.subject_type.slug + ":subject_detail", args=(self.id,))
 
     def get_registration_url(self):
-        return reverse(self.subject_type.slug + ':subject_registration_form', args=(self.id,))
+        return reverse(self.subject_type.slug + ":subject_registration_form", args=(self.id,))
 
     def get_edit_url(self):
-        return reverse('admin:leprikon_{}_change'.format(self.subject._meta.model_name), args=(self.id,))
+        return reverse("admin:leprikon_{}_change".format(self.subject._meta.model_name), args=(self.id,))
 
+    @attributes(short_description=_("age groups list"))
     def get_age_groups_list(self):
         return comma_separated(self.all_age_groups)
-    get_age_groups_list.short_description = _('age groups list')
 
+    @attributes(short_description=_("groups list"))
     def get_groups_list(self):
         return comma_separated(self.all_groups)
-    get_groups_list.short_description = _('groups list')
 
+    @attributes(short_description=_("leaders list"))
     def get_leaders_list(self):
         return comma_separated(self.all_leaders)
-    get_leaders_list.short_description = _('leaders list')
 
+    @attributes(short_description=_("target groups list"))
     def get_target_groups_list(self):
         return comma_separated(self.all_target_groups)
-    get_target_groups_list.short_description = _('target groups list')
 
     def get_print_setup(self, event):
         return PrintSetup()
 
+    def get_template_variants(self):
+        return (
+            self.subject_type.slug,
+            self.subject_type.subject_type,
+            "subject",
+        )
+
     @property
     def active_registrations(self):
         return self.registrations.filter(canceled=None)
 
     @cached_property
     def active_registrations_count(self):
         return self.active_registrations.count()
@@ -667,21 +664,14 @@
     def approved_registrations_count(self):
         return self.approved_registrations.count()
 
     @cached_property
     def all_approved_registrations(self):
         return list(self.approved_registrations.all())
 
-    @cached_property
-    def all_journal_periods(self):
-        if self.subject_type.subject_type == self.subject_type.COURSE:
-            return [JournalPeriod(self.course, period) for period in self.course.all_periods]
-        else:
-            return [JournalPeriod(self.event)]
-
     @property
     def unapproved_registrations(self):
         return self.active_registrations.filter(approved=None)
 
     @cached_property
     def unapproved_registrations_count(self):
         return self.unapproved_registrations.count()
@@ -695,241 +685,299 @@
         return self.inactive_registrations.count()
 
     @cached_property
     def all_inactive_registrations(self):
         return list(self.inactive_registrations.all())
 
     @cached_property
+    def all_journals(self):
+        return list(self.journals.all())
+
+    @cached_property
     def all_registration_agreements(self):
         return sorted(
             chain(
                 self.registration_agreements.all(),
                 self.subject_type.registration_agreements.all(),
                 LeprikonSite.objects.get_current().registration_agreements.all(),
             ),
-            key=lambda agreement: agreement.order
+            key=lambda agreement: agreement.order,
         )
 
 
-class JournalPeriod:
-    def __init__(self, subject, period=None):
-        self.subject = subject
-        self.period = period
-
-    @property
-    def all_journal_entries(self):
-        qs = self.subject.journal_entries.all()
-        if self.period:
-            if self.period != self.subject.all_periods[0]:
-                qs = qs.filter(date__gte=self.period.start)
-            if self.period != self.subject.all_periods[-1]:
-                qs = qs.filter(date__lte=self.period.end)
-        return list(qs)
-
-    @cached_property
-    def all_approved_participants(self):
-        if self.period:  # course
-            return [
-                participant
-                for participant in self.subject.all_approved_participants
-                if (
-                    participant.approved.date() <= self.period.end and
-                    (participant.canceled is None or participant.canceled.date() >= self.period.start)
-                )
-            ]
-        else:  # event
-            return self.subject.all_approved_participants
-
-    @cached_property
-    def all_alternates(self):
-        alternates = set()
-        for entry in self.all_journal_entries:
-            for alternate in entry.all_alternates:
-                alternates.add(alternate)
-        return list(alternates)
-
-    PresenceRecord = namedtuple('PresenceRecord', ('person', 'presences'))
-
-    def get_participant_presences(self):
-        return [
-            self.PresenceRecord(
-                participant,
-                [
-                    participant.id in entry.all_participants_idset
-                    for entry in self.all_journal_entries
-                ]
-            )
-            for participant in self.all_approved_participants
-        ]
-
-    def get_leader_presences(self):
-        return [
-            self.PresenceRecord(
-                leader,
-                [
-                    entry.all_leader_entries_by_leader.get(leader, None)
-                    for entry in self.all_journal_entries
-                ]
-            ) for leader in self.subject.all_leaders
-        ]
+class SubjectTime(AbstractTime):
+    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, related_name="times", verbose_name=_("course"))
 
-    def get_alternate_presences(self):
-        return [
-            self.PresenceRecord(
-                alternate,
-                [
-                    entry.all_leader_entries_by_leader.get(alternate, None)
-                    for entry in self.all_journal_entries
-                ]
-            ) for alternate in self.all_alternates
-        ]
+    class Meta:
+        app_label = "leprikon"
+        ordering = ("day_of_week", "start")
+        verbose_name = _("time")
+        verbose_name_plural = _("times")
 
 
 class SubjectVariant(models.Model):
-    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, related_name='variants', verbose_name=_('subject'))
-    name = models.CharField(_('variant name'), max_length=150)
-    description = HTMLField(_('variant description'), blank=True, default='')
-    price = PriceField(_('price'), blank=True, null=True)
-    order = models.IntegerField(_('order'), blank=True, default=0)
+    subject = models.ForeignKey(Subject, on_delete=models.CASCADE, related_name="variants", verbose_name=_("subject"))
+    name = models.CharField(_("variant name"), max_length=150, blank=True, default="")
+    description = HTMLField(_("variant description"), blank=True, default="")
+    reg_from = models.DateTimeField(_("registration active from"), blank=True, null=True)
+    reg_to = models.DateTimeField(_("registration active to"), blank=True, null=True)
+    age_groups = models.ManyToManyField(AgeGroup, related_name="subject_variants", verbose_name=_("age groups"))
+    target_groups = models.ManyToManyField(
+        TargetGroup, related_name="subject_variants", verbose_name=_("target groups")
+    )
+    min_participants_count = models.PositiveIntegerField(
+        _("minimal participants / group members count per registration"), default=1
+    )
+    max_participants_count = models.PositiveIntegerField(
+        _("maximal participants / group members count per registration"), default=1
+    )
+    registration_price = PriceField(_("price per registration"), default=0)
+    participant_price = PriceField(_("price per participant"), default=0)
+    school_year_division = models.ForeignKey(
+        SchoolYearDivision,
+        blank=True,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="variants",
+        verbose_name=_("school year division"),
+    )
+    allow_period_selection = models.BooleanField(
+        _("allow period selection"),
+        default=False,
+        help_text=_("allow user to choose school year periods on registration form"),
+    )
+    order = models.IntegerField(_("order"), blank=True, default=0)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('variant')
-        verbose_name_plural = _('variants')
+        app_label = "leprikon"
+        ordering = ("subject", "order")
+        verbose_name = _("variant")
+        verbose_name_plural = _("variants")
 
     def __str__(self):
-        return self.name
+        return f"{self.subject.display_name} / {self.name}" if self.name else self.subject.display_name
+
+    @cached_property
+    def price_text(self) -> str:
+        price = currency(self.get_price())
+        if self.school_year_division:
+            return f"{price} / {self.school_year_division.price_unit_name}"
+        return price
+
+    def get_price(self, participants_count=None) -> Decimal:
+        if participants_count is None:
+            participants_count = self.min_participants_count
+        return self.registration_price + participants_count * self.participant_price
+
+    def get_registration_url(self):
+        return reverse(self.subject.subject_type.slug + ":subject_registration_form", args=(self.subject_id, self.id))
+
+    @property
+    def registration_allowed(self):
+        now = timezone.now()
+        return (
+            (self.reg_from or self.reg_to)
+            and (self.reg_from is None or self.reg_from <= now)
+            and (self.reg_to is None or self.reg_to > now)
+        )
 
 
 class SubjectAttachment(BaseAttachment):
-    subject = models.ForeignKey(Subject, on_delete=models.CASCADE,
-                                related_name='attachments', verbose_name=_('subject'))
+    subject = models.ForeignKey(
+        Subject, on_delete=models.CASCADE, related_name="attachments", verbose_name=_("subject")
+    )
 
 
 class SubjectRegistration(PdfExportAndMailMixin, models.Model):
-    object_name = 'registration'
-
+    object_name = "registration"
     slug = models.SlugField(editable=False, max_length=250, null=True)
-    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.PROTECT,
-                             related_name='leprikon_registrations', verbose_name=_('user'))
-    subject = models.ForeignKey(Subject, on_delete=models.PROTECT,
-                                related_name='registrations', verbose_name=_('subject'))
-    subject_variant = models.ForeignKey(SubjectVariant, null=True, on_delete=models.PROTECT,
-                                        related_name='registrations', verbose_name=_('variant'))
-    price = PriceField(_('price'), editable=False)
-
-    created = models.DateTimeField(_('time of registration'), editable=False, auto_now_add=True)
-    created_by = models.ForeignKey(settings.AUTH_USER_MODEL, editable=False, null=True, on_delete=models.PROTECT,
-                                   related_name='+', verbose_name=_('created by'))
-    approved = models.DateTimeField(_('time of approval'), editable=False, null=True)
-    approved_by = models.ForeignKey(settings.AUTH_USER_MODEL, editable=False, null=True, on_delete=models.PROTECT,
-                                    related_name='+', verbose_name=_('approved by'))
-    payment_requested = models.DateTimeField(_('payment request time'), editable=False, null=True)
+    user = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        on_delete=models.PROTECT,
+        related_name="leprikon_registrations",
+        verbose_name=_("user"),
+    )
+    subject = models.ForeignKey(
+        Subject, on_delete=models.PROTECT, related_name="registrations", verbose_name=_("subject")
+    )
+    subject_variant = models.ForeignKey(
+        SubjectVariant, on_delete=models.PROTECT, related_name="registrations", verbose_name=_("variant")
+    )
+    price = PriceField(_("price"), editable=False)
+
+    created = models.DateTimeField(_("time of registration"), editable=False, auto_now_add=True)
+    created_by = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("created by"),
+    )
+    approved = models.DateTimeField(_("time of approval"), editable=False, null=True)
+    approved_by = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("approved by"),
+    )
+    payment_requested = models.DateTimeField(_("payment request time"), editable=False, null=True)
     payment_requested_by = models.ForeignKey(
-        settings.AUTH_USER_MODEL, editable=False, null=True, on_delete=models.PROTECT, related_name='+',
-        verbose_name=_('payment requested by'),
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("payment requested by"),
+    )
+    refund_offered = models.DateTimeField(_("payment request time"), editable=False, null=True)
+    refund_offered_by = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("payment requested by"),
     )
-    cancelation_requested = models.DateTimeField(_('time of cancellation request'), editable=False, null=True)
+    cancelation_requested = models.DateTimeField(_("time of cancellation request"), editable=False, null=True)
     cancelation_requested_by = models.ForeignKey(
-        settings.AUTH_USER_MODEL, editable=False, null=True, on_delete=models.PROTECT, related_name='+',
-        verbose_name=_('cancelation requested by'),
-    )
-    canceled = models.DateTimeField(_('time of cancellation'), editable=False, null=True)
-    canceled_by = models.ForeignKey(settings.AUTH_USER_MODEL, editable=False, null=True, on_delete=models.PROTECT,
-                                    related_name='+', verbose_name=_('canceled by'))
-    note = models.CharField(_('note'), max_length=300, blank=True, default='')
-
-    questions = models.ManyToManyField(Question, editable=False, related_name='registrations')
-    agreements = models.ManyToManyField(Agreement, editable=False, related_name='registrations')
-    agreement_options = models.ManyToManyField(AgreementOption, blank=True, verbose_name=_('legal agreements'))
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("cancelation requested by"),
+    )
+    canceled = models.DateTimeField(_("time of cancellation"), editable=False, null=True)
+    canceled_by = models.ForeignKey(
+        settings.AUTH_USER_MODEL,
+        editable=False,
+        null=True,
+        on_delete=models.PROTECT,
+        related_name="+",
+        verbose_name=_("canceled by"),
+    )
+    note = models.CharField(_("note"), max_length=300, blank=True, default="")
+
+    questions = models.ManyToManyField(Question, editable=False, related_name="registrations")
+    agreements = models.ManyToManyField(Agreement, editable=False, related_name="registrations")
+    agreement_options = models.ManyToManyField(AgreementOption, blank=True, verbose_name=_("legal agreements"))
 
-    variable_symbol = models.BigIntegerField(_('variable symbol'), db_index=True, editable=False, null=True)
+    variable_symbol = models.BigIntegerField(_("variable symbol"), db_index=True, editable=False, null=True)
 
     registration_link = models.ForeignKey(
-        'leprikon.RegistrationLink', editable=False, null=True,
-        on_delete=models.SET_NULL, related_name='registrations', verbose_name=_('registration link'),
+        "leprikon.RegistrationLink",
+        editable=False,
+        null=True,
+        on_delete=models.SET_NULL,
+        related_name="registrations",
+        verbose_name=_("registration link"),
     )
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('registration')
-        verbose_name_plural = _('registrations')
+        app_label = "leprikon"
+        verbose_name = _("registration")
+        verbose_name_plural = _("registrations")
 
     def __str__(self):
-        return '{} - {}'.format(
+        return "{} - {}".format(
             self.subject,
-            self.group if self.subject.registration_type_groups else comma_separated([
-                p.full_name for p in self.all_participants
-            ])
+            self.group
+            if self.subject.registration_type_groups
+            else comma_separated([p.full_name for p in self.all_participants]),
         )
 
     def get_edit_url(self):
-        return reverse('admin:leprikon_{}_change'.format(self.subjectregistration._meta.model_name), args=(self.id,))
+        return reverse("admin:leprikon_{}_change".format(self.subjectregistration._meta.model_name), args=(self.id,))
 
     def get_payment_request_url(self):
-        return reverse('leprikon:registration_payment_request', args=(self.id, self.variable_symbol))
+        return reverse("leprikon:registration_payment_request", args=(self.id, self.variable_symbol))
 
     @cached_property
     def subjectregistration(self):
         if self.subject.subject_type.subject_type == self.subject.subject_type.COURSE:
             return self.courseregistration
         elif self.subject.subject_type.subject_type == self.subject.subject_type.EVENT:
             return self.eventregistration
         elif self.subject.subject_type.subject_type == self.subject.subject_type.ORDERABLE:
             return self.orderableregistration
         raise NotImplementedError()
 
     @cached_property
-    def all_participants(self):
+    def all_participants(self) -> List["SubjectRegistrationParticipant"]:
         return list(self.participants.all())
 
+    @attributes(short_description=_("participants"))
     def participants_list(self):
-        return '\n'.join(map(str, self.all_participants))
-    participants_list.short_description = _('participants')
+        return "\n".join(map(str, self.all_participants))
 
+    @attributes(short_description=_("participants"))
     def participants_list_html(self):
-        return mark_safe('<br/>'.join(map(str, self.all_participants)))
-    participants_list_html.short_description = _('participants')
+        if self.all_participants:
+            participant_links = []
+            for participant in self.all_participants:
+                if participant.birth_num:
+                    query = dict(participants__birth_num=participant.birth_num)
+                else:
+                    query = dict(
+                        participants__birth_date=participant.birth_date,
+                        participants__first_name=participant.first_name,
+                        participants__last_name=participant.last_name,
+                    )
+                url = "?" + urlencode(query)
+                count = (
+                    type(self).objects.filter(subject__school_year_id=self.subject.school_year_id, **query).count() - 1
+                )
+                if count:
+                    title = ngettext("%d other registration", "%d other registrations", count) % count
+                else:
+                    title = _("no other registration")
+                participant_links.append(f"""<a href="{url}" title="{title}">{participant}""")
+            return mark_safe("<br/>".join(participant_links))
+        return self.group_members_list_html()
 
     @cached_property
     def all_group_members(self):
         return list(self.group_members.all())
 
+    @attributes(short_description=_("group members"))
     def group_members_list(self):
-        return '\n'.join(map(str, self.all_group_members))
-    group_members_list.short_description = _('group members')
+        return "\n".join(map(str, self.all_group_members))
 
+    @attributes(short_description=_("group members"))
     def group_members_list_html(self):
-        return mark_safe('<br/>'.join(map(str, self.all_group_members)))
-    group_members_list_html.short_description = _('group members')
+        return mark_safe("<br/>".join(map(str, self.all_group_members)))
 
     @cached_property
     def all_questions(self):
         return list(self.questions.all())
 
     @cached_property
     def all_agreements(self):
         return list(self.agreements.all())
 
     @cached_property
     def all_agreement_options(self):
         return list(self.agreement_options.all())
 
+    @attributes(short_description=_("agreement options"))
     def agreement_options_list(self):
         lines = []
         for agreement in self.all_agreements:
-            lines.append(agreement.name + ':')
+            lines.append(agreement.name + ":")
             for option in agreement.all_options:
-                lines.append('{checkbox} {option_name}'.format(
-                    checkbox=('☑' if option.required or option in self.all_agreement_options else '☐'),
-                    option_name=option.name,
-                ))
-        return '\n'.join(lines)
-    agreement_options_list.short_description = _('agreement options')
+                lines.append(
+                    "{checkbox} {option_name}".format(
+                        checkbox=("☑" if option.required or option in self.all_agreement_options else "☐"),
+                        option_name=option.name,
+                    )
+                )
+        return "\n".join(lines)
 
     @cached_property
     def all_attachments(self):
         return self.subject.all_attachments + self.subject.subject_type.all_attachments
 
     @cached_property
     def all_recipients(self):
@@ -941,390 +989,499 @@
         return recipients
 
     @cached_property
     def all_discounts(self):
         return list(self.discounts.all())
 
     @cached_property
-    def all_payments(self):
-        return list(self.payments.all())
+    def all_received_payments(self):
+        return list(self.received_payments.all())
+
+    @cached_property
+    def all_returned_payments(self):
+        return list(self.returned_payments.all())
 
     @cached_property
-    def payment_status(self):
+    def payment_status(self) -> PaymentStatus:
         return self.get_payment_status()
 
+    def get_payment_status(self, d=None) -> PaymentStatus:
+        return self.subjectregistration.get_payment_status(d)
+
     @cached_property
     def organization(self):
         return (
-            self.subject.organization or
-            self.subject.subject_type.organization or
-            LeprikonSite.objects.get_current().organization or
-            Organization()
+            self.subject.organization
+            or self.subject.subject_type.organization
+            or LeprikonSite.objects.get_current().organization
+            or Organization()
         )
 
     @cached_property
     def spayd(self):
         org = self.organization
         return spayd(
-            ('ACC', ('%s+%s' % (org.iban, org.bic)) if org.bic else org.iban),
-            ('AM', self.payment_status.amount_due),
-            ('CC', localeconv['int_curr_symbol'].strip()),
-            ('MSG', '%s, %s' % (self.subject.name[:29], str(self)[:29])),
-            ('RN', slugify(self.organization.name).replace('*', '')[:35]),
-            ('X-VS', self.variable_symbol),
+            ("ACC", ("%s+%s" % (org.iban, org.bic)) if org.bic else org.iban),
+            ("AM", self.payment_status.amount_due),
+            ("CC", localeconv["int_curr_symbol"].strip()),
+            ("MSG", "%s, %s" % (self.subject.name[:29], str(self)[:29])),
+            ("RN", slugify(self.organization.name).replace("*", "")[:35]),
+            ("X-VS", self.variable_symbol),
         )
 
     @cached_property
     def payment_url(self):
         leprikon_site = LeprikonSite.objects.get_current()
         return pays_payment_url(
             gateway=leprikon_site.payment_gateway,
             order_id=self.variable_symbol,
             amount=self.payment_status.amount_due,
             email=self.user.email,
         )
 
     @cached_property
+    def price_text(self) -> str:
+        price = currency(self.price)
+        if self.subject_variant.school_year_division_id:
+            return f"{price} / {self.subject_variant.school_year_division.price_unit_name}"
+        return price
+
+    @cached_property
     def text_registration_received(self):
         return (
-            self.subject.text_registration_received or
-            self.subject.subject_type.text_registration_received or
-            DEFAULT_TEXTS['text_registration_received']
+            self.subject.text_registration_received
+            or self.subject.subject_type.text_registration_received
+            or DEFAULT_TEXTS["text_registration_received"]
         )
 
     @cached_property
     def text_registration_approved(self):
         return (
-            self.subject.text_registration_approved or
-            self.subject.subject_type.text_registration_approved or
-            DEFAULT_TEXTS['text_registration_approved']
+            self.subject.text_registration_approved
+            or self.subject.subject_type.text_registration_approved
+            or DEFAULT_TEXTS["text_registration_approved"]
         )
 
     @cached_property
     def text_registration_refused(self):
         return (
-            self.subject.text_registration_refused or
-            self.subject.subject_type.text_registration_refused or
-            DEFAULT_TEXTS['text_registration_refused']
+            self.subject.text_registration_refused
+            or self.subject.subject_type.text_registration_refused
+            or DEFAULT_TEXTS["text_registration_refused"]
         )
 
     @cached_property
     def text_registration_payment_request(self):
         return (
-            self.subject.text_registration_payment_request or
-            self.subject.subject_type.text_registration_payment_request or
-            DEFAULT_TEXTS['text_registration_payment_request']
+            self.subject.text_registration_payment_request
+            or self.subject.subject_type.text_registration_payment_request
+            or DEFAULT_TEXTS["text_registration_payment_request"]
+        )
+
+    @cached_property
+    def text_registration_refund_offer(self):
+        return (
+            self.subject.text_registration_refund_offer
+            or self.subject.subject_type.text_registration_refund_offer
+            or DEFAULT_TEXTS["text_registration_refund_offer"]
         )
 
     @cached_property
     def text_registration_canceled(self):
         return (
-            self.subject.text_registration_canceled or
-            self.subject.subject_type.text_registration_canceled or
-            DEFAULT_TEXTS['text_registration_canceled']
+            self.subject.text_registration_canceled
+            or self.subject.subject_type.text_registration_canceled
+            or DEFAULT_TEXTS["text_registration_canceled"]
         )
 
     @cached_property
     def text_discount_granted(self):
         return (
-            self.subject.text_discount_granted or
-            self.subject.subject_type.text_discount_granted or
-            DEFAULT_TEXTS['text_discount_granted']
+            self.subject.text_discount_granted
+            or self.subject.subject_type.text_discount_granted
+            or DEFAULT_TEXTS["text_discount_granted"]
         )
 
     @cached_property
     def text_payment_received(self):
         return (
-            self.subject.text_payment_received or
-            self.subject.subject_type.text_payment_received or
-            DEFAULT_TEXTS['text_payment_received']
+            self.subject.text_payment_received
+            or self.subject.subject_type.text_payment_received
+            or DEFAULT_TEXTS["text_payment_received"]
+        )
+
+    @cached_property
+    def text_payment_returned(self):
+        return (
+            self.subject.text_payment_returned
+            or self.subject.subject_type.text_payment_returned
+            or DEFAULT_TEXTS["text_payment_returned"]
         )
 
     def get_discounts(self, d):
         if d:
             return [p for p in self.all_discounts if p.accounted.date() <= d]
         else:
             return self.all_discounts
 
-    def get_payments(self, d):
+    def get_received_payments(self, d):
+        if d:
+            return [p for p in self.all_received_payments if p.accounted.date() <= d]
+        else:
+            return self.all_received_payments
+
+    def get_returned_payments(self, d):
         if d:
-            return [p for p in self.all_payments if p.accounted.date() <= d]
+            return [r for r in self.all_returned_payments if r.accounted.date() <= d]
         else:
-            return self.all_payments
+            return self.all_returned_payments
 
     def get_pdf_filename(self, event):
-        if event == 'payment_request':
+        if event == "payment_request":
             return basename(self.get_payment_request_url())
-        return self.slug + '.pdf'
+        if event == "pdf":
+            return f"{self.slug}.pdf"
+        return f"{self.slug}-{event}.pdf"
 
     def get_discounted(self, d=None):
         return sum(p.amount for p in self.get_discounts(d))
 
-    def get_paid(self, d=None):
-        return sum(p.amount for p in self.get_payments(d))
+    def get_received(self, d=None):
+        return sum(p.amount for p in self.get_received_payments(d))
+
+    def get_returned(self, d=None):
+        return sum(r.amount for r in self.get_returned_payments(d))
 
     def get_qr_code(self):
         output = BytesIO()
         self.write_qr_code(output)
         output.seek(0)
         return output.read()
 
     def write_qr_code(self, output):
-        qrcode.make(self.spayd, border=1).save(output)
+        segno.make(self.spayd).save(output, kind="PNG")
 
     def write_pdf(self, event, output):
-        if event == 'payment_request':
-            with NamedTemporaryFile(buffering=0, suffix='.png') as qr_code_file:
+        if event == "payment_request":
+            with NamedTemporaryFile(buffering=0, suffix=".png") as qr_code_file:
                 self.write_qr_code(qr_code_file)
                 qr_code_file.flush()
                 self.qr_code_filename = qr_code_file.name
                 return super().write_pdf(event, output)
         else:
             return super().write_pdf(event, output)
 
-    mail_subject_patterns = {
-        'received': _('Registration for {subject_type} {subject}'),
-        'payment_request': _('Registration for {subject_type} {subject} - payment request'),
-        'approved': _('Registration for {subject_type} {subject} was approved'),
-        'refused': _('Registration for {subject_type} {subject} was refused'),
-        'canceled': _('Registration for {subject_type} {subject} was canceled'),
-    }
-
     @transaction.atomic
     def approve(self, approved_by):
         if self.approved is None:
             self.canceled = None
             self.canceled_by = None
             self.approved = timezone.now()
             self.approved_by = approved_by
             self.save()
-            self.send_mail('approved')
+            self.send_mail("approved")
             if not self.payment_requested:
                 self.request_payment(approved_by)
+            if len(self.subject.all_journals) == 1:
+                journal = self.subject.all_journals[0]
+                for participant in self.all_participants:
+                    journal.participants.add(participant)
         else:
-            raise ValidationError((
-                _('Unfortunately, it is not possible to restore canceled registration {r}. Please create new one.')
-                if self.canceled else
-                _('The registration {r} has already been approved.')
-            ).format(r=self))
+            raise ValidationError(
+                (
+                    _("Unfortunately, it is not possible to restore canceled registration {r}. Please create new one.")
+                    if self.canceled
+                    else _("The registration {r} has already been approved.")
+                ).format(r=self)
+            )
 
     @transaction.atomic
     def request_payment(self, payment_requested_by):
         if not self.payment_requested:
             self.payment_requested = timezone.now()
             self.payment_requested_by = payment_requested_by
             self.save()
             # refresh all cached statuses
             self = type(self).objects.get(id=self.id)
         if self.payment_status.amount_due:
-            self.send_mail('payment_request')
+            self.send_mail("payment_request")
+
+    @transaction.atomic
+    def offer_refund(self, refund_offered_by):
+        if self.payment_status.overpaid:
+            self.refund_offered = timezone.now()
+            self.refund_offered_by = refund_offered_by
+            self.save()
+            self.send_mail("refund_offer")
+
+    @transaction.atomic
+    def generate_refund_request(self, generated_by):
+        from .refundrequest import RefundRequest
+
+        if not self.payment_status.overpaid:
+            return
+        remote_accounts = set(
+            account
+            for account in self.received_payments.annotate(
+                account=models.F("bankreader_transaction__remote_account_number")
+            ).values_list("account", flat=True)
+            if account
+        )
+        if len(remote_accounts) == 1:
+            RefundRequest.objects.create(
+                registration=self,
+                requested_by=generated_by,
+                bank_account=BankAccount(remote_accounts.pop()),
+            )
 
     def refuse(self, refused_by):
         if self.approved is None:
             if self.canceled is None:
                 with transaction.atomic():
                     self.canceled = timezone.now()
                     self.canceled_by = refused_by
                     self.save()
-                    self.send_mail('refused')
+                    self.send_mail("refused")
             else:
-                raise ValidationError(_('The registration {r} has already been refued.').format(r=self))
+                raise ValidationError(_("The registration {r} has already been refued.").format(r=self))
         else:
-            raise ValidationError(_(
-                'Unfortunately, it is not possible to refuse the registration {r}. However, You may cancel it.'
-            ).format(r=self))
+            raise ValidationError(
+                _(
+                    "Unfortunately, it is not possible to refuse the registration {r}. However, You may cancel it."
+                ).format(r=self)
+            )
 
     def cancel(self, canceled_by):
         if self.approved:
             if self.canceled is None:
                 with transaction.atomic():
                     self.canceled = timezone.now()
                     self.canceled_by = canceled_by
                     self.save()
-                    self.send_mail('canceled')
+                    self.send_mail("canceled")
             else:
-                raise ValidationError(_('The registration {r} has already been canceled.').format(r=self))
+                raise ValidationError(_("The registration {r} has already been canceled.").format(r=self))
         else:
-            raise ValidationError(_(
-                'Unfortunately, it is not possible to cancel the registration {r}. However, You may refuse it.'
-            ).format(r=self))
+            raise ValidationError(
+                _(
+                    "Unfortunately, it is not possible to cancel the registration {r}. However, You may refuse it."
+                ).format(r=self)
+            )
 
     def generate_variable_symbol_and_slug(self):
         self.variable_symbol = generate_variable_symbol(self)
-        self.slug = '{}-{}'.format(
-            slugify('{}-{}'.format(
-                self.subject.name[:100],
-                self.group if self.subject.registration_type_groups else comma_separated([
-                    p.full_name for p in self.all_participants
-                ]),
-            ))[:200],
+        self.slug = "{}-{}".format(
+            slugify(
+                "{}-{}".format(
+                    self.subject.name[:100],
+                    self.group
+                    if self.subject.registration_type_groups
+                    else comma_separated([p.full_name for p in self.all_participants]),
+                )
+            )[:200],
             self.variable_symbol,
         )
         self.save()
 
     def get_print_setup(self, event):
-        if event == 'payment_request':
+        if event == "payment_request":
+            return (
+                self.subject.pr_print_setup
+                or self.subject.subject_type.pr_print_setup
+                or LeprikonSite.objects.get_current().pr_print_setup
+                or PrintSetup()
+            )
+        if event == "decision":
             return (
-                self.subject.pr_print_setup or
-                self.subject.subject_type.pr_print_setup or
-                LeprikonSite.objects.get_current().pr_print_setup or
-                PrintSetup()
+                self.subject.decision_print_setup
+                or self.subject.subject_type.decision_print_setup
+                or LeprikonSite.objects.get_current().decision_print_setup
+                or PrintSetup()
             )
         return (
-            self.subject.reg_print_setup or
-            self.subject.subject_type.reg_print_setup or
-            LeprikonSite.objects.get_current().reg_print_setup or
-            PrintSetup()
+            self.subject.reg_print_setup
+            or self.subject.subject_type.reg_print_setup
+            or LeprikonSite.objects.get_current().reg_print_setup
+            or PrintSetup()
+        )
+
+    def get_template_variants(self):
+        return (
+            self.subject.subject_type.slug,
+            self.subject.subject_type.subject_type,
+            "subject",
         )
 
     def get_attachments(self, event):
         attachments = []
 
-        if event == 'payment_request':
+        if event == "payment_request":
             if self.organization.iban:
                 qr_code = MIMEImage(self.get_qr_code())
-                qr_code.add_header('Content-ID', '<qr_code>')
+                qr_code.add_header("Content-ID", "<qr_code>")
                 attachments.append(qr_code)
             attachments.append(self.get_pdf_attachment(event))
 
         attachments += [
-            (basename(attachment.file.file.path), open(attachment.file.file.path, 'rb').read())
+            (basename(attachment.file.file.path), open(attachment.file.file.path, "rb").read())
             for attachment in self.all_attachments
-            if f'registration_{event}' in attachment.events
+            if f"registration_{event}" in attachment.events
         ]
         return attachments or None
 
 
 class QuestionsMixin:
     def get_answers(self):
         return loads(self.answers)
 
     def get_questions_and_answers(self):
         answers = self.get_answers()
         for q in self.registration.all_questions:
             yield {
-                'question': q.question,
-                'answer': answers.get(q.name, ''),
+                "question": q.question,
+                "answer": answers.get(q.slug, ""),
             }
 
 
 class PersonMixin:
     @cached_property
     def full_name(self):
-        return '{} {}'.format(self.first_name, self.last_name)
+        return "{} {}".format(self.first_name, self.last_name)
 
     @cached_property
     def address(self):
-        return '{}, {}, {}'.format(self.street, self.city, self.postal_code)
+        return "{}, {}, {}".format(self.street, self.city, self.postal_code)
 
     @cached_property
     def contact(self):
         if self.email and self.phone:
-            return '{}, {}'.format(self.phone, self.email)
+            return "{}, {}".format(self.phone, self.email)
         else:
-            return self.email or self.phone or ''
+            return self.email or self.phone or ""
 
 
 class SchoolMixin:
     @cached_property
-    def school_name(self):
-        return self.school and smart_text(self.school) or self.school_other
+    def school_name(self) -> str:
+        return self.school and str(self.school) or self.school_other
 
     @cached_property
-    def school_and_class(self):
-        return '{}, {}'.format(self.school_name, self.school_class)
+    def school_and_class(self) -> str:
+        return "{}, {}".format(self.school_name, self.school_class)
 
 
 class SubjectRegistrationParticipant(SchoolMixin, PersonMixin, QuestionsMixin, models.Model):
-    registration = models.ForeignKey(SubjectRegistration, on_delete=models.CASCADE,
-                                     related_name='participants', verbose_name=_('registration'))
-    first_name = models.CharField(_('first name'), max_length=30)
-    last_name = models.CharField(_('last name'), max_length=30)
-    citizenship = models.ForeignKey(Citizenship, on_delete=models.PROTECT,
-                                    related_name='+', verbose_name=_('citizenship'))
-    birth_num = BirthNumberField(_('birth number'), blank=True, null=True)
-    birth_date = models.DateField(_('birth date'))
-    gender = models.CharField(_('gender'), max_length=1,
-                              choices=((MALE, _('male / boy')), (FEMALE, _('female / girl'))))
-    age_group = models.ForeignKey(AgeGroup, on_delete=models.PROTECT,
-                                  related_name='+', verbose_name=_('age group'))
-    street = models.CharField(_('street'), max_length=150)
-    city = models.CharField(_('city'), max_length=150)
-    postal_code = PostalCodeField(_('postal code'))
-    phone = models.CharField(_('phone'), max_length=30, blank=True, default='')
-    email = EmailField(_('email address'), blank=True, default='')
-
-    school = models.ForeignKey(School, blank=True, null=True, on_delete=models.PROTECT,
-                               related_name='+', verbose_name=_('school'))
-    school_other = models.CharField(_('other school'), max_length=150, blank=True, default='')
-    school_class = models.CharField(_('class'), max_length=30, blank=True, default='')
-    health = models.TextField(_('health'), blank=True, default='')
-
-    has_parent1 = models.BooleanField(_('first parent'), default=False)
-    parent1_first_name = models.CharField(_('first name'), max_length=30, blank=True, null=True)
-    parent1_last_name = models.CharField(_('last name'), max_length=30, blank=True, null=True)
-    parent1_street = models.CharField(_('street'), max_length=150, blank=True, null=True)
-    parent1_city = models.CharField(_('city'), max_length=150, blank=True, null=True)
-    parent1_postal_code = PostalCodeField(_('postal code'), blank=True, null=True)
-    parent1_phone = models.CharField(_('phone'), max_length=30, blank=True, null=True)
-    parent1_email = EmailField(_('email address'), blank=True, null=True)
-
-    has_parent2 = models.BooleanField(_('second parent'), default=False)
-    parent2_first_name = models.CharField(_('first name'), max_length=30, blank=True, null=True)
-    parent2_last_name = models.CharField(_('last name'), max_length=30, blank=True, null=True)
-    parent2_street = models.CharField(_('street'), max_length=150, blank=True, null=True)
-    parent2_city = models.CharField(_('city'), max_length=150, blank=True, null=True)
-    parent2_postal_code = PostalCodeField(_('postal code'), blank=True, null=True)
-    parent2_phone = models.CharField(_('phone'), max_length=30, blank=True, null=True)
-    parent2_email = EmailField(_('email address'), blank=True, null=True)
+    registration = models.ForeignKey(
+        SubjectRegistration, on_delete=models.CASCADE, related_name="participants", verbose_name=_("registration")
+    )
+    first_name = models.CharField(_("first name"), max_length=30)
+    last_name = models.CharField(_("last name"), max_length=30)
+    citizenship = models.ForeignKey(
+        Citizenship, on_delete=models.PROTECT, related_name="+", verbose_name=_("citizenship")
+    )
+    birth_num = BirthNumberField(_("birth number"), blank=True, null=True)
+    birth_date = models.DateField(_("birth date"))
+    gender = models.CharField(
+        _("gender"), max_length=1, choices=((MALE, _("male / boy")), (FEMALE, _("female / girl")))
+    )
+    age_group = models.ForeignKey(AgeGroup, on_delete=models.PROTECT, related_name="+", verbose_name=_("age group"))
+    street = models.CharField(_("street"), max_length=150)
+    city = models.CharField(_("city"), max_length=150)
+    postal_code = PostalCodeField(_("postal code"))
+    phone = models.CharField(_("phone"), max_length=30, blank=True, default="")
+    email = EmailField(_("email address"), blank=True, default="")
+
+    school = models.ForeignKey(
+        School, blank=True, null=True, on_delete=models.PROTECT, related_name="+", verbose_name=_("school")
+    )
+    school_other = models.CharField(_("other school"), max_length=150, blank=True, default="")
+    school_class = models.CharField(_("class"), max_length=30, blank=True, default="")
+    health = models.TextField(_("health"), blank=True, default="")
+
+    has_parent1 = models.BooleanField(_("first parent"), default=False)
+    parent1_first_name = models.CharField(_("first name"), max_length=30, blank=True, null=True)
+    parent1_last_name = models.CharField(_("last name"), max_length=30, blank=True, null=True)
+    parent1_street = models.CharField(_("street"), max_length=150, blank=True, null=True)
+    parent1_city = models.CharField(_("city"), max_length=150, blank=True, null=True)
+    parent1_postal_code = PostalCodeField(_("postal code"), blank=True, null=True)
+    parent1_phone = models.CharField(_("phone"), max_length=30, blank=True, null=True)
+    parent1_email = EmailField(_("email address"), blank=True, null=True)
+
+    has_parent2 = models.BooleanField(_("second parent"), default=False)
+    parent2_first_name = models.CharField(_("first name"), max_length=30, blank=True, null=True)
+    parent2_last_name = models.CharField(_("last name"), max_length=30, blank=True, null=True)
+    parent2_street = models.CharField(_("street"), max_length=150, blank=True, null=True)
+    parent2_city = models.CharField(_("city"), max_length=150, blank=True, null=True)
+    parent2_postal_code = PostalCodeField(_("postal code"), blank=True, null=True)
+    parent2_phone = models.CharField(_("phone"), max_length=30, blank=True, null=True)
+    parent2_email = EmailField(_("email address"), blank=True, null=True)
 
-    answers = models.TextField(_('additional answers'), blank=True, default='{}', editable=False)
+    answers = models.TextField(_("additional answers"), blank=True, default="{}", editable=False)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('last_name', 'first_name')
-        verbose_name = _('participant')
-        verbose_name_plural = _('participants')
+        app_label = "leprikon"
+        ordering = ("last_name", "first_name")
+        verbose_name = _("participant")
+        verbose_name_plural = _("participants")
 
     def __str__(self):
-        return '{full_name} ({birth_year})'.format(
+        return "{full_name} ({birth_year})".format(
             full_name=self.full_name,
             birth_year=self.birth_date.year,
         )
 
+    label = cached_property(__str__)
+
+    @cached_property
+    def key(self):
+        return (self.first_name.lower(), self.last_name.lower(), self.birth_date)
+
     @cached_property
     def parents(self):
         return list(p for p in [self.parent1, self.parent2] if p is not None)
 
+    @attributes(short_description=_("first parent"))
     @cached_property
     def parent1(self):
         if self.has_parent1:
-            return self.Parent(self, 'parent1')
+            return self.Parent(self, "parent1")
         else:
             return None
-    parent1.short_description = _('first parent')
 
+    @attributes(short_description=_("second parent"))
     @cached_property
     def parent2(self):
         if self.has_parent2:
-            return self.Parent(self, 'parent2')
+            return self.Parent(self, "parent2")
         else:
             return None
-    parent2.short_description = _('second parent')
 
     @cached_property
     def all_recipients(self):
         # don't use unverified emails
         # TODO: implement verification process
         return set()
         # recipients = set(parent.email for parent in self.parents if parent.email)
         # if self.email:
         #     recipients.add(self.email)
         # return recipients
 
+    PresenceRecord = namedtuple("PresenceRecord", ("entry", "present"))
+
+    @property
+    def presences(self):
+        from .journals import JournalEntry
+
+        present_entry_ids = set(self.journal_entries.values_list("id", flat=True))
+
+        return [
+            self.PresenceRecord(entry, entry.id in present_entry_ids)
+            for entry in JournalEntry.objects.filter(journal__participants=self)
+        ]
+
     def save(self, *args, **kwargs):
         if not self.has_parent1:
             if self.has_parent2:
                 self.parent1_first_name = self.parent2_first_name
                 self.parent1_last_name = self.parent2_last_name
                 self.parent1_street = self.parent2_street
                 self.parent1_city = self.parent2_city
@@ -1353,312 +1510,303 @@
 
     class Parent(PersonMixin):
         def __init__(self, registration, role):
             self._registration = registration
             self._role = role
 
         def __getattr__(self, attr):
-            return getattr(self._registration, '{}_{}'.format(self._role, attr))
+            return getattr(self._registration, "{}_{}".format(self._role, attr))
 
         def __str__(self):
             return self.full_name
 
 
 class SubjectRegistrationGroup(SchoolMixin, PersonMixin, QuestionsMixin, models.Model):
-    registration = models.OneToOneField(SubjectRegistration, on_delete=models.CASCADE,
-                                        related_name='group', verbose_name=_('registration'))
-    target_group = models.ForeignKey(TargetGroup, on_delete=models.PROTECT,
-                                     related_name='+', verbose_name=_('target group'))
-    name = models.CharField(_('group name'), blank=True, default='', max_length=150)
-    first_name = models.CharField(_('first name'), max_length=30)
-    last_name = models.CharField(_('last name'), max_length=30)
-    street = models.CharField(_('street'), max_length=150)
-    city = models.CharField(_('city'), max_length=150)
-    postal_code = PostalCodeField(_('postal code'))
-    phone = models.CharField(_('phone'), max_length=30)
-    email = EmailField(_('email address'))
-    school = models.ForeignKey(School, blank=True, null=True, on_delete=models.PROTECT,
-                               related_name='+', verbose_name=_('school'))
-    school_other = models.CharField(_('other school'), max_length=150, blank=True, default='')
-    school_class = models.CharField(_('class'), max_length=30, blank=True, default='')
+    registration = models.OneToOneField(
+        SubjectRegistration, on_delete=models.CASCADE, related_name="group", verbose_name=_("registration")
+    )
+    target_group = models.ForeignKey(
+        TargetGroup, on_delete=models.PROTECT, related_name="+", verbose_name=_("target group")
+    )
+    name = models.CharField(_("group name"), blank=True, default="", max_length=150)
+    first_name = models.CharField(_("first name"), max_length=30)
+    last_name = models.CharField(_("last name"), max_length=30)
+    street = models.CharField(_("street"), max_length=150)
+    city = models.CharField(_("city"), max_length=150)
+    postal_code = PostalCodeField(_("postal code"))
+    phone = models.CharField(_("phone"), max_length=30)
+    email = EmailField(_("email address"))
+    school = models.ForeignKey(
+        School, blank=True, null=True, on_delete=models.PROTECT, related_name="+", verbose_name=_("school")
+    )
+    school_other = models.CharField(_("other school"), max_length=150, blank=True, default="")
+    school_class = models.CharField(_("class"), max_length=30, blank=True, default="")
 
-    answers = models.TextField(_('additional answers'), blank=True, default='{}', editable=False)
+    answers = models.TextField(_("additional answers"), blank=True, default="{}", editable=False)
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('registered group')
-        verbose_name_plural = _('registered groups')
+        app_label = "leprikon"
+        verbose_name = _("registered group")
+        verbose_name_plural = _("registered groups")
 
     def __str__(self):
         return self.name or self.full_name
 
 
 class SubjectRegistrationGroupMember(models.Model):
-    registration = models.ForeignKey(SubjectRegistration, on_delete=models.CASCADE,
-                                     related_name='group_members', verbose_name=_('registration'))
-    first_name = models.CharField(_('first name'), max_length=30)
-    last_name = models.CharField(_('last name'), max_length=30)
-    note = models.CharField(_('note'), max_length=150, blank=True, default='')
+    registration = models.ForeignKey(
+        SubjectRegistration, on_delete=models.CASCADE, related_name="group_members", verbose_name=_("registration")
+    )
+    first_name = models.CharField(_("first name"), max_length=30)
+    last_name = models.CharField(_("last name"), max_length=30)
+    note = models.CharField(_("note"), max_length=150, blank=True, default="")
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('group member')
-        verbose_name_plural = _('group members')
+        app_label = "leprikon"
+        verbose_name = _("group member")
+        verbose_name_plural = _("group members")
 
     def __str__(self):
-        return '{full_name} ({note})'.format(
-            full_name=self.full_name,
-            note=self.note,
-        ) if self.note else self.full_name
+        return (
+            "{full_name} ({note})".format(
+                full_name=self.full_name,
+                note=self.note,
+            )
+            if self.note
+            else self.full_name
+        )
 
     @cached_property
     def full_name(self):
-        return '{} {}'.format(self.first_name, self.last_name)
+        return "{} {}".format(self.first_name, self.last_name)
 
 
 class SubjectRegistrationBillingInfo(models.Model):
-    registration = models.OneToOneField(SubjectRegistration, on_delete=models.CASCADE,
-                                        related_name='billing_info', verbose_name=_('registration'))
-    name = models.CharField(_('name'), max_length=150)
-    street = models.CharField(_('street'), max_length=150, blank=True, default='')
-    city = models.CharField(_('city'), max_length=150, blank=True, default='')
-    postal_code = PostalCodeField(_('postal code'), blank=True, default='')
-    company_num = models.CharField(_('company number'), max_length=8, blank=True, default='')
-    vat_number = models.CharField(_('VAT number'), max_length=12, blank=True, default='')
-    contact_person = models.CharField(_('contact person'), max_length=60, blank=True, default='')
-    phone = models.CharField(_('phone'), max_length=30, blank=True, default='')
-    email = EmailField(_('email address'), blank=True, default='')
-    employee = models.CharField(_('employee ID'), max_length=150, blank=True, default='')
+    registration = models.OneToOneField(
+        SubjectRegistration, on_delete=models.CASCADE, related_name="billing_info", verbose_name=_("registration")
+    )
+    name = models.CharField(_("name"), max_length=150)
+    street = models.CharField(_("street"), max_length=150, blank=True, default="")
+    city = models.CharField(_("city"), max_length=150, blank=True, default="")
+    postal_code = PostalCodeField(_("postal code"), blank=True, default="")
+    company_num = models.CharField(_("company number"), max_length=8, blank=True, default="")
+    vat_number = models.CharField(_("VAT number"), max_length=12, blank=True, default="")
+    contact_person = models.CharField(_("contact person"), max_length=60, blank=True, default="")
+    phone = models.CharField(_("phone"), max_length=30, blank=True, default="")
+    email = EmailField(_("email address"), blank=True, default="")
+    employee = models.CharField(_("employee ID"), max_length=150, blank=True, default="")
 
     class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('billing information')
-        verbose_name_plural = _('billing information')
+        app_label = "leprikon"
+        verbose_name = _("billing information")
+        verbose_name_plural = _("billing information")
 
     def __str__(self):
         return self.name
 
+    @attributes(short_description=_("address"))
     @cached_property
     def address(self):
-        return ', '.join(filter(bool, (self.street, self.city, self.postal_code)))
-    address.short_description = _('address')
-
-
-class TransactionMixin(object):
-    def save(self, *args, **kwargs):
-        self.clean()
-        super(TransactionMixin, self).save(*args, **kwargs)
-
-    def clean(self):
-        errors = {}
-        if self.amount == 0:
-            errors['amount'] = [_('Amount can not be zero.')]
-        if self.accounted:
-            max_closure_date = LeprikonSite.objects.get_current().max_closure_date
-            if max_closure_date and self.accounted.date() <= max_closure_date:
-                errors['accounted'] = [
-                    _('Date must be after the last account closure ({}).').format(
-                        formats.date_format(max_closure_date)
-                    )
-                ]
-        if errors:
-            raise ValidationError(errors)
+        return ", ".join(filter(bool, (self.street, self.city, self.postal_code)))
 
 
-class SubjectDiscount(TransactionMixin, models.Model):
-    accounted = models.DateTimeField(_('accounted time'), default=timezone.now)
-    amount = PriceField(_('discount'), default=0)
-    explanation = models.CharField(_('discount explanation'), max_length=250, blank=True, default='')
+class SubjectDiscount(AbstractTransaction):
+    amount = PriceField(_("discount"), default=0)
+    explanation = models.CharField(_("discount explanation"), max_length=250, blank=True, default="")
 
     class Meta:
         abstract = True
-        app_label = 'leprikon'
-        verbose_name = _('discount')
-        verbose_name_plural = _('discounts')
-        ordering = ('accounted',)
+        app_label = "leprikon"
+        verbose_name = _("discount")
+        verbose_name_plural = _("discounts")
+        ordering = ("accounted",)
 
     def __str__(self):
         return currency(self.amount)
 
 
-class SubjectPayment(PdfExportAndMailMixin, TransactionMixin, models.Model):
-    object_name = 'payment'
-
-    PAYMENT_CASH = 'PAYMENT_CASH'
-    PAYMENT_BANK = 'PAYMENT_BANK'
-    PAYMENT_ONLINE = 'PAYMENT_ONLINE'
-    PAYMENT_TRANSFER = 'PAYMENT_TRANSFER'
-    RETURN_CASH = 'RETURN_CASH'
-    RETURN_BANK = 'RETURN_BANK'
-    RETURN_TRANSFER = 'RETURN_TRANSFER'
-    payment_type_labels = OrderedDict([
-        (PAYMENT_CASH, _('payment - cash')),
-        (PAYMENT_BANK, _('payment - bank')),
-        (PAYMENT_ONLINE, _('payment - online')),
-        (PAYMENT_TRANSFER, _('payment - transfer from return')),
-        (RETURN_CASH, _('return - cash')),
-        (RETURN_BANK, _('return - bank')),
-        (RETURN_TRANSFER, _('return - transfer to payment')),
-    ])
-    payments = frozenset({PAYMENT_CASH, PAYMENT_BANK, PAYMENT_ONLINE, PAYMENT_TRANSFER})
-    returns = frozenset({RETURN_CASH, RETURN_BANK, RETURN_TRANSFER})
-
-    registration = models.ForeignKey(SubjectRegistration, on_delete=models.PROTECT,
-                                     related_name='payments', verbose_name=_('registration'))
-    accounted = models.DateTimeField(_('accounted time'), default=timezone.now)
-    mail_sent = models.DateTimeField(_('mail sent'), editable=False, null=True)
-    payment_type = models.CharField(_('payment type'), max_length=30, choices=payment_type_labels.items())
-    amount = PriceField(_('amount'), help_text=_('positive value for payment, negative value for return'))
-    note = models.CharField(_('note'), max_length=300, blank=True, default='')
-    related_payment = models.OneToOneField('self', blank=True, limit_choices_to={
-        'payment_type__in': (PAYMENT_TRANSFER, RETURN_TRANSFER)
-    }, null=True, on_delete=models.PROTECT, related_name='related_payments', verbose_name=_('related payment'))
-    bankreader_transaction = models.OneToOneField(BankreaderTransaction, blank=True, null=True,
-                                                  on_delete=models.PROTECT, verbose_name=_('bank account transaction'))
-    pays_payment = models.OneToOneField(PaysPayment, blank=True, editable=False,
-                                        limit_choices_to={'status': PaysPayment.REALIZED},
-                                        null=True, on_delete=models.PROTECT, verbose_name=_('online payment'))
-    received_by = models.ForeignKey(settings.AUTH_USER_MODEL, null=True, on_delete=models.PROTECT,
-                                    related_name='+', verbose_name=_('received by'))
-
-    class Meta:
-        app_label = 'leprikon'
-        verbose_name = _('payment')
-        verbose_name_plural = _('payments')
-        ordering = ('accounted',)
-
-    def __str__(self):
-        return '{payment_type} {amount}'.format(
-            payment_type=self.payment_type_label,
-            amount=currency(abs(self.amount)),
-        )
-
+class SubjectPaymentMixin:
     @cached_property
-    def organization(self):
+    def subject_organization(self):
         return (
-            self.registration.subject.organization or
-            self.registration.subject.subject_type.organization or
-            LeprikonSite.objects.get_current().organization or
-            Organization()
+            self.registration.subject.organization
+            or self.registration.subject.subject_type.organization
+            or LeprikonSite.objects.get_current().organization
+            or Organization()
         )
 
     @cached_property
-    def payment_type_label(self):
-        return self.payment_type_labels.get(self.payment_type, '-')
-    payment_type_label.short_description = _('payment type')
-
-    @cached_property
     def slug(self):
-        return '{}-{}'.format(self.registration.slug, self.id)
+        return f"{self.registration.slug}-{self.id}"
 
     def get_print_setup(self, event):
         return (
-            self.registration.subject.bill_print_setup or
-            self.registration.subject.subject_type.bill_print_setup or
-            LeprikonSite.objects.get_current().bill_print_setup or
-            PrintSetup()
+            self.registration.subject.bill_print_setup
+            or self.registration.subject.subject_type.bill_print_setup
+            or LeprikonSite.objects.get_current().bill_print_setup
+            or PrintSetup()
         )
 
-    @cached_property
-    def subject(self):
-        return self.registration.subject
-
-    mail_subject_patterns = {
-        'received': _('Registration for {subject_type} {subject} - payment confirmation'),
-    }
+    def get_template_variants(self):
+        return (
+            self.registration.subject.subject_type.slug,
+            self.registration.subject.subject_type.subject_type,
+            "subject",
+        )
 
     def get_attachments(self, event):
         attachments = []
 
-        if event == 'received':
-            attachments.append(self.get_pdf_attachment('pdf'))
+        if event == "received":
+            attachments.append(self.get_pdf_attachment("pdf"))
 
         attachments += [
-            (basename(attachment.file.file.path), open(attachment.file.file.path, 'rb').read())
+            (basename(attachment.file.file.path), open(attachment.file.file.path, "rb").read())
             for attachment in self.registration.all_attachments
-            if f'payment_{event}' in attachment.events
+            if f"{self.object_name}_{event}" in attachment.events
         ]
         return attachments or None
 
     @cached_property
     def all_recipients(self):
         return self.registration.all_recipients
 
-    def clean(self):
-        errors = {}
-        try:
-            super(SubjectPayment, self).clean()
-        except ValidationError as e:
-            errors = e.update_error_dict(errors)
-
-        # ensure at most one relation
-        if [self.related_payment, self.bankreader_transaction, self.pays_payment].count(None) < 2:
-            message = _('Payment can only have one relation.')
-            if self.related_payment:
-                errors['related_payment'] = message
-            if self.bankreader_transaction:
-                errors['bankreader_transaction'] = message
-        else:
-            if self.related_payment:
-                valid_payment_type = (
-                    SubjectPayment.PAYMENT_TRANSFER
-                    if self.related_payment.payment_type == SubjectPayment.RETURN_TRANSFER
-                    else SubjectPayment.RETURN_TRANSFER
-                )
-                valid_amount = -self.related_payment.amount
-            if self.bankreader_transaction:
-                valid_payment_type = (
-                    SubjectPayment.PAYMENT_BANK
-                    if self.bankreader_transaction.amount > 0
-                    else SubjectPayment.RETURN_BANK
-                )
-                valid_amount = self.bankreader_transaction.amount
-            if self.related_payment or self.bankreader_transaction:
-                if self.payment_type != valid_payment_type:
-                    errors.setdefault('payment_type', []).append(
-                        _('Payment type must be {valid_payment_type}.').format(
-                            valid_payment_type=self.payment_type_labels[valid_payment_type],
-                        )
-                    )
-                if self.amount != valid_amount:
-                    errors.setdefault('amount', []).append(
-                        _('Amount must be {valid_amount}.').format(valid_amount=valid_amount)
-                    )
-        if errors:
-            raise ValidationError(errors)
 
-    def send_mail(self, event='received'):
-        with transaction.atomic():
-            self.mail_sent = timezone.now()
-            self.save()
-            super().send_mail(event)
+class SubjectPayment(Transaction):
+    object_name = "payment"
+    transaction_types = Transaction.SUBJECTS
+
+    class Meta:
+        proxy = True
+        verbose_name = _("payment")
+        verbose_name_plural = _("payments")
+
+    @cached_property
+    def sub_payments(self):
+        sub_payments = []
+        if self.target_registration:
+            sub_payments.append(
+                SubjectReceivedPayment(**{key: value for key, value in self.__dict__.items() if key[0] != "_"})
+            )
+        if self.source_registration:
+            sub_payments.append(
+                SubjectReturnedPayment(**{key: value for key, value in self.__dict__.items() if key[0] != "_"})
+            )
+        return sub_payments
+
+
+class SubjectReceivedPayment(SubjectPaymentMixin, Transaction):
+    object_name = "received_payment"
+    transaction_types = Transaction.PAYMENTS
+
+    class Meta:
+        proxy = True
+        verbose_name = _("received payment")
+        verbose_name_plural = _("received payments")
+
+    @property
+    def real_amount(self):
+        return self.amount
+
+    @attributes(short_description=_("target registration"))
+    @cached_property
+    def registration(self):
+        return self.target_registration
+
+
+class SubjectReturnedPayment(SubjectPaymentMixin, Transaction):
+    object_name = "returned_payment"
+    transaction_types = Transaction.RETURNS
+
+    class Meta:
+        proxy = True
+        verbose_name = _("returned payment")
+        verbose_name_plural = _("returned payments")
+
+    @property
+    def real_amount(self):
+        return -self.amount
+
+    @attributes(short_description=_("source registration"))
+    @cached_property
+    def registration(self):
+        return self.source_registration
 
 
 @receiver(models.signals.post_save, sender=PaysPayment)
 def payment_create_subject_payment(instance, **kwargs):
     payment = instance
     # check realized payment
     if payment.status != PaysPayment.REALIZED:
         return
     # check registration
     try:
         registration = SubjectRegistration.objects.get(variable_symbol=int(payment.order_id))
     except (ValueError, SubjectRegistration.DoesNotExist):
         return
     # create payment
-    SubjectPayment.objects.create(
-        registration=registration,
+    Transaction.objects.create(
+        transaction_type=Transaction.PAYMENT_ONLINE,
+        target_registration=registration,
         accounted=payment.created,
-        payment_type=SubjectPayment.PAYMENT_ONLINE,
         amount=payment.amount / payment.base_units,
-        note=_('received online payment'),
+        note=_("received online payment"),
         pays_payment=payment,
     )
 
 
+@receiver(models.signals.post_save, sender=SubjectType)
+def subject_type_update_page(instance, **kwargs):
+    subject_type = instance
+    if subject_type.page_id:
+        updated = Page.objects.filter(
+            application_urls="LeprikonSubjectTypeApp",
+            application_namespace=subject_type.slug,
+        ).exclude(models.Q(id=subject_type.page_id) | models.Q(publisher_draft=subject_type.page_id)).update(
+            application_urls=None,
+            application_namespace=None,
+        ) + Page.objects.filter(
+            models.Q(id=subject_type.page_id) | models.Q(publisher_draft=subject_type.page_id)
+        ).update(
+            application_urls="LeprikonSubjectTypeApp",
+            application_namespace=subject_type.slug,
+        )
+    else:
+        updated = Page.objects.filter(
+            application_urls="LeprikonSubjectTypeApp",
+            application_namespace=subject_type.slug,
+        ).update(
+            application_urls=None,
+            application_namespace=None,
+        )
+    if updated:
+        set_restart_trigger()
+
+
+@receiver(models.signals.post_save, sender=Page)
+def page_update_subject_type(instance, **kwargs):
+    page = instance
+    if not page.publisher_is_draft:
+        return
+    if page.application_urls != "LeprikonSubjectTypeApp":
+        SubjectType.objects.filter(page=page).update(page=None)
+        return
+    subject_type = SubjectType.objects.filter(slug=page.application_namespace).first()
+    if subject_type is None:
+        Page.objects.filter(id=page.id).update(
+            application_urls=None,
+            application_namespace=None,
+        )
+        set_restart_trigger()
+        return
+    SubjectType.objects.filter(page=page).exclude(id=subject_type.id).update(page=None)
+    if subject_type.page_id != page.id:
+        SubjectType.objects.filter(id=subject_type.id).update(page=page)
+
+
 @receiver(models.signals.post_save, sender=BankreaderTransaction)
 def transaction_create_subject_payment(instance, **kwargs):
     transaction = instance
     # check variable symbol
     if not transaction.variable_symbol:
         return
     # check closure date (use closure date from cached leprikon site)
@@ -1666,15 +1814,25 @@
     if max_closure_date and transaction.accounted_date <= max_closure_date:
         return
     # check registration
     registration = SubjectRegistration.objects.filter(variable_symbol=transaction.variable_symbol).first()
     if not registration:
         return
     # create payment
-    SubjectPayment.objects.create(
-        registration=registration,
+    if transaction.amount < 0:
+        kwargs = {
+            "transaction_type": Transaction.RETURN_BANK,
+            "source_registration": registration,
+            "amount": -transaction.amount,
+        }
+    else:
+        kwargs = {
+            "transaction_type": Transaction.PAYMENT_BANK,
+            "target_registration": registration,
+            "amount": transaction.amount,
+        }
+    Transaction.objects.create(
         accounted=timezone.make_aware(datetime.combine(transaction.accounted_date, time(12))),
-        payment_type=SubjectPayment.PAYMENT_BANK if transaction.amount >= 0 else SubjectPayment.RETURN_BANK,
-        amount=transaction.amount,
-        note=_('imported from account statement'),
+        note=_("imported from account statement"),
         bankreader_transaction=transaction,
+        **kwargs,
     )
```

### Comparing `leprikon-3.0.0/leprikon/models/targetgroup.py` & `leprikon-3.5.0/leprikon/models/targetgroup.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 from django.db import models
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..utils import first_upper
 
 
 class TargetGroup(models.Model):
-    name = models.CharField(_('name'), max_length=50)
-    order = models.IntegerField(_('order'), blank=True, default=0)
-    require_school = models.BooleanField(_('require school'), default=True)
+    name = models.CharField(_("name"), max_length=50)
+    order = models.IntegerField(_("order"), blank=True, default=0)
+    require_school = models.BooleanField(_("require school"), default=True)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('target group')
-        verbose_name_plural = _('target groups')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("target group")
+        verbose_name_plural = _("target groups")
 
     def __str__(self):
         return self.name
 
     def title(self):
         return first_upper(self.name)
```

### Comparing `leprikon-3.0.0/leprikon/models/timesheets.py` & `leprikon-3.5.0/leprikon/models/timesheets.py`

 * *Files 11% similar despite different names*

```diff
@@ -2,89 +2,91 @@
 from collections import namedtuple
 from datetime import date, datetime, timedelta
 
 from django.db import models
 from django.urls import reverse_lazy as reverse
 from django.utils.dateformat import DateFormat
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from djangocms_text_ckeditor.fields import HTMLField
 
+from ..utils import attributes
 from .roles import Leader
 from .startend import StartEndMixin
 
 
 def start_end_by_date(d):
     # we work with monthly timesheets by default
     # TODO: allow weekly and quarterly timesheets by settings
     return {
-        'start': date(d.year, d.month, 1),
-        'end': date(d.year, d.month, calendar.monthrange(d.year, d.month)[1]),
+        "start": date(d.year, d.month, 1),
+        "end": date(d.year, d.month, calendar.monthrange(d.year, d.month)[1]),
     }
 
 
 class TimesheetPeriodManager(models.Manager):
     def for_date(self, date):
         return self.get_or_create(**start_end_by_date(date))[0]
 
 
 class TimesheetPeriod(StartEndMixin, models.Model):
-    start = models.DateField(_('start date'), editable=False, unique=True)
-    end = models.DateField(_('end date'), editable=False, unique=True)
+    start = models.DateField(_("start date"), editable=False, unique=True)
+    end = models.DateField(_("end date"), editable=False, unique=True)
 
     objects = TimesheetPeriodManager()
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('-start',)
-        verbose_name = _('timesheet period')
-        verbose_name_plural = _('timesheet periods')
+        app_label = "leprikon"
+        ordering = ("-start",)
+        verbose_name = _("timesheet period")
+        verbose_name_plural = _("timesheet periods")
 
     def __str__(self):
         return self.name
 
     @cached_property
     def name(self):
         # we work with monthly timesheets by default
         # TODO: allow weekly and quarterly timesheets by settings
-        return DateFormat(self.start).format('F Y')
+        return DateFormat(self.start).format("F Y")
 
     @cached_property
     def all_timesheets(self):
         return list(self.timesheets.all())
 
 
 class TimesheetManager(models.Manager):
-
     def for_leader_and_date(self, leader, date):
         return self.get_or_create(
             leader=leader,
             period=TimesheetPeriod.objects.for_date(date),
         )[0]
 
 
 class Timesheet(models.Model):
-    period = models.ForeignKey(TimesheetPeriod, verbose_name=_('period'), editable=False,
-                               related_name='timesheets', on_delete=models.PROTECT)
-    leader = models.ForeignKey(Leader, verbose_name=_('leader'), editable=False,
-                               related_name='timesheets', on_delete=models.PROTECT)
-    submitted = models.BooleanField(_('submitted'), default=False)
-    paid = models.BooleanField(_('paid'), default=False)
+    period = models.ForeignKey(
+        TimesheetPeriod, verbose_name=_("period"), editable=False, related_name="timesheets", on_delete=models.PROTECT
+    )
+    leader = models.ForeignKey(
+        Leader, verbose_name=_("leader"), editable=False, related_name="timesheets", on_delete=models.PROTECT
+    )
+    submitted = models.BooleanField(_("submitted"), default=False)
+    paid = models.BooleanField(_("paid"), default=False)
 
     objects = TimesheetManager()
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('-period__start',)
-        unique_together = (('period', 'leader'),)
-        verbose_name = _('timesheet')
-        verbose_name_plural = _('timesheets')
+        app_label = "leprikon"
+        ordering = ("-period__start", "leader")
+        unique_together = (("period", "leader"),)
+        verbose_name = _("timesheet")
+        verbose_name_plural = _("timesheets")
 
     def __str__(self):
-        return '{leader}, {period}'.format(
+        return "{leader}, {period}".format(
             leader=self.leader,
             period=self.period.name,
         )
 
     @cached_property
     def all_journal_entries(self):
         return list(self.journal_entries.all())
@@ -96,15 +98,15 @@
     @cached_property
     def all_entries(self):
         return sorted(
             self.all_timesheet_entries + self.all_journal_entries,
             key=lambda e: e.datetime_start,
         )
 
-    class EntryGroup(namedtuple('_EntryGroup', ('name', 'entries'))):
+    class EntryGroup(namedtuple("_EntryGroup", ("name", "entries"))):
         @property
         def duration(self):
             return sum((e.duration for e in self.entries), timedelta())
 
     @cached_property
     def groups(self):
         gs = {}
@@ -115,61 +117,67 @@
                     entries=[],
                 )
             gs[entry.group].entries.append(entry)
         return list(gs.values())
 
 
 class TimesheetEntryType(models.Model):
-    name = models.CharField(_('name'), max_length=150)
-    order = models.IntegerField(_('order'), blank=True, default=0)
+    name = models.CharField(_("name"), max_length=150)
+    order = models.IntegerField(_("order"), blank=True, default=0)
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('order',)
-        verbose_name = _('timesheet entry type')
-        verbose_name_plural = _('timesheet entry types')
+        app_label = "leprikon"
+        ordering = ("order",)
+        verbose_name = _("timesheet entry type")
+        verbose_name_plural = _("timesheet entry types")
 
     def __str__(self):
         return self.name
 
 
 class TimesheetEntry(StartEndMixin, models.Model):
-    timesheet = models.ForeignKey(Timesheet, verbose_name=_('timesheet'), editable=False,
-                                  related_name='timesheet_entries', on_delete=models.PROTECT)
-    entry_type = models.ForeignKey(TimesheetEntryType, verbose_name=_('entry type'), null=True,
-                                   related_name='entries', on_delete=models.PROTECT)
-    date = models.DateField(_('date'))
-    start = models.TimeField(_('start time'))
-    end = models.TimeField(_('end time'))
-    description = HTMLField(_('work description'))
+    timesheet = models.ForeignKey(
+        Timesheet,
+        verbose_name=_("timesheet"),
+        editable=False,
+        related_name="timesheet_entries",
+        on_delete=models.PROTECT,
+    )
+    entry_type = models.ForeignKey(
+        TimesheetEntryType, verbose_name=_("entry type"), null=True, related_name="entries", on_delete=models.PROTECT
+    )
+    date = models.DateField(_("date"))
+    start = models.TimeField(_("start time"))
+    end = models.TimeField(_("end time"))
+    description = HTMLField(_("work description"))
 
     class Meta:
-        app_label = 'leprikon'
-        ordering = ('start',)
-        verbose_name = _('timesheet entry')
-        verbose_name_plural = _('timesheet entries')
+        app_label = "leprikon"
+        ordering = ("start",)
+        verbose_name = _("timesheet entry")
+        verbose_name_plural = _("timesheet entries")
 
     def __str__(self):
-        return '{}'.format(self.duration)
+        return "{}".format(self.duration)
 
     @cached_property
     def datetime_start(self):
         return datetime.combine(self.date, self.start)
 
     @cached_property
     def datetime_end(self):
         return datetime.combine(self.date, self.end)
 
+    @attributes(short_description=_("duration"))
     @cached_property
     def duration(self):
         return self.datetime_end - self.datetime_start
-    duration.short_description = _('duration')
 
     @property
     def group(self):
         return self.entry_type
 
     def get_edit_url(self):
-        return reverse('leprikon:timesheetentry_update', args=(self.id,))
+        return reverse("leprikon:timesheetentry_update", args=(self.id,))
 
     def get_delete_url(self):
-        return reverse('leprikon:timesheetentry_delete', args=(self.id,))
+        return reverse("leprikon:timesheetentry_delete", args=(self.id,))
```

### Comparing `leprikon-3.0.0/leprikon/search_indexes/base.py` & `leprikon-3.5.0/leprikon/search_indexes/base.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,17 +1,17 @@
 from django.conf import settings
 from django.utils.translation import override
 from haystack import indexes
 
 
 class BaseIndex(indexes.SearchIndex, indexes.Indexable):
-    text = indexes.CharField(document=True, use_template=True, template_name='leprikon/search.txt')
-    title = indexes.CharField(stored=True, indexed=False, model_attr='name')
+    text = indexes.CharField(document=True, use_template=True, template_name="leprikon/search.txt")
+    title = indexes.CharField(stored=True, indexed=False, model_attr="name")
     url = indexes.CharField(stored=True, indexed=False)
-    school_year = indexes.IntegerField(stored=True, indexed=True, model_attr='school_year_id')
+    school_year = indexes.IntegerField(stored=True, indexed=True, model_attr="school_year_id")
 
     def prepare(self, obj):
         with override(settings.LANGUAGE_CODE):
             return super().prepare(obj)
 
     def prepare_url(self, obj):
         return obj.get_absolute_url()
```

### Comparing `leprikon-3.0.0/leprikon/site/settings.py` & `leprikon-3.5.0/leprikon/site/settings.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,440 +1,511 @@
 """
 Django settings for leprikon.site project.
 
-Generated by 'django-admin startproject' using Django 1.11.13.
+Generated by 'django-admin startproject' using Django 3.2.15.
 
 For more information on this file, see
-https://docs.djangoproject.com/en/1.11/topics/settings/
+https://docs.djangoproject.com/en/3.2/topics/settings/
 
 For the full list of settings and their values, see
-https://docs.djangoproject.com/en/1.11/ref/settings/
+https://docs.djangoproject.com/en/3.2/ref/settings/
 """
 
 import os
 import re
 
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 # Build paths inside the project like this: os.path.join(BASE_DIR, ...)
-BASE_DIR = os.environ.get('BASE_DIR', os.getcwd())
-DATA_DIR = os.environ.get('DATA_DIR', os.path.join(BASE_DIR, 'data'))
+BASE_DIR = os.environ.get("BASE_DIR", os.getcwd())
+DATA_DIR = os.environ.get("DATA_DIR", os.path.join(BASE_DIR, "data"))
 
 # Quick-start development settings - unsuitable for production
-# See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/
+# See https://docs.djangoproject.com/en/3.2/howto/deployment/checklist/
 
 # SECURITY WARNING: keep the secret key used in production secret!
-SECRET_KEY = os.environ.get('SECRET_KEY', os.environ.get('DEBUG'))
+SECRET_KEY = os.environ.get("SECRET_KEY", os.environ.get("DEBUG"))
 if not SECRET_KEY:
     from string import ascii_letters, digits, punctuation
 
     from django.utils.crypto import get_random_string
+
     SECRET_KEY = get_random_string(
         64,
         ascii_letters + digits + punctuation,
     )
 
 # SECURITY WARNING: don't run with debug turned on in production!
-DEBUG = os.environ.get('DEBUG', '') and True or False
-DBDEBUG = 'DB' in os.environ.get('DEBUG', '').split(',')
-DEBUG_TEMPLATE = 'TEMPLATE' in os.environ.get('DEBUG', '').split(',')
-DEBUG_LML = 'LML' in os.environ.get('DEBUG', '').split(',')
+DEBUG = os.environ.get("DEBUG", "") and True or False
+DBDEBUG = "DB" in os.environ.get("DEBUG", "").split(",")
+DEBUG_TEMPLATE = "TEMPLATE" in os.environ.get("DEBUG", "").split(",")
+DEBUG_LML = "LML" in os.environ.get("DEBUG", "").split(",")
 
-ALLOWED_HOSTS = [h.strip() for h in os.environ.get('ALLOWED_HOSTS', '*').split(',')]
+ALLOWED_HOSTS = [h.strip() for h in os.environ.get("ALLOWED_HOSTS", "*").split(",")]
 
 
 # Application definition
 
 INSTALLED_APPS = [
-    'user_unique_email',
-    'leprikon.site',
-    'leprikon',
-    'bankreader',
-    'djangocms_admin_style',
-    'django.contrib.admin',
-    'django.contrib.auth',
-    'django.contrib.contenttypes',
-    'django.contrib.sessions',
-    'django.contrib.messages',
-    'django.contrib.staticfiles',
-    'django.contrib.sites',
-    'django.contrib.sitemaps',
-    'django_cron',
-    'django_pays',
-    'cms',
-    'haystack',
-    'mathfilters',
-    'menus',
-    'multiselectfield',
-    'sekizai',
-    'template_admin',
-    'treebeard',
-    'filer',
-    'easy_thumbnails',
-    'cmsplugin_filer_file',
-    'cmsplugin_filer_folder',
-    'cmsplugin_filer_image',
-    'cmsplugin_filer_link',
-    'cmsplugin_filer_teaser',
-    'cmsplugin_filer_utils',
-    'cmsplugin_filer_video',
-    'djangocms_link',
-    'djangocms_text_ckeditor',
-    'ganalytics',
-    'html2rml',
-    'qr_code',
-    'rocketchat_API',
-    'social_django',
-    'verified_email_field',
+    "user_unique_email",
+    "leprikon.site",
+    "leprikon",
+    "adminsortable2",
+    "bankreader",
+    "djangocms_admin_style",
+    "django.contrib.admin",
+    "django.contrib.auth",
+    "django.contrib.contenttypes",
+    "django.contrib.sessions",
+    "django.contrib.messages",
+    "django.contrib.staticfiles",
+    "django.contrib.sites",
+    "django.contrib.sitemaps",
+    "django_cron",
+    "django_pays",
+    "djangocms_audio",
+    "djangocms_file",
+    "djangocms_picture",
+    "djangocms_video",
+    "cms",
+    "haystack",
+    "mathfilters",
+    "menus",
+    "multiselectfield",
+    "sekizai",
+    "template_admin",
+    "treebeard",
+    "filer",
+    "easy_thumbnails",
+    "djangocms_link",
+    "djangocms_text_ckeditor",
+    "ganalytics",
+    "html2rml",
+    "qr_code",
+    "social_django",
+    "verified_email_field",
+    "drf_spectacular",
+    "drf_spectacular_sidecar",
+    "rest_framework",
 ]
 
+CMSPLUGIN_FILER_MIGRATED = os.environ.get("CMSPLUGIN_FILER_MIGRATED", "no").lower() in ("yes", "true")
+if not CMSPLUGIN_FILER_MIGRATED:
+    print(
+        """
+        Please migrate all content using plugins from cmsplugin_filer
+        to corresponding djangocms_* plugins.
+        When done, run commands:
+
+        for app in cmsplugin_filer_{folder,file,image,link,teaser,video}; do
+            leprikon migrate $app zero
+        done
+
+        and set CMSPLUGIN_FILER_MIGRATED environment variable to "yes".
+        """
+    )
+    INSTALLED_APPS += [
+        "cmsplugin_filer_file",
+        "cmsplugin_filer_folder",
+        "cmsplugin_filer_image",
+        "cmsplugin_filer_link",
+        "cmsplugin_filer_teaser",
+        "cmsplugin_filer_utils",
+        "cmsplugin_filer_video",
+    ]
+
 MIDDLEWARE = [
-    'cms.middleware.utils.ApphookReloadMiddleware',
-    'django.middleware.security.SecurityMiddleware',
-    'django.contrib.sessions.middleware.SessionMiddleware',
-    'django.middleware.common.CommonMiddleware',
-    'django.middleware.csrf.CsrfViewMiddleware',
-    'django.contrib.auth.middleware.AuthenticationMiddleware',
-    'django.contrib.auth.middleware.SessionAuthenticationMiddleware',
-    'django.contrib.messages.middleware.MessageMiddleware',
-    'django.middleware.clickjacking.XFrameOptionsMiddleware',
-    'django.middleware.locale.LocaleMiddleware',
-    'cms.middleware.user.CurrentUserMiddleware',
-    'cms.middleware.page.CurrentPageMiddleware',
-    'cms.middleware.toolbar.ToolbarMiddleware',
-    'cms.middleware.language.LanguageCookieMiddleware',
-    'social_django.middleware.SocialAuthExceptionMiddleware',
-    'leprikon.middleware.LeprikonMiddleware',
+    "cms.middleware.utils.ApphookReloadMiddleware",
+    "django.middleware.security.SecurityMiddleware",
+    "django.contrib.sessions.middleware.SessionMiddleware",
+    "django.middleware.common.CommonMiddleware",
+    "django.middleware.csrf.CsrfViewMiddleware",
+    "django.contrib.auth.middleware.AuthenticationMiddleware",
+    "django.contrib.messages.middleware.MessageMiddleware",
+    "django.middleware.clickjacking.XFrameOptionsMiddleware",
+    "django.middleware.locale.LocaleMiddleware",
+    "cms.middleware.user.CurrentUserMiddleware",
+    "cms.middleware.page.CurrentPageMiddleware",
+    "cms.middleware.toolbar.ToolbarMiddleware",
+    "cms.middleware.language.LanguageCookieMiddleware",
+    "social_django.middleware.SocialAuthExceptionMiddleware",
+    "leprikon.middleware.LeprikonMiddleware",
 ]
 
 CRON_CLASSES = [
-    'leprikon.cronjobs.SendPaymentRequest',
+    "leprikon.cronjobs.SendPaymentRequest",
 ]
 
-CRON_SEND_PAYMENT_REQUEST_TIME = os.environ.get('CRON_SEND_PAYMENT_REQUEST_TIME', '8:00')
+CRON_SEND_PAYMENT_REQUEST_TIME = os.environ.get("CRON_SEND_PAYMENT_REQUEST_TIME", "8:00")
 
-ROOT_URLCONF = os.environ.get('ROOT_URLCONF', 'leprikon.site.urls')
+ROOT_URLCONF = os.environ.get("ROOT_URLCONF", "leprikon.site.urls")
+
+BASE_TEMPLATE_LOADERS = [
+    "django.template.loaders.filesystem.Loader",
+    "django.template.loaders.app_directories.Loader",
+]
+TEMPLATE_LOADERS = [
+    (
+        "template_admin.loader.Loader",
+        BASE_TEMPLATE_LOADERS
+        if DEBUG_TEMPLATE
+        else [
+            ("django.template.loaders.cached.Loader", BASE_TEMPLATE_LOADERS),
+        ],
+    ),
+]
 
 TEMPLATES = [
     {
-        'BACKEND': 'django.template.backends.django.DjangoTemplates',
-        'DIRS': [os.path.join(BASE_DIR, 'templates')],
-        'OPTIONS': {
-            'context_processors': [
-                'django.template.context_processors.debug',
-                'django.template.context_processors.request',
-                'django.contrib.auth.context_processors.auth',
-                'django.contrib.messages.context_processors.messages',
-                'django.template.context_processors.i18n',
-                'django.template.context_processors.media',
-                'django.template.context_processors.csrf',
-                'django.template.context_processors.tz',
-                'django.template.context_processors.static',
-                'sekizai.context_processors.sekizai',
-                'cms.context_processors.cms_settings',
-                'social_django.context_processors.backends',
-                'social_django.context_processors.login_redirect',
+        "BACKEND": "django.template.backends.django.DjangoTemplates",
+        "DIRS": [os.path.join(BASE_DIR, "templates")],
+        "OPTIONS": {
+            "context_processors": [
+                "django.template.context_processors.debug",
+                "django.template.context_processors.request",
+                "django.contrib.auth.context_processors.auth",
+                "django.contrib.messages.context_processors.messages",
+                "django.template.context_processors.i18n",
+                "django.template.context_processors.media",
+                "django.template.context_processors.csrf",
+                "django.template.context_processors.tz",
+                "django.template.context_processors.static",
+                "sekizai.context_processors.sekizai",
+                "cms.context_processors.cms_settings",
+                "social_django.context_processors.backends",
+                "social_django.context_processors.login_redirect",
             ],
-            'debug': DEBUG_TEMPLATE,
-            'loaders': [
-                ('template_admin.loader.Loader', [
-                    'django.template.loaders.filesystem.Loader',
-                    'django.template.loaders.app_directories.Loader',
-                ]),
-            ] if DEBUG_TEMPLATE else [
-                ('template_admin.loader.Loader', [
-                    ('django.template.loaders.cached.Loader', [
-                        'django.template.loaders.filesystem.Loader',
-                        'django.template.loaders.app_directories.Loader',
-                    ]),
-                ]),
-            ]
+            "debug": DEBUG_TEMPLATE,
+            "loaders": TEMPLATE_LOADERS,
         },
     },
 ]
 
-WSGI_APPLICATION = os.environ.get('UWSGI_MODULE', 'leprikon.site.wsgi:application').replace(':', '.')
+WSGI_APPLICATION = os.environ.get("UWSGI_MODULE", "leprikon.site.wsgi:application").replace(":", ".")
 
 # Social configuration
-SOCIAL_AUTH_FACEBOOK_SCOPE = ['email']
-SOCIAL_AUTH_FACEBOOK_PROFILE_EXTRA_PARAMS = {'fields': 'id,name,email'}
-SOCIAL_AUTH_FACEBOOK_KEY = os.environ.get('SOCIAL_AUTH_FACEBOOK_KEY')
-SOCIAL_AUTH_FACEBOOK_SECRET = os.environ.get('SOCIAL_AUTH_FACEBOOK_SECRET')
-
-SOCIAL_AUTH_GOOGLE_OAUTH2_SCOPE = ['profile', 'email']
-SOCIAL_AUTH_GOOGLE_OAUTH2_KEY = os.environ.get('SOCIAL_AUTH_GOOGLE_OAUTH2_KEY')
-SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET = os.environ.get('SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET')
-
-SOCIAL_AUTH_GOOGLE_PLUS_SCOPE = ['profile', 'email']
-SOCIAL_AUTH_GOOGLE_PLUS_KEY = os.environ.get('SOCIAL_AUTH_GOOGLE_PLUS_KEY')
-SOCIAL_AUTH_GOOGLE_PLUS_SECRET = os.environ.get('SOCIAL_AUTH_GOOGLE_PLUS_SECRET')
+SOCIAL_AUTH_FACEBOOK_SCOPE = ["email"]
+SOCIAL_AUTH_FACEBOOK_PROFILE_EXTRA_PARAMS = {"fields": "id,name,email"}
+SOCIAL_AUTH_FACEBOOK_KEY = os.environ.get("SOCIAL_AUTH_FACEBOOK_KEY")
+SOCIAL_AUTH_FACEBOOK_SECRET = os.environ.get("SOCIAL_AUTH_FACEBOOK_SECRET")
+
+SOCIAL_AUTH_GOOGLE_OAUTH2_SCOPE = ["profile", "email"]
+SOCIAL_AUTH_GOOGLE_OAUTH2_KEY = os.environ.get("SOCIAL_AUTH_GOOGLE_OAUTH2_KEY")
+SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET = os.environ.get("SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET")
+
+SOCIAL_AUTH_GOOGLE_PLUS_SCOPE = ["profile", "email"]
+SOCIAL_AUTH_GOOGLE_PLUS_KEY = os.environ.get("SOCIAL_AUTH_GOOGLE_PLUS_KEY")
+SOCIAL_AUTH_GOOGLE_PLUS_SECRET = os.environ.get("SOCIAL_AUTH_GOOGLE_PLUS_SECRET")
 
 SOCIAL_AUTH_PIPELINE = (
-    'social_core.pipeline.social_auth.social_details',
-    'social_core.pipeline.social_auth.social_uid',
-    'social_core.pipeline.social_auth.social_user',
-    'social_core.pipeline.user.get_username',
-    'social_core.pipeline.social_auth.associate_by_email',
-    'social_core.pipeline.user.create_user',
-    'social_core.pipeline.social_auth.associate_user',
-    'social_core.pipeline.social_auth.load_extra_data',
-    'social_core.pipeline.user.user_details',
+    "social_core.pipeline.social_auth.social_details",
+    "social_core.pipeline.social_auth.social_uid",
+    "social_core.pipeline.social_auth.social_user",
+    "social_core.pipeline.user.get_username",
+    "social_core.pipeline.social_auth.associate_by_email",
+    "social_core.pipeline.user.create_user",
+    "social_core.pipeline.social_auth.associate_user",
+    "social_core.pipeline.social_auth.load_extra_data",
+    "social_core.pipeline.user.user_details",
 )
 
 # Authentication configuration
 AUTHENTICATION_BACKENDS = (
-    ['social_core.backends.facebook.FacebookOAuth2'] if SOCIAL_AUTH_FACEBOOK_KEY else []
-) + (
-    ['social_core.backends.google.GoogleOAuth2'] if SOCIAL_AUTH_GOOGLE_OAUTH2_KEY else []
-) + (
-    ['social_core.backends.google.GooglePlusAuth'] if SOCIAL_AUTH_GOOGLE_PLUS_KEY else []
-) + [
-    'verified_email_field.auth.VerifiedEmailBackend',
-    'django.contrib.auth.backends.ModelBackend',
-]
+    (["social_core.backends.facebook.FacebookOAuth2"] if SOCIAL_AUTH_FACEBOOK_KEY else [])
+    + (["social_core.backends.google.GoogleOAuth2"] if SOCIAL_AUTH_GOOGLE_OAUTH2_KEY else [])
+    + (["social_core.backends.google.GooglePlusAuth"] if SOCIAL_AUTH_GOOGLE_PLUS_KEY else [])
+    + [
+        "verified_email_field.auth.VerifiedEmailBackend",
+        "django.contrib.auth.backends.ModelBackend",
+    ]
+)
 
 # Database
-# https://docs.djangoproject.com/en/1.11/ref/settings/#databases
+# https://docs.djangoproject.com/en/3.2/ref/settings/#databases
 
 DATABASES = {
-    'default': {
-        'ENGINE': os.environ.get('DATABASE_ENGINE', 'django.db.backends.sqlite3'),
-        'NAME': os.environ.get('DATABASE_NAME', os.path.join(DATA_DIR, 'db.sqlite3')),
-        'HOST': os.environ.get('DATABASE_HOST', None),
-        'PORT': os.environ.get('DATABASE_PORT', None),
-        'USER': os.environ.get('DATABASE_USER', None),
-        'PASSWORD': os.environ.get('DATABASE_PASSWORD', None),
+    "default": {
+        "ENGINE": os.environ.get("DATABASE_ENGINE", "django.db.backends.sqlite3"),
+        "NAME": os.environ.get("DATABASE_NAME", os.path.join(DATA_DIR, "db.sqlite3")),
+        "HOST": os.environ.get("DATABASE_HOST", None),
+        "PORT": os.environ.get("DATABASE_PORT", None),
+        "USER": os.environ.get("DATABASE_USER", None),
+        "PASSWORD": os.environ.get("DATABASE_PASSWORD", None),
     }
 }
 
-if DATABASES['default']['ENGINE'].endswith('mysql'):
-    DATABASES['default']['OPTIONS'] = {
-        'init_command': (
-            'ALTER DATABASE `{name}` CHARACTER SET utf8mb4 COLLATE {collate}; '
-            'SET default_storage_engine=INNODB; SET sql_mode=STRICT_TRANS_TABLES; '
-            .format(
-                name=DATABASES['default']['NAME'],
-                collate=os.environ.get('DATABASE_COLLATE', 'utf8mb4_czech_ci'),
+if DATABASES["default"]["ENGINE"].endswith("mysql"):
+    DATABASES["default"]["OPTIONS"] = {
+        "charset": "utf8mb4",
+        "use_unicode": True,
+        "init_command": (
+            "ALTER DATABASE `{name}` CHARACTER SET utf8mb4 COLLATE {collate}; "
+            "SET default_storage_engine=INNODB; SET sql_mode=STRICT_TRANS_TABLES; ".format(
+                name=DATABASES["default"]["NAME"],
+                collate=os.environ.get("DATABASE_COLLATE", "utf8mb4_czech_ci"),
             )
-        )
+        ),
     }
 
 # Leprikon URL
-LEPRIKON_DOMAIN = os.environ.get('LEPRIKON_DOMAIN')
-LEPRIKON_URL = os.environ.get('LEPRIKON_URL', LEPRIKON_DOMAIN and f'https://{LEPRIKON_DOMAIN}')
-
-# RocketChat API
-MONGO_URL = os.environ.get('MONGO_URL', 'mongodb://localhost:27017/rocketchat')
-ROCKETCHAT_API_URL = os.environ.get('ROCKETCHAT_API_URL', 'http://localhost:3000/_chat')
-LEPRIKON_CHAT_NAME = os.environ.get('LEPRIKON_CHAT_NAME', 'Leprikón')
-LEPRIKON_CHAT_USERNAME = os.environ.get('LEPRIKON_CHAT_USERNAME', 'leprikon')
+LEPRIKON_DOMAIN = os.environ.get("LEPRIKON_DOMAIN")
+LEPRIKON_URL = os.environ.get("LEPRIKON_URL", LEPRIKON_DOMAIN and f"https://{LEPRIKON_DOMAIN}")
 
 # Password validation
-# https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators
+# https://docs.djangoproject.com/en/3.2/ref/settings/#auth-password-validators
 
-AUTH_PASSWORD_VALIDATORS = [
-    {
-        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
-    },
-    {
-        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
-    },
-    {
-        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
-    },
-    {
-        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
-    },
-] if not DEBUG else []
+AUTH_PASSWORD_VALIDATORS = (
+    [
+        {
+            "NAME": "django.contrib.auth.password_validation.UserAttributeSimilarityValidator",
+        },
+        {
+            "NAME": "django.contrib.auth.password_validation.MinimumLengthValidator",
+        },
+        {
+            "NAME": "django.contrib.auth.password_validation.CommonPasswordValidator",
+        },
+        {
+            "NAME": "django.contrib.auth.password_validation.NumericPasswordValidator",
+        },
+    ]
+    if not DEBUG
+    else []
+)
 
 # Custom User model
-AUTH_USER_MODEL = 'user_unique_email.User'
+AUTH_USER_MODEL = "user_unique_email.User"
 
 # Internationalization
-# https://docs.djangoproject.com/en/1.11/topics/i18n/
+# https://docs.djangoproject.com/en/3.2/topics/i18n/
 
-LANGUAGES = (
-    ('cs', _('Czech')),
-)
+LANGUAGES = (("cs", _("Czech")),)
 
 LANGUAGE_CODE = LANGUAGES[0][0]
 
-TIME_ZONE = 'Europe/Prague'
+TIME_ZONE = "Europe/Prague"
 
 USE_I18N = True
 
 USE_L10N = True
 
 USE_TZ = True
 
 # set max upload size to 10MB
 DATA_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024
+DATA_UPLOAD_MAX_NUMBER_FIELDS = 10000
 
 # Static files (CSS, JavaScript, Images)
-# https://docs.djangoproject.com/en/1.11/howto/static-files/
+# https://docs.djangoproject.com/en/3.2/howto/static-files/
 
-STATIC_URL = '/static/'
-MEDIA_URL = '/media/'
-MEDIA_ROOT = os.path.join(BASE_DIR, 'htdocs', 'media')
-STATIC_ROOT = os.path.join(BASE_DIR, 'htdocs', 'static')
+STATIC_URL = "/static/"
+MEDIA_URL = "/media/"
+MEDIA_ROOT = os.path.join(BASE_DIR, "htdocs", "media")
+STATIC_ROOT = os.path.join(BASE_DIR, "htdocs", "static")
 
-STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')] if os.path.exists(os.path.join(BASE_DIR, 'static')) else []
+STATICFILES_DIRS = [os.path.join(BASE_DIR, "static")] if os.path.exists(os.path.join(BASE_DIR, "static")) else []
 STATICFILES_FINDERS = [
-    'django.contrib.staticfiles.finders.FileSystemFinder',
-    'django.contrib.staticfiles.finders.AppDirectoriesFinder',
-    'staticfiles_downloader.DownloaderFinder',
+    "django.contrib.staticfiles.finders.FileSystemFinder",
+    "django.contrib.staticfiles.finders.AppDirectoriesFinder",
+    "staticfiles_downloader.DownloaderFinder",
 ]
+if not DEBUG:
+    STATICFILES_STORAGE = "leprikon.staticfiles.NotStrictManifestStaticFilesStorage"
+
+LOCALE_PATHS = [os.path.join(BASE_DIR, "locale")] if os.path.exists(os.path.join(BASE_DIR, "locale")) else []
+
+# Default primary key field type
+# https://docs.djangoproject.com/en/3.2/ref/settings/#default-auto-field
 
-LOCALE_PATHS = [os.path.join(BASE_DIR, 'locale')] if os.path.exists(os.path.join(BASE_DIR, 'locale')) else []
+DEFAULT_AUTO_FIELD = "django.db.models.AutoField"
 
 # Logging
-# https://docs.djangoproject.com/en/1.11/topics/logging/
+# https://docs.djangoproject.com/en/3.2/topics/logging/
 
 LOGGING = {
-    'version': 1,
-    'disable_existing_loggers': False,
-    'formatters': {
-        'verbose': {
-            'format': '%(levelname)s %(asctime)s %(module)s '
-                      '%(process)d %(thread)d %(message)s'
-        },
+    "version": 1,
+    "disable_existing_loggers": False,
+    "formatters": {
+        "verbose": {"format": "%(levelname)s %(asctime)s %(module)s " "%(process)d %(thread)d %(message)s"},
     },
-    'handlers': {
-        'console': {
-            'level': 'DEBUG',
-            'class': 'logging.StreamHandler',
-            'formatter': 'verbose',
-            'filters': [],
+    "handlers": {
+        "console": {
+            "level": "DEBUG",
+            "class": "logging.StreamHandler",
+            "formatter": "verbose",
+            "filters": [],
         },
     },
-    'loggers': {
-        '': {
-            'level': 'DEBUG' if DEBUG else 'WARNING',
-            'handlers': ['console'],
+    "loggers": {
+        "": {
+            "level": "DEBUG" if DEBUG else "WARNING",
+            "handlers": ["console"],
         },
-        'django.db.backends': {
-            'level': 'DEBUG' if DBDEBUG else 'ERROR',
-            'propagate': True,
+        "django.db.backends": {
+            "level": "DEBUG" if DBDEBUG else "ERROR",
+            "propagate": True,
         },
-        'parso': {
-            'level': 'INFO',
+        "parso": {
+            "level": "INFO",
         },
     },
 }
 if not DEBUG_LML:
-    LOGGING['loggers']['lml'] = {'level': 'WARNING'}
-    LOGGING['loggers']['pyexcel'] = {'level': 'WARNING'}
-    LOGGING['loggers']['pyexcel_io'] = {'level': 'WARNING'}
+    LOGGING["loggers"]["lml"] = {"level": "WARNING"}
+    LOGGING["loggers"]["pyexcel"] = {"level": "WARNING"}
+    LOGGING["loggers"]["pyexcel_io"] = {"level": "WARNING"}
 
 
 # Sentry configuration
-if not DEBUG and os.environ.get('SENTRY_DSN'):
+if not DEBUG and os.environ.get("SENTRY_DSN"):
     import sentry_sdk
     from sentry_sdk.integrations.django import DjangoIntegration
 
     from leprikon import __version__
 
     sentry_sdk.init(
-        dsn=os.environ.get('SENTRY_DSN'),
+        dsn=os.environ.get("SENTRY_DSN"),
         integrations=[DjangoIntegration()],
         send_default_pii=True,
         release=__version__,
     )
 
 
 # Caching and session configuration
 # Only configure remote cache if explicitly specified in the environment.
 # Otherwise it would be enabled during `leprikon collectstatic` during build.
-if 'CACHE_LOCATION' in os.environ:
+if "CACHE_LOCATION" in os.environ:
     CACHES = {
-        'default': {
-            'BACKEND': os.environ.get('CACHE_BACKEND', 'django_redis.cache.RedisCache'),
-            'LOCATION': os.environ.get('CACHE_LOCATION'),
+        "default": {
+            "BACKEND": os.environ.get("CACHE_BACKEND", "django_redis.cache.RedisCache"),
+            "LOCATION": os.environ.get("CACHE_LOCATION"),
         }
     }
-    if CACHES['default']['BACKEND'] == 'django_redis.cache.RedisCache':
-        CACHES['default']['OPTIONS'] = {
-            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
+    if CACHES["default"]["BACKEND"] == "django_redis.cache.RedisCache":
+        CACHES["default"]["OPTIONS"] = {
+            "CLIENT_CLASS": "django_redis.client.DefaultClient",
         }
-    if 'CACHE_KEY_PREFIX' in os.environ:
-        CACHES['default']['KEY_PREFIX'] = os.environ['CACHE_KEY_PREFIX']
+    if "CACHE_KEY_PREFIX" in os.environ:
+        CACHES["default"]["KEY_PREFIX"] = os.environ["CACHE_KEY_PREFIX"]
 
-SESSION_ENGINE = 'django.contrib.sessions.backends.cache'
-SESSION_CACHE_ALIAS = 'default'
-if 'SESSION_COOKIE_AGE' in os.environ:
-    SESSION_COOKIE_AGE = int(os.environ['SESSION_COOKIE_AGE'])
-if 'SESSION_STAFF_COOKIE_AGE' in os.environ:
-    SESSION_STAFF_COOKIE_AGE = int(os.environ['SESSION_STAFF_COOKIE_AGE'])
+SESSION_ENGINE = "django.contrib.sessions.backends.cache"
+SESSION_CACHE_ALIAS = "default"
+if "SESSION_COOKIE_AGE" in os.environ:
+    SESSION_COOKIE_AGE = int(os.environ["SESSION_COOKIE_AGE"])
+if "SESSION_STAFF_COOKIE_AGE" in os.environ:
+    SESSION_STAFF_COOKIE_AGE = int(os.environ["SESSION_STAFF_COOKIE_AGE"])
 
 # Login / logout urls
-LOGIN_URL = 'leprikon:user_login'
-LOGOUT_URL = 'leprikon:user_logout'
-LOGIN_REDIRECT_URL = 'leprikon:summary'
+LOGIN_URL = "leprikon:user_login"
+LOGOUT_URL = "leprikon:user_logout"
+LOGIN_REDIRECT_URL = "leprikon:summary"
 LOGIN_ERROR_URL = LOGIN_URL
 
 # Email configuration
-SERVER_EMAIL = os.environ.get('SERVER_EMAIL', 'leprikon@localhost')
-SERVER_EMAIL_PLAIN = re.search('[^<]+@[^>]+', SERVER_EMAIL).group()
+SERVER_EMAIL = os.environ.get("SERVER_EMAIL", "leprikon@localhost")
+SERVER_EMAIL_PLAIN = re.search("[^<]+@[^>]+", SERVER_EMAIL).group()
 
 EMAIL_BACKEND = (
-    'django.core.mail.backends.console.EmailBackend'
-    if 'EMAIL' in os.environ.get('DEBUG', '').split(',')
-    else 'django.core.mail.backends.smtp.EmailBackend'
+    "django.core.mail.backends.console.EmailBackend"
+    if "EMAIL" in os.environ.get("DEBUG", "").split(",")
+    else "django.core.mail.backends.smtp.EmailBackend"
 )
-EMAIL_HOST = os.environ.get('EMAIL_HOST', 'localhost')
-EMAIL_PORT = int(os.environ.get('EMAIL_PORT', '25'))
-EMAIL_HOST_USER = os.environ.get('EMAIL_HOST_USER', '')
-EMAIL_HOST_PASSWORD = os.environ.get('EMAIL_HOST_PASSWORD', '')
-EMAIL_SUBJECT_PREFIX = os.environ.get('EMAIL_SUBJECT_PREFIX', '[Leprikón] ').strip() + ' '
-EMAIL_USE_SSL = os.environ.get('EMAIL_USE_SSL', '').lower() in ('y', 'yes', 't', 'true', '1', 'on')
+EMAIL_HOST = os.environ.get("EMAIL_HOST", "localhost")
+EMAIL_PORT = int(os.environ.get("EMAIL_PORT", "25"))
+EMAIL_HOST_USER = os.environ.get("EMAIL_HOST_USER", "")
+EMAIL_HOST_PASSWORD = os.environ.get("EMAIL_HOST_PASSWORD", "")
+EMAIL_SUBJECT_PREFIX = os.environ.get("EMAIL_SUBJECT_PREFIX", "[Leprikón] ").strip() + " "
+EMAIL_USE_SSL = os.environ.get("EMAIL_USE_SSL", "").lower() in ("y", "yes", "t", "true", "1", "on")
+DEFAULT_FROM_EMAIL = SERVER_EMAIL
 
 # CMS configuration
 # http://djangocms.readthedocs.io/en/latest/reference/configuration/
 SITE_ID = 1
 
 CMS_LANGUAGES = {
-    SITE_ID: [{'code': lang[0], 'name': lang[1]} for lang in LANGUAGES],
-    'default': {
-        'public': True,
-        'fallbacks': [LANGUAGE_CODE],
-        'hide_untranslated': True,
-        'redirect_on_fallback': True,
+    SITE_ID: [{"code": lang[0], "name": lang[1]} for lang in LANGUAGES],
+    "default": {
+        "public": True,
+        "fallbacks": [LANGUAGE_CODE],
+        "hide_untranslated": True,
+        "redirect_on_fallback": True,
     },
 }
 
 CMS_TEMPLATES = [
-    ('leprikon/cms.html', 'Leprikon'),
+    ("leprikon/cms.html", "Leprikon"),
 ]
 
 CMS_PERMISSION = True
 
 CMS_PLACEHOLDER_CONF = {}
 
-THUMBNAIL_DEBUG = 'THUMBNAIL' in os.environ.get('DEBUG', '').split(',')
+THUMBNAIL_DEBUG = "THUMBNAIL" in os.environ.get("DEBUG", "").split(",")
 
 THUMBNAIL_PROCESSORS = (
-    'easy_thumbnails.processors.colorspace',
-    'easy_thumbnails.processors.autocrop',
-    'filer.thumbnail_processors.scale_and_crop_with_subject_location',
-    'easy_thumbnails.processors.filters',
+    "easy_thumbnails.processors.colorspace",
+    "easy_thumbnails.processors.autocrop",
+    "filer.thumbnail_processors.scale_and_crop_with_subject_location",
+    "easy_thumbnails.processors.filters",
 )
 
 # Haystack configuration
 HAYSTACK_CONNECTIONS = {
-    'default': {'ENGINE': 'haystack.backends.whoosh_backend.WhooshEngine'},
+    "default": {"ENGINE": "haystack.backends.whoosh_backend.WhooshEngine"},
 }
 for key, value in os.environ.items():
-    if key.startswith('HAYSTACK_'):
-        HAYSTACK_CONNECTIONS['default'][key[len('HAYSTACK_'):]] = value
-if HAYSTACK_CONNECTIONS['default']['ENGINE'] == 'haystack.backends.whoosh_backend.WhooshEngine':
-    HAYSTACK_CONNECTIONS['default'].setdefault('PATH', os.path.join(DATA_DIR, 'whoosh_index'))
+    if key.startswith("HAYSTACK_"):
+        HAYSTACK_CONNECTIONS["default"][key[len("HAYSTACK_") :]] = value
+if HAYSTACK_CONNECTIONS["default"]["ENGINE"] == "haystack.backends.whoosh_backend.WhooshEngine":
+    HAYSTACK_CONNECTIONS["default"].setdefault("PATH", os.path.join(DATA_DIR, "whoosh_index"))
 
 # Google Analytics configuration
-GANALYTICS_TRACKING_CODE = os.environ.get('GANALYTICS_TRACKING_CODE')
+GANALYTICS_TRACKING_CODE = os.environ.get("GANALYTICS_TRACKING_CODE")
 
 # Leprikon configuration
 PRICE_DECIMAL_PLACES = 0
-COUNTRIES_FIRST = ['CZ', 'SK']
-if 'LEPRIKON_VARIABLE_SYMBOL_EXPRESSION' in os.environ:
-    LEPRIKON_VARIABLE_SYMBOL_EXPRESSION = os.environ.get('LEPRIKON_VARIABLE_SYMBOL_EXPRESSION')
+COUNTRIES_FIRST = ["CZ", "SK"]
+if "LEPRIKON_VARIABLE_SYMBOL_EXPRESSION" in os.environ:
+    LEPRIKON_VARIABLE_SYMBOL_EXPRESSION = os.environ.get("LEPRIKON_VARIABLE_SYMBOL_EXPRESSION")
+
+LEPRIKON_SHOW_SUBJECT_CODE = os.environ.get("LEPRIKON_SHOW_SUBJECT_CODE", "").lower() in ("1", "y", "yes", "t", "true")
+
+X_FRAME_OPTIONS = "SAMEORIGIN"
+
+
+#
+# Rest Framework
+#
+REST_FRAMEWORK = {
+    "DEFAULT_PARSER_CLASSES": [
+        "djangorestframework_camel_case.parser.CamelCaseJSONParser",
+    ],
+    "DEFAULT_RENDERER_CLASSES": [
+        "djangorestframework_camel_case.render.CamelCaseJSONRenderer",
+        "djangorestframework_camel_case.render.CamelCaseBrowsableAPIRenderer",
+    ],
+    "DEFAULT_SCHEMA_CLASS": "leprikon.api.openapi.Schema",
+}
 
-LEPRIKON_SHOW_SUBJECT_CODE = os.environ.get('LEPRIKON_SHOW_SUBJECT_CODE', '').lower() in ('1', 'y', 'yes', 't', 'true')
+SPECTACULAR_SETTINGS = {
+    # header
+    "TITLE": "Leprikon API",
+    "DESCRIPTION": "",
+    "CONTACT": None,
+    "LICENSE": None,
+    "TOS": None,
+    "VERSION": "v1",
+    "SERVERS": [
+        {"url": "http://localhost:8000/", "description": "local"},
+    ],
+    # options
+    "CAMELIZE_NAMES": True,
+    "POSTPROCESSING_HOOKS": [
+        "drf_spectacular.contrib.djangorestframework_camel_case.camelize_serializer_fields",
+        "drf_spectacular.hooks.postprocess_schema_enums",
+    ],
+    "REDOC_DIST": "SIDECAR",
+    "SCHEMA_PATH_PREFIX": "/api",
+    "SERVE_INCLUDE_SCHEMA": False,
+    "SWAGGER_UI_DIST": "SIDECAR",
+    "SWAGGER_UI_FAVICON_HREF": "SIDECAR",
+}
```

### Comparing `leprikon-3.0.0/leprikon/static/admin/js/admin/RelatedObjectLookups.js` & `leprikon-3.5.0/leprikon/static/admin/js/admin/RelatedObjectLookups.js`

 * *Files 11% similar despite different names*

#### js-beautify {}

```diff
@@ -1,178 +1,157 @@
 /*global SelectBox, interpolate*/
 // Handles related-objects functionality: lookup link for raw_id_fields
 // and Add Another links.
-
-(function($) {
-    'use strict';
-
-    // IE doesn't accept periods or dashes in the window name, but the element IDs
-    // we use to generate popup window names may contain them, therefore we map them
-    // to allowed characters in a reversible way so that we can locate the correct
-    // element when the popup window is dismissed.
-    function id_to_windowname(text) {
-        text = text.replace(/\./g, '__dot__');
-        text = text.replace(/\-/g, '__dash__');
-        return text;
-    }
-
-    function windowname_to_id(text) {
-        text = text.replace(/__dot__/g, '.');
-        text = text.replace(/__dash__/g, '-');
-        return text;
-    }
+'use strict'; {
+    const $ = django.jQuery;
 
     function showAdminPopup(triggeringLink, name_regexp, add_popup) {
-        var name = triggeringLink.id.replace(name_regexp, '');
-        name = id_to_windowname(name);
-        var href = triggeringLink.href;
+        const name = triggeringLink.id.replace(name_regexp, '');
+        const href = new URL(triggeringLink.href);
         if (add_popup) {
-            if (href.indexOf('?') === -1) {
-                href += '?_popup=1';
-            } else {
-                href += '&_popup=1';
-            }
+            href.searchParams.set('_popup', 1);
         }
-        var win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');
+        const win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');
         win.focus();
         return false;
     }
 
     function showRelatedObjectLookupPopup(triggeringLink) {
         return showAdminPopup(triggeringLink, /^lookup_/, true);
     }
 
     function dismissRelatedLookupPopup(win, chosenId) {
-        var name = windowname_to_id(win.name);
-        var elem = document.getElementById(name);
-        if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {
+        const name = win.name;
+        const elem = document.getElementById(name);
+        if (elem.classList.contains('vManyToManyRawIdAdminField') && elem.value) {
             elem.value += ',' + chosenId;
         } else {
             elem.value = chosenId;
         }
         $(elem).trigger('change');
         win.close();
     }
 
     function showRelatedObjectPopup(triggeringLink) {
         return showAdminPopup(triggeringLink, /^(change|add|delete)_/, false);
     }
 
     function updateRelatedObjectLinks(triggeringLink) {
-        var $this = $(triggeringLink);
-        var siblings = $this.nextAll('.change-related, .delete-related');
+        const $this = $(triggeringLink);
+        const siblings = $this.nextAll('.view-related, .change-related, .delete-related');
         if (!siblings.length) {
             return;
         }
-        var value = $this.val();
+        const value = $this.val();
         if (value) {
             siblings.each(function() {
-                var elm = $(this);
+                const elm = $(this);
                 elm.attr('href', elm.attr('data-href-template').replace('__fk__', value));
             });
         } else {
             siblings.removeAttr('href');
         }
     }
 
     function dismissAddRelatedObjectPopup(win, newId, newRepr) {
-        var name = windowname_to_id(win.name);
-        var elem = document.getElementById(name);
+        const name = win.name;
+        const elem = document.getElementById(name);
         if (elem) {
-            var elemName = elem.nodeName.toUpperCase();
+            const elemName = elem.nodeName.toUpperCase();
             if (elemName === 'SELECT') {
                 elem.options[elem.options.length] = new Option(newRepr, newId, true, true);
             } else if (elemName === 'INPUT') {
-                if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {
+                if (elem.classList.contains('vManyToManyRawIdAdminField') && elem.value) {
                     elem.value += ',' + newId;
                 } else {
                     elem.value = newId;
                 }
             }
             // Trigger a change event to update related links if required.
             $(elem).trigger('change');
         } else {
-            var toId = name + "_to";
-            var o = new Option(newRepr, newId);
+            const toId = name + "_to";
+            const o = new Option(newRepr, newId);
             SelectBox.add_to_cache(toId, o);
             SelectBox.redisplay(toId);
         }
         win.close();
     }
 
     function dismissChangeRelatedObjectPopup(win, objId, newRepr, newId) {
-        var id = windowname_to_id(win.name).replace(/^edit_/, '');
-        var selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);
-        var selects = $(selectsSelector);
+        const id = win.name.replace(/^edit_/, '');
+        const selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);
+        const selects = $(selectsSelector);
         selects.find('option').each(function() {
             if (this.value === objId) {
                 this.textContent = newRepr;
                 this.value = newId;
             }
         });
+        selects.next().find('.select2-selection__rendered').each(function() {
+            // The element can have a clear button as a child.
+            // Use the lastChild to modify only the displayed value.
+            this.lastChild.textContent = newRepr;
+            this.title = newRepr;
+        });
         win.close();
     }
 
     function dismissDeleteRelatedObjectPopup(win, objId) {
-        var id = windowname_to_id(win.name).replace(/^delete_/, '');
-        var selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);
-        var selects = $(selectsSelector);
+        const id = win.name.replace(/^delete_/, '');
+        const selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);
+        const selects = $(selectsSelector);
         selects.find('option').each(function() {
             if (this.value === objId) {
                 $(this).remove();
             }
         }).trigger('change');
         win.close();
     }
 
-    // Global for testing purposes
-    window.id_to_windowname = id_to_windowname;
-    window.windowname_to_id = windowname_to_id;
-
     window.showRelatedObjectLookupPopup = showRelatedObjectLookupPopup;
     window.dismissRelatedLookupPopup = dismissRelatedLookupPopup;
     window.showRelatedObjectPopup = showRelatedObjectPopup;
     window.updateRelatedObjectLinks = updateRelatedObjectLinks;
     window.dismissAddRelatedObjectPopup = dismissAddRelatedObjectPopup;
     window.dismissChangeRelatedObjectPopup = dismissChangeRelatedObjectPopup;
     window.dismissDeleteRelatedObjectPopup = dismissDeleteRelatedObjectPopup;
 
     // Kept for backward compatibility
     window.showAddAnotherPopup = showRelatedObjectPopup;
     window.dismissAddAnotherPopup = dismissAddRelatedObjectPopup;
 
     $(document).ready(function() {
-        $("a[data-popup-opener]").click(function(event) {
+        $("a[data-popup-opener]").on('click', function(event) {
             event.preventDefault();
             opener.dismissRelatedLookupPopup(window, $(this).data("popup-opener"));
         });
         $('body').on('click', '.related-widget-wrapper-link', function(e) {
             e.preventDefault();
             if (this.href) {
-                var event = $.Event('django:show-related', {
+                const event = $.Event('django:show-related', {
                     href: this.href
                 });
                 $(this).trigger(event);
                 if (!event.isDefaultPrevented()) {
                     showRelatedObjectPopup(this);
                 }
             }
         });
         $('body').on('change', '.related-widget-wrapper select', function(e) {
-            var event = $.Event('django:update-related');
+            const event = $.Event('django:update-related');
             $(this).trigger(event);
             if (!event.isDefaultPrevented()) {
                 updateRelatedObjectLinks(this);
             }
         });
         $('.related-widget-wrapper select').trigger('change');
         $('body').on('click', '.related-lookup', function(e) {
             e.preventDefault();
-            var event = $.Event('django:lookup-related');
+            const event = $.Event('django:lookup-related');
             $(this).trigger(event);
             if (!event.isDefaultPrevented()) {
                 showRelatedObjectLookupPopup(this);
             }
         });
     });
-
-})(django.jQuery);
+}
```

### Comparing `leprikon-3.0.0/leprikon/static/favicon.ico` & `leprikon-3.5.0/leprikon/static/favicon.ico`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/css/colors.css` & `leprikon-3.5.0/leprikon/static/leprikon/css/colors.css`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/css/layout.css` & `leprikon-3.5.0/leprikon/static/leprikon/css/layout.css`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/css/registrations.changelist.css` & `leprikon-3.5.0/leprikon/static/leprikon/css/registrations.changelist.css`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-Bold.ttf` & `leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-Bold.ttf`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-BoldOblique.ttf` & `leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-BoldOblique.ttf`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans-Oblique.ttf` & `leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans-Oblique.ttf`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/fonts/DejaVuSans.ttf` & `leprikon-3.5.0/leprikon/static/leprikon/fonts/DejaVuSans.ttf`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/img/leprikon-kuk-l.png` & `leprikon-3.5.0/leprikon/static/leprikon/img/leprikon-kuk-l.png`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/img/logo-horizontal.png` & `leprikon-3.5.0/leprikon/static/leprikon/img/logo-horizontal.png`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/img/logo.png` & `leprikon-3.5.0/leprikon/static/leprikon/img/logo.png`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/static/leprikon/js/Popup.js` & `leprikon-3.5.0/leprikon/static/leprikon/js/Popup.js`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/base.html` & `leprikon-3.5.0/leprikon/templates/admin/base.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/change_list.html` & `leprikon-3.5.0/leprikon/templates/admin/change_list.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/change_list_results.html` & `leprikon-3.5.0/leprikon/templates/admin/change_list_results.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/inc/branding.html` & `leprikon-3.5.0/leprikon/templates/admin/inc/branding.html`

 * *Files 6% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% load admin_style_tags i18n %}
-{% load static from staticfiles %}
+{% load static %}
 <div id="header-logo">
     <img alt="Leprikón" src="{% static 'leprikon/img/logo-horizontal.png' %}" height="45"
          title="{% trans 'Version' %}: {{ request.leprikon_version }}"/>
 </div>
 <h1>{{ site_header|default:_('Django Administration') }}</h1>
 <ul id="site-name" class="toolbar-item toolbar-item-navigation">
     <li>
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-{% load admin_style_tags i18n %} {% load static from staticfiles %}
+{% load admin_style_tags i18n %} {% load static %}
 [LeprikÃ³n]
 ****** {{ site_header|default:_('Django Administration') }} ******
     * {{ site_header|default:_('Django Administration') }}
           o {% if user.is_active and user.is_staff %} {% url 'django-admindocs-
             docroot' as docsroot %} {% if docsroot %}
           o {%_trans_'Documentation'_%}
           o -----
```

### Comparing `leprikon-3.0.0/leprikon/templates/admin/leprikon/message/add_recipients.html` & `leprikon-3.5.0/leprikon/templates/admin/leprikon/message/add_recipients.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/leprikon/messagerecipient/send_mails.html` & `leprikon-3.5.0/leprikon/templates/admin/leprikon/messagerecipient/send_mails.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/admin/leprikon/subjectpayment/change_form.html` & `leprikon-3.5.0/leprikon/templates/admin/leprikon/subjectreceivedpayment/change_form.html`

 * *Files 23% similar despite different names*

```diff
@@ -4,23 +4,16 @@
 {% block content %}
 {{ block.super }}
 <script>
 
 (function($) {
     function populate(data) {
         $('#id_amount').val(data.amount);
-        $('#id_payment_type').val(data.payment_type);
+        $('#id_transaction_type').val('PAYMENT_BANK');
     }
-    $('#id_related_payment').change(function () {
-        $.getJSON(
-            '{% url 'admin:leprikon_subjectpayment_populate' %}',
-            {related_payment: this.value},
-            populate,
-        );
-    });
     $('#id_bankreader_transaction').change(function () {
         $.getJSON(
             '{% url 'admin:leprikon_subjectpayment_populate' %}',
             {bankreader_transaction: this.value},
             populate,
         );
     });
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/admin/action_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/admin/action_form.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/admin/bulk_update_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/admin/bulk_update_form.html`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,9 @@
 {% extends "admin/change_form.html" %}
-{% load i18n l10n admin_urls admin_static %}
-{# load i18n admin_urls admin_static admin_modify #}
+{% load i18n l10n admin_urls %}
 
 {% block breadcrumbs %}
 <div class="breadcrumbs">
 <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
 &rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
 &rsaquo; <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst|escape }}</a>
 &rsaquo; {{ title }}
```

#### html2text {}

```diff
@@ -1,9 +1,8 @@
-{% extends "admin/change_form.html" %} {% load i18n l10n admin_urls
-admin_static %} {# load i18n admin_urls admin_static admin_modify #} {% block
+{% extends "admin/change_form.html" %} {% load i18n l10n admin_urls %} {% block
 breadcrumbs %}
 {%_trans_'Home'_%} › {{_opts.app_config.verbose_name_}} › {
 {_opts.verbose_name_plural|capfirst|escape_}} › {{ title }}
 {% endblock %} {% block submit_buttons_top %}{% endblock %} {% block
 submit_buttons_bottom %}{% endblock %} {% block object-tools %}{% endblock %}
 {% block field_sets %} {% for obj in queryset %}  {% endfor %} {% for name,
 value in hidden_fields %}  {% endfor %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/admin/dashboard.html` & `leprikon-3.5.0/leprikon/templates/leprikon/admin/dashboard.html`

 * *Files 6% similar despite different names*

```diff
@@ -18,30 +18,41 @@
             </a>
         </td>
         <td width="25%" align="center">
             <a style="display: block;" href="{% url 'admin:leprikon_accountclosure_changelist' %}">
                 <span style="font-size: 20px; line-height: 40px; text-align: center;">{% trans 'Account closures' %}</span>
             </a>
         </td>
+        <td></td>
     </tr>
     {% for subject_type in subject_types %}
     <tr>
         <td width="25%" align="center">
             <a style="display: block;" href="{{ subject_type.get_subjects_url }}">
                 <span style="font-size: 20px; line-height: 40px; text-align: center;">{{ subject_type.plural|first_upper }}</span>
             </a>
         </td>
         <td width="25%">
             <a style="display: block;" href="{{ subject_type.get_registrations_url }}">
                 <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Registrations' %}</span>
             </a>
         </td>
         <td width="25%">
-            <a style="display: block;" href="{{ subject_type.get_payments_url }}">
-                <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Payments' %}</span>
+            <a style="display: block;" href="{{ subject_type.get_journals_url }}">
+                <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Journals' %}</span>
+            </a>
+        </td>
+        <td width="25%">
+            <a style="display: block;" href="{{ subject_type.get_received_payments_url }}">
+                <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Received payments' %}</span>
+            </a>
+        </td>
+        <td width="25%">
+            <a style="display: block;" href="{{ subject_type.get_returned_payments_url }}">
+                <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Returned payments' %}</span>
             </a>
         </td>
         <td width="25%">
             <a style="display: block;" href="{{ subject_type.get_discounts_url }}">
                 <span style="font-size: 16px; line-height: 40px; text-align: center;">{% trans 'Discounts' %}</span>
             </a>
         </td>
```

#### html2text {}

```diff
@@ -1,8 +1,9 @@
 {% load i18n leprikon_tags %}
-                                    {%_trans       {%_trans        {%_trans
-         {%_trans_'Users'_%}      'Leaders'_%}  'Timesheets'_%}    'Account
-                                                                 closures'_%}
-               {                {%_trans
-               {                'Registrations' {%_trans        {%_trans
-subject_type.plural|first_upper %}              'Payments'_%}   'Discounts'_%}
-              }}
+                                                  {%_trans   {%_trans
+         {%_trans_'Users'_%}        {%_trans    'Timesheets' 'Account
+                                  'Leaders'_%}       %}      closures'
+                                                                %}
+               {                {%_trans        {%_trans     {%_trans  {%_trans  {%_trans
+               {                'Registrations' 'Journals'   'Received 'Returned 'Discounts'
+subject_type.plural|first_upper %}              %}           payments' payments' %}
+              }}                                             %}        %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/admin/merge.html` & `leprikon-3.5.0/leprikon/templates/leprikon/admin/merge.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/admin/send_message.html` & `leprikon-3.5.0/leprikon/templates/leprikon/admin/send_message.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/alternating.html` & `leprikon-3.5.0/leprikon/templates/leprikon/alternating.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/base.html` & `leprikon-3.5.0/leprikon/templates/leprikon/base.html`

 * *Files 3% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n cms_tags menu_tags leprikon_tags rocketchat sekizai_tags staticfiles ganalytics %}
+{% load i18n cms_tags menu_tags leprikon_tags sekizai_tags static ganalytics %}
 <!DOCTYPE html>
 <html lang="cs-CZ">
 
 <head>
     <meta charset="UTF-8" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1">
@@ -21,15 +21,14 @@
         <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
         <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
     <![endif]-->
 
     <!-- Stylesheet -->
     <link rel="stylesheet" type="text/css" media="all" href="{% static 'leprikon/css/layout.css' %}"/>
     <link rel="stylesheet" type="text/css" media="all" href="{% static 'leprikon/css/colors.css' %}"/>
-    <link rel="stylesheet" type="text/css" media="all" href="{% static 'leprikon/css/chat.css' %}"/>
     {% render_block "css" %}
 
     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="{% static 'leprikon/lib/jquery.min.js' %}"></script>
 
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <script src="{% static 'leprikon/lib/bootstrap/js/bootstrap.min.js' %}"></script>
@@ -54,15 +53,14 @@
                 {% block brand %}
                     {% static_placeholder "brand" or %}<a href="/"><img src="{% static 'leprikon/img/logo-horizontal.png' %}" height="80"/></a>{% endstatic_placeholder %}
                 {% endblock %}
             </div>
             <div class="col-sm-3">
                 {% school_year_form %}
                 {% include 'leprikon/user_dropdown.html' %}
-                {% chat %}
             </div>
         </div>
     </div>
 
     <div id="body">
         <div class="container">
             <div class="row">
@@ -79,11 +77,9 @@
         </div>
 
         <a id="leprikon" href="https://leprikon.cz" target="_blank" title="{% trans 'Powered by Leprikón Information System' %}"><span>{% trans 'Powered by Leprikón Information System' %}</span></a>
     </div>
 
     {% render_block "js" %}
 
-    {% livechat %}
-
 </body>
 </html>
```

#### html2text {}

```diff
@@ -1,10 +1,8 @@
-{% load i18n cms_tags menu_tags leprikon_tags rocketchat sekizai_tags
-staticfiles ganalytics %}
-
+{% load i18n cms_tags menu_tags leprikon_tags sekizai_tags static ganalytics %}
 
 
 
 
 
 
  {% render_block "css" %}
@@ -12,13 +10,13 @@
 
  {% if backends %}
 
  {% endif %} {% block extrahead %}{% endblock %}
 {% cms_toolbar %}
 {% block brand %} {% static_placeholder "brand" or %}[{%_static_'leprikon/img/
 logo-horizontal.png'_%}]{% endstatic_placeholder %} {% endblock %}
-{% school_year_form %} {% include 'leprikon/user_dropdown.html' %} {% chat %}
+{% school_year_form %} {% include 'leprikon/user_dropdown.html' %}
 {% include 'leprikon/modal_messages.html' %} {% block content %}{% endblock %}
  {% block menu %}{% show_menu 0 100 0 100 'leprikon/menu.html'
 'CMSMenu,LeprikonMenu' %}{% endblock %}
 {%_trans_'Powered_by_LeprikÃ³n_Information_System'_%}
-{% render_block "js" %} {% livechat %}
+{% render_block "js" %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/billing_info_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/billing_info_preview.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/cms/course_list_filtered.html` & `leprikon-3.5.0/leprikon/templates/leprikon/cms/course_list_filtered.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% include 'leprikon/filter_form.html' %}
 
 {% for course in courses %}
 {% include 'leprikon/course_preview.html' %}
 {% empty %}
 <p>{{ message_empty }}</p>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/cms/event_list_filtered.html` & `leprikon-3.5.0/leprikon/templates/leprikon/cms/orderable_list_filtered.html`

 * *Files 5% similar despite different names*

```diff
@@ -1,13 +1,13 @@
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% include 'leprikon/filter_form.html' %}
 
-{% for event in events %}
-{% include 'leprikon/event_preview.html' %}
+{% for orderable in orderables %}
+{% include 'leprikon/orderable_preview.html' %}
 {% empty %}
 <p>{{ message_empty }}</p>
 {% endfor %}
 
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
 
 {% addtoblock "js" %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/cms/leader_list/default.html` & `leprikon-3.5.0/leprikon/templates/leprikon/cms/leader_list/default.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/cms/leader_list_filtered.html` & `leprikon-3.5.0/leprikon/templates/leprikon/cms/leader_list_filtered.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% include 'leprikon/filter_form.html' %}
 
 {% for object in leaders %}
 {% include 'leprikon/leader_preview.html' %}
 {% empty %}
 <p>{{ message_empty }}</p>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/cms/orderable_list_filtered.html` & `leprikon-3.5.0/leprikon/templates/leprikon/cms/event_list_filtered.html`

 * *Files 11% similar despite different names*

```diff
@@ -1,13 +1,13 @@
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% include 'leprikon/filter_form.html' %}
 
-{% for orderable in orderables %}
-{% include 'leprikon/orderable_preview.html' %}
+{% for event in events %}
+{% include 'leprikon/event_preview.html' %}
 {% empty %}
 <p>{{ message_empty }}</p>
 {% endfor %}
 
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
 
 {% addtoblock "js" %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/confirm_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/confirm_form.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/course_registrations.html` & `leprikon-3.5.0/leprikon/templates/leprikon/course_registrations.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/event_registrations.html` & `leprikon-3.5.0/leprikon/templates/leprikon/event_registrations.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/filter_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/filter_form.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/filtered_subject_list.html` & `leprikon-3.5.0/leprikon/templates/leprikon/filtered_subject_list.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 <form class="form-horizontal" method="get" id="list_filter_form">
 
     <div class="form-group">
         {% for item in form %}
         <label class="control-label col-sm-6 col-md-2" for="{{ item.id_for_label }}">
             {{ item.label }}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/form.html`

 * *Files 26% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/default.html' %}
-{% load i18n cms_tags sekizai_tags %}
+{% load i18n cms_tags leprikon_tags sekizai_tags %}
 
 {% block content %}
 
 <h1>{% block title %}{{ title }}{% endblock %}</h1>
 
 {% if placeholder %}
 {% static_placeholder placeholder %}
@@ -29,14 +29,27 @@
     </div>
     {% endfor %}
 
     {% for item in form %}
         {% if form_item_template %}{% include form_item_template %}{% else %}{% include 'leprikon/form_item.html' %}{% endif %}
     {% endfor %}
 
+    {% for inline_formset in form.inline_formsets %}
+        <h3>{{ inline_formset.model.Meta.verbose_name_plural|first_upper }}</h3>
+		{{ inline_formset.management_form }}
+		{{ inline_formset.non_form_errors }}
+        {% for form in inline_formset %}
+			<div class="inline {{ inline_formset.prefix }}">
+			{% for item in form %}
+                {% if item.is_hidden %}{{ item }}{% elif form_item_template %}{% include form_item_template %}{% else %}{% include 'leprikon/form_item.html' %}{% endif %}
+			{% endfor %}
+			</div>
+		{% endfor %}
+	{% endfor %}
+
     <!-- SUBMIT -->
     <div class="form-group">
         <div class="col-md-9 col-md-offset-3">
             <button class="btn btn-primary" type="submit">{{ submit_label }}</button>
             {% if back_url %}
             <a class="btn btn-default" href="{{ back_url }}">{{ back_label }}</a>
             {% endif %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/form_item_checkbox.html` & `leprikon-3.5.0/leprikon/templates/leprikon/form_item_checkbox.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/journalentry_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/journalentry_form.html`

 * *Files 20% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% block content %}
 {{ block.super }}
 
 {% include 'leprikon/static/bootstrap-datetimepicker.html' %}
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
 
@@ -53,17 +53,20 @@
         nonSelectedText: '',
         allSelectedText: '{% trans 'all' %}',
         numberDisplayed: 4,
         nSelectedText: '{% trans 'selected' %}',
     });
 
     $('#id_date').on('dp.change', function(e) {
-        $.getJSON('{% url 'leprikon:api:participants' form.instance.subject.id %}?date='+(e.date/1000), function(result) {
-            $('#id_participants').multiselect('dataprovider', result['participants']);
-            $('#id_participants_instructed').multiselect('dataprovider', result['participants']);
+        d = e.date.toDate();
+        date = `${d.getFullYear()}-${(d.getMonth()+101).toString().slice(1)}-${(d.getDate()+100).toString().slice(1)}`;
+        $.getJSON(`{% url 'api:journal-participants' form.instance.journal.id %}?date=${date}`, function(result) {
+            result = result.map(function (item) { return {value: item.id, label: item.label} });
+            $('#id_participants').multiselect('dataprovider', result);
+            $('#id_participants_instructed').multiselect('dataprovider', result);
         });
     });
 
 });
 
 </script>
 {% endaddtoblock %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/leader_list.html` & `leprikon-3.5.0/leprikon/templates/leprikon/leader_list.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/list.html' %}
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% block content %}
 {{ block.super }}
 
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
 
 {% addtoblock "js" %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/leader_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/leader_preview.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/leader_summary.html` & `leprikon-3.5.0/leprikon/templates/leprikon/leader_summary.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/list.html` & `leprikon-3.5.0/leprikon/templates/leprikon/list.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/login.html` & `leprikon-3.5.0/leprikon/templates/leprikon/login.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/default.html' %}
-{% load i18n cms_tags leprikon_tags sekizai_tags staticfiles %}
+{% load i18n cms_tags leprikon_tags sekizai_tags static %}
 
 {% block content %}
 
 <h1>{% block title %}{% trans 'Log in' %}{% endblock %}</h1>
 
 <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
   <div class="panel panel-default">
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/menu.html` & `leprikon-3.5.0/leprikon/templates/leprikon/menu.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/messagerecipient_detail.html` & `leprikon-3.5.0/leprikon/templates/leprikon/messagerecipient_detail.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/messages_table.html` & `leprikon-3.5.0/leprikon/templates/leprikon/messages_table.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/modal_messages.html` & `leprikon-3.5.0/leprikon/templates/leprikon/modal_messages.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/orderable_registrations.html` & `leprikon-3.5.0/leprikon/templates/leprikon/orderable_registrations.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/pagination.html` & `leprikon-3.5.0/leprikon/templates/leprikon/pagination.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/parent_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/parent_preview.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/participant_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/participant_preview.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n leprikon_tags staticfiles %}
+{% load i18n leprikon_tags static %}
 <div class="box box-participant">
     <div class="box-header">
         <strong>{{ object.full_name }}</strong>
         <small>({{ object.birth_date }})</small>
         <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:participant_update' object.id %}">
             <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
             {% trans 'edit' %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/password_reset_email.html` & `leprikon-3.5.0/leprikon/templates/leprikon/password_reset_email.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/payment_pdf/subject.rml` & `leprikon-3.5.0/leprikon/templates/leprikon/received_payment_pdf/subject.rml`

 * *Files 2% similar despite different names*

```diff
@@ -9,18 +9,18 @@
     </docinit>
 
     <template showBoundary="0">
         <!--define a 'frame' into which the content will flow.-->
         <pageTemplate id="main">
             <pageGraphics>
                 <place x="{{ print_setup.x1 }}" y="{{ print_setup.bill_y1 }}" width="{{ print_setup.width }}" height="{{ print_setup.bill_height }}">
-                    {% include 'leprikon/payment_pdf/recipe.rml' %}
+                    {% include 'leprikon/received_payment_pdf/recipe.rml' %}
                 </place>
                 <place x="{{ print_setup.x1 }}" y="{{ print_setup.y1 }}" width="{{ print_setup.width }}" height="{{ print_setup.bill_height }}">
-                    {% include 'leprikon/payment_pdf/recipe.rml' %}
+                    {% include 'leprikon/received_payment_pdf/recipe.rml' %}
                 </place>
                 <lineMode width="1" dash="5,5" colorName="silver"/>
                 <lines>1cm 148.5mm 20cm 148.5mm</lines>
             </pageGraphics>
             <frame id="first" x1="{{ print_setup.x1 }}" y1="{{ print_setup.y1 }}" width="{{ print_setup.width }}" height="{{ print_setup.height }}"/>
         </pageTemplate>
     </template>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/payments.html` & `leprikon-3.5.0/leprikon/templates/leprikon/payments.html`

 * *Files 22% similar despite different names*

```diff
@@ -8,32 +8,36 @@
 {% elif request.GET.PaymentOrderStatusID.0 == '2' %}
 <div class="alert alert-danger">{% trans 'Unfortunately, the online payment was not successful. Please, try it again or choose another payment method.' %}</div>
 {% endif %}
 
 <table class="table">
     <tr>
         <th>{% trans 'Date' %}</th>
-        <th>{% trans 'Subject' %}</th>
         <th>{% trans 'Payment Type' %}</th>
-        <th>{% trans 'Amount' %}</th>
+        <th>{% trans 'Registration' %}</th>
+        <th class="right">{% trans 'Amount' %}</th>
         <th></th>
     </tr>
 {% for payment in object_list %}
+    {% for sub_payment in payment.sub_payments %}
     <tr>
-        <td>{{ payment.accounted.date }}</td>
-        <td>{{ payment.registration }}</td>
-        <td>{{ payment.payment_type_label }}</td>
-        <td>{{ payment.amount | currency }}</td>
+        {% if forloop.first %}
+        <td rowspan="{{ payment.sub_payments|length }}">{{ payment.accounted.date }}</td>
+        <td rowspan="{{ payment.sub_payments|length }}">{{ payment.transaction_type_label }}</td>
+        {% endif %}
+        <td>{{ sub_payment.registration }}</td>
+        <td class="right">{{ sub_payment.real_amount | currency }}</td>
         <td>
-            <a class="btn btn-primary btn-xs" href="{{ payment.get_absolute_url }}">
+            <a class="btn btn-primary btn-xs" href="{{ sub_payment.get_absolute_url }}">
                 <span class="glyphicon glyphicon-download" aria-hidden="true"></span>
                 {% trans 'download' %}
             </a>
         </td>
     </tr>
+    {% endfor %}
 {% empty %}
     <tr>
         <td colspan="5">{{ message_empty }}</td>
     </tr>
 {% endfor %}
 </table>
 {% endblock %}
```

#### html2text {}

```diff
@@ -2,15 +2,15 @@
 block list %} {% if request.GET.PaymentOrderStatusID.0 == '3' %}
 {% trans 'Thank You, the online payment was successful. The confirmation will
 be available within several minutes.' %}
 {% elif request.GET.PaymentOrderStatusID.0 == '2' %}
 {% trans 'Unfortunately, the online payment was not successful. Please, try it
 again or choose another payment method.' %}
 {% endif %}
-{% trans 'Date' %}     {% trans 'Subject'   {% trans 'Payment Type' %} {% trans
-                       %}                                              'Amount' %}
-{                      {                    {                          {              _{%_trans
-{                      {                    {                          {              'download'
-payment.accounted.date payment.registration payment.payment_type_label payment.amount %}
-}}                     }}                   }}                         | currency }}
+{% trans 'Date' %}     {% trans 'Payment Type' %}     {% trans 'Registration'  {% trans 'Amount' %}
+                                                      %}
+{                      {                              {                        {                       _{%_trans
+{                      {                              {                        {                       'download'
+payment.accounted.date payment.transaction_type_label sub_payment.registration sub_payment.real_amount %}
+}}                     }}                             }}                       | currency }}
 {{ message_empty }}
 {% endblock %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_details.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_details.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_links.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_links.html`

 * *Files 15% similar despite different names*

```diff
@@ -5,15 +5,14 @@
 {% endfor %}
 
 
 <a href="{{ registration_url }}" id="subject-{{ subject.id }}-registration-link" class="btn btn-primary btn-xs{% if not registration_allowed %} hidden{% endif %}">
     {% trans 'fill in the registration form' %}
 </a>
 <span id="subject-{{ subject.id }}-registration-message">{{ registration_message }}</span>
-{% if subject.full %}{% trans 'The capacity is full.' %}{% endif %}
 
 {% if registration_start_in or registration_end_in %}
 <script defer="defer" async="async" type="text/javascript">
 {% if registration_start_in %}
 setTimeout(function(){
     $('#subject-{{ subject.id }}-registration-link').removeClass('hidden');
     $('#subject-{{ subject.id }}-registration-message').html('{{ registration_ends_message }}');
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_details.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_details.html`

 * *Files 21% similar despite different names*

```diff
@@ -23,32 +23,17 @@
 00000160: 6172 6174 6564 207d 7d3c 6272 2f3e 0a20  arated }}<br/>. 
 00000170: 2020 207b 2520 656c 6966 206f 626a 6563     {% elif objec
 00000180: 742e 7375 626a 6563 742e 7265 6769 7374  t.subject.regist
 00000190: 7261 7469 6f6e 5f74 7970 655f 6772 6f75  ration_type_grou
 000001a0: 7073 2025 7d0a 2020 2020 2020 2020 7b25  ps %}.        {%
 000001b0: 2074 7261 6e73 2027 436f 6e74 6163 7420   trans 'Contact 
 000001c0: 7065 7273 6f6e 2720 257d 3a20 7b7b 206f  person' %}: {{ o
-000001d0: 626a 6563 742e 6772 6f75 702e 6669 7273  bject.group.firs
-000001e0: 745f 6e61 6d65 207d 7d20 7b7b 206f 626a  t_name }} {{ obj
-000001f0: 6563 742e 6772 6f75 702e 6c61 7374 5f6e  ect.group.last_n
-00000200: 616d 6520 7d7d 0a20 2020 2020 2020 207b  ame }}.        {
-00000210: 2520 6966 206f 626a 6563 742e 6772 6f75  % if object.grou
-00000220: 702e 6e61 6d65 2025 7d3c 6272 2f3e 7b25  p.name %}<br/>{%
-00000230: 2074 7261 6e73 2027 4772 6f75 7020 6e61   trans 'Group na
-00000240: 6d65 2720 257d 3a20 7b7b 206f 626a 6563  me' %}: {{ objec
-00000250: 742e 6772 6f75 702e 6e61 6d65 207d 7d7b  t.group.name }}{
-00000260: 2520 656e 6469 6620 257d 0a20 2020 207b  % endif %}.    {
-00000270: 2520 656e 6469 6620 257d 0a3c 2f70 3e0a  % endif %}.</p>.
-00000280: 0a3c 703e 0a20 2020 207b 2520 7472 616e  .<p>.    {% tran
-00000290: 7320 2759 6f75 206d 6179 2064 6f77 6e6c  s 'You may downl
-000002a0: 6f61 6420 7468 6520 7265 6769 7374 7261  oad the registra
-000002b0: 7469 6f6e 2069 6e20 5044 4620 7573 696e  tion in PDF usin
-000002c0: 6720 7468 6520 666f 6c6c 6f77 696e 6720  g the following 
-000002d0: 6c69 6e6b 3a27 2025 7d3c 6272 2f3e 0a20  link:' %}<br/>. 
-000002e0: 2020 203c 6120 6872 6566 3d22 7b7b 2073     <a href="{{ s
-000002f0: 6974 652e 7572 6c20 7d7d 7b7b 206f 626a  ite.url }}{{ obj
-00000300: 6563 742e 6765 745f 6162 736f 6c75 7465  ect.get_absolute
-00000310: 5f75 726c 207d 7d22 3e0a 2020 2020 2020  _url }}">.      
-00000320: 2020 7b7b 2073 6974 652e 7572 6c20 7d7d    {{ site.url }}
-00000330: 7b7b 206f 626a 6563 742e 6765 745f 6162  {{ object.get_ab
-00000340: 736f 6c75 7465 5f75 726c 207d 7d0a 2020  solute_url }}.  
-00000350: 2020 3c2f 613e 0a3c 2f70 3e0a              </a>.</p>.
+000001d0: 626a 6563 742e 6772 6f75 702e 6675 6c6c  bject.group.full
+000001e0: 5f6e 616d 6520 7d7d 0a20 2020 2020 2020  _name }}.       
+000001f0: 207b 2520 6966 206f 626a 6563 742e 6772   {% if object.gr
+00000200: 6f75 702e 6e61 6d65 2025 7d3c 6272 2f3e  oup.name %}<br/>
+00000210: 7b25 2074 7261 6e73 2027 4772 6f75 7020  {% trans 'Group 
+00000220: 6e61 6d65 2720 257d 3a20 7b7b 206f 626a  name' %}: {{ obj
+00000230: 6563 742e 6772 6f75 702e 6e61 6d65 207d  ect.group.name }
+00000240: 7d7b 2520 656e 6469 6620 257d 0a20 2020  }{% endif %}.   
+00000250: 207b 2520 656e 6469 6620 257d 0a3c 2f70   {% endif %}.</p
+00000260: 3e0a                                     >.
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_mail_details.txt` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_mail_details.txt`

 * *Files 20% similar despite different names*

```diff
@@ -1,8 +1,5 @@
 {% load i18n leprikon_tags %}{{ object.subject.subject_type.name | first_upper }}: {{ object.subject.name }}
 {% if object.subject.registration_type_participants %}{% if object.all_participants|length > 1 %}{% trans 'Participants' %}{% else %}{% trans 'Participant' %}{% endif %}: {{ object.all_participants|comma_separated }}
-{% elif object.subject.registration_type_groups %}{% trans 'Contact person' %}: {{ object.group.first_name }} {{ object.group.last_name }}{% if object.group.name %}
+{% elif object.subject.registration_type_groups %}{% trans 'Contact person' %}: {{ object.group.full_name }}{% if object.group.name %}
 {% trans 'Group name' %}: {{ object.group.name }}{% endif %}
 {% endif %}
-
-{% trans 'You may download the registration in PDF using the following link:' %}
-{{ site.url }}{{ object.get_absolute_url }}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.rml` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.rml`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_payment_request/subject.txt` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_payment_request/subject.txt`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_payments.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_payments.html`

 * *Files 26% similar despite different names*

```diff
@@ -1,15 +1,14 @@
 {% load i18n leprikon_tags qr_code %}
 
 <div class="row">
     <label class="col-sm-4">{% trans 'Price' %}:</label>
     <div class="col-sm-8">
-        {{ reg.price | currency }}
-        {% if reg.subject.course.school_year_division.period_name %} / {{ reg.subject.course.school_year_division.period_name }}{% endif %}
-        {% if reg.subject_variant %}({{ reg.subject_variant.name }}){% endif %}
+        {{ reg.price_text }}
+        {% if reg.subject_variant.name %}({{ reg.subject_variant.name }}){% endif %}
     </div>
 </div>
 <div class="row">
     <label class="col-sm-4">{% trans 'Payments status' %}:</label>
     <div class="col-sm-8">
         {% if reg.payment_status.amount_due %}
         <a class="btn btn-primary btn-xs right" href="{{ reg.get_payment_request_url }}">
@@ -21,22 +20,24 @@
             <strong style="color: {{ reg.payment_status.color }}">{{ reg.payment_status.title }}</strong>
         </div>
         <div class="collapse out" id="payments-{{ reg.id }}-details">
             {% if reg.period_payment_statuses %}
                 {% for pps in reg.period_payment_statuses %}
                 {{ pps.period.name }}:
                 <strong style="color: {{ pps.status.color }}" title="{{ pps.status.title }}">
-                    {% blocktrans with paid=pps.status.paid|currency %}paid {{ paid }}{% endblocktrans %}
+                    {% blocktrans with received=pps.status.received|currency %}paid {{ received }}{% endblocktrans %}{% if pps.status.returned %},
+                    {% blocktrans with returned=pps.status.returned|currency %}refunded {{ returned }}{% endblocktrans %}{% endif %}
                 </strong>
                 {% if pps.status.discount %}({% trans 'discount' %}: {{ pps.status.discount | currency }}{% if pps.status.explanation %} - {{ pps.status.explanation }}{% endif %}){% endif %}
                 {% if not forloop.last %}<br />{% endif %}
                 {% endfor %}
             {% else %}
                 <strong style="color: {{ reg.payment_status.color }}" title="{{ reg.payment_status.title }}">
-                    {% blocktrans with paid=reg.payment_status.paid|currency %}paid {{ paid }}{% endblocktrans %}
+                    {% blocktrans with received=reg.payment_status.received|currency %}paid {{ received }}{% endblocktrans %}{% if reg.payment_status.returned %},
+                    {% blocktrans with returned=reg.payment_status.returned|currency %}refunded {{ returned }}{% endblocktrans %}{% endif %}
                 </strong>
                 {% if reg.payment_status.discount %}({% trans 'discount' %}: {{ reg.payment_status.discount | currency }}{% if reg.payment_status.explanation %} - {{ reg.payment_status.explanation }}{% endif %}){% endif %}
             {% endif %}
             {% if reg.payment_status.amount_due %}
                 {% if site.payment_gateway %}
                     <h4>{% trans 'Online payment' %}</h4>
                     <p><a class="btn btn-primary" href="{{ reg.payment_url }}">{% trans 'pay online' %}</a></p>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_pdf/subject.rml` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_pdf/subject.rml`

 * *Files 1% similar despite different names*

```diff
@@ -54,17 +54,16 @@
                 <td>{% blocktrans with subject_type=object.subject.subject_type.name_genitiv %}Name of {{ subject_type }}{% endblocktrans %}</td>
                 <td><para style="para">{{ object.subject.name }}</para></td>
             </tr>
             <tr>
                 <td>{% trans 'Price' %}</td>
                 <td>
                     <para style="para">
-                        {{ object.price | currency }}
-                        {% if object.subject.course.school_year_division.period_name %} / {{ object.subject.course.school_year_division.period_name }}{% endif %}
-                        {% if object.subject_variant %}({{ object.subject_variant.name }}){% endif %}
+                        {{ object.price_text }}
+                        {% if object.subject_variant.name %}({{ object.subject_variant.name }}){% endif %}
                     </para>
                 </td>
             </tr>
             {% if object.subject.event.start_date %}
             <tr>
                 <td>{% trans 'Event date' %}</td>
                 <td><para style="para">{{ object.subject.event.event_date }}</para></td>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registration_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registration_preview.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/registrations.html` & `leprikon-3.5.0/leprikon/templates/leprikon/registrations.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/course_payments.html` & `leprikon-3.5.0/leprikon/templates/leprikon/donations.html`

 * *Files 27% similar despite different names*

```diff
@@ -1,36 +1,33 @@
-{% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% extends 'leprikon/list.html' %}
+{% load cms_tags i18n leprikon_tags %}
 
-{% block content %}
-<div class="hidden-print">
-{{ block.super }}
-</div>
+{% block list %}
 
-{% if payments %}
-<h1>{% blocktrans with date=date %}Course payments from {{ date_start }} to {{ date_end }}{% endblocktrans %}</h1>
-
-<table class="table table-hover">
+<table class="table">
     <tr>
         <th>{% trans 'Date' %}</th>
-        <th>{% trans 'Registration' %}</th>
+        <th>{% trans 'Donation Type' %}</th>
+        <th>{% trans 'Organization' %}</th>
         <th>{% trans 'Amount' %}</th>
+        <th></th>
     </tr>
-    {% for payment in payments %}
-    <tr id="report-{{ payment.id }}">
-        <th>{{ payment.accounted }}</th>
-        <th>{{ payment.registration }}</th>
-        <th class="right">{{ payment.amount | currency }}</th>
+{% for donation in object_list %}
+    <tr>
+        <td>{{ donation.accounted.date }}</td>
+        <td>{{ donation.transaction_type_label }}</td>
+        <td>{{ donation.organization }}</td>
+        <td>{{ donation.amount | currency }}</td>
+        <td>
+            <a class="btn btn-primary btn-xs" href="{{ donation.get_absolute_url }}">
+                <span class="glyphicon glyphicon-download" aria-hidden="true"></span>
+                {% trans 'download' %}
+            </a>
+        </td>
     </tr>
-    {% endfor %}
-    <tr id="report-sum">
-        <th></th>
-        <th></th>
-        <th class="right">{{ sum | currency }}</th>
+{% empty %}
+    <tr>
+        <td colspan="5">{{ message_empty }}</td>
     </tr>
+{% endfor %}
 </table>
-{% endif %}
-
-
-{% include 'leprikon/static/bootstrap-datetimepicker.html' %}
-
 {% endblock %}
```

#### html2text {}

```diff
@@ -1,12 +1,10 @@
-{% extends 'leprikon/form.html' %} {% load i18n leprikon_tags sekizai_tags
-staticfiles %} {% block content %}
-{{ block.super }}
-{% if payments %}
-****** {% blocktrans with date=date %}Course payments from {{ date_start }} to
-{{ date_end }}{% endblocktrans %} ******
-{% trans 'Date' %}      {% trans 'Registration' %} {% trans 'Amount' %}
-{{ payment.accounted }} {{ payment.registration }} {{ payment.amount | currency
-                                                   }}
-                                                   {{ sum | currency }}
-{% endif %} {% include 'leprikon/static/bootstrap-datetimepicker.html' %} {%
-endblock %}
+{% extends 'leprikon/list.html' %} {% load cms_tags i18n leprikon_tags %} {%
+block list %}
+{% trans 'Date' %}      {% trans 'Donation Type' %}     {% trans              {% trans
+                                                        'Organization' %}     'Amount' %}
+{                       {                               {                     {               _{%_trans
+{                       {                               {                     {               'download'
+donation.accounted.date donation.transaction_type_label donation.organization donation.amount %}
+}}                      }}                              }}                    | currency }}
+{{ message_empty }}
+{% endblock %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/course_payments_status.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/event_payments_status.html`

 * *Files 5% similar despite different names*

```diff
@@ -1,68 +1,75 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
-{% if reports %}
-<h1>{% blocktrans with date=date %}Course payments status by date {{ date }}{% endblocktrans %}</h1>
+{% if form.is_valid %}
+<h1>{% blocktrans with date=date %}Event payments status by date {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Course' %}</th>
+        <th>{% trans 'Event' %}</th>
         <th>{% trans 'Price' %}</th>
         <th>{% trans 'Number of registrations' %}</th>
         <th>{% trans 'Discounts' %}</th>
         <th>{% trans 'Receivables' %}</th>
         <th>{% trans 'Received payments' %}</th>
+        <th>{% trans 'Returned payments' %}</th>
         <th>{% trans 'Amount due' %}</th>
         <th>{% trans 'Overpayments' %}</th>
     </tr>
     {% for report in reports %}
     {% if report.registration_statuses %}
-    <tr id="report-{{ report.course.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.course.id }}-collapsed">
+    <tr id="report-{{ report.event.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.event.id }}-collapsed">
     {% else %}
-    <tr id="report-{{ report.course.id }}">
+    <tr id="report-{{ report.event.id }}">
     {% endif %}
-        <th>{{ report.course.name }}</th>
-        <td class="right">{{ report.course.price | currency }}</td>
+        <th>{{ report.event.name }}</th>
+        <td class="right">{{ report.event.price_text }}</td>
         <td class="right">{{ report.registration_statuses | length }}</td>
         <td class="right">{{ report.status.discount | currency }}</td>
         <td class="right">{{ report.status.receivable | currency }}</td>
-        <td class="right">{{ report.status.paid | currency }}</td>
+        <td class="right">{{ report.status.received | currency }}</td>
+        <td class="right">{{ report.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ report.status.amount_due_color }}" title="{{ report.status.title }}">
                 {{ report.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ report.status.overpaid_color }}" title="{{ report.status.title }}">
                 {{ report.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% for rs in report.registration_statuses %}
-    <tr class="collapse out {{ report.course.id }}-collapsed">
+    <tr class="collapse out {{ report.event.id }}-collapsed">
         <th class="right" colspan="3">
-            <a href="{% url 'admin:leprikon_courseregistration_changelist' %}?id={{ rs.registration.id }}">
+            <a href="{% url 'admin:leprikon_eventregistration_changelist' %}?id={{ rs.registration.id }}">
                 {{ rs.registration }}
             </a>
         </th>
         <td class="right">
-            <a href="{% url 'admin:leprikon_coursediscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+            <a href="{% url 'admin:leprikon_eventdiscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
                 {{ rs.status.discount | currency }}
             </a>
         </td>
         <td class="right">{{ rs.status.receivable | currency }}</td>
         <td class="right">
-            <a href="{% url 'admin:leprikon_subjectpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
-                {{ rs.status.paid | currency }}
+            <a href="{% url 'admin:leprikon_subjectreceivedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.received | currency }}
+            </a>
+        </td>
+        <td class="right">
+            <a href="{% url 'admin:leprikon_subjectreturnedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.returned | currency }}
             </a>
         </td>
         <td class="right">
             <strong style="color: {{ rs.status.amount_due_color }}" title="{{ rs.status.title }}">
                 {{ rs.status.amount_due | currency }}
             </strong>
         </td>
@@ -71,20 +78,21 @@
                 {{ rs.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% endfor %}
     {% endfor %}
     <tr>
-        <th>{% trans 'All courses' %}</th>
+        <th>{% trans 'All events' %}</th>
         <td></td>
         <td class="right">{{ sum.registrations }}</td>
         <td class="right">{{ sum.status.discount | currency }}</td>
         <td class="right">{{ sum.status.receivable | currency }}</td>
-        <td class="right">{{ sum.status.paid | currency }}</td>
+        <td class="right">{{ sum.status.received | currency }}</td>
+        <td class="right">{{ sum.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ sum.status.amount_due_color }}" title="{{ sum.status.title }}">
                 {{ sum.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ sum.status.overpaid_color }}" title="{{ sum.status.title }}">
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/course_stats.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/event_stats.html`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
 {% if form.is_valid %}
-<h1>{% blocktrans with date=date %}Course statistics for {{ date }}{% endblocktrans %}</h1>
+<h1>{% blocktrans with date=date %}Event statistics for {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Courses count' %}</th>
-        <td colspan="6">{{ courses_count }}</td>
+        <th>{% trans 'Events count' %}</th>
+        <td colspan="6">{{ events_count }}</td>
     </tr>
     <tr>
         <th>{% trans 'Age Group' %}</th>
         <th>{% trans 'Registrations' %}</th>
         <th>{% trans 'Boys' %}</th>
         <th>{% trans 'Girls' %}</th>
         {% for citizenship in citizenships %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/debtors.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/debtors.html`

 * *Files 14% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
-{% if reports %}
+{% if form.is_valid %}
 <h1>{% blocktrans with date=date %}Debtors list by date {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
         <th>{% trans 'Debtor' %}</th>
         <th class="right">{% trans 'Amount due' %}</th>
         <th class="right">{% trans 'Overdue' %}</th>
```

#### html2text {}

```diff
@@ -1,11 +1,11 @@
 {% extends 'leprikon/form.html' %} {% load i18n leprikon_tags sekizai_tags
-staticfiles %} {% block content %}
+static %} {% block content %}
 {{ block.super }}
-{% if reports %}
+{% if form.is_valid %}
 ****** {% blocktrans with date=date %}Debtors list by date {{ date }}{%
 endblocktrans %} ******
 {% trans 'Debtor' %}      {% trans 'Amount due' %}    {% trans 'Overdue' %}
 {{ user.get_full_name |   {{ items.sum.amount_due |   {{ items.sum.overdue |
 default:user.get_username currency }}                 currency }}
 }}
 {{ item.registration }}   {{ item.status.amount_due | {{ item.status.overdue |
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/event_payments_status.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/orderable_payments_status.html`

 * *Files 16% similar despite different names*

```diff
@@ -1,68 +1,75 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
-{% if reports %}
-<h1>{% blocktrans with date=date %}Event payments status by date {{ date }}{% endblocktrans %}</h1>
+{% if form.is_valid %}
+<h1>{% blocktrans with date=date %}Orderable event payments status by date {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Event' %}</th>
+        <th>{% trans 'Orderable event' %}</th>
         <th>{% trans 'Price' %}</th>
         <th>{% trans 'Number of registrations' %}</th>
         <th>{% trans 'Discounts' %}</th>
         <th>{% trans 'Receivables' %}</th>
         <th>{% trans 'Received payments' %}</th>
+        <th>{% trans 'Returned payments' %}</th>
         <th>{% trans 'Amount due' %}</th>
         <th>{% trans 'Overpayments' %}</th>
     </tr>
     {% for report in reports %}
     {% if report.registration_statuses %}
-    <tr id="report-{{ report.event.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.event.id }}-collapsed">
+    <tr id="report-{{ report.orderable.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.orderable.id }}-collapsed">
     {% else %}
-    <tr id="report-{{ report.event.id }}">
+    <tr id="report-{{ report.orderable.id }}">
     {% endif %}
-        <th>{{ report.event.name }}</th>
-        <td class="right">{{ report.event.price | currency }}</td>
+        <th>{{ report.orderable.name }}</th>
+        <td class="right">{{ report.orderable.price_text }}</td>
         <td class="right">{{ report.registration_statuses | length }}</td>
         <td class="right">{{ report.status.discount | currency }}</td>
         <td class="right">{{ report.status.receivable | currency }}</td>
-        <td class="right">{{ report.status.paid | currency }}</td>
+        <td class="right">{{ report.status.received | currency }}</td>
+        <td class="right">{{ report.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ report.status.amount_due_color }}" title="{{ report.status.title }}">
                 {{ report.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ report.status.overpaid_color }}" title="{{ report.status.title }}">
                 {{ report.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% for rs in report.registration_statuses %}
-    <tr class="collapse out {{ report.event.id }}-collapsed">
+    <tr class="collapse out {{ report.orderable.id }}-collapsed">
         <th class="right" colspan="3">
-            <a href="{% url 'admin:leprikon_eventregistration_changelist' %}?id={{ rs.registration.id }}">
+            <a href="{% url 'admin:leprikon_orderableregistration_changelist' %}?id={{ rs.registration.id }}">
                 {{ rs.registration }}
             </a>
         </th>
         <td class="right">
-            <a href="{% url 'admin:leprikon_eventdiscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+            <a href="{% url 'admin:leprikon_orderablediscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
                 {{ rs.status.discount | currency }}
             </a>
         </td>
         <td class="right">{{ rs.status.receivable | currency }}</td>
         <td class="right">
-            <a href="{% url 'admin:leprikon_subjectpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
-                {{ rs.status.paid | currency }}
+            <a href="{% url 'admin:leprikon_subjectreceivedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.received | currency }}
+            </a>
+        </td>
+        <td class="right">
+            <a href="{% url 'admin:leprikon_subjectreturnedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.returned | currency }}
             </a>
         </td>
         <td class="right">
             <strong style="color: {{ rs.status.amount_due_color }}" title="{{ rs.status.title }}">
                 {{ rs.status.amount_due | currency }}
             </strong>
         </td>
@@ -71,20 +78,21 @@
                 {{ rs.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% endfor %}
     {% endfor %}
     <tr>
-        <th>{% trans 'All events' %}</th>
+        <th>{% trans 'All orderable events' %}</th>
         <td></td>
         <td class="right">{{ sum.registrations }}</td>
         <td class="right">{{ sum.status.discount | currency }}</td>
         <td class="right">{{ sum.status.receivable | currency }}</td>
-        <td class="right">{{ sum.status.paid | currency }}</td>
+        <td class="right">{{ sum.status.received | currency }}</td>
+        <td class="right">{{ sum.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ sum.status.amount_due_color }}" title="{{ sum.status.title }}">
                 {{ sum.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ sum.status.overpaid_color }}" title="{{ sum.status.title }}">
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/event_stats.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/orderable_stats.html`

 * *Files 12% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
 {% if form.is_valid %}
-<h1>{% blocktrans with date=date %}Event statistics for {{ date }}{% endblocktrans %}</h1>
+<h1>{% blocktrans with date=date %}Orderable event statistics for {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Events count' %}</th>
-        <td colspan="6">{{ events_count }}</td>
+        <th>{% trans 'Orderable events count' %}</th>
+        <td colspan="6">{{ orderables_count }}</td>
     </tr>
     <tr>
         <th>{% trans 'Age Group' %}</th>
         <th>{% trans 'Registrations' %}</th>
         <th>{% trans 'Boys' %}</th>
         <th>{% trans 'Girls' %}</th>
         {% for citizenship in citizenships %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/index.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/index.html`

 * *Files 5% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/default.html' %}
-{% load i18n cms_tags sekizai_tags staticfiles %}
+{% load i18n cms_tags sekizai_tags static %}
 
 {% block content %}
 
 <h1>{% block title %}{% trans 'Reports' %}{% endblock %}</h1>
 
 {% static_placeholder 'reports' %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/orderable_payments_status.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/course_payments_status.html`

 * *Files 25% similar despite different names*

```diff
@@ -1,68 +1,75 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
-{% if reports %}
-<h1>{% blocktrans with date=date %}Orderable event payments status by date {{ date }}{% endblocktrans %}</h1>
+{% if form.is_valid %}
+<h1>{% blocktrans with date=date %}Course payments status by date {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Orderable event' %}</th>
+        <th>{% trans 'Course' %}</th>
         <th>{% trans 'Price' %}</th>
         <th>{% trans 'Number of registrations' %}</th>
         <th>{% trans 'Discounts' %}</th>
         <th>{% trans 'Receivables' %}</th>
         <th>{% trans 'Received payments' %}</th>
+        <th>{% trans 'Returned payments' %}</th>
         <th>{% trans 'Amount due' %}</th>
         <th>{% trans 'Overpayments' %}</th>
     </tr>
     {% for report in reports %}
     {% if report.registration_statuses %}
-    <tr id="report-{{ report.orderable.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.orderable.id }}-collapsed">
+    <tr id="report-{{ report.course.id }}" class="clickable" data-toggle="collapse" data-target=".{{ report.course.id }}-collapsed">
     {% else %}
-    <tr id="report-{{ report.orderable.id }}">
+    <tr id="report-{{ report.course.id }}">
     {% endif %}
-        <th>{{ report.orderable.name }}</th>
-        <td class="right">{{ report.orderable.price | currency }}</td>
+        <th>{{ report.course.name }}</th>
+        <td class="right">{{ report.course.price_text }}</td>
         <td class="right">{{ report.registration_statuses | length }}</td>
         <td class="right">{{ report.status.discount | currency }}</td>
         <td class="right">{{ report.status.receivable | currency }}</td>
-        <td class="right">{{ report.status.paid | currency }}</td>
+        <td class="right">{{ report.status.received | currency }}</td>
+        <td class="right">{{ report.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ report.status.amount_due_color }}" title="{{ report.status.title }}">
                 {{ report.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ report.status.overpaid_color }}" title="{{ report.status.title }}">
                 {{ report.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% for rs in report.registration_statuses %}
-    <tr class="collapse out {{ report.orderable.id }}-collapsed">
+    <tr class="collapse out {{ report.course.id }}-collapsed">
         <th class="right" colspan="3">
-            <a href="{% url 'admin:leprikon_orderableregistration_changelist' %}?id={{ rs.registration.id }}">
+            <a href="{% url 'admin:leprikon_courseregistration_changelist' %}?id={{ rs.registration.id }}">
                 {{ rs.registration }}
             </a>
         </th>
         <td class="right">
-            <a href="{% url 'admin:leprikon_orderablediscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+            <a href="{% url 'admin:leprikon_coursediscount_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
                 {{ rs.status.discount | currency }}
             </a>
         </td>
         <td class="right">{{ rs.status.receivable | currency }}</td>
         <td class="right">
-            <a href="{% url 'admin:leprikon_subjectpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
-                {{ rs.status.paid | currency }}
+            <a href="{% url 'admin:leprikon_subjectreceivedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.received | currency }}
+            </a>
+        </td>
+        <td class="right">
+            <a href="{% url 'admin:leprikon_subjectreturnedpayment_changelist' %}?registration_id={{ rs.registration.id }}" target="_blank">
+                {{ rs.status.returned | currency }}
             </a>
         </td>
         <td class="right">
             <strong style="color: {{ rs.status.amount_due_color }}" title="{{ rs.status.title }}">
                 {{ rs.status.amount_due | currency }}
             </strong>
         </td>
@@ -71,20 +78,21 @@
                 {{ rs.status.overpaid | currency }}
             </strong>
         </td>
     </tr>
     {% endfor %}
     {% endfor %}
     <tr>
-        <th>{% trans 'All orderable events' %}</th>
+        <th>{% trans 'All courses' %}</th>
         <td></td>
         <td class="right">{{ sum.registrations }}</td>
         <td class="right">{{ sum.status.discount | currency }}</td>
         <td class="right">{{ sum.status.receivable | currency }}</td>
-        <td class="right">{{ sum.status.paid | currency }}</td>
+        <td class="right">{{ sum.status.received | currency }}</td>
+        <td class="right">{{ sum.status.returned | currency }}</td>
         <td class="right">
             <strong style="color: {{ sum.status.amount_due_color }}" title="{{ sum.status.title }}">
                 {{ sum.status.amount_due | currency }}
             </strong>
         </td>
         <td class="right">
             <strong style="color: {{ sum.status.overpaid_color }}" title="{{ sum.status.title }}">
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/reports/orderable_stats.html` & `leprikon-3.5.0/leprikon/templates/leprikon/reports/course_stats.html`

 * *Files 8% similar despite different names*

```diff
@@ -1,22 +1,26 @@
 {% extends 'leprikon/form.html' %}
-{% load i18n leprikon_tags sekizai_tags staticfiles %}
+{% load i18n leprikon_tags sekizai_tags static %}
 
 {% block content %}
 <div class="hidden-print">
 {{ block.super }}
 </div>
 
 {% if form.is_valid %}
-<h1>{% blocktrans with date=date %}Orderable event statistics for {{ date }}{% endblocktrans %}</h1>
+<h1>{% blocktrans with date=date %}Course statistics for {{ date }}{% endblocktrans %}</h1>
 
 <table class="table table-hover">
     <tr>
-        <th>{% trans 'Orderable events count' %}</th>
-        <td colspan="6">{{ orderables_count }}</td>
+        <th>{% trans 'Courses count' %}</th>
+        <td colspan="6">{{ courses_count }}</td>
+    </tr>
+    <tr>
+        <th>{% trans 'Participant hours count' %}</th>
+        <td colspan="6">{{ participant_hours_count }}</td>
     </tr>
     <tr>
         <th>{% trans 'Age Group' %}</th>
         <th>{% trans 'Registrations' %}</th>
         <th>{% trans 'Boys' %}</th>
         <th>{% trans 'Girls' %}</th>
         {% for citizenship in citizenships %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/schoolyear_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/schoolyear_form.html`

 * *Files 19% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load leprikon_tags sekizai_tags staticfiles %}
+{% load leprikon_tags sekizai_tags static %}
 <form action="{% url 'leprikon:school_year' %}" method="post" class="form-horizontal" id="id_school_year_form">
     {% csrf_token %}
     <input type="hidden" name="{% param_back %}" value="{% current_url %}"/>
     {{ school_year_form.school_year }}
 </form>
 
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/static/bootstrap-datetimepicker.html` & `leprikon-3.5.0/leprikon/templates/leprikon/static/bootstrap-datetimepicker.html`

 * *Files 13% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load sekizai_tags staticfiles %}
+{% load sekizai_tags static %}
 
 {% addtoblock "css" %}
 <link rel="stylesheet" href="{% static 'leprikon/lib/bootstrap-datetimepicker.min.css' %}"/>
 {% endaddtoblock %}
 
 {% addtoblock "js" %}
 <script src="{% static 'leprikon/lib/moment-with-locales.min.js' %}"></script>
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/subject_journal.html` & `leprikon-3.5.0/leprikon/templates/leprikon/journal_journal.html`

 * *Files 4% similar despite different names*

```diff
@@ -1,19 +1,19 @@
-{% load i18n staticfiles leprikon_tags %}
+{% load i18n static leprikon_tags %}
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html lang="cs-CZ">
 
 <head>
     <meta charset="UTF-8" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1">
     <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
 
     <title>
-        {% trans 'Journal' %}: {{ subject.name }}
+        {% trans 'Journal' %}: {{ journal }}
     </title>
 
     <!-- Bootstrap -->
     <link rel="stylesheet" href="{% static 'leprikon/lib/bootstrap/css/bootstrap.min.css' %}"/>
 
     <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
     <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
@@ -114,21 +114,25 @@
                 <span class="glyphicon glyphicon-remove"></span>
             </button>
             {{ message }}
         </div>
         {% endfor %}
     </div>
     {% endif %}
-    {% for period in subject.all_journal_periods %}
-    {% with period.all_journal_entries|length|add:2 as columns_count %}
+    <div class="container paper">
+        <h1>{% trans 'Journal' %}: {{ journal }}</h1>
+    </div>
+    {% for period in journal.all_journal_periods %}
+    {% with period.all_journal_entries|length|add:3 as columns_count %}
     <div class="container paper">
         <h1>{% trans 'Attendance' %}{% if period.period %} - {{ period.period.name }}{% endif %}</h1>
         <div style="overflow: auto">
         <table class="table-hover presence">
             <tr>
+                <th>{% trans 'No.' %}</th>
                 <th>{% trans 'Name' context 'person' %}</th>
                 {% for entry in period.all_journal_entries %}
                 <th class="vertical">
                     <div>
                         {% if not admin %}
                         <a class="noprint" href="{% url_with_back 'leprikon:journalentry_update' entry.id %}" title="{% trans 'edit' %}">
                             <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
@@ -142,77 +146,82 @@
                         {{ entry.date }}
                     </div>
                 </th>
                 {% endfor %}
                 {% if not admin %}
                 <th class="vertical">
                     <div>
-                        <a class="noprint" href="{% url_with_back 'leprikon:journalentry_create' subject.id %}">
+                        <a class="noprint" href="{% url_with_back 'leprikon:journalentry_create' journal.id %}">
                             <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                             {% trans 'add entry' %}
                         </a>
                         &nbsp;
                     </div>
                 </td>
                 {% endif %}
             </tr>
             <tr>
                 <th colspan="{{ columns_count }}">{% trans 'Leaders' %}</td>
             </tr>
             {% for presence_record in period.get_leader_presences %}
             <tr>
+                <td>{{ forloop.counter }}.</td>
                 <td>{{ presence_record.person }}</td>
                 {% for p in presence_record.presences %}
                 <td>{% if p %}<a href="{{ p.get_edit_url }}?{% param_back %}={% current_url %}">&#x2717;</a>{% endif %}</td>
                 {% endfor %}
                 <td>&nbsp;</td>
             </tr>
             {% endfor %}
             {% for presence_record in period.get_alternate_presences %}
             <tr>
+                <td>{{ forloop.counter }}.</td>
                 <td>{{ presence_record.person }}</td>
                 {% for p in presence_record.presences %}
                 <td>{% if p %}<a href="{{ p.get_edit_url }}?{% param_back %}={% current_url %}">&#x2717;</a>{% endif %}</td>
                 {% endfor %}
                 <td>&nbsp;</td>
             </tr>
             {% endfor %}
             <tr>
                 <th colspan="{{ columns_count }}">{% trans 'Participants' %}</td>
             </tr>
             {% for presence_record in period.get_participant_presences %}
             <tr>
+                <td>{{ forloop.counter }}.</td>
                 <td>{{ presence_record.person }}</td>
                 {% for p in presence_record.presences %}
                 <td>{% if p %}&#x2717;{% endif %}</td>
                 {% endfor %}
                 <td class="empty"></td>
             </tr>
             {% endfor %}
         </table>
         </div>
     </div>
     {% endwith %}
     {% endfor %}
 
-    {% for period in subject.all_journal_periods %}
+    {% for period in journal.all_journal_periods %}
     <div class="container paper">
 
         <h1>{% trans 'Agenda' %}{% if period.period %} - {{ period.period.name }}{% endif %}</h1>
         <table class="journal">
             <tr>
+                <th>{% trans 'No.' %}</th>
                 <th>{% trans 'Date' %}</th>
                 <th>{% trans 'Time' %}</th>
                 <th>{% trans 'Number of hours' %}</th>
                 <th>{% trans 'Number of leaders' %}</th>
                 <th>{% trans 'Number of participants' %}</th>
                 <th>{% trans 'Session agenda' %}</th>
             </tr>
             {% for entry in period.all_journal_entries %}
             <tr>
+                <th>{{ forloop.counter }}.</th>
                 <td>{{ entry.date }}</td>
                 <td>{% if entry.duration %}{{ entry.start }}{% else %}{% trans 'skipped' %}{% endif %}</td>
                 <td>{% if entry.duration %}{{ entry.duration }}{% else %}{% trans 'skipped' %}{% endif %}</td>
                 <td>{{ entry.all_leader_entries|length }}</td>
                 <td>{{ entry.all_participants|length }}</td>
                 <td>
                     {% if not admin %}
@@ -237,15 +246,15 @@
                     {{ entry.agenda | safe }}
                 </td>
             </tr>
             {% endfor %}
             {% if not admin %}
             <tr class="noprint">
                 <td colspan="6">
-                    <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:journalentry_create' subject.id %}">
+                    <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:journalentry_create' journal.id %}">
                         <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                         {% trans 'add entry' %}
                     </a>
                 </td>
             </tr>
             {% endif %}
         </table>
@@ -254,65 +263,54 @@
     {% endfor %}
 
     <div class="container paper">
 
         <h1>
             {% trans 'Risks' %}
             {% if not admin %}
-            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:subject_update' subject.subject_type.slug subject.id %}">
+            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:journal_update' journal.id %}">
                 <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                 {% trans 'edit' %}
             </a>
             {% endif %}
         </h1>
 
         <table id="risks">
             <tr>
-                <th>{% trans 'Place / Risk' %}</th>
-            </tr>
-            <tr>
-                <td class="placeholder">{{ subject.risks | safe }}</td>
+                <td class="placeholder">{{ journal.risks | safe }}</td>
             </tr>
         </table>
 
         <h1>
             {% trans 'Plan for the activity' %}
             {% if not admin %}
-            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:subject_update' subject.subject_type.slug subject.id %}">
+            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:journal_update' journal.id %}">
                 <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                 {% trans 'edit' %}
             </a>
             {% endif %}
         </h1>
         <table id="plan">
             <tr>
-                <td class="placeholder" colspan="2">{{ subject.plan | safe }}</td>
-            </tr>
-            <tr>
-                <th>{% trans 'Signature' %}</th>
-                <td class="empty"></td>
+                <td class="placeholder" colspan="2">{{ journal.plan | safe }}</td>
             </tr>
         </table>
 
         <h1>
             {% trans 'Evaluation of the activity' %}
             {% if not admin %}
-            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:subject_update' subject.subject_type.slug subject.id %}">
+            <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:journal_update' journal.id %}">
                 <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                 {% trans 'edit' %}
             </a>
             {% endif %}
         </h1>
         <table id="evaluation">
             <tr>
-                <td class="placeholder" colspan="2">{{ subject.evaluation | safe }}</td>
-            </tr>
-            <tr>
-                <th>{% trans 'Signature' %}</th>
-                <td class="empty"></td>
+                <td class="placeholder" colspan="2">{{ journal.evaluation | safe }}</td>
             </tr>
         </table>
     </div>
 
     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="{% static 'leprikon/lib/jquery.min.js' %}"></script>
```

#### html2text {}

```diff
@@ -1,70 +1,72 @@
-{% load i18n staticfiles leprikon_tags %}
+{% load i18n static leprikon_tags %}
 
 
 
 
 
 
 {% if not admin %}
 &#x2716;
 {% endif %} {% if messages %}
 {% for message in messages %}
    {{ message }}
 {% endfor %}
-{% endif %} {% for period in subject.all_journal_periods %} {% with
-period.all_journal_entries|length|add:2 as columns_count %}
+{% endif %}
+****** {% trans 'Journal' %}: {{ journal }} ******
+{% for period in journal.all_journal_periods %} {% with
+period.all_journal_entries|length|add:3 as columns_count %}
 ****** {% trans 'Attendance' %}{% if period.period %} - {{ period.period.name
 }}{% endif %} ******
-                       {% if not admin %}  {% if not
-{% trans 'Name'        entry.affects_submitted_timesheets _{%_trans_'add_entry'
-context 'person' %}    %}  {% endif %} {% endif %} {      %}  
-                       { entry.date }}
-{% trans 'Leaders' %}
-{
-{                      {% if p %}&#x2717;{% endif %}       
-presence_record.person
-}}
-{
-{                      {% if p %}&#x2717;{% endif %}       
-presence_record.person
-}}
+                                       {% if not admin %}  {% if not      _{%
+{% trans 'No.'  {% trans 'Name'        entry.affects_submitted_timesheets trans
+%}              context 'person' %}    %}  {% endif %} {% endif %} {      'add
+                                       { entry.date }}                    entry'
+                                                                          %}  
 {% trans
-'Participants' %}
-{
-{                      {% if p %}&#x2717;{% endif %}
-presence_record.person
-}}
-{% endwith %} {% endfor %} {% for period in subject.all_journal_periods %}
+'Leaders' %}
+{               {
+{               {                      {% if p %}&#x2717;{% endif %}       
+forloop.counter presence_record.person
+}}.             }}
+{               {
+{               {                      {% if p %}&#x2717;{% endif %}       
+forloop.counter presence_record.person
+}}.             }}
+{% trans
+'Participants'
+%}
+{               {
+{               {                      {% if p %}&#x2717;{% endif %}
+forloop.counter presence_record.person
+}}.             }}
+{% endwith %} {% endfor %} {% for period in journal.all_journal_periods %}
 ****** {% trans 'Agenda' %}{% if period.period %} - {{ period.period.name }}{%
 endif %} ******
-{% trans   {% trans       {% trans                                       {% trans 'Number of
-'Date' %}  'Time' %}      'Number of     {% trans 'Number of leaders' %} participants' %}              {% trans 'Session agenda' %}
-                          hours' %}
-                                                                                                       {% if not admin %} _{%_trans_'edit'_%} {% if not
-                                                                                                       entry.affects_submitted_timesheets %} _{%_trans
-           {% if          {% if                                                                        'delete'_%} {% endif %} {% endif %} {% if
-           entry.duration entry.duration                                                               entry.all_participants_instructed %}
-{          %}{            %}{            {                               {                             {% trans 'participants instructed about safety
-{          { entry.start  {              {                               {                             and internal rules' as
-entry.date }}{% else %}{% entry.duration entry.all_leader_entries|length entry.all_participants|length participants_instructed_label %} {
-}}         trans          }}{% else %}{% }}                              }}                            { participants_instructed_label | first_upper }}:
-           'skipped' %}{% trans                                                                        {
-           endif %}       'skipped' %}{%                                                               {
-                          endif %}                                                                     entry.all_participants_instructed|comma_separated
-                                                                                                       }}
-                                                                                                       {% endif %} {{ entry.agenda | safe }}
+{% trans 'No.'  {% trans   {% trans       {% trans                                       {% trans 'Number of
+%}              'Date' %}  'Time' %}      'Number of     {% trans 'Number of leaders' %} participants' %}              {% trans 'Session agenda' %}
+                                          hours' %}
+                                                                                                                       {% if not admin %} _{%_trans_'edit'_%} {% if not
+                                                                                                                       entry.affects_submitted_timesheets %} _{%_trans
+                           {% if          {% if                                                                        'delete'_%} {% endif %} {% endif %} {% if
+                           entry.duration entry.duration                                                               entry.all_participants_instructed %}
+{               {          %}{            %}{            {                               {                             {% trans 'participants instructed about safety
+{               {          { entry.start  {              {                               {                             and internal rules' as
+forloop.counter entry.date }}{% else %}{% entry.duration entry.all_leader_entries|length entry.all_participants|length participants_instructed_label %} {
+}}.             }}         trans          }}{% else %}{% }}                              }}                            { participants_instructed_label | first_upper }}:
+                           'skipped' %}{% trans                                                                        {
+                           endif %}       'skipped' %}{%                                                               {
+                                          endif %}                                                                     entry.all_participants_instructed|comma_separated
+                                                                                                                       }}
+                                                                                                                       {% endif %} {{ entry.agenda | safe }}
 _{%_trans_'add_entry'_%}
 {% endfor %}
 ****** {% trans 'Risks' %} {% if not admin %} _{%_trans_'edit'_%} {% endif %}
 ******
-{% trans 'Place / Risk' %}
-{{ subject.risks | safe }}
+{{ journal.risks | safe }}
 ****** {% trans 'Plan for the activity' %} {% if not admin %} _{%_trans_'edit'
 %} {% endif %} ******
-{{ subject.plan | safe }}
-{% trans 'Signature' %}
+{{ journal.plan | safe }}
 ****** {% trans 'Evaluation of the activity' %} {% if not admin %} _{%_trans
 'edit'_%} {% endif %} ******
-{{ subject.evaluation | safe }}
-{% trans 'Signature' %}
+{{ journal.evaluation | safe }}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/subject_journal_pdf/subject.rml` & `leprikon-3.5.0/leprikon/templates/leprikon/journal_journal_pdf/default.rml`

 * *Files 1% similar despite different names*

```diff
@@ -25,15 +25,15 @@
             <blockTextColor colorName="black"/>
             <blockAlignment value="LEFT"/>
             <blockValign value="MIDDLE"/>
             <lineStyle kind="GRID" colorName="black"/>
         </blockTableStyle>
     </stylesheet>
     <story>
-        {% for page in object.all_approved_participants|paginator:28 %}
+        {% for page in object.all_participants|paginator:28 %}
         <blockTable style="blocktable" colWidths="80,200,80" rowHeights="40{% for participant in page %},23.36{% endfor %}" alignment="LEFT">
             <tr height="40">
                 <td></td>
                 <td>{% trans 'full name' %}</td>
                 <td>{% trans 'birh year' %}</td>
             </tr>
             {% for participant in page %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/subject_list.html` & `leprikon-3.5.0/leprikon/templates/leprikon/subject_list.html`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 {% extends 'leprikon/list.html' %}
-{% load i18n sekizai_tags staticfiles %}
+{% load i18n sekizai_tags static %}
 
 {% block content %}
 {{ block.super }}
 
 {% include 'leprikon/static/bootstrap-multiselect.html' %}
 
 {% addtoblock "js" %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/subject_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/subject_preview.html`

 * *Files 12% similar despite different names*

```diff
@@ -4,17 +4,15 @@
     <div class="box-header">
         <strong>{{ object.display_name }}</strong>
         {% for group in object.all_groups %}
         <small class="tag" style="color: {{ group.font_color }}; border-color: {{ group.font_color }}; background-color: {{ group.color }}">
             {{ group.name }}
         </small>
         {% endfor %}
-        {% if object.price %}
-        <small>{{ object.price | currency }}{% if object.school_year_division.period_name %} / {{ object.school_year_division.period_name }}{% endif %}</small>
-        {% endif %}
+        {% if object.price_text %}<small>{{ object.price_text }}</small>{% endif %}
         {% if request.user.is_staff or request.leader in object.all_leaders %}
         <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:subject_update' object.subject_type.slug object.id %}">
             <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
             {% trans 'edit' %}
         </a>
         {% endif %}
     </div>
@@ -97,20 +95,16 @@
 
         {% if request.user.is_staff or request.leader in object.all_leaders %}
         <div class="btn-group">
             <a class="btn btn-sm btn-default" href="{% url_with_back 'leprikon:subject_registrations' object.subject_type.slug object.id %}">
                 {% trans 'registrations' %}
                 ({{ object.approved_registrations_count }}{% if object.unapproved_registrations_count %} + {{ object.unapproved_registrations_count }}{% endif %})
             </a>
-            <a class="btn btn-sm btn-default" href="{% url_with_back 'leprikon:journal' object.id %}">
-                {% trans 'journal' %}
-            </a>
-            <a class="btn btn-sm btn-primary" href="{% url_with_back 'leprikon:journalentry_create' object.id %}">
-                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
-                {% trans 'add journal entry' %}
+            <a class="btn btn-sm btn-default" href="{% url 'leprikon:subject_journals' object.subject_type.slug object.id %}">
+                {% trans 'journals' %}
             </a>
         </div>
         {% endif %}
     </div>
 </div>
 
 {% include 'leprikon/static/ekko-lightbox.html' %}
```

#### html2text {}

```diff
@@ -1,12 +1,10 @@
 {% load i18n leprikon_tags sekizai_tags thumbnail %}
 {{ object.display_name }} {% for group in object.all_groups %} {{ group.name }}
-{% endfor %} {% if object.price %} {{ object.price | currency }}{% if
-object.school_year_division.period_name %} / {
-{ object.school_year_division.period_name }}{% endif %} {% endif %} {% if
+{% endfor %} {% if object.price_text %}{{ object.price_text }}{% endif %} {% if
 request.user.is_staff or request.leader in object.all_leaders %} _{%_trans
 'edit'_%} {% endif %}
 {% if object.photo %} [{{_object.photo.name_}}] {% endif %} {% if
 object.start_date %}{# event #}
 {% trans 'Start' %}: {{ object.start_date }}{% if objec.start_time %}, {
 { objec.start_time }}{% endif %} {% if object.start_date != object.end_date or
 objec.end_time %}
@@ -38,12 +36,11 @@
 {% endif %} {% if object.page %}
 {% trans 'More information' %}: {{_object.page.get_title_}}
 {% endif %}
 {% registration_links object %}
 {% if request.user.is_staff or request.leader in object.all_leaders %}
 {%_trans_'registrations'_%}_({{_object.approved_registrations_count_}}{%_if
 object.unapproved_registrations_count_%}_+_{
-{_object.unapproved_registrations_count_}}{%_endif_%}) {%_trans_'journal'_%} _
-{%_trans_'add_journal_entry'_%}
+{_object.unapproved_registrations_count_}}{%_endif_%}) {%_trans_'journals'_%}
 {% endif %}
 {% include 'leprikon/static/ekko-lightbox.html' %} {% addtoblock 'js' %}
  {% endaddtoblock %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/subject_registration_form.html` & `leprikon-3.5.0/leprikon/templates/leprikon/subject_registration_form.html`

 * *Files 5% similar despite different names*

```diff
@@ -1,19 +1,15 @@
 {% extends 'leprikon/default.html' %}
 {% load i18n cms_tags leprikon_tags sekizai_tags %}
 
 {% block content %}
 
 <h1>{% block title %}{{ title }}{% endblock %}</h1>
 
-{% if form.instance.subject.full %}
-    <div class="alert alert-warning" role="alert">
-        {% blocktrans with subject_type=form.instance.subject.subject_type.name_genitiv %}The capacity of this {{ subject_type }} has already been filled. You may register anyway, but the registration may not be approved. We will inform You.{% endblocktrans %}
-    </div>
-{% endif %}
+{% if view.subject_variant %}
 
 {% if form.errors %}
     <div class="alert alert-danger" role="alert">{% trans 'Please correct the highlighted errors below.' %}</div>
     <!-- {{ form.errors }} -->
 {% endif %}
 {% for error in form.non_field_errors %}
     <div class="alert alert-danger" role="alert">{{ error }}</div>
@@ -23,70 +19,15 @@
 
     {% if form.instance.subject.orderable %}
         <h3>{% trans 'Event date' %}</h3>
         {% include 'leprikon/form_item.html' with item=form.start_date %}
         {% include 'leprikon/form_item.html' with item=form.start_time %}
     {% endif %}
 
-    <h3>{% trans 'Price' %}</h3>
-    {% if form.subject_variant %}
-    <div class="form-group {{ form.subject_variant.css_classes }}">
-        <label class="control-label col-md-3">
-            {{ form.subject_variant.label }}
-        </label>
-        <div class="col-md-9{% if form.subject_variant.errors %} alert alert-danger{% endif %}">
-            {% for variant in form.instance.subject.all_variants %}
-                <div class="row select">
-                    <div class="col-md-1 right">
-                        <input class="form-control" data-type="ChoiceField"
-                               {% if variant.id == form.subject_variant.value|add:0 %}checked="checked"{% endif %}
-                               id="{{ form.subject_variant.id_for_label }}_{{ variant.id }}"
-                               name="{{ form.subject_variant.html_name }}" value="{{ variant.id }}" type="radio">
-                    </div>
-                    <div class="col-md-11">
-                        <label class="form-control" style="font-weight:normal" for="{{ form.subject_variant.id_for_label }}_{{ variant.id }}">
-                            <strong>{{ variant.name }}</strong><br/>
-                        </label>
-                        {{ variant.description | safe }}
-                    </div>
-                </div>
-            {% endfor %}
-
-            {% for error in form.subject_variant.errors %}
-                <div>{{ error }}</div>
-            {% endfor %}
-
-            {% if form.subject_variant.help_text %}
-                <span class="help-block">{{ form.subject_variant.help_text | safe }}</span>
-            {% endif %}
-        </div>
-    </div>
-    {% endif %}
-
-    <div class="form-group">
-        <label class="control-label col-md-3">{% trans 'Price' %}</label>
-        <div class="col-md-9">
-            <label class="form-control" style="font-weight:normal">
-                <span id="price">
-                {% if form.subject_variant.value %}
-                    {% for variant in form.instance.subject.all_variants %}
-                        {% if variant.id == form.subject_variant.value|add:0 %}{{ variant.price | currency }}{% endif %}
-                    {% endfor %}
-                {% else %}
-                    {{ form.instance.subject.price | currency }}
-                {% endif %}
-                </span>
-                {% if form.instance.subject.course.school_year_division.period_name %}
-                / {{ form.instance.subject.course.school_year_division.period_name }}
-                {% endif %}
-            </label>
-        </div>
-    </div>
-
-    {% if form.instance.subject.course.allow_period_selection %}
+    {% if form.instance.subject_variant.allow_period_selection %}
     {% include 'leprikon/form_item.html' with item=form.periods %}
     {% endif %}
 
     {{ form.participants_formset.management_form }}
 
     {% for participant_form in form.participants_formset %}
         <h3>{% trans 'Participant' %}</h3>
@@ -259,16 +200,20 @@
             {% if back_url %}
             <a class="btn btn-default" href="{{ back_url }}">{{ back_label }}</a>
             {% endif %}
         </div>
     </div>
 </form>
 
+{% addtoblock 'css' %}
+{{ form.media.css }}
+{% endaddtoblock %}
+
 {% addtoblock "js" %}
-{{ form.email_form.media.js }}
+{{ form.media.js }}
 
 <script type="text/javascript">
 
 function getBirthDate(birthNum) {
     birthNum = birthNum.replace("/","");
     y = parseInt(birthNum.substr(0, 2));
     year = (birthNum.length == 10 ? 1900 : 1800) + (y < 54 ? 100 : 0) + y;
@@ -356,15 +301,15 @@
 
 $(document).ready(function() {
     {% if form.subject_variant %}
     /* Show price for selected variant */
     $('input[type=radio][name={{ form.subject_variant.html_name }}]').change(function() {
         {% for variant in form.instance.subject.all_variants %}
         if (this.value == {{ variant.id }}) {
-            $('#price').text('{{ variant.price | currency | escapejs }}');
+            $('#price').text('{{ variant.price_text | escapejs }}');
         }{% endfor %}
     });
     {% endif %}
 
     {% for participant_form in form.participants_formset %}
     /* Select participant */
     $('input[type=radio][name={{ participant_form.prefix }}-participant_select-participant]').change(function() {
@@ -381,14 +326,18 @@
             $('#id_{{ participant_form.prefix }}-postal_code').val('');
             $('#id_{{ participant_form.prefix }}-phone').val('');
             $('#id_{{ participant_form.prefix }}-email').val('');
             $('#id_{{ participant_form.prefix }}-school').val('').change();
             $('#id_{{ participant_form.prefix }}-school_other').val('');
             $('#id_{{ participant_form.prefix }}-school_class').val('');
             $('#id_{{ participant_form.prefix }}-health').val('');
+            {% for question in participant_form.subject.all_questions %}
+            $('#id_{{ participant_form.prefix }}-questions-{{ question.slug }}').val('');
+            $('#id_{{ participant_form.prefix }}-questions-{{ question.slug }}').trigger('change');
+            {% endfor %}
         }{% for participant in participant_form.user_participants %} else if (this.value == {{ participant.id }}) {
             $('#id_{{ participant_form.prefix }}-first_name').val('{{ participant.first_name | escapejs }}');
             $('#id_{{ participant_form.prefix }}-last_name').val('{{ participant.last_name | escapejs }}');
             $('#id_{{ participant_form.prefix }}-citizenship').val('{{ participant.citizenship_id }}').change();
             $('#id_{{ participant_form.prefix }}-birth_num').val('{% if participant.birth_num %}{{ participant.birth_num | escapejs }}{% endif %}').change();
             $('#id_{{ participant_form.prefix }}-birth_date').data('DateTimePicker').date({{ participant.birth_date|jsdate }})
             $('#id_{{ participant_form.prefix }}-gender').val('{{ participant.gender | escapejs }}');
@@ -398,14 +347,18 @@
             $('#id_{{ participant_form.prefix }}-postal_code').val('{{ participant.postal_code | escapejs }}');
             $('#id_{{ participant_form.prefix }}-phone').val('{{ participant.phone | escapejs }}');
             $('#id_{{ participant_form.prefix }}-email').val('{{ participant.email | escapejs }}');
             $('#id_{{ participant_form.prefix }}-school').val('{% if participant.school_other %}other{% else %}{{ participant.school_id }}{% endif %}').change();
             $('#id_{{ participant_form.prefix }}-school_other').val('{{ participant.school_other | escapejs }}');
             $('#id_{{ participant_form.prefix }}-school_class').val('{{ participant.school_class | escapejs }}');
             $('#id_{{ participant_form.prefix }}-health').val('{{ participant.health | escapejs }}');
+            {% for key, value in participant.get_answers.items %}
+            $('#id_{{ participant_form.prefix }}-questions-{{ key }}').val('{{ value | escapejs }}');
+            $('#id_{{ participant_form.prefix }}-questions-{{ key }}').trigger('change');
+            {% endfor %}
         }{% endfor %}
     });
 
     /* Toggle first parent */
     $('#id_{{ participant_form.prefix }}-has_parent1').change(function() {
         toggle_section(this.checked, '{{ participant_form.prefix }}-parent1_form', true);
     });
@@ -553,8 +506,26 @@
     });
 });
 
 </script>
 {% endaddtoblock %}
 
 {% include 'leprikon/static/bootstrap-datetimepicker.html' %}
+{% else %}
+
+<h3>{% trans 'Select variant' %}</h3>
+
+{% for variant in view.available_variants %}
+<div class="row">
+    <div class="box" class="col-md-6">
+        <div class="box-header">
+            {{ variant.name }} | {{ variant.price_text }}
+        </div>
+        <div class="box-content">
+            {{ variant.description | safe }}
+            <a href="{% if view.registration_link %}{% url_with_back 'leprikon:registration_link_form' view.registration_link.slug variant.subject_id variant.id %}{% else %}{{ variant.get_registration_url }}{% endif %}" class="btn btn-primary">{% trans "Choose this variant" %}</a>
+        </div>
+    </div>
+</div>
+{% endfor %}
+{% endif %}
 {% endblock %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/timesheet_detail.html` & `leprikon-3.5.0/leprikon/templates/leprikon/timesheet_detail.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/timesheet_preview.html` & `leprikon-3.5.0/leprikon/templates/leprikon/timesheet_preview.html`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-{% load i18n leprikon_tags staticfiles %}
+{% load i18n leprikon_tags static %}
 <div class="box box-timesheet {% if not object.submitted %}not-{% endif %}submitted">
 
     <div class="box-header">
         <a href="{% url 'leprikon:timesheet_detail' object.id %}?page={{ page_obj.number }}"><strong>{{ object.period.name }}</strong></a>
         {% if not object.submitted %}
         <a class="btn btn-primary btn-xs" href="{% url_with_back 'leprikon:timesheet_submit' object.id %}">
             <span class="glyphicon glyphicon-send" aria-hidden="true"></span>
```

#### html2text {}

```diff
@@ -1,7 +1,7 @@
-{% load i18n leprikon_tags staticfiles %}
+{% load i18n leprikon_tags static %}
 {{_object.period.name_}} {% if not object.submitted %} _{%_trans_'submit'_%} {%
 endif %}
 {% for group in object.groups %}
 {{ group.name }}
 {{ group.duration }}
 {% endfor %}
```

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/user_dropdown.html` & `leprikon-3.5.0/leprikon/templates/leprikon/user_dropdown.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templates/leprikon/user_menu.html` & `leprikon-3.5.0/leprikon/templates/leprikon/user_menu.html`

 * *Files identical despite different names*

### Comparing `leprikon-3.0.0/leprikon/templatetags/leprikon_tags.py` & `leprikon-3.5.0/leprikon/templatetags/leprikon_tags.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,54 +1,57 @@
 import re
 from traceback import print_exc
 
 import requests
 from django import template
-from django.contrib.admin.templatetags.admin_list import (
-    result_list as _result_list,
-)
+from django.contrib.admin.templatetags.admin_list import result_list as _result_list
 from django.contrib.staticfiles import finders
 from django.core.cache import InvalidCacheBackendError, caches
 from django.core.paginator import Paginator
 from django.urls import reverse
 from django.utils import timezone
 from django.utils.formats import date_format
 from django.utils.safestring import mark_safe
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 from lxml.html import fromstring, tostring
 
 from ..conf import settings
 from ..forms.schoolyear import SchoolYearForm
+from ..models.subjects import Subject
 from ..utils import (
-    comma_separated as _comma_separated, currency as _currency,
-    current_url as _current_url, first_upper as _first_upper,
-    url_back as _url_back, url_with_back as _url_with_back,
+    comma_separated as _comma_separated,
+    currency as _currency,
+    current_url as _current_url,
+    first_upper as _first_upper,
+    url_back as _url_back,
+    url_with_back as _url_with_back,
 )
 
 register = template.Library()
 
 
 @register.filter
 def currency(value):
     try:
         return _currency(value)
     except (ValueError, TypeError):
-        return ''
+        return ""
 
 
 @register.filter
 def comma_separated(value):
     return _comma_separated(value)
 
 
-@register.inclusion_tag('leprikon/admin/dashboard.html', takes_context=True)
+@register.inclusion_tag("leprikon/admin/dashboard.html", takes_context=True)
 def dashboard(context):
     from ..models.subjects import SubjectType
+
     context = context.__copy__()
-    context['subject_types'] = SubjectType.objects.all()
+    context["subject_types"] = SubjectType.objects.all()
     return context
 
 
 @register.filter
 def first_upper(value):
     return _first_upper(value)
 
@@ -57,147 +60,142 @@
 def filter_current_school_year(value, school_year):
     return value.filter(school_year=school_year)
 
 
 @register.filter
 def lines(value):
     try:
-        return value.strip().split('\n')
+        return value.strip().split("\n")
     except Exception:
         return []
 
 
 @register.filter
 def jsdate(d):
     try:
-        return f'new Date({d.year},{d.month-1},{d.day})'
+        return f"new Date({d.year},{d.month-1},{d.day})"
     except AttributeError:
-        return 'undefined'
+        return "undefined"
 
 
 @register.filter
 def paginator(items, per_page=1):
     paginator = Paginator(items, per_page)
-    return [
-        paginator.page(page)
-        for page in paginator.page_range
-    ]
+    return [paginator.page(page) for page in paginator.page_range]
 
 
 @register.simple_tag
 def param_back():
     return settings.LEPRIKON_PARAM_BACK
 
 
 @register.simple_tag(takes_context=True)
 def url_back(context):
-    return _url_back(context['request'])
+    return _url_back(context["request"])
 
 
 @register.simple_tag(takes_context=True)
 def current_url(context):
-    return _current_url(context['request'])
+    return _current_url(context["request"])
 
 
-@register.inclusion_tag('leprikon/registration_links.html', takes_context=True)
-def registration_links(context, subject):
+@register.inclusion_tag("leprikon/registration_links.html", takes_context=True)
+def registration_links(context, subject: Subject):
     now = timezone.now()
     context = context.__copy__()
-    context['subject'] = subject
-    if context['request'].user.is_authenticated():
-        context['registrations'] = subject.registrations.filter(user=context['request'].user, canceled=None)
+    context["subject"] = subject
+    if context["request"].user.is_authenticated:
+        context["registrations"] = subject.registrations.filter(user=context["request"].user, canceled=None)
     else:
-        context['registrations'] = []
+        context["registrations"] = []
 
     try:
-        registration_link = context['view'].registration_link
+        registration_link = context["view"].registration_link
     except (AttributeError, KeyError):
         registration_link = None
 
     if registration_link:
         source = registration_link
-        context['registration_url'] = _url_with_back(
-            reverse('leprikon:registration_link_form', args=(registration_link.slug, subject.id)),
+        context["registration_url"] = _url_with_back(
+            reverse("leprikon:registration_link_form", args=(registration_link.slug, subject.id)),
             current_url(context),
         )
     else:
         source = subject
-        context['registration_url'] = _url_with_back(subject.get_registration_url(), current_url(context))
+        context["registration_url"] = _url_with_back(subject.get_registration_url(), current_url(context))
 
-    context['registration_allowed'] = source.registration_allowed
+    context["registration_allowed"] = source.registration_allowed
 
-    if context['registration_allowed']:
-        context['registration_message'] = ''
+    if context["registration_allowed"]:
+        context["registration_message"] = ""
     else:
-        context['registration_message'] = _('Registering is currently not allowed.')
+        context["registration_message"] = _("Registering is currently not allowed.")
 
-    if subject.price and source.reg_to:
-        context['registration_ended_message'] = _('Registering ended on {}').format(
-            date_format(timezone.localtime(source.reg_to), 'DATETIME_FORMAT')
+    if source.reg_to:
+        context["registration_ended_message"] = _("Registering ended on {}").format(
+            date_format(timezone.localtime(source.reg_to), "DATETIME_FORMAT")
         )
         if source.reg_to > now:
-            context['registration_end_in'] = (source.reg_to - now).seconds
-            context['registration_ends_message'] = _('Registering will end on {}.').format(
-                date_format(timezone.localtime(source.reg_to), 'DATETIME_FORMAT')
+            context["registration_end_in"] = (source.reg_to - now).seconds
+            context["registration_ends_message"] = _("Registering will end on {}.").format(
+                date_format(timezone.localtime(source.reg_to), "DATETIME_FORMAT")
             )
-            context['registration_message'] = context['registration_ends_message']
+            context["registration_message"] = context["registration_ends_message"]
         else:
-            context['registration_message'] = context['registration_ended_message']
-    if subject.price and source.reg_from and source.reg_from > now:
-        context['registration_start_in'] = (source.reg_from - now).seconds
-        context['registration_starts_message'] = _('Registering will start on {}.').format(
-            date_format(timezone.localtime(source.reg_from), 'DATETIME_FORMAT')
+            context["registration_message"] = context["registration_ended_message"]
+    if source.reg_from and source.reg_from > now:
+        context["registration_start_in"] = (source.reg_from - now).seconds
+        context["registration_starts_message"] = _("Registering will start on {}.").format(
+            date_format(timezone.localtime(source.reg_from), "DATETIME_FORMAT")
         )
-        context['registration_message'] = context['registration_starts_message']
+        context["registration_message"] = context["registration_starts_message"]
     return context
 
 
-@register.inclusion_tag('leprikon/schoolyear_form.html', takes_context=True)
+@register.inclusion_tag("leprikon/schoolyear_form.html", takes_context=True)
 def school_year_form(context):
     context = context.__copy__()
-    context['school_year_form'] = SchoolYearForm(context.get('request'))
+    context["school_year_form"] = SchoolYearForm(context.get("request"))
     return context
 
 
 @register.simple_tag
 def upstream(url, xpath, *replacements):
-    '''
+    """
     If Leprikón is intended to look like another website (the main website of the organization),
     use this tag to include html snippet from the other site to always stay aligned with it.
 
     Following example includes tag <nav> (with all it's content) from https://example.com:
 
         {% load cache leprikon_tags %}
         {% cache 300 menu %}{% upstream 'https://example.com/' '//nav' %}{% endcache %}
         {% cache 300 menu %}{% upstream 'https://example.com/' '//nav' '|<br>|<br/>|' %}{% endcache %}
-    '''
+    """
     try:
-        cache = caches['upstream_pages']
+        cache = caches["upstream_pages"]
     except InvalidCacheBackendError:
-        cache = caches['default']
+        cache = caches["default"]
     try:
         content = cache.get(url)
         if content is None:
             content = requests.get(url).content
             cache.set(url, content, 60)
         for replacement in replacements:
             try:
-                replacement = replacement.encode('utf-8')
+                replacement = replacement.encode("utf-8")
                 pattern, repl = replacement[1:-1].split(replacement[:1])
             except (IndexError, ValueError):
                 print_exc()
             else:
                 content = re.sub(pattern, repl, content)
-        return mark_safe(b''.join(
-            tostring(node)
-            for node in fromstring(content).xpath(xpath)
-        ))
+        result_bytes = b"".join(tostring(node) for node in fromstring(content).xpath(xpath))
+        return mark_safe(result_bytes.decode())
     except Exception:
         print_exc()
-        return ''
+        return ""
 
 
 class URLWithBackNode(template.base.Node):
     def __init__(self, original_node):
         self.original_node = original_node
 
     def render(self, context):
@@ -214,24 +212,24 @@
     but adds parameter back with current url.
     """
     return URLWithBackNode(template.defaulttags.url(parser, token))
 
 
 @register.simple_tag(takes_context=True)
 def query_string(context, key, value):
-    get = context['request'].GET.copy()
+    get = context["request"].GET.copy()
     get[key] = value
     return get.urlencode()
 
 
 @register.simple_tag
 def font(name):
     return finders.find(name)
 
 
-@register.inclusion_tag('admin/change_list_results.html')
+@register.inclusion_tag("admin/change_list_results.html")
 def css_result_list(cl):
     context = _result_list(cl)
-    if hasattr(cl.model_admin, 'get_css'):
-        for result, obj in zip(context['results'], cl.result_list):
+    if hasattr(cl.model_admin, "get_css"):
+        for result, obj in zip(context["results"], cl.result_list):
             result.css = cl.model_admin.get_css(obj)
     return context
```

### Comparing `leprikon-3.0.0/leprikon/utils.py` & `leprikon-3.5.0/leprikon/utils.py`

 * *Files 6% similar despite different names*

```diff
@@ -1,169 +1,190 @@
 import locale
 import os
 import re
 import string
 import unicodedata
 import zlib
 from datetime import date
+from decimal import Decimal
+from typing import Iterable, Union
 from urllib.parse import parse_qs, urlencode
 
 from django.core.exceptions import ObjectDoesNotExist
 from django.db import IntegrityError, transaction
 from django.urls import reverse_lazy as reverse
-from django.utils.encoding import iri_to_uri, smart_text
+from django.utils.encoding import iri_to_uri
 from django.utils.functional import lazy
 from django.utils.safestring import mark_safe
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from .conf import settings
 
-MALE = 'm'
-FEMALE = 'f'
+MALE = "m"
+FEMALE = "f"
 
 
 def _get_localeconv():
     """
     This function loads localeconv during module load.
     It is necessary, because using locale.setlocale later may be dangerous
     (It is not thread-safe in most of the implementations.)
     """
     original_locale_name = locale.setlocale(locale.LC_ALL)
-    locale_name = locale.locale_alias[settings.LANGUAGE_CODE].split('.')[0] + '.UTF-8'
+    locale_name = locale.locale_alias[settings.LANGUAGE_CODE].split(".")[0] + ".UTF-8"
     locale.setlocale(locale.LC_ALL, str(locale_name))
     lc = locale.localeconv()
     locale.setlocale(locale.LC_ALL, original_locale_name)
     return lc
 
 
 localeconv = _get_localeconv()
 
 
+def attributes(**kwargs):
+    def _attributes(obj):
+        for attr, value in kwargs.items():
+            setattr(obj, attr, value)
+        return obj
+
+    return _attributes
+
+
+def first(*values):
+    for value in values:
+        if value is not None:
+            return value
+
+
 # This function is inspired by python's standard locale.currency().
-def currency(val, international=False):
+def currency(val: Union[int, float, Decimal], international=False) -> str:
     """Formats val according to the currency settings for current language."""
     digits = settings.PRICE_DECIMAL_PLACES
 
     # grouping
     groups = []
     s = str(abs(int(val)))
-    for interval in locale._grouping_intervals(localeconv['mon_grouping']):
+    for interval in locale._grouping_intervals(localeconv["mon_grouping"]):
         if not s:
             break
         groups.append(s[-interval:])
         s = s[:-interval]
     if s:
         groups.append(s)
     groups.reverse()
-    s = smart_text(localeconv['mon_thousands_sep']).join(groups)
+    s = localeconv["mon_thousands_sep"].join(groups)
 
     # display fraction for non integer values
     if digits and not isinstance(val, int):
-        s += smart_text(localeconv['mon_decimal_point']) + '{{:.{}f}}'.format(digits).format(val).split('.')[1]
+        s += localeconv["mon_decimal_point"] + "{{:.{}f}}".format(digits).format(val).split(".")[1]
 
     # '<' and '>' are markers if the sign must be inserted between symbol and value
-    s = '<' + s + '>'
+    s = "<" + s + ">"
 
-    smb = smart_text(localeconv[international and 'int_curr_symbol' or 'currency_symbol'])
-    precedes = localeconv[val < 0 and 'n_cs_precedes' or 'p_cs_precedes']
-    separated = localeconv[val < 0 and 'n_sep_by_space' or 'p_sep_by_space']
+    smb = localeconv[international and "int_curr_symbol" or "currency_symbol"]
+    precedes = localeconv[val < 0 and "n_cs_precedes" or "p_cs_precedes"]
+    separated = localeconv[val < 0 and "n_sep_by_space" or "p_sep_by_space"]
 
     if precedes:
-        s = smb + (separated and ' ' or '') + s
+        s = smb + (separated and " " or "") + s
     else:
-        s = s + (separated and ' ' or '') + smb
+        s = s + (separated and " " or "") + smb
 
-    sign_pos = localeconv[val < 0 and 'n_sign_posn' or 'p_sign_posn']
-    sign = localeconv[val < 0 and 'negative_sign' or 'positive_sign']
+    sign_pos = localeconv[val < 0 and "n_sign_posn" or "p_sign_posn"]
+    sign = localeconv[val < 0 and "negative_sign" or "positive_sign"]
 
     if sign_pos == 0:
-        s = '(' + s + ')'
+        s = "(" + s + ")"
     elif sign_pos == 1:
         s = sign + s
     elif sign_pos == 2:
         s = s + sign
     elif sign_pos == 3:
-        s = s.replace('<', sign)
+        s = s.replace("<", sign)
     elif sign_pos == 4:
-        s = s.replace('>', sign)
+        s = s.replace(">", sign)
     else:
         # the default if nothing specified;
         # this should be the most fitting sign position
         s = sign + s
 
-    return s.replace('<', '').replace('>', '').replace(' ', '\u00A0')
+    return s.replace("<", "").replace(">", "").replace(" ", "\u00A0")
 
 
 def amount_color(amount):
     if amount > 0:
         return settings.LEPRIKON_COLOR_POSITIVE
     elif amount < 0:
         return settings.LEPRIKON_COLOR_NEGATIVE
     else:
         return settings.LEPRIKON_COLOR_ZERO
 
 
-def comma_separated(lst):
-    lst = list(map(smart_text, lst))
+def ascii(value):
+    return unicodedata.normalize("NFKD", value).encode("ascii", errors="ignore").decode("ascii")
+
+
+def comma_separated(lst: Iterable) -> str:
+    lst = list(map(str, lst))
     if len(lst) > 2:
-        return _(', and ').join([', '.join(lst[:-1]), lst[-1]])
+        return _(", and ").join([", ".join(lst[:-1]), lst[-1]])
     else:
-        return _(', and ').join(lst)
+        return _(", and ").join(lst)
 
 
 def get_rand_hash(length=32, stringset=string.ascii_letters + string.digits):
-    return ''.join([stringset[i % len(stringset)] for i in [ord(x) for x in os.urandom(length)]])
+    return "".join([stringset[i % len(stringset)] for i in [ord(x) for x in os.urandom(length)]])
 
 
 def current_url(request):
-    if request.META['QUERY_STRING']:
-        return '{}?{}'.format(request.path, request.META['QUERY_STRING'])
+    if request.META["QUERY_STRING"]:
+        return "{}?{}".format(request.path, request.META["QUERY_STRING"])
     else:
         return request.path
 
 
 def url_back(request):
     return request.POST.get(
         settings.LEPRIKON_PARAM_BACK,
         request.GET.get(
             settings.LEPRIKON_PARAM_BACK,
-            reverse('leprikon:summary'),
+            reverse("leprikon:summary"),
         ),
     )
 
 
-recursive_back_splitter = re.compile(f'[?&]{settings.LEPRIKON_PARAM_BACK}=')
+recursive_back_splitter = re.compile(f"[?&]{settings.LEPRIKON_PARAM_BACK}=")
 
 
 def url_with_back(url, url_back):
     try:
-        query = url_back.split('?')[1]
+        query = url_back.split("?")[1]
     except IndexError:
         pass
     else:
         try:
             # try to reuse original back url
             url_back = parse_qs(query)[settings.LEPRIKON_PARAM_BACK][0]
         except KeyError:
             pass
     # remove recursive back url
     url_back = recursive_back_splitter.split(url_back)[0]
-    return '{}?{}'.format(url, urlencode({settings.LEPRIKON_PARAM_BACK: iri_to_uri(url_back)}))
+    return "{}?{}".format(url, urlencode({settings.LEPRIKON_PARAM_BACK: iri_to_uri(url_back)}))
 
 
 def reverse_with_back(request, *args, **kwargs):
     return url_with_back(reverse(*args, **kwargs), current_url(request))
 
 
 def get_gender(birth_num):
-    return FEMALE if birth_num[2:4] > '50' else MALE
+    return FEMALE if birth_num[2:4] > "50" else MALE
 
 
 def get_birth_date(birth_num):
-    birth_num = birth_num.replace('/', '')
+    birth_num = birth_num.replace("/", "")
     y = int(birth_num[:2])
     if len(birth_num) == 9:
         # before 1954
         if y < 54:
             year = 1900 + y
         else:
             year = 1800 + y
@@ -185,30 +206,30 @@
     if birth_day_this_year > today:
         return today.year - birth_date.year - 1
     else:
         return today.year - birth_date.year
 
 
 def first_upper(s):
-    return s[0].upper() + s[1:] if s else ''
+    return s[0].upper() + s[1:] if s else ""
 
 
 def merge_objects(source, target, attributes=None, exclude=[]):
     attributes = attributes or [f.name for f in source._meta.fields if f.name not in exclude]
     for attr in attributes:
         if not getattr(target, attr):
             setattr(target, attr, getattr(source, attr))
     return target
 
 
 @transaction.atomic
 def merge_users(source, target):
     from .models.subjects import SubjectRegistration
 
-    target = merge_objects(source, target, ('first_name', 'last_name', 'email'))
+    target = merge_objects(source, target, ("first_name", "last_name", "email"))
     target.date_joined = (
         min(source.date_joined, target.date_joined)
         if source.date_joined and target.date_joined
         else source.date_joined or target.date_joined
     )
     target.last_login = (
         max(source.last_login, target.last_login)
@@ -223,41 +244,46 @@
     except ObjectDoesNotExist:
         pass
     except IntegrityError:
         # both users are leaders
         raise
 
     for attr in (
-        'user', 'created_by', 'approved_by', 'payment_requested_by',
-        'cancelation_requested_by', 'canceled_by',
+        "user",
+        "created_by",
+        "approved_by",
+        "payment_requested_by",
+        "refund_offered_by",
+        "cancelation_requested_by",
+        "canceled_by",
     ):
         SubjectRegistration.objects.filter(**{attr: source}).update(**{attr: target})
 
     for sp in source.leprikon_participants.all():
         tp = target.leprikon_participants.filter(birth_num=sp.birth_num).first()
         if tp:
-            tp = merge_objects(sp, tp, exclude=('id', 'user', 'birth_num'))
+            tp = merge_objects(sp, tp, exclude=("id", "user", "birth_num"))
             tp.save()
         else:
             sp.user = target
             sp.save()
 
     for sp in source.leprikon_parents.all():
         tp = target.leprikon_parents.filter(first_name=sp.first_name, last_name=sp.last_name).first()
         if tp:
-            tp = merge_objects(sp, tp, exclude=('id', 'user'))
+            tp = merge_objects(sp, tp, exclude=("id", "user"))
             tp.save()
         else:
             sp.user = target
             sp.save()
 
     for sbi in source.leprikon_billing_info.all():
         tbi = target.leprikon_billing_info.filter(name=sbi.name).first()
         if tbi:
-            tbi = merge_objects(sbi, tbi, exclude=('id', 'user'))
+            tbi = merge_objects(sbi, tbi, exclude=("id", "user"))
             tbi.save()
         else:
             sbi.user = target
             sbi.save()
 
     for mr in source.leprikon_messages.all():
         if not target.leprikon_messages.filter(message=mr.message).exists():
@@ -266,31 +292,24 @@
 
     try:
         # support social auth
         source.social_auth.update(user=target)
     except AttributeError:
         pass
 
-    from .rocketchat import RocketChat
-    RocketChat().merge_users(source, target)
-
     source.delete()
 
 
 def spayd(*items):
-    s = 'SPD*1.0*' + '*'.join(
-        '%s:%s' % (k, unicodedata.normalize('NFKD', str(v).replace('*', '')).encode('ascii', 'ignore').upper().decode())
+    s = "SPD*1.0*" + "*".join(
+        "%s:%s" % (k, unicodedata.normalize("NFKD", str(v).replace("*", "")).encode("ascii", "ignore").upper().decode())
         for k, v in sorted(items)
     )
-    s += '*CRC32:%x' % zlib.crc32(s.encode())
+    s += "*CRC32:%x" % zlib.crc32(s.encode())
     return s.upper()
 
 
 def paragraph(text):
-    return mark_safe(
-        f'<p>{text.strip()}</p>'
-        .replace('\n', '<br/>\n')
-        .replace('<br/>\n<br/>\n', '</p>\n\n<p>')
-    )
+    return mark_safe(f"<p>{text.strip()}</p>".replace("\n", "<br/>\n").replace("<br/>\n<br/>\n", "</p>\n\n<p>"))
 
 
 lazy_paragraph = lazy(paragraph, str)
```

### Comparing `leprikon-3.0.0/leprikon/views/__init__.py` & `leprikon-3.5.0/leprikon/views/__init__.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,23 +1,39 @@
 from django.contrib.auth.decorators import user_passes_test
 from django.urls import reverse_lazy as reverse
 from django.views.decorators.csrf import csrf_exempt
 
 from ..conf import settings
 from . import (
-    billing_info, journals, leaders, messages, parents, participants,
-    registrationlink, registrations, reports, schoolyear, subjects, summaries,
-    terms_conditions, timesheets, user,
+    billing_info,
+    donation,
+    journals,
+    leaders,
+    messages,
+    parents,
+    participants,
+    refundrequest,
+    registrationlink,
+    registrations,
+    reports,
+    schoolyear,
+    subjects,
+    summaries,
+    terms_conditions,
+    timesheets,
+    user,
 )
 from .reports import (
-    courses as reports_courses, debtors as reports_debtors,
-    events as reports_events, orderables as reports_orderables,
+    courses as reports_courses,
+    debtors as reports_debtors,
+    events as reports_events,
+    orderables as reports_orderables,
 )
 
-login_url = reverse('leprikon:user_login')
+login_url = reverse("leprikon:user_login")
 
 
 def _user_is_leader(u):
     try:
         u.leprikon_leader
         return True
     except Exception:
@@ -68,15 +84,24 @@
 registration_payment_request = login_required(subjects.SubjectRegistrationPaymentRequestView.as_view())
 registration_cancel = login_required(subjects.SubjectRegistrationCancelView.as_view())
 
 registration_link = registrationlink.RegistrationLinkView.as_view()
 registration_link_form = login_required(registrationlink.RegistrationLinkFormView.as_view())
 
 payment_list = login_required(subjects.SubjectPaymentsListView.as_view())
-payment_pdf = login_required(subjects.SubjectPaymentPdfView.as_view())
+received_payment_pdf = login_required(subjects.SubjectReceivedPaymentPdfView.as_view())
+returned_payment_pdf = login_required(subjects.SubjectReturnedPaymentPdfView.as_view())
+
+refund_request_create = login_required(refundrequest.RefundRequestCreateView.as_view())
+refund_request_update = login_required(refundrequest.RefundRequestUpdateView.as_view())
+refund_request_delete = login_required(refundrequest.RefundRequestDeleteView.as_view())
+payment_transfer_create = login_required(refundrequest.PaymentTransferCreateView.as_view())
+donation_create = login_required(refundrequest.DonationCreateView.as_view())
+donation_list = login_required(donation.DonationListView.as_view())
+donation_pdf = login_required(donation.DonationPdfView.as_view())
 
 participant_list = login_required(participants.ParticipantListView.as_view())
 participant_create = login_required(participants.ParticipantCreateView.as_view())
 participant_update = login_required(participants.ParticipantUpdateView.as_view())
 participant_delete = login_required(participants.ParticipantDeleteView.as_view())
 
 parent_create = login_required(parents.ParentCreateView.as_view())
@@ -86,27 +111,31 @@
 billing_info_list = login_required(billing_info.BillingInfoListView.as_view())
 billing_info_create = login_required(billing_info.BillingInfoCreateView.as_view())
 billing_info_update = login_required(billing_info.BillingInfoUpdateView.as_view())
 billing_info_delete = login_required(billing_info.BillingInfoDeleteView.as_view())
 
 leader_summary = leader_required(summaries.LeaderSummaryView.as_view())
 alternating = leader_required(journals.AlternatingView.as_view())
+journal_create = leader_or_staff_required(journals.JournalCreateView.as_view())
+journal_update = leader_or_staff_required(journals.JournalUpdateView.as_view())
+journal_delete = leader_or_staff_required(journals.JournalDeleteView.as_view())
 journal = leader_or_staff_required(journals.JournalView.as_view())
 journalentry_create = leader_or_staff_required(journals.JournalEntryCreateView.as_view())
 journalentry_update = leader_or_staff_required(journals.JournalEntryUpdateView.as_view())
 journalentry_delete = leader_or_staff_required(journals.JournalEntryDeleteView.as_view())
 journalleaderentry_update = leader_or_staff_required(journals.JournalLeaderEntryUpdateView.as_view())
 journalleaderentry_delete = leader_or_staff_required(journals.JournalLeaderEntryDeleteView.as_view())
 
 subject_list = subjects.SubjectListView.as_view()
 subject_list_mine = leader_required(subjects.SubjectListMineView.as_view())
 subject_detail = subjects.SubjectDetailView.as_view()
 subject_registration_form = login_required(subjects.SubjectRegistrationFormView.as_view())
 subject_update = leader_or_staff_required(subjects.SubjectUpdateView.as_view())
 subject_registrations = leader_or_staff_required(subjects.SubjectRegistrationsView.as_view())
+subject_journals = leader_or_staff_required(subjects.SubjectJournalsView.as_view())
 
 message_list = login_required(messages.MessageListView.as_view())
 message_detail = csrf_exempt(messages.MessageDetailView.as_view())
 
 leader_list = leaders.LeaderListView.as_view()
 
 timesheet_list = leader_required(timesheets.TimesheetListView.as_view())
```

### Comparing `leprikon-3.0.0/leprikon/views/billing_info.py` & `leprikon-3.5.0/leprikon/views/billing_info.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,54 +1,52 @@
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.billing_info import BillingInfoForm
 from ..models.roles import BillingInfo
 from ..utils import reverse_with_back
 from .generic import CreateView, DeleteView, ListView, UpdateView
 
 
 class GetQerysetMixin:
     def get_queryset(self):
         return self.request.user.leprikon_billing_info.all()
 
 
 class BillingInfoListView(GetQerysetMixin, ListView):
-    add_label = _('add billing information')
-    preview_template = 'leprikon/billing_info_preview.html'
+    add_label = _("add billing information")
+    preview_template = "leprikon/billing_info_preview.html"
 
     def get_title(self):
-        return _('Billing information')
+        return _("Billing information")
 
     def get_add_url(self):
-        return reverse_with_back(self.request, 'leprikon:billing_info_create')
+        return reverse_with_back(self.request, "leprikon:billing_info_create")
 
 
 class GetFromKwargsMixin:
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['user'] = self.request.user
+        kwargs["user"] = self.request.user
         return kwargs
 
 
 class BillingInfoCreateView(GetFromKwargsMixin, GetQerysetMixin, CreateView):
     form_class = BillingInfoForm
-    title = _('New billing information')
+    title = _("New billing information")
 
     def get_message(self):
-        return _('New billing information {} have been created.').format(self.object)
+        return _("New billing information {} have been created.").format(self.object)
 
 
 class BillingInfoUpdateView(GetFromKwargsMixin, GetQerysetMixin, UpdateView):
     form_class = BillingInfoForm
-    message = _('Billing information have been updated.')
-    title = _('Change billing information')
+    message = _("Billing information have been updated.")
+    title = _("Change billing information")
 
 
 class BillingInfoDeleteView(GetQerysetMixin, DeleteView):
     model = BillingInfo
-    title = _('Delete billing information')
-    message = _('Billing information have been deleted.')
+    title = _("Delete billing information")
+    message = _("Billing information have been deleted.")
 
     def get_question(self):
-        return _('Do You really want to delete the billing information: {}?').format(
-            self.object
-        )
+        return _("Do You really want to delete the billing information: {}?").format(self.object)
```

### Comparing `leprikon-3.0.0/leprikon/views/generic.py` & `leprikon-3.5.0/leprikon/views/generic.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,117 +1,119 @@
 from django.contrib import messages
 from django.urls import reverse_lazy as reverse
-from django.utils.http import is_safe_url
-from django.utils.translation import ugettext_lazy as _
+from django.utils.functional import cached_property
+from django.utils.translation import gettext_lazy as _
 from django.views.generic import (
-    CreateView as _CreateView, DeleteView as _DeleteView,
-    DetailView as _DetailView, FormView as _FormView, ListView as _ListView,
-    TemplateView as _TemplateView, UpdateView as _UpdateView,
+    CreateView as _CreateView,
+    DeleteView as _DeleteView,
+    DetailView as _DetailView,
+    FormView as _FormView,
+    ListView as _ListView,
+    TemplateView as _TemplateView,
+    UpdateView as _UpdateView,
 )
 
 from ..conf import settings
 from ..forms.confirm import ConfirmForm
 
 
 class GenericViewMixin(object):
-    title = ''
+    title = ""
 
     def get_context_data(self, *args, **kwargs):
-        context = super(GenericViewMixin, self).get_context_data(
-            *args,
-            placeholder=self.get_placeholder(),
-            title=self.get_title(),
-            **kwargs
-        )
+        context = super().get_context_data(*args, placeholder=self.get_placeholder(), title=self.get_title(), **kwargs)
         return context
 
     def get_placeholder(self):
         return self.__class__.__name__
 
     def get_title(self):
         return self.title
 
 
 class ListView(GenericViewMixin, _ListView):
-    template_name = 'leprikon/list.html'
+    template_name = "leprikon/list.html"
     add_url = None
-    add_label = _('add')
-    add_title = ''
-    message_empty = _('No items found.')
-    preview_template = ''
+    add_label = _("add")
+    add_title = ""
+    message_empty = _("No items found.")
+    preview_template = ""
 
     def get_add_url(self):
         return self.add_url
 
     def get_add_label(self):
         return self.add_label
 
     def get_add_title(self):
         return self.add_title
 
     def get_message_empty(self):
         return self.message_empty
 
     def get_context_data(self, *args, **kwargs):
-        return super(ListView, self).get_context_data(
+        return super().get_context_data(
             *args,
             preview_template=self.preview_template,
             add_url=self.get_add_url(),
             add_label=self.get_add_label(),
             add_title=self.get_add_title(),
             message_empty=self.get_message_empty(),
             **kwargs
         )
 
 
 class FilteredListView(ListView):
     form_class = None
-    message_empty = _('No items found matching given search parameters.')
+    message_empty = _("No items found matching given search parameters.")
+
+    @cached_property
+    def form(self):
+        return self.get_form()
 
     def get_form(self):
         return self.form_class(data=self.request.GET)
 
     def get_context_data(self, *args, **kwargs):
-        return super(FilteredListView, self).get_context_data(*args, form=self.get_form(), **kwargs)
+        return super().get_context_data(*args, form=self.form, **kwargs)
+
+    def get_queryset(self):
+        return self.form.get_queryset()
 
 
 class BackViewMixin(object):
-    back_url = reverse('leprikon:summary')
-    back_label = _('Back')
+    back_url = reverse("leprikon:summary")
+    back_label = _("Back")
 
     def get_context_data(self, *args, **kwargs):
-        return super(BackViewMixin, self).get_context_data(
-            *args,
-            back_url=self.get_back_url(),
-            back_label=self.get_back_label(),
-            **kwargs
-        )
+        return super().get_context_data(*args, back_url=self.get_back_url(), back_label=self.get_back_label(), **kwargs)
 
     def get_back_label(self):
         return self.back_label
 
     def get_back_url(self):
-        url = self.request.POST.get(settings.LEPRIKON_PARAM_BACK,
-                                    self.request.GET.get(settings.LEPRIKON_PARAM_BACK, ''))
-        if is_safe_url(url=url, host=self.request.get_host()):
+        url = self.request.POST.get(
+            settings.LEPRIKON_PARAM_BACK, self.request.GET.get(settings.LEPRIKON_PARAM_BACK, "")
+        )
+        if url.startswith("/"):
             return url
         else:
             return self.back_url
 
 
 class FormViewMixin(BackViewMixin, GenericViewMixin):
-    template_name = 'leprikon/form.html'
-    form_item_template_name = 'leprikon/form_item.html'
-    instructions = ''
-    submit_label = _('Save')
-    success_url = reverse('leprikon:summary')
+    template_name = "leprikon/form.html"
+    form_item_template_name = "leprikon/form_item.html"
+    instructions = ""
+    submit_label = _("Save")
+    success_url = reverse("leprikon:summary")
     message = None
 
     def get_context_data(self, *args, **kwargs):
-        return super(FormViewMixin, self).get_context_data(
+        return super().get_context_data(
             *args,
             form_item_template=self.get_form_item_template_name(),
             instructions=self.get_instructions(),
             submit_label=self.get_submit_label(),
             **kwargs
         )
 
@@ -127,39 +129,39 @@
     def get_success_url(self):
         return self.get_back_url()
 
     def get_message(self):
         return self.message
 
     def form_valid(self, form):
-        response = super(FormViewMixin, self).form_valid(form)
+        response = super().form_valid(form)
         message = self.get_message()
         if message:
             messages.info(
                 self.request,
                 message,
             )
         return response
 
 
 class ConfirmFormViewMixin(FormViewMixin):
     form_class = ConfirmForm
-    template_name = 'leprikon/confirm_form.html'
-    question = ''
-    submit_label = _('Yes')
+    template_name = "leprikon/confirm_form.html"
+    question = ""
+    submit_label = _("Yes")
 
     def get_question(self):
         return self.question
 
     def get_context_data(self, *args, **kwargs):
-        return super(ConfirmFormViewMixin, self).get_context_data(*args, question=self.get_question(), **kwargs)
+        return super().get_context_data(*args, question=self.get_question(), **kwargs)
 
     def form_valid(self, form):
         self.confirmed()
-        return super(ConfirmFormViewMixin, self).form_valid(form)
+        return super().form_valid(form)
 
     def confirmed(self):
         pass
 
 
 class DetailView(GenericViewMixin, _DetailView):
     pass
@@ -178,18 +180,18 @@
 
 
 class ConfirmUpdateView(ConfirmFormViewMixin, _UpdateView):
     pass
 
 
 class DeleteView(ConfirmFormViewMixin, _DeleteView):
-    submit_label = _('Delete')
+    submit_label = _("Delete")
 
     def delete(self, request, *args, **kwargs):
-        response = super(DeleteView, self).delete(request, *args, **kwargs)
+        response = super().delete(request, *args, **kwargs)
         message = self.get_message()
         if message:
             messages.info(
                 self.request,
                 message,
             )
         return response
```

### Comparing `leprikon-3.0.0/leprikon/views/leaders.py` & `leprikon-3.5.0/leprikon/views/leaders.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,26 +1,23 @@
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.leaders import LeaderFilterForm
 from ..models.roles import Leader
 from .generic import FilteredListView
 
 
 class LeaderListView(FilteredListView):
     model = Leader
     form_class = LeaderFilterForm
-    preview_template = 'leprikon/leader_preview.html'
-    template_name = 'leprikon/leader_list.html'
-    message_empty = _('No leaders matching given query.')
+    preview_template = "leprikon/leader_preview.html"
+    template_name = "leprikon/leader_list.html"
+    message_empty = _("No leaders matching given query.")
     paginate_by = 10
 
     def get_title(self):
-        return _('Leaders in school year {}').format(self.request.school_year)
+        return _("Leaders in school year {}").format(self.request.school_year)
 
     def get_form(self):
         return self.form_class(
             school_year=self.request.school_year,
             data=self.request.GET,
         )
-
-    def get_queryset(self):
-        return self.get_form().get_queryset()
```

### Comparing `leprikon-3.0.0/leprikon/views/messages.py` & `leprikon-3.5.0/leprikon/views/messages.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,40 +1,37 @@
 from django.urls import reverse_lazy as reverse
 from django.utils.timezone import now
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.messages import MessageFilterForm
 from ..models.messages import MessageRecipient
 from .generic import BackViewMixin, DetailView, FilteredListView
 
 
 class MessageListView(FilteredListView):
     model = MessageRecipient
     form_class = MessageFilterForm
-    preview_template = 'leprikon/message_preview.html'
-    template_name = 'leprikon/message_list.html'
-    message_empty = _('No messages matching given query.')
+    preview_template = "leprikon/message_preview.html"
+    template_name = "leprikon/message_list.html"
+    message_empty = _("No messages matching given query.")
     paginate_by = 10
 
     def get_title(self):
-        return _('Messages')
+        return _("Messages")
 
     def get_form(self):
         return self.form_class(
             user=self.request.user,
             data=self.request.GET,
         )
 
-    def get_queryset(self):
-        return self.get_form().get_queryset()
-
 
 class MessageDetailView(BackViewMixin, DetailView):
-    back_url = reverse('leprikon:message_list')
+    back_url = reverse("leprikon:message_list")
     model = MessageRecipient
 
     def get_object(self):
-        obj = super(MessageDetailView, self).get_object()
+        obj = super().get_object()
         if obj.viewed is None:
             obj.viewed = now()
             obj.save()
         return obj
```

### Comparing `leprikon-3.0.0/leprikon/views/parents.py` & `leprikon-3.5.0/leprikon/views/parents.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,60 +1,57 @@
 from django.urls import reverse_lazy as reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.parent import ParentForm
 from ..models.roles import Parent
 from .generic import CreateView, DeleteView, UpdateView
 
 
 class ParentCreateView(CreateView):
     model = Parent
     form_class = ParentForm
-    success_url = reverse('leprikon:summary')
-    title = _('New parent')
+    success_url = reverse("leprikon:summary")
+    title = _("New parent")
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['user'] = self.request.user
+        kwargs["user"] = self.request.user
         if self.request.user.leprikon_parents.count() == 0:
-            kwargs['initial'] = dict(
-                (attr, getattr(self.request.user, attr))
-                for attr in ['first_name', 'last_name', 'email']
+            kwargs["initial"] = dict(
+                (attr, getattr(self.request.user, attr)) for attr in ["first_name", "last_name", "email"]
             )
         return kwargs
 
     def get_message(self):
-        return _('New parent {} has been created.').format(self.object)
+        return _("New parent {} has been created.").format(self.object)
 
 
 class ParentUpdateView(UpdateView):
     model = Parent
     form_class = ParentForm
-    success_url = reverse('leprikon:summary')
-    title = _('Change parent')
+    success_url = reverse("leprikon:summary")
+    title = _("Change parent")
 
     def get_queryset(self):
         # only allow to edit user's own parents
         return super().get_queryset().filter(user=self.request.user)
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['user'] = self.request.user
+        kwargs["user"] = self.request.user
         return kwargs
 
     def get_message(self):
-        return _('The parent {} has been updated.').format(self.object)
+        return _("The parent {} has been updated.").format(self.object)
 
 
 class ParentDeleteView(DeleteView):
     model = Parent
-    title = _('Delete information about parent')
-    message = _('Information about parent has been deleted.')
+    title = _("Delete information about parent")
+    message = _("Information about parent has been deleted.")
 
     def get_queryset(self):
         # only allow to delete user's own parents
         return super().get_queryset().filter(user=self.request.user)
 
     def get_question(self):
-        return _('Do You really want to delete the information about parent: {}?').format(
-            self.object
-        )
+        return _("Do You really want to delete the information about parent: {}?").format(self.object)
```

### Comparing `leprikon-3.0.0/leprikon/views/participants.py` & `leprikon-3.5.0/leprikon/views/participants.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,75 +1,73 @@
 from django.urls import reverse_lazy as reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.participant import ParticipantForm
 from ..models.roles import Participant
 from ..utils import reverse_with_back
 from .generic import CreateView, DeleteView, ListView, UpdateView
 
 
 class ParticipantListView(ListView):
-    add_label = _('add participant')
+    add_label = _("add participant")
     model = Participant
-    template_name = 'leprikon/participants.html'
-    preview_template = 'leprikon/participant_preview.html'
+    template_name = "leprikon/participants.html"
+    preview_template = "leprikon/participant_preview.html"
 
     def get_title(self):
-        return _('Participants and parents')
+        return _("Participants and parents")
 
     def get_queryset(self):
         return self.request.user.leprikon_participants.all()
 
     def get_add_url(self):
-        return reverse_with_back(self.request, 'leprikon:participant_create')
+        return reverse_with_back(self.request, "leprikon:participant_create")
 
 
 class ParticipantCreateView(CreateView):
     model = Participant
     form_class = ParticipantForm
-    success_url = reverse('leprikon:summary')
-    title = _('New participant')
+    success_url = reverse("leprikon:summary")
+    title = _("New participant")
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['user'] = self.request.user
+        kwargs["user"] = self.request.user
         parent = self.request.user.leprikon_parents.first()
         if parent:
-            kwargs['initial'] = dict((attr, getattr(parent, attr)) for attr in ['street', 'city', 'postal_code'])
+            kwargs["initial"] = dict((attr, getattr(parent, attr)) for attr in ["street", "city", "postal_code"])
         return kwargs
 
     def get_message(self):
-        return _('New participant {} has been created.').format(self.object)
+        return _("New participant {} has been created.").format(self.object)
 
 
 class ParticipantUpdateView(UpdateView):
     model = Participant
     form_class = ParticipantForm
-    success_url = reverse('leprikon:summary')
-    title = _('Change participant')
+    success_url = reverse("leprikon:summary")
+    title = _("Change participant")
 
     def get_queryset(self):
         # only allow to edit user's own participants
         return super().get_queryset().filter(user=self.request.user)
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['user'] = self.request.user
+        kwargs["user"] = self.request.user
         return kwargs
 
     def get_message(self):
-        return _('The participant {} has been updated.').format(self.object)
+        return _("The participant {} has been updated.").format(self.object)
 
 
 class ParticipantDeleteView(DeleteView):
     model = Participant
-    title = _('Delete information about participant')
-    message = _('Information about participant has been deleted.')
+    title = _("Delete information about participant")
+    message = _("Information about participant has been deleted.")
 
     def get_queryset(self):
         # only allow to delete user's own participants
         return super().get_queryset().filter(user=self.request.user)
 
     def get_question(self):
-        return _('Do You really want to delete the information about participant: {}?').format(
-            self.object
-        )
+        return _("Do You really want to delete the information about participant: {}?").format(self.object)
```

### Comparing `leprikon-3.0.0/leprikon/views/registrationlink.py` & `leprikon-3.5.0/leprikon/views/registrationlink.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,46 +1,44 @@
 from django.shortcuts import get_object_or_404, redirect
 
 from ..models.registrationlink import RegistrationLink
 from ..models.subjects import Subject
-from .subjects import (
-    SubjectListBaseView, SubjectRegistrationFormBaseView, SubjectTypeMixin,
-)
+from .subjects import SubjectListBaseView, SubjectRegistrationFormBaseView, SubjectTypeMixin
 
 
 class RegistrationLinkMixin(SubjectTypeMixin):
     def dispatch(self, request, registration_link, *args, **kwargs):
         self.registration_link = get_object_or_404(RegistrationLink, slug=registration_link)
         self.subject_type = self.registration_link.subject_type
         self.model = self._models[self.subject_type.subject_type]
         return super(SubjectTypeMixin, self).dispatch(request, *args, **kwargs)
 
     def get_placeholder(self):
-        return super().get_placeholder() + ':' + self.subject_type.slug
+        return super().get_placeholder() + ":" + self.subject_type.slug
 
     def get_queryset(self):
-        return super().get_queryset().filter(registration_links=self.registration_link)
+        return super().get_queryset().filter(id__in=self.registration_link.subject_variants.values("subject_id"))
 
     def get_template_names(self):
         return [
-            'leprikon/{}{}.html'.format(self.subject_type.slug, self.template_name_suffix),
-            'leprikon/{}{}.html'.format(self.subject_type.subject_type, self.template_name_suffix),
-            'leprikon/subject{}.html'.format(self.template_name_suffix),
+            "leprikon/{}{}.html".format(self.subject_type.slug, self.template_name_suffix),
+            "leprikon/{}{}.html".format(self.subject_type.subject_type, self.template_name_suffix),
+            "leprikon/subject{}.html".format(self.template_name_suffix),
         ]
 
 
 class RegistrationLinkView(RegistrationLinkMixin, SubjectListBaseView):
     pass
 
 
 class SubjectMixin:
     def dispatch(self, request, pk, **kwargs):
-        lookup_kwargs = {'subject_type_id': self.registration_link.subject_type_id, 'id': int(pk)}
+        lookup_kwargs = {"subject_type_id": self.registration_link.subject_type_id, "id": int(pk)}
         if not self.request.user.is_staff:
-            lookup_kwargs['public'] = True
+            lookup_kwargs["public"] = True
         self.subject = get_object_or_404(Subject, **lookup_kwargs)
         if not self.registration_link.registration_allowed:
             return redirect(self.subject)
         self.request.school_year = self.subject.school_year
         return super().dispatch(request, **kwargs)
```

### Comparing `leprikon-3.0.0/leprikon/views/registrations.py` & `leprikon-3.5.0/leprikon/views/registrations.py`

 * *Files 20% similar despite different names*

```diff
@@ -3,25 +3,25 @@
 from ..models.leprikonsite import LeprikonSite
 from ..models.orderables import OrderableRegistration
 from .generic import TemplateView
 
 
 class RegistrationsListView(TemplateView):
     registrations = True
-    template_name = 'leprikon/registrations.html'
+    template_name = "leprikon/registrations.html"
 
     def get_context_data(self, **kwargs):
-        context = super(RegistrationsListView, self).get_context_data(**kwargs)
-        context['site'] = LeprikonSite.objects.get_current()
-        context['courseregistrations'] = CourseRegistration.objects.filter(
+        context = super().get_context_data(**kwargs)
+        context["site"] = LeprikonSite.objects.get_current()
+        context["courseregistrations"] = CourseRegistration.objects.filter(
             subject__school_year=self.request.school_year,
             user=self.request.user,
         )
-        context['eventregistrations'] = EventRegistration.objects.filter(
+        context["eventregistrations"] = EventRegistration.objects.filter(
             subject__school_year=self.request.school_year,
             user=self.request.user,
         )
-        context['orderableregistrations'] = OrderableRegistration.objects.filter(
+        context["orderableregistrations"] = OrderableRegistration.objects.filter(
             subject__school_year=self.request.school_year,
             user=self.request.user,
         )
         return context
```

### Comparing `leprikon-3.0.0/leprikon/views/reports/__init__.py` & `leprikon-3.5.0/leprikon/views/reports/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,86 +1,82 @@
 from collections import namedtuple
 
 from django.urls import reverse_lazy as reverse
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from ...forms.reports.courses import (
-    CoursePaymentsForm, CoursePaymentsStatusForm, CourseStatsForm,
-)
+from ...forms.reports.courses import CoursePaymentsForm, CoursePaymentsStatusForm, CourseStatsForm
 from ...forms.reports.debtors import DebtorsForm
-from ...forms.reports.events import (
-    EventPaymentsForm, EventPaymentsStatusForm, EventStatsForm,
-)
-from ...forms.reports.orderables import (
-    OrderablePaymentsForm, OrderablePaymentsStatusForm, OrderableStatsForm,
-)
+from ...forms.reports.events import EventPaymentsForm, EventPaymentsStatusForm, EventStatsForm
+from ...forms.reports.orderables import OrderablePaymentsForm, OrderablePaymentsStatusForm, OrderableStatsForm
 from ..generic import TemplateView
 
 
 class ReportsListView(TemplateView):
-    template_name = 'leprikon/reports/index.html'
+    template_name = "leprikon/reports/index.html"
 
-    Report = namedtuple('Report', ('title', 'instructions', 'form', 'url'))
+    Report = namedtuple("Report", ("title", "instructions", "form", "url"))
 
     def get_context_data(self, *args, **kwargs):
-        return super(ReportsListView, self).get_context_data(reports=[
-            self.Report(
-                title=_('Course payments'),
-                instructions='',
-                form=CoursePaymentsForm(),
-                url=reverse('leprikon:report_course_payments'),
-            ),
-            self.Report(
-                title=_('Event payments'),
-                instructions='',
-                form=EventPaymentsForm(),
-                url=reverse('leprikon:report_event_payments'),
-            ),
-            self.Report(
-                title=_('Orderable event payments'),
-                instructions='',
-                form=OrderablePaymentsForm(),
-                url=reverse('leprikon:report_orderable_payments'),
-            ),
-            self.Report(
-                title=_('Course payments status'),
-                instructions='',
-                form=CoursePaymentsStatusForm(),
-                url=reverse('leprikon:report_course_payments_status'),
-            ),
-            self.Report(
-                title=_('Event payments status'),
-                instructions='',
-                form=EventPaymentsStatusForm(),
-                url=reverse('leprikon:report_event_payments_status'),
-            ),
-            self.Report(
-                title=_('Orderable event payments status'),
-                instructions='',
-                form=OrderablePaymentsStatusForm(),
-                url=reverse('leprikon:report_orderable_payments_status'),
-            ),
-            self.Report(
-                title=_('Course statistics'),
-                instructions='',
-                form=CourseStatsForm(school_year=self.request.school_year),
-                url=reverse('leprikon:report_course_stats'),
-            ),
-            self.Report(
-                title=_('Event statistics'),
-                instructions='',
-                form=EventStatsForm(school_year=self.request.school_year),
-                url=reverse('leprikon:report_event_stats'),
-            ),
-            self.Report(
-                title=_('Orderable event statistics'),
-                instructions='',
-                form=OrderableStatsForm(school_year=self.request.school_year),
-                url=reverse('leprikon:report_orderable_stats'),
-            ),
-            self.Report(
-                title=_('Debtors list'),
-                instructions='',
-                form=DebtorsForm(),
-                url=reverse('leprikon:report_debtors'),
-            ),
-        ])
+        return super().get_context_data(
+            reports=[
+                self.Report(
+                    title=_("Course payments"),
+                    instructions="",
+                    form=CoursePaymentsForm(),
+                    url=reverse("leprikon:report_course_payments"),
+                ),
+                self.Report(
+                    title=_("Event payments"),
+                    instructions="",
+                    form=EventPaymentsForm(),
+                    url=reverse("leprikon:report_event_payments"),
+                ),
+                self.Report(
+                    title=_("Orderable event payments"),
+                    instructions="",
+                    form=OrderablePaymentsForm(),
+                    url=reverse("leprikon:report_orderable_payments"),
+                ),
+                self.Report(
+                    title=_("Course payments status"),
+                    instructions="",
+                    form=CoursePaymentsStatusForm(),
+                    url=reverse("leprikon:report_course_payments_status"),
+                ),
+                self.Report(
+                    title=_("Event payments status"),
+                    instructions="",
+                    form=EventPaymentsStatusForm(),
+                    url=reverse("leprikon:report_event_payments_status"),
+                ),
+                self.Report(
+                    title=_("Orderable event payments status"),
+                    instructions="",
+                    form=OrderablePaymentsStatusForm(),
+                    url=reverse("leprikon:report_orderable_payments_status"),
+                ),
+                self.Report(
+                    title=_("Course statistics"),
+                    instructions="",
+                    form=CourseStatsForm(school_year=self.request.school_year),
+                    url=reverse("leprikon:report_course_stats"),
+                ),
+                self.Report(
+                    title=_("Event statistics"),
+                    instructions="",
+                    form=EventStatsForm(school_year=self.request.school_year),
+                    url=reverse("leprikon:report_event_stats"),
+                ),
+                self.Report(
+                    title=_("Orderable event statistics"),
+                    instructions="",
+                    form=OrderableStatsForm(school_year=self.request.school_year),
+                    url=reverse("leprikon:report_orderable_stats"),
+                ),
+                self.Report(
+                    title=_("Debtors list"),
+                    instructions="",
+                    form=DebtorsForm(),
+                    url=reverse("leprikon:report_debtors"),
+                ),
+            ]
+        )
```

### Comparing `leprikon-3.0.0/leprikon/views/reports/courses.py` & `leprikon-3.5.0/leprikon/views/reports/events.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,150 +1,187 @@
 from collections import namedtuple
+from functools import lru_cache
 
 from django.db.models import Sum
 from django.template.response import TemplateResponse
 from django.urls import reverse_lazy as reverse
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from ...forms.reports.courses import (
-    CoursePaymentsForm, CoursePaymentsStatusForm, CourseStatsForm,
-)
+from ...forms.reports.events import EventPaymentsForm, EventPaymentsStatusForm, EventStatsForm
 from ...models.agegroup import AgeGroup
 from ...models.citizenship import Citizenship
-from ...models.courses import Course, CourseRegistration
+from ...models.events import Event, EventRegistration
 from ...models.roles import Participant
-from ...models.subjects import (
-    SubjectPayment, SubjectRegistrationParticipant, SubjectType,
-)
+from ...models.subjects import SubjectPayment, SubjectRegistrationParticipant, SubjectType
 from ...views.generic import FormView
 
 
-class ReportCoursePaymentsView(FormView):
-    form_class = CoursePaymentsForm
-    template_name = 'leprikon/reports/course_payments.html'
-    title = _('Course payments')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+class ReportEventPaymentsView(FormView):
+    form_class = EventPaymentsForm
+    template_name = "leprikon/reports/event_payments.html"
+    title = _("Event payments")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
     def form_valid(self, form):
         context = form.cleaned_data
-        context['form'] = form
-        context['payments'] = SubjectPayment.objects.filter(
-            registration__subject__subject_type__subject_type=SubjectType.COURSE,
-            accounted__gte=context['date_start'],
-            accounted__lte=context['date_end'],
+        context["form"] = form
+        context["received_payments"] = SubjectPayment.objects.filter(
+            target_registration__subject__subject_type__subject_type=SubjectType.EVENT,
+            accounted__gte=context["date_start"],
+            accounted__lte=context["date_end"],
         )
-        context['sum'] = context['payments'].aggregate(Sum('amount'))['amount__sum']
+        context["returned_payments"] = SubjectPayment.objects.filter(
+            source_registration__subject__subject_type__subject_type=SubjectType.EVENT,
+            accounted__gte=context["date_start"],
+            accounted__lte=context["date_end"],
+        )
+        context["received_payments_sum"] = context["received_payments"].aggregate(sum=Sum("amount"))["sum"] or 0
+        context["returned_payments_sum"] = context["returned_payments"].aggregate(sum=Sum("amount"))["sum"] or 0
+        context["sum"] = context["received_payments_sum"] - context["returned_payments_sum"]
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
 
-class ReportCoursePaymentsStatusView(FormView):
-    form_class = CoursePaymentsStatusForm
-    template_name = 'leprikon/reports/course_payments_status.html'
-    title = _('Course payments status')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+class ReportEventPaymentsStatusView(FormView):
+    form_class = EventPaymentsStatusForm
+    template_name = "leprikon/reports/event_payments_status.html"
+    title = _("Event payments status")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
-    CoursePaymentsStatusSums = namedtuple('CoursePaymentsStatusSums', ('registrations', 'status'))
+    EventPaymentsStatusSums = namedtuple("EventPaymentsStatusSums", ("registrations", "status"))
 
     def form_valid(self, form):
         context = form.cleaned_data
-        context['form'] = form
-        context['reports'] = [
-            self.Report(course, context['date'])
-            for course in Course.objects.filter(school_year=self.request.school_year)
+        context["form"] = form
+        context["reports"] = [
+            self.Report(event, context["date"]) for event in Event.objects.filter(school_year=self.request.school_year)
         ]
-        context['sum'] = self.CoursePaymentsStatusSums(
-            registrations=sum(len(r.registration_statuses) for r in context['reports']),
-            status=sum(r.status for r in context['reports']),
+        context["sum"] = self.EventPaymentsStatusSums(
+            registrations=sum(len(r.registration_statuses) for r in context["reports"]),
+            status=sum(r.status for r in context["reports"]),
         )
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
     class Report:
-        def __init__(self, course, d):
-            self.course = course
+        def __init__(self, event, d):
+            self.event = event
             self.date = d
 
-        RegPaymentStatus = namedtuple('RegPaymentStatus', ('registration', 'status'))
+        RegPaymentStatus = namedtuple("RegPaymentStatus", ("registration", "status"))
 
         @cached_property
         def registration_statuses(self):
             return [
-                registration_status for registration_status in (
+                registration_status
+                for registration_status in (
                     self.RegPaymentStatus(
                         registration=registration,
                         status=registration.get_payment_status(self.date),
                     )
-                    for registration in CourseRegistration.objects.filter(
-                        subject=self.course,
+                    for registration in EventRegistration.objects.filter(
+                        subject=self.event,
                         approved__date__lte=self.date,
                     )
-                ) if registration_status.status.receivable
+                )
+                if registration_status.status.receivable
             ]
 
         @cached_property
         def status(self):
             return sum(rs.status for rs in self.registration_statuses)
 
 
-class ReportCourseStatsView(FormView):
-    form_class = CourseStatsForm
-    template_name = 'leprikon/reports/course_stats.html'
-    title = _('Course statistics')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
-
-    ReportItem = namedtuple('ReportItem', ('age_group', 'all', 'boys', 'girls', 'citizenships'))
+class ReportEventStatsView(FormView):
+    form_class = EventStatsForm
+    template_name = "leprikon/reports/event_stats.html"
+    title = _("Event statistics")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
+
+    ReportItem = namedtuple("ReportItem", ("age_group", "all", "boys", "girls", "citizenships"))
+
+    @lru_cache
+    def get_event_days(self, event_id):
+        event = Event.objects.get(id=event_id)
+        return (event.end_date - event.start_date).days + 1
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['school_year'] = self.request.school_year
+        kwargs["school_year"] = self.request.school_year
         return kwargs
 
     def form_valid(self, form):
-        d = form.cleaned_data['date']
-        paid_only = form.cleaned_data['paid_only']
+        d = form.cleaned_data["date"]
+        paid_only = form.cleaned_data["paid_only"]
+        paid_later = form.cleaned_data["paid_later"]
+        approved_later = form.cleaned_data["approved_later"]
+        unique_participants = form.cleaned_data["unique_participants"]
+        min_days = form.cleaned_data["min_days"]
         context = form.cleaned_data
-        context['form'] = form
+        context["form"] = form
 
-        participants = SubjectRegistrationParticipant.objects.filter(
-            registration__subject__in=form.cleaned_data['courses'],
-            registration__approved__date__lte=d,
-        ).exclude(registration__canceled__date__lte=d).select_related('registration', 'age_group')
+        if approved_later:
+            # approved registrations created by the date
+            participants = SubjectRegistrationParticipant.objects.filter(
+                registration__created__date__lte=d,
+                registration__approved__isnull=False,
+            )
+        else:
+            # registrations approved by the date
+            participants = SubjectRegistrationParticipant.objects.filter(
+                registration__approved__date__lte=d,
+            )
+        participants = (
+            participants.filter(
+                registration__subject__in=form.cleaned_data["events"],
+            )
+            .exclude(registration__canceled__date__lte=d)
+            .select_related("registration", "age_group")
+        )
         if paid_only:
+            paid_date = None if paid_later else d
             participants = [
-                participant for participant in participants
-                if participant.registration.courseregistration.get_payment_status(d).amount_due == 0
+                participant
+                for participant in participants
+                if participant.registration.eventregistration.get_payment_status(paid_date).balance >= 0
             ]
         else:
             participants = list(participants)
-        context['courses_count'] = len(set(participant.registration.subject_id for participant in participants))
+
+        if min_days:
+            participants = [p for p in participants if self.get_event_days(p.registration.subject_id) >= min_days]
+
+        context["events_count"] = len(set(participant.registration.subject_id for participant in participants))
+
+        if unique_participants:
+            participants = list({p.key: p for p in participants}.values())
 
         citizenships = list(Citizenship.objects.all())
-        context['citizenships'] = citizenships
+        context["citizenships"] = citizenships
 
-        context['participants_counts'] = self.ReportItem(
+        context["participants_counts"] = self.ReportItem(
             age_group=None,
             all=len(participants),
             boys=len([p for p in participants if p.gender == Participant.MALE]),
             girls=len([p for p in participants if p.gender == Participant.FEMALE]),
             citizenships=[
-                len([p for p in participants if p.citizenship_id == citizenship.id])
-                for citizenship in citizenships
-            ]
+                len([p for p in participants if p.citizenship_id == citizenship.id]) for citizenship in citizenships
+            ],
         )
-        context['participants_counts_by_age_groups'] = []
+        context["participants_counts_by_age_groups"] = []
         for age_group in AgeGroup.objects.all():
             parts = [p for p in participants if p.age_group == age_group]
-            context['participants_counts_by_age_groups'].append(self.ReportItem(
-                age_group=age_group,
-                all=len(parts),
-                boys=len([p for p in parts if p.gender == Participant.MALE]),
-                girls=len([p for p in parts if p.gender == Participant.FEMALE]),
-                citizenships=[
-                    len([p for p in parts if p.citizenship_id == citizenship.id])
-                    for citizenship in citizenships
-                ]
-            ))
+            context["participants_counts_by_age_groups"].append(
+                self.ReportItem(
+                    age_group=age_group,
+                    all=len(parts),
+                    boys=len([p for p in parts if p.gender == Participant.MALE]),
+                    girls=len([p for p in parts if p.gender == Participant.FEMALE]),
+                    citizenships=[
+                        len([p for p in parts if p.citizenship_id == citizenship.id]) for citizenship in citizenships
+                    ],
+                )
+            )
 
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
```

### Comparing `leprikon-3.0.0/leprikon/views/reports/debtors.py` & `leprikon-3.5.0/leprikon/views/reports/debtors.py`

 * *Files 9% similar despite different names*

```diff
@@ -1,59 +1,59 @@
 from collections import namedtuple
 from itertools import chain
 
 from django.template.response import TemplateResponse
 from django.urls import reverse_lazy as reverse
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ...forms.reports.debtors import DebtorsForm
 from ...models.courses import CourseRegistration
 from ...models.events import EventRegistration
 from ...models.orderables import OrderableRegistration
 from ...views.generic import FormView
 
 
 class ReportDebtorsView(FormView):
     form_class = DebtorsForm
-    template_name = 'leprikon/reports/debtors.html'
-    title = _('Debtors list')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+    template_name = "leprikon/reports/debtors.html"
+    title = _("Debtors list")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
-    ReportItem = namedtuple('ReportItem', ('registration', 'status'))
+    ReportItem = namedtuple("ReportItem", ("registration", "status"))
 
     class Report(list):
         @cached_property
         def sum(self):
             return sum(item.status for item in self)
 
     def form_valid(self, form):
         context = form.cleaned_data
-        context['form'] = form
-        context['reports'] = {}
-        context['sum'] = 0
+        context["form"] = form
+        context["reports"] = {}
+        context["sum"] = 0
 
         for reg in chain.from_iterable(
             qs.filter(
                 subject__school_year=self.request.school_year,
-                approved__date__lte=context['date'],
-            ).prefetch_related(
-                'discounts',
-                'payments',
-            ).select_related('user')
+                approved__date__lte=context["date"],
+            )
+            .prefetch_related(
+                "discounts",
+                "received_payments",
+                "returned_payments",
+            )
+            .select_related("user")
             for qs in (
-                CourseRegistration.objects.prefetch_related('course_registration_periods'),
+                CourseRegistration.objects.prefetch_related("course_registration_periods"),
                 EventRegistration.objects,
                 OrderableRegistration.objects,
             )
         ):
-            status = reg.get_payment_status(context['date'])
+            status = reg.get_payment_status(context["date"])
             if status.amount_due:
-                report = context['reports'].setdefault(reg.user, self.Report())
+                report = context["reports"].setdefault(reg.user, self.Report())
                 report.append(self.ReportItem(registration=reg, status=status))
-        context['sum'] = sum(
-            report.sum
-            for report in context['reports'].values()
-        )
+        context["sum"] = sum(report.sum for report in context["reports"].values())
 
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
```

### Comparing `leprikon-3.0.0/leprikon/views/reports/events.py` & `leprikon-3.5.0/leprikon/admin/refundrequest.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,150 +1,177 @@
-from collections import namedtuple
+from datetime import date
+from random import randrange
 
-from django.db.models import Sum
-from django.template.response import TemplateResponse
-from django.urls import reverse_lazy as reverse
-from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
-
-from ...forms.reports.events import (
-    EventPaymentsForm, EventPaymentsStatusForm, EventStatsForm,
-)
-from ...models.agegroup import AgeGroup
-from ...models.citizenship import Citizenship
-from ...models.events import Event, EventRegistration
-from ...models.roles import Participant
-from ...models.subjects import (
-    SubjectPayment, SubjectRegistrationParticipant, SubjectType,
-)
-from ...views.generic import FormView
-
-
-class ReportEventPaymentsView(FormView):
-    form_class = EventPaymentsForm
-    template_name = 'leprikon/reports/event_payments.html'
-    title = _('Event payments')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
-
-    def form_valid(self, form):
-        context = form.cleaned_data
-        context['form'] = form
-        context['payments'] = SubjectPayment.objects.filter(
-            registration__subject__subject_type__subject_type=SubjectType.EVENT,
-            accounted__gte=context['date_start'],
-            accounted__lte=context['date_end'],
+from bankreader.models import Account
+from django import forms
+from django.contrib import admin
+from django.http import HttpResponse
+from django.shortcuts import render
+from django.utils.html import format_html
+from django.utils.safestring import mark_safe
+from django.utils.translation import gettext_lazy as _
+
+from ..models.leprikonsite import LeprikonSite
+from ..models.refundrequest import RefundRequest
+from ..models.utils import BankAccount
+from ..utils import amount_color, ascii, attributes, currency
+from .export import AdminExportMixin
+from .filters import SchoolYearListFilter, SubjectListFilter, SubjectTypeListFilter
+from .utils import datetime_with_by
+
+
+@admin.register(RefundRequest)
+class RefundRequestAdmin(AdminExportMixin, admin.ModelAdmin):
+    actions = AdminExportMixin.actions + ("export_as_abo",)
+    date_hierarchy = "requested"
+    ordering = ("-requested",)
+    list_display = (
+        "id",
+        "requested_with_by",
+        "registration",
+        "amount_html",
+        "bank_account",
+    )
+    list_export = (
+        "id",
+        "requested",
+        "requested_by",
+        "registration",
+        "registration__variable_symbol",
+        "amount",
+        "bank_account",
+        "iban",
+        "bic",
+    )
+    list_filter = (
+        ("registration__subject__school_year", SchoolYearListFilter),
+        "registration__subject__department",
+        "registration__subject__organization",
+        ("registration__subject__subject_type", SubjectTypeListFilter),
+        ("registration__subject", SubjectListFilter),
+    )
+    search_fields = (
+        "registration__variable_symbol",
+        "registration__subject__name",
+        "registration__participants__first_name",
+        "registration__participants__last_name",
+        "registration__participants__birth_num",
+    )
+    raw_id_fields = ("registration",)
+
+    @attributes(short_description=_("IBAN"))
+    def iban(self, obj):
+        return obj.bank_account.compact
+
+    @attributes(short_description=_("BIC (SWIFT)"))
+    def bic(self, obj):
+        return obj.bank_account.bic
+
+    @attributes(admin_order_field="amount", short_description=_("amount"))
+    def amount_html(self, obj):
+        return mark_safe(
+            format_html(
+                '<b style="color: {color}">{amount}</b>',
+                color=amount_color(obj.amount),
+                amount=currency(abs(obj.amount)),
+            )
         )
-        context['sum'] = context['payments'].aggregate(Sum('amount'))['amount__sum']
-        return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
+    requested_with_by = datetime_with_by("requested", _("requested time"))
 
-class ReportEventPaymentsStatusView(FormView):
-    form_class = EventPaymentsStatusForm
-    template_name = 'leprikon/reports/event_payments_status.html'
-    title = _('Event payments status')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
-
-    EventPaymentsStatusSums = namedtuple('EventPaymentsStatusSums', ('registrations', 'status'))
-
-    def form_valid(self, form):
-        context = form.cleaned_data
-        context['form'] = form
-        context['reports'] = [
-            self.Report(event, context['date'])
-            for event in Event.objects.filter(school_year=self.request.school_year)
-        ]
-        context['sum'] = self.EventPaymentsStatusSums(
-            registrations=sum(len(r.registration_statuses) for r in context['reports']),
-            status=sum(r.status for r in context['reports']),
+    def save_model(self, request, obj, form, change):
+        if not change:
+            obj.requested_by = request.user
+        super().save_model(request, obj, form, change)
+
+    @attributes(short_description=_("Export selected records as ABO"))
+    def export_as_abo(self, request, queryset):
+        class AccountForm(forms.Form):
+            account = forms.ModelChoiceField(label=Account._meta.verbose_name, queryset=Account.objects.all())
+            constant_symbol = forms.IntegerField(label=_("Constant symbol"), max_value=9999, required=False)
+            message = forms.CharField(label=_("Message for recipient"), max_length=35, required=False)
+
+        if request.POST.get("post", "no") == "yes":
+            form = AccountForm(request.POST)
+            if form.is_valid():
+                return self._export_as_abo(
+                    queryset,
+                    BankAccount(form.cleaned_data["account"].iban),
+                    form.cleaned_data["constant_symbol"] or 0,
+                    form.cleaned_data["message"] or "",
+                )
+        else:
+            form = AccountForm()
+
+        adminform = admin.helpers.AdminForm(
+            form,
+            [(None, {"fields": list(form.base_fields)})],
+            {},
+            None,
+            model_admin=self,
         )
-        return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
-    class Report:
-        def __init__(self, event, d):
-            self.event = event
-            self.date = d
-
-        RegPaymentStatus = namedtuple('RegPaymentStatus', ('registration', 'status'))
-
-        @cached_property
-        def registration_statuses(self):
-            return [
-                registration_status for registration_status in (
-                    self.RegPaymentStatus(
-                        registration=registration,
-                        status=registration.get_payment_status(self.date),
-                    )
-                    for registration in EventRegistration.objects.filter(
-                        subject=self.event,
-                        approved__date__lte=self.date,
+        return render(
+            request,
+            "leprikon/admin/action_form.html",
+            dict(
+                title=_("Export setup"),
+                opts=self.model._meta,
+                adminform=adminform,
+                media=self.media + adminform.media,
+                action="export_as_abo",
+                action_checkbox_name=admin.helpers.ACTION_CHECKBOX_NAME,
+                select_across=request.POST["select_across"],
+                selected=request.POST.getlist(admin.helpers.ACTION_CHECKBOX_NAME),
+            ),
+        )
+
+    def _export_as_abo(self, queryset, bank_account: BankAccount, constant_symbol: int, message: str):
+        batch_id = randrange(1, 1000)
+
+        refund_requests: list[RefundRequest] = list(queryset)
+        today = f"{date.today():%d%m%y}"
+        message = ascii(message)
+        site_name = ascii(LeprikonSite.objects.get_current().name)
+        sum_amount = sum(rr.amount for rr in refund_requests if rr.amount)
+        amount_cents = round(sum_amount * 100)
+
+        response = HttpResponse(content_type="text/abo; charset=ascii")
+        response[
+            "Content-Disposition"
+        ] = f'attachment; filename="{ascii(str(self.model._meta.verbose_name))} {today} {batch_id}.abo"'
+
+        lines = []
+
+        # write header
+
+        # header, date, customer name, customer number, batch number range, unused
+        lines.append(f"UHL1{today}{site_name[:20].ljust(20)}0000000000001999000000000000")
+        lines.append(f"1 1501 {batch_id:03}000 {bank_account.bank_code}")
+        lines.append(f"2 {str(bank_account).split('/')[0]} {amount_cents} {today}")
+
+        # write records
+
+        for refund_request in refund_requests:
+            if refund_request.amount:
+                lines.append(
+                    " ".join(
+                        [
+                            str(refund_request.bank_account).split("/")[0],
+                            str(round(refund_request.amount * 100)),
+                            str(refund_request.registration.variable_symbol),
+                            f"{refund_request.bank_account.bank_code}{constant_symbol:04}",
+                            "0",  # specific symbol
+                            f"AV:{site_name[:35]}|{message[:35]}",
+                        ]
                     )
-                ) if registration_status.status.receivable
-            ]
+                )
 
-        @cached_property
-        def status(self):
-            return sum(rs.status for rs in self.registration_statuses)
-
-
-class ReportEventStatsView(FormView):
-    form_class = EventStatsForm
-    template_name = 'leprikon/reports/event_stats.html'
-    title = _('Event statistics')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
-
-    ReportItem = namedtuple('ReportItem', ('age_group', 'all', 'boys', 'girls', 'citizenships'))
-
-    def get_form_kwargs(self):
-        kwargs = super().get_form_kwargs()
-        kwargs['school_year'] = self.request.school_year
-        return kwargs
-
-    def form_valid(self, form):
-        d = form.cleaned_data['date']
-        paid_only = form.cleaned_data['paid_only']
-        context = form.cleaned_data
-        context['form'] = form
-
-        participants = SubjectRegistrationParticipant.objects.filter(
-            registration__subject__in=form.cleaned_data['events'],
-            registration__approved__date__lte=d,
-        ).exclude(registration__canceled__date__lte=d).select_related('registration', 'age_group')
-        if paid_only:
-            participants = [
-                participant for participant in participants
-                if participant.registration.eventregistration.get_payment_status(d).balance >= 0
-            ]
-        else:
-            participants = list(participants)
-        context['events_count'] = len(set(participant.registration.subject_id for participant in participants))
+        # write footer
 
-        citizenships = list(Citizenship.objects.all())
-        context['citizenships'] = citizenships
+        lines.append("3 +")
+        lines.append("5 +")
+        lines.append("")
 
-        context['participants_counts'] = self.ReportItem(
-            age_group=None,
-            all=len(participants),
-            boys=len([p for p in participants if p.gender == Participant.MALE]),
-            girls=len([p for p in participants if p.gender == Participant.FEMALE]),
-            citizenships=[
-                len([p for p in participants if p.citizenship_id == citizenship.id])
-                for citizenship in citizenships
-            ]
-        )
-        context['participants_counts_by_age_groups'] = []
-        for age_group in AgeGroup.objects.all():
-            parts = [p for p in participants if p.age_group == age_group]
-            context['participants_counts_by_age_groups'].append(self.ReportItem(
-                age_group=age_group,
-                all=len(parts),
-                boys=len([p for p in parts if p.gender == Participant.MALE]),
-                girls=len([p for p in parts if p.gender == Participant.FEMALE]),
-                citizenships=[
-                    len([p for p in parts if p.citizenship_id == citizenship.id])
-                    for citizenship in citizenships
-                ]
-            ))
+        response.write("\r\n".join(lines).encode("ascii", errors="ignore"))
 
-        return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
+        return response
```

### Comparing `leprikon-3.0.0/leprikon/views/reports/orderables.py` & `leprikon-3.5.0/leprikon/views/reports/orderables.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,150 +1,188 @@
 from collections import namedtuple
+from functools import lru_cache
 
 from django.db.models import Sum
 from django.template.response import TemplateResponse
 from django.urls import reverse_lazy as reverse
 from django.utils.functional import cached_property
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
-from ...forms.reports.orderables import (
-    OrderablePaymentsForm, OrderablePaymentsStatusForm, OrderableStatsForm,
-)
+from ...forms.reports.orderables import OrderablePaymentsForm, OrderablePaymentsStatusForm, OrderableStatsForm
 from ...models.agegroup import AgeGroup
 from ...models.citizenship import Citizenship
 from ...models.orderables import Orderable, OrderableRegistration
 from ...models.roles import Participant
-from ...models.subjects import (
-    SubjectPayment, SubjectRegistrationParticipant, SubjectType,
-)
+from ...models.subjects import SubjectPayment, SubjectRegistrationParticipant, SubjectType
 from ...views.generic import FormView
 
 
 class ReportOrderablePaymentsView(FormView):
     form_class = OrderablePaymentsForm
-    template_name = 'leprikon/reports/orderable_payments.html'
-    title = _('Orderable payments')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+    template_name = "leprikon/reports/orderable_payments.html"
+    title = _("Orderable payments")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
     def form_valid(self, form):
         context = form.cleaned_data
-        context['form'] = form
-        context['payments'] = SubjectPayment.objects.filter(
-            registration__subject__subject_type__subject_type=SubjectType.ORDERABLE,
-            accounted__gte=context['date_start'],
-            accounted__lte=context['date_end'],
+        context["form"] = form
+        context["received_payments"] = SubjectPayment.objects.filter(
+            target_registration__subject__subject_type__subject_type=SubjectType.ORDERABLE,
+            accounted__gte=context["date_start"],
+            accounted__lte=context["date_end"],
         )
-        context['sum'] = context['payments'].aggregate(Sum('amount'))['amount__sum']
+        context["returned_payments"] = SubjectPayment.objects.filter(
+            source_registration__subject__subject_type__subject_type=SubjectType.ORDERABLE,
+            accounted__gte=context["date_start"],
+            accounted__lte=context["date_end"],
+        )
+        context["received_payments_sum"] = context["received_payments"].aggregate(sum=Sum("amount"))["sum"] or 0
+        context["returned_payments_sum"] = context["returned_payments"].aggregate(sum=Sum("amount"))["sum"] or 0
+        context["sum"] = context["received_payments_sum"] - context["returned_payments_sum"]
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
 
 class ReportOrderablePaymentsStatusView(FormView):
     form_class = OrderablePaymentsStatusForm
-    template_name = 'leprikon/reports/orderable_payments_status.html'
-    title = _('Orderable event payments status')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+    template_name = "leprikon/reports/orderable_payments_status.html"
+    title = _("Orderable event payments status")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
-    OrderablePaymentsStatusSums = namedtuple('OrderablePaymentsStatusSums', ('registrations', 'status'))
+    OrderablePaymentsStatusSums = namedtuple("OrderablePaymentsStatusSums", ("registrations", "status"))
 
     def form_valid(self, form):
         context = form.cleaned_data
-        context['form'] = form
-        context['reports'] = [
-            self.Report(orderable, context['date'])
+        context["form"] = form
+        context["reports"] = [
+            self.Report(orderable, context["date"])
             for orderable in Orderable.objects.filter(school_year=self.request.school_year)
         ]
-        context['sum'] = self.OrderablePaymentsStatusSums(
-            registrations=sum(len(r.registration_statuses) for r in context['reports']),
-            status=sum(r.status for r in context['reports']),
+        context["sum"] = self.OrderablePaymentsStatusSums(
+            registrations=sum(len(r.registration_statuses) for r in context["reports"]),
+            status=sum(r.status for r in context["reports"]),
         )
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
 
     class Report:
         def __init__(self, orderable, d):
             self.orderable = orderable
             self.date = d
 
-        RegPaymentStatus = namedtuple('RegPaymentStatus', ('registration', 'status'))
+        RegPaymentStatus = namedtuple("RegPaymentStatus", ("registration", "status"))
 
         @cached_property
         def registration_statuses(self):
             return [
-                registration_status for registration_status in (
+                registration_status
+                for registration_status in (
                     self.RegPaymentStatus(
                         registration=registration,
                         status=registration.get_payment_status(self.date),
                     )
                     for registration in OrderableRegistration.objects.filter(
                         subject=self.orderable,
                         approved__date__lte=self.date,
                     )
-                ) if registration_status.status.receivable
+                )
+                if registration_status.status.receivable
             ]
 
         @cached_property
         def status(self):
             return sum(rs.status for rs in self.registration_statuses)
 
 
 class ReportOrderableStatsView(FormView):
     form_class = OrderableStatsForm
-    template_name = 'leprikon/reports/orderable_stats.html'
-    title = _('Orderable statistics')
-    submit_label = _('Show')
-    back_url = reverse('leprikon:report_list')
+    template_name = "leprikon/reports/orderable_stats.html"
+    title = _("Orderable statistics")
+    submit_label = _("Show")
+    back_url = reverse("leprikon:report_list")
 
-    ReportItem = namedtuple('ReportItem', ('age_group', 'all', 'boys', 'girls', 'citizenships'))
+    ReportItem = namedtuple("ReportItem", ("age_group", "all", "boys", "girls", "citizenships"))
 
     def get_form_kwargs(self):
         kwargs = super().get_form_kwargs()
-        kwargs['school_year'] = self.request.school_year
+        kwargs["school_year"] = self.request.school_year
         return kwargs
 
+    @lru_cache
+    def get_orderable_days(self, orderable_id):
+        orderable = Orderable.objects.get(id=orderable_id)
+        return orderable.duration.days + 1
+
     def form_valid(self, form):
-        d = form.cleaned_data['date']
-        paid_only = form.cleaned_data['paid_only']
+        d = form.cleaned_data["date"]
+        paid_only = form.cleaned_data["paid_only"]
+        paid_later = form.cleaned_data["paid_later"]
+        approved_later = form.cleaned_data["approved_later"]
+        unique_participants = form.cleaned_data["unique_participants"]
+        min_days = form.cleaned_data["min_days"]
         context = form.cleaned_data
-        context['form'] = form
+        context["form"] = form
 
-        participants = SubjectRegistrationParticipant.objects.filter(
-            registration__subject__in=form.cleaned_data['orderables'],
-            registration__approved__date__lte=d,
-        ).exclude(registration__canceled__date__lte=d).select_related('registration', 'age_group')
+        if approved_later:
+            # approved registrations created by the date
+            participants = SubjectRegistrationParticipant.objects.filter(
+                registration__created__date__lte=d,
+                registration__approved__isnull=False,
+            )
+        else:
+            # registrations approved by the date
+            participants = SubjectRegistrationParticipant.objects.filter(
+                registration__approved__date__lte=d,
+            )
+        participants = (
+            participants.filter(
+                registration__subject__in=form.cleaned_data["orderables"],
+            )
+            .exclude(registration__canceled__date__lte=d)
+            .select_related("registration", "age_group")
+        )
         if paid_only:
+            paid_date = None if paid_later else d
             participants = [
-                participant for participant in participants
-                if participant.registration.orderableregistration.get_payment_status(d).balance >= 0
+                participant
+                for participant in participants
+                if participant.registration.orderableregistration.get_payment_status(paid_date).balance >= 0
             ]
         else:
             participants = list(participants)
-        context['orderables_count'] = len(set(participant.registration.subject_id for participant in participants))
+
+        if min_days:
+            participants = [p for p in participants if self.get_orderable_days(p.registration.subject_id) >= min_days]
+
+        context["orderables_count"] = len(set(participant.registration.subject_id for participant in participants))
+
+        if unique_participants:
+            participants = list({p.key: p for p in participants}.values())
 
         citizenships = list(Citizenship.objects.all())
-        context['citizenships'] = citizenships
+        context["citizenships"] = citizenships
 
-        context['participants_counts'] = self.ReportItem(
+        context["participants_counts"] = self.ReportItem(
             age_group=None,
             all=len(participants),
             boys=len([p for p in participants if p.gender == Participant.MALE]),
             girls=len([p for p in participants if p.gender == Participant.FEMALE]),
             citizenships=[
-                len([p for p in participants if p.citizenship_id == citizenship.id])
-                for citizenship in citizenships
-            ]
+                len([p for p in participants if p.citizenship_id == citizenship.id]) for citizenship in citizenships
+            ],
         )
-        context['participants_counts_by_age_groups'] = []
+        context["participants_counts_by_age_groups"] = []
         for age_group in AgeGroup.objects.all():
             parts = [p for p in participants if p.age_group == age_group]
-            context['participants_counts_by_age_groups'].append(self.ReportItem(
-                age_group=age_group,
-                all=len(parts),
-                boys=len([p for p in parts if p.gender == Participant.MALE]),
-                girls=len([p for p in parts if p.gender == Participant.FEMALE]),
-                citizenships=[
-                    len([p for p in parts if p.citizenship_id == citizenship.id])
-                    for citizenship in citizenships
-                ]
-            ))
+            context["participants_counts_by_age_groups"].append(
+                self.ReportItem(
+                    age_group=age_group,
+                    all=len(parts),
+                    boys=len([p for p in parts if p.gender == Participant.MALE]),
+                    girls=len([p for p in parts if p.gender == Participant.FEMALE]),
+                    citizenships=[
+                        len([p for p in parts if p.citizenship_id == citizenship.id]) for citizenship in citizenships
+                    ],
+                )
+            )
 
         return TemplateResponse(self.request, self.template_name, self.get_context_data(**context))
```

### Comparing `leprikon-3.0.0/leprikon/views/schoolyear.py` & `leprikon-3.5.0/leprikon/views/schoolyear.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,21 +1,21 @@
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.schoolyear import SchoolYearForm
 from .generic import FormView
 
 
 class SchoolYearView(FormView):
     form_class = SchoolYearForm
-    title = _('Switch school year')
+    title = _("Switch school year")
 
     def get_message(self):
-        return _('You now work with school year {}.').format(self.request.school_year)
+        return _("You now work with school year {}.").format(self.request.school_year)
 
     def get_form_kwargs(self):
-        kwargs = super(SchoolYearView, self).get_form_kwargs()
-        kwargs['request'] = self.request
+        kwargs = super().get_form_kwargs()
+        kwargs["request"] = self.request
         return kwargs
 
     def form_valid(self, form):
-        self.request.school_year = form.cleaned_data['school_year']
-        return super(SchoolYearView, self).form_valid(form)
+        self.request.school_year = form.cleaned_data["school_year"]
+        return super().form_valid(form)
```

### Comparing `leprikon-3.0.0/leprikon/views/subjects.py` & `leprikon-3.5.0/leprikon/views/subjects.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,31 +1,41 @@
+from typing import List, Optional
+
 from cms.views import details as cms_view_details
 from django.core.exceptions import PermissionDenied
-from django.db.models import F
+from django.db.models import F, Q
+from django.forms import Form
 from django.http import HttpResponse
 from django.shortcuts import get_object_or_404, redirect
 from django.urls import reverse_lazy as reverse
 from django.utils.timezone import now
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.subjects import (
-    CourseRegistrationForm, EventRegistrationForm, OrderableRegistrationForm,
-    SubjectFilterForm, SubjectForm,
+    CourseRegistrationForm,
+    EventRegistrationForm,
+    OrderableRegistrationForm,
+    SubjectFilterForm,
+    SubjectForm,
 )
 from ..models.courses import Course
 from ..models.events import Event
-from ..models.leprikonsite import LeprikonSite
 from ..models.orderables import Orderable
+from ..models.registrationlink import RegistrationLink
 from ..models.subjects import (
-    Subject, SubjectPayment, SubjectRegistration, SubjectType,
-)
-from .generic import (
-    ConfirmUpdateView, CreateView, DetailView, FilteredListView, ListView,
-    UpdateView,
+    Subject,
+    SubjectPayment,
+    SubjectReceivedPayment,
+    SubjectRegistration,
+    SubjectReturnedPayment,
+    SubjectType,
+    SubjectVariant,
 )
+from ..utils import reverse_with_back
+from .generic import ConfirmUpdateView, CreateView, DetailView, FilteredListView, ListView, UpdateView
 
 
 class SubjectTypeMixin:
     _models = {
         SubjectType.COURSE: Course,
         SubjectType.EVENT: Event,
         SubjectType.ORDERABLE: Orderable,
@@ -33,264 +43,329 @@
 
     def dispatch(self, request, subject_type, *args, **kwargs):
         self.subject_type = get_object_or_404(SubjectType, slug=subject_type)
         self.model = self._models[self.subject_type.subject_type]
         return super().dispatch(request, *args, **kwargs)
 
     def get_placeholder(self):
-        return super().get_placeholder() + ':' + self.subject_type.slug
+        return super().get_placeholder() + ":" + self.subject_type.slug
 
     def get_queryset(self):
         return super().get_queryset().filter(subject_type=self.subject_type)
 
     def get_template_names(self):
         return [
-            'leprikon/{}{}.html'.format(self.subject_type.slug, self.template_name_suffix),
-            'leprikon/{}{}.html'.format(self.subject_type.subject_type, self.template_name_suffix),
-            'leprikon/subject{}.html'.format(self.template_name_suffix),
+            "leprikon/{}{}.html".format(self.subject_type.slug, self.template_name_suffix),
+            "leprikon/{}{}.html".format(self.subject_type.subject_type, self.template_name_suffix),
+            "leprikon/subject{}.html".format(self.template_name_suffix),
         ]
 
 
 class CMSSubjectTypeMixin(SubjectTypeMixin):
     def dispatch(self, request, *args, **kwargs):
         # Get current CMS Page
         cms_page = request.current_page.get_public_object()
 
         # Check whether it really is a Leprikon subject type application.
         # It might also be one of its sub-pages.
-        if cms_page.application_urls != 'LeprikonSubjectTypeApp':
+        if cms_page.application_urls != "LeprikonSubjectTypeApp":
             # In such case show regular CMS Page
             return cms_view_details(request, *args, **kwargs)
-        return super(CMSSubjectTypeMixin, self).dispatch(request, cms_page.application_namespace, **kwargs)
+        return super().dispatch(request, cms_page.application_namespace, **kwargs)
 
 
 class SubjectListBaseView(FilteredListView):
     form_class = SubjectFilterForm
-    preview_template = 'leprikon/subject_preview.html'
+    preview_template = "leprikon/subject_preview.html"
     paginate_by = 10
 
     def get_title(self):
-        return _('{subject_type} in school year {school_year}').format(
+        if self.subject_type.subject_type == SubjectType.EVENT:
+            if self.request.GET.get("past"):
+                return _("Past {subject_type} in school year {school_year}").format(
+                    subject_type=self.subject_type.plural,
+                    school_year=self.request.school_year,
+                )
+            return _("Oncoming {subject_type}").format(
+                subject_type=self.subject_type.plural,
+            )
+        return _("{subject_type} in school year {school_year}").format(
             subject_type=self.subject_type.plural,
             school_year=self.request.school_year,
         )
 
     def get_message_empty(self):
-        return _('No {subject_type} matching given search parameters found.').format(
+        return _("No {subject_type} matching given search parameters found.").format(
             subject_type=self.subject_type.plural,
         )
 
     def get_form(self):
         return self.form_class(
             subject_type_type=self.subject_type.subject_type,
             subject_types=[self.subject_type],
             school_year=self.request.school_year,
             is_staff=self.request.user.is_staff,
             data=self.request.GET,
         )
 
-    def get_queryset(self):
-        return self.get_form().get_queryset()
-
 
 class SubjectListView(CMSSubjectTypeMixin, SubjectListBaseView):
     pass
 
 
 class SubjectListMineView(SubjectTypeMixin, SubjectListBaseView):
-
     def get_template_names(self):
         return [
-            'leprikon/{}_list_mine.html'.format(self.subject_type.slug),
-            'leprikon/{}_list_mine.html'.format(self.subject_type.subject_type),
-            'leprikon/subject_list_mine.html',
-        ] + super(SubjectListMineView, self).get_template_names()
+            "leprikon/{}_list_mine.html".format(self.subject_type.slug),
+            "leprikon/{}_list_mine.html".format(self.subject_type.subject_type),
+            "leprikon/subject_list_mine.html",
+        ] + super().get_template_names()
 
     def get_title(self):
-        return _('My {subject_type} in school year {school_year}').format(
+        return _("My {subject_type} in school year {school_year}").format(
             subject_type=self.subject_type.plural,
             school_year=self.request.school_year,
         )
 
     def get_queryset(self):
-        return super(SubjectListMineView, self).get_queryset().filter(leaders=self.request.leader)
+        return super().get_queryset().filter(leaders=self.request.leader)
 
 
 class SubjectDetailView(CMSSubjectTypeMixin, DetailView):
-
     def get_queryset(self):
-        qs = super(SubjectDetailView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(public=True)
         return qs
 
 
-class SubjectRegistrationsView(SubjectTypeMixin, DetailView):
-    template_name_suffix = '_registrations'
+class SubjectJournalsView(SubjectTypeMixin, DetailView):
+    template_name_suffix = "_journals"
 
     def get_queryset(self):
-        qs = super(SubjectRegistrationsView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(leaders=self.request.leader)
         return qs
 
     def get_context_data(self, **kwargs):
-        context = super(SubjectRegistrationsView, self).get_context_data(**kwargs)
-        context['site'] = LeprikonSite.objects.get_current()
-        return context
+        return super().get_context_data(
+            add_label=_("Create journal"),
+            add_url=reverse_with_back(self.request, "leprikon:journal_create", kwargs={"subject": self.object.id}),
+            preview_template="leprikon/journal_preview.html",
+            message_empty=_("No journals matching given search parameters found."),
+            **kwargs,
+        )
+
+    def get_title(self):
+        return _("Journals of {subject_type} {subject}").format(
+            subject_type=self.subject_type.name_genitiv,
+            subject=self.object.display_name,
+        )
+
+
+class SubjectRegistrationsView(SubjectTypeMixin, DetailView):
+    template_name_suffix = "_registrations"
+
+    def get_queryset(self):
+        qs = super().get_queryset()
+        if not self.request.user.is_staff:
+            qs = qs.filter(leaders=self.request.leader)
+        return qs
 
 
 class SubjectUpdateView(SubjectTypeMixin, UpdateView):
     form_class = SubjectForm
 
     def get_title(self):
-        return _('Change {subject_type} {subject}').format(
+        return _("Change {subject_type} {subject}").format(
             subject_type=self.subject_type.name_akuzativ,
             subject=self.object.name,
         )
 
     def get_message(self):
-        return _('The changes in {subject_type} {subject} have been saved.').format(
+        return _("The changes in {subject_type} {subject} have been saved.").format(
             subject_type=self.subject_type.name_genitiv,
             subject=self.object.name,
         )
 
     def get_queryset(self):
-        qs = super(SubjectUpdateView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(leaders=self.request.leader)
         return qs
 
 
 class SubjectMixin:
     def dispatch(self, request, pk, **kwargs):
-        lookup_kwargs = {'subject_type': self.subject_type, 'id': int(pk)}
+        lookup_kwargs = {"subject_type": self.subject_type, "id": int(pk)}
         if not self.request.user.is_staff:
-            lookup_kwargs['public'] = True
+            lookup_kwargs["public"] = True
         self.subject = get_object_or_404(Subject, **lookup_kwargs)
         if not self.subject.registration_allowed:
             return redirect(self.subject)
         self.request.school_year = self.subject.school_year
         return super().dispatch(request, **kwargs)
 
 
 class SubjectRegistrationFormBaseView(CreateView):
-    back_url = reverse('leprikon:registration_list')
-    submit_label = _('Submit registration')
-    message = _('The registration has been saved. We will inform you about its further processing.')
-    template_name_suffix = '_registration_form'
+    subject: Subject
+    subject_variant: Optional[SubjectVariant]
+    registration_link: Optional[RegistrationLink] = None
+    available_variants: List[SubjectVariant]
+
+    back_url = reverse("leprikon:registration_list")
+    submit_label = _("Submit registration")
+    message = _("The registration has been saved. We will inform you about its further processing.")
+    template_name_suffix = "_registration_form"
     _form_classes = {
         SubjectType.COURSE: CourseRegistrationForm,
         SubjectType.EVENT: EventRegistrationForm,
         SubjectType.ORDERABLE: OrderableRegistrationForm,
     }
 
+    def dispatch(self, request, **kwargs):
+        subject_variant_pk: Optional[int] = kwargs.pop("variant_pk", None)
+        if self.registration_link:
+            self.available_variants = list(self.registration_link.subject_variants.filter(subject=self.subject))
+        else:
+            self.available_variants = self.subject.all_available_variants
+        try:
+            self.subject_variant = (
+                subject_variant_pk and [v for v in self.available_variants if v.pk == int(subject_variant_pk)][0]
+            )
+        except (IndexError, ValueError):
+            self.subject_variant = None
+        if self.subject_variant is None and len(self.available_variants) == 1:
+            self.subject_variant = self.available_variants[0]
+        return super().dispatch(request, **kwargs)
+
     def get_title(self):
-        return _('Registration for {subject_type} {subject}').format(
+        return _("Registration for {subject_type} {subject}").format(
             subject_type=self.subject_type.name_akuzativ,
             subject=self.subject.name,
         )
 
     def get_form_class(self):
-        return self._form_classes[self.subject_type.subject_type]
+        return self._form_classes[self.subject_type.subject_type] if self.subject_variant else Form
 
     def get_form_kwargs(self):
-        kwargs = super().get_form_kwargs()
-        kwargs['subject'] = self.subject
-        kwargs['user'] = self.request.user
-        return kwargs
+        if self.subject_variant:
+            kwargs = super().get_form_kwargs()
+            kwargs["subject"] = self.subject
+            kwargs["subject_variant"] = self.subject_variant
+            kwargs["user"] = self.request.user
+            return kwargs
+        else:
+            return {}
 
 
 class SubjectRegistrationFormView(CMSSubjectTypeMixin, SubjectMixin, SubjectRegistrationFormBaseView):
     pass
 
 
 class UserRegistrationMixin:
     _attrs = {
-        SubjectType.COURSE: 'courseregistration',
-        SubjectType.EVENT: 'eventregistration',
-        SubjectType.ORDERABLE: 'orderableregistration',
+        SubjectType.COURSE: "courseregistration",
+        SubjectType.EVENT: "eventregistration",
+        SubjectType.ORDERABLE: "orderableregistration",
     }
 
     def get_object(self):
         subject_registration = super().get_object()
         if subject_registration.user != self.request.user:
             raise PermissionDenied()
         return getattr(
             subject_registration,
             self._attrs[subject_registration.subject_type_type],
         )
 
     def get_queryset(self):
         return SubjectRegistration.objects.annotate(
-            subject_type_type=F('subject__subject_type__subject_type'),
+            subject_type_type=F("subject__subject_type__subject_type"),
         )
 
     def get_template_names(self):
-        return [self.template_name] if self.template_name else [
-            'leprikon/{}_registration{}.html'.format(self.object.subject.subject_type.slug,
-                                                     self.template_name_suffix),
-            'leprikon/{}_registration{}.html'.format(self.object.subject.subject_type.subject_type,
-                                                     self.template_name_suffix),
-            'leprikon/subject_registration{}.html'.format(self.template_name_suffix),
-        ]
+        return (
+            [self.template_name]
+            if self.template_name
+            else [
+                "leprikon/{}_registration{}.html".format(
+                    self.object.subject.subject_type.slug, self.template_name_suffix
+                ),
+                "leprikon/{}_registration{}.html".format(
+                    self.object.subject.subject_type.subject_type, self.template_name_suffix
+                ),
+                "leprikon/subject_registration{}.html".format(self.template_name_suffix),
+            ]
+        )
 
 
 class PDFMixin:
-    event = 'pdf'
+    event = "pdf"
 
     def get(self, request, *args, **kwargs):
         obj = self.get_object()
-        response = HttpResponse(content_type='application/pdf')
-        response['Content-Disposition'] = 'attachment; filename="{}"'.format(obj.get_pdf_filename(self.event))
+        response = HttpResponse(content_type="application/pdf")
+        response["Content-Disposition"] = 'attachment; filename="{}"'.format(obj.get_pdf_filename(self.event))
         return obj.write_pdf(self.event, response)
 
 
 class SubjectRegistrationPdfView(PDFMixin, UserRegistrationMixin, DetailView):
     pass
 
 
 class SubjectRegistrationPaymentRequestView(PDFMixin, UserRegistrationMixin, DetailView):
-    event = 'payment_request'
+    event = "payment_request"
 
 
 class SubjectRegistrationCancelView(UserRegistrationMixin, ConfirmUpdateView):
-    template_name_suffix = '_cancel'
-    title = _('Registration cancellation request')
+    template_name_suffix = "_cancel"
+    title = _("Registration cancellation request")
 
     def get_queryset(self):
         return super().get_queryset().filter(canceled=None)
 
     def get_question(self):
         return _('Are you sure You want to cancel the registration "{}"?').format(self.object)
 
     def get_message(self):
-        return _('The cancellation request for {} has been saved.').format(self.object)
+        return _("The cancellation request for {} has been saved.").format(self.object)
 
     def confirmed(self):
         if self.object.approved:
             self.object.cancelation_requested = now()
             self.object.cancelation_requested_by = self.request.user
             self.object.save()
         else:
             self.object.refuse(self.request.user)
 
 
-class UserPaymentMixin:
+class SubjectPaymentsListView(ListView):
     model = SubjectPayment
+    template_name = "leprikon/payments.html"
+    paginate_by = 20
 
     def get_queryset(self):
-        return super(UserPaymentMixin, self).get_queryset().filter(
-            registration__user=self.request.user
-        ).order_by('-accounted')
+        return (
+            super()
+            .get_queryset()
+            .filter(Q(target_registration__user=self.request.user) | Q(source_registration__user=self.request.user))
+            .order_by("-accounted")
+        )
 
+    def get_title(self):
+        return _("Payments")
 
-class SubjectPaymentsListView(UserPaymentMixin, ListView):
-    template_name = 'leprikon/payments.html'
-    paginate_by = 20
 
-    def get_title(self):
-        return _('Payments')
+class SubjectReceivedPaymentPdfView(PDFMixin, DetailView):
+    model = SubjectReceivedPayment
 
+    def get_queryset(self):
+        return super().get_queryset().filter(target_registration__user=self.request.user)
 
-class SubjectPaymentPdfView(PDFMixin, UserPaymentMixin, DetailView):
-    pass
+
+class SubjectReturnedPaymentPdfView(PDFMixin, DetailView):
+    model = SubjectReturnedPayment
+
+    def get_queryset(self):
+        return super().get_queryset().filter(source_registration__user=self.request.user)
```

### Comparing `leprikon-3.0.0/leprikon/views/timesheets.py` & `leprikon-3.5.0/leprikon/views/timesheets.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,106 +1,107 @@
 from django.http import Http404
 from django.urls import reverse_lazy
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..forms.timesheets import TimesheetEntryForm
 from ..models.timesheets import Timesheet, TimesheetEntry
-from .generic import (
-    ConfirmUpdateView, CreateView, DeleteView, DetailView, ListView,
-    UpdateView,
-)
+from .generic import ConfirmUpdateView, CreateView, DeleteView, DetailView, ListView, UpdateView
 
 
 class TimesheetListView(ListView):
     model = Timesheet
-    preview_template = 'leprikon/timesheet_preview.html'
+    preview_template = "leprikon/timesheet_preview.html"
     paginate_by = 6
-    add_label = _('add entry')
-    add_url = reverse_lazy('leprikon:timesheetentry_create')
+    add_label = _("add entry")
+    add_url = reverse_lazy("leprikon:timesheetentry_create")
 
     def get_title(self):
-        return _('Timesheets')
+        return _("Timesheets")
 
     def get_queryset(self):
-        return super(TimesheetListView, self).get_queryset().filter(leader=self.request.leader)
+        return super().get_queryset().filter(leader=self.request.leader)
 
 
 class TimesheetDetailView(DetailView):
     model = Timesheet
 
     def get_queryset(self):
-        qs = super(TimesheetDetailView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(leader=self.request.leader)
         return qs
 
 
 class TimesheetSubmitView(ConfirmUpdateView):
     model = Timesheet
-    title = _('Submit timesheet')
+    title = _("Submit timesheet")
 
     def get_queryset(self):
-        return super(TimesheetSubmitView, self).get_queryset().filter(
-            leader=self.request.leader,
-            submitted=False,
+        return (
+            super()
+            .get_queryset()
+            .filter(
+                leader=self.request.leader,
+                submitted=False,
+            )
         )
 
     def get_question(self):
         return _(
-            'Are you sure You want to submit the timesheet now? '
-            'You won\'t be able to edit the entries for {} any more.'
+            "Are you sure You want to submit the timesheet now? "
+            "You won't be able to edit the entries for {} any more."
         ).format(self.object.period.name)
 
     def get_message(self):
-        return _('The timesheet for () has been submitted.').format(self.object.period.name)
+        return _("The timesheet for () has been submitted.").format(self.object.period.name)
 
     def confirmed(self):
         self.object.submitted = True
         self.object.save()
 
 
 class TimesheetEntryCreateView(CreateView):
     model = TimesheetEntry
     form_class = TimesheetEntryForm
-    template_name = 'leprikon/timesheetentry_form.html'
-    title = _('New timesheet entry')
-    message = _('New timesheet entry has been created.')
+    template_name = "leprikon/timesheetentry_form.html"
+    title = _("New timesheet entry")
+    message = _("New timesheet entry has been created.")
 
     def get_form_kwargs(self):
-        kwargs = super(TimesheetEntryCreateView, self).get_form_kwargs()
-        kwargs['leader'] = self.request.leader
+        kwargs = super().get_form_kwargs()
+        kwargs["leader"] = self.request.leader
         return kwargs
 
 
 class TimesheetEntryUpdateView(UpdateView):
     model = TimesheetEntry
     form_class = TimesheetEntryForm
-    template_name = 'leprikon/timesheetentry_form.html'
-    title = _('Change timesheet entry')
-    message = _('The timesheet entry has been updated.')
+    template_name = "leprikon/timesheetentry_form.html"
+    title = _("Change timesheet entry")
+    message = _("The timesheet entry has been updated.")
 
     def get_queryset(self):
-        qs = super(TimesheetEntryUpdateView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(timesheet__leader=self.request.leader)
         return qs
 
 
 class TimesheetEntryDeleteView(DeleteView):
     model = TimesheetEntry
-    title = _('Delete timesheet entry')
-    message = _('The timesheet entry has been deleted.')
+    title = _("Delete timesheet entry")
+    message = _("The timesheet entry has been deleted.")
 
     def get_queryset(self):
-        qs = super(TimesheetEntryDeleteView, self).get_queryset()
+        qs = super().get_queryset()
         if not self.request.user.is_staff:
             qs = qs.filter(timesheet__leader=self.request.leader)
         return qs
 
     def get_object(self):
-        obj = super(TimesheetEntryDeleteView, self).get_object()
+        obj = super().get_object()
         if obj.timesheet.submitted:
             raise Http404()
         return obj
 
     def get_question(self):
-        return _('Do You really want to delete timesheet entry?')
+        return _("Do You really want to delete timesheet entry?")
```

### Comparing `leprikon-3.0.0/leprikon/views/user.py` & `leprikon-3.5.0/leprikon/views/user.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,35 +1,39 @@
-from django.contrib.auth import (
-    get_user_model, login as auth_login, views as auth_views,
-)
+from django.contrib.auth import get_user_model, login as auth_login, views as auth_views
 from django.urls import reverse_lazy
 from django.utils.timezone import now
-from django.utils.translation import ugettext_lazy as _
+from django.utils.translation import gettext_lazy as _
 
 from ..conf import settings
 from ..forms.user import (
-    PasswordResetForm, SetPasswordForm, UserAgreementForm, UserCreateForm,
-    UserEmailForm, UserLoginForm, UserPasswordForm, UserUpdateForm,
+    PasswordResetForm,
+    SetPasswordForm,
+    UserAgreementForm,
+    UserCreateForm,
+    UserEmailForm,
+    UserLoginForm,
+    UserPasswordForm,
+    UserUpdateForm,
 )
 from ..models.roles import Parent
 from ..models.useragreement import UserAgreement
 from .generic import CreateView, FormView, UpdateView
 
 
 class UserCreateView(CreateView):
     model = get_user_model()
     form_class = UserCreateForm
-    title = _('Create account')
-    form_item_template_name = 'leprikon/user_create_form_item.html'
+    title = _("Create account")
+    form_item_template_name = "leprikon/user_create_form_item.html"
 
     def get_message(self):
-        return _('User account {} has been created.').format(self.object)
+        return _("User account {} has been created.").format(self.object)
 
     def form_valid(self, form):
-        response = super(UserCreateView, self).form_valid(form)
+        response = super().form_valid(form)
 
         # first user is superuser
         if self.model.objects.count() == 1:
             self.object.is_staff = True
             self.object.is_superuser = True
             self.object.save()
 
@@ -44,122 +48,128 @@
         parent.first_name = self.object.first_name
         parent.last_name = self.object.last_name
         parent.email = self.object.email
         parent.user = self.object
         parent.save()
 
         # login
-        self.object.backend = 'django.contrib.auth.backends.ModelBackend'
+        self.object.backend = "django.contrib.auth.backends.ModelBackend"
         auth_login(self.request, self.object)
         return response
 
 
 class UserAgreementView(FormView):
     form_class = UserAgreementForm
-    title = _('Agreement with the terms of use')
-    form_item_template_name = 'leprikon/user_create_form_item.html'
+    title = _("Agreement with the terms of use")
+    form_item_template_name = "leprikon/user_create_form_item.html"
 
     def get_message(self):
-        return _('The agreement has been saved.')
+        return _("The agreement has been saved.")
 
     def form_valid(self, form):
         try:
             self.request.user.agreement.granted = now()
             self.request.user.agreement.save()
         except UserAgreement.DoesNotExist:
             UserAgreement.objects.create(
                 user=self.request.user,
                 granted=now(),
             )
-        return super(UserAgreementView, self).form_valid(form)
+        return super().form_valid(form)
 
 
 class UserUpdateView(UpdateView):
     model = get_user_model()
     form_class = UserUpdateForm
-    title = _('Change user')
+    title = _("Change user")
 
     def get_object(self):
         return self.request.user
 
     def get_message(self):
-        return _('User account {} has been updated.').format(self.object)
+        return _("User account {} has been updated.").format(self.object)
 
 
 class UserEmailView(UserUpdateView):
     form_class = UserEmailForm
 
     def get_title(self):
         if self.request.user.email:
-            return _('Change e-mail address')
+            return _("Change e-mail address")
         else:
-            return _('Set e-mail address')
+            return _("Set e-mail address")
 
 
 class UserPasswordView(auth_views.PasswordChangeView):
-    template_name = 'leprikon/password.html'
+    template_name = "leprikon/password.html"
     form_class = UserPasswordForm
-    success_url = reverse_lazy('leprikon:summary')
+    success_url = reverse_lazy("leprikon:summary")
 
     def get_context_data(self, **kwargs):
-        kwargs.update({
-            'submit_label': _('Change password'),
-            'back_label': _('Back'),
-            'back_url': reverse_lazy('leprikon:summary'),
-            'placeholder': 'user_password',
-        })
+        kwargs.update(
+            {
+                "submit_label": _("Change password"),
+                "back_label": _("Back"),
+                "back_url": reverse_lazy("leprikon:summary"),
+                "placeholder": "user_password",
+            }
+        )
         return super().get_context_data(**kwargs)
 
 
 class UserLoginView(auth_views.LoginView):
-    template_name = 'leprikon/login.html'
+    template_name = "leprikon/login.html"
     form_class = UserLoginForm
     redirect_field_name = settings.LEPRIKON_PARAM_BACK
 
 
 class UserLogoutView(auth_views.LogoutView):
-    next_page = settings.LOGOUT_REDIRECT_URL or '/'
+    next_page = settings.LOGOUT_REDIRECT_URL or "/"
     redirect_field_name = settings.LEPRIKON_PARAM_BACK
 
 
 class PasswordResetView(auth_views.PasswordResetView):
-    template_name = 'leprikon/password_reset.html'
+    template_name = "leprikon/password_reset.html"
     form_class = PasswordResetForm
-    email_template_name = 'leprikon/password_reset_email.html'
+    email_template_name = "leprikon/password_reset_email.html"
     from_email = settings.SERVER_EMAIL
 
     def get_context_data(self, **kwargs):
-        kwargs.update({
-            'instructions': '<p>{}<p>'.format(
-                _('Enter your email address, and we\'ll email instructions for setting a new one.')
-            ),
-            'submit_label': _('Reset my password'),
-            'placeholder': 'password_reset',
-        })
+        kwargs.update(
+            {
+                "instructions": "<p>{}<p>".format(
+                    _("Enter your email address, and we'll email instructions for setting a new one.")
+                ),
+                "submit_label": _("Reset my password"),
+                "placeholder": "password_reset",
+            }
+        )
         return super().get_context_data(**kwargs)
 
-    success_url = reverse_lazy('leprikon:password_reset_done')
+    success_url = reverse_lazy("leprikon:password_reset_done")
 
 
 class PasswordResetDoneView(auth_views.PasswordResetDoneView):
-    template_name = 'leprikon/password_reset_done.html'
+    template_name = "leprikon/password_reset_done.html"
 
 
 class PasswordResetConfirmView(auth_views.PasswordResetConfirmView):
-    template_name = 'leprikon/password_reset_confirm.html'
+    template_name = "leprikon/password_reset_confirm.html"
     form_class = SetPasswordForm
 
     def get_context_data(self, **kwargs):
-        kwargs.update({
-            'instructions': '<p>{}<p>'.format(
-                _('Please enter your new password twice so we can verify you typed it in correctly.')
-            ),
-            'submit_label': _('Set my password'),
-            'placeholder': 'password_set',
-        })
+        kwargs.update(
+            {
+                "instructions": "<p>{}<p>".format(
+                    _("Please enter your new password twice so we can verify you typed it in correctly.")
+                ),
+                "submit_label": _("Set my password"),
+                "placeholder": "password_set",
+            }
+        )
         return super().get_context_data(**kwargs)
 
-    success_url = reverse_lazy('leprikon:password_reset_complete')
+    success_url = reverse_lazy("leprikon:password_reset_complete")
 
 
 class PasswordResetCompleteView(auth_views.PasswordResetCompleteView):
-    template_name = 'leprikon/password_reset_complete.html'
+    template_name = "leprikon/password_reset_complete.html"
```

